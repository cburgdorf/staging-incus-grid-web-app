var rp=Object.defineProperty;var np=(L,g,y)=>g in L?rp(L,g,{enumerable:!0,configurable:!0,writable:!0,value:y}):L[g]=y;var ln=(L,g,y)=>np(L,typeof g!="symbol"?g+"":g,y);import{r as la,y as Wn,s as Dn,n as Mi,c as Pr,o as Ih,z as Zd,e as Au,A as nd,f as sp,h as ap}from"../chunks/CSkVN5vT.js";import{l as $i,S as Mn,i as Tn,d as Qe,a as at,w as ye,c as je,e as ct,h as Je,b as Me,g as mt,j as yt,s as mr,f as yi,t as _i,x as bh,y as Xt,o as Yr,z as Ci,A as _u,B as pc,C as op,D as Hr,E as jr,F as Tr,G as sd,q as Yn,k as pr,u as Kn,v as Zn,r as $n,H as _h,m as ph,n as mh,I as ad,J as lp}from"../chunks/CeV1JoeD.js";import{d as $d,w as Ga}from"../chunks/DSwuXoCX.js";import{p as cp}from"../chunks/CvWTmQpD.js";function za(L){return(L==null?void 0:L.length)!==void 0?L:Array.from(L)}function hp(L,g){L.d(1),g.delete(L.key)}function up(L,g,y,x,D,H,E,c,X,he,Ie,fe){let oe=L.length,Fe=H.length,Ue=oe;const Xe={};for(;Ue--;)Xe[L[Ue].key]=Ue;const et=[],st=new Map,Ne=new Map,He=[];for(Ue=Fe;Ue--;){const ht=fe(D,H,Ue),Gt=y(ht);let vt=E.get(Gt);vt?He.push(()=>vt.p(ht,g)):(vt=he(Gt,ht),vt.c()),st.set(Gt,et[Ue]=vt),Gt in Xe&&Ne.set(Gt,Math.abs(Ue-Xe[Gt]))}const $e=new Set,lt=new Set;function Qt(ht){$i(ht,1),ht.m(c,Ie),E.set(ht.key,ht),Ie=ht.first,Fe--}for(;oe&&Fe;){const ht=et[Fe-1],Gt=L[oe-1],vt=ht.key,Tt=Gt.key;ht===Gt?(Ie=ht.first,oe--,Fe--):st.has(Tt)?!E.has(vt)||$e.has(vt)?Qt(ht):lt.has(Tt)?oe--:Ne.get(vt)>Ne.get(Tt)?(lt.add(vt),Qt(ht)):($e.add(Tt),oe--):(X(Gt,E),oe--)}for(;oe--;){const ht=L[oe];st.has(ht.key)||X(ht,E)}for(;Fe;)Qt(et[Fe-1]);return la(He),et}var Wd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ap(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}var Xd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(L,g){(function(y,x){L.exports=x()})(Wd,function(){var y={},x={};function D(E,c,X){if(x[E]=X,E==="index"){var he="var sharedModule = {}; ("+x.shared+")(sharedModule); ("+x.worker+")(sharedModule);",Ie={};return x.shared(Ie),x.index(y,Ie),typeof window<"u"&&y.setWorkerUrl(window.URL.createObjectURL(new Blob([he],{type:"text/javascript"}))),y}}D("shared",["exports"],function(E){function c(i,t,r,s){return new(r||(r=Promise))(function(l,d){function f(Q){try{b(s.next(Q))}catch(M){d(M)}}function _(Q){try{b(s.throw(Q))}catch(M){d(M)}}function b(Q){var M;Q.done?l(Q.value):(M=Q.value,M instanceof r?M:new r(function(R){R(M)})).then(f,_)}b((s=s.apply(i,t||[])).next())})}function X(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var he=Ie;function Ie(i,t){this.x=i,this.y=t}Ie.prototype={clone:function(){return new Ie(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,t){var r=Math.cos(i),s=Math.sin(i),l=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ie.convert=function(i){return i instanceof Ie?i:Array.isArray(i)?new Ie(i[0],i[1]):i};var fe=X(he),oe=Fe;function Fe(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}Fe.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,_=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ue=X(oe);let Xe,et;function st(){return Xe==null&&(Xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Xe}function Ne(){if(et==null&&(et=!1,st())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const l=4*s;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){et=!0;break}}}return et||!1}function He(i,t,r,s){const l=new Ue(i,t,r,s);return d=>l.solve(d)}const $e=He(.25,.1,.25,1);function lt(i,t,r){return Math.min(r,Math.max(t,i))}function Qt(i,t,r){const s=r-t,l=((i-t)%s+s)%s+t;return l===t?r:l}function ht(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let Gt=1;function vt(i,t,r){const s={};for(const l in i)s[l]=t.call(this,i[l],l,i);return s}function Tt(i,t,r){const s={};for(const l in i)t.call(this,i[l],l,i)&&(s[l]=i[l]);return s}function bt(i){return Array.isArray(i)?i.map(bt):typeof i=="object"&&i?vt(i,bt):i}const _t={};function Vt(i){_t[i]||(typeof console<"u"&&console.warn(i),_t[i]=!0)}function Lt(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Zt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let wi=null;function Mt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Si="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ei(i,t,r,s,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const f=d==null?void 0:d.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const _=f.startsWith("BGR"),b=new Uint8ClampedArray(s*l*4);if(yield d.copyTo(b,function(Q,M,R,O,Y){const W=4*Math.max(-M,0),ee=(Math.max(0,R)-R)*O*4+W,me=4*O,ve=Math.max(0,M),Re=Math.max(0,R);return{rect:{x:ve,y:Re,width:Math.min(Q.width,M+O)-ve,height:Math.min(Q.height,R+Y)-Re},layout:[{offset:ee,stride:me}]}}(i,t,r,s,l)),_)for(let Q=0;Q<b.length;Q+=4){const M=b[Q];b[Q]=b[Q+2],b[Q+2]=M}return b}finally{d.close()}})}let Qi,oi;const ui="AbortError";function br(){return new Error(ui)}const Jt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ei(i){return Jt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Yt="global-dispatcher";class ii extends Error{constructor(t,r,s,l){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=l}}const di=()=>Zt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ki=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=ei(i.url);if(s)return s(i,t);if(Zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Yt},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(di())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,l){return c(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:di(),signal:l.signal});s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");const f=yield fetch(d);if(!f.ok){const Q=yield f.blob();throw new ii(f.status,f.statusText,s.url,Q)}let _;_=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const b=yield _;if(l.signal.aborted)throw br();return{data:b,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})}(i,t);if(Zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Yt},t)}var r;return function(s,l){return new Promise((d,f)=>{var _;const b=new XMLHttpRequest;b.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(b.responseType="arraybuffer");for(const Q in s.headers)b.setRequestHeader(Q,s.headers[Q]);s.type==="json"&&(b.responseType="text",!((_=s.headers)===null||_===void 0)&&_.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=s.credentials==="include",b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if(!l.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let Q=b.response;if(s.type==="json")try{Q=JSON.parse(b.response)}catch(M){return void f(M)}d({data:Q,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const Q=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});f(new ii(b.status,b.statusText,s.url,Q))}},l.signal.addEventListener("abort",()=>{b.abort(),f(br())}),b.send(s.body)})}(i,t)};function vr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function yr(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Wi(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class pi{constructor(t,r={}){ht(this,r),this.type=t}}class zi extends pi{constructor(t,r={}){super("error",ht({error:t},r))}}class er{on(t,r){return this._listeners=this._listeners||{},yr(t,r,this._listeners),this}off(t,r){return Wi(t,r,this._listeners),Wi(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},yr(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new pi(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of l)_.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of d)Wi(s,_,this._oneTimeListeners),_.call(this,t);const f=this._eventedParent;f&&(ht(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof zi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var qe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pn(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return cr.forEach(s=>{s in t&&(r[s]=t[s])}),r}function Ai(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Ai(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Ai(i[r],t[r]))return!1;return!0}return i===t}function Gi(i,t){i.push(t)}function Xn(i,t,r){Gi(r,{command:"addSource",args:[i,t[i]]})}function wr(i,t,r){Gi(t,{command:"removeSource",args:[i]}),r[i]=!0}function Kr(i,t,r,s){wr(i,r,s),Xn(i,t,r)}function ca(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Ai(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!Ai(i[r][s],t[r][s]))return!1;return!0}function cn(i,t,r,s,l,d){i=i||{},t=t||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(Ai(i[f],t[f])||r.push({command:d,args:[s,f,t[f],l]}));for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(Ai(i[f],t[f])||r.push({command:d,args:[s,f,t[f],l]}))}function Ts(i){return i.id}function ha(i,t){return i[t.id]=t,i}class gt{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ln(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class xr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Rn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new Rn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const hn={kind:"null"},dt={kind:"number"},li={kind:"string"},$t={kind:"boolean"},Wt={kind:"color"},un={kind:"object"},ni={kind:"value"},Fn={kind:"collator"},zn={kind:"formatted"},es={kind:"padding"},_n={kind:"resolvedImage"},_e={kind:"variableAnchorOffsetCollection"};function J(i,t){return{kind:"array",itemType:i,N:t}}function j(i){if(i.kind==="array"){const t=j(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const te=[hn,dt,li,$t,Wt,zn,un,J(ni),es,_n,_e];function pe(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!pe(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of te)if(!pe(r,t))return null}}return`Expected ${j(i)} but found ${j(t)} instead.`}function Ce(i,t){return t.some(r=>r.kind===i.kind)}function Te(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Le(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const we=.96422,Ye=.82521,nt=4/29,Ge=6/29,It=3*Ge*Ge,Ot=Ge*Ge*Ge,jt=Math.PI/180,Ii=180/Math.PI;function si(i){return(i%=360)<0&&(i+=360),i}function xi([i,t,r,s]){let l,d;const f=sr((.2225045*(i=fi(i))+.7168786*(t=fi(t))+.0606169*(r=fi(r)))/1);i===t&&t===r?l=d=f:(l=sr((.4360747*i+.3850649*t+.1430804*r)/we),d=sr((.0139322*i+.0971045*t+.7141733*r)/Ye));const _=116*f-16;return[_<0?0:_,500*(l-f),200*(f-d),s]}function fi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function sr(i){return i>Ot?Math.pow(i,1/3):i/It+nt}function Ki([i,t,r,s]){let l=(i+16)/116,d=isNaN(t)?l:l+t/500,f=isNaN(r)?l:l-r/200;return l=1*Li(l),d=we*Li(d),f=Ye*Li(f),[hi(3.1338561*d-1.6168667*l-.4906146*f),hi(-.9787684*d+1.9161415*l+.033454*f),hi(.0719453*d-.2289914*l+1.4052427*f),s]}function hi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Li(i){return i>Ge?i*i*i:It*(i-nt)}function ji(i){return parseInt(i.padEnd(2,i),16)/255}function ar(i,t){return Ar(t?i/100:i,0,1)}function Ar(i,t,r){return Math.min(Math.max(t,i),r)}function dr(i){return!i.some(Number.isNaN)}const In={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ri{constructor(t,r,s,l=1,d=!0){this.r=t,this.g=r,this.b=s,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,s,l]))}static parse(t){if(t instanceof Ri)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=In[s];if(l){const[f,_,b]=l;return[f/255,_/255,b/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let _=1;return[ji(s.slice(_,_+=f)),ji(s.slice(_,_+=f)),ji(s.slice(_,_+=f)),ji(s.slice(_,_+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[_,b,Q,M,R,O,Y,W,ee,me,ve,Re]=f,Ee=[M||" ",Y||" ",me].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const Pe=[Q,O,ee].join(""),Ke=Pe==="%%%"?100:Pe===""?255:0;if(Ke){const ot=[Ar(+b/Ke,0,1),Ar(+R/Ke,0,1),Ar(+W/Ke,0,1),ve?ar(+ve,Re):1];if(dr(ot))return ot}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,_,b,Q,M,R,O,Y,W]=d,ee=[b||" ",M||" ",O].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const me=[+_,Ar(+Q,0,100),Ar(+R,0,100),Y?ar(+Y,W):1];if(dr(me))return function([ve,Re,Ee,Pe]){function Ke(ot){const St=(ot+ve/30)%12,Kt=Re*Math.min(Ee,1-Ee);return Ee-Kt*Math.max(-1,Math.min(St-3,9-St,1))}return ve=si(ve),Re/=100,Ee/=100,[Ke(0),Ke(8),Ke(4),Pe]}(me)}}}(t);return r?new Ri(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,r/d,s/d,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,l,d]=xi(t),f=Math.sqrt(s*s+l*l);return[Math.round(1e4*f)?si(Math.atan2(l,s)*Ii):NaN,f,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xi(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,l]=this.rgb;return`rgba(${[t,r,s].map(d=>Math.round(255*d)).join(",")},${l})`}}Ri.black=new Ri(0,0,0,1),Ri.white=new Ri(1,1,1,1),Ri.transparent=new Ri(0,0,0,0),Ri.red=new Ri(1,0,0,1);class Xo{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class el{constructor(t,r,s,l,d){this.text=t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=d}}class Rr{constructor(t){this.sections=t}static fromString(t){return new Rr([new el(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Rr?t:Rr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Zr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Zr)return t;if(typeof t=="number")return new Zr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Zr(t)}}toString(){return JSON.stringify(this.values)}}const tl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Fr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];if(typeof s!="string"||!tl.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Fr(t)}}toString(){return JSON.stringify(this.values)}}class $r{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new $r({name:t,available:!1}):null}}function ua(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ps(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ri||i instanceof Xo||i instanceof Rr||i instanceof Zr||i instanceof Fr||i instanceof $r)return!0;if(Array.isArray(i)){for(const t of i)if(!Ps(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ps(i[t]))return!1;return!0}return!1}function or(i){if(i===null)return hn;if(typeof i=="string")return li;if(typeof i=="boolean")return $t;if(typeof i=="number")return dt;if(i instanceof Ri)return Wt;if(i instanceof Xo)return Fn;if(i instanceof Rr)return zn;if(i instanceof Zr)return es;if(i instanceof Fr)return _e;if(i instanceof $r)return _n;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const l=or(s);if(r){if(r===l)continue;r=ni;break}r=l}return J(r||ni,t)}return un}function Aa(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Ri||i instanceof Rr||i instanceof Zr||i instanceof Fr||i instanceof $r?i.toString():JSON.stringify(i)}class bn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ps(t[1]))return r.error("invalid value");const s=t[1];let l=or(s);const d=r.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new bn(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class tr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const da={string:li,number:dt,boolean:$t,object:un};class Wr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const d=t[0];if(d==="array"){let _,b;if(t.length>2){const Q=t[1];if(typeof Q!="string"||!(Q in da)||Q==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=da[Q],l++}else _=ni;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],l++}s=J(_,b)}else{if(!da[d])throw new Error(`Types doesn't contain name = ${d}`);s=da[d]}const f=[];for(;l<t.length;l++){const _=r.parse(t[l],l,ni);if(!_)return null;f.push(_)}return new Wr(s,f)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!pe(this.type,or(s)))return s;if(r===this.args.length-1)throw new tr(`Expected value to be of type ${j(this.type)}, but found ${j(or(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const il={"to-boolean":$t,"to-color":Wt,"to-number":dt,"to-string":li};class vn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!il[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=il[s],d=[];for(let f=1;f<t.length;f++){const _=r.parse(t[f],f,ni);if(!_)return null;d.push(_)}return new vn(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof Ri)return r;if(typeof r=="string"){const d=t.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ua(r[0],r[1],r[2],r[3]),!s))return new Ri(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new tr(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const l=Zr.parse(r);if(l)return l}throw new tr(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const l=Fr.parse(r);if(l)return l}throw new tr(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new tr(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Rr.fromString(Aa(this.args[0].evaluate(t)));case"resolvedImage":return $r.fromString(Aa(this.args[0].evaluate(t)));default:return Aa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const _c=["Unknown","Point","LineString","Polygon"];class Gn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_c[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Ri.parse(t)),r}}class ts{constructor(t,r,s=[],l,d=new Rn,f=[]){this.registry=t,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=f,this.expectedType=l,this._isConstant=r}parse(t,r,s,l,d={}){return r?this.concat(r,s,l)._parse(t,d):this._parse(t,d)}_parse(t,r){function s(l,d,f){return f==="assert"?new Wr(d,[l]):f==="coerce"?new vn(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let f=d.parse(t,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,b=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||b.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(_.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(_,b))return null}else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"assert")}if(!(f instanceof bn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const _=new Gn;try{f=new bn(f.type,f.evaluate(_))}catch(b){return this.error(b.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l=typeof t=="number"?this.path.concat(t):this.path,d=s?this.scope.concat(s):this.scope;return new ts(this.registry,this._isConstant,l,r||null,d,this.errors)}error(t,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new xr(s,t))}checkSubtype(t,r){const s=pe(t,r);return s&&this.error(s),s}}class Xr{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let d=1;d<t.length-1;d+=2){const f=t[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=r.parse(t[d+1],d+1);if(!_)return null;s.push([f,_])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new Xr(s,l):null}outputDefined(){return this.result.outputDefined()}}class Di{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new Di(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class fa{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,dt),l=r.parse(t[2],2,J(r.expectedType||ni));return s&&l?new fa(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new tr(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new tr(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new tr(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class rl{constructor(t,r){this.type=$t,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,ni),l=r.parse(t[2],2,ni);return s&&l?Ce(s.type,[$t,li,dt,hn,ni])?new rl(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Te(r,["boolean","string","number","null"]))throw new tr(`Expected first argument to be of type boolean, string, number or null, but found ${j(or(r))} instead.`);if(!Te(s,["string","array"]))throw new tr(`Expected second argument to be of type array or string, but found ${j(or(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Is{constructor(t,r,s){this.type=dt,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,ni),l=r.parse(t[2],2,ni);if(!s||!l)return null;if(!Ce(s.type,[$t,li,dt,hn,ni]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,dt);return d?new Is(s,l,d):null}return new Is(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Te(r,["boolean","string","number","null"]))throw new tr(`Expected first argument to be of type boolean, string, number or null, but found ${j(or(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Te(s,["string"])){const d=s.indexOf(r,l);return d===-1?-1:[...s.slice(0,d)].length}if(Te(s,["array"]))return s.indexOf(r,l);throw new tr(`Expected second argument to be of type array or string, but found ${j(or(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ho{constructor(t,r,s,l,d,f){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=d,this.otherwise=f}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d={},f=[];for(let Q=2;Q<t.length-1;Q+=2){let M=t[Q];const R=t[Q+1];Array.isArray(M)||(M=[M]);const O=r.concat(Q);if(M.length===0)return O.error("Expected at least one branch label.");for(const W of M){if(typeof W!="number"&&typeof W!="string")return O.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return O.error("Numeric branch labels must be integer values.");if(s){if(O.checkSubtype(s,or(W)))return null}else s=or(W);if(d[String(W)]!==void 0)return O.error("Branch labels must be unique.");d[String(W)]=f.length}const Y=r.parse(R,Q,l);if(!Y)return null;l=l||Y.type,f.push(Y)}const _=r.parse(t[1],1,ni);if(!_)return null;const b=r.parse(t[t.length-1],t.length-1,l);return b?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new ho(s,l,_,d,f,b):null}evaluate(t){const r=this.input.evaluate(t);return(or(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class wn{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let f=1;f<t.length-1;f+=2){const _=r.parse(t[f],f,$t);if(!_)return null;const b=r.parse(t[f+1],f+1,s);if(!b)return null;l.push([_,b]),s=s||b.type}const d=r.parse(t[t.length-1],t.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new wn(s,l,d)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class is{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,ni),l=r.parse(t[2],2,dt);if(!s||!l)return null;if(!Ce(s.type,[J(ni),li,ni]))return r.error(`Expected first argument to be of type array or string, but found ${j(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,dt);return d?new is(s.type,s,l,d):null}return new is(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Te(r,["string"]))return[...r].slice(s,l).join("");if(Te(r,["array"]))return r.slice(s,l);throw new tr(`Expected first argument to be of type array or string, but found ${j(or(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ls(i,t){const r=i.length-1;let s,l,d=0,f=r,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),s=i[_],l=i[_+1],s<=t){if(_===r||t<l)return _;d=_+1}else{if(!(s>t))throw new tr("Input is not a number.");f=_-1}return 0}class ga{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,d]of s)this.labels.push(l),this.outputs.push(d)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,dt);if(!s)return null;const l=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<t.length;f+=2){const _=f===1?-1/0:t[f],b=t[f+1],Q=f,M=f+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(l.length&&l[l.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Q);const R=r.parse(b,M,d);if(!R)return null;d=d||R.type,l.push([_,R])}return new ga(d,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;return l>=r[d-1]?s[d-1].evaluate(t):s[Ls(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function uo(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var nl=sl;function sl(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}sl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,_=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ol=uo(nl);function bs(i,t,r){return i+r*(t-i)}function Rs(i,t,r){return i.map((s,l)=>bs(s,t[l],r))}const _r={number:bs,color:function(i,t,r,s="rgb"){switch(s){case"rgb":{const[l,d,f,_]=Rs(i.rgb,t.rgb,r);return new Ri(l,d,f,_,!1)}case"hcl":{const[l,d,f,_]=i.hcl,[b,Q,M,R]=t.hcl;let O,Y;if(isNaN(l)||isNaN(b))isNaN(l)?isNaN(b)?O=NaN:(O=b,f!==1&&f!==0||(Y=Q)):(O=l,M!==1&&M!==0||(Y=d));else{let Re=b-l;b>l&&Re>180?Re-=360:b<l&&l-b>180&&(Re+=360),O=l+r*Re}const[W,ee,me,ve]=function([Re,Ee,Pe,Ke]){return Re=isNaN(Re)?0:Re*jt,Ki([Pe,Math.cos(Re)*Ee,Math.sin(Re)*Ee,Ke])}([O,Y??bs(d,Q,r),bs(f,M,r),bs(_,R,r)]);return new Ri(W,ee,me,ve,!1)}case"lab":{const[l,d,f,_]=Ki(Rs(i.lab,t.lab,r));return new Ri(l,d,f,_,!1)}}},array:Rs,padding:function(i,t,r){return new Zr(Rs(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const s=i.values,l=t.values;if(s.length!==l.length)throw new tr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const d=[];for(let f=0;f<s.length;f+=2){if(s[f]!==l[f])throw new tr(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${s[f]}, to[${f}]: ${l[f]}`);d.push(s[f]);const[_,b]=s[f+1],[Q,M]=l[f+1];d.push([bs(_,Q,r),bs(b,M,r)])}return new Fr(d)}};class zr{constructor(t,r,s,l,d){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(t,r,s,l){let d=0;if(t.name==="exponential")d=Ua(r,t.base,s,l);else if(t.name==="linear")d=Ua(r,1,s,l);else if(t.name==="cubic-bezier"){const f=t.controlPoints;d=new Ol(f[0],f[1],f[2],f[3]).solve(Ua(r,1,s,l))}return d}static parse(t,r){let[s,l,d,...f]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const Q=l[1];if(typeof Q!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:Q}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const Q=l.slice(1);if(Q.length!==4||Q.some(M=>typeof M!="number"||M<0||M>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:Q}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,dt),!d)return null;const _=[];let b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=Wt:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let Q=0;Q<f.length;Q+=2){const M=f[Q],R=f[Q+1],O=Q+3,Y=Q+4;if(typeof M!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(_.length&&_[_.length-1][0]>=M)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const W=r.parse(R,Y,b);if(!W)return null;b=b||W.type,_.push([M,W])}return Le(b,dt)||Le(b,Wt)||Le(b,es)||Le(b,_e)||Le(b,J(dt))?new zr(b,s,l,d,_):r.error(`Type ${j(b)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;if(l>=r[d-1])return s[d-1].evaluate(t);const f=Ls(r,l),_=zr.interpolationFactor(this.interpolation,l,r[f],r[f+1]),b=s[f].evaluate(t),Q=s[f+1].evaluate(t);switch(this.operator){case"interpolate":return _r[this.type.kind](b,Q,_);case"interpolate-hcl":return _r.color(b,Q,_,"hcl");case"interpolate-lab":return _r.color(b,Q,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ua(i,t,r,s){const l=s-r,d=i-r;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}class Ao{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const d=[];for(const _ of t.slice(1)){const b=r.parse(_,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,d.push(b)}if(!s)throw new Error("No output type");const f=l&&d.some(_=>pe(l,_.type));return new Ao(f?ni:s,d)}evaluate(t){let r,s=null,l=0;for(const d of this.args)if(l++,s=d.evaluate(t),s&&s instanceof $r&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Na(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ql(i,t,r,s){return s.compare(t,r)===0}function pa(i,t,r){const s=i!=="=="&&i!=="!=";return class ef{constructor(d,f,_){this.type=$t,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const _=d[0];let b=f.parse(d[1],1,ni);if(!b)return null;if(!Na(_,b.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${j(b.type)}'.`);let Q=f.parse(d[2],2,ni);if(!Q)return null;if(!Na(_,Q.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${j(Q.type)}'.`);if(b.type.kind!==Q.type.kind&&b.type.kind!=="value"&&Q.type.kind!=="value")return f.error(`Cannot compare types '${j(b.type)}' and '${j(Q.type)}'.`);s&&(b.type.kind==="value"&&Q.type.kind!=="value"?b=new Wr(Q.type,[b]):b.type.kind!=="value"&&Q.type.kind==="value"&&(Q=new Wr(b.type,[Q])));let M=null;if(d.length===4){if(b.type.kind!=="string"&&Q.type.kind!=="string"&&b.type.kind!=="value"&&Q.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(M=f.parse(d[3],3,Fn),!M)return null}return new ef(b,Q,M)}evaluate(d){const f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const b=or(f),Q=or(_);if(b.kind!==Q.kind||b.kind!=="string"&&b.kind!=="number")throw new tr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${Q.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=or(f),Q=or(_);if(b.kind!=="string"||Q.kind!=="string")return t(d,f,_)}return this.collator?r(d,f,_,this.collator.evaluate(d)):t(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Ic=pa("==",function(i,t,r){return t===r},ql),Oa=pa("!=",function(i,t,r){return t!==r},function(i,t,r,s){return!ql(0,t,r,s)}),fo=pa("<",function(i,t,r){return t<r},function(i,t,r,s){return s.compare(t,r)<0}),Vl=pa(">",function(i,t,r){return t>r},function(i,t,r,s){return s.compare(t,r)>0}),al=pa("<=",function(i,t,r){return t<=r},function(i,t,r,s){return s.compare(t,r)<=0}),ol=pa(">=",function(i,t,r){return t>=r},function(i,t,r,s){return s.compare(t,r)>=0});class rs{constructor(t,r,s){this.type=Fn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,$t);if(!l)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,$t);if(!d)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,li),!f)?null:new rs(l,d,f)}evaluate(t){return new Xo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Fs{constructor(t,r,s,l,d){this.type=li,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,dt);if(!s)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=r.parse(l.locale,1,li),!d))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,li),!f))return null;let _=null;if(l["min-fraction-digits"]&&(_=r.parse(l["min-fraction-digits"],1,dt),!_))return null;let b=null;return l["max-fraction-digits"]&&(b=r.parse(l["max-fraction-digits"],1,dt),!b)?null:new Fs(s,d,f,_,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class zs{constructor(t){this.type=zn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=t.length-1;++f){const _=t[f];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let b=null;if(_["font-scale"]&&(b=r.parse(_["font-scale"],1,dt),!b))return null;let Q=null;if(_["text-font"]&&(Q=r.parse(_["text-font"],1,J(li)),!Q))return null;let M=null;if(_["text-color"]&&(M=r.parse(_["text-color"],1,Wt),!M))return null;const R=l[l.length-1];R.scale=b,R.font=Q,R.textColor=M}else{const b=r.parse(t[f],1,ni);if(!b)return null;const Q=b.type.kind;if(Q!=="string"&&Q!=="value"&&Q!=="null"&&Q!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:b,scale:null,font:null,textColor:null})}}return new zs(l)}evaluate(t){return new Rr(this.sections.map(r=>{const s=r.content.evaluate(t);return or(s)===_n?new el("",s,null,null,null):new el(Aa(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class vs{constructor(t){this.type=_n,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,li);return s?new vs(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=$r.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Gs{constructor(t){this.type=dt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${j(s.type)} instead.`):new Gs(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new tr(`Expected value to be of type string or array, but found ${j(or(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const hr=8192;function bc(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*hr),Math.round(s*l*hr)]}function ll(i,t){const r=Math.pow(2,t.z);return[(l=(i[0]/hr+t.x)/r,360*l-180),(s=(i[1]/hr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function Us(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ws(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Ti(i,t,r){const s=i[0]-t[0],l=i[1]-t[1],d=i[0]-r[0],f=i[1]-r[1];return s*f-d*l==0&&s*d<=0&&l*f<=0}function go(i,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(d=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*d[0]!=0&&!(!hl(i,t,r,s)||!hl(r,s,i,t));var l,d}function vc(i,t,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(go(i,t,s[l],s[l+1]))return!0;return!1}function Ns(i,t,r=!1){let s=!1;for(const _ of t)for(let b=0;b<_.length-1;b++){if(Ti(i,_[b],_[b+1]))return r;(d=_[b])[1]>(l=i)[1]!=(f=_[b+1])[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}var l,d,f;return s}function Hl(i,t){for(const r of t)if(Ns(i,r))return!0;return!1}function cl(i,t){for(const r of i)if(!Ns(r,t))return!1;for(let r=0;r<i.length-1;++r)if(vc(i[r],i[r+1],t))return!1;return!0}function qa(i,t){for(const r of t)if(cl(i,r))return!0;return!1}function hl(i,t,r,s){const l=s[0]-r[0],d=s[1]-r[1],f=(i[0]-r[0])*d-l*(i[1]-r[1]),_=(t[0]-r[0])*d-l*(t[1]-r[1]);return f>0&&_<0||f<0&&_>0}function ma(i,t,r){const s=[];for(let l=0;l<i.length;l++){const d=[];for(let f=0;f<i[l].length;f++){const _=bc(i[l][f],r);Us(t,_),d.push(_)}s.push(d)}return s}function po(i,t,r){const s=[];for(let l=0;l<i.length;l++){const d=ma(i[l],t,r);s.push(d)}return s}function kr(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let d=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;d===0&&(d=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=d}Us(t,i)}function ul(i,t,r,s){const l=Math.pow(2,s.z)*hr,d=[s.x*hr,s.y*hr],f=[];for(const _ of i)for(const b of _){const Q=[b.x+d[0],b.y+d[1]];kr(Q,t,r,l),f.push(Q)}return f}function Al(i,t,r,s){const l=Math.pow(2,s.z)*hr,d=[s.x*hr,s.y*hr],f=[];for(const b of i){const Q=[];for(const M of b){const R=[M.x+d[0],M.y+d[1]];Us(t,R),Q.push(R)}f.push(Q)}if(t[2]-t[0]<=l/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const b of f)for(const Q of b)kr(Q,t,r,l)}var _;return f}class Un{constructor(t,r){this.type=$t,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ps(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const l=[];for(const d of s.features){const{type:f,coordinates:_}=d.geometry;f==="Polygon"&&l.push(_),f==="MultiPolygon"&&l.push(..._)}if(l.length)return new Un(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Un(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Un(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=ma(s.coordinates,d,f),b=ul(r.geometry(),l,d,f);if(!ws(l,d))return!1;for(const Q of b)if(!Ns(Q,_))return!1}if(s.type==="MultiPolygon"){const _=po(s.coordinates,d,f),b=ul(r.geometry(),l,d,f);if(!ws(l,d))return!1;for(const Q of b)if(!Hl(Q,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=ma(s.coordinates,d,f),b=Al(r.geometry(),l,d,f);if(!ws(l,d))return!1;for(const Q of b)if(!cl(Q,_))return!1}if(s.type==="MultiPolygon"){const _=po(s.coordinates,d,f),b=Al(r.geometry(),l,d,f);if(!ws(l,d))return!1;for(const Q of b)if(!qa(Q,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let xs=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const l=i-1>>1,d=t[l];if(r(s,d)>=0)break;t[i]=d,i=l}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,l=t[i];for(;i<s;){let d=1+(i<<1);const f=d+1;if(f<this.length&&r(t[f],t[d])<0&&(d=f),r(t[d],l)>=0)break;t[i]=t[d],i=d}t[i]=l}};function Os(i,t,r,s,l){dl(i,t,r,s||i.length-1,l||xn)}function dl(i,t,r,s,l){for(;s>r;){if(s-r>600){var d=s-r+1,f=t-r+1,_=Math.log(d),b=.5*Math.exp(2*_/3),Q=.5*Math.sqrt(_*b*(d-b)/d)*(f-d/2<0?-1:1);dl(i,t,Math.max(r,Math.floor(t-f*b/d+Q)),Math.min(s,Math.floor(t+(d-f)*b/d+Q)),l)}var M=i[t],R=r,O=s;for(ya(i,r,t),l(i[s],M)>0&&ya(i,r,s);R<O;){for(ya(i,R,O),R++,O--;l(i[R],M)<0;)R++;for(;l(i[O],M)>0;)O--}l(i[r],M)===0?ya(i,r,O):ya(i,++O,s),O<=t&&(r=O+1),t<=O&&(s=O-1)}}function ya(i,t,r){var s=i[t];i[t]=i[r],i[r]=s}function xn(i,t){return i<t?-1:i>t?1:0}function Va(i,t){if(i.length<=1)return[i];const r=[];let s,l;for(const d of i){const f=fl(d);f!==0&&(d.area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),t>1)for(let d=0;d<r.length;d++)r[d].length<=t||(Os(r[d],t,1,r[d].length-1,mo),r[d]=r[d].slice(0,t));return r}function mo(i,t){return t.area-i.area}function fl(i){let t=0;for(let r,s,l=0,d=i.length,f=d-1;l<d;f=l++)r=i[l],s=i[f],t+=(s.x-r.x)*(r.y+s.y);return t}const yo=1/298.257223563,jl=yo*(2-yo),gl=Math.PI/180;class _o{constructor(t){const r=6378.137*gl*1e3,s=Math.cos(t*gl),l=1/(1-jl*(1-s*s)),d=Math.sqrt(l);this.kx=r*d*s,this.ky=r*d*l*(1-jl)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(t,r){let s,l,d,f,_=1/0;for(let b=0;b<t.length-1;b++){let Q=t[b][0],M=t[b][1],R=this.wrap(t[b+1][0]-Q)*this.kx,O=(t[b+1][1]-M)*this.ky,Y=0;R===0&&O===0||(Y=(this.wrap(r[0]-Q)*this.kx*R+(r[1]-M)*this.ky*O)/(R*R+O*O),Y>1?(Q=t[b+1][0],M=t[b+1][1]):Y>0&&(Q+=R/this.kx*Y,M+=O/this.ky*Y)),R=this.wrap(r[0]-Q)*this.kx,O=(r[1]-M)*this.ky;const W=R*R+O*O;W<_&&(_=W,s=Q,l=M,d=b,f=Y)}return{point:[s,l],index:d,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Jl(i,t){return t[0]-i[0]}function Io(i){return i[1]-i[0]+1}function ns(i,t){return i[1]>=i[0]&&i[1]<t}function _a(i,t){if(i[0]>i[1])return[null,null];const r=Io(i);if(t){if(r===2)return[i,null];const l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function pl(i,t){if(!ns(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)Us(r,i[s]);return r}function Ha(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)Us(t,s);return t}function Ia(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ml(i,t,r){if(!Ia(i)||!Ia(t))return NaN;let s=0,l=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[s,l])}function ss(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function yl(i,t,r,s,l){const d=Math.min(ss(i,[r,s],l),ss(t,[r,s],l)),f=Math.min(ss(r,[i,t],l),ss(s,[i,t],l));return Math.min(d,f)}function wc(i,t,r,s,l){if(!ns(t,i.length)||!ns(s,r.length))return 1/0;let d=1/0;for(let f=t[0];f<t[1];++f){const _=i[f],b=i[f+1];for(let Q=s[0];Q<s[1];++Q){const M=r[Q],R=r[Q+1];if(go(_,b,M,R))return 0;d=Math.min(d,yl(_,b,M,R,l))}}return d}function Zi(i,t,r,s,l){if(!ns(t,i.length)||!ns(s,r.length))return NaN;let d=1/0;for(let f=t[0];f<=t[1];++f)for(let _=s[0];_<=s[1];++_)if(d=Math.min(d,l.distance(i[f],r[_])),d===0)return d;return d}function ba(i,t,r){if(Ns(i,t,!0))return 0;let s=1/0;for(const l of t){const d=l[0],f=l[l.length-1];if(d!==f&&(s=Math.min(s,ss(i,[f,d],r)),s===0))return s;const _=r.pointOnLine(l,i);if(s=Math.min(s,r.distance(i,_.point)),s===0)return s}return s}function ci(i,t,r,s){if(!ns(t,i.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Ns(i[d],r,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){const f=i[d],_=i[d+1];for(const b of r)for(let Q=0,M=b.length,R=M-1;Q<M;R=Q++){const O=b[R],Y=b[Q];if(go(f,_,O,Y))return 0;l=Math.min(l,yl(f,_,O,Y,s))}}return l}function bo(i,t){for(const r of i)for(const s of r)if(Ns(s,t,!0))return!0;return!1}function Ui(i,t,r,s=1/0){const l=Ha(i),d=Ha(t);if(s!==1/0&&ml(l,d,r)>=s)return s;if(ws(l,d)){if(bo(i,t))return 0}else if(bo(t,i))return 0;let f=1/0;for(const _ of i)for(let b=0,Q=_.length,M=Q-1;b<Q;M=b++){const R=_[M],O=_[b];for(const Y of t)for(let W=0,ee=Y.length,me=ee-1;W<ee;me=W++){const ve=Y[me],Re=Y[W];if(go(R,O,ve,Re))return 0;f=Math.min(f,yl(R,O,ve,Re,r))}}return f}function Fi(i,t,r,s,l,d){if(!d)return;const f=ml(pl(s,d),l,r);f<t&&i.push([f,d,[0,0]])}function Nn(i,t,r,s,l,d,f){if(!d||!f)return;const _=ml(pl(s,d),pl(l,f),r);_<t&&i.push([_,d,f])}function On(i,t,r,s,l=1/0){let d=Math.min(s.distance(i[0],r[0][0]),l);if(d===0)return d;const f=new xs([[0,[0,i.length-1],[0,0]]],Jl),_=Ha(r);for(;f.length>0;){const b=f.pop();if(b[0]>=d)continue;const Q=b[1],M=t?50:100;if(Io(Q)<=M){if(!ns(Q,i.length))return NaN;if(t){const R=ci(i,Q,r,s);if(isNaN(R)||R===0)return R;d=Math.min(d,R)}else for(let R=Q[0];R<=Q[1];++R){const O=ba(i[R],r,s);if(d=Math.min(d,O),d===0)return 0}}else{const R=_a(Q,t);Fi(f,d,s,i,_,R[0]),Fi(f,d,s,i,_,R[1])}}return d}function va(i,t,r,s,l,d=1/0){let f=Math.min(d,l.distance(i[0],r[0]));if(f===0)return f;const _=new xs([[0,[0,i.length-1],[0,r.length-1]]],Jl);for(;_.length>0;){const b=_.pop();if(b[0]>=f)continue;const Q=b[1],M=b[2],R=t?50:100,O=s?50:100;if(Io(Q)<=R&&Io(M)<=O){if(!ns(Q,i.length)&&ns(M,r.length))return NaN;let Y;if(t&&s)Y=wc(i,Q,r,M,l),f=Math.min(f,Y);else if(t&&!s){const W=i.slice(Q[0],Q[1]+1);for(let ee=M[0];ee<=M[1];++ee)if(Y=ss(r[ee],W,l),f=Math.min(f,Y),f===0)return f}else if(!t&&s){const W=r.slice(M[0],M[1]+1);for(let ee=Q[0];ee<=Q[1];++ee)if(Y=ss(i[ee],W,l),f=Math.min(f,Y),f===0)return f}else Y=Zi(i,Q,r,M,l),f=Math.min(f,Y)}else{const Y=_a(Q,t),W=_a(M,s);Nn(_,f,l,i,r,Y[0],W[0]),Nn(_,f,l,i,r,Y[0],W[1]),Nn(_,f,l,i,r,Y[1],W[0]),Nn(_,f,l,i,r,Y[1],W[1])}}return f}function _l(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class qn{constructor(t,r){this.type=dt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ps(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new qn(s,s.features.map(l=>_l(l.geometry)).flat());if(s.type==="Feature")return new qn(s,_l(s.geometry));if("type"in s&&"coordinates"in s)return new qn(s,_l(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=r.geometry(),d=l.flat().map(b=>ll([b.x,b.y],r.canonical));if(l.length===0)return NaN;const f=new _o(d[0][1]);let _=1/0;for(const b of s){switch(b.type){case"Point":_=Math.min(_,va(d,!1,[b.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,va(d,!1,b.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,On(d,!1,b.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=r.geometry(),d=l.flat().map(b=>ll([b.x,b.y],r.canonical));if(l.length===0)return NaN;const f=new _o(d[0][1]);let _=1/0;for(const b of s){switch(b.type){case"Point":_=Math.min(_,va(d,!0,[b.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,va(d,!0,b.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,On(d,!0,b.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const d=Va(l,0).map(b=>b.map(Q=>Q.map(M=>ll([M.x,M.y],r.canonical)))),f=new _o(d[0][0][0][1]);let _=1/0;for(const b of s)for(const Q of d){switch(b.type){case"Point":_=Math.min(_,On([b.coordinates],!1,Q,f,_));break;case"LineString":_=Math.min(_,On(b.coordinates,!0,Q,f,_));break;case"Polygon":_=Math.min(_,Ui(Q,b.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Bs={"==":Ic,"!=":Oa,">":Vl,"<":fo,">=":ol,"<=":al,array:Wr,at:fa,boolean:Wr,case:wn,coalesce:Ao,collator:rs,format:zs,image:vs,in:rl,"index-of":Is,interpolate:zr,"interpolate-hcl":zr,"interpolate-lab":zr,length:Gs,let:Xr,literal:bn,match:ho,number:Wr,"number-format":Fs,object:Wr,slice:is,step:ga,string:Wr,"to-boolean":vn,"to-color":vn,"to-number":vn,"to-string":vn,var:Di,within:Un,distance:qn};class en{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],l=en.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,_=f.filter(([Q])=>!Array.isArray(Q)||Q.length===t.length-1);let b=null;for(const[Q,M]of _){b=new ts(r.registry,wa,r.path,null,r.scope);const R=[];let O=!1;for(let Y=1;Y<t.length;Y++){const W=t[Y],ee=Array.isArray(Q)?Q[Y-1]:Q.type,me=b.parse(W,1+R.length,ee);if(!me){O=!0;break}R.push(me)}if(!O)if(Array.isArray(Q)&&Q.length!==R.length)b.error(`Expected ${Q.length} arguments, but found ${R.length} instead.`);else{for(let Y=0;Y<R.length;Y++){const W=Array.isArray(Q)?Q[Y]:Q.type,ee=R[Y];b.concat(Y+1).checkSubtype(W,ee.type)}if(b.errors.length===0)return new en(s,d,M,R)}}if(_.length===1)r.errors.push(...b.errors);else{const Q=(_.length?_:f).map(([R])=>{return O=R,Array.isArray(O)?`(${O.map(j).join(", ")})`:`(${j(O.type)}...)`;var O}).join(" | "),M=[];for(let R=1;R<t.length;R++){const O=r.parse(t[R],1+M.length);if(!O)return null;M.push(j(O.type))}r.error(`Expected arguments of type ${Q}, but found (${M.join(", ")}) instead.`)}return null}static register(t,r){en.definitions=r;for(const s in r)t[s]=en}}function vo(i,[t,r,s,l]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const d=l?l.evaluate(i):1,f=ua(t,r,s,d);if(f)throw new tr(f);return new Ri(t/255,r/255,s/255,d,!1)}function wo(i,t){return i in t}function ja(i,t){const r=t[i];return r===void 0?null:r}function Cs(i){return{type:i}}function wa(i){if(i instanceof Di)return wa(i.boundExpression);if(i instanceof en&&i.name==="error"||i instanceof rs||i instanceof Un||i instanceof qn)return!1;const t=i instanceof vn||i instanceof Wr;let r=!0;return i.eachChild(s=>{r=t?r&&wa(s):r&&s instanceof bn}),!!r&&xa(i)&&Ja(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function xa(i){if(i instanceof en&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Un||i instanceof qn)return!1;let t=!0;return i.eachChild(r=>{t&&!xa(r)&&(t=!1)}),t}function qs(i){if(i instanceof en&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!qs(r)&&(t=!1)}),t}function Ja(i,t){if(i instanceof en&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!Ja(s,t)&&(r=!1)}),r}function xo(i){return{result:"success",value:i}}function Ba(i){return{result:"error",value:i}}function Vs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Il(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Bo(i){return!!i.expression&&i.expression.interpolated}function Bi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Co(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function xc(i){return i}function bl(i,t){const r=t.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),d=i.type||(Bo(t)?"exponential":"interval");if(r||t.type==="padding"){const M=r?Ri.parse:Zr.parse;(i=Ln({},i)).stops&&(i.stops=i.stops.map(R=>[R[0],M(R[1])])),i.default=M(i.default?i.default:t.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let _,b,Q;if(d==="exponential")_=Kl;else if(d==="interval")_=Eo;else if(d==="categorical"){_=Yl,b=Object.create(null);for(const M of i.stops)b[M[0]]=M[1];Q=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);_=Qo}if(s){const M={},R=[];for(let W=0;W<i.stops.length;W++){const ee=i.stops[W],me=ee[0].zoom;M[me]===void 0&&(M[me]={zoom:me,type:i.type,property:i.property,default:i.default,stops:[]},R.push(me)),M[me].stops.push([ee[0].value,ee[1]])}const O=[];for(const W of R)O.push([M[W].zoom,bl(M[W],t)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:zr.interpolationFactor.bind(void 0,Y),zoomStops:O.map(W=>W[0]),evaluate:({zoom:W},ee)=>Kl({stops:O,base:i.base},t,W).evaluate(W,ee)}}if(l){const M=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:zr.interpolationFactor.bind(void 0,M),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(i,t,R,b,Q)}}return{kind:"source",evaluate(M,R){const O=R&&R.properties?R.properties[i.property]:void 0;return O===void 0?Gr(i.default,t.default):_(i,t,O,b,Q)}}}function Gr(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Yl(i,t,r,s,l){return Gr(typeof r===l?s[r]:void 0,i.default,t.default)}function Eo(i,t,r){if(Bi(r)!=="number")return Gr(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=Ls(i.stops.map(d=>d[0]),r);return i.stops[l][1]}function Kl(i,t,r){const s=i.base!==void 0?i.base:1;if(Bi(r)!=="number")return Gr(i.default,t.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const d=Ls(i.stops.map(M=>M[0]),r),f=function(M,R,O,Y){const W=Y-O,ee=M-O;return W===0?0:R===1?ee/W:(Math.pow(R,ee)-1)/(Math.pow(R,W)-1)}(r,s,i.stops[d][0],i.stops[d+1][0]),_=i.stops[d][1],b=i.stops[d+1][1],Q=_r[t.type]||xc;return typeof _.evaluate=="function"?{evaluate(...M){const R=_.evaluate.apply(void 0,M),O=b.evaluate.apply(void 0,M);if(R!==void 0&&O!==void 0)return Q(R,O,f,i.colorSpace)}}:Q(_,b,f,i.colorSpace)}function Qo(i,t,r){switch(t.type){case"color":r=Ri.parse(r);break;case"formatted":r=Rr.fromString(r.toString());break;case"resolvedImage":r=$r.fromString(r.toString());break;case"padding":r=Zr.parse(r);break;default:Bi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Gr(r,i.default,t.default)}en.register(Bs,{error:[{kind:"error"},[li],(i,[t])=>{throw new tr(t.evaluate(i))}],typeof:[li,[ni],(i,[t])=>j(or(t.evaluate(i)))],"to-rgba":[J(dt,4),[Wt],(i,[t])=>{const[r,s,l,d]=t.evaluate(i).rgb;return[255*r,255*s,255*l,d]}],rgb:[Wt,[dt,dt,dt],vo],rgba:[Wt,[dt,dt,dt,dt],vo],has:{type:$t,overloads:[[[li],(i,[t])=>wo(t.evaluate(i),i.properties())],[[li,un],(i,[t,r])=>wo(t.evaluate(i),r.evaluate(i))]]},get:{type:ni,overloads:[[[li],(i,[t])=>ja(t.evaluate(i),i.properties())],[[li,un],(i,[t,r])=>ja(t.evaluate(i),r.evaluate(i))]]},"feature-state":[ni,[li],(i,[t])=>ja(t.evaluate(i),i.featureState||{})],properties:[un,[],i=>i.properties()],"geometry-type":[li,[],i=>i.geometryType()],id:[ni,[],i=>i.id()],zoom:[dt,[],i=>i.globals.zoom],"heatmap-density":[dt,[],i=>i.globals.heatmapDensity||0],"line-progress":[dt,[],i=>i.globals.lineProgress||0],accumulated:[ni,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[dt,Cs(dt),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[dt,Cs(dt),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:dt,overloads:[[[dt,dt],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[dt],(i,[t])=>-t.evaluate(i)]]},"/":[dt,[dt,dt],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[dt,[dt,dt],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[dt,[dt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[dt,[dt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[dt,[dt],(i,[t])=>Math.log(t.evaluate(i))],log2:[dt,[dt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[dt,[dt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[dt,[dt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[dt,[dt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[dt,[dt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[dt,[dt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[dt,[dt],(i,[t])=>Math.atan(t.evaluate(i))],min:[dt,Cs(dt),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[dt,Cs(dt),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[dt,[dt],(i,[t])=>Math.abs(t.evaluate(i))],round:[dt,[dt],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[dt,[dt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[dt,[dt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[$t,[li,ni],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[$t,[ni],(i,[t])=>i.id()===t.value],"filter-type-==":[$t,[li],(i,[t])=>i.geometryType()===t.value],"filter-<":[$t,[li,ni],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[$t,[ni],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[$t,[li,ni],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[$t,[ni],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[$t,[li,ni],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[$t,[ni],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[$t,[li,ni],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[$t,[ni],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[$t,[ni],(i,[t])=>t.value in i.properties()],"filter-has-id":[$t,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[$t,[J(li)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[$t,[J(ni)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[$t,[li,J(ni)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[$t,[li,J(ni)],(i,[t,r])=>function(s,l,d,f){for(;d<=f;){const _=d+f>>1;if(l[_]===s)return!0;l[_]>s?f=_-1:d=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Cs($t),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Cs($t),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[$t,[$t],(i,[t])=>!t.evaluate(i)],"is-supported-script":[$t,[li],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[li,[li],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[li,[li],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[li,Cs(ni),(i,t)=>t.map(r=>Aa(r.evaluate(i))).join("")],"resolved-locale":[li,[Fn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ca{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new Gn,this._defaultValue=r?(s=r).type==="color"&&Co(s.default)?new Ri(0,0,0,0):s.type==="color"?Ri.parse(s.default)||null:s.type==="padding"?Zr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Fr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,d,f){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new tr(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function ko(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Bs}function Ea(i,t){const r=new ts(Bs,wa,[],t?function(l){const d={color:Wt,string:li,number:dt,enum:li,boolean:$t,formatted:zn,padding:es,resolvedImage:_n,variableAnchorOffsetCollection:_e};return l.type==="array"?J(d[l.value]||ni,l.length):d[l.type]}(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?xo(new Ca(s,t)):Ba(r.errors)}class Vn{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!qs(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,f)}evaluate(t,r,s,l,d,f){return this._styleExpression.evaluate(t,r,s,l,d,f)}}class as{constructor(t,r,s,l){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!qs(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,f)}evaluate(t,r,s,l,d,f){return this._styleExpression.evaluate(t,r,s,l,d,f)}interpolationFactor(t,r,s){return this.interpolationType?zr.interpolationFactor(this.interpolationType,t,r,s):0}}function Qa(i,t){const r=Ea(i,t);if(r.result==="error")return r;const s=r.value.expression,l=xa(s);if(!l&&!Vs(t))return Ba([new xr("","data expressions not supported")]);const d=Ja(s,["zoom"]);if(!d&&!Il(t))return Ba([new xr("","zoom expressions not supported")]);const f=Es(s);return f||d?f instanceof xr?Ba([f]):f instanceof zr&&!Bo(t)?Ba([new xr("",'"interpolate" expressions cannot be used with this property')]):xo(f?new as(l?"camera":"composite",r.value,f.labels,f instanceof zr?f.interpolation:void 0):new Vn(l?"constant":"source",r.value)):Ba([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class os{constructor(t,r){this._parameters=t,this._specification=r,Ln(this,bl(this._parameters,this._specification))}static deserialize(t){return new os(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Es(i){let t=null;if(i instanceof Xr)t=Es(i.result);else if(i instanceof Ao){for(const r of i.args)if(t=Es(r),t)break}else(i instanceof ga||i instanceof zr)&&i.input instanceof en&&i.input.name==="zoom"&&(t=i);return t instanceof xr||i.eachChild(r=>{const s=Es(r);s instanceof xr?t=s:!t&&s?t=new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Hs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Hs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const js={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Qs(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Hs(i)||(i=Do(i));const t=Ea(i,js);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>t.value.evaluate(r,s,{},l),needGeometry:vl(i)}}function So(i,t){return i<t?-1:i>t?1:0}function vl(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(vl(i[t]))return!0;return!1}function Do(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?wl(i[1],i[2],"=="):t==="!="?ir(wl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?wl(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Do))):t==="all"?["all"].concat(i.slice(1).map(Do)):t==="none"?["all"].concat(i.slice(1).map(Do).map(ir)):t==="in"?Ya(i[1],i.slice(2)):t==="!in"?ir(Ya(i[1],i.slice(2))):t==="has"?Ka(i[1]):t!=="!has"||ir(Ka(i[1]));var r}function wl(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Ya(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(So)]]:["filter-in-small",i,["literal",t]]}}function Ka(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ir(i){return["!",i]}function Js(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const d of i)l+=`${Js(d)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${Js(i[r[l]])},`;return`${s}}`}function Zl(i){let t="";for(const r of cr)t+=`/${Js(i[r])}`;return t}function $l(i){const t=i.value;return t?[new gt(i.key,t,"constants have been deprecated as of v8")]:[]}function Xi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Bn(i){if(Array.isArray(i))return i.map(Bn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=Bn(i[r]);return t}return Xi(i)}function tn(i){const t=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},d=i.style,f=i.styleSpec,_=i.validateSpec;let b=[];const Q=Bi(r);if(Q!=="object")return[new gt(t,r,`object expected, ${Q} found`)];for(const M in r){const R=M.split(".")[0],O=s[R]||s["*"];let Y;if(l[R])Y=l[R];else if(s[R])Y=_;else if(l["*"])Y=l["*"];else{if(!s["*"]){b.push(new gt(t,r[M],`unknown property "${M}"`));continue}Y=_}b=b.concat(Y({key:(t&&`${t}.`)+M,value:r[M],valueSpec:O,style:d,styleSpec:f,object:r,objectKey:M,validateSpec:_},r))}for(const M in s)l[M]||s[M].required&&s[M].default===void 0&&r[M]===void 0&&b.push(new gt(t,r,`missing required property "${M}"`));return b}function Za(i){const t=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,d=i.key,f=i.arrayElementValidator||i.validateSpec;if(Bi(t)!=="array")return[new gt(d,t,`array expected, ${Bi(t)} found`)];if(r.length&&t.length!==r.length)return[new gt(d,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new gt(d,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};l.$version<7&&(_.function=r.function),Bi(r.value)==="object"&&(_=r.value);let b=[];for(let Q=0;Q<t.length;Q++)b=b.concat(f({array:t,arrayIndex:Q,value:t[Q],valueSpec:_,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${d}[${Q}]`}));return b}function $a(i){const t=i.key,r=i.value,s=i.valueSpec;let l=Bi(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new gt(t,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new gt(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new gt(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Mo(i){const t=i.valueSpec,r=Xi(i.value.type);let s,l,d,f={};const _=r!=="categorical"&&i.value.property===void 0,b=!_,Q=Bi(i.value.stops)==="array"&&Bi(i.value.stops[0])==="array"&&Bi(i.value.stops[0][0])==="object",M=tn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Y){if(r==="identity")return[new gt(Y.key,Y.value,'identity function may not have a "stops" property')];let W=[];const ee=Y.value;return W=W.concat(Za({key:Y.key,value:ee,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:R})),Bi(ee)==="array"&&ee.length===0&&W.push(new gt(Y.key,ee,"array must have at least one stop")),W},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:t,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return r==="identity"&&_&&M.push(new gt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||M.push(new gt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Bo(i.valueSpec)&&M.push(new gt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Vs(i.valueSpec)?M.push(new gt(i.key,i.value,"property functions not supported")):_&&!Il(i.valueSpec)&&M.push(new gt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!Q||i.value.property!==void 0||M.push(new gt(i.key,i.value,'"property" property is required')),M;function R(Y){let W=[];const ee=Y.value,me=Y.key;if(Bi(ee)!=="array")return[new gt(me,ee,`array expected, ${Bi(ee)} found`)];if(ee.length!==2)return[new gt(me,ee,`array length 2 expected, length ${ee.length} found`)];if(Q){if(Bi(ee[0])!=="object")return[new gt(me,ee,`object expected, ${Bi(ee[0])} found`)];if(ee[0].zoom===void 0)return[new gt(me,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new gt(me,ee,"object stop key must have value")];if(d&&d>Xi(ee[0].zoom))return[new gt(me,ee[0].zoom,"stop zoom values must appear in ascending order")];Xi(ee[0].zoom)!==d&&(d=Xi(ee[0].zoom),l=void 0,f={}),W=W.concat(tn({key:`${me}[0]`,value:ee[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:$a,value:O}}))}else W=W.concat(O({key:`${me}[0]`,value:ee[0],validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},ee));return ko(Bn(ee[1]))?W.concat([new gt(`${me}[1]`,ee[1],"expressions are not allowed in function stops.")]):W.concat(Y.validateSpec({key:`${me}[1]`,value:ee[1],valueSpec:t,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function O(Y,W){const ee=Bi(Y.value),me=Xi(Y.value),ve=Y.value!==null?Y.value:W;if(s){if(ee!==s)return[new gt(Y.key,ve,`${ee} stop domain type must match previous stop domain type ${s}`)]}else s=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new gt(Y.key,ve,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&r!=="categorical"){let Re=`number expected, ${ee} found`;return Vs(t)&&r===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gt(Y.key,ve,Re)]}return r!=="categorical"||ee!=="number"||isFinite(me)&&Math.floor(me)===me?r!=="categorical"&&ee==="number"&&l!==void 0&&me<l?[new gt(Y.key,ve,"stop domain values must appear in ascending order")]:(l=me,r==="categorical"&&me in f?[new gt(Y.key,ve,"stop domain values must be unique")]:(f[me]=!0,[])):[new gt(Y.key,ve,`integer expected, found ${me}`)]}}function Sr(i){const t=(i.expressionContext==="property"?Qa:Ea)(Bn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(s=>new gt(`${i.key}${s.key}`,i.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new gt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!qs(r))return[new gt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!qs(r))return[new gt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ja(r,["zoom","feature-state"]))return[new gt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!xa(r))return[new gt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cn(i){const t=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Xi(r))===-1&&l.push(new gt(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Xi(r))===-1&&l.push(new gt(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function To(i){return Hs(Bn(i.value))?Sr(Ln({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Po(i)}function Po(i){const t=i.value,r=i.key;if(Bi(t)!=="array")return[new gt(r,t,`array expected, ${Bi(t)} found`)];const s=i.styleSpec;let l,d=[];if(t.length<1)return[new gt(r,t,"filter array must have at least 1 element")];switch(d=d.concat(Cn({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Xi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Xi(t[1])==="$type"&&d.push(new gt(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new gt(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Bi(t[1]),l!=="string"&&d.push(new gt(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let f=2;f<t.length;f++)l=Bi(t[f]),Xi(t[1])==="$type"?d=d.concat(Cn({key:`${r}[${f}]`,value:t[f],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new gt(`${r}[${f}]`,t[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)d=d.concat(Po({key:`${r}[${f}]`,value:t[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Bi(t[1]),t.length!==2?d.push(new gt(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new gt(`${r}[1]`,t[1],`string expected, ${l} found`))}return d}function Lo(i,t){const r=i.key,s=i.validateSpec,l=i.style,d=i.styleSpec,f=i.value,_=i.objectKey,b=d[`${t}_${i.layerType}`];if(!b)return[];const Q=_.match(/^(.*)-transition$/);if(t==="paint"&&Q&&b[Q[1]]&&b[Q[1]].transition)return s({key:r,value:f,valueSpec:d.transition,style:l,styleSpec:d});const M=i.valueSpec||b[_];if(!M)return[new gt(r,f,`unknown property "${_}"`)];let R;if(Bi(f)==="string"&&Vs(M)&&!M.tokens&&(R=/^{([^}]+)}$/.exec(f)))return[new gt(r,f,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const O=[];return i.layerType==="symbol"&&(_==="text-field"&&l&&!l.glyphs&&O.push(new gt(r,f,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Co(Bn(f))&&Xi(f.type)==="identity"&&O.push(new gt(r,f,'"text-font" does not support identity functions'))),O.concat(s({key:i.key,value:f,valueSpec:M,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:_}))}function Wa(i){return Lo(i,"paint")}function Ys(i){return Lo(i,"layout")}function Xa(i){let t=[];const r=i.value,s=i.key,l=i.style,d=i.styleSpec;r.type||r.ref||t.push(new gt(s,r,'either "type" or "ref" is required'));let f=Xi(r.type);const _=Xi(r.ref);if(r.id){const b=Xi(r.id);for(let Q=0;Q<i.arrayIndex;Q++){const M=l.layers[Q];Xi(M.id)===b&&t.push(new gt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${M.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(Q=>{Q in r&&t.push(new gt(s,r[Q],`"${Q}" is prohibited for ref layers`))}),l.layers.forEach(Q=>{Xi(Q.id)===_&&(b=Q)}),b?b.ref?t.push(new gt(s,r.ref,"ref cannot reference another ref layer")):f=Xi(b.type):t.push(new gt(s,r.ref,`ref layer "${_}" not found`))}else if(f!=="background")if(r.source){const b=l.sources&&l.sources[r.source],Q=b&&Xi(b.type);b?Q==="vector"&&f==="raster"?t.push(new gt(s,r.source,`layer "${r.id}" requires a raster source`)):Q!=="raster-dem"&&f==="hillshade"?t.push(new gt(s,r.source,`layer "${r.id}" requires a raster-dem source`)):Q==="raster"&&f!=="raster"?t.push(new gt(s,r.source,`layer "${r.id}" requires a vector source`)):Q!=="vector"||r["source-layer"]?Q==="raster-dem"&&f!=="hillshade"?t.push(new gt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||Q==="geojson"&&b.lineMetrics||t.push(new gt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new gt(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new gt(s,r.source,`source "${r.source}" not found`))}else t.push(new gt(s,r,'missing required property "source"'));return t=t.concat(tn({key:s,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:To,layout:b=>tn({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":Q=>Ys(Ln({layerType:f},Q))}}),paint:b=>tn({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":Q=>Wa(Ln({layerType:f},Q))}})}})),t}function Ks(i){const t=i.value,r=i.key,s=Bi(t);return s!=="string"?[new gt(r,t,`string expected, ${s} found`)]:[]}const Zs={promoteId:function({key:i,value:t}){if(Bi(t)==="string")return Ks({key:i,value:t});{const r=[];for(const s in t)r.push(...Ks({key:`${i}.${s}`,value:t[s]}));return r}}};function eo(i){const t=i.value,r=i.key,s=i.styleSpec,l=i.style,d=i.validateSpec;if(!t.type)return[new gt(r,t,'"type" is required')];const f=Xi(t.type);let _;switch(f){case"vector":case"raster":return _=tn({key:r,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Zs,validateSpec:d}),_;case"raster-dem":return _=function(b){var Q;const M=(Q=b.sourceName)!==null&&Q!==void 0?Q:"",R=b.value,O=b.styleSpec,Y=O.source_raster_dem,W=b.style;let ee=[];const me=Bi(R);if(R===void 0)return ee;if(me!=="object")return ee.push(new gt("source_raster_dem",R,`object expected, ${me} found`)),ee;const ve=Xi(R.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],Ee=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const Pe in R)!ve&&Re.includes(Pe)?ee.push(new gt(Pe,R[Pe],`In "${M}": "${Pe}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):Y[Pe]?ee=ee.concat(b.validateSpec({key:Pe,value:R[Pe],valueSpec:Y[Pe],validateSpec:b.validateSpec,style:W,styleSpec:O})):ee.push(new gt(Pe,R[Pe],`unknown property "${Pe}"`));return ee}({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:d}),_;case"geojson":if(_=tn({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:d,objectElementValidators:Zs}),t.cluster)for(const b in t.clusterProperties){const[Q,M]=t.clusterProperties[b],R=typeof Q=="string"?[Q,["accumulated"],["get",b]]:Q;_.push(...Sr({key:`${r}.${b}.map`,value:M,expressionContext:"cluster-map"})),_.push(...Sr({key:`${r}.${b}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return tn({key:r,value:t,valueSpec:s.source_video,style:l,validateSpec:d,styleSpec:s});case"image":return tn({key:r,value:t,valueSpec:s.source_image,style:l,validateSpec:d,styleSpec:s});case"canvas":return[new gt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ka(i){const t=i.value,r=i.styleSpec,s=r.light,l=i.style;let d=[];const f=Bi(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new gt("light",t,`object expected, ${f} found`)]),d;for(const _ in t){const b=_.match(/^(.*)-transition$/);d=d.concat(b&&s[b[1]]&&s[b[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new gt(_,t[_],`unknown property "${_}"`)])}return d}function xl(i){const t=i.value,r=i.styleSpec,s=r.sky,l=i.style,d=Bi(t);if(t===void 0)return[];if(d!=="object")return[new gt("sky",t,`object expected, ${d} found`)];let f=[];for(const _ in t)f=f.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:l,styleSpec:r}):[new gt(_,t[_],`unknown property "${_}"`)]);return f}function Bl(i){const t=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let d=[];const f=Bi(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new gt("terrain",t,`object expected, ${f} found`)]),d;for(const _ in t)d=d.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new gt(_,t[_],`unknown property "${_}"`)]);return d}function Cl(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],d=[];for(const f in r)r[f].id&&l.includes(r[f].id)&&t.push(new gt(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),l.push(r[f].id),r[f].url&&d.includes(r[f].url)&&t.push(new gt(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),t=t.concat(tn({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ks({key:s,value:r})}const Ro={"*":()=>[],array:Za,boolean:function(i){const t=i.value,r=i.key,s=Bi(t);return s!=="boolean"?[new gt(r,t,`boolean expected, ${s} found`)]:[]},number:$a,color:function(i){const t=i.key,r=i.value,s=Bi(r);return s!=="string"?[new gt(t,r,`color expected, ${s} found`)]:Ri.parse(String(r))?[]:[new gt(t,r,`color expected, "${r}" found`)]},constants:$l,enum:Cn,filter:To,function:Mo,layer:Xa,object:tn,source:eo,light:ka,sky:xl,terrain:Bl,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,l=i.style,d=Bi(t);if(t===void 0)return[];if(d!=="object")return[new gt("projection",t,`object expected, ${d} found`)];let f=[];for(const _ in t)f=f.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:l,styleSpec:r}):[new gt(_,t[_],`unknown property "${_}"`)]);return f},string:Ks,formatted:function(i){return Ks(i).length===0?[]:Sr(i)},resolvedImage:function(i){return Ks(i).length===0?[]:Sr(i)},padding:function(i){const t=i.key,r=i.value;if(Bi(r)==="array"){if(r.length<1||r.length>4)return[new gt(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let d=0;d<r.length;d++)l=l.concat(i.validateSpec({key:`${t}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return l}return $a({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=Bi(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new gt(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(Cn({key:`${t}[${f}]`,value:r[f],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(Za({key:`${t}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return d},sprite:Cl};function ls(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=ls,r.expression&&Co(Xi(t))?Mo(i):r.expression&&ko(Bn(t))?Sr(i):r.type&&Ro[r.type]?Ro[r.type](i):tn(Ln({},i,{valueSpec:r.type?s[r.type]:r}))}function El(i){const t=i.value,r=i.key,s=Ks(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new gt(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new gt(r,t,'"glyphs" url must include a "{range}" token'))),s}function An(i,t=qe){let r=[];return r=r.concat(ls({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:ls,objectElementValidators:{glyphs:El,"*":()=>[]}})),i.constants&&(r=r.concat($l({key:"constants",value:i.constants}))),cs(r)}function rn(i){return function(t){return i({...t,validateSpec:ls})}}function cs(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function En(i){return function(...t){return cs(i.apply(this,t))}}An.source=En(rn(eo)),An.sprite=En(rn(Cl)),An.glyphs=En(rn(El)),An.light=En(rn(ka)),An.sky=En(rn(xl)),An.terrain=En(rn(Bl)),An.layer=En(rn(Xa)),An.filter=En(rn(To)),An.paintProperty=En(rn(Wa)),An.layoutProperty=En(rn(Ys));const $s=An,dn=$s.light,Wl=$s.sky,Ql=$s.paintProperty,Xl=$s.layoutProperty;function Fo(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new zi(new Error(s.message))),r=!0;return r}class hs{constructor(t,r,s){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let b=0;b<this.d*this.d;b++){const Q=f[3+b],M=f[3+b+1];l.push(Q===M?null:f.subarray(Q,M))}const _=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const d=s/r*t;this.min=-d,this.max=t+d}insert(t,r,s,l,d){this._forEachCell(r,s,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,l,d,f){this.cells[d].push(f)}query(t,r,s,l,d){const f=this.min,_=this.max;if(t<=f&&r<=f&&_<=s&&_<=l&&!d)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,r,s,l,this._queryCell,b,{},d),b}}_queryCell(t,r,s,l,d,f,_,b){const Q=this.cells[d];if(Q!==null){const M=this.keys,R=this.bboxes;for(let O=0;O<Q.length;O++){const Y=Q[O];if(_[Y]===void 0){const W=4*Y;(b?b(R[W+0],R[W+1],R[W+2],R[W+3]):t<=R[W+2]&&r<=R[W+3]&&s>=R[W+0]&&l>=R[W+1])?(_[Y]=!0,f.push(M[Y])):_[Y]=!1}}}}_forEachCell(t,r,s,l,d,f,_,b){const Q=this._convertToCellCoord(t),M=this._convertToCellCoord(r),R=this._convertToCellCoord(s),O=this._convertToCellCoord(l);for(let Y=Q;Y<=R;Y++)for(let W=M;W<=O;W++){const ee=this.d*W+Y;if((!b||b(this._convertFromCellCoord(Y),this._convertFromCellCoord(W),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(W+1)))&&d.call(this,t,r,s,l,ee,f,_,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=r;for(let f=0;f<t.length;f++){const _=t[f];l[3+f]=d,l.set(_,d),d+=_.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new hs(t.buffer)}}const Dr={};function Bt(i,t,r={}){if(Dr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Dr[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Bt("Object",Object),Bt("TransferableGridIndex",hs),Bt("Color",Ri),Bt("Error",Error),Bt("AJAXError",ii),Bt("ResolvedImage",$r),Bt("StylePropertyFunction",os),Bt("StyleExpression",Ca,{omit:["_evaluator"]}),Bt("ZoomDependentExpression",as),Bt("ZoomConstantExpression",Vn),Bt("CompoundExpression",en,{omit:["_evaluate"]});for(const i in Bs)Bs[i]._classRegistryKey||Bt(`Expression_${i}`,Bs[i]);function Sa(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function to(i){return i.$name||i.constructor._classRegistryKey}function io(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=to(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Sa(i)||Mt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function us(i,t){if(io(i))return(Sa(i)||Mt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const d=[];for(const f of i)d.push(us(f,t));return d}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=to(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Dr[r])throw new Error(`${r} is not registered.`);const{klass:s}=Dr[r],l=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||Dr[r].omit.indexOf(d)>=0)continue;const f=i[d];l[d]=Dr[r].shallow.indexOf(d)>=0?f:us(f,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function ks(i){if(io(i))return i;if(Array.isArray(i))return i.map(ks);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=to(i)||"Object";if(!Dr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Dr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const d=i[l];s[l]=Dr[t].shallow.indexOf(l)>=0?d:ks(d)}return s}class qi{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const gi={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function kl(i){for(const t of i)if(ro(t.charCodeAt(0)))return!0;return!1}function Ws(i){for(const t of i)if(!Xs(t.charCodeAt(0)))return!1;return!0}function zo(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const ec=zo(["Arab","Dupl","Mong","Ougr","Syrc"]);function Xs(i){return!ec.test(String.fromCodePoint(i))}const Sl=zo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ro(i){return!(i!==746&&i!==747&&(i<4352||!(gi["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||gi["CJK Compatibility"](i)||gi["CJK Strokes"](i)||!(!gi["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||gi["Enclosed CJK Letters and Months"](i)||gi["Ideographic Description Characters"](i)||gi.Kanbun(i)||gi.Katakana(i)&&i!==12540||!(!gi["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!gi["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||gi["Vertical Forms"](i)||gi["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Sl.test(String.fromCodePoint(i)))))}function Go(i){return!(ro(i)||function(t){return!!(gi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||gi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||gi["Letterlike Symbols"](t)||gi["Number Forms"](t)||gi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||gi["Control Pictures"](t)&&t!==9251||gi["Optical Character Recognition"](t)||gi["Enclosed Alphanumerics"](t)||gi["Geometric Shapes"](t)||gi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||gi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||gi["CJK Symbols and Punctuation"](t)||gi.Katakana(t)||gi["Private Use Area"](t)||gi["CJK Compatibility Forms"](t)||gi["Small Form Variants"](t)||gi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const tc=zo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Dl(i){return tc.test(String.fromCodePoint(i))}function ic(i,t){return!(!t&&Dl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||gi.Khmer(i))}function Bc(i){for(const t of i)if(Dl(t.charCodeAt(0)))return!0;return!1}const rr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Vi{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qi,this.transition={})}isSupportedScript(t){return function(r,s){for(const l of r)if(!ic(l.charCodeAt(0),s))return!1;return!0}(t,rr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class ea{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,l){if(Co(s))return new os(s,l);if(ko(s)){const d=Qa(s,l);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return l.type==="color"&&typeof s=="string"?d=Ri.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(d=Fr.parse(s)):d=Zr.parse(s),{kind:"constant",evaluate:()=>d}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class Uo{constructor(t){this.property=t,this.value=new ea(t,void 0)}transitioned(t,r){return new Da(this.property,this.value,r,ht({},t.transition,this.transition),t.now)}untransitioned(){return new Da(this.property,this.value,null,{},0)}}class No{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return bt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Uo(this._values[t].property)),this._values[t].value=new ea(this._values[t].property,r===null?void 0:bt(r))}getTransition(t){return bt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Uo(this._values[t].property)),this._values[t].transition=bt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new ta(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new ta(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Da{constructor(t,r,s,l,d){this.property=t,this.value=r,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,d=this.value.possiblyEvaluate(t,r,s),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(t,r,s);{const _=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,r,s),d,function(b){if(b<=0)return 0;if(b>=1)return 1;const Q=b*b,M=Q*b;return 4*(b<.5?M:3*(b-Q)+M-.75)}(_))}}return d}}class ta{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new Ma(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ia{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return bt(this._values[t].value)}setValue(t,r){this._values[t]=new ea(this._values[t].property,r===null?void 0:bt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new Ma(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}}class Hn{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class Ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const l=_r[this.specification.type];return l?l(t,r,s):t}}class Ht{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new Hn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Hn(this,{kind:"constant",value:void 0},t.parameters);const l=_r[this.specification.type];if(l){const d=l(t.value.value,r.value.value,s);return new Hn(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,r,s,l,d,f){return t.kind==="constant"?t.value:t.evaluate(r,s,l,d,f)}}class Oo extends Ht{possiblyEvaluate(t,r,s,l){if(t.value===void 0)return new Hn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l),f=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,_=this._calculate(f,f,f,r);return new Hn(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Hn(this,{kind:"constant",value:d},r)}return new Hn(this,t.expression,r)}evaluate(t,r,s,l,d,f){if(t.kind==="source"){const _=t.evaluate(r,s,l,d,f);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,l),t.evaluate({zoom:Math.floor(r.zoom)},s,l),t.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):t.value}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class qo{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l);return this._calculate(d,d,d,r)}return this._calculate(t.expression.evaluate(new Vi(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Ml{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class u{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new ea(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new Uo(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Bt("DataDrivenProperty",Ht),Bt("DataConstantProperty",zt),Bt("CrossFadedDataDrivenProperty",Oo),Bt("CrossFadedProperty",qo),Bt("ColorRampProperty",Ml);const e="-transition";class n extends er{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new ia(r.layout)),r.paint)){this._transitionablePaint=new No(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ma(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(Xl,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(Ql,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),_=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(t,_,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Tt(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,l,d={}){return(!d||d.validate!==!1)&&Fo(this,t.call($s,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:qe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Hn&&Vs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class o{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function I(i,t=1){let r=0,s=0;return{members:i.map(l=>{const d=a[l.type].BYTES_PER_ELEMENT,f=r=v(r,Math.max(t,d)),_=l.components||1;return s=Math.max(s,d),r+=d*_,{name:l.name,type:l.type,components:_,offset:f}}),size:v(r,Math.max(s,t)),alignment:t}}function v(i,t){return Math.ceil(i/t)*t}class C extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}C.prototype.bytesPerElement=4,Bt("StructArrayLayout2i4",C);class T extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=l,t}}T.prototype.bytesPerElement=6,Bt("StructArrayLayout3i6",T);class F extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const f=4*t;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=l,this.int16[f+3]=d,t}}F.prototype.bytesPerElement=8,Bt("StructArrayLayout4i8",F);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=_,t}}z.prototype.bytesPerElement=12,Bt("StructArrayLayout2i4i12",z);class $ extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=4*t,Q=8*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[Q+4]=l,this.uint8[Q+5]=d,this.uint8[Q+6]=f,this.uint8[Q+7]=_,t}}$.prototype.bytesPerElement=8,Bt("StructArrayLayout2i4ub8",$);class ie extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}ie.prototype.bytesPerElement=8,Bt("StructArrayLayout2f8",ie);class ce extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,Q,M){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,s,l,d,f,_,b,Q,M)}emplace(t,r,s,l,d,f,_,b,Q,M,R){const O=10*t;return this.uint16[O+0]=r,this.uint16[O+1]=s,this.uint16[O+2]=l,this.uint16[O+3]=d,this.uint16[O+4]=f,this.uint16[O+5]=_,this.uint16[O+6]=b,this.uint16[O+7]=Q,this.uint16[O+8]=M,this.uint16[O+9]=R,t}}ce.prototype.bytesPerElement=20,Bt("StructArrayLayout10ui20",ce);class m extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,Q,M,R,O){const Y=this.length;return this.resize(Y+1),this.emplace(Y,t,r,s,l,d,f,_,b,Q,M,R,O)}emplace(t,r,s,l,d,f,_,b,Q,M,R,O,Y){const W=12*t;return this.int16[W+0]=r,this.int16[W+1]=s,this.int16[W+2]=l,this.int16[W+3]=d,this.uint16[W+4]=f,this.uint16[W+5]=_,this.uint16[W+6]=b,this.uint16[W+7]=Q,this.int16[W+8]=M,this.int16[W+9]=R,this.int16[W+10]=O,this.int16[W+11]=Y,t}}m.prototype.bytesPerElement=24,Bt("StructArrayLayout4i4ui4i24",m);class p extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}p.prototype.bytesPerElement=12,Bt("StructArrayLayout3f12",p);class A extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}A.prototype.bytesPerElement=4,Bt("StructArrayLayout1ul4",A);class w extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,Q){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,s,l,d,f,_,b,Q)}emplace(t,r,s,l,d,f,_,b,Q,M){const R=10*t,O=5*t;return this.int16[R+0]=r,this.int16[R+1]=s,this.int16[R+2]=l,this.int16[R+3]=d,this.int16[R+4]=f,this.int16[R+5]=_,this.uint32[O+3]=b,this.uint16[R+8]=Q,this.uint16[R+9]=M,t}}w.prototype.bytesPerElement=20,Bt("StructArrayLayout6i1ul2ui20",w);class B extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=_,t}}B.prototype.bytesPerElement=12,Bt("StructArrayLayout2i2i2i12",B);class k extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,d)}emplace(t,r,s,l,d,f){const _=4*t,b=8*t;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=l,this.int16[b+6]=d,this.int16[b+7]=f,t}}k.prototype.bytesPerElement=16,Bt("StructArrayLayout2f1f2i16",k);class P extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=16*t,Q=4*t,M=8*t;return this.uint8[b+0]=r,this.uint8[b+1]=s,this.float32[Q+1]=l,this.float32[Q+2]=d,this.int16[M+6]=f,this.int16[M+7]=_,t}}P.prototype.bytesPerElement=16,Bt("StructArrayLayout2ub2f2i16",P);class S extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=l,t}}S.prototype.bytesPerElement=6,Bt("StructArrayLayout3ui6",S);class V extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,Q,M,R,O,Y,W,ee,me,ve){const Re=this.length;return this.resize(Re+1),this.emplace(Re,t,r,s,l,d,f,_,b,Q,M,R,O,Y,W,ee,me,ve)}emplace(t,r,s,l,d,f,_,b,Q,M,R,O,Y,W,ee,me,ve,Re){const Ee=24*t,Pe=12*t,Ke=48*t;return this.int16[Ee+0]=r,this.int16[Ee+1]=s,this.uint16[Ee+2]=l,this.uint16[Ee+3]=d,this.uint32[Pe+2]=f,this.uint32[Pe+3]=_,this.uint32[Pe+4]=b,this.uint16[Ee+10]=Q,this.uint16[Ee+11]=M,this.uint16[Ee+12]=R,this.float32[Pe+7]=O,this.float32[Pe+8]=Y,this.uint8[Ke+36]=W,this.uint8[Ke+37]=ee,this.uint8[Ke+38]=me,this.uint32[Pe+10]=ve,this.int16[Ee+22]=Re,t}}V.prototype.bytesPerElement=48,Bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",V);class U extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,Q,M,R,O,Y,W,ee,me,ve,Re,Ee,Pe,Ke,ot,St,Kt,kt,xt,Nt,Ft){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,t,r,s,l,d,f,_,b,Q,M,R,O,Y,W,ee,me,ve,Re,Ee,Pe,Ke,ot,St,Kt,kt,xt,Nt,Ft)}emplace(t,r,s,l,d,f,_,b,Q,M,R,O,Y,W,ee,me,ve,Re,Ee,Pe,Ke,ot,St,Kt,kt,xt,Nt,Ft,Pt){const tt=32*t,qt=16*t;return this.int16[tt+0]=r,this.int16[tt+1]=s,this.int16[tt+2]=l,this.int16[tt+3]=d,this.int16[tt+4]=f,this.int16[tt+5]=_,this.int16[tt+6]=b,this.int16[tt+7]=Q,this.uint16[tt+8]=M,this.uint16[tt+9]=R,this.uint16[tt+10]=O,this.uint16[tt+11]=Y,this.uint16[tt+12]=W,this.uint16[tt+13]=ee,this.uint16[tt+14]=me,this.uint16[tt+15]=ve,this.uint16[tt+16]=Re,this.uint16[tt+17]=Ee,this.uint16[tt+18]=Pe,this.uint16[tt+19]=Ke,this.uint16[tt+20]=ot,this.uint16[tt+21]=St,this.uint16[tt+22]=Kt,this.uint32[qt+12]=kt,this.float32[qt+13]=xt,this.float32[qt+14]=Nt,this.uint16[tt+30]=Ft,this.uint16[tt+31]=Pt,t}}U.prototype.bytesPerElement=64,Bt("StructArrayLayout8i15ui1ul2f2ui64",U);class q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}q.prototype.bytesPerElement=4,Bt("StructArrayLayout1f4",q);class ne extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[6*t+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}ne.prototype.bytesPerElement=12,Bt("StructArrayLayout1ui2f12",ne);class Z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=4*t;return this.uint32[2*t+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=l,t}}Z.prototype.bytesPerElement=8,Bt("StructArrayLayout1ul2ui8",Z);class N extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}N.prototype.bytesPerElement=4,Bt("StructArrayLayout2ui4",N);class se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}se.prototype.bytesPerElement=2,Bt("StructArrayLayout1ui2",se);class ue extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const f=4*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.float32[f+3]=d,t}}ue.prototype.bytesPerElement=16,Bt("StructArrayLayout4f16",ue);class ae extends o{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new fe(this.anchorPointX,this.anchorPointY)}}ae.prototype.size=20;class de extends w{get(t){return new ae(this,t)}}Bt("CollisionBoxArray",de);class xe extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}xe.prototype.size=48;class be extends V{get(t){return new xe(this,t)}}Bt("PlacedSymbolArray",be);class Se extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Se.prototype.size=64;class K extends U{get(t){return new Se(this,t)}}Bt("SymbolInstanceArray",K);class G extends q{getoffsetX(t){return this.float32[1*t+0]}}Bt("GlyphOffsetArray",G);class Ae extends T{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Bt("SymbolLineVertexArray",Ae);class re extends o{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}re.prototype.size=12;class le extends ne{get(t){return new re(this,t)}}Bt("TextAnchorOffsetArray",le);class ge extends o{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ge.prototype.size=8;class De extends Z{get(t){return new ge(this,t)}}Bt("FeatureIndexArray",De);class Be extends C{}class ke extends C{}class Oe extends C{}class Ze extends z{}class We extends ${}class rt extends ie{}class pt extends ce{}class Ve extends m{}class ze extends p{}class it extends A{}class Dt extends B{}class ft extends P{}class Rt extends S{}class At extends N{}const Ct=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:wt}=Ct;class ut{constructor(t=[]){this.segments=t}prepareSegment(t,r,s,l){let d=this.segments[this.segments.length-1];return t>ut.MAX_VERTEX_ARRAY_LENGTH&&Vt(`Max vertices per segment is ${ut.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>ut.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new ut([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function Et(i,t){return 256*(i=lt(Math.floor(i),0,255))+lt(Math.floor(t),0,255)}ut.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt("SegmentVector",ut);const mi=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ai={exports:{}},bi={exports:{}};bi.exports=function(i,t){var r,s,l,d,f,_,b,Q;for(s=i.length-(r=3&i.length),l=t,f=3432918353,_=461845907,Q=0;Q<s;)b=255&i.charCodeAt(Q)|(255&i.charCodeAt(++Q))<<8|(255&i.charCodeAt(++Q))<<16|(255&i.charCodeAt(++Q))<<24,++Q,l=27492+(65535&(d=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&i.charCodeAt(Q+2))<<16;case 2:b^=(255&i.charCodeAt(Q+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(Q)))*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var vi=bi.exports,nn={exports:{}};nn.exports=function(i,t){for(var r,s=i.length,l=t^s,d=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:l^=(255&i.charCodeAt(d+2))<<16;case 2:l^=(255&i.charCodeAt(d+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(d)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var Br=vi,Ss=nn.exports;ai.exports=Br,ai.exports.murmur3=Br,ai.exports.murmur2=Ss;var ti=X(ai.exports);class sn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(Qn(t)),this.positions.push(r,s,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Qn(t);let s=0,l=this.ids.length-1;for(;s<l;){const f=s+l>>1;this.ids[f]>=r?l=f:s=f+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return no(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(t){const r=new sn;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Qn(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ti(String(i))}function no(i,t,r,s){for(;r<s;){const l=i[r+s>>1];let d=r-1,f=s+1;for(;;){do d++;while(i[d]<l);do f--;while(i[f]>l);if(d>=f)break;As(i,d,f),As(t,3*d,3*f),As(t,3*d+1,3*f+1),As(t,3*d+2,3*f+2)}f-r<s-f?(no(i,t,r,f),r=f+1):(no(i,t,f+1,s),s=f)}}function As(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}Bt("FeaturePositionMap",sn);class fr{constructor(t,r){this.gl=t.gl,this.location=r}}class Ta extends fr{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class jc extends fr{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Jc extends fr{constructor(t,r){super(t,r),this.current=Ri.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const rc=new Float32Array(16);function jn(i){return[Et(255*i.r,255*i.g),Et(255*i.b,255*i.a)]}class Ur{constructor(t,r,s){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new Jc(t,r):new Ta(t,r)}}class so{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,l){const d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new jc(t,r):new Ta(t,r)}}class ds{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,d){const f=this.paintVertexArray.length,_=this.expression.evaluate(new Vi(0),r,{},l,[],d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,_)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(t,r,d)}_setPaintValue(t,r,s){if(this.type==="color"){const l=jn(s);for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ra{constructor(t,r,s,l,d,f){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,s,l,d){const f=this.expression.evaluate(new Vi(this.zoom),r,{},l,[],d),_=this.expression.evaluate(new Vi(this.zoom+1),r,{},l,[],d),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,f,_)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:this.zoom},s,l),f=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(t,r,d,f)}_setPaintValue(t,r,s,l){if(this.type==="color"){const d=jn(s),f=jn(l);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1],f[0],f[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=lt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,s){return new Ta(t,r)}}class Vo{constructor(t,r,s,l,d,f){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,d){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(t,r,s,l){if(!l||!s)return;const{min:d,mid:f,max:_}=s,b=l[d],Q=l[f],M=l[_];if(b&&Q&&M)for(let R=t;R<r;R++)this.zoomInPaintVertexArray.emplace(R,Q.tl[0],Q.tl[1],Q.br[0],Q.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],Q.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,Q.tl[0],Q.tl[1],Q.br[0],Q.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],Q.pixelRatio,M.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,mi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,mi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class wu{constructor(t,r,s){this.binders={},this._buffers=[];const l=[];for(const d in t.paint._values){if(!s(d))continue;const f=t.paint.get(d);if(!(f instanceof Hn&&Vs(f.property.specification)))continue;const _=Af(d,t.type),b=f.value,Q=f.property.specification.type,M=f.property.useIntegerZoom,R=f.property.specification["property-type"],O=R==="cross-faded"||R==="cross-faded-data-driven";if(b.kind==="constant")this.binders[d]=O?new so(b.value,_):new Ur(b.value,_,Q),l.push(`/u_${d}`);else if(b.kind==="source"||O){const Y=xu(d,Q,"source");this.binders[d]=O?new Vo(b,Q,M,r,Y,t.id):new ds(b,_,Q,Y),l.push(`/a_${d}`)}else{const Y=xu(d,Q,"composite");this.binders[d]=new ra(b,_,Q,M,r,Y),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof ds||r instanceof ra?r.maxValue:0}populatePaintArrays(t,r,s,l,d){for(const f in this.binders){const _=this.binders[f];(_ instanceof ds||_ instanceof ra||_ instanceof Vo)&&_.populatePaintArray(t,r,s,l,d)}}setConstantPatternPositions(t,r){for(const s in this.binders){const l=this.binders[s];l instanceof so&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,l,d){let f=!1;for(const _ in t){const b=r.getPositions(_);for(const Q of b){const M=s.feature(Q.index);for(const R in this.binders){const O=this.binders[R];if((O instanceof ds||O instanceof ra||O instanceof Vo)&&O.expression.isStateDependent===!0){const Y=l.paint.get(R);O.expression=Y.value,O.updatePaintArray(Q.start,Q.end,M,t[_],d),f=!0}}}}return f}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Ur||s instanceof so)&&t.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ds||s instanceof ra)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name);else if(s instanceof Vo)for(let l=0;l<mi.members.length;l++)t.push(mi.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Ur||s instanceof so||s instanceof ra)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Ur||d instanceof so||d instanceof ra){for(const f of d.uniformNames)if(r[f]){const _=d.getBinding(t,r[f],f);s.push({name:f,property:l,binding:_})}}}return s}setUniforms(t,r,s,l){for(const{name:d,property:f,binding:_}of r)this.binders[f].setUniform(_,l,s.get(f),d)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof Vo){const l=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof ds||s instanceof ra)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof ds||s instanceof ra||s instanceof Vo)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof ds||r instanceof ra||r instanceof Vo)&&r.destroy()}}}class Tl{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new wu(l,r,s);this.needsUpload=!1,this._featureMap=new sn,this._bufferOffset=0}populatePaintArrays(t,r,s,l,d,f){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,l,d,f);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,r,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Af(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function xu(i,t,r){const s={color:{source:ie,composite:ue},number:{source:q,composite:ie}},l=function(d){return{"line-pattern":{source:pt,composite:pt},"fill-pattern":{source:pt,composite:pt},"fill-extrusion-pattern":{source:pt,composite:pt}}[d]}(i);return l&&l[r]||s[t][r]}Bt("ConstantBinder",Ur),Bt("CrossFadedConstantBinder",so),Bt("SourceExpressionBinder",ds),Bt("CrossFadedCompositeBinder",Vo),Bt("CompositeExpressionBinder",ra),Bt("ProgramConfiguration",wu,{omit:["_buffers"]}),Bt("ProgramConfigurationSet",Tl);const gr=8192,vh=Math.pow(2,14)-1,Bu=-vh-1;function Pl(i){const t=gr/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let d=0;d<l.length;d++){const f=l[d],_=Math.round(f.x*t),b=Math.round(f.y*t);f.x=lt(_,Bu,vh),f.y=lt(b,Bu,vh),(_<f.x||_>f.x+1||b<f.y||b>f.y+1)&&Vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ll(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Pl(i):[]}}function Yc(i,t,r,s,l){i.emplaceBack(2*t+(s+1)/2,2*r+(l+1)/2)}class wh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.indexArray=new Rt,this.segments=new ut,this.programConfigurations=new Tl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const l=this.layers[0],d=[];let f=null,_=!1;l.type==="circle"&&(f=l.layout.get("circle-sort-key"),_=!f.isConstant());for(const{feature:b,id:Q,index:M,sourceLayerIndex:R}of t){const O=this.layers[0]._featureFilter.needGeometry,Y=Ll(b,O);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),Y,s))continue;const W=_?f.evaluate(Y,{},s):void 0,ee={id:Q,properties:b.properties,type:b.type,sourceLayerIndex:R,index:M,geometry:O?Y.geometry:Pl(b),patterns:{},sortKey:W};d.push(ee)}_&&d.sort((b,Q)=>b.sortKey-Q.sortKey);for(const b of d){const{geometry:Q,index:M,sourceLayerIndex:R}=b,O=t[M].feature;this.addFeature(b,Q,M,s),r.featureIndex.insert(O,Q,M,R,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wt),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l){for(const d of r)for(const f of d){const _=f.x,b=f.y;if(_<0||_>=gr||b<0||b>=gr)continue;const Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),M=Q.vertexLength;Yc(this.layoutVertexArray,_,b,-1,-1),Yc(this.layoutVertexArray,_,b,1,-1),Yc(this.layoutVertexArray,_,b,1,1),Yc(this.layoutVertexArray,_,b,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),Q.vertexLength+=4,Q.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l)}}function Cu(i,t){for(let r=0;r<i.length;r++)if(nc(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(nc(i,t[r]))return!0;return!!xh(i,t)}function df(i,t,r){return!!nc(i,t)||!!Bh(t,i,r)}function Eu(i,t){if(i.length===1)return ku(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if(nc(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(ku(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(xh(i,t[r]))return!0;return!1}function ff(i,t,r){if(i.length>1){if(xh(i,t))return!0;for(let s=0;s<t.length;s++)if(Bh(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Bh(i[s],t,r))return!0;return!1}function xh(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let d=0;d<t.length-1;d++)if(gf(s,l,t[d],t[d+1]))return!0}return!1}function gf(i,t,r,s){return Lt(i,r,s)!==Lt(t,r,s)&&Lt(i,t,r)!==Lt(i,t,s)}function Bh(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(Qu(i,t[l-1],t[l])<s)return!0;return!1}function Qu(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function ku(i,t){let r,s,l,d=!1;for(let f=0;f<i.length;f++){r=i[f];for(let _=0,b=r.length-1;_<r.length;b=_++)s=r[_],l=r[b],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(d=!d)}return d}function nc(i,t){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const d=i[s],f=i[l];d.y>t.y!=f.y>t.y&&t.x<(f.x-d.x)*(t.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function pf(i,t,r){const s=r[0],l=r[2];if(i.x<s.x&&t.x<s.x||i.x>l.x&&t.x>l.x||i.y<s.y&&t.y<s.y||i.y>l.y&&t.y>l.y)return!1;const d=Lt(i,t,r[0]);return d!==Lt(i,t,r[1])||d!==Lt(i,t,r[2])||d!==Lt(i,t,r[3])}function Cc(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Kc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Zc(i,t,r,s,l){if(!t[0]&&!t[1])return i;const d=fe.convert(t)._mult(l);r==="viewport"&&d._rotate(-s);const f=[];for(let _=0;_<i.length;_++)f.push(i[_].sub(d));return f}let Su,Du;Bt("CircleBucket",wh,{omit:["layers"]});var mf={get paint(){return Du=Du||new u({"circle-radius":new Ht(qe.paint_circle["circle-radius"]),"circle-color":new Ht(qe.paint_circle["circle-color"]),"circle-blur":new Ht(qe.paint_circle["circle-blur"]),"circle-opacity":new Ht(qe.paint_circle["circle-opacity"]),"circle-translate":new zt(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(qe.paint_circle["circle-stroke-opacity"])})},get layout(){return Su=Su||new u({"circle-sort-key":new Ht(qe.layout_circle["circle-sort-key"])})}},fn=1e-6,sc=typeof Float32Array<"u"?Float32Array:Array;function Ch(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Mu(i,t,r){var s=t[0],l=t[1],d=t[2],f=t[3],_=t[4],b=t[5],Q=t[6],M=t[7],R=t[8],O=t[9],Y=t[10],W=t[11],ee=t[12],me=t[13],ve=t[14],Re=t[15],Ee=r[0],Pe=r[1],Ke=r[2],ot=r[3];return i[0]=Ee*s+Pe*_+Ke*R+ot*ee,i[1]=Ee*l+Pe*b+Ke*O+ot*me,i[2]=Ee*d+Pe*Q+Ke*Y+ot*ve,i[3]=Ee*f+Pe*M+Ke*W+ot*Re,i[4]=(Ee=r[4])*s+(Pe=r[5])*_+(Ke=r[6])*R+(ot=r[7])*ee,i[5]=Ee*l+Pe*b+Ke*O+ot*me,i[6]=Ee*d+Pe*Q+Ke*Y+ot*ve,i[7]=Ee*f+Pe*M+Ke*W+ot*Re,i[8]=(Ee=r[8])*s+(Pe=r[9])*_+(Ke=r[10])*R+(ot=r[11])*ee,i[9]=Ee*l+Pe*b+Ke*O+ot*me,i[10]=Ee*d+Pe*Q+Ke*Y+ot*ve,i[11]=Ee*f+Pe*M+Ke*W+ot*Re,i[12]=(Ee=r[12])*s+(Pe=r[13])*_+(Ke=r[14])*R+(ot=r[15])*ee,i[13]=Ee*l+Pe*b+Ke*O+ot*me,i[14]=Ee*d+Pe*Q+Ke*Y+ot*ve,i[15]=Ee*f+Pe*M+Ke*W+ot*Re,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Ec,yf=Mu;function $c(i,t,r){var s=t[0],l=t[1],d=t[2],f=t[3];return i[0]=r[0]*s+r[4]*l+r[8]*d+r[12]*f,i[1]=r[1]*s+r[5]*l+r[9]*d+r[13]*f,i[2]=r[2]*s+r[6]*l+r[10]*d+r[14]*f,i[3]=r[3]*s+r[7]*l+r[11]*d+r[15]*f,i}Ec=new sc(4),sc!=Float32Array&&(Ec[0]=0,Ec[1]=0,Ec[2]=0,Ec[3]=0);class _f extends n{constructor(t){super(t,mf)}createBucket(t){return new wh(t)}queryRadius(t){const r=t;return Cc("circle-radius",this,r)+Cc("circle-stroke-width",this,r)+Kc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,s,l,d,f,_,b){const Q=Zc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,_),M=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),R=this.paint.get("circle-pitch-alignment")==="map",O=R?Q:function(W,ee){return W.map(me=>Tu(me,ee))}(Q,b),Y=R?M*_:M;for(const W of l)for(const ee of W){const me=R?ee:Tu(ee,b);let ve=Y;const Re=$c([],[ee.x,ee.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ve*=Re[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ve*=f.cameraToCenterDistance/Re[3]),df(O,me,ve))return!0}return!1}}function Tu(i,t){const r=$c([],[i.x,i.y,0,1],t);return new fe(r[0]/r[3],r[1]/r[3])}class Pu extends wh{}let Lu;Bt("HeatmapBucket",Pu,{omit:["layers"]});var If={get paint(){return Lu=Lu||new u({"heatmap-radius":new Ht(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ml(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(qe.paint_heatmap["heatmap-opacity"])})}};function Eh(i,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*s}`)}else l=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=l,i}function Ru(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const l=Eh({},{width:t,height:r},s);Qh(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=l.data}function Qh(i,t,r,s,l,d){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,_=t.data;if(f===_)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<l.height;b++){const Q=((r.y+b)*i.width+r.x)*d,M=((s.y+b)*t.width+s.x)*d;for(let R=0;R<l.width*d;R++)_[M+R]=f[Q+R]}return t}class Qc{constructor(t,r){Eh(this,t,1,r)}resize(t){Ru(this,t,1)}clone(){return new Qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){Qh(t,r,s,l,d,1)}}class fs{constructor(t,r){Eh(this,t,4,r)}resize(t){Ru(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){Qh(t,r,s,l,d,4)}}function Fu(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new fs({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,_,b)=>{t[i.evaluationKey]=b;const Q=i.expression.evaluate(t);l.data[f+_+0]=Math.floor(255*Q.r/Q.a),l.data[f+_+1]=Math.floor(255*Q.g/Q.a),l.data[f+_+2]=Math.floor(255*Q.b/Q.a),l.data[f+_+3]=Math.floor(255*Q.a)};if(i.clips)for(let f=0,_=0;f<s;++f,_+=4*r)for(let b=0,Q=0;b<r;b++,Q+=4){const M=b/(r-1),{start:R,end:O}=i.clips[f];d(_,Q,R*(1-M)+O*M)}else for(let f=0,_=0;f<r;f++,_+=4)d(0,_,f/(r-1));return l}Bt("AlphaImage",Qc),Bt("RGBAImage",fs);const kh="big-fb";class bf extends n{createBucket(t){return new Pu(t)}constructor(t){super(t,If),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(kh)&&this.heatmapFbos.delete(kh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let zu;var vf={get paint(){return zu=zu||new u({"hillshade-illumination-direction":new zt(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(qe.paint_hillshade["hillshade-accent-color"])})}};class wf extends n{constructor(t){super(t,vf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const xf=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bf}=xf;function Gu(i,t,r=2){const s=t&&t.length,l=s?t[0]*r:i.length;let d=Uu(i,0,l,r,!0);const f=[];if(!d||d.next===d.prev)return f;let _,b,Q;if(s&&(d=function(M,R,O,Y){const W=[];for(let ee=0,me=R.length;ee<me;ee++){const ve=Uu(M,R[ee]*Y,ee<me-1?R[ee+1]*Y:M.length,Y,!1);ve===ve.next&&(ve.steiner=!0),W.push(Tf(ve))}W.sort(Sf);for(let ee=0;ee<W.length;ee++)O=Df(W[ee],O);return O}(i,t,d,r)),i.length>80*r){_=1/0,b=1/0;let M=-1/0,R=-1/0;for(let O=r;O<l;O+=r){const Y=i[O],W=i[O+1];Y<_&&(_=Y),W<b&&(b=W),Y>M&&(M=Y),W>R&&(R=W)}Q=Math.max(M-_,R-b),Q=Q!==0?32767/Q:0}return kc(d,f,r,_,b,Q,0),f}function Uu(i,t,r,s,l){let d;if(l===function(f,_,b,Q){let M=0;for(let R=_,O=b-Q;R<b;R+=Q)M+=(f[O]-f[R])*(f[R+1]+f[O+1]),O=R;return M}(i,t,r,s)>0)for(let f=t;f<r;f+=s)d=qu(f/s|0,i[f],i[f+1],d);else for(let f=r-s;f>=t;f-=s)d=qu(f/s|0,i[f],i[f+1],d);return d&&Wc(d,d.next)&&(Dc(d),d=d.next),d}function Rl(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!Wc(s,s.next)&&ur(s.prev,s,s.next)!==0)s=s.next;else{if(Dc(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function kc(i,t,r,s,l,d,f){if(!i)return;!f&&d&&function(b,Q,M,R){let O=b;do O.z===0&&(O.z=Sh(O.x,O.y,Q,M,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==b);O.prevZ.nextZ=null,O.prevZ=null,function(Y){let W,ee=1;do{let me,ve=Y;Y=null;let Re=null;for(W=0;ve;){W++;let Ee=ve,Pe=0;for(let ot=0;ot<ee&&(Pe++,Ee=Ee.nextZ,Ee);ot++);let Ke=ee;for(;Pe>0||Ke>0&&Ee;)Pe!==0&&(Ke===0||!Ee||ve.z<=Ee.z)?(me=ve,ve=ve.nextZ,Pe--):(me=Ee,Ee=Ee.nextZ,Ke--),Re?Re.nextZ=me:Y=me,me.prevZ=Re,Re=me;ve=Ee}Re.nextZ=null,ee*=2}while(W>1)}(O)}(i,s,l,d);let _=i;for(;i.prev!==i.next;){const b=i.prev,Q=i.next;if(d?Ef(i,s,l,d):Cf(i))t.push(b.i,i.i,Q.i),Dc(i),i=Q.next,_=Q.next;else if((i=Q)===_){f?f===1?kc(i=Qf(Rl(i),t),t,r,s,l,d,2):f===2&&kf(i,t,r,s,l,d):kc(Rl(i),t,r,s,l,d,1);break}}}function Cf(i){const t=i.prev,r=i,s=i.next;if(ur(t,r,s)>=0)return!1;const l=t.x,d=r.x,f=s.x,_=t.y,b=r.y,Q=s.y,M=l<d?l<f?l:f:d<f?d:f,R=_<b?_<Q?_:Q:b<Q?b:Q,O=l>d?l>f?l:f:d>f?d:f,Y=_>b?_>Q?_:Q:b>Q?b:Q;let W=s.next;for(;W!==t;){if(W.x>=M&&W.x<=O&&W.y>=R&&W.y<=Y&&ac(l,_,d,b,f,Q,W.x,W.y)&&ur(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function Ef(i,t,r,s){const l=i.prev,d=i,f=i.next;if(ur(l,d,f)>=0)return!1;const _=l.x,b=d.x,Q=f.x,M=l.y,R=d.y,O=f.y,Y=_<b?_<Q?_:Q:b<Q?b:Q,W=M<R?M<O?M:O:R<O?R:O,ee=_>b?_>Q?_:Q:b>Q?b:Q,me=M>R?M>O?M:O:R>O?R:O,ve=Sh(Y,W,t,r,s),Re=Sh(ee,me,t,r,s);let Ee=i.prevZ,Pe=i.nextZ;for(;Ee&&Ee.z>=ve&&Pe&&Pe.z<=Re;){if(Ee.x>=Y&&Ee.x<=ee&&Ee.y>=W&&Ee.y<=me&&Ee!==l&&Ee!==f&&ac(_,M,b,R,Q,O,Ee.x,Ee.y)&&ur(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Pe.x>=Y&&Pe.x<=ee&&Pe.y>=W&&Pe.y<=me&&Pe!==l&&Pe!==f&&ac(_,M,b,R,Q,O,Pe.x,Pe.y)&&ur(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;Ee&&Ee.z>=ve;){if(Ee.x>=Y&&Ee.x<=ee&&Ee.y>=W&&Ee.y<=me&&Ee!==l&&Ee!==f&&ac(_,M,b,R,Q,O,Ee.x,Ee.y)&&ur(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Pe&&Pe.z<=Re;){if(Pe.x>=Y&&Pe.x<=ee&&Pe.y>=W&&Pe.y<=me&&Pe!==l&&Pe!==f&&ac(_,M,b,R,Q,O,Pe.x,Pe.y)&&ur(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function Qf(i,t){let r=i;do{const s=r.prev,l=r.next.next;!Wc(s,l)&&Nu(s,r,r.next,l)&&Sc(s,l)&&Sc(l,s)&&(t.push(s.i,r.i,l.i),Dc(r),Dc(r.next),r=i=l),r=r.next}while(r!==i);return Rl(r)}function kf(i,t,r,s,l,d){let f=i;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&Pf(f,_)){let b=Ou(f,_);return f=Rl(f,f.next),b=Rl(b,b.next),kc(f,t,r,s,l,d,0),void kc(b,t,r,s,l,d,0)}_=_.next}f=f.next}while(f!==i)}function Sf(i,t){return i.x-t.x}function Df(i,t){const r=function(l,d){let f=d;const _=l.x,b=l.y;let Q,M=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const ee=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(ee<=_&&ee>M&&(M=ee,Q=f.x<f.next.x?f:f.next,ee===_))return Q}f=f.next}while(f!==d);if(!Q)return null;const R=Q,O=Q.x,Y=Q.y;let W=1/0;f=Q;do{if(_>=f.x&&f.x>=O&&_!==f.x&&ac(b<Y?_:M,b,O,Y,b<Y?M:_,b,f.x,f.y)){const ee=Math.abs(b-f.y)/(_-f.x);Sc(f,l)&&(ee<W||ee===W&&(f.x>Q.x||f.x===Q.x&&Mf(Q,f)))&&(Q=f,W=ee)}f=f.next}while(f!==R);return Q}(i,t);if(!r)return t;const s=Ou(r,i);return Rl(s,s.next),Rl(r,r.next)}function Mf(i,t){return ur(i.prev,i,t.prev)<0&&ur(t.next,i,i.next)<0}function Sh(i,t,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Tf(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function ac(i,t,r,s,l,d,f,_){return(l-f)*(t-_)>=(i-f)*(d-_)&&(i-f)*(s-_)>=(r-f)*(t-_)&&(r-f)*(d-_)>=(l-f)*(s-_)}function Pf(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Nu(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(Sc(i,t)&&Sc(t,i)&&function(r,s){let l=r,d=!1;const f=(r.x+s.x)/2,_=(r.y+s.y)/2;do l.y>_!=l.next.y>_&&l.next.y!==l.y&&f<(l.next.x-l.x)*(_-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==r);return d}(i,t)&&(ur(i.prev,i,t.prev)||ur(i,t.prev,t))||Wc(i,t)&&ur(i.prev,i,i.next)>0&&ur(t.prev,t,t.next)>0)}function ur(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Wc(i,t){return i.x===t.x&&i.y===t.y}function Nu(i,t,r,s){const l=eh(ur(i,t,r)),d=eh(ur(i,t,s)),f=eh(ur(r,s,i)),_=eh(ur(r,s,t));return l!==d&&f!==_||!(l!==0||!Xc(i,r,t))||!(d!==0||!Xc(i,s,t))||!(f!==0||!Xc(r,i,s))||!(_!==0||!Xc(r,t,s))}function Xc(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function eh(i){return i>0?1:i<0?-1:0}function Sc(i,t){return ur(i.prev,i,i.next)<0?ur(i,t,i.next)>=0&&ur(i,i.prev,t)>=0:ur(i,t,i.prev)<0||ur(i,i.next,t)<0}function Ou(i,t){const r=Dh(i.i,i.x,i.y),s=Dh(t.i,t.x,t.y),l=i.next,d=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function qu(i,t,r,s){const l=Dh(i,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Dc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Dh(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mh(i,t,r){const s=r.patternDependencies;let l=!1;for(const d of t){const f=d.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const _=f.constantOr(null);_&&(l=!0,s[_.to]=!0,s[_.from]=!0)}return l}function Th(i,t,r,s,l){const d=l.patternDependencies;for(const f of t){const _=f.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let b=_.evaluate({zoom:s-1},r,{},l.availableImages),Q=_.evaluate({zoom:s},r,{},l.availableImages),M=_.evaluate({zoom:s+1},r,{},l.availableImages);b=b&&b.name?b.name:b,Q=Q&&Q.name?Q.name:Q,M=M&&M.name?M.name:M,d[b]=!0,d[Q]=!0,d[M]=!0,r.patterns[f.id]={min:b,mid:Q,max:M}}}return r}class Ph{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Oe,this.indexArray=new Rt,this.indexArray2=new At,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new ut,this.segments2=new ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Mh("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),f=[];for(const{feature:_,id:b,index:Q,sourceLayerIndex:M}of t){const R=this.layers[0]._featureFilter.needGeometry,O=Ll(_,R);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),O,s))continue;const Y=d?l.evaluate(O,{},s,r.availableImages):void 0,W={id:b,properties:_.properties,type:_.type,sourceLayerIndex:M,index:Q,geometry:R?O.geometry:Pl(_),patterns:{},sortKey:Y};f.push(W)}d&&f.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of f){const{geometry:b,index:Q,sourceLayerIndex:M}=_;if(this.hasPattern){const R=Th("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(_,b,Q,s,{});r.featureIndex.insert(t[Q].feature,b,Q,M,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,d){for(const f of Va(r,500)){let _=0;for(const Y of f)_+=Y.length;const b=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),Q=b.vertexLength,M=[],R=[];for(const Y of f){if(Y.length===0)continue;Y!==f[0]&&R.push(M.length/2);const W=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),ee=W.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(ee+Y.length-1,ee),M.push(Y[0].x),M.push(Y[0].y);for(let me=1;me<Y.length;me++)this.layoutVertexArray.emplaceBack(Y[me].x,Y[me].y),this.indexArray2.emplaceBack(ee+me-1,ee+me),M.push(Y[me].x),M.push(Y[me].y);W.vertexLength+=Y.length,W.primitiveLength+=Y.length}const O=Gu(M,R);for(let Y=0;Y<O.length;Y+=3)this.indexArray.emplaceBack(Q+O[Y],Q+O[Y+1],Q+O[Y+2]);b.vertexLength+=_,b.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}let Vu,Hu;Bt("FillBucket",Ph,{omit:["layers","patternFeatures"]});var Lf={get paint(){return Hu=Hu||new u({"fill-antialias":new zt(qe.paint_fill["fill-antialias"]),"fill-opacity":new Ht(qe.paint_fill["fill-opacity"]),"fill-color":new Ht(qe.paint_fill["fill-color"]),"fill-outline-color":new Ht(qe.paint_fill["fill-outline-color"]),"fill-translate":new zt(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Oo(qe.paint_fill["fill-pattern"])})},get layout(){return Vu=Vu||new u({"fill-sort-key":new Ht(qe.layout_fill["fill-sort-key"])})}};class Rf extends n{constructor(t){super(t,Lf)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ph(t)}queryRadius(){return Kc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,s,l,d,f,_){return Eu(Zc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,_),l)}isTileClipped(){return!0}}const Ff=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),zf=I([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Gf}=Ff;var Ho={},Uf=he,ju=oc;function oc(i,t,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(Nf,this,t)}function Nf(i,t,r){i==1?t.id=r.readVarint():i==2?function(s,l){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=l._keys[s.readVarint()],_=l._values[s.readVarint()];l.properties[f]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function Of(i){for(var t,r,s=0,l=0,d=i.length,f=d-1;l<d;f=l++)s+=((r=i[f]).x-(t=i[l]).x)*(t.y+r.y);return s}oc.types=["Unknown","Point","LineString","Polygon"],oc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,s=1,l=0,d=0,f=0,_=[];i.pos<r;){if(l<=0){var b=i.readVarint();s=7&b,l=b>>3}if(l--,s===1||s===2)d+=i.readSVarint(),f+=i.readSVarint(),s===1&&(t&&_.push(t),t=[]),t.push(new Uf(d,f));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&_.push(t),_},oc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,s=0,l=0,d=0,f=1/0,_=-1/0,b=1/0,Q=-1/0;i.pos<t;){if(s<=0){var M=i.readVarint();r=7&M,s=M>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<f&&(f=l),l>_&&(_=l),(d+=i.readSVarint())<b&&(b=d),d>Q&&(Q=d);else if(r!==7)throw new Error("unknown command "+r)}return[f,b,_,Q]},oc.prototype.toGeoJSON=function(i,t,r){var s,l,d=this.extent*Math.pow(2,r),f=this.extent*i,_=this.extent*t,b=this.loadGeometry(),Q=oc.types[this.type];function M(Y){for(var W=0;W<Y.length;W++){var ee=Y[W];Y[W]=[360*(ee.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(s=0;s<b.length;s++)R[s]=b[s][0];M(b=R);break;case 2:for(s=0;s<b.length;s++)M(b[s]);break;case 3:for(b=function(Y){var W=Y.length;if(W<=1)return[Y];for(var ee,me,ve=[],Re=0;Re<W;Re++){var Ee=Of(Y[Re]);Ee!==0&&(me===void 0&&(me=Ee<0),me===Ee<0?(ee&&ve.push(ee),ee=[Y[Re]]):ee.push(Y[Re]))}return ee&&ve.push(ee),ve}(b),s=0;s<b.length;s++)for(l=0;l<b[s].length;l++)M(b[s][l])}b.length===1?b=b[0]:Q="Multi"+Q;var O={type:"Feature",geometry:{type:Q,coordinates:b},properties:this.properties};return"id"in this&&(O.id=this.id),O};var qf=ju,Ju=Yu;function Yu(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Vf,this,t),this.length=this._features.length}function Vf(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(s){for(var l=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;l=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return l}(r))}Yu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new qf(this._pbf,t,this.extent,this._keys,this._values)};var Hf=Ju;function jf(i,t,r){if(i===3){var s=new Hf(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}Ho.VectorTile=function(i,t){this.layers=i.readFields(jf,{},t)},Ho.VectorTileFeature=ju,Ho.VectorTileLayer=Ju;const Jf=Ho.VectorTileFeature.types,Lh=Math.pow(2,13);function Mc(i,t,r,s,l,d,f,_){i.emplaceBack(t,r,2*Math.floor(s*Lh)+f,l*Lh*2,d*Lh*2,Math.round(_))}class Rh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ze,this.centroidVertexArray=new Be,this.indexArray=new Rt,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new ut,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=Mh("fill-extrusion",this.layers,r);for(const{feature:l,id:d,index:f,sourceLayerIndex:_}of t){const b=this.layers[0]._featureFilter.needGeometry,Q=Ll(l,b);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),Q,s))continue;const M={id:d,sourceLayerIndex:_,index:f,geometry:b?Q.geometry:Pl(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Th("fill-extrusion",this.layers,M,this.zoom,r)):this.addFeature(M,M.geometry,f,s,{}),r.featureIndex.insert(l,M.geometry,f,_,this.index,!0)}}addFeatures(t,r,s){for(const l of this.features){const{geometry:d}=l;this.addFeature(l,d,l.index,r,s)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gf),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,zf.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,l,d){for(const f of Va(r,500)){const _={x:0,y:0,vertexCount:0};let b=0;for(const W of f)b+=W.length;let Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const W of f){if(W.length===0||Kf(W))continue;let ee=0;for(let me=0;me<W.length;me++){const ve=W[me];if(me>=1){const Re=W[me-1];if(!Yf(ve,Re)){Q.vertexLength+4>ut.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ee=ve.sub(Re)._perp()._unit(),Pe=Re.dist(ve);ee+Pe>32768&&(ee=0),Mc(this.layoutVertexArray,ve.x,ve.y,Ee.x,Ee.y,0,0,ee),Mc(this.layoutVertexArray,ve.x,ve.y,Ee.x,Ee.y,0,1,ee),_.x+=2*ve.x,_.y+=2*ve.y,_.vertexCount+=2,ee+=Pe,Mc(this.layoutVertexArray,Re.x,Re.y,Ee.x,Ee.y,0,0,ee),Mc(this.layoutVertexArray,Re.x,Re.y,Ee.x,Ee.y,0,1,ee),_.x+=2*Re.x,_.y+=2*Re.y,_.vertexCount+=2;const Ke=Q.vertexLength;this.indexArray.emplaceBack(Ke,Ke+2,Ke+1),this.indexArray.emplaceBack(Ke+1,Ke+2,Ke+3),Q.vertexLength+=4,Q.primitiveLength+=2}}}}if(Q.vertexLength+b>ut.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),Jf[t.type]!=="Polygon")continue;const M=[],R=[],O=Q.vertexLength;for(const W of f)if(W.length!==0){W!==f[0]&&R.push(M.length/2);for(let ee=0;ee<W.length;ee++){const me=W[ee];Mc(this.layoutVertexArray,me.x,me.y,0,0,1,1,0),_.x+=me.x,_.y+=me.y,_.vertexCount+=1,M.push(me.x),M.push(me.y)}}const Y=Gu(M,R);for(let W=0;W<Y.length;W+=3)this.indexArray.emplaceBack(O+Y[W],O+Y[W+2],O+Y[W+1]);Q.primitiveLength+=Y.length/3,Q.vertexLength+=b;for(let W=0;W<_.vertexCount;W++){const ee=Math.floor(_.x/_.vertexCount),me=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(ee,me)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}function Yf(i,t){return i.x===t.x&&(i.x<0||i.x>gr)||i.y===t.y&&(i.y<0||i.y>gr)}function Kf(i){return i.every(t=>t.x<0)||i.every(t=>t.x>gr)||i.every(t=>t.y<0)||i.every(t=>t.y>gr)}let Ku;Bt("FillExtrusionBucket",Rh,{omit:["layers","features"]});var Zf={get paint(){return Ku=Ku||new u({"fill-extrusion-opacity":new zt(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Oo(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $f extends n{constructor(t){super(t,Zf)}createBucket(t){return new Rh(t)}queryRadius(){return Kc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,s,l,d,f,_,b){const Q=Zc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,_),M=this.paint.get("fill-extrusion-height").evaluate(r,s),R=this.paint.get("fill-extrusion-base").evaluate(r,s),O=function(W,ee,me,ve){const Re=[];for(const Ee of W){const Pe=[Ee.x,Ee.y,0,1];$c(Pe,Pe,ee),Re.push(new fe(Pe[0]/Pe[3],Pe[1]/Pe[3]))}return Re}(Q,b),Y=function(W,ee,me,ve){const Re=[],Ee=[],Pe=ve[8]*ee,Ke=ve[9]*ee,ot=ve[10]*ee,St=ve[11]*ee,Kt=ve[8]*me,kt=ve[9]*me,xt=ve[10]*me,Nt=ve[11]*me;for(const Ft of W){const Pt=[],tt=[];for(const qt of Ft){const Ut=qt.x,ri=qt.y,Hi=ve[0]*Ut+ve[4]*ri+ve[12],Oi=ve[1]*Ut+ve[5]*ri+ve[13],Cr=ve[2]*Ut+ve[6]*ri+ve[14],Ds=ve[3]*Ut+ve[7]*ri+ve[15],Or=Cr+ot,Er=Ds+St,gn=Hi+Kt,pn=Oi+kt,mn=Cr+xt,lr=Ds+Nt,Qr=new fe((Hi+Pe)/Er,(Oi+Ke)/Er);Qr.z=Or/Er,Pt.push(Qr);const an=new fe(gn/lr,pn/lr);an.z=mn/lr,tt.push(an)}Re.push(Pt),Ee.push(tt)}return[Re,Ee]}(l,R,M,b);return function(W,ee,me){let ve=1/0;Eu(me,ee)&&(ve=Zu(me,ee[0]));for(let Re=0;Re<ee.length;Re++){const Ee=ee[Re],Pe=W[Re];for(let Ke=0;Ke<Ee.length-1;Ke++){const ot=Ee[Ke],St=[ot,Ee[Ke+1],Pe[Ke+1],Pe[Ke],ot];Cu(me,St)&&(ve=Math.min(ve,Zu(me,St)))}}return ve!==1/0&&ve}(Y[0],Y[1],O)}}function Tc(i,t){return i.x*t.x+i.y*t.y}function Zu(i,t){if(i.length===1){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const d=t[r],f=i[0],_=l.sub(s),b=d.sub(s),Q=f.sub(s),M=Tc(_,_),R=Tc(_,b),O=Tc(b,b),Y=Tc(Q,_),W=Tc(Q,b),ee=M*O-R*R,me=(O*Y-R*W)/ee,ve=(M*W-R*Y)/ee,Re=s.z*(1-me-ve)+l.z*me+d.z*ve;if(isFinite(Re))return Re}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const Wf=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Xf}=Wf,eg=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tg}=eg,ig=Ho.VectorTileFeature.types,rg=Math.cos(Math.PI/180*37.5),$u=Math.pow(2,14)/.5;class Fh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new We,this.layoutVertexArray2=new rt,this.indexArray=new Rt,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new ut,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=Mh("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),f=[];for(const{feature:_,id:b,index:Q,sourceLayerIndex:M}of t){const R=this.layers[0]._featureFilter.needGeometry,O=Ll(_,R);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),O,s))continue;const Y=d?l.evaluate(O,{},s):void 0,W={id:b,properties:_.properties,type:_.type,sourceLayerIndex:M,index:Q,geometry:R?O.geometry:Pl(_),patterns:{},sortKey:Y};f.push(W)}d&&f.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of f){const{geometry:b,index:Q,sourceLayerIndex:M}=_;if(this.hasPattern){const R=Th("line",this.layers,_,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(_,b,Q,s,{});r.featureIndex.insert(t[Q].feature,b,Q,M,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,tg)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,d){const f=this.layers[0].layout,_=f.get("line-join").evaluate(t,{}),b=f.get("line-cap"),Q=f.get("line-miter-limit"),M=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const R of r)this.addLine(R,t,_,b,Q,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}addLine(t,r,s,l,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<t.length-1;ve++)this.totalDistance+=t[ve].dist(t[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=ig[r.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let Q=0;for(;Q<b-1&&t[Q].equals(t[Q+1]);)Q++;if(b<(_?3:2))return;s==="bevel"&&(d=1.05);const M=this.overscaling<=16?15*gr/(512*this.overscaling):0,R=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let O,Y,W,ee,me;this.e1=this.e2=-1,_&&(O=t[b-2],me=t[Q].sub(O)._unit()._perp());for(let ve=Q;ve<b;ve++){if(W=ve===b-1?_?t[Q+1]:void 0:t[ve+1],W&&t[ve].equals(W))continue;me&&(ee=me),O&&(Y=O),O=t[ve],me=W?W.sub(O)._unit()._perp():ee,ee=ee||me;let Re=ee.add(me);Re.x===0&&Re.y===0||Re._unit();const Ee=ee.x*me.x+ee.y*me.y,Pe=Re.x*me.x+Re.y*me.y,Ke=Pe!==0?1/Pe:1/0,ot=2*Math.sqrt(2-2*Pe),St=Pe<rg&&Y&&W,Kt=ee.x*me.y-ee.y*me.x>0;if(St&&ve>Q){const Nt=O.dist(Y);if(Nt>2*M){const Ft=O.sub(O.sub(Y)._mult(M/Nt)._round());this.updateDistance(Y,Ft),this.addCurrentVertex(Ft,ee,0,0,R),Y=Ft}}const kt=Y&&W;let xt=kt?s:_?"butt":l;if(kt&&xt==="round"&&(Ke<f?xt="miter":Ke<=2&&(xt="fakeround")),xt==="miter"&&Ke>d&&(xt="bevel"),xt==="bevel"&&(Ke>2&&(xt="flipbevel"),Ke<d&&(xt="miter")),Y&&this.updateDistance(Y,O),xt==="miter")Re._mult(Ke),this.addCurrentVertex(O,Re,0,0,R);else if(xt==="flipbevel"){if(Ke>100)Re=me.mult(-1);else{const Nt=Ke*ee.add(me).mag()/ee.sub(me).mag();Re._perp()._mult(Nt*(Kt?-1:1))}this.addCurrentVertex(O,Re,0,0,R),this.addCurrentVertex(O,Re.mult(-1),0,0,R)}else if(xt==="bevel"||xt==="fakeround"){const Nt=-Math.sqrt(Ke*Ke-1),Ft=Kt?Nt:0,Pt=Kt?0:Nt;if(Y&&this.addCurrentVertex(O,ee,Ft,Pt,R),xt==="fakeround"){const tt=Math.round(180*ot/Math.PI/20);for(let qt=1;qt<tt;qt++){let Ut=qt/tt;if(Ut!==.5){const Hi=Ut-.5;Ut+=Ut*Hi*(Ut-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Hi*Hi+(.848013+Ee*(.215638*Ee-1.06021)))}const ri=me.sub(ee)._mult(Ut)._add(ee)._unit()._mult(Kt?-1:1);this.addHalfVertex(O,ri.x,ri.y,!1,Kt,0,R)}}W&&this.addCurrentVertex(O,me,-Ft,-Pt,R)}else if(xt==="butt")this.addCurrentVertex(O,Re,0,0,R);else if(xt==="square"){const Nt=Y?1:-1;this.addCurrentVertex(O,Re,Nt,Nt,R)}else xt==="round"&&(Y&&(this.addCurrentVertex(O,ee,0,0,R),this.addCurrentVertex(O,ee,1,1,R,!0)),W&&(this.addCurrentVertex(O,me,-1,-1,R,!0),this.addCurrentVertex(O,me,0,0,R)));if(St&&ve<b-1){const Nt=O.dist(W);if(Nt>2*M){const Ft=O.add(W.sub(O)._mult(M/Nt)._round());this.updateDistance(O,Ft),this.addCurrentVertex(Ft,me,0,0,R),O=Ft}}}}addCurrentVertex(t,r,s,l,d,f=!1){const _=r.y*l-r.x,b=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,f,!1,s,d),this.addHalfVertex(t,_,b,f,!0,-l,d),this.distance>$u/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,l,d,f))}addHalfVertex({x:t,y:r},s,l,d,f,_,b){const Q=.5*(this.lineClips?this.scaledDistance*($u-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(_===0?0:_<0?-1:1)|(63&Q)<<2,Q>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),b.primitiveLength++),f?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Wu,Xu;Bt("LineBucket",Fh,{omit:["layers","patternFeatures"]});var eA={get paint(){return Xu=Xu||new u({"line-opacity":new Ht(qe.paint_line["line-opacity"]),"line-color":new Ht(qe.paint_line["line-color"]),"line-translate":new zt(qe.paint_line["line-translate"]),"line-translate-anchor":new zt(qe.paint_line["line-translate-anchor"]),"line-width":new Ht(qe.paint_line["line-width"]),"line-gap-width":new Ht(qe.paint_line["line-gap-width"]),"line-offset":new Ht(qe.paint_line["line-offset"]),"line-blur":new Ht(qe.paint_line["line-blur"]),"line-dasharray":new qo(qe.paint_line["line-dasharray"]),"line-pattern":new Oo(qe.paint_line["line-pattern"]),"line-gradient":new Ml(qe.paint_line["line-gradient"])})},get layout(){return Wu=Wu||new u({"line-cap":new zt(qe.layout_line["line-cap"]),"line-join":new Ht(qe.layout_line["line-join"]),"line-miter-limit":new zt(qe.layout_line["line-miter-limit"]),"line-round-limit":new zt(qe.layout_line["line-round-limit"]),"line-sort-key":new Ht(qe.layout_line["line-sort-key"])})}};class ng extends Ht{possiblyEvaluate(t,r){return r=new Vi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,l){return r=ht({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,l)}}let th;class sg extends n{constructor(t){super(t,eA),this.gradientVersion=0,th||(th=new ng(eA.paint.properties["line-width"].specification),th.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ga,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=th.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Fh(t)}queryRadius(t){const r=t,s=tA(Cc("line-width",this,r),Cc("line-gap-width",this,r)),l=Cc("line-offset",this,r);return s/2+Math.abs(l)+Kc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,s,l,d,f,_){const b=Zc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,_),Q=_/2*tA(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),M=this.paint.get("line-offset").evaluate(r,s);return M&&(l=function(R,O){const Y=[];for(let W=0;W<R.length;W++){const ee=R[W],me=[];for(let ve=0;ve<ee.length;ve++){const Re=ee[ve-1],Ee=ee[ve],Pe=ee[ve+1],Ke=ve===0?new fe(0,0):Ee.sub(Re)._unit()._perp(),ot=ve===ee.length-1?new fe(0,0):Pe.sub(Ee)._unit()._perp(),St=Ke._add(ot)._unit(),Kt=St.x*ot.x+St.y*ot.y;Kt!==0&&St._mult(1/Kt),me.push(St._mult(O)._add(Ee))}Y.push(me)}return Y}(l,M*_)),function(R,O,Y){for(let W=0;W<O.length;W++){const ee=O[W];if(R.length>=3){for(let me=0;me<ee.length;me++)if(nc(R,ee[me]))return!0}if(ff(R,ee,Y))return!0}return!1}(b,l,Q)}isTileClipped(){return!0}}function tA(i,t){return t>0?t+2*i:i}const ag=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),og=I([{name:"a_projected_pos",components:3,type:"Float32"}],4);I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lg=I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const iA=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cg=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function hg(i,t,r){return i.sections.forEach(s=>{s.text=function(l,d,f){const _=d.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?l=l.toLocaleUpperCase():_==="lowercase"&&(l=l.toLocaleLowerCase()),rr.applyArabicShaping&&(l=rr.applyArabicShaping(l)),l}(s.text,t,r)}),i}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),I([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Pc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ir=24,rA=Ni,nA=function(i,t,r,s,l){var d,f,_=8*l-s-1,b=(1<<_)-1,Q=b>>1,M=-7,R=l-1,O=-1,Y=i[t+R];for(R+=O,d=Y&(1<<-M)-1,Y>>=-M,M+=_;M>0;d=256*d+i[t+R],R+=O,M-=8);for(f=d&(1<<-M)-1,d>>=-M,M+=s;M>0;f=256*f+i[t+R],R+=O,M-=8);if(d===0)d=1-Q;else{if(d===b)return f?NaN:1/0*(Y?-1:1);f+=Math.pow(2,s),d-=Q}return(Y?-1:1)*f*Math.pow(2,d-s)},sA=function(i,t,r,s,l,d){var f,_,b,Q=8*d-l-1,M=(1<<Q)-1,R=M>>1,O=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=0,W=1,ee=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,f=M):(f=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-f))<1&&(f--,b*=2),(t+=f+R>=1?O/b:O*Math.pow(2,1-R))*b>=2&&(f++,b/=2),f+R>=M?(_=0,f=M):f+R>=1?(_=(t*b-1)*Math.pow(2,l),f+=R):(_=t*Math.pow(2,R-1)*Math.pow(2,l),f=0));l>=8;i[r+Y]=255&_,Y+=W,_/=256,l-=8);for(f=f<<l|_,Q+=l;Q>0;i[r+Y]=255&f,Y+=W,f/=256,Q-=8);i[r+Y-W]|=128*ee};function Ni(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ni.Varint=0,Ni.Fixed64=1,Ni.Bytes=2,Ni.Fixed32=5;var zh=4294967296,aA=1/zh,oA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ao(i){return i.type===Ni.Bytes?i.readVarint()+i.pos:i.pos+1}function lc(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function lA(i,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function ug(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Ag(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function dg(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function fg(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function gg(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function pg(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function mg(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function yg(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function _g(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function ih(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function cc(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function cA(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Ni.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,d=this.pos;this.type=7&s,i(l,t,this),this.pos===d&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=ih(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=cA(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ih(this.buf,this.pos)+ih(this.buf,this.pos+4)*zh;return this.pos+=8,i},readSFixed64:function(){var i=ih(this.buf,this.pos)+cA(this.buf,this.pos+4)*zh;return this.pos+=8,i},readFloat:function(){var i=nA(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=nA(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(l,d,f){var _,b,Q=f.buf;if(_=(112&(b=Q[f.pos++]))>>4,b<128||(_|=(127&(b=Q[f.pos++]))<<3,b<128)||(_|=(127&(b=Q[f.pos++]))<<10,b<128)||(_|=(127&(b=Q[f.pos++]))<<17,b<128)||(_|=(127&(b=Q[f.pos++]))<<24,b<128)||(_|=(1&(b=Q[f.pos++]))<<31,b<128))return lc(l,_,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&oA?function(r,s,l){return oA.decode(r.subarray(s,l))}(this.buf,t,i):function(r,s,l){for(var d="",f=s;f<l;){var _,b,Q,M=r[f],R=null,O=M>239?4:M>223?3:M>191?2:1;if(f+O>l)break;O===1?M<128&&(R=M):O===2?(192&(_=r[f+1]))==128&&(R=(31&M)<<6|63&_)<=127&&(R=null):O===3?(b=r[f+2],(192&(_=r[f+1]))==128&&(192&b)==128&&((R=(15&M)<<12|(63&_)<<6|63&b)<=2047||R>=55296&&R<=57343)&&(R=null)):O===4&&(b=r[f+2],Q=r[f+3],(192&(_=r[f+1]))==128&&(192&b)==128&&(192&Q)==128&&((R=(15&M)<<18|(63&_)<<12|(63&b)<<6|63&Q)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,O=1):R>65535&&(R-=65536,d+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),d+=String.fromCharCode(R),f+=O}return d}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Ni.Bytes)return i.push(this.readVarint(t));var r=ao(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSVarint());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ni.Bytes)return i.push(this.readBoolean());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFloat());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ni.Bytes)return i.push(this.readDouble());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFixed32());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSFixed32());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFixed64());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSFixed64());var t=ao(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Ni.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ni.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ni.Fixed32)this.pos+=4;else{if(t!==Ni.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*aA),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*aA),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var s,l;if(t>=0?(s=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,f,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(s,0,r),function(d,f){var _=(7&d)<<4;f.buf[f.pos++]|=_|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,l,d){for(var f,_,b=0;b<l.length;b++){if((f=l.charCodeAt(b))>55295&&f<57344){if(!_){f>56319||b+1===l.length?(s[d++]=239,s[d++]=191,s[d++]=189):_=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(s[d++]=239,s[d++]=191,s[d++]=189,_=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&lA(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),sA(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),sA(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var s=this.pos-r;s>=128&&lA(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,r){this.writeTag(i,Ni.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,ug,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Ag,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,gg,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,dg,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,fg,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,pg,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,mg,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,yg,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,_g,t)},writeBytesField:function(i,t){this.writeTag(i,Ni.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Ni.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Ni.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Ni.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Ni.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Ni.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Ni.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Ni.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Ni.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Ni.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var Gh=X(rA);const Uh=3;function Ig(i,t,r){i===1&&r.readMessage(bg,t)}function bg(i,t,r){if(i===3){const{id:s,bitmap:l,width:d,height:f,left:_,top:b,advance:Q}=r.readMessage(vg,{});t.push({id:s,bitmap:new Qc({width:d+2*Uh,height:f+2*Uh},l),metrics:{width:d,height:f,left:_,top:b,advance:Q}})}}function vg(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const hA=Uh;function uA(i){let t=0,r=0;for(const f of i)t+=f.w*f.h,r=Math.max(r,f.w);i.sort((f,_)=>_.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,d=0;for(const f of i)for(let _=s.length-1;_>=0;_--){const b=s[_];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===b.w&&f.h===b.h){const Q=s.pop();_<s.length&&(s[_]=Q)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(s.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}const kn=1;class Nh{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:d,content:f,textFitWidth:_,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=d,this.content=f,this.version=s,this.textFitWidth=_,this.textFitHeight=b}get tl(){return[this.paddedRect.x+kn,this.paddedRect.y+kn]}get br(){return[this.paddedRect.x+this.paddedRect.w-kn,this.paddedRect.y+this.paddedRect.h-kn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*kn)/this.pixelRatio,(this.paddedRect.h-2*kn)/this.pixelRatio]}}class AA{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,s,d),this.addImages(r,l,d);const{w:f,h:_}=uA(d),b=new fs({width:f||1,height:_||1});for(const Q in t){const M=t[Q],R=s[Q].paddedRect;fs.copy(M.data,b,{x:0,y:0},{x:R.x+kn,y:R.y+kn},M.data)}for(const Q in r){const M=r[Q],R=l[Q].paddedRect,O=R.x+kn,Y=R.y+kn,W=M.data.width,ee=M.data.height;fs.copy(M.data,b,{x:0,y:0},{x:O,y:Y},M.data),fs.copy(M.data,b,{x:0,y:ee-1},{x:O,y:Y-1},{width:W,height:1}),fs.copy(M.data,b,{x:0,y:0},{x:O,y:Y+ee},{width:W,height:1}),fs.copy(M.data,b,{x:W-1,y:0},{x:O-1,y:Y},{width:1,height:ee}),fs.copy(M.data,b,{x:0,y:0},{x:O+W,y:Y},{width:1,height:ee})}this.image=b,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const d=t[l],f={x:0,y:0,w:d.data.width+2*kn,h:d.data.height+2*kn};s.push(f),r[l]=new Nh(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,d]=t.tl;s.update(r.data,void 0,{x:l,y:d})}}var jo;Bt("ImagePosition",Nh),Bt("ImageAtlas",AA),E.ah=void 0,(jo=E.ah||(E.ah={}))[jo.none=0]="none",jo[jo.horizontal=1]="horizontal",jo[jo.vertical=2]="vertical",jo[jo.horizontalOnly=3]="horizontalOnly";const Lc=-17;class Rc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Rc;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Rc;return r.imageName=t,r}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new hc;for(let l=0;l<t.sections.length;l++){const d=t.sections[l];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const l=t.charCodeAt(s+1)||null,d=t.charCodeAt(s-1)||null;r+=l&&Go(l)&&!Pc[t[s+1]]||d&&Go(d)&&!Pc[t[s-1]]||!Pc[t[s]]?t[s]:Pc[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&nh[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&nh[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new hc;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Rc.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Vt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Rc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rh(i,t,r,s,l,d,f,_,b,Q,M,R,O,Y,W){const ee=hc.fromFeature(i,l);let me;R===E.ah.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:Re}=rr;if(ve&&ee.sections.length===1){me=[];const Ke=ve(ee.toString(),Oh(ee,Q,d,t,s,Y));for(const ot of Ke){const St=new hc;St.text=ot,St.sections=ee.sections;for(let Kt=0;Kt<ot.length;Kt++)St.sectionIndex.push(0);me.push(St)}}else if(Re){me=[];const Ke=Re(ee.text,ee.sectionIndex,Oh(ee,Q,d,t,s,Y));for(const ot of Ke){const St=new hc;St.text=ot[0],St.sectionIndex=ot[1],St.sections=ee.sections,me.push(St)}}else me=function(Ke,ot){const St=[],Kt=Ke.text;let kt=0;for(const xt of ot)St.push(Ke.substring(kt,xt)),kt=xt;return kt<Kt.length&&St.push(Ke.substring(kt,Kt.length)),St}(ee,Oh(ee,Q,d,t,s,Y));const Ee=[],Pe={positionedLines:Ee,text:ee.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(Ke,ot,St,Kt,kt,xt,Nt,Ft,Pt,tt,qt,Ut){let ri=0,Hi=Lc,Oi=0,Cr=0;const Ds=Ft==="right"?1:Ft==="left"?0:.5;let Or=0;for(const lr of kt){lr.trim();const Qr=lr.getMaxScale(),an=(Qr-1)*Ir,qr={positionedGlyphs:[],lineOffset:0};Ke.positionedLines[Or]=qr;const yn=qr.positionedGlyphs;let Vr=0;if(!lr.length()){Hi+=xt,++Or;continue}for(let Sn=0;Sn<lr.length();Sn++){const Pi=lr.getSection(Sn),Ji=lr.getSectionIndex(Sn),Yi=lr.getCharCode(Sn);let Jn=0,nr=null,fc=null,La=null,Ra=Ir;const Ms=!(Pt===E.ah.horizontal||!qt&&!ro(Yi)||qt&&(nh[Yi]||(Er=Yi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Er)))));if(Pi.imageName){const ms=Kt[Pi.imageName];if(!ms)continue;La=Pi.imageName,Ke.iconsInText=Ke.iconsInText||!0,fc=ms.paddedRect;const Mr=ms.displaySize;Pi.scale=Pi.scale*Ir/Ut,nr={width:Mr[0],height:Mr[1],left:kn,top:-hA,advance:Ms?Mr[1]:Mr[0]},Jn=an+(Ir-Mr[1]*Pi.scale),Ra=nr.advance;const oo=Ms?Mr[0]*Pi.scale-Ir*Qr:Mr[1]*Pi.scale-Ir*Qr;oo>0&&oo>Vr&&(Vr=oo)}else{const ms=St[Pi.fontStack],Mr=ms&&ms[Yi];if(Mr&&Mr.rect)fc=Mr.rect,nr=Mr.metrics;else{const oo=ot[Pi.fontStack],Oc=oo&&oo[Yi];if(!Oc)continue;nr=Oc.metrics}Jn=(Qr-Pi.scale)*Ir}Ms?(Ke.verticalizable=!0,yn.push({glyph:Yi,imageName:La,x:ri,y:Hi+Jn,vertical:Ms,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Ji,metrics:nr,rect:fc}),ri+=Ra*Pi.scale+tt):(yn.push({glyph:Yi,imageName:La,x:ri,y:Hi+Jn,vertical:Ms,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:Ji,metrics:nr,rect:fc}),ri+=nr.advance*Pi.scale+tt)}yn.length!==0&&(Oi=Math.max(ri-tt,Oi),Cg(yn,0,yn.length-1,Ds,Vr)),ri=0;const ps=xt*Qr+Vr;qr.lineOffset=Math.max(Vr,an),Hi+=ps,Cr=Math.max(ps,Cr),++Or}var Er;const gn=Hi-Lc,{horizontalAlign:pn,verticalAlign:mn}=qh(Nt);(function(lr,Qr,an,qr,yn,Vr,ps,Sn,Pi){const Ji=(Qr-an)*yn;let Yi=0;Yi=Vr!==ps?-Sn*qr-Lc:(-qr*Pi+.5)*ps;for(const Jn of lr)for(const nr of Jn.positionedGlyphs)nr.x+=Ji,nr.y+=Yi})(Ke.positionedLines,Ds,pn,mn,Oi,Cr,xt,gn,kt.length),Ke.top+=-mn*gn,Ke.bottom=Ke.top+gn,Ke.left+=-pn*Oi,Ke.right=Ke.left+Oi}(Pe,t,r,s,me,f,_,b,R,Q,O,W),!function(Ke){for(const ot of Ke)if(ot.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&Pe}const nh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wg={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},xg={40:!0};function dA(i,t,r,s,l,d){if(t.imageName){const f=s[t.imageName];return f?f.displaySize[0]*t.scale*Ir/d+l:0}{const f=r[t.fontStack],_=f&&f[i];return _?_.metrics.advance*t.scale+l:0}}function fA(i,t,r,s){const l=Math.pow(i-t,2);return s?i<t?l/2:2*l:l+Math.abs(r)*r}function Bg(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function gA(i,t,r,s,l,d){let f=null,_=fA(t,r,l,d);for(const b of s){const Q=fA(t-b.x,r,l,d)+b.badness;Q<=_&&(f=b,_=Q)}return{index:i,x:t,priorBreak:f,badness:_}}function pA(i){return i?pA(i.priorBreak).concat(i.index):[]}function Oh(i,t,r,s,l,d){if(!i)return[];const f=[],_=function(R,O,Y,W,ee,me){let ve=0;for(let Re=0;Re<R.length();Re++){const Ee=R.getSection(Re);ve+=dA(R.getCharCode(Re),Ee,W,ee,O,me)}return ve/Math.max(1,Math.ceil(ve/Y))}(i,t,r,s,l,d),b=i.text.indexOf("")>=0;let Q=0;for(let R=0;R<i.length();R++){const O=i.getSection(R),Y=i.getCharCode(R);if(nh[Y]||(Q+=dA(Y,O,s,l,t,d)),R<i.length()-1){const W=!((M=Y)<11904)&&(!!gi["CJK Compatibility Forms"](M)||!!gi["CJK Compatibility"](M)||!!gi["CJK Strokes"](M)||!!gi["CJK Symbols and Punctuation"](M)||!!gi["Enclosed CJK Letters and Months"](M)||!!gi["Halfwidth and Fullwidth Forms"](M)||!!gi["Ideographic Description Characters"](M)||!!gi["Vertical Forms"](M)||Sl.test(String.fromCodePoint(M)));(wg[Y]||W||O.imageName||R!==i.length()-2&&xg[i.getCharCode(R+1)])&&f.push(gA(R+1,Q,_,f,Bg(Y,i.getCharCode(R+1),W&&b),!1))}}var M;return pA(gA(i.length(),Q,_,f,0,!0))}function qh(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Cg(i,t,r,s,l){if(!s&&!l)return;const d=i[r],f=(i[r].x+d.metrics.advance*d.scale)*s;for(let _=t;_<=r;_++)i[_].x-=f,i[_].y+=l}function Eg(i,t,r){const{horizontalAlign:s,verticalAlign:l}=qh(r),d=t[0]-i.displaySize[0]*s,f=t[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function mA(i){var t,r;let s=i.left,l=i.top,d=i.right-s,f=i.bottom-l;const _=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",Q=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(b==="proportional"){if(_==="stretchOnly"&&d/f<Q||_==="proportional"){const M=Math.ceil(f*Q);s*=M/d,d=M}}else if(_==="proportional"&&b==="stretchOnly"&&Q!==0&&d/f>Q){const M=Math.ceil(d/Q);l*=M/f,f=M}return{x1:s,y1:l,x2:s+d,y2:l+f}}function yA(i,t,r,s,l,d){const f=i.image;let _;if(f.content){const me=f.content,ve=f.pixelRatio||1;_=[me[0]/ve,me[1]/ve,f.displaySize[0]-me[2]/ve,f.displaySize[1]-me[3]/ve]}const b=t.left*d,Q=t.right*d;let M,R,O,Y;r==="width"||r==="both"?(Y=l[0]+b-s[3],R=l[0]+Q+s[1]):(Y=l[0]+(b+Q-f.displaySize[0])/2,R=Y+f.displaySize[0]);const W=t.top*d,ee=t.bottom*d;return r==="height"||r==="both"?(M=l[1]+W-s[0],O=l[1]+ee+s[2]):(M=l[1]+(W+ee-f.displaySize[1])/2,O=M+f.displaySize[1]),{image:f,top:M,right:R,bottom:O,left:Y,collisionPadding:_}}const Fc=255,Pa=128,Jo=Fc*Pa;function _A(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Vi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let d=0;for(;d<s.length&&s[d]<=i;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<i+1;)f++;f=Math.min(s.length-1,f);const _=s[d],b=s[f];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:_,maxZoom:b,minSize:r.evaluate(new Vi(_)),maxSize:r.evaluate(new Vi(b)),interpolationType:l}}}function Vh(i,t,r){let s="never";const l=i.get(t);return l?s=l:i.get(r)&&(s="always"),s}const Qg=Ho.VectorTileFeature.types,kg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sh(i,t,r,s,l,d,f,_,b,Q,M,R,O){const Y=_?Math.min(Jo,Math.round(_[0])):0,W=_?Math.min(Jo,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),d,f,(Y<<1)+(b?1:0),W,16*Q,16*M,256*R,256*O)}function Hh(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function Sg(i){for(const t of i.sections)if(Bc(t.text))return!0;return!1}class jh{constructor(t){this.layoutVertexArray=new Ve,this.indexArray=new Rt,this.programConfigurations=t,this.segments=new ut,this.dynamicLayoutVertexArray=new ze,this.opacityVertexArray=new it,this.hasVisibleVertices=!1,this.placedSymbolArray=new be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ag.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,og.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,kg,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Bt("SymbolBuffers",jh);class Jh{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ut,this.collisionVertexArray=new ft}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,lg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Bt("CollisionBuffers",Jh);class uc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ch([]),this.placementViewportMatrix=Ch([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_A(this.zoom,r["text-size"]),this.iconSizeData=_A(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=Vh(s,"text-overlap","text-allow-overlap")!=="never"||Vh(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(f=>E.ah[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new jh(new Tl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new jh(new Tl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new G,this.lineVertexArray=new Ae,this.symbolInstances=new K,this.textAnchorOffsets=new le}calculateGlyphDependencies(t,r,s,l,d){for(let f=0;f<t.length;f++)if(r[t.charCodeAt(f)]=!0,(s||l)&&d){const _=Pc[t.charAt(f)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,s){const l=this.layers[0],d=l.layout,f=d.get("text-font"),_=d.get("text-field"),b=d.get("icon-image"),Q=(_.value.kind!=="constant"||_.value.value instanceof Rr&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),M=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,R=d.get("symbol-sort-key");if(this.features=[],!Q&&!M)return;const O=r.iconDependencies,Y=r.glyphDependencies,W=r.availableImages,ee=new Vi(this.zoom);for(const{feature:me,id:ve,index:Re,sourceLayerIndex:Ee}of t){const Pe=l._featureFilter.needGeometry,Ke=Ll(me,Pe);if(!l._featureFilter.filter(ee,Ke,s))continue;let ot,St;if(Pe||(Ke.geometry=Pl(me)),Q){const kt=l.getValueAndResolveTokens("text-field",Ke,s,W),xt=Rr.factory(kt),Nt=this.hasRTLText=this.hasRTLText||Sg(xt);(!Nt||rr.getRTLTextPluginStatus()==="unavailable"||Nt&&rr.isParsed())&&(ot=hg(xt,l,Ke))}if(M){const kt=l.getValueAndResolveTokens("icon-image",Ke,s,W);St=kt instanceof $r?kt:$r.fromString(kt)}if(!ot&&!St)continue;const Kt=this.sortFeaturesByKey?R.evaluate(Ke,{},s):void 0;if(this.features.push({id:ve,text:ot,icon:St,index:Re,sourceLayerIndex:Ee,geometry:Ke.geometry,properties:me.properties,type:Qg[me.type],sortKey:Kt}),St&&(O[St.name]=!0),ot){const kt=f.evaluate(Ke,{},s).join(","),xt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(E.ah.vertical)>=0;for(const Nt of ot.sections)if(Nt.image)O[Nt.image.name]=!0;else{const Ft=kl(ot.toString()),Pt=Nt.fontStack||kt,tt=Y[Pt]=Y[Pt]||{};this.calculateGlyphDependencies(Nt.text,tt,xt,this.allowVerticalPlacement,Ft)}}}d.get("symbol-placement")==="line"&&(this.features=function(me){const ve={},Re={},Ee=[];let Pe=0;function Ke(kt){Ee.push(me[kt]),Pe++}function ot(kt,xt,Nt){const Ft=Re[kt];return delete Re[kt],Re[xt]=Ft,Ee[Ft].geometry[0].pop(),Ee[Ft].geometry[0]=Ee[Ft].geometry[0].concat(Nt[0]),Ft}function St(kt,xt,Nt){const Ft=ve[xt];return delete ve[xt],ve[kt]=Ft,Ee[Ft].geometry[0].shift(),Ee[Ft].geometry[0]=Nt[0].concat(Ee[Ft].geometry[0]),Ft}function Kt(kt,xt,Nt){const Ft=Nt?xt[0][xt[0].length-1]:xt[0][0];return`${kt}:${Ft.x}:${Ft.y}`}for(let kt=0;kt<me.length;kt++){const xt=me[kt],Nt=xt.geometry,Ft=xt.text?xt.text.toString():null;if(!Ft){Ke(kt);continue}const Pt=Kt(Ft,Nt),tt=Kt(Ft,Nt,!0);if(Pt in Re&&tt in ve&&Re[Pt]!==ve[tt]){const qt=St(Pt,tt,Nt),Ut=ot(Pt,tt,Ee[qt].geometry);delete ve[Pt],delete Re[tt],Re[Kt(Ft,Ee[Ut].geometry,!0)]=Ut,Ee[qt].geometry=null}else Pt in Re?ot(Pt,tt,Nt):tt in ve?St(Pt,tt,Nt):(Ke(kt),ve[Pt]=Pe-1,Re[tt]=Pe-1)}return Ee.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,ve)=>me.sortKey-ve.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),d=t.dist(r[t.segment]);const f={};for(let _=t.segment+1;_<r.length;_++)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:l},_<r.length-1&&(l+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:d},_>0&&(d+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const b=f[_];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,d,f,_,b,Q,M,R,O){const Y=t.indexArray,W=t.layoutVertexArray,ee=t.segments.prepareSegment(4*r.length,W,Y,this.canOverlap?f.sortKey:void 0),me=this.glyphOffsetArray.length,ve=ee.vertexLength,Re=this.allowVerticalPlacement&&_===E.ah.vertical?Math.PI/2:0,Ee=f.text&&f.text.sections;for(let Pe=0;Pe<r.length;Pe++){const{tl:Ke,tr:ot,bl:St,br:Kt,tex:kt,pixelOffsetTL:xt,pixelOffsetBR:Nt,minFontScaleX:Ft,minFontScaleY:Pt,glyphOffset:tt,isSDF:qt,sectionIndex:Ut}=r[Pe],ri=ee.vertexLength,Hi=tt[1];sh(W,b.x,b.y,Ke.x,Hi+Ke.y,kt.x,kt.y,s,qt,xt.x,xt.y,Ft,Pt),sh(W,b.x,b.y,ot.x,Hi+ot.y,kt.x+kt.w,kt.y,s,qt,Nt.x,xt.y,Ft,Pt),sh(W,b.x,b.y,St.x,Hi+St.y,kt.x,kt.y+kt.h,s,qt,xt.x,Nt.y,Ft,Pt),sh(W,b.x,b.y,Kt.x,Hi+Kt.y,kt.x+kt.w,kt.y+kt.h,s,qt,Nt.x,Nt.y,Ft,Pt),Hh(t.dynamicLayoutVertexArray,b,Re),Y.emplaceBack(ri,ri+1,ri+2),Y.emplaceBack(ri+1,ri+2,ri+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),Pe!==r.length-1&&Ut===r[Pe+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,f,f.index,{},O,Ee&&Ee[Ut])}t.placedSymbolArray.emplaceBack(b.x,b.y,me,this.glyphOffsetArray.length-me,ve,Q,M,b.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],_,0,!1,0,R)}_addCollisionDebugVertex(t,r,s,l,d,f){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,l,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,r,s,l,d,f,_){const b=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),Q=b.vertexLength,M=d.layoutVertexArray,R=d.collisionVertexArray,O=_.anchorX,Y=_.anchorY;this._addCollisionDebugVertex(M,R,f,O,Y,new fe(t,r)),this._addCollisionDebugVertex(M,R,f,O,Y,new fe(s,r)),this._addCollisionDebugVertex(M,R,f,O,Y,new fe(s,l)),this._addCollisionDebugVertex(M,R,f,O,Y,new fe(t,l)),b.vertexLength+=4;const W=d.indexArray;W.emplaceBack(Q,Q+1),W.emplaceBack(Q+1,Q+2),W.emplaceBack(Q+2,Q+3),W.emplaceBack(Q+3,Q),b.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,l){for(let d=t;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jh(Dt,iA.members,At),this.iconCollisionBox=new Jh(Dt,iA.members,At);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,l,d,f,_,b,Q){const M={};for(let R=r;R<s;R++){const O=t.get(R);M.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.textFeatureIndex=O.featureIndex;break}for(let R=l;R<d;R++){const O=t.get(R);M.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.verticalTextFeatureIndex=O.featureIndex;break}for(let R=f;R<_;R++){const O=t.get(R);M.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.iconFeatureIndex=O.featureIndex;break}for(let R=b;R<Q;R++){const O=t.get(R);M.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.verticalIconFeatureIndex=O.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const b=this.symbolInstances.get(_);l.push(0|Math.round(r*b.anchorX+s*b.anchorY)),d.push(b.featureIndex)}return f.sort((_,b)=>l[_]-l[b]||d[b]-d[_]),f}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,d,f)=>{l>=0&&f.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let IA,bA;Bt("SymbolBucket",uc,{omit:["layers","collisionBoxArray","features","compareText"]}),uc.MAX_GLYPHS=65535,uc.addDynamicAttributes=Hh;var Yh={get paint(){return bA=bA||new u({"icon-opacity":new Ht(qe.paint_symbol["icon-opacity"]),"icon-color":new Ht(qe.paint_symbol["icon-color"]),"icon-halo-color":new Ht(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(qe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(qe.paint_symbol["text-opacity"]),"text-color":new Ht(qe.paint_symbol["text-color"],{runtimeType:Wt,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ht(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(qe.paint_symbol["text-halo-blur"]),"text-translate":new zt(qe.paint_symbol["text-translate"]),"text-translate-anchor":new zt(qe.paint_symbol["text-translate-anchor"])})},get layout(){return IA=IA||new u({"symbol-placement":new zt(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(qe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(qe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(qe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(qe.layout_symbol["icon-size"]),"icon-text-fit":new zt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(qe.layout_symbol["icon-image"]),"icon-rotate":new Ht(qe.layout_symbol["icon-rotate"]),"icon-padding":new Ht(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(qe.layout_symbol["icon-offset"]),"icon-anchor":new Ht(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(qe.layout_symbol["text-field"]),"text-font":new Ht(qe.layout_symbol["text-font"]),"text-size":new Ht(qe.layout_symbol["text-size"]),"text-max-width":new Ht(qe.layout_symbol["text-max-width"]),"text-line-height":new zt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(qe.layout_symbol["text-justify"]),"text-radial-offset":new Ht(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(qe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ht(qe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ht(qe.layout_symbol["text-anchor"]),"text-max-angle":new zt(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(qe.layout_symbol["text-rotate"]),"text-padding":new zt(qe.layout_symbol["text-padding"]),"text-keep-upright":new zt(qe.layout_symbol["text-keep-upright"]),"text-transform":new Ht(qe.layout_symbol["text-transform"]),"text-offset":new Ht(qe.layout_symbol["text-offset"]),"text-allow-overlap":new zt(qe.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(qe.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(qe.layout_symbol["text-ignore-placement"]),"text-optional":new zt(qe.layout_symbol["text-optional"])})}};class vA{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:hn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt("FormatSectionOverride",vA,{omit:["defaultValue"]});class ah extends n{constructor(t){super(t,Yh)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const d of s)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const d=this.layout.get(t).evaluate(r,{},s,l),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||ko(f.value)||!d?d:function(_,b){return b.replace(/{([^{}]+)}/g,(Q,M)=>_&&M in _?String(_[M]):"")}(r.properties,d)}createBucket(t){return new uc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Yh.paint.overridableProperties){if(!ah.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new vA(r),l=new Ca(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Vn("source",l):new as("composite",l,r.value.zoomStops),this.paint._values[t]=new Hn(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&ah.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=Yh.paint.properties[r];let d=!1;const f=_=>{for(const b of _)if(l.overrides&&l.overrides.hasOverride(b))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Rr)f(s.value.value.sections);else if(s.value.kind==="source"){const _=Q=>{d||(Q instanceof bn&&or(Q.value)===zn?f(Q.value.sections):Q instanceof zs?f(Q.sections):Q.eachChild(_))},b=s.value;b._styleExpression&&_(b._styleExpression.expression)}return d}}let wA;var Dg={get paint(){return wA=wA||new u({"background-color":new zt(qe.paint_background["background-color"]),"background-pattern":new qo(qe.paint_background["background-pattern"]),"background-opacity":new zt(qe.paint_background["background-opacity"])})}};class Mg extends n{constructor(t){super(t,Dg)}}let xA;var Tg={get paint(){return xA=xA||new u({"raster-opacity":new zt(qe.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(qe.paint_raster["raster-saturation"]),"raster-contrast":new zt(qe.paint_raster["raster-contrast"]),"raster-resampling":new zt(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(qe.paint_raster["raster-fade-duration"])})}};class Pg extends n{constructor(t){super(t,Tg)}}class Lg extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Rg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Kh=63710088e-1;class Yo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yo(Qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,d=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return Kh*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof Yo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Yo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Yo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const BA=2*Math.PI*Kh;function CA(i){return BA*Math.cos(i*Math.PI/180)}function EA(i){return(180+i)/360}function QA(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function kA(i,t){return i/CA(t)}function Zh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class zc{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Yo.convert(t);return new zc(EA(s.lng),QA(s.lat),kA(r,s.lat))}toLngLat(){return new Yo(360*this.x-180,Zh(this.y))}toAltitude(){return this.z*CA(Zh(this.y))}meterInMercatorCoordinateUnits(){return 1/BA*(t=Zh(this.y),1/Math.cos(t*Math.PI/180));var t}}function SA(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class $h{constructor(t,r,s){if(!function(l,d,f){return!(l<0||l>25||f<0||f>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Gc(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const l=(f=this.y,_=this.z,b=SA(256*(d=this.x),256*(f=Math.pow(2,_)-f-1),_),Q=SA(256*(d+1),256*(f+1),_),b[0]+","+b[1]+","+Q[0]+","+Q[1]);var d,f,_,b,Q;const M=function(R,O,Y){let W,ee="";for(let me=R;me>0;me--)W=1<<me-1,ee+=(O&W?1:0)+(Y&W?2:0);return ee}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new fe((t.x*r-this.x)*gr,(t.y*r-this.y)*gr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class DA{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Gc(t,r.z,r.z,r.x,r.y)}}class gs{constructor(t,r,s,l,d){if(t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new $h(s,+l,+d),this.key=Gc(r,t,s,l,d)}clone(){return new gs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new gs(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Gc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Gc(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new gs(r,this.wrap,r,s,l),new gs(r,this.wrap,r,s+1,l),new gs(r,this.wrap,r,s,l+1),new gs(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new gs(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new DA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new zc(t.x-this.wrap,t.y))}}function Gc(i,t,r,s,l){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*l+s).toString(36)+r.toString(36)+t.toString(36)}Bt("CanonicalTileID",$h),Bt("OverscaledTileID",gs,{omit:["posMatrix"]});class MA{constructor(t,r,s,l=1,d=1,f=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Vt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=f,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let Q=0;Q<b;Q++)this.data[this._idx(-1,Q)]=this.data[this._idx(0,Q)],this.data[this._idx(b,Q)]=this.data[this._idx(b-1,Q)],this.data[this._idx(Q,-1)]=this.data[this._idx(Q,0)],this.data[this._idx(Q,b)]=this.data[this._idx(Q,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let Q=0;Q<b;Q++)for(let M=0;M<b;M++){const R=this.get(Q,M);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(t,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new fs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,d=r*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:l=d-1;break;case 1:d=l+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const b=-r*this.dim,Q=-s*this.dim;for(let M=f;M<_;M++)for(let R=l;R<d;R++)this.data[this._idx(R,M)]=t.data[this._idx(R+b,M+Q)]}}Bt("DEMData",MA);class TA{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class PA{constructor(t,r,s,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class LA{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new hs(gr,16,0),this.grid3D=new hs(gr,16,0),this.featureIndexArray=new De,this.promoteId=r}insert(t,r,s,l,d,f){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,d);const b=f?this.grid3D:this.grid;for(let Q=0;Q<r.length;Q++){const M=r[Q],R=[1/0,1/0,-1/0,-1/0];for(let O=0;O<M.length;O++){const Y=M[O];R[0]=Math.min(R[0],Y.x),R[1]=Math.min(R[1],Y.y),R[2]=Math.max(R[2],Y.x),R[3]=Math.max(R[3],Y.y)}R[0]<gr&&R[1]<gr&&R[2]>=0&&R[3]>=0&&b.insert(_,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ho.VectorTile(new Gh(this.rawTileData)).layers,this.sourceLayerCoder=new TA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,l){this.loadVTLayers();const d=t.params||{},f=gr/t.tileSize/t.scale,_=Qs(d.filter),b=t.queryGeometry,Q=t.queryPadding*f,M=FA(b),R=this.grid.query(M.minX-Q,M.minY-Q,M.maxX+Q,M.maxY+Q),O=FA(t.cameraQueryGeometry),Y=this.grid3D.query(O.minX-Q,O.minY-Q,O.maxX+Q,O.maxY+Q,(me,ve,Re,Ee)=>function(Pe,Ke,ot,St,Kt){for(const xt of Pe)if(Ke<=xt.x&&ot<=xt.y&&St>=xt.x&&Kt>=xt.y)return!0;const kt=[new fe(Ke,ot),new fe(Ke,Kt),new fe(St,Kt),new fe(St,ot)];if(Pe.length>2){for(const xt of kt)if(nc(Pe,xt))return!0}for(let xt=0;xt<Pe.length-1;xt++)if(pf(Pe[xt],Pe[xt+1],kt))return!0;return!1}(t.cameraQueryGeometry,me-Q,ve-Q,Re+Q,Ee+Q));for(const me of Y)R.push(me);R.sort(Fg);const W={};let ee;for(let me=0;me<R.length;me++){const ve=R[me];if(ve===ee)continue;ee=ve;const Re=this.featureIndexArray.get(ve);let Ee=null;this.loadMatchingFeature(W,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,_,d.layers,d.availableImages,r,s,l,(Pe,Ke,ot)=>(Ee||(Ee=Pl(Pe)),Ke.queryIntersectsFeature(b,Pe,ot,Ee,this.z,t.transform,f,t.pixelPosMatrix)))}return W}loadMatchingFeature(t,r,s,l,d,f,_,b,Q,M,R){const O=this.bucketLayerIDs[r];if(f&&!function(me,ve){for(let Re=0;Re<me.length;Re++)if(ve.indexOf(me[Re])>=0)return!0;return!1}(f,O))return;const Y=this.sourceLayerCoder.decode(s),W=this.vtLayers[Y].feature(l);if(d.needGeometry){const me=Ll(W,!0);if(!d.filter(new Vi(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!d.filter(new Vi(this.tileID.overscaledZ),W))return;const ee=this.getId(W,Y);for(let me=0;me<O.length;me++){const ve=O[me];if(f&&f.indexOf(ve)<0)continue;const Re=b[ve];if(!Re)continue;let Ee={};ee&&M&&(Ee=M.getState(Re.sourceLayer||"_geojsonTileLayer",ee));const Pe=ht({},Q[ve]);Pe.paint=RA(Pe.paint,Re.paint,W,Ee,_),Pe.layout=RA(Pe.layout,Re.layout,W,Ee,_);const Ke=!R||R(W,Re,Ee);if(!Ke)continue;const ot=new PA(W,this.z,this.x,this.y,ee);ot.layer=Pe;let St=t[ve];St===void 0&&(St=t[ve]=[]),St.push({featureIndex:l,feature:ot,intersectionZ:Ke})}}lookupSymbolFeatures(t,r,s,l,d,f,_,b){const Q={};this.loadVTLayers();const M=Qs(d);for(const R of t)this.loadMatchingFeature(Q,s,l,R,M,f,_,b,r);return Q}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;return this.promoteId&&(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function RA(i,t,r,s,l){return vt(i,(d,f)=>{const _=t instanceof Ma?t.get(f):null;return _&&_.evaluate?_.evaluate(r,s,l):_})}function FA(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of i)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return{minX:t,minY:r,maxX:s,maxY:l}}function Fg(i,t){return t-i}function zA(i,t,r,s,l){const d=[];for(let f=0;f<i.length;f++){const _=i[f];let b;for(let Q=0;Q<_.length-1;Q++){let M=_[Q],R=_[Q+1];M.x<t&&R.x<t||(M.x<t?M=new fe(t,M.y+(t-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x<t&&(R=new fe(t,M.y+(t-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y<r&&R.y<r||(M.y<r?M=new fe(M.x+(r-M.y)/(R.y-M.y)*(R.x-M.x),r)._round():R.y<r&&(R=new fe(M.x+(r-M.y)/(R.y-M.y)*(R.x-M.x),r)._round()),M.x>=s&&R.x>=s||(M.x>=s?M=new fe(s,M.y+(s-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x>=s&&(R=new fe(s,M.y+(s-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y>=l&&R.y>=l||(M.y>=l?M=new fe(M.x+(l-M.y)/(R.y-M.y)*(R.x-M.x),l)._round():R.y>=l&&(R=new fe(M.x+(l-M.y)/(R.y-M.y)*(R.x-M.x),l)._round()),b&&M.equals(b[b.length-1])||(b=[M],d.push(b)),b.push(R)))))}}return d}Bt("FeatureIndex",LA,{omit:["rawTileData","sourceLayerCoder"]});class Ko extends fe{constructor(t,r,s,l){super(t,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Ko(this.x,this.y,this.angle,this.segment)}}function GA(i,t,r,s,l){if(t.segment===void 0||r===0)return!0;let d=t,f=t.segment+1,_=0;for(;_>-r/2;){if(f--,f<0)return!1;_-=i[f].dist(d),d=i[f]}_+=i[f].dist(i[f+1]),f++;const b=[];let Q=0;for(;_<r/2;){const M=i[f],R=i[f+1];if(!R)return!1;let O=i[f-1].angleTo(M)-M.angleTo(R);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:_,angleDelta:O}),Q+=O;_-b[0].distance>s;)Q-=b.shift().angleDelta;if(Q>l)return!1;f++,_+=M.dist(R)}return!0}function UA(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function NA(i,t,r){return i?.6*t*r:0}function OA(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function zg(i,t,r,s,l,d){const f=NA(r,l,d),_=OA(r,s)*d;let b=0;const Q=UA(i)/2;for(let M=0;M<i.length-1;M++){const R=i[M],O=i[M+1],Y=R.dist(O);if(b+Y>Q){const W=(Q-b)/Y,ee=_r.number(R.x,O.x,W),me=_r.number(R.y,O.y,W),ve=new Ko(ee,me,O.angleTo(R),M);return ve._round(),!f||GA(i,ve,_,f,t)?ve:void 0}b+=Y}}function Gg(i,t,r,s,l,d,f,_,b){const Q=NA(s,d,f),M=OA(s,l),R=M*f,O=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return t-R<t/4&&(t=R+t/4),qA(i,O?t/2*_%t:(M/2+2*d)*f*_%t,t,Q,r,R,O,!1,b)}function qA(i,t,r,s,l,d,f,_,b){const Q=d/2,M=UA(i);let R=0,O=t-r,Y=[];for(let W=0;W<i.length-1;W++){const ee=i[W],me=i[W+1],ve=ee.dist(me),Re=me.angleTo(ee);for(;O+r<R+ve;){O+=r;const Ee=(O-R)/ve,Pe=_r.number(ee.x,me.x,Ee),Ke=_r.number(ee.y,me.y,Ee);if(Pe>=0&&Pe<b&&Ke>=0&&Ke<b&&O-Q>=0&&O+Q<=M){const ot=new Ko(Pe,Ke,Re,W);ot._round(),s&&!GA(i,ot,d,s,l)||Y.push(ot)}}R+=ve}return _||Y.length||f||(Y=qA(i,R/2,r,s,l,d,f,!0,b)),Y}Bt("Anchor",Ko);const Ac=kn;function VA(i,t,r,s){const l=[],d=i.image,f=d.pixelRatio,_=d.paddedRect.w-2*Ac,b=d.paddedRect.h-2*Ac;let Q={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const M=d.stretchX||[[0,_]],R=d.stretchY||[[0,b]],O=(tt,qt)=>tt+qt[1]-qt[0],Y=M.reduce(O,0),W=R.reduce(O,0),ee=_-Y,me=b-W;let ve=0,Re=Y,Ee=0,Pe=W,Ke=0,ot=ee,St=0,Kt=me;if(d.content&&s){const tt=d.content,qt=tt[2]-tt[0],Ut=tt[3]-tt[1];(d.textFitWidth||d.textFitHeight)&&(Q=mA(i)),ve=oh(M,0,tt[0]),Ee=oh(R,0,tt[1]),Re=oh(M,tt[0],tt[2]),Pe=oh(R,tt[1],tt[3]),Ke=tt[0]-ve,St=tt[1]-Ee,ot=qt-Re,Kt=Ut-Pe}const kt=Q.x1,xt=Q.y1,Nt=Q.x2-kt,Ft=Q.y2-xt,Pt=(tt,qt,Ut,ri)=>{const Hi=lh(tt.stretch-ve,Re,Nt,kt),Oi=ch(tt.fixed-Ke,ot,tt.stretch,Y),Cr=lh(qt.stretch-Ee,Pe,Ft,xt),Ds=ch(qt.fixed-St,Kt,qt.stretch,W),Or=lh(Ut.stretch-ve,Re,Nt,kt),Er=ch(Ut.fixed-Ke,ot,Ut.stretch,Y),gn=lh(ri.stretch-Ee,Pe,Ft,xt),pn=ch(ri.fixed-St,Kt,ri.stretch,W),mn=new fe(Hi,Cr),lr=new fe(Or,Cr),Qr=new fe(Or,gn),an=new fe(Hi,gn),qr=new fe(Oi/f,Ds/f),yn=new fe(Er/f,pn/f),Vr=t*Math.PI/180;if(Vr){const Pi=Math.sin(Vr),Ji=Math.cos(Vr),Yi=[Ji,-Pi,Pi,Ji];mn._matMult(Yi),lr._matMult(Yi),an._matMult(Yi),Qr._matMult(Yi)}const ps=tt.stretch+tt.fixed,Sn=qt.stretch+qt.fixed;return{tl:mn,tr:lr,bl:an,br:Qr,tex:{x:d.paddedRect.x+Ac+ps,y:d.paddedRect.y+Ac+Sn,w:Ut.stretch+Ut.fixed-ps,h:ri.stretch+ri.fixed-Sn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qr,pixelOffsetBR:yn,minFontScaleX:ot/f/Nt,minFontScaleY:Kt/f/Ft,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const tt=HA(M,ee,Y),qt=HA(R,me,W);for(let Ut=0;Ut<tt.length-1;Ut++){const ri=tt[Ut],Hi=tt[Ut+1];for(let Oi=0;Oi<qt.length-1;Oi++)l.push(Pt(ri,qt[Oi],Hi,qt[Oi+1]))}}else l.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:b+1}));return l}function oh(i,t,r){let s=0;for(const l of i)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function HA(i,t,r){const s=[{fixed:-Ac,stretch:0}];for(const[l,d]of i){const f=s[s.length-1];s.push({fixed:l-f.stretch,stretch:f.stretch}),s.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return s.push({fixed:t+Ac,stretch:r}),s}function lh(i,t,r,s){return i/t*r+s}function ch(i,t,r,s){return i-t*r/s}class hh{constructor(t,r,s,l,d,f,_,b,Q,M){var R;if(this.boxStartIndex=t.length,Q){let O=f.top,Y=f.bottom;const W=f.collisionPadding;W&&(O-=W[1],Y+=W[3]);let ee=Y-O;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{const O=!((R=f.image)===null||R===void 0)&&R.content&&(f.image.textFitWidth||f.image.textFitHeight)?mA(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};O.y1=O.y1*_-b[0],O.y2=O.y2*_+b[2],O.x1=O.x1*_-b[3],O.x2=O.x2*_+b[1];const Y=f.collisionPadding;if(Y&&(O.x1-=Y[0]*_,O.y1-=Y[1]*_,O.x2+=Y[2]*_,O.y2+=Y[3]*_),M){const W=new fe(O.x1,O.y1),ee=new fe(O.x2,O.y1),me=new fe(O.x1,O.y2),ve=new fe(O.x2,O.y2),Re=M*Math.PI/180;W._rotate(Re),ee._rotate(Re),me._rotate(Re),ve._rotate(Re),O.x1=Math.min(W.x,ee.x,me.x,ve.x),O.x2=Math.max(W.x,ee.x,me.x,ve.x),O.y1=Math.min(W.y,ee.y,me.y,ve.y),O.y2=Math.max(W.y,ee.y,me.y,ve.y)}t.emplaceBack(r.x,r.y,O.x1,O.y1,O.x2,O.y2,s,l,d)}this.boxEndIndex=t.length}}class Ug{constructor(t=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,l=r[t];for(;t>0;){const d=t-1>>1,f=r[d];if(s(l,f)>=0)break;r[t]=f,t=d}r[t]=l}_down(t){const{data:r,compare:s}=this,l=this.length>>1,d=r[t];for(;t<l;){let f=1+(t<<1);const _=f+1;if(_<this.length&&s(r[_],r[f])<0&&(f=_),s(r[f],d)>=0)break;r[t]=r[f],t=f}r[t]=d}}function Ng(i,t=1,r=!1){let s=1/0,l=1/0,d=-1/0,f=-1/0;const _=i[0];for(let Y=0;Y<_.length;Y++){const W=_[Y];(!Y||W.x<s)&&(s=W.x),(!Y||W.y<l)&&(l=W.y),(!Y||W.x>d)&&(d=W.x),(!Y||W.y>f)&&(f=W.y)}const b=Math.min(d-s,f-l);let Q=b/2;const M=new Ug([],Og);if(b===0)return new fe(s,l);for(let Y=s;Y<d;Y+=b)for(let W=l;W<f;W+=b)M.push(new dc(Y+Q,W+Q,Q,i));let R=function(Y){let W=0,ee=0,me=0;const ve=Y[0];for(let Re=0,Ee=ve.length,Pe=Ee-1;Re<Ee;Pe=Re++){const Ke=ve[Re],ot=ve[Pe],St=Ke.x*ot.y-ot.x*Ke.y;ee+=(Ke.x+ot.x)*St,me+=(Ke.y+ot.y)*St,W+=3*St}return new dc(ee/W,me/W,0,Y)}(i),O=M.length;for(;M.length;){const Y=M.pop();(Y.d>R.d||!R.d)&&(R=Y,r&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,O)),Y.max-R.d<=t||(Q=Y.h/2,M.push(new dc(Y.p.x-Q,Y.p.y-Q,Q,i)),M.push(new dc(Y.p.x+Q,Y.p.y-Q,Q,i)),M.push(new dc(Y.p.x-Q,Y.p.y+Q,Q,i)),M.push(new dc(Y.p.x+Q,Y.p.y+Q,Q,i)),O+=4)}return r&&(console.log(`num probes: ${O}`),console.log(`best distance: ${R.d}`)),R.p}function Og(i,t){return t.max-i.max}function dc(i,t,r,s){this.p=new fe(i,t),this.h=r,this.d=function(l,d){let f=!1,_=1/0;for(let b=0;b<d.length;b++){const Q=d[b];for(let M=0,R=Q.length,O=R-1;M<R;O=M++){const Y=Q[M],W=Q[O];Y.y>l.y!=W.y>l.y&&l.x<(W.x-Y.x)*(l.y-Y.y)/(W.y-Y.y)+Y.x&&(f=!f),_=Math.min(_,Qu(l,Y,W))}}return(f?1:-1)*Math.sqrt(_)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var Nr;E.aq=void 0,(Nr=E.aq||(E.aq={}))[Nr.center=1]="center",Nr[Nr.left=2]="left",Nr[Nr.right=3]="right",Nr[Nr.top=4]="top",Nr[Nr.bottom=5]="bottom",Nr[Nr["top-left"]=6]="top-left",Nr[Nr["top-right"]=7]="top-right",Nr[Nr["bottom-left"]=8]="bottom-left",Nr[Nr["bottom-right"]=9]="bottom-right";const Zo=7,Wh=Number.POSITIVE_INFINITY;function jA(i,t){return t[1]!==Wh?function(r,s,l){let d=0,f=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":f=l-Zo;break;case"bottom-right":case"bottom-left":case"bottom":f=-l+Zo}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(i,t[0],t[1]):function(r,s){let l=0,d=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-Zo;break;case"bottom-right":case"bottom-left":d=-f+Zo;break;case"bottom":d=-s+Zo;break;case"top":d=s-Zo}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=s;break;case"right":l=-s}return[l,d]}(i,t[0])}function JA(i,t,r){var s;const l=i.layout,d=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(d){const _=d.values,b=[];for(let Q=0;Q<_.length;Q+=2){const M=b[Q]=_[Q],R=_[Q+1].map(O=>O*Ir);M.startsWith("top")?R[1]-=Zo:M.startsWith("bottom")&&(R[1]+=Zo),b[Q+1]=R}return new Fr(b)}const f=l.get("text-variable-anchor");if(f){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*Ir,Wh]:l.get("text-offset").evaluate(t,{},r).map(Q=>Q*Ir);const b=[];for(const Q of f)b.push(Q,jA(Q,_));return new Fr(b)}return null}function Xh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qg(i,t,r,s,l,d,f,_,b,Q,M){let R=d.textMaxSize.evaluate(t,{});R===void 0&&(R=f);const O=i.layers[0].layout,Y=O.get("icon-offset").evaluate(t,{},M),W=KA(r.horizontal),ee=f/24,me=i.tilePixelRatio*ee,ve=i.tilePixelRatio*R/24,Re=i.tilePixelRatio*_,Ee=i.tilePixelRatio*O.get("symbol-spacing"),Pe=O.get("text-padding")*i.tilePixelRatio,Ke=function(tt,qt,Ut,ri=1){const Hi=tt.get("icon-padding").evaluate(qt,{},Ut),Oi=Hi&&Hi.values;return[Oi[0]*ri,Oi[1]*ri,Oi[2]*ri,Oi[3]*ri]}(O,t,M,i.tilePixelRatio),ot=O.get("text-max-angle")/180*Math.PI,St=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Kt=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",kt=O.get("symbol-placement"),xt=Ee/2,Nt=O.get("icon-text-fit");let Ft;s&&Nt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ft=yA(s,r.vertical,Nt,O.get("icon-text-fit-padding"),Y,ee)),W&&(s=yA(s,W,Nt,O.get("icon-text-fit-padding"),Y,ee)));const Pt=(tt,qt)=>{qt.x<0||qt.x>=gr||qt.y<0||qt.y>=gr||function(Ut,ri,Hi,Oi,Cr,Ds,Or,Er,gn,pn,mn,lr,Qr,an,qr,yn,Vr,ps,Sn,Pi,Ji,Yi,Jn,nr,fc){const La=Ut.addToLineVertexArray(ri,Hi);let Ra,Ms,ms,Mr,oo=0,Oc=0,XA=0,ed=0,ou=-1,lu=-1;const lo={};let td=ti("");if(Ut.allowVerticalPlacement&&Oi.vertical){const on=Er.layout.get("text-rotate").evaluate(Ji,{},nr)+90;ms=new hh(gn,ri,pn,mn,lr,Oi.vertical,Qr,an,qr,on),Or&&(Mr=new hh(gn,ri,pn,mn,lr,Or,Vr,ps,qr,on))}if(Cr){const on=Er.layout.get("icon-rotate").evaluate(Ji,{}),ys=Er.layout.get("icon-text-fit")!=="none",Fl=VA(Cr,on,Jn,ys),sa=Or?VA(Or,on,Jn,ys):void 0;Ms=new hh(gn,ri,pn,mn,lr,Cr,Vr,ps,!1,on),oo=4*Fl.length;const zl=Ut.iconSizeData;let Fa=null;zl.kind==="source"?(Fa=[Pa*Er.layout.get("icon-size").evaluate(Ji,{})],Fa[0]>Jo&&Vt(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Fc}. Reduce your "icon-size".`)):zl.kind==="composite"&&(Fa=[Pa*Yi.compositeIconSizes[0].evaluate(Ji,{},nr),Pa*Yi.compositeIconSizes[1].evaluate(Ji,{},nr)],(Fa[0]>Jo||Fa[1]>Jo)&&Vt(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${Fc}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Fl,Fa,Pi,Sn,Ji,E.ah.none,ri,La.lineStartIndex,La.lineLength,-1,nr),ou=Ut.icon.placedSymbolArray.length-1,sa&&(Oc=4*sa.length,Ut.addSymbols(Ut.icon,sa,Fa,Pi,Sn,Ji,E.ah.vertical,ri,La.lineStartIndex,La.lineLength,-1,nr),lu=Ut.icon.placedSymbolArray.length-1)}const id=Object.keys(Oi.horizontal);for(const on of id){const ys=Oi.horizontal[on];if(!Ra){td=ti(ys.text);const sa=Er.layout.get("text-rotate").evaluate(Ji,{},nr);Ra=new hh(gn,ri,pn,mn,lr,ys,Qr,an,qr,sa)}const Fl=ys.positionedLines.length===1;if(XA+=YA(Ut,ri,ys,Ds,Er,qr,Ji,yn,La,Oi.vertical?E.ah.horizontal:E.ah.horizontalOnly,Fl?id:[on],lo,ou,Yi,nr),Fl)break}Oi.vertical&&(ed+=YA(Ut,ri,Oi.vertical,Ds,Er,qr,Ji,yn,La,E.ah.vertical,["vertical"],lo,lu,Yi,nr));const jg=Ra?Ra.boxStartIndex:Ut.collisionBoxArray.length,Jg=Ra?Ra.boxEndIndex:Ut.collisionBoxArray.length,Yg=ms?ms.boxStartIndex:Ut.collisionBoxArray.length,Kg=ms?ms.boxEndIndex:Ut.collisionBoxArray.length,Zg=Ms?Ms.boxStartIndex:Ut.collisionBoxArray.length,$g=Ms?Ms.boxEndIndex:Ut.collisionBoxArray.length,Wg=Mr?Mr.boxStartIndex:Ut.collisionBoxArray.length,Xg=Mr?Mr.boxEndIndex:Ut.collisionBoxArray.length;let na=-1;const Ah=(on,ys)=>on&&on.circleDiameter?Math.max(on.circleDiameter,ys):ys;na=Ah(Ra,na),na=Ah(ms,na),na=Ah(Ms,na),na=Ah(Mr,na);const rd=na>-1?1:0;rd&&(na*=fc/Ir),Ut.glyphOffsetArray.length>=uc.MAX_GLYPHS&&Vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ji.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Ji.sortKey);const ep=JA(Er,Ji,nr),[tp,ip]=function(on,ys){const Fl=on.length,sa=ys==null?void 0:ys.values;if((sa==null?void 0:sa.length)>0)for(let zl=0;zl<sa.length;zl+=2){const Fa=sa[zl+1];on.emplaceBack(E.aq[sa[zl]],Fa[0],Fa[1])}return[Fl,on.length]}(Ut.textAnchorOffsets,ep);Ut.symbolInstances.emplaceBack(ri.x,ri.y,lo.right>=0?lo.right:-1,lo.center>=0?lo.center:-1,lo.left>=0?lo.left:-1,lo.vertical||-1,ou,lu,td,jg,Jg,Yg,Kg,Zg,$g,Wg,Xg,pn,XA,ed,oo,Oc,rd,0,Qr,na,tp,ip)}(i,qt,tt,r,s,l,Ft,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,me,[Pe,Pe,Pe,Pe],St,b,Re,Ke,Kt,Y,t,d,Q,M,f)};if(kt==="line")for(const tt of zA(t.geometry,0,0,gr,gr)){const qt=Gg(tt,Ee,ot,r.vertical||W,s,24,ve,i.overscaling,gr);for(const Ut of qt)W&&Vg(i,W.text,xt,Ut)||Pt(tt,Ut)}else if(kt==="line-center"){for(const tt of t.geometry)if(tt.length>1){const qt=zg(tt,ot,r.vertical||W,s,24,ve);qt&&Pt(tt,qt)}}else if(t.type==="Polygon")for(const tt of Va(t.geometry,0)){const qt=Ng(tt,16);Pt(tt[0],new Ko(qt.x,qt.y,0))}else if(t.type==="LineString")for(const tt of t.geometry)Pt(tt,new Ko(tt[0].x,tt[0].y,0));else if(t.type==="Point")for(const tt of t.geometry)for(const qt of tt)Pt([qt],new Ko(qt.x,qt.y,0))}function YA(i,t,r,s,l,d,f,_,b,Q,M,R,O,Y,W){const ee=function(Re,Ee,Pe,Ke,ot,St,Kt,kt){const xt=Ke.layout.get("text-rotate").evaluate(St,{})*Math.PI/180,Nt=[];for(const Ft of Ee.positionedLines)for(const Pt of Ft.positionedGlyphs){if(!Pt.rect)continue;const tt=Pt.rect||{};let qt=hA+1,Ut=!0,ri=1,Hi=0;const Oi=(ot||kt)&&Pt.vertical,Cr=Pt.metrics.advance*Pt.scale/2;if(kt&&Ee.verticalizable&&(Hi=Ft.lineOffset/2-(Pt.imageName?-(Ir-Pt.metrics.width*Pt.scale)/2:(Pt.scale-1)*Ir)),Pt.imageName){const Pi=Kt[Pt.imageName];Ut=Pi.sdf,ri=Pi.pixelRatio,qt=kn/ri}const Ds=ot?[Pt.x+Cr,Pt.y]:[0,0];let Or=ot?[0,0]:[Pt.x+Cr+Pe[0],Pt.y+Pe[1]-Hi],Er=[0,0];Oi&&(Er=Or,Or=[0,0]);const gn=Pt.metrics.isDoubleResolution?2:1,pn=(Pt.metrics.left-qt)*Pt.scale-Cr+Or[0],mn=(-Pt.metrics.top-qt)*Pt.scale+Or[1],lr=pn+tt.w/gn*Pt.scale/ri,Qr=mn+tt.h/gn*Pt.scale/ri,an=new fe(pn,mn),qr=new fe(lr,mn),yn=new fe(pn,Qr),Vr=new fe(lr,Qr);if(Oi){const Pi=new fe(-Cr,Cr-Lc),Ji=-Math.PI/2,Yi=Ir/2-Cr,Jn=new fe(5-Lc-Yi,-(Pt.imageName?Yi:0)),nr=new fe(...Er);an._rotateAround(Ji,Pi)._add(Jn)._add(nr),qr._rotateAround(Ji,Pi)._add(Jn)._add(nr),yn._rotateAround(Ji,Pi)._add(Jn)._add(nr),Vr._rotateAround(Ji,Pi)._add(Jn)._add(nr)}if(xt){const Pi=Math.sin(xt),Ji=Math.cos(xt),Yi=[Ji,-Pi,Pi,Ji];an._matMult(Yi),qr._matMult(Yi),yn._matMult(Yi),Vr._matMult(Yi)}const ps=new fe(0,0),Sn=new fe(0,0);Nt.push({tl:an,tr:qr,bl:yn,br:Vr,tex:tt,writingMode:Ee.writingMode,glyphOffset:Ds,sectionIndex:Pt.sectionIndex,isSDF:Ut,pixelOffsetTL:ps,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}return Nt}(0,r,_,l,d,f,s,i.allowVerticalPlacement),me=i.textSizeData;let ve=null;me.kind==="source"?(ve=[Pa*l.layout.get("text-size").evaluate(f,{})],ve[0]>Jo&&Vt(`${i.layerIds[0]}: Value for "text-size" is >= ${Fc}. Reduce your "text-size".`)):me.kind==="composite"&&(ve=[Pa*Y.compositeTextSizes[0].evaluate(f,{},W),Pa*Y.compositeTextSizes[1].evaluate(f,{},W)],(ve[0]>Jo||ve[1]>Jo)&&Vt(`${i.layerIds[0]}: Value for "text-size" is >= ${Fc}. Reduce your "text-size".`)),i.addSymbols(i.text,ee,ve,_,d,f,Q,t,b.lineStartIndex,b.lineLength,O,W);for(const Re of M)R[Re]=i.text.placedSymbolArray.length-1;return 4*ee.length}function KA(i){for(const t in i)return i[t];return null}function Vg(i,t,r,s){const l=i.compareText;if(t in l){const d=l[t];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<r)return!0}else l[t]=[];return l[t].push(s),!1}const ZA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class eu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=ZA[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new eu(_,f,d,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=ZA.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return tu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:_}=this,b=[0,d.length-1,0],Q=[];for(;b.length;){const M=b.pop()||0,R=b.pop()||0,O=b.pop()||0;if(R-O<=_){for(let me=O;me<=R;me++){const ve=f[2*me],Re=f[2*me+1];ve>=t&&ve<=s&&Re>=r&&Re<=l&&Q.push(d[me])}continue}const Y=O+R>>1,W=f[2*Y],ee=f[2*Y+1];W>=t&&W<=s&&ee>=r&&ee<=l&&Q.push(d[Y]),(M===0?t<=W:r<=ee)&&(b.push(O),b.push(Y-1),b.push(1-M)),(M===0?s>=W:l>=ee)&&(b.push(Y+1),b.push(R),b.push(1-M))}return Q}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,_=[0,l.length-1,0],b=[],Q=s*s;for(;_.length;){const M=_.pop()||0,R=_.pop()||0,O=_.pop()||0;if(R-O<=f){for(let me=O;me<=R;me++)WA(d[2*me],d[2*me+1],t,r)<=Q&&b.push(l[me]);continue}const Y=O+R>>1,W=d[2*Y],ee=d[2*Y+1];WA(W,ee,t,r)<=Q&&b.push(l[Y]),(M===0?t-s<=W:r-s<=ee)&&(_.push(O),_.push(Y-1),_.push(1-M)),(M===0?t+s>=W:r+s>=ee)&&(_.push(Y+1),_.push(R),_.push(1-M))}return b}}function tu(i,t,r,s,l,d){if(l-s<=r)return;const f=s+l>>1;$A(i,t,f,s,l,d),tu(i,t,r,s,f-1,1-d),tu(i,t,r,f+1,l,1-d)}function $A(i,t,r,s,l,d){for(;l>s;){if(l-s>600){const Q=l-s+1,M=r-s+1,R=Math.log(Q),O=.5*Math.exp(2*R/3),Y=.5*Math.sqrt(R*O*(Q-O)/Q)*(M-Q/2<0?-1:1);$A(i,t,r,Math.max(s,Math.floor(r-M*O/Q+Y)),Math.min(l,Math.floor(r+(Q-M)*O/Q+Y)),d)}const f=t[2*r+d];let _=s,b=l;for(Uc(i,t,s,r),t[2*l+d]>f&&Uc(i,t,s,l);_<b;){for(Uc(i,t,_,b),_++,b--;t[2*_+d]<f;)_++;for(;t[2*b+d]>f;)b--}t[2*s+d]===f?Uc(i,t,s,b):(b++,Uc(i,t,b,l)),b<=r&&(s=b+1),r<=b&&(l=b-1)}}function Uc(i,t,r,s){iu(i,r,s),iu(t,2*r,2*s),iu(t,2*r+1,2*s+1)}function iu(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function WA(i,t,r,s){const l=i-r,d=t-s;return l*l+d*d}var ru;E.bg=void 0,(ru=E.bg||(E.bg={})).create="create",ru.load="load",ru.fullLoad="fullLoad";let uh=null,Nc=[];const nu=1e3/60,su="loadTime",au="fullLoadTime",Hg={mark(i){performance.mark(i)},frame(i){const t=i;uh!=null&&Nc.push(t-uh),uh=t},clearMetrics(){uh=null,Nc=[],performance.clearMeasures(su),performance.clearMeasures(au);for(const i in E.bg)performance.clearMarks(E.bg[i])},getPerformanceMetrics(){performance.measure(su,E.bg.create,E.bg.load),performance.measure(au,E.bg.create,E.bg.fullLoad);const i=performance.getEntriesByName(su)[0].duration,t=performance.getEntriesByName(au)[0].duration,r=Nc.length,s=1/(Nc.reduce((d,f)=>d+f,0)/r/1e3),l=Nc.filter(d=>d>nu).reduce((d,f)=>d+(f-nu)/nu,0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};E.$=class extends F{},E.A=sc,E.B=Wl,E.C=function(i){if(wi==null){const t=i.navigator?i.navigator.userAgent:null;wi=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return wi},E.D=zt,E.E=er,E.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Rg(()=>this.process()),this.subscription=function(r,s,l,d){return r.addEventListener(s,l,!1),{unsubscribe:()=>{r.removeEventListener(s,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Zt(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];const _={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const d=[],f=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:us(i.data,d)});this.target.postMessage(f,{transfer:d})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Zt(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(ks(t.error)):l.resolve(ks(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=ks(t.data),s=new AbortController;this.abortControllers[i]=s;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?us(t):null,data:us(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},E.G=Yt,E.H=function(){var i=new sc(16);return sc!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},E.I=Nh,E.J=function(i,t,r){var s,l,d,f,_,b,Q,M,R,O,Y,W,ee=r[0],me=r[1],ve=r[2];return t===i?(i[12]=t[0]*ee+t[4]*me+t[8]*ve+t[12],i[13]=t[1]*ee+t[5]*me+t[9]*ve+t[13],i[14]=t[2]*ee+t[6]*me+t[10]*ve+t[14],i[15]=t[3]*ee+t[7]*me+t[11]*ve+t[15]):(l=t[1],d=t[2],f=t[3],_=t[4],b=t[5],Q=t[6],M=t[7],R=t[8],O=t[9],Y=t[10],W=t[11],i[0]=s=t[0],i[1]=l,i[2]=d,i[3]=f,i[4]=_,i[5]=b,i[6]=Q,i[7]=M,i[8]=R,i[9]=O,i[10]=Y,i[11]=W,i[12]=s*ee+_*me+R*ve+t[12],i[13]=l*ee+b*me+O*ve+t[13],i[14]=d*ee+Q*me+Y*ve+t[14],i[15]=f*ee+M*me+W*ve+t[15]),i},E.K=function(i,t,r){var s=r[0],l=r[1],d=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*d,i[9]=t[9]*d,i[10]=t[10]*d,i[11]=t[11]*d,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},E.L=Mu,E.M=function(i,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in i&&(r[l]=i[l])}return r},E.N=Yo,E.O=EA,E.P=fe,E.Q=QA,E.R=fs,E.S=gs,E.T=No,E.U=st,E.V=Ne,E.W=Ei,E.X=gr,E.Y=I,E.Z=zc,E._=c,E.a=Jt,E.a$=function(i,t){var r=i[0],s=i[1],l=i[2],d=i[3],f=i[4],_=i[5],b=i[6],Q=i[7],M=i[8],R=i[9],O=i[10],Y=i[11],W=i[12],ee=i[13],me=i[14],ve=i[15],Re=t[0],Ee=t[1],Pe=t[2],Ke=t[3],ot=t[4],St=t[5],Kt=t[6],kt=t[7],xt=t[8],Nt=t[9],Ft=t[10],Pt=t[11],tt=t[12],qt=t[13],Ut=t[14],ri=t[15];return Math.abs(r-Re)<=fn*Math.max(1,Math.abs(r),Math.abs(Re))&&Math.abs(s-Ee)<=fn*Math.max(1,Math.abs(s),Math.abs(Ee))&&Math.abs(l-Pe)<=fn*Math.max(1,Math.abs(l),Math.abs(Pe))&&Math.abs(d-Ke)<=fn*Math.max(1,Math.abs(d),Math.abs(Ke))&&Math.abs(f-ot)<=fn*Math.max(1,Math.abs(f),Math.abs(ot))&&Math.abs(_-St)<=fn*Math.max(1,Math.abs(_),Math.abs(St))&&Math.abs(b-Kt)<=fn*Math.max(1,Math.abs(b),Math.abs(Kt))&&Math.abs(Q-kt)<=fn*Math.max(1,Math.abs(Q),Math.abs(kt))&&Math.abs(M-xt)<=fn*Math.max(1,Math.abs(M),Math.abs(xt))&&Math.abs(R-Nt)<=fn*Math.max(1,Math.abs(R),Math.abs(Nt))&&Math.abs(O-Ft)<=fn*Math.max(1,Math.abs(O),Math.abs(Ft))&&Math.abs(Y-Pt)<=fn*Math.max(1,Math.abs(Y),Math.abs(Pt))&&Math.abs(W-tt)<=fn*Math.max(1,Math.abs(W),Math.abs(tt))&&Math.abs(ee-qt)<=fn*Math.max(1,Math.abs(ee),Math.abs(qt))&&Math.abs(me-Ut)<=fn*Math.max(1,Math.abs(me),Math.abs(Ut))&&Math.abs(ve-ri)<=fn*Math.max(1,Math.abs(ve),Math.abs(ri))},E.a0=ut,E.a1=$h,E.a2=gt,E.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of i){const l=window.document.createElement("source");vr(s)||(t.crossOrigin="Anonymous"),l.src=s,t.appendChild(l)}})},E.a4=function(){return Gt++},E.a5=de,E.a6=uc,E.a7=Qs,E.a8=Ll,E.a9=PA,E.aA=function(i){if(i.type==="custom")return new Lg(i);switch(i.type){case"background":return new Mg(i);case"circle":return new _f(i);case"fill":return new Rf(i);case"fill-extrusion":return new $f(i);case"heatmap":return new bf(i);case"hillshade":return new wf(i);case"line":return new sg(i);case"raster":return new Pg(i);case"symbol":return new ah(i)}},E.aB=bt,E.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Ai(i.version,t.version))return[{command:"setStyle",args:[t]}];Ai(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Ai(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Ai(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Ai(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Ai(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Ai(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Ai(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Ai(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Ai(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Ai(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Ai(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},l=[];(function(f,_,b,Q){let M;for(M in _=_||{},f=f||{})Object.prototype.hasOwnProperty.call(f,M)&&(Object.prototype.hasOwnProperty.call(_,M)||wr(M,b,Q));for(M in _)Object.prototype.hasOwnProperty.call(_,M)&&(Object.prototype.hasOwnProperty.call(f,M)?Ai(f[M],_[M])||(f[M].type==="geojson"&&_[M].type==="geojson"&&ca(f,_,M)?Gi(b,{command:"setGeoJSONSourceData",args:[M,_[M].data]}):Kr(M,_,b,Q)):Xn(M,_,b))})(i.sources,t.sources,l,s);const d=[];i.layers&&i.layers.forEach(f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):d.push(f)}),r=r.concat(l),function(f,_,b){_=_||[];const Q=(f=f||[]).map(Ts),M=_.map(Ts),R=f.reduce(ha,{}),O=_.reduce(ha,{}),Y=Q.slice(),W=Object.create(null);let ee,me,ve,Re,Ee;for(let Pe=0,Ke=0;Pe<Q.length;Pe++)ee=Q[Pe],Object.prototype.hasOwnProperty.call(O,ee)?Ke++:(Gi(b,{command:"removeLayer",args:[ee]}),Y.splice(Y.indexOf(ee,Ke),1));for(let Pe=0,Ke=0;Pe<M.length;Pe++)ee=M[M.length-1-Pe],Y[Y.length-1-Pe]!==ee&&(Object.prototype.hasOwnProperty.call(R,ee)?(Gi(b,{command:"removeLayer",args:[ee]}),Y.splice(Y.lastIndexOf(ee,Y.length-Ke),1)):Ke++,Re=Y[Y.length-Pe],Gi(b,{command:"addLayer",args:[O[ee],Re]}),Y.splice(Y.length-Pe,0,ee),W[ee]=!0);for(let Pe=0;Pe<M.length;Pe++)if(ee=M[Pe],me=R[ee],ve=O[ee],!W[ee]&&!Ai(me,ve))if(Ai(me.source,ve.source)&&Ai(me["source-layer"],ve["source-layer"])&&Ai(me.type,ve.type)){for(Ee in cn(me.layout,ve.layout,b,ee,null,"setLayoutProperty"),cn(me.paint,ve.paint,b,ee,null,"setPaintProperty"),Ai(me.filter,ve.filter)||Gi(b,{command:"setFilter",args:[ee,ve.filter]}),Ai(me.minzoom,ve.minzoom)&&Ai(me.maxzoom,ve.maxzoom)||Gi(b,{command:"setLayerZoomRange",args:[ee,ve.minzoom,ve.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?cn(me[Ee],ve[Ee],b,ee,Ee.slice(6),"setPaintProperty"):Ai(me[Ee],ve[Ee])||Gi(b,{command:"setLayerProperty",args:[ee,Ee,ve[Ee]]}));for(Ee in ve)Object.prototype.hasOwnProperty.call(ve,Ee)&&!Object.prototype.hasOwnProperty.call(me,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?cn(me[Ee],ve[Ee],b,ee,Ee.slice(6),"setPaintProperty"):Ai(me[Ee],ve[Ee])||Gi(b,{command:"setLayerProperty",args:[ee,Ee,ve[Ee]]}))}else Gi(b,{command:"removeLayer",args:[ee]}),Re=Y[Y.lastIndexOf(ee)+1],Gi(b,{command:"addLayer",args:[ve,Re]})}(d,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},E.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},E.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},E.aF=vt,E.aG=Tt,E.aH=class extends fr{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},E.aI=Ta,E.aJ=class extends fr{constructor(i,t){super(i,t),this.current=rc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},E.aK=jc,E.aL=Jc,E.aM=Ri,E.aN=class extends fr{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},E.aO=class extends fr{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},E.aP=function(i,t,r,s,l,d,f){var _=1/(t-r),b=1/(s-l),Q=1/(d-f);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*Q,i[11]=0,i[12]=(t+r)*_,i[13]=(l+s)*b,i[14]=(f+d)*Q,i[15]=1,i},E.aQ=yf,E.aR=class extends k{},E.aS=cg,E.aT=class extends S{},E.aU=kh,E.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},E.aW=Fu,E.aX=Be,E.aY=Rt,E.aZ=class extends se{},E.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},E.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,d)=>{const f=l||d;return t[s]=!f||f.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},E.ab=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},E.ac=lt,E.ad=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[0],f=t[1],_=t[2],b=t[3],Q=t[4],M=t[5],R=t[6],O=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=d*l+Q*s,i[1]=f*l+M*s,i[2]=_*l+R*s,i[3]=b*l+O*s,i[4]=Q*l-d*s,i[5]=M*l-f*s,i[6]=R*l-_*s,i[7]=O*l-b*s,i},E.ae=function(i){var t=new sc(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},E.af=$c,E.ag=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:f}=i,_=l?lt(zr.interpolationFactor(l,t,d,f),0,1):0;i.kind==="camera"?s=_r.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:s}},E.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Pa:i.kind==="composite"?_r.number(s/Pa,l/Pa,r):t},E.aj=Hh,E.ak=function(i,t,r,s){const l=t.y-i.y,d=t.x-i.x,f=s.y-r.y,_=s.x-r.x,b=f*d-_*l;if(b===0)return null;const Q=(_*(i.y-r.y)-f*(i.x-r.x))/b;return new fe(i.x+Q*d,i.y+Q*l)},E.al=zA,E.am=Cu,E.an=Ch,E.ao=function(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of i)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return[t,r,s,l]},E.ap=Ir,E.ar=Vh,E.as=function(i,t){var r=t[0],s=t[1],l=t[2],d=t[3],f=t[4],_=t[5],b=t[6],Q=t[7],M=t[8],R=t[9],O=t[10],Y=t[11],W=t[12],ee=t[13],me=t[14],ve=t[15],Re=r*_-s*f,Ee=r*b-l*f,Pe=r*Q-d*f,Ke=s*b-l*_,ot=s*Q-d*_,St=l*Q-d*b,Kt=M*ee-R*W,kt=M*me-O*W,xt=M*ve-Y*W,Nt=R*me-O*ee,Ft=R*ve-Y*ee,Pt=O*ve-Y*me,tt=Re*Pt-Ee*Ft+Pe*Nt+Ke*xt-ot*kt+St*Kt;return tt?(i[0]=(_*Pt-b*Ft+Q*Nt)*(tt=1/tt),i[1]=(l*Ft-s*Pt-d*Nt)*tt,i[2]=(ee*St-me*ot+ve*Ke)*tt,i[3]=(O*ot-R*St-Y*Ke)*tt,i[4]=(b*xt-f*Pt-Q*kt)*tt,i[5]=(r*Pt-l*xt+d*kt)*tt,i[6]=(me*Pe-W*St-ve*Ee)*tt,i[7]=(M*St-O*Pe+Y*Ee)*tt,i[8]=(f*Ft-_*xt+Q*Kt)*tt,i[9]=(s*xt-r*Ft-d*Kt)*tt,i[10]=(W*ot-ee*Pe+ve*Re)*tt,i[11]=(R*Pe-M*ot-Y*Re)*tt,i[12]=(_*kt-f*Nt-b*Kt)*tt,i[13]=(r*Nt-s*kt+l*Kt)*tt,i[14]=(ee*Ee-W*Ke-me*Re)*tt,i[15]=(M*Ke-R*Ee+O*Re)*tt,i):null},E.at=Xh,E.au=qh,E.av=eu,E.aw=function(){const i={},t=qe.$version;for(const r in qe.$root){const s=qe.$root[r];if(s.required){let l=null;l=r==="version"?t:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},E.ax=qi,E.ay=di,E.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Pn(i[r],t[i[r].ref]));return i},E.b=Mt,E.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},E.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},E.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},E.b3=Qt,E.b4=DA,E.b5=kA,E.b6=function(i,t,r,s,l){var d,f=1/Math.tan(t/2);return i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(d=1/(s-l)),i[14]=2*l*s*d):(i[10]=-1,i[14]=-2*s),i},E.b7=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[4],f=t[5],_=t[6],b=t[7],Q=t[8],M=t[9],R=t[10],O=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=d*l+Q*s,i[5]=f*l+M*s,i[6]=_*l+R*s,i[7]=b*l+O*s,i[8]=Q*l-d*s,i[9]=M*l-f*s,i[10]=R*l-_*s,i[11]=O*l-b*s,i},E.b8=He,E.b9=$e,E.bA=rA,E.bB=function(i){return i.message===ui},E.bC=Ea,E.bD=rr,E.ba=function(i){return i*Math.PI/180},E.bb=function(i,t){const{x:r,y:s}=zc.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},E.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},E.bd=class extends T{},E.be=Kh,E.bf=Hg,E.bh=ii,E.bi=function(i,t){Jt.REGISTERED_PROTOCOLS[i]=t},E.bj=function(i){delete Jt.REGISTERED_PROTOCOLS[i]},E.bk=function(i,t){const r={};for(let l=0;l<i.length;l++){const d=t&&t[i[l].id]||Zl(i[l]);t&&(t[i[l].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},E.bl=Bt,E.bm=TA,E.bn=LA,E.bo=AA,E.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=gr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new Vi(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Vi(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Vi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:M}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Vi(Q),i.canonical),s["text-size"].possiblyEvaluate(new Vi(M),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:M}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Vi(Q),i.canonical),s["icon-size"].possiblyEvaluate(new Vi(M),i.canonical)]}const d=r.get("text-line-height")*Ir,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),b=r.get("text-size");for(const Q of i.bucket.features){const M=r.get("text-font").evaluate(Q,{},i.canonical).join(","),R=b.evaluate(Q,{},i.canonical),O=l.layoutTextSize.evaluate(Q,{},i.canonical),Y=l.layoutIconSize.evaluate(Q,{},i.canonical),W={horizontal:{},vertical:void 0},ee=Q.text;let me,ve=[0,0];if(ee){const Pe=ee.toString(),Ke=r.get("text-letter-spacing").evaluate(Q,{},i.canonical)*Ir,ot=Ws(Pe)?Ke:0,St=r.get("text-anchor").evaluate(Q,{},i.canonical),Kt=JA(t,Q,i.canonical);if(!Kt){const Ft=r.get("text-radial-offset").evaluate(Q,{},i.canonical);ve=Ft?jA(St,[Ft*Ir,Wh]):r.get("text-offset").evaluate(Q,{},i.canonical).map(Pt=>Pt*Ir)}let kt=f?"center":r.get("text-justify").evaluate(Q,{},i.canonical);const xt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(Q,{},i.canonical)*Ir:1/0,Nt=()=>{i.bucket.allowVerticalPlacement&&kl(Pe)&&(W.vertical=rh(ee,i.glyphMap,i.glyphPositions,i.imagePositions,M,xt,d,St,"left",ot,ve,E.ah.vertical,!0,O,R))};if(!f&&Kt){const Ft=new Set;if(kt==="auto")for(let tt=0;tt<Kt.values.length;tt+=2)Ft.add(Xh(Kt.values[tt]));else Ft.add(kt);let Pt=!1;for(const tt of Ft)if(!W.horizontal[tt])if(Pt)W.horizontal[tt]=W.horizontal[0];else{const qt=rh(ee,i.glyphMap,i.glyphPositions,i.imagePositions,M,xt,d,"center",tt,ot,ve,E.ah.horizontal,!1,O,R);qt&&(W.horizontal[tt]=qt,Pt=qt.positionedLines.length===1)}Nt()}else{kt==="auto"&&(kt=Xh(St));const Ft=rh(ee,i.glyphMap,i.glyphPositions,i.imagePositions,M,xt,d,St,kt,ot,ve,E.ah.horizontal,!1,O,R);Ft&&(W.horizontal[kt]=Ft),Nt(),kl(Pe)&&f&&_&&(W.vertical=rh(ee,i.glyphMap,i.glyphPositions,i.imagePositions,M,xt,d,St,kt,ot,ve,E.ah.vertical,!1,O,R))}}let Re=!1;if(Q.icon&&Q.icon.name){const Pe=i.imageMap[Q.icon.name];Pe&&(me=Eg(i.imagePositions[Q.icon.name],r.get("icon-offset").evaluate(Q,{},i.canonical),r.get("icon-anchor").evaluate(Q,{},i.canonical)),Re=!!Pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Re:i.bucket.sdfIcons!==Re&&Vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Ee=KA(W.horizontal)||W.vertical;i.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||me)&&qg(i.bucket,Q,W,me,i.imageMap,l,O,Y,ve,Re,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},E.bq=Fh,E.br=Ph,E.bs=Rh,E.bt=Ho,E.bu=Gh,E.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},E.bw=function(i,t,r,s,l){return c(this,void 0,void 0,function*(){if(Ne())try{return yield Ei(i,t,r,s,l)}catch{}return function(d,f,_,b,Q){const M=d.width,R=d.height;Qi&&oi||(Qi=new OffscreenCanvas(M,R),oi=Qi.getContext("2d",{willReadFrequently:!0})),Qi.width=M,Qi.height=R,oi.drawImage(d,0,0,M,R);const O=oi.getImageData(f,_,b,Q);return oi.clearRect(0,0,M,R),O.data}(i,t,r,s,l)})},E.bx=MA,E.by=X,E.bz=he,E.c=br,E.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),E.e=ht,E.f=i=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Si})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(l):Si}),E.g=ei,E.h=(i,t)=>ki(ht(i,{type:"json"}),t),E.i=Zt,E.j=zi,E.k=pi,E.l=(i,t)=>ki(ht(i,{type:"arrayBuffer"}),t),E.m=ki,E.n=function(i){return new Gh(i).readFields(Ig,[])},E.o=Qc,E.p=uA,E.q=u,E.r=dn,E.s=vr,E.t=Fo,E.u=$s,E.v=qe,E.w=Vt,E.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},E.y=_r,E.z=Vi}),D("worker",["./shared"],function(E){class c{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,j){for(const pe of J){this._layerConfigs[pe.id]=pe;const Ce=this._layers[pe.id]=E.aA(pe);Ce._featureFilter=E.a7(Ce.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of j)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const te=E.bk(Object.values(this._layerConfigs),this.keyCache);for(const pe of te){const Ce=pe.map(Ge=>this._layers[Ge.id]),Te=Ce[0];if(Te.visibility==="none")continue;const Le=Te.source||"";let we=this.familiesBySource[Le];we||(we=this.familiesBySource[Le]={});const Ye=Te.sourceLayer||"_geojsonTileLayer";let nt=we[Ye];nt||(nt=we[Ye]=[]),nt.push(Ce)}}}class X{constructor(J){const j={},te=[];for(const Le in J){const we=J[Le],Ye=j[Le]={};for(const nt in we){const Ge=we[+nt];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const It={x:0,y:0,w:Ge.bitmap.width+2,h:Ge.bitmap.height+2};te.push(It),Ye[nt]={rect:It,metrics:Ge.metrics}}}const{w:pe,h:Ce}=E.p(te),Te=new E.o({width:pe||1,height:Ce||1});for(const Le in J){const we=J[Le];for(const Ye in we){const nt=we[+Ye];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Ge=j[Le][Ye].rect;E.o.copy(nt.bitmap,Te,{x:0,y:0},{x:Ge.x+1,y:Ge.y+1},nt.bitmap)}}this.image=Te,this.positions=j}}E.bl("GlyphAtlas",X);class he{constructor(J){this.tileID=new E.S(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,j,te,pe){return E._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new E.a5;const Ce=new E.bm(Object.keys(J.layers).sort()),Te=new E.bn(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const Le={},we={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},Ye=j.familiesBySource[this.source];for(const hi in Ye){const Li=J.layers[hi];if(!Li)continue;Li.version===1&&E.w(`Vector tile source "${this.source}" layer "${hi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ji=Ce.encode(hi),ar=[];for(let Ar=0;Ar<Li.length;Ar++){const dr=Li.feature(Ar),In=Te.getId(dr,hi);ar.push({feature:dr,id:In,index:Ar,sourceLayerIndex:ji})}for(const Ar of Ye[hi]){const dr=Ar[0];dr.source!==this.source&&E.w(`layer.source = ${dr.source} does not equal this.source = ${this.source}`),dr.minzoom&&this.zoom<Math.floor(dr.minzoom)||dr.maxzoom&&this.zoom>=dr.maxzoom||dr.visibility!=="none"&&(Ie(Ar,this.zoom,te),(Le[dr.id]=dr.createBucket({index:Te.bucketLayerIDs.length,layers:Ar,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ji,sourceID:this.source})).populate(ar,we,this.tileID.canonical),Te.bucketLayerIDs.push(Ar.map(In=>In.id)))}}const nt=E.aF(we.glyphDependencies,hi=>Object.keys(hi).map(Number));this.inFlightDependencies.forEach(hi=>hi==null?void 0:hi.abort()),this.inFlightDependencies=[];let Ge=Promise.resolve({});if(Object.keys(nt).length){const hi=new AbortController;this.inFlightDependencies.push(hi),Ge=pe.sendAsync({type:"GG",data:{stacks:nt,source:this.source,tileID:this.tileID,type:"glyphs"}},hi)}const It=Object.keys(we.iconDependencies);let Ot=Promise.resolve({});if(It.length){const hi=new AbortController;this.inFlightDependencies.push(hi),Ot=pe.sendAsync({type:"GI",data:{icons:It,source:this.source,tileID:this.tileID,type:"icons"}},hi)}const jt=Object.keys(we.patternDependencies);let Ii=Promise.resolve({});if(jt.length){const hi=new AbortController;this.inFlightDependencies.push(hi),Ii=pe.sendAsync({type:"GI",data:{icons:jt,source:this.source,tileID:this.tileID,type:"patterns"}},hi)}const[si,xi,fi]=yield Promise.all([Ge,Ot,Ii]),sr=new X(si),Ki=new E.bo(xi,fi);for(const hi in Le){const Li=Le[hi];Li instanceof E.a6?(Ie(Li.layers,this.zoom,te),E.bp({bucket:Li,glyphMap:si,glyphPositions:sr.positions,imageMap:xi,imagePositions:Ki.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Li.hasPattern&&(Li instanceof E.bq||Li instanceof E.br||Li instanceof E.bs)&&(Ie(Li.layers,this.zoom,te),Li.addFeatures(we,this.tileID.canonical,Ki.patternPositions))}return this.status="done",{buckets:Object.values(Le).filter(hi=>!hi.isEmpty()),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sr.image,imageAtlas:Ki,glyphMap:this.returnDependencies?si:null,iconMap:this.returnDependencies?xi:null,glyphPositions:this.returnDependencies?sr.positions:null}})}}function Ie(_e,J,j){const te=new E.z(J);for(const pe of _e)pe.recalculate(te,j)}class fe{constructor(J,j,te){this.actor=J,this.layerIndex=j,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,j){return E._(this,void 0,void 0,function*(){const te=yield E.l(J.request,j);try{return{vectorTile:new E.bt.VectorTile(new E.bu(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(pe){const Ce=new Uint8Array(te.data);let Te=`Unable to parse the tile at ${J.request.url}, `;throw Te+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pe.message}`,new Error(Te)}})}loadTile(J){return E._(this,void 0,void 0,function*(){const j=J.uid,te=!!(J&&J.request&&J.request.collectResourceTiming)&&new E.bv(J.request),pe=new he(J);this.loading[j]=pe;const Ce=new AbortController;pe.abort=Ce;try{const Te=yield this.loadVectorTile(J,Ce);if(delete this.loading[j],!Te)return null;const Le=Te.rawData,we={};Te.expires&&(we.expires=Te.expires),Te.cacheControl&&(we.cacheControl=Te.cacheControl);const Ye={};if(te){const Ge=te.finish();Ge&&(Ye.resourceTiming=JSON.parse(JSON.stringify(Ge)))}pe.vectorTile=Te.vectorTile;const nt=pe.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[j]=pe,this.fetching[j]={rawTileData:Le,cacheControl:we,resourceTiming:Ye};try{const Ge=yield nt;return E.e({rawTileData:Le.slice(0)},Ge,we,Ye)}finally{delete this.fetching[j]}}catch(Te){throw delete this.loading[j],pe.status="done",this.loaded[j]=pe,Te}})}reloadTile(J){return E._(this,void 0,void 0,function*(){const j=J.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[j];if(te.showCollisionBoxes=J.showCollisionBoxes,te.status==="parsing"){const pe=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ce;if(this.fetching[j]){const{rawTileData:Te,cacheControl:Le,resourceTiming:we}=this.fetching[j];delete this.fetching[j],Ce=E.e({rawTileData:Te.slice(0)},pe,Le,we)}else Ce=pe;return Ce}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(J){return E._(this,void 0,void 0,function*(){const j=this.loading,te=J.uid;j&&j[te]&&j[te].abort&&(j[te].abort.abort(),delete j[te])})}removeTile(J){return E._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class oe{constructor(){this.loaded={}}loadTile(J){return E._(this,void 0,void 0,function*(){const{uid:j,encoding:te,rawImageData:pe,redFactor:Ce,greenFactor:Te,blueFactor:Le,baseShift:we}=J,Ye=pe.width+2,nt=pe.height+2,Ge=E.b(pe)?new E.R({width:Ye,height:nt},yield E.bw(pe,-1,-1,Ye,nt)):pe,It=new E.bx(j,Ge,te,Ce,Te,Le,we);return this.loaded=this.loaded||{},this.loaded[j]=It,It})}removeTile(J){const j=this.loaded,te=J.uid;j&&j[te]&&delete j[te]}}function Fe(_e,J){if(_e.length!==0){Ue(_e[0],J);for(var j=1;j<_e.length;j++)Ue(_e[j],!J)}}function Ue(_e,J){for(var j=0,te=0,pe=0,Ce=_e.length,Te=Ce-1;pe<Ce;Te=pe++){var Le=(_e[pe][0]-_e[Te][0])*(_e[Te][1]+_e[pe][1]),we=j+Le;te+=Math.abs(j)>=Math.abs(Le)?j-we+Le:Le-we+j,j=we}j+te>=0!=!!J&&_e.reverse()}var Xe=E.by(function _e(J,j){var te,pe=J&&J.type;if(pe==="FeatureCollection")for(te=0;te<J.features.length;te++)_e(J.features[te],j);else if(pe==="GeometryCollection")for(te=0;te<J.geometries.length;te++)_e(J.geometries[te],j);else if(pe==="Feature")_e(J.geometry,j);else if(pe==="Polygon")Fe(J.coordinates,j);else if(pe==="MultiPolygon")for(te=0;te<J.coordinates.length;te++)Fe(J.coordinates[te],j);return J});const et=E.bt.VectorTileFeature.prototype.toGeoJSON;var st={exports:{}},Ne=E.bz,He=E.bt.VectorTileFeature,$e=lt;function lt(_e,J){this.options=J||{},this.features=_e,this.length=_e.length}function Qt(_e,J){this.id=typeof _e.id=="number"?_e.id:void 0,this.type=_e.type,this.rawGeometry=_e.type===1?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=J||4096}lt.prototype.feature=function(_e){return new Qt(this.features[_e],this.options.extent)},Qt.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var J=0;J<_e.length;J++){for(var j=_e[J],te=[],pe=0;pe<j.length;pe++)te.push(new Ne(j[pe][0],j[pe][1]));this.geometry.push(te)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,J=1/0,j=-1/0,te=1/0,pe=-1/0,Ce=0;Ce<_e.length;Ce++)for(var Te=_e[Ce],Le=0;Le<Te.length;Le++){var we=Te[Le];J=Math.min(J,we.x),j=Math.max(j,we.x),te=Math.min(te,we.y),pe=Math.max(pe,we.y)}return[J,te,j,pe]},Qt.prototype.toGeoJSON=He.prototype.toGeoJSON;var ht=E.bA,Gt=$e;function vt(_e){var J=new ht;return function(j,te){for(var pe in j.layers)te.writeMessage(3,Tt,j.layers[pe])}(_e,J),J.finish()}function Tt(_e,J){var j;J.writeVarintField(15,_e.version||1),J.writeStringField(1,_e.name||""),J.writeVarintField(5,_e.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<_e.length;j++)te.feature=_e.feature(j),J.writeMessage(2,bt,te);var pe=te.keys;for(j=0;j<pe.length;j++)J.writeStringField(3,pe[j]);var Ce=te.values;for(j=0;j<Ce.length;j++)J.writeMessage(4,wi,Ce[j])}function bt(_e,J){var j=_e.feature;j.id!==void 0&&J.writeVarintField(1,j.id),J.writeMessage(2,_t,_e),J.writeVarintField(3,j.type),J.writeMessage(4,Zt,j)}function _t(_e,J){var j=_e.feature,te=_e.keys,pe=_e.values,Ce=_e.keycache,Te=_e.valuecache;for(var Le in j.properties){var we=j.properties[Le],Ye=Ce[Le];if(we!==null){Ye===void 0&&(te.push(Le),Ce[Le]=Ye=te.length-1),J.writeVarint(Ye);var nt=typeof we;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(we=JSON.stringify(we));var Ge=nt+":"+we,It=Te[Ge];It===void 0&&(pe.push(we),Te[Ge]=It=pe.length-1),J.writeVarint(It)}}}function Vt(_e,J){return(J<<3)+(7&_e)}function Lt(_e){return _e<<1^_e>>31}function Zt(_e,J){for(var j=_e.loadGeometry(),te=_e.type,pe=0,Ce=0,Te=j.length,Le=0;Le<Te;Le++){var we=j[Le],Ye=1;te===1&&(Ye=we.length),J.writeVarint(Vt(1,Ye));for(var nt=te===3?we.length-1:we.length,Ge=0;Ge<nt;Ge++){Ge===1&&te!==1&&J.writeVarint(Vt(2,nt-1));var It=we[Ge].x-pe,Ot=we[Ge].y-Ce;J.writeVarint(Lt(It)),J.writeVarint(Lt(Ot)),pe+=It,Ce+=Ot}te===3&&J.writeVarint(Vt(7,1))}}function wi(_e,J){var j=typeof _e;j==="string"?J.writeStringField(1,_e):j==="boolean"?J.writeBooleanField(7,_e):j==="number"&&(_e%1!=0?J.writeDoubleField(3,_e):_e<0?J.writeSVarintField(6,_e):J.writeVarintField(5,_e))}st.exports=vt,st.exports.fromVectorTileJs=vt,st.exports.fromGeojsonVt=function(_e,J){J=J||{};var j={};for(var te in _e)j[te]=new Gt(_e[te].features,J),j[te].name=te,j[te].version=J.version,j[te].extent=J.extent;return vt({layers:j})},st.exports.GeoJSONWrapper=Gt;var Mt=E.by(st.exports);const Si={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},Ei=Math.fround||(Qi=new Float32Array(1),_e=>(Qi[0]=+_e,Qi[0]));var Qi;const oi=3,ui=5,br=6;class Jt{constructor(J){this.options=Object.assign(Object.create(Si),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:j,minZoom:te,maxZoom:pe}=this.options;j&&console.time("total time");const Ce=`prepare ${J.length} points`;j&&console.time(Ce),this.points=J;const Te=[];for(let we=0;we<J.length;we++){const Ye=J[we];if(!Ye.geometry)continue;const[nt,Ge]=Ye.geometry.coordinates,It=Ei(ii(nt)),Ot=Ei(di(Ge));Te.push(It,Ot,1/0,we,-1,1),this.options.reduce&&Te.push(0)}let Le=this.trees[pe+1]=this._createTree(Te);j&&console.timeEnd(Ce);for(let we=pe;we>=te;we--){const Ye=+Date.now();Le=this.trees[we]=this._createTree(this._cluster(Le,we)),j&&console.log("z%d: %d clusters in %dms",we,Le.numItems,+Date.now()-Ye)}return j&&console.timeEnd("total time"),this}getClusters(J,j){let te=((J[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,J[1]));let Ce=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)te=-180,Ce=180;else if(te>Ce){const Ge=this.getClusters([te,pe,180,Te],j),It=this.getClusters([-180,pe,Ce,Te],j);return Ge.concat(It)}const Le=this.trees[this._limitZoom(j)],we=Le.range(ii(te),di(Te),ii(Ce),di(pe)),Ye=Le.data,nt=[];for(const Ge of we){const It=this.stride*Ge;nt.push(Ye[It+ui]>1?ei(Ye,It,this.clusterProps):this.points[Ye[It+oi]])}return nt}getChildren(J){const j=this._getOriginId(J),te=this._getOriginZoom(J),pe="No cluster with the specified id.",Ce=this.trees[te];if(!Ce)throw new Error(pe);const Te=Ce.data;if(j*this.stride>=Te.length)throw new Error(pe);const Le=this.options.radius/(this.options.extent*Math.pow(2,te-1)),we=Ce.within(Te[j*this.stride],Te[j*this.stride+1],Le),Ye=[];for(const nt of we){const Ge=nt*this.stride;Te[Ge+4]===J&&Ye.push(Te[Ge+ui]>1?ei(Te,Ge,this.clusterProps):this.points[Te[Ge+oi]])}if(Ye.length===0)throw new Error(pe);return Ye}getLeaves(J,j,te){const pe=[];return this._appendLeaves(pe,J,j=j||10,te=te||0,0),pe}getTile(J,j,te){const pe=this.trees[this._limitZoom(J)],Ce=Math.pow(2,J),{extent:Te,radius:Le}=this.options,we=Le/Te,Ye=(te-we)/Ce,nt=(te+1+we)/Ce,Ge={features:[]};return this._addTileFeatures(pe.range((j-we)/Ce,Ye,(j+1+we)/Ce,nt),pe.data,j,te,Ce,Ge),j===0&&this._addTileFeatures(pe.range(1-we/Ce,Ye,1,nt),pe.data,Ce,te,Ce,Ge),j===Ce-1&&this._addTileFeatures(pe.range(0,Ye,we/Ce,nt),pe.data,-1,te,Ce,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(J){let j=this._getOriginZoom(J)-1;for(;j<=this.options.maxZoom;){const te=this.getChildren(J);if(j++,te.length!==1)break;J=te[0].properties.cluster_id}return j}_appendLeaves(J,j,te,pe,Ce){const Te=this.getChildren(j);for(const Le of Te){const we=Le.properties;if(we&&we.cluster?Ce+we.point_count<=pe?Ce+=we.point_count:Ce=this._appendLeaves(J,we.cluster_id,te,pe,Ce):Ce<pe?Ce++:J.push(Le),J.length===te)break}return Ce}_createTree(J){const j=new E.av(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<J.length;te+=this.stride)j.add(J[te],J[te+1]);return j.finish(),j.data=J,j}_addTileFeatures(J,j,te,pe,Ce,Te){for(const Le of J){const we=Le*this.stride,Ye=j[we+ui]>1;let nt,Ge,It;if(Ye)nt=Yt(j,we,this.clusterProps),Ge=j[we],It=j[we+1];else{const Ii=this.points[j[we+oi]];nt=Ii.properties;const[si,xi]=Ii.geometry.coordinates;Ge=ii(si),It=di(xi)}const Ot={type:1,geometry:[[Math.round(this.options.extent*(Ge*Ce-te)),Math.round(this.options.extent*(It*Ce-pe))]],tags:nt};let jt;jt=Ye||this.options.generateId?j[we+oi]:this.points[j[we+oi]].id,jt!==void 0&&(Ot.id=jt),Te.features.push(Ot)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,j){const{radius:te,extent:pe,reduce:Ce,minPoints:Te}=this.options,Le=te/(pe*Math.pow(2,j)),we=J.data,Ye=[],nt=this.stride;for(let Ge=0;Ge<we.length;Ge+=nt){if(we[Ge+2]<=j)continue;we[Ge+2]=j;const It=we[Ge],Ot=we[Ge+1],jt=J.within(we[Ge],we[Ge+1],Le),Ii=we[Ge+ui];let si=Ii;for(const xi of jt){const fi=xi*nt;we[fi+2]>j&&(si+=we[fi+ui])}if(si>Ii&&si>=Te){let xi,fi=It*Ii,sr=Ot*Ii,Ki=-1;const hi=((Ge/nt|0)<<5)+(j+1)+this.points.length;for(const Li of jt){const ji=Li*nt;if(we[ji+2]<=j)continue;we[ji+2]=j;const ar=we[ji+ui];fi+=we[ji]*ar,sr+=we[ji+1]*ar,we[ji+4]=hi,Ce&&(xi||(xi=this._map(we,Ge,!0),Ki=this.clusterProps.length,this.clusterProps.push(xi)),Ce(xi,this._map(we,ji)))}we[Ge+4]=hi,Ye.push(fi/si,sr/si,1/0,hi,-1,si),Ce&&Ye.push(Ki)}else{for(let xi=0;xi<nt;xi++)Ye.push(we[Ge+xi]);if(si>1)for(const xi of jt){const fi=xi*nt;if(!(we[fi+2]<=j)){we[fi+2]=j;for(let sr=0;sr<nt;sr++)Ye.push(we[fi+sr])}}}}return Ye}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,j,te){if(J[j+ui]>1){const Te=this.clusterProps[J[j+br]];return te?Object.assign({},Te):Te}const pe=this.points[J[j+oi]].properties,Ce=this.options.map(pe);return te&&Ce===pe?Object.assign({},Ce):Ce}}function ei(_e,J,j){return{type:"Feature",id:_e[J+oi],properties:Yt(_e,J,j),geometry:{type:"Point",coordinates:[(te=_e[J],360*(te-.5)),ki(_e[J+1])]}};var te}function Yt(_e,J,j){const te=_e[J+ui],pe=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,Ce=_e[J+br],Te=Ce===-1?{}:Object.assign({},j[Ce]);return Object.assign(Te,{cluster:!0,cluster_id:_e[J+oi],point_count:te,point_count_abbreviated:pe})}function ii(_e){return _e/360+.5}function di(_e){const J=Math.sin(_e*Math.PI/180),j=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return j<0?0:j>1?1:j}function ki(_e){const J=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function vr(_e,J,j,te){let pe=te;const Ce=J+(j-J>>1);let Te,Le=j-J;const we=_e[J],Ye=_e[J+1],nt=_e[j],Ge=_e[j+1];for(let It=J+3;It<j;It+=3){const Ot=yr(_e[It],_e[It+1],we,Ye,nt,Ge);if(Ot>pe)Te=It,pe=Ot;else if(Ot===pe){const jt=Math.abs(It-Ce);jt<Le&&(Te=It,Le=jt)}}pe>te&&(Te-J>3&&vr(_e,J,Te,te),_e[Te+2]=pe,j-Te>3&&vr(_e,Te,j,te))}function yr(_e,J,j,te,pe,Ce){let Te=pe-j,Le=Ce-te;if(Te!==0||Le!==0){const we=((_e-j)*Te+(J-te)*Le)/(Te*Te+Le*Le);we>1?(j=pe,te=Ce):we>0&&(j+=Te*we,te+=Le*we)}return Te=_e-j,Le=J-te,Te*Te+Le*Le}function Wi(_e,J,j,te){const pe={id:_e??null,type:J,geometry:j,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")pi(pe,j);else if(J==="Polygon")pi(pe,j[0]);else if(J==="MultiLineString")for(const Ce of j)pi(pe,Ce);else if(J==="MultiPolygon")for(const Ce of j)pi(pe,Ce[0]);return pe}function pi(_e,J){for(let j=0;j<J.length;j+=3)_e.minX=Math.min(_e.minX,J[j]),_e.minY=Math.min(_e.minY,J[j+1]),_e.maxX=Math.max(_e.maxX,J[j]),_e.maxY=Math.max(_e.maxY,J[j+1])}function zi(_e,J,j,te){if(!J.geometry)return;const pe=J.geometry.coordinates;if(pe&&pe.length===0)return;const Ce=J.geometry.type,Te=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let Le=[],we=J.id;if(j.promoteId?we=J.properties[j.promoteId]:j.generateId&&(we=te||0),Ce==="Point")er(pe,Le);else if(Ce==="MultiPoint")for(const Ye of pe)er(Ye,Le);else if(Ce==="LineString")qe(pe,Le,Te,!1);else if(Ce==="MultiLineString"){if(j.lineMetrics){for(const Ye of pe)Le=[],qe(Ye,Le,Te,!1),_e.push(Wi(we,"LineString",Le,J.properties));return}cr(pe,Le,Te,!1)}else if(Ce==="Polygon")cr(pe,Le,Te,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const Ye of J.geometry.geometries)zi(_e,{id:we,geometry:Ye,properties:J.properties},j,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ye of pe){const nt=[];cr(Ye,nt,Te,!0),Le.push(nt)}}_e.push(Wi(we,Ce,Le,J.properties))}function er(_e,J){J.push(Pn(_e[0]),Ai(_e[1]),0)}function qe(_e,J,j,te){let pe,Ce,Te=0;for(let we=0;we<_e.length;we++){const Ye=Pn(_e[we][0]),nt=Ai(_e[we][1]);J.push(Ye,nt,0),we>0&&(Te+=te?(pe*nt-Ye*Ce)/2:Math.sqrt(Math.pow(Ye-pe,2)+Math.pow(nt-Ce,2))),pe=Ye,Ce=nt}const Le=J.length-3;J[2]=1,vr(J,0,Le,j),J[Le+2]=1,J.size=Math.abs(Te),J.start=0,J.end=J.size}function cr(_e,J,j,te){for(let pe=0;pe<_e.length;pe++){const Ce=[];qe(_e[pe],Ce,j,te),J.push(Ce)}}function Pn(_e){return _e/360+.5}function Ai(_e){const J=Math.sin(_e*Math.PI/180),j=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return j<0?0:j>1?1:j}function Gi(_e,J,j,te,pe,Ce,Te,Le){if(te/=J,Ce>=(j/=J)&&Te<te)return _e;if(Te<j||Ce>=te)return null;const we=[];for(const Ye of _e){const nt=Ye.geometry;let Ge=Ye.type;const It=pe===0?Ye.minX:Ye.minY,Ot=pe===0?Ye.maxX:Ye.maxY;if(It>=j&&Ot<te){we.push(Ye);continue}if(Ot<j||It>=te)continue;let jt=[];if(Ge==="Point"||Ge==="MultiPoint")Xn(nt,jt,j,te,pe);else if(Ge==="LineString")wr(nt,jt,j,te,pe,!1,Le.lineMetrics);else if(Ge==="MultiLineString")ca(nt,jt,j,te,pe,!1);else if(Ge==="Polygon")ca(nt,jt,j,te,pe,!0);else if(Ge==="MultiPolygon")for(const Ii of nt){const si=[];ca(Ii,si,j,te,pe,!0),si.length&&jt.push(si)}if(jt.length){if(Le.lineMetrics&&Ge==="LineString"){for(const Ii of jt)we.push(Wi(Ye.id,Ge,Ii,Ye.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(jt.length===1?(Ge="LineString",jt=jt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=jt.length===3?"Point":"MultiPoint"),we.push(Wi(Ye.id,Ge,jt,Ye.tags))}}return we.length?we:null}function Xn(_e,J,j,te,pe){for(let Ce=0;Ce<_e.length;Ce+=3){const Te=_e[Ce+pe];Te>=j&&Te<=te&&cn(J,_e[Ce],_e[Ce+1],_e[Ce+2])}}function wr(_e,J,j,te,pe,Ce,Te){let Le=Kr(_e);const we=pe===0?Ts:ha;let Ye,nt,Ge=_e.start;for(let si=0;si<_e.length-3;si+=3){const xi=_e[si],fi=_e[si+1],sr=_e[si+2],Ki=_e[si+3],hi=_e[si+4],Li=pe===0?xi:fi,ji=pe===0?Ki:hi;let ar=!1;Te&&(Ye=Math.sqrt(Math.pow(xi-Ki,2)+Math.pow(fi-hi,2))),Li<j?ji>j&&(nt=we(Le,xi,fi,Ki,hi,j),Te&&(Le.start=Ge+Ye*nt)):Li>te?ji<te&&(nt=we(Le,xi,fi,Ki,hi,te),Te&&(Le.start=Ge+Ye*nt)):cn(Le,xi,fi,sr),ji<j&&Li>=j&&(nt=we(Le,xi,fi,Ki,hi,j),ar=!0),ji>te&&Li<=te&&(nt=we(Le,xi,fi,Ki,hi,te),ar=!0),!Ce&&ar&&(Te&&(Le.end=Ge+Ye*nt),J.push(Le),Le=Kr(_e)),Te&&(Ge+=Ye)}let It=_e.length-3;const Ot=_e[It],jt=_e[It+1],Ii=pe===0?Ot:jt;Ii>=j&&Ii<=te&&cn(Le,Ot,jt,_e[It+2]),It=Le.length-3,Ce&&It>=3&&(Le[It]!==Le[0]||Le[It+1]!==Le[1])&&cn(Le,Le[0],Le[1],Le[2]),Le.length&&J.push(Le)}function Kr(_e){const J=[];return J.size=_e.size,J.start=_e.start,J.end=_e.end,J}function ca(_e,J,j,te,pe,Ce){for(const Te of _e)wr(Te,J,j,te,pe,Ce,!1)}function cn(_e,J,j,te){_e.push(J,j,te)}function Ts(_e,J,j,te,pe,Ce){const Te=(Ce-J)/(te-J);return cn(_e,Ce,j+(pe-j)*Te,1),Te}function ha(_e,J,j,te,pe,Ce){const Te=(Ce-j)/(pe-j);return cn(_e,J+(te-J)*Te,Ce,1),Te}function gt(_e,J){const j=[];for(let te=0;te<_e.length;te++){const pe=_e[te],Ce=pe.type;let Te;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Te=Ln(pe.geometry,J);else if(Ce==="MultiLineString"||Ce==="Polygon"){Te=[];for(const Le of pe.geometry)Te.push(Ln(Le,J))}else if(Ce==="MultiPolygon"){Te=[];for(const Le of pe.geometry){const we=[];for(const Ye of Le)we.push(Ln(Ye,J));Te.push(we)}}j.push(Wi(pe.id,Ce,Te,pe.tags))}return j}function Ln(_e,J){const j=[];j.size=_e.size,_e.start!==void 0&&(j.start=_e.start,j.end=_e.end);for(let te=0;te<_e.length;te+=3)j.push(_e[te]+J,_e[te+1],_e[te+2]);return j}function xr(_e,J){if(_e.transformed)return _e;const j=1<<_e.z,te=_e.x,pe=_e.y;for(const Ce of _e.features){const Te=Ce.geometry,Le=Ce.type;if(Ce.geometry=[],Le===1)for(let we=0;we<Te.length;we+=2)Ce.geometry.push(Rn(Te[we],Te[we+1],J,j,te,pe));else for(let we=0;we<Te.length;we++){const Ye=[];for(let nt=0;nt<Te[we].length;nt+=2)Ye.push(Rn(Te[we][nt],Te[we][nt+1],J,j,te,pe));Ce.geometry.push(Ye)}}return _e.transformed=!0,_e}function Rn(_e,J,j,te,pe,Ce){return[Math.round(j*(_e*te-pe)),Math.round(j*(J*te-Ce))]}function hn(_e,J,j,te,pe){const Ce=J===pe.maxZoom?0:pe.tolerance/((1<<J)*pe.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:_e.length,source:null,x:j,y:te,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Le of _e)dt(Te,Le,Ce,pe);return Te}function dt(_e,J,j,te){const pe=J.geometry,Ce=J.type,Te=[];if(_e.minX=Math.min(_e.minX,J.minX),_e.minY=Math.min(_e.minY,J.minY),_e.maxX=Math.max(_e.maxX,J.maxX),_e.maxY=Math.max(_e.maxY,J.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Le=0;Le<pe.length;Le+=3)Te.push(pe[Le],pe[Le+1]),_e.numPoints++,_e.numSimplified++;else if(Ce==="LineString")li(Te,pe,_e,j,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Le=0;Le<pe.length;Le++)li(Te,pe[Le],_e,j,Ce==="Polygon",Le===0);else if(Ce==="MultiPolygon")for(let Le=0;Le<pe.length;Le++){const we=pe[Le];for(let Ye=0;Ye<we.length;Ye++)li(Te,we[Ye],_e,j,!0,Ye===0)}if(Te.length){let Le=J.tags||null;if(Ce==="LineString"&&te.lineMetrics){Le={};for(const Ye in J.tags)Le[Ye]=J.tags[Ye];Le.mapbox_clip_start=pe.start/pe.size,Le.mapbox_clip_end=pe.end/pe.size}const we={geometry:Te,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Le};J.id!==null&&(we.id=J.id),_e.features.push(we)}}function li(_e,J,j,te,pe,Ce){const Te=te*te;if(te>0&&J.size<(pe?Te:te))return void(j.numPoints+=J.length/3);const Le=[];for(let we=0;we<J.length;we+=3)(te===0||J[we+2]>Te)&&(j.numSimplified++,Le.push(J[we],J[we+1])),j.numPoints++;pe&&function(we,Ye){let nt=0;for(let Ge=0,It=we.length,Ot=It-2;Ge<It;Ot=Ge,Ge+=2)nt+=(we[Ge]-we[Ot])*(we[Ge+1]+we[Ot+1]);if(nt>0===Ye)for(let Ge=0,It=we.length;Ge<It/2;Ge+=2){const Ot=we[Ge],jt=we[Ge+1];we[Ge]=we[It-2-Ge],we[Ge+1]=we[It-1-Ge],we[It-2-Ge]=Ot,we[It-1-Ge]=jt}}(Le,Ce),_e.push(Le)}const $t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Wt{constructor(J,j){const te=(j=this.options=function(Ce,Te){for(const Le in Te)Ce[Le]=Te[Le];return Ce}(Object.create($t),j)).debug;if(te&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=function(Ce,Te){const Le=[];if(Ce.type==="FeatureCollection")for(let we=0;we<Ce.features.length;we++)zi(Le,Ce.features[we],Te,we);else zi(Le,Ce.type==="Feature"?Ce:{geometry:Ce},Te);return Le}(J,j);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(Ce,Te){const Le=Te.buffer/Te.extent;let we=Ce;const Ye=Gi(Ce,1,-1-Le,Le,0,-1,2,Te),nt=Gi(Ce,1,1-Le,2+Le,0,-1,2,Te);return(Ye||nt)&&(we=Gi(Ce,1,-Le,1+Le,0,-1,2,Te)||[],Ye&&(we=gt(Ye,1).concat(we)),nt&&(we=we.concat(gt(nt,-1)))),we}(pe,j),pe.length&&this.splitTile(pe,0,0,0),te&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,j,te,pe,Ce,Te,Le){const we=[J,j,te,pe],Ye=this.options,nt=Ye.debug;for(;we.length;){pe=we.pop(),te=we.pop(),j=we.pop(),J=we.pop();const Ge=1<<j,It=un(j,te,pe);let Ot=this.tiles[It];if(!Ot&&(nt>1&&console.time("creation"),Ot=this.tiles[It]=hn(J,j,te,pe,Ye),this.tileCoords.push({z:j,x:te,y:pe}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,te,pe,Ot.numFeatures,Ot.numPoints,Ot.numSimplified),console.timeEnd("creation"));const ar=`z${j}`;this.stats[ar]=(this.stats[ar]||0)+1,this.total++}if(Ot.source=J,Ce==null){if(j===Ye.indexMaxZoom||Ot.numPoints<=Ye.indexMaxPoints)continue}else{if(j===Ye.maxZoom||j===Ce)continue;if(Ce!=null){const ar=Ce-j;if(te!==Te>>ar||pe!==Le>>ar)continue}}if(Ot.source=null,J.length===0)continue;nt>1&&console.time("clipping");const jt=.5*Ye.buffer/Ye.extent,Ii=.5-jt,si=.5+jt,xi=1+jt;let fi=null,sr=null,Ki=null,hi=null,Li=Gi(J,Ge,te-jt,te+si,0,Ot.minX,Ot.maxX,Ye),ji=Gi(J,Ge,te+Ii,te+xi,0,Ot.minX,Ot.maxX,Ye);J=null,Li&&(fi=Gi(Li,Ge,pe-jt,pe+si,1,Ot.minY,Ot.maxY,Ye),sr=Gi(Li,Ge,pe+Ii,pe+xi,1,Ot.minY,Ot.maxY,Ye),Li=null),ji&&(Ki=Gi(ji,Ge,pe-jt,pe+si,1,Ot.minY,Ot.maxY,Ye),hi=Gi(ji,Ge,pe+Ii,pe+xi,1,Ot.minY,Ot.maxY,Ye),ji=null),nt>1&&console.timeEnd("clipping"),we.push(fi||[],j+1,2*te,2*pe),we.push(sr||[],j+1,2*te,2*pe+1),we.push(Ki||[],j+1,2*te+1,2*pe),we.push(hi||[],j+1,2*te+1,2*pe+1)}}getTile(J,j,te){J=+J,j=+j,te=+te;const pe=this.options,{extent:Ce,debug:Te}=pe;if(J<0||J>24)return null;const Le=1<<J,we=un(J,j=j+Le&Le-1,te);if(this.tiles[we])return xr(this.tiles[we],Ce);Te>1&&console.log("drilling down to z%d-%d-%d",J,j,te);let Ye,nt=J,Ge=j,It=te;for(;!Ye&&nt>0;)nt--,Ge>>=1,It>>=1,Ye=this.tiles[un(nt,Ge,It)];return Ye&&Ye.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",nt,Ge,It),console.time("drilling down")),this.splitTile(Ye.source,nt,Ge,It,J,j,te),Te>1&&console.timeEnd("drilling down"),this.tiles[we]?xr(this.tiles[we],Ce):null):null}}function un(_e,J,j){return 32*((1<<_e)*j+J)+_e}function ni(_e,J){return J?_e.properties[J]:_e.id}function Fn(_e,J){if(_e==null)return!0;if(_e.type==="Feature")return ni(_e,J)!=null;if(_e.type==="FeatureCollection"){const j=new Set;for(const te of _e.features){const pe=ni(te,J);if(pe==null||j.has(pe))return!1;j.add(pe)}return!0}return!1}function zn(_e,J){const j=new Map;if(_e!=null)if(_e.type==="Feature")j.set(ni(_e,J),_e);else for(const te of _e.features)j.set(ni(te,J),te);return j}class es extends fe{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,j){return E._(this,void 0,void 0,function*(){const te=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const pe=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!pe)return null;const Ce=new class{constructor(Le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=E.X,this.length=Le.length,this._features=Le}feature(Le){return new class{constructor(we){this._feature=we,this.extent=E.X,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Ye of this._feature.geometry)we.push([new E.P(Ye[0],Ye[1])]);return we}{const we=[];for(const Ye of this._feature.geometry){const nt=[];for(const Ge of Ye)nt.push(new E.P(Ge[0],Ge[1]));we.push(nt)}return we}}toGeoJSON(we,Ye,nt){return et.call(this,we,Ye,nt)}}(this._features[Le])}}(pe.features);let Te=Mt(Ce);return Te.byteOffset===0&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),{vectorTile:Ce,rawData:Te.buffer}})}loadData(J){return E._(this,void 0,void 0,function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const te=!!(J&&J.request&&J.request.collectResourceTiming)&&new E.bv(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new Jt(function({superclusterOptions:Te,clusterProperties:Le}){if(!Le||!Te)return Te;const we={},Ye={},nt={accumulated:null,zoom:0},Ge={properties:null},It=Object.keys(Le);for(const Ot of It){const[jt,Ii]=Le[Ot],si=E.bC(Ii),xi=E.bC(typeof jt=="string"?[jt,["accumulated"],["get",Ot]]:jt);we[Ot]=si.value,Ye[Ot]=xi.value}return Te.map=Ot=>{Ge.properties=Ot;const jt={};for(const Ii of It)jt[Ii]=we[Ii].evaluate(nt,Ge);return jt},Te.reduce=(Ot,jt)=>{Ge.properties=jt;for(const Ii of It)nt.accumulated=Ot[Ii],Ot[Ii]=Ye[Ii].evaluate(nt,Ge)},Te}(J)).load((yield this._pendingData).features):(pe=yield this._pendingData,new Wt(pe,J.geojsonVtOptions)),this.loaded={};const Ce={};if(te){const Te=te.finish();Te&&(Ce.resourceTiming={},Ce.resourceTiming[J.source]=JSON.parse(JSON.stringify(Te)))}return Ce}catch(Ce){if(delete this._pendingRequest,E.bB(Ce))return{abandoned:!0};throw Ce}var pe})}getData(){return E._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){const j=this.loaded;return j&&j[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,j){return E._(this,void 0,void 0,function*(){let te=yield this.loadGeoJSON(J,j);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(Xe(te,!0),J.filter){const pe=E.bC(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(Te=>`${Te.key}: ${Te.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(Te=>pe.value.evaluate({zoom:0},Te))}}return te})}loadGeoJSON(J,j){return E._(this,void 0,void 0,function*(){const{promoteId:te}=J;if(J.request){const pe=yield E.h(J.request,j);return this._dataUpdateable=Fn(pe.data,te)?zn(pe.data,te):void 0,pe.data}if(typeof J.data=="string")try{const pe=JSON.parse(J.data);return this._dataUpdateable=Fn(pe,te)?zn(pe,te):void 0,pe}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(pe,Ce,Te){var Le,we,Ye,nt;if(Ce.removeAll&&pe.clear(),Ce.remove)for(const Ge of Ce.remove)pe.delete(Ge);if(Ce.add)for(const Ge of Ce.add){const It=ni(Ge,Te);It!=null&&pe.set(It,Ge)}if(Ce.update)for(const Ge of Ce.update){let It=pe.get(Ge.id);if(It==null)continue;const Ot=!Ge.removeAllProperties&&(((Le=Ge.removeProperties)===null||Le===void 0?void 0:Le.length)>0||((we=Ge.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((Ge.newGeometry||Ge.removeAllProperties||Ot)&&(It=Object.assign({},It),pe.set(Ge.id,It),Ot&&(It.properties=Object.assign({},It.properties))),Ge.newGeometry&&(It.geometry=Ge.newGeometry),Ge.removeAllProperties)It.properties={};else if(((Ye=Ge.removeProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const jt of Ge.removeProperties)Object.prototype.hasOwnProperty.call(It.properties,jt)&&delete It.properties[jt];if(((nt=Ge.addOrUpdateProperties)===null||nt===void 0?void 0:nt.length)>0)for(const{key:jt,value:Ii}of Ge.addOrUpdateProperties)It.properties[jt]=Ii}}(this._dataUpdateable,J.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return E._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class _n{constructor(J){this.self=J,this.actor=new E.F(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(j,te)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=te},this.self.addProtocol=E.bi,this.self.removeProtocol=E.bj,this.self.registerRTLTextPlugin=j=>{if(E.bD.isParsed())throw new Error("RTL text plugin already registered.");E.bD.setMethods(j)},this.actor.registerMessageHandler("LDT",(j,te)=>this._getDEMWorkerSource(j,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(j,te)=>E._(this,void 0,void 0,function*(){this._getDEMWorkerSource(j,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(j,te)=>E._(this,void 0,void 0,function*(){return this._getWorkerSource(j,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(j,te)=>E._(this,void 0,void 0,function*(){return this._getWorkerSource(j,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(j,te)=>E._(this,void 0,void 0,function*(){return this._getWorkerSource(j,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(j,te)=>this._getWorkerSource(j,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("GD",(j,te)=>this._getWorkerSource(j,te.type,te.source).getData()),this.actor.registerMessageHandler("LT",(j,te)=>this._getWorkerSource(j,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(j,te)=>this._getWorkerSource(j,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(j,te)=>this._getWorkerSource(j,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(j,te)=>this._getWorkerSource(j,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(j,te)=>E._(this,void 0,void 0,function*(){if(!this.workerSources[j]||!this.workerSources[j][te.type]||!this.workerSources[j][te.type][te.source])return;const pe=this.workerSources[j][te.type][te.source];delete this.workerSources[j][te.type][te.source],pe.removeSource!==void 0&&pe.removeSource(te)})),this.actor.registerMessageHandler("RM",j=>E._(this,void 0,void 0,function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j]})),this.actor.registerMessageHandler("SR",(j,te)=>E._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(j,te)=>this._syncRTLPluginState(j,te)),this.actor.registerMessageHandler("IS",(j,te)=>E._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(j,te)=>this._setImages(j,te)),this.actor.registerMessageHandler("UL",(j,te)=>E._(this,void 0,void 0,function*(){this._getLayerIndex(j).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(j,te)=>E._(this,void 0,void 0,function*(){this._getLayerIndex(j).replace(te)}))}_setImages(J,j){return E._(this,void 0,void 0,function*(){this.availableImages[J]=j;for(const te in this.workerSources[J]){const pe=this.workerSources[J][te];for(const Ce in pe)pe[Ce].availableImages=j}})}_syncRTLPluginState(J,j){return E._(this,void 0,void 0,function*(){if(E.bD.isParsed())return E.bD.getState();if(j.pluginStatus!=="loading")return E.bD.setState(j),j;const te=j.pluginURL;if(this.self.importScripts(te),E.bD.isParsed()){const pe={pluginStatus:"loaded",pluginURL:te};return E.bD.setState(pe),pe}throw E.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${te}`)})}_getAvailableImages(J){let j=this.availableImages[J];return j||(j=[]),j}_getLayerIndex(J){let j=this.layerIndexes[J];return j||(j=this.layerIndexes[J]=new c),j}_getWorkerSource(J,j,te){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][j]||(this.workerSources[J][j]={}),!this.workerSources[J][j][te]){const pe={sendAsync:(Ce,Te)=>(Ce.targetMapId=J,this.actor.sendAsync(Ce,Te))};switch(j){case"vector":this.workerSources[J][j][te]=new fe(pe,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][j][te]=new es(pe,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][j][te]=new this.externalWorkerSourceTypes[j](pe,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][j][te]}_getDEMWorkerSource(J,j){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][j]||(this.demWorkerSources[J][j]=new oe),this.demWorkerSources[J][j]}}return E.i(self)&&(self.worker=new _n(self)),_n}),D("index",["exports","./shared"],function(E,c){var X="4.7.1";let he,Ie;const fe={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:u=>new Promise((e,n)=>{const a=requestAnimationFrame(e);u.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(c.c())})}),getImageData(u,e=0){return this.getImageCanvasContext(u).getImageData(-e,-e,u.width+2*e,u.height+2*e)},getImageCanvasContext(u){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=u.width,e.height=u.height,n.drawImage(u,0,0,u.width,u.height),n},resolveURL:u=>(he||(he=document.createElement("a")),he.href=u,he.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ie==null&&(Ie=matchMedia("(prefers-reduced-motion: reduce)")),Ie.matches)}};class oe{static testProp(e){if(!oe.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in oe.docStyle)return e[n];return e[0]}static create(e,n,a){const o=window.document.createElement(e);return n!==void 0&&(o.className=n),a&&a.appendChild(o),o}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){oe.docStyle&&oe.selectProp&&(oe.userSelect=oe.docStyle[oe.selectProp],oe.docStyle[oe.selectProp]="none")}static enableDrag(){oe.docStyle&&oe.selectProp&&(oe.docStyle[oe.selectProp]=oe.userSelect)}static setTransform(e,n){e.style[oe.transformProp]=n}static addEventListener(e,n,a,o={}){e.addEventListener(n,a,"passive"in o?o:o.capture)}static removeEventListener(e,n,a,o={}){e.removeEventListener(n,a,"passive"in o?o:o.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",oe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",oe.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",oe.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const o=n.boundingClientRect;return new c.P((a.clientX-o.left)/n.x-e.clientLeft,(a.clientY-o.top)/n.y-e.clientTop)}static mousePos(e,n){const a=oe.getScale(e);return oe.getPoint(e,a,n)}static touchPos(e,n){const a=[],o=oe.getScale(e);for(let h=0;h<n.length;h++)a.push(oe.getPoint(e,o,n[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}oe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,oe.selectProp=oe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),oe.transformProp=oe.testProp(["transform","WebkitTransform"]);const Fe={supported:!1,testSupport:function(u){!et&&Xe&&(st?Ne(u):Ue=u)}};let Ue,Xe,et=!1,st=!1;function Ne(u){const e=u.createTexture();u.bindTexture(u.TEXTURE_2D,e);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Xe),u.isContextLost())return;Fe.supported=!0}catch{}u.deleteTexture(e),et=!0}var He;typeof document<"u"&&(Xe=document.createElement("img"),Xe.onload=()=>{Ue&&Ne(Ue),Ue=null,st=!0},Xe.onerror=()=>{et=!0,Ue=null},Xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let e,n,a,o;u.resetRequestQueue=()=>{e=[],n=0,a=0,o={}},u.addThrottleControl=C=>{const T=a++;return o[T]=C,T},u.removeThrottleControl=C=>{delete o[C],I()},u.getImage=(C,T,F=!0)=>new Promise((z,$)=>{Fe.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),c.e(C,{type:"image"}),e.push({abortController:T,requestParameters:C,supportImageRefresh:F,state:"queued",onError:ie=>{$(ie)},onSuccess:ie=>{z(ie)}}),I()});const h=C=>c._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:T,supportImageRefresh:F,onError:z,onSuccess:$,abortController:ie}=C,ce=F===!1&&!c.i(self)&&!c.g(T.url)&&(!T.headers||Object.keys(T.headers).reduce((A,w)=>A&&w==="accept",!0));n++;const m=ce?v(T,ie):c.m(T,ie);try{const A=yield m;delete C.abortController,C.state="completed",A.data instanceof HTMLImageElement||c.b(A.data)?$(A):A.data&&$({data:yield(p=A.data,typeof createImageBitmap=="function"?c.d(p):c.f(p)),cacheControl:A.cacheControl,expires:A.expires})}catch(A){delete C.abortController,z(A)}finally{n--,I()}var p}),I=()=>{const C=(()=>{for(const T of Object.keys(o))if(o[T]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let T=n;T<C&&e.length>0;T++){const F=e.shift();F.abortController.signal.aborted?T--:h(F)}},v=(C,T)=>new Promise((F,z)=>{const $=new Image,ie=C.url,ce=C.credentials;ce&&ce==="include"?$.crossOrigin="use-credentials":(ce&&ce==="same-origin"||!c.s(ie))&&($.crossOrigin="anonymous"),T.signal.addEventListener("abort",()=>{$.src="",z(c.c())}),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,F({data:$})},$.onerror=()=>{$.onerror=$.onload=null,T.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=ie})}(He||(He={})),He.resetRequestQueue();class $e{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function lt(u){var e=new c.A(3);return e[0]=u[0],e[1]=u[1],e[2]=u[2],e}var Qt,ht=function(u,e,n){return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],u};Qt=new c.A(3),c.A!=Float32Array&&(Qt[0]=0,Qt[1]=0,Qt[2]=0);var Gt=function(u){var e=u[0],n=u[1];return e*e+n*n};function vt(u){const e=[];if(typeof u=="string")e.push({id:"default",url:u});else if(u&&u.length>0){const n=[];for(const{id:a,url:o}of u){const h=`${a}${o}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:a,url:o}))}}return e}function Tt(u,e,n){const a=u.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var u=new c.A(2);c.A!=Float32Array&&(u[0]=0,u[1]=0)})();class bt{constructor(e,n,a,o){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,o)}update(e,n,a){const{width:o,height:h}=e,I=!(this.size&&this.size[0]===o&&this.size[1]===h||a),{context:v}=this,{gl:C}=v;if(this.useMipmap=!!(n&&n.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!n||n.premultiply!==!1)),I)this.size=[o,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,e):C.texImage2D(C.TEXTURE_2D,0,this.format,o,h,0,this.format,C.UNSIGNED_BYTE,e.data);else{const{x:T,y:F}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?C.texSubImage2D(C.TEXTURE_2D,0,T,F,C.RGBA,C.UNSIGNED_BYTE,e):C.texSubImage2D(C.TEXTURE_2D,0,T,F,o,h,C.RGBA,C.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(e,n,a){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function _t(u){const{userImage:e}=u;return!!(e&&e.render&&e.render())&&(u.data.replace(new Uint8Array(e.data.buffer)),!0)}class Vt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const o=n.data||n.spriteData;return this._validateStretch(n.stretchX,o&&o.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,o&&o.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const o of e){if(o[0]<a||o[1]<o[0]||n<o[1])return!1;a=o[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,o=a&&a.width||n.data.width,h=a&&a.height||n.data.height;return!(e[0]<0||o<e[0]||e[1]<0||h<e[1]||e[2]<0||o<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const o=this.getImage(e);if(a&&(o.data.width!==n.data.width||o.data.height!==n.data.height))throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let o=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(o=!1);this.isLoaded()||o?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let o=this.getImage(a);o||(this.fire(new c.k("styleimagemissing",{id:a})),o=this.getImage(a)),o?n[a]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,textFitWidth:o.textFitWidth,textFitHeight:o.textFitHeight,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const o={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new c.I(o,a);this.patterns[e]={bin:o,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new bt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:n,h:a}=c.p(e),o=this.atlasImage;o.resize({width:n||1,height:a||1});for(const h in this.patterns){const{bin:I}=this.patterns[h],v=I.x+1,C=I.y+1,T=this.getImage(h).data,F=T.width,z=T.height;c.R.copy(T,o,{x:0,y:0},{x:v,y:C},{width:F,height:z}),c.R.copy(T,o,{x:0,y:z-1},{x:v,y:C-1},{width:F,height:1}),c.R.copy(T,o,{x:0,y:0},{x:v,y:C+z},{width:F,height:1}),c.R.copy(T,o,{x:F-1,y:0},{x:v-1,y:C},{width:1,height:z}),c.R.copy(T,o,{x:0,y:0},{x:v+F,y:C},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),_t(a)&&this.updateImage(n,a)}}}const Lt=1e20;function Zt(u,e,n,a,o,h,I,v,C){for(let T=e;T<e+a;T++)wi(u,n*h+T,h,o,I,v,C);for(let T=n;T<n+o;T++)wi(u,T*h+e,1,a,I,v,C)}function wi(u,e,n,a,o,h,I){h[0]=0,I[0]=-Lt,I[1]=Lt,o[0]=u[e];for(let v=1,C=0,T=0;v<a;v++){o[v]=u[e+v*n];const F=v*v;do{const z=h[C];T=(o[v]-o[z]+F-z*z)/(v-z)/2}while(T<=I[C]&&--C>-1);C++,h[C]=v,I[C]=T,I[C+1]=Lt}for(let v=0,C=0;v<a;v++){for(;I[C+1]<v;)C++;const T=h[C],F=v-T;u[e+v*n]=o[T]+F*F}}class Mt{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const h in e)for(const I of e[h])n.push(this._getAndCacheGlyphsPromise(h,I));const a=yield Promise.all(n),o={};for(const{stack:h,id:I,glyph:v}of a)o[h]||(o[h]={}),o[h][I]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};return o})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let o=a.glyphs[n];if(o!==void 0)return{stack:e,id:n,glyph:o};if(o=this._tinySDF(a,e,n),o)return a.glyphs[n]=o,{stack:e,id:n,glyph:o};const h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:n,glyph:o};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const v=Mt.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=v}const I=yield a.requests[h];for(const v in I)this._doesCharSupportLocalGlyph(+v)||(a.glyphs[+v]=I[+v]);return a.ranges[h]=!0,{stack:e,id:n,glyph:I[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const o=this.localIdeographFontFamily;if(!o||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let v="400";/bold/i.test(n)?v="900":/medium/i.test(n)?v="500":/light/i.test(n)&&(v="200"),h=e.tinySDF=new Mt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:v})}const I=h.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}Mt.loadGlyphRange=function(u,e,n,a){return c._(this,void 0,void 0,function*(){const o=256*e,h=o+255,I=a.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${o}-${h}`),"Glyphs"),v=yield c.l(I,new AbortController);if(!v||!v.data)throw new Error(`Could not load glyph range. range: ${e}, ${o}-${h}`);const C={};for(const T of c.n(v.data))C[T.id]=T;return C})},Mt.TinySDF=class{constructor({fontSize:u=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:o="sans-serif",fontWeight:h="normal",fontStyle:I="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const v=this.size=u+4*e,C=this._createCanvas(v),T=this.ctx=C.getContext("2d",{willReadFrequently:!0});T.font=`${I} ${h} ${u}px ${o}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(u){const e=document.createElement("canvas");return e.width=e.height=u,e}draw(u){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:o,actualBoundingBoxRight:h}=this.ctx.measureText(u),I=Math.ceil(n),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-o))),C=Math.min(this.size-this.buffer,I+Math.ceil(a)),T=v+2*this.buffer,F=C+2*this.buffer,z=Math.max(T*F,0),$=new Uint8ClampedArray(z),ie={data:$,width:T,height:F,glyphWidth:v,glyphHeight:C,glyphTop:I,glyphLeft:0,glyphAdvance:e};if(v===0||C===0)return ie;const{ctx:ce,buffer:m,gridInner:p,gridOuter:A}=this;ce.clearRect(m,m,v,C),ce.fillText(u,m,m+I);const w=ce.getImageData(m,m,v,C);A.fill(Lt,0,z),p.fill(0,0,z);for(let B=0;B<C;B++)for(let k=0;k<v;k++){const P=w.data[4*(B*v+k)+3]/255;if(P===0)continue;const S=(B+m)*T+k+m;if(P===1)A[S]=0,p[S]=Lt;else{const V=.5-P;A[S]=V>0?V*V:0,p[S]=V<0?V*V:0}}Zt(A,0,0,T,F,T,this.f,this.v,this.z),Zt(p,m,m,v,C,T,this.f,this.v,this.z);for(let B=0;B<z;B++){const k=Math.sqrt(A[B])-Math.sqrt(p[B]);$[B]=Math.round(255-255*(k/this.radius+this.cutoff))}return ie}};class Si{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:c.y.number(e.x,n.x,a),y:c.y.number(e.y,n.y,a),z:c.y.number(e.z,n.z,a)}}}let Ei;class Qi extends c.E{constructor(e){super(),Ei=Ei||new c.q({anchor:new c.D(c.v.light.anchor),position:new Si,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Ei),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const oi=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class ui extends c.E{constructor(e){super(),this._transitionable=new c.T(oi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class br{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const o=[];let h=e.length%2==1?-e[e.length-1]*a:0,I=e[0]*a,v=!0;o.push({left:h,right:I,isDash:v,zeroLength:e[0]===0});let C=e[0];for(let T=1;T<e.length;T++){v=!v;const F=e[T];h=C*a,C+=F,I=C*a,o.push({left:h,right:I,isDash:v,zeroLength:F===0})}return o}addRoundDash(e,n,a){const o=n/2;for(let h=-a;h<=a;h++){const I=this.width*(this.nextRow+a+h);let v=0,C=e[v];for(let T=0;T<this.width;T++){T/C.right>1&&(C=e[++v]);const F=Math.abs(T-C.left),z=Math.abs(T-C.right),$=Math.min(F,z);let ie;const ce=h/a*(o+1);if(C.isDash){const m=o-Math.abs(ce);ie=Math.sqrt($*$+m*m)}else ie=o-Math.sqrt($*$+ce*ce);this.data[I+T]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(e){for(let v=e.length-1;v>=0;--v){const C=e[v],T=e[v+1];C.zeroLength?e.splice(v,1):T&&T.isDash===C.isDash&&(T.left=C.left,e.splice(v,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const o=this.width*this.nextRow;let h=0,I=e[h];for(let v=0;v<this.width;v++){v/I.right>1&&(I=e[++h]);const C=Math.abs(v-I.left),T=Math.abs(v-I.right),F=Math.min(C,T);this.data[o+v]=Math.max(0,Math.min(255,(I.isDash?F:-F)+128))}}addDash(e,n){const a=n?7:0,o=2*a+1;if(this.nextRow+o>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let v=0;v<e.length;v++)h+=e[v];if(h!==0){const v=this.width/h,C=this.getDashRanges(e,this.width,v);n?this.addRoundDash(C,v,a):this.addRegularDash(C)}const I={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=o,this.dirty=!0,I}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Jt="maplibre_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Jt]}numActive(){return Object.keys(this.active).length}}const Yt=Math.floor(fe.hardwareConcurrency/2);let ii,di;function ki(){return ii||(ii=new ei),ii}ei.workerCount=c.C(globalThis)?Math.max(Math.min(Yt,3),1):1;class vr{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let o=0;o<a.length;o++){const h=new c.F(a[o],n);h.name=`Worker ${o}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const o of this.actors)a.push(o.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function yr(){return di||(di=new vr(ki(),c.G),di.registerMessageHandler("GR",(u,e,n)=>c.m(e,n))),di}function Wi(u,e){const n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*u.width,.5*u.height,1]),c.L(n,n,u.calculatePosMatrix(e.toUnwrapped()))}function pi(u,e,n,a,o,h){const I=function(z,$,ie){if(z)for(const ce of z){const m=$[ce];if(m&&m.source===ie&&m.type==="fill-extrusion")return!0}else for(const ce in $){const m=$[ce];if(m.source===ie&&m.type==="fill-extrusion")return!0}return!1}(o&&o.layers,e,u.id),v=h.maxPitchScaleFactor(),C=u.tilesIn(a,v,I);C.sort(zi);const T=[];for(const z of C)T.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,u._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,o,h,v,Wi(u.transform,z.tileID))});const F=function(z){const $={},ie={};for(const ce of z){const m=ce.queryResults,p=ce.wrappedTileID,A=ie[p]=ie[p]||{};for(const w in m){const B=m[w],k=A[w]=A[w]||{},P=$[w]=$[w]||[];for(const S of B)k[S.featureIndex]||(k[S.featureIndex]=!0,P.push(S))}}return $}(T);for(const z in F)F[z].forEach($=>{const ie=$.feature,ce=u.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ce});return F}function zi(u,e){const n=u.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function er(u,e,n){return c._(this,void 0,void 0,function*(){let a=u;if(u.url?a=(yield c.h(e.transformRequest(u.url,"Source"),n)).data:yield fe.frameAsync(n),!a)return null;const o=c.M(c.e(a,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(o.vectorLayerIds=a.vector_layers.map(h=>h.id)),o})}class qe{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let o,h;if(e instanceof c.N)o=e,h=e;else{if(!(e instanceof qe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(qe.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(o=e._sw,h=e._ne,!o||!h)return this}return n||a?(n.lng=Math.min(o.lng,n.lng),n.lat=Math.min(o.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new c.N(o.lng,o.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=c.N.convert(e);let o=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&o}static convert(e){return e instanceof qe?e:e&&new qe(e)}static fromLngLat(e,n=0){const a=360*n/40075017,o=a/Math.cos(Math.PI/180*e.lat);return new qe(new c.N(e.lng-o,e.lat-a),new c.N(e.lng+o,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new qe(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class cr{constructor(e,n,a){this.bounds=qe.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*n),o=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),I=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<h&&e.y>=o&&e.y<I}}class Pn extends c.E{constructor(e,n,a,o){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield er(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new cr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let o="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,I)=>{e.reloadPromise={resolve:h,reject:I}})}else e.actor=this.dispatcher.getActor(),o="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:o,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ai extends c.E{constructor(e,n,a,o){super(),this.id=e,this.dispatcher=a,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield er(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new cr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield He.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const o=this.map.painter.context,h=o.gl,I=a.data;e.texture=this.map.painter.getTileTexture(I.width),e.texture?e.texture.update(I,{useMipmap:!0}):(e.texture=new bt(o,I,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Gi extends Ai{constructor(e,n,a,o){super(e,n,a,o),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const o=yield He.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){const h=o.data;this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const I=c.b(h)&&c.U()?h:yield this.readImageNow(h),v={type:this.type,uid:e.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const C=yield e.actor.sendAsync({type:"LDT",data:v});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const n=e.width+2,a=e.height+2;try{return new c.R({width:n,height:a},yield c.W(e,-1,-1,n,a))}catch{}}return fe.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),o=(n.x-1+a)%a,h=n.x===0?e.wrap-1:e.wrap,I=(n.x+1+a)%a,v=n.x+1===a?e.wrap+1:e.wrap,C={};return C[new c.S(e.overscaledZ,h,n.z,o,n.y).key]={backfilled:!1},C[new c.S(e.overscaledZ,v,n.z,I,n.y).key]={backfilled:!1},n.y>0&&(C[new c.S(e.overscaledZ,h,n.z,o,n.y-1).key]={backfilled:!1},C[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new c.S(e.overscaledZ,v,n.z,I,n.y-1).key]={backfilled:!1}),n.y+1<a&&(C[new c.S(e.overscaledZ,h,n.z,o,n.y+1).key]={backfilled:!1},C[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new c.S(e.overscaledZ,v,n.z,I,n.y+1).key]={backfilled:!1}),C}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Xn extends c.E{constructor(e,n,a,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(o),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(fe.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let o=null;a.resourceTiming&&a.resourceTiming[this.id]&&(o=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&o&&o.length>0&&c.e(h,{resourceTiming:o}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const o=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(o,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var wr=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kr extends c.E{constructor(e,n,a,o){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield He.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.Z.fromLngLat);this.tileID=function(o){let h=1/0,I=1/0,v=-1/0,C=-1/0;for(const $ of o)h=Math.min(h,$.x),I=Math.min(I,$.y),v=Math.max(v,$.x),C=Math.max(C,$.y);const T=Math.max(v-h,C-I),F=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),z=Math.pow(2,F);return new c.a1(F,Math.floor((h+v)/2*z),Math.floor((I+C)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(o=>this.tileID.getTilePoint(o)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,wr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new bt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const h=this.tiles[o];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ca extends Kr{constructor(e,n,a,o){super(e,n,a,o),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,wr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new bt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const h=this.tiles[o];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class cn extends Kr{constructor(e,n,a,o){super(e,n,a,o),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(I=>typeof I!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,wr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new bt(n,this.canvas,a.RGBA,{premultiply:!0});let o=!1;for(const h in this.tiles){const I=this.tiles[h];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ts={},ha=u=>{switch(u){case"geojson":return Xn;case"image":return Kr;case"raster":return Ai;case"raster-dem":return Gi;case"vector":return Pn;case"video":return ca;case"canvas":return cn}return Ts[u]},gt="RTLPluginLoaded";class Ln extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=yr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=fe.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(gt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xr=null;function Rn(){return xr||(xr=new Ln),xr}class hn{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,h){const I={};if(!h)return I;for(const v of o){const C=v.layerIds.map(T=>h.getLayer(T)).filter(Boolean);if(C.length!==0){v.layers=C,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(T=>C.filter(F=>F.id===T)[0]));for(const T of C)I[T.id]=v}}return I}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const h=this.buckets[o];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const h=this.buckets[o];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,Rn().lazyLoad();break}}this.queryPadding=0;for(const o in this.buckets){const h=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(o).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const o=this.buckets[a];o.uploadPending()&&o.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,o,h,I,v,C,T,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:o,cameraQueryGeometry:h,scale:I,tileSize:this.tileSize,pixelPosMatrix:F,transform:C,params:v,queryPadding:this.queryPadding*T},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const o=a.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",I=o._geojsonTileLayer||o[h];if(!I)return;const v=c.a7(n&&n.filter),{z:C,x:T,y:F}=this.tileID.canonical,z={z:C,x:T,y:F};for(let $=0;$<I.length;$++){const ie=I.feature($);if(v.needGeometry){const p=c.a8(ie,!0);if(!v.filter(new c.z(this.tileID.overscaledZ),p,this.tileID.canonical))continue}else if(!v.filter(new c.z(this.tileID.overscaledZ),ie))continue;const ce=a.getId(ie,h),m=new c.a9(ie,C,T,F,ce);m.tile=z,e.push(m)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let o=!1;if(this.expirationTime>a)o=!1;else if(n)if(this.expirationTime<n)o=!0;else{const h=this.expirationTime-n;h?this.expirationTime=a+Math.max(h,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const o in this.buckets){if(!n.style.hasLayer(o))continue;const h=this.buckets[o],I=h.layers[0].sourceLayer||"_geojsonTileLayer",v=a[I],C=e[I];if(!v||!C||Object.keys(C).length===0)continue;h.update(C,v,this.imageAtlas&&this.imageAtlas.patternPositions||{});const T=n&&n.style&&n.style.getLayer(o);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fe.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=fe.now()+e}setDependencies(e,n){const a={};for(const o of n)a[o]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const o=this.dependencies[a];if(o){for(const h of n)if(o[h])return!0}}return!1}}class dt{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const o=e.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const h={value:n,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[o].push(h),this.order.push(o),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,o=n===void 0?0:this.data[a].indexOf(n),h=this.data[a][o];return this.data[a].splice(o,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const o of this.data[a])e(o.value)||n.push(o);for(const a of n)this.remove(a.value.tileID,a)}}class li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const o=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},c.e(this.stateChanges[e][o],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==o&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][o]===null){this.deletedStates[e][o]={};for(const h in this.state[e][o])a[h]||(this.deletedStates[e][o][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][o]&&this.deletedStates[e][o][h]===null&&delete this.deletedStates[e][o][h]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const o=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][o]!==null&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][o])for(a in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][a]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),o=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const I in h)delete o[I]}return o}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const h={};for(const I in this.stateChanges[o])this.state[o][I]||(this.state[o][I]={}),c.e(this.state[o][I],this.stateChanges[o][I]),h[I]=this.state[o][I];a[o]=h}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const h={};if(this.deletedStates[o]===null)for(const I in this.state[o])h[I]={},this.state[o][I]={};else for(const I in this.deletedStates[o]){if(this.deletedStates[o][I]===null)this.state[o][I]={};else for(const v of Object.keys(this.deletedStates[o][I]))delete this.state[o][I][v];h[I]=this.state[o][I]}a[o]=a[o]||{},c.e(a[o],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const o in e)e[o].setFeatureState(a,n)}}class $t extends c.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",o=>this._dataHandler(o)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((o,h,I,v)=>{const C=new(ha(h.type))(o,h,I,v);if(C.id!==o)throw new Error(`Expected Source id to be ${o} instead of ${C.id}`);return C})(e,n,a,this),this._tiles={},this._cache=new dt(0,o=>this._unloadTile(o)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new li,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(o){e.state="errored",o.status!==404?this._source.fire(new c.j(o,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Wt).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,o)=>{const h=a.tileID,I=o.tileID,v=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),C=new c.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-I.overscaledZ||C.y-v.y||C.x-v.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Wt).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=fe.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let o=0;o<n.length;o++){const h=n[o];if(e.neighboringTiles&&e.neighboringTiles[h]){const I=this.getTileByID(h);a(e,I),a(I,e)}}function a(o,h){o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0;let I=h.tileID.canonical.x-o.tileID.canonical.x;const v=h.tileID.canonical.y-o.tileID.canonical.y,C=Math.pow(2,o.tileID.canonical.z),T=h.tileID.key;I===0&&v===0||Math.abs(v)>1||(Math.abs(I)>1&&(Math.abs(I+C)===1?I+=C:Math.abs(I-C)===1&&(I-=C)),h.dem&&o.dem&&(o.dem.backfillBorder(h.dem,I,v),o.neighboringTiles&&o.neighboringTiles[T]&&(o.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,o){for(const h in this._tiles){let I=this._tiles[h];if(o[h]||!I.hasData()||I.tileID.overscaledZ<=n||I.tileID.overscaledZ>a)continue;let v=I.tileID;for(;I&&I.tileID.overscaledZ>n+1;){const T=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[T.key],I&&I.hasData()&&(v=T)}let C=v;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]){o[v.key]=v;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const o=e.scaledTo(a),h=this._getLoadedTile(o);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,o=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const o in this._tiles){const h=this._tiles[o];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),a[h.tileID.key]=h}this._tiles=a;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}}_updateCoveredAndRetainedTiles(e,n,a,o,h,I){const v={},C={},T=Object.keys(e),F=fe.now();for(const z of T){const $=e[z],ie=this._tiles[z];if(!ie||ie.fadeEndTime!==0&&ie.fadeEndTime<=F)continue;const ce=this.findLoadedParent($,n),m=this.findLoadedSibling($),p=ce||m||null;p&&(this._addTile(p.tileID),v[p.tileID.key]=p.tileID),C[z]=$}this._retainLoadedChildren(C,o,a,e);for(const z in v)e[z]||(this._coveredTiles[z]=!0,e[z]=v[z]);if(I){const z={},$={};for(const ie of h)this._tiles[ie.key].hasData()?z[ie.key]=ie:$[ie.key]=ie;for(const ie in $){const ce=$[ie].children(this._source.maxzoom);this._tiles[ce[0].key]&&this._tiles[ce[1].key]&&this._tiles[ce[2].key]&&this._tiles[ce[3].key]&&(z[ce[0].key]=e[ce[0].key]=ce[0],z[ce[1].key]=e[ce[1].key]=ce[1],z[ce[2].key]=e[ce[2].key]=ce[2],z[ce[3].key]=e[ce[3].key]=ce[3],delete $[ie])}for(const ie in $){const ce=$[ie],m=this.findLoadedParent(ce,this._source.minzoom),p=this.findLoadedSibling(ce),A=m||p||null;if(A){z[A.tileID.key]=e[A.tileID.key]=A.tileID;for(const w in z)z[w].isChildOf(A.tileID)&&delete z[w]}}for(const ie in this._tiles)z[ie]||(this._coveredTiles[ie]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new c.S(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(F=>this._source.hasTile(F)))):a=[];const o=e.coveringZoomLevel(this._source),h=Math.max(o-$t.maxOverzooming,this._source.minzoom),I=Math.max(o+$t.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const z of a)if(z.canonical.z>this._source.minzoom){const $=z.scaledTo(z.canonical.z-1);F[$.key]=$;const ie=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));F[ie.key]=ie}a=a.concat(Object.values(F))}const v=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,v&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(a,o);un(this._source.type)&&this._updateCoveredAndRetainedTiles(C,h,I,o,a,n);for(const F in C)this._tiles[F].clearFadeHold();const T=c.ab(this._tiles,C);for(const F of T){const z=this._tiles[F];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const o={},h={},I=Math.max(n-$t.maxOverzooming,this._source.minzoom),v=Math.max(n+$t.maxUnderzooming,this._source.minzoom),C={};for(const T of e){const F=this._addTile(T);o[T.key]=T,F.hasData()||n<this._source.maxzoom&&(C[T.key]=T)}this._retainLoadedChildren(C,n,v,o);for(const T of e){let F=this._tiles[T.key];if(F.hasData())continue;if(n+1>this._source.maxzoom){const $=T.children(this._source.maxzoom)[0],ie=this.getTile($);if(ie&&ie.hasData()){o[$.key]=$;continue}}else{const $=T.children(this._source.maxzoom);if(o[$[0].key]&&o[$[1].key]&&o[$[2].key]&&o[$[3].key])continue}let z=F.wasRequested();for(let $=T.overscaledZ-1;$>=I;--$){const ie=T.scaledTo($);if(h[ie.key])break;if(h[ie.key]=!0,F=this.getTile(ie),!F&&z&&(F=this._addTile(ie)),F){const ce=F.hasData();if((ce||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(o[ie.key]=ie),z=F.wasRequested(),ce)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){a=this._loadedParentTiles[o.key];break}n.push(o.key);const h=o.scaledTo(o.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;o=h}for(const h of n)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new hn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const o=[],h=this.transform;if(!h)return o;const I=a?h.getCameraQueryGeometry(e):e,v=e.map(ce=>h.pointCoordinate(ce,this.terrain)),C=I.map(ce=>h.pointCoordinate(ce,this.terrain)),T=this.getIds();let F=1/0,z=1/0,$=-1/0,ie=-1/0;for(const ce of C)F=Math.min(F,ce.x),z=Math.min(z,ce.y),$=Math.max($,ce.x),ie=Math.max(ie,ce.y);for(let ce=0;ce<T.length;ce++){const m=this._tiles[T[ce]];if(m.holdingForFade())continue;const p=m.tileID,A=Math.pow(2,h.zoom-m.tileID.overscaledZ),w=n*m.queryPadding*c.X/m.tileSize/A,B=[p.getTilePoint(new c.Z(F,z)),p.getTilePoint(new c.Z($,ie))];if(B[0].x-w<c.X&&B[0].y-w<c.X&&B[1].x+w>=0&&B[1].y+w>=0){const k=v.map(S=>p.getTilePoint(S)),P=C.map(S=>p.getTilePoint(S));o.push({tile:m,tileID:p,queryGeometry:k,cameraQueryGeometry:P,scale:A})}}return o}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(un(this._source.type)){const e=fe.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const o=this._tiles[e];o&&o.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function Wt(u,e){const n=Math.abs(2*u.wrap)-+(u.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return u.overscaledZ-e.overscaledZ||a-n||e.canonical.y-u.canonical.y||e.canonical.x-u.canonical.x}function un(u){return u==="raster"||u==="image"||u==="video"}$t.maxOverzooming=10,$t.maxUnderzooming=3;class ni{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,a=this._distances[n];const o=e*this.paddedLength+this.padding;for(;a<o&&n<this._distances.length;)a=this._distances[++n];const h=n-1,I=this._distances[h],v=a-I,C=v>0?(o-I)/v:0;return this.points[h].mult(1-C).add(this.points[n].mult(C))}}function Fn(u,e){let n=!0;return u==="always"||u!=="never"&&e!=="never"||(n=!1),n}class zn{constructor(e,n,a){const o=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let I=0;I<this.xCellCount*this.yCellCount;I++)o.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,o,h){this._forEachCell(n,a,o,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(h)}insertCircle(e,n,a,o){this._forEachCell(n-o,a-o,n+o,a+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(o)}_insertBoxCell(e,n,a,o,h,I){this.boxCells[h].push(I)}_insertCircleCell(e,n,a,o,h,I){this.circleCells[h].push(I)}_query(e,n,a,o,h,I,v){if(a<0||e>this.width||o<0||n>this.height)return[];const C=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=o){if(h)return[{key:null,x1:e,y1:n,x2:a,y2:o}];for(let T=0;T<this.boxKeys.length;T++)C.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const F=this.circles[3*T],z=this.circles[3*T+1],$=this.circles[3*T+2];C.push({key:this.circleKeys[T],x1:F-$,y1:z-$,x2:F+$,y2:z+$})}}else this._forEachCell(e,n,a,o,this._queryCell,C,{hitTest:h,overlapMode:I,seenUids:{box:{},circle:{}}},v);return C}query(e,n,a,o){return this._query(e,n,a,o,!1,null)}hitTest(e,n,a,o,h,I){return this._query(e,n,a,o,!0,h,I).length>0}hitTestCircle(e,n,a,o,h){const I=e-a,v=e+a,C=n-a,T=n+a;if(v<0||I>this.width||T<0||C>this.height)return!1;const F=[];return this._forEachCell(I,C,v,T,this._queryCellCircle,F,{hitTest:!0,overlapMode:o,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},h),F.length>0}_queryCell(e,n,a,o,h,I,v,C){const{seenUids:T,hitTest:F,overlapMode:z}=v,$=this.boxCells[h];if($!==null){const ce=this.bboxes;for(const m of $)if(!T.box[m]){T.box[m]=!0;const p=4*m,A=this.boxKeys[m];if(e<=ce[p+2]&&n<=ce[p+3]&&a>=ce[p+0]&&o>=ce[p+1]&&(!C||C(A))&&(!F||!Fn(z,A.overlapMode))&&(I.push({key:A,x1:ce[p],y1:ce[p+1],x2:ce[p+2],y2:ce[p+3]}),F))return!0}}const ie=this.circleCells[h];if(ie!==null){const ce=this.circles;for(const m of ie)if(!T.circle[m]){T.circle[m]=!0;const p=3*m,A=this.circleKeys[m];if(this._circleAndRectCollide(ce[p],ce[p+1],ce[p+2],e,n,a,o)&&(!C||C(A))&&(!F||!Fn(z,A.overlapMode))){const w=ce[p],B=ce[p+1],k=ce[p+2];if(I.push({key:A,x1:w-k,y1:B-k,x2:w+k,y2:B+k}),F)return!0}}}return!1}_queryCellCircle(e,n,a,o,h,I,v,C){const{circle:T,seenUids:F,overlapMode:z}=v,$=this.boxCells[h];if($!==null){const ce=this.bboxes;for(const m of $)if(!F.box[m]){F.box[m]=!0;const p=4*m,A=this.boxKeys[m];if(this._circleAndRectCollide(T.x,T.y,T.radius,ce[p+0],ce[p+1],ce[p+2],ce[p+3])&&(!C||C(A))&&!Fn(z,A.overlapMode))return I.push(!0),!0}}const ie=this.circleCells[h];if(ie!==null){const ce=this.circles;for(const m of ie)if(!F.circle[m]){F.circle[m]=!0;const p=3*m,A=this.circleKeys[m];if(this._circlesCollide(ce[p],ce[p+1],ce[p+2],T.x,T.y,T.radius)&&(!C||C(A))&&!Fn(z,A.overlapMode))return I.push(!0),!0}}}_forEachCell(e,n,a,o,h,I,v,C){const T=this._convertToXCellCoord(e),F=this._convertToYCellCoord(n),z=this._convertToXCellCoord(a),$=this._convertToYCellCoord(o);for(let ie=T;ie<=z;ie++)for(let ce=F;ce<=$;ce++)if(h.call(this,e,n,a,o,this.xCellCount*ce+ie,I,v,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,o,h,I){const v=o-e,C=h-n,T=a+I;return T*T>v*v+C*C}_circleAndRectCollide(e,n,a,o,h,I,v){const C=(I-o)/2,T=Math.abs(e-(o+C));if(T>C+a)return!1;const F=(v-h)/2,z=Math.abs(n-(h+F));if(z>F+a)return!1;if(T<=C||z<=F)return!0;const $=T-C,ie=z-F;return $*$+ie*ie<=a*a}}function es(u,e,n,a,o){const h=c.H();return e?(c.K(h,h,[1/o,1/o,1]),n||c.ad(h,h,a.angle)):c.L(h,a.labelPlaneMatrix,u),h}function _n(u,e,n,a,o){if(e){const h=c.ae(u);return c.K(h,h,[o,o,1]),n||c.ad(h,h,-a.angle),h}return a.glCoordMatrix}function _e(u,e,n,a){let o;a?(o=[u,e,a(u,e),1],c.af(o,o,n)):(o=[u,e,0,1],Ii(o,o,n));const h=o[3];return{point:new c.P(o[0]/h,o[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function J(u,e){return .5+u/e*.5}function j(u,e){return u.x>=-e[0]&&u.x<=e[0]&&u.y>=-e[1]&&u.y<=e[1]}function te(u,e,n,a,o,h,I,v,C,T,F,z,$,ie,ce){const m=a?u.textSizeData:u.iconSizeData,p=c.ag(m,n.transform.zoom),A=[256/n.width*2+1,256/n.height*2+1],w=a?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;w.clear();const B=u.lineVertexArray,k=a?u.text.placedSymbolArray:u.icon.placedSymbolArray,P=n.transform.width/n.transform.height;let S=!1;for(let V=0;V<k.length;V++){const U=k.get(V);if(U.hidden||U.writingMode===c.ah.vertical&&!S){jt(U.numGlyphs,w);continue}S=!1;const q=_e(U.anchorX,U.anchorY,e,ce);if(!j(q.point,A)){jt(U.numGlyphs,w);continue}const ne=J(n.transform.cameraToCenterDistance,q.signedDistanceFromCamera),Z=c.ai(m,p,U),N=I?Z/ne:Z*ne,se={getElevation:ce,labelPlaneMatrix:o,lineVertexArray:B,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:T,tileAnchorPoint:new c.P(U.anchorX,U.anchorY),unwrappedTileID:F,width:z,height:$,translation:ie},ue=Te(se,U,N,!1,v,e,h,u.glyphOffsetArray,w,P,C);S=ue.useVertical,(ue.notEnoughRoom||S||ue.needsFlipping&&Te(se,U,N,!0,v,e,h,u.glyphOffsetArray,w,P,C).notEnoughRoom)&&jt(U.numGlyphs,w)}a?u.text.dynamicLayoutVertexBuffer.updateData(w):u.icon.dynamicLayoutVertexBuffer.updateData(w)}function pe(u,e,n,a,o,h,I,v){const C=h.glyphStartIndex+h.numGlyphs,T=h.lineStartIndex,F=h.lineStartIndex+h.lineLength,z=e.getoffsetX(h.glyphStartIndex),$=e.getoffsetX(C-1),ie=It(u*z,n,a,o,h.segment,T,F,v,I);if(!ie)return null;const ce=It(u*$,n,a,o,h.segment,T,F,v,I);return ce?v.projectionCache.anyProjectionOccluded?null:{first:ie,last:ce}:null}function Ce(u,e,n,a){return u===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(u===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Te(u,e,n,a,o,h,I,v,C,T,F){const z=n/24,$=e.lineOffsetX*z,ie=e.lineOffsetY*z;let ce;if(e.numGlyphs>1){const m=e.glyphStartIndex+e.numGlyphs,p=e.lineStartIndex,A=e.lineStartIndex+e.lineLength,w=pe(z,v,$,ie,a,e,F,u);if(!w)return{notEnoughRoom:!0};const B=_e(w.first.point.x,w.first.point.y,I,u.getElevation).point,k=_e(w.last.point.x,w.last.point.y,I,u.getElevation).point;if(o&&!a){const P=Ce(e.writingMode,B,k,T);if(P)return P}ce=[w.first];for(let P=e.glyphStartIndex+1;P<m-1;P++)ce.push(It(z*v.getoffsetX(P),$,ie,a,e.segment,p,A,u,F));ce.push(w.last)}else{if(o&&!a){const p=_e(u.tileAnchorPoint.x,u.tileAnchorPoint.y,h,u.getElevation).point,A=e.lineStartIndex+e.segment+1,w=new c.P(u.lineVertexArray.getx(A),u.lineVertexArray.gety(A)),B=_e(w.x,w.y,h,u.getElevation),k=B.signedDistanceFromCamera>0?B.point:function(S,V,U,q,ne,Z){return Le(S,V,U,1,ne,Z)}(u.tileAnchorPoint,w,p,0,h,u),P=Ce(e.writingMode,p,k,T);if(P)return P}const m=It(z*v.getoffsetX(e.glyphStartIndex),$,ie,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,F);if(!m||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ce=[m]}for(const m of ce)c.aj(C,m.point,m.angle);return{}}function Le(u,e,n,a,o,h){const I=u.add(u.sub(e)._unit()),v=o!==void 0?_e(I.x,I.y,o,h.getElevation).point:Ye(I.x,I.y,h).point,C=n.sub(v);return n.add(C._mult(a/C.mag()))}function we(u,e,n){const a=e.projectionCache;if(a.projections[u])return a.projections[u];const o=new c.P(e.lineVertexArray.getx(u),e.lineVertexArray.gety(u)),h=Ye(o.x,o.y,e);if(h.signedDistanceFromCamera>0)return a.projections[u]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const I=u-n.direction;return function(v,C,T,F,z){return Le(v,C,T,F,void 0,z)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(I),e.lineVertexArray.gety(I)),o,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function Ye(u,e,n){const a=u+n.translation[0],o=e+n.translation[1];let h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(a,o,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=_e(a,o,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function nt(u,e,n){return u._unit()._perp()._mult(e*n)}function Ge(u,e,n,a,o,h,I,v,C){if(v.projectionCache.offsets[u])return v.projectionCache.offsets[u];const T=n.add(e);if(u+C.direction<a||u+C.direction>=o)return v.projectionCache.offsets[u]=T,T;const F=we(u+C.direction,v,C),z=nt(F.sub(n),I,C.direction),$=n.add(z),ie=F.add(z);return v.projectionCache.offsets[u]=c.ak(h,T,$,ie)||T,v.projectionCache.offsets[u]}function It(u,e,n,a,o,h,I,v,C){const T=a?u-e:u+e;let F=T>0?1:-1,z=0;a&&(F*=-1,z=Math.PI),F<0&&(z+=Math.PI);let $,ie=F>0?h+o:h+o+1;v.projectionCache.cachedAnchorPoint?$=v.projectionCache.cachedAnchorPoint:($=Ye(v.tileAnchorPoint.x,v.tileAnchorPoint.y,v).point,v.projectionCache.cachedAnchorPoint=$);let ce,m,p=$,A=$,w=0,B=0;const k=Math.abs(T),P=[];let S;for(;w+B<=k;){if(ie+=F,ie<h||ie>=I)return null;w+=B,A=p,m=ce;const q={absOffsetX:k,direction:F,distanceFromAnchor:w,previousVertex:A};if(p=we(ie,v,q),n===0)P.push(A),S=p.sub(A);else{let ne;const Z=p.sub(A);ne=Z.mag()===0?nt(we(ie+F,v,q).sub(p),n,F):nt(Z,n,F),m||(m=A.add(ne)),ce=Ge(ie,ne,p,h,I,m,n,v,q),P.push(m),S=ce.sub(m)}B=S.mag()}const V=S._mult((k-w)/B)._add(m||A),U=z+Math.atan2(p.y-A.y,p.x-A.x);return P.push(V),{point:V,angle:C?U:0,path:P}}const Ot=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function jt(u,e){for(let n=0;n<u;n++){const a=e.length;e.resize(a+4),e.float32.set(Ot,3*a)}}function Ii(u,e,n){const a=e[0],o=e[1];return u[0]=n[0]*a+n[4]*o+n[12],u[1]=n[1]*a+n[5]*o+n[13],u[3]=n[3]*a+n[7]*o+n[15],u}const si=100;class xi{constructor(e,n,a=new zn(e.width+200,e.height+200,25),o=new zn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=o,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+si,this.screenBottomBoundary=e.height+si,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,o,h,I,v,C,T,F,z){const $=e.anchorPointX+C[0],ie=e.anchorPointY+C[1],ce=this.projectAndGetPerspectiveRatio(o,$,ie,h,F),m=a*ce.perspectiveRatio;let p;if(I||v)p=this._projectCollisionBox(e,m,o,h,I,v,C,ce,F,z);else{const P=ce.point.x+(z?z.x*m:0),S=ce.point.y+(z?z.y*m:0);p={allPointsOccluded:!1,box:[P+e.x1*m,S+e.y1*m,P+e.x2*m,S+e.y2*m]}}const[A,w,B,k]=p.box;return this.mapProjection.useSpecialProjectionForSymbols&&(I?p.allPointsOccluded:this.mapProjection.isOccluded($,ie,h))||ce.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(A,w,B,k)||n!=="always"&&this.grid.hitTest(A,w,B,k,n,T)?{box:[A,w,B,k],placeable:!1,offscreen:!1}:{box:[A,w,B,k],placeable:!0,offscreen:this.isOffscreen(A,w,B,k)}}placeCollisionCircles(e,n,a,o,h,I,v,C,T,F,z,$,ie,ce,m,p){const A=[],w=new c.P(n.anchorX,n.anchorY),B=this.getPerspectiveRatio(I,w.x,w.y,v,p),k=(z?h/B:h*B)/c.ap,P={getElevation:p,labelPlaneMatrix:C,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:w,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:m},S=pe(k,o,n.lineOffsetX*k,n.lineOffsetY*k,!1,n,!1,P);let V=!1,U=!1,q=!0;if(S){const ne=.5*ie*B+ce,Z=new c.P(-100,-100),N=new c.P(this.screenRightBoundary,this.screenBottomBoundary),se=new ni,ue=S.first,ae=S.last;let de=[];for(let Se=ue.path.length-1;Se>=1;Se--)de.push(ue.path[Se]);for(let Se=1;Se<ae.path.length;Se++)de.push(ae.path[Se]);const xe=2.5*ne;if(T){const Se=this.projectPathToScreenSpace(de,P,T);de=Se.some(K=>K.signedDistanceFromCamera<=0)?[]:Se.map(K=>K.point)}let be=[];if(de.length>0){const Se=de[0].clone(),K=de[0].clone();for(let G=1;G<de.length;G++)Se.x=Math.min(Se.x,de[G].x),Se.y=Math.min(Se.y,de[G].y),K.x=Math.max(K.x,de[G].x),K.y=Math.max(K.y,de[G].y);be=Se.x>=Z.x&&K.x<=N.x&&Se.y>=Z.y&&K.y<=N.y?[de]:K.x<Z.x||Se.x>N.x||K.y<Z.y||Se.y>N.y?[]:c.al([de],Z.x,Z.y,N.x,N.y)}for(const Se of be){se.reset(Se,.25*ne);let K=0;K=se.length<=.5*ne?1:Math.ceil(se.paddedLength/xe)+1;for(let G=0;G<K;G++){const Ae=G/Math.max(K-1,1),re=se.lerp(Ae),le=re.x+si,ge=re.y+si;A.push(le,ge,ne,0);const De=le-ne,Be=ge-ne,ke=le+ne,Oe=ge+ne;if(q=q&&this.isOffscreen(De,Be,ke,Oe),U=U||this.isInsideGrid(De,Be,ke,Oe),e!=="always"&&this.grid.hitTestCircle(le,ge,ne,e,$)&&(V=!0,!F))return{circles:[],offscreen:!1,collisionDetected:V}}}}return{circles:!F&&V||!U||B<this.perspectiveRatioCutoff?[]:A,offscreen:q,collisionDetected:V}}projectPathToScreenSpace(e,n,a){return e.map(o=>_e(o.x,o.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,o=1/0,h=-1/0,I=-1/0;for(const F of e){const z=new c.P(F.x+si,F.y+si);a=Math.min(a,z.x),o=Math.min(o,z.y),h=Math.max(h,z.x),I=Math.max(I,z.y),n.push(z)}const v=this.grid.query(a,o,h,I).concat(this.ignoredGrid.query(a,o,h,I)),C={},T={};for(const F of v){const z=F.key;if(C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]={}),C[z.bucketInstanceId][z.featureIndex])continue;const $=[new c.P(F.x1,F.y1),new c.P(F.x2,F.y1),new c.P(F.x2,F.y2),new c.P(F.x1,F.y2)];c.am(n,$)&&(C[z.bucketInstanceId][z.featureIndex]=!0,T[z.bucketInstanceId]===void 0&&(T[z.bucketInstanceId]=[]),T[z.bucketInstanceId].push(z.featureIndex))}return T}insertCollisionBox(e,n,a,o,h,I){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:I,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,o,h,I){const v=a?this.ignoredGrid:this.grid,C={bucketInstanceId:o,featureIndex:h,collisionGroupID:I,overlapMode:n};for(let T=0;T<e.length;T+=4)v.insertCircle(C,e[T],e[T+1],e[T+2])}projectAndGetPerspectiveRatio(e,n,a,o,h){let I;h?(I=[n,a,h(n,a),1],c.af(I,I,e)):(I=[n,a,0,1],Ii(I,I,e));const v=I[3];return{point:new c.P((I[0]/v+1)/2*this.transform.width+si,(-I[1]/v+1)/2*this.transform.height+si),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v*.5,isOccluded:!1,signedDistanceFromCamera:v}}getPerspectiveRatio(e,n,a,o,h){const I=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,o,h):_e(n,a,e,h);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(e,n,a,o){return a<si||e>=this.screenRightBoundary||o<si||n>this.screenBottomBoundary}isInsideGrid(e,n,a,o){return a>=0&&e<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,o,h,I,v,C,T,F){let z=new c.P(1,0),$=new c.P(0,1);const ie=new c.P(e.anchorPointX+v[0],e.anchorPointY+v[1]);if(I&&!h){const q=this.projectAndGetPerspectiveRatio(a,ie.x+1,ie.y,o,T).point.sub(C.point).unit(),ne=Math.atan(q.y/q.x)+(q.x<0?Math.PI:0),Z=Math.sin(ne),N=Math.cos(ne);z=new c.P(N,Z),$=new c.P(-Z,N)}else if(!I&&h){const q=-this.transform.angle,ne=Math.sin(q),Z=Math.cos(q);z=new c.P(Z,ne),$=new c.P(-ne,Z)}let ce=C.point,m=n;if(h){ce=ie;const q=this.transform.zoom-Math.floor(this.transform.zoom);m=Math.pow(2,-q),m*=this.mapProjection.getPitchedTextCorrection(this.transform,ie,o),F||(m*=c.ac(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}F&&(ce=ce.add(z.mult(F.x*m)).add($.mult(F.y*m)));const p=e.x1*m,A=e.x2*m,w=(p+A)/2,B=e.y1*m,k=e.y2*m,P=(B+k)/2,S=[{offsetX:p,offsetY:B},{offsetX:w,offsetY:B},{offsetX:A,offsetY:B},{offsetX:A,offsetY:P},{offsetX:A,offsetY:k},{offsetX:w,offsetY:k},{offsetX:p,offsetY:k},{offsetX:p,offsetY:P}];let V=[];for(const{offsetX:q,offsetY:ne}of S)V.push(new c.P(ce.x+z.x*q+$.x*ne,ce.y+z.y*q+$.y*ne));let U=!1;if(h){const q=V.map(ne=>this.projectAndGetPerspectiveRatio(a,ne.x,ne.y,o,T));U=q.some(ne=>!ne.isOccluded),V=q.map(ne=>ne.point)}else U=!0;return{box:c.ao(V),allPointsOccluded:!U}}}function fi(u,e,n){return e*(c.X/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class sr{constructor(e,n,a,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):o&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ki{constructor(e,n,a,o,h){this.text=new sr(e?e.text:null,n,a,h),this.icon=new sr(e?e.icon:null,n,o,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hi{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class Li{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class ji{constructor(e,n,a,o,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=o,this.tileID=h}}class ar{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function Ar(u,e,n,a,o){const{horizontalAlign:h,verticalAlign:I}=c.au(u);return new c.P(-(h-.5)*e+a[0]*o,-(I-.5)*n+a[1]*o)}class dr{constructor(e,n,a,o,h,I){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new xi(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new ar(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,o)=>n.getElevation(e,a,o):null}getBucketParts(e,n,a,o){const h=a.getBucket(n),I=a.latestFeatureIndex;if(!h||!I||n.id!==h.layerIds[0])return;const v=a.collisionBoxArray,C=h.layers[0].layout,T=h.layers[0].paint,F=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.X,$=a.tileID.toUnwrapped(),ie=this.transform.calculatePosMatrix($),ce=C.get("text-pitch-alignment")==="map",m=C.get("text-rotation-alignment")==="map",p=fi(a,1,this.transform.zoom),A=this.collisionIndex.mapProjection.translatePosition(this.transform,a,T.get("text-translate"),T.get("text-translate-anchor")),w=this.collisionIndex.mapProjection.translatePosition(this.transform,a,T.get("icon-translate"),T.get("icon-translate-anchor")),B=es(ie,ce,m,this.transform,p);let k=null;if(ce){const S=_n(ie,ce,m,this.transform,p);k=c.L([],this.transform.labelPlaneMatrix,S)}this.retainedQueryData[h.bucketInstanceId]=new ji(h.bucketInstanceId,I,h.sourceLayerIndex,h.index,a.tileID);const P={bucket:h,layout:C,translationText:A,translationIcon:w,posMatrix:ie,unwrappedTileID:$,textLabelPlaneMatrix:B,labelToScreenMatrix:k,scale:F,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:v,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(o)for(const S of h.sortKeyRanges){const{sortKey:V,symbolInstanceStart:U,symbolInstanceEnd:q}=S;e.push({sortKey:V,symbolInstanceStart:U,symbolInstanceEnd:q,parameters:P})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:P})}attemptAnchorPlacement(e,n,a,o,h,I,v,C,T,F,z,$,ie,ce,m,p,A,w,B){const k=c.aq[e.textAnchor],P=[e.textOffset0,e.textOffset1],S=Ar(k,a,o,P,h),V=this.collisionIndex.placeCollisionBox(n,$,C,T,F,v,I,p,z.predicate,B,S);if((!w||this.collisionIndex.placeCollisionBox(w,$,C,T,F,v,I,A,z.predicate,B,S).placeable)&&V.placeable){let U;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ie.crossTileID]&&this.prevPlacement.placements[ie.crossTileID]&&this.prevPlacement.placements[ie.crossTileID].text&&(U=this.prevPlacement.variableOffsets[ie.crossTileID].anchor),ie.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ie.crossTileID]={textOffset:P,width:a,height:o,anchor:k,textBoxScale:h,prevAnchor:U},this.markUsedJustification(ce,k,ie,m),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,m,ie),this.placedOrientations[ie.crossTileID]=m),{shift:S,placedGlyphBoxes:V}}}placeLayerBucketPart(e,n,a){const{bucket:o,layout:h,translationText:I,translationIcon:v,posMatrix:C,unwrappedTileID:T,textLabelPlaneMatrix:F,labelToScreenMatrix:z,textPixelRatio:$,holdingForFade:ie,collisionBoxArray:ce,partiallyEvaluatedTextSize:m,collisionGroup:p}=e.parameters,A=h.get("text-optional"),w=h.get("icon-optional"),B=c.ar(h,"text-overlap","text-allow-overlap"),k=B==="always",P=c.ar(h,"icon-overlap","icon-allow-overlap"),S=P==="always",V=h.get("text-rotation-alignment")==="map",U=h.get("text-pitch-alignment")==="map",q=h.get("icon-text-fit")!=="none",ne=h.get("symbol-z-order")==="viewport-y",Z=k&&(S||!o.hasIconData()||w),N=S&&(k||!o.hasTextData()||A);!o.collisionArrays&&ce&&o.deserializeCollisionBoxes(ce);const se=this._getTerrainElevationFunc(this.retainedQueryData[o.bucketInstanceId].tileID),ue=(ae,de,xe)=>{var be,Se;if(n[ae.crossTileID])return;if(ie)return void(this.placements[ae.crossTileID]=new hi(!1,!1,!1));let K=!1,G=!1,Ae=!0,re=null,le={box:null,placeable:!1,offscreen:null},ge={placeable:!1},De=null,Be=null,ke=null,Oe=0,Ze=0,We=0;de.textFeatureIndex?Oe=de.textFeatureIndex:ae.useRuntimeCollisionCircles&&(Oe=ae.featureIndex),de.verticalTextFeatureIndex&&(Ze=de.verticalTextFeatureIndex);const rt=de.textBox;if(rt){const it=At=>{let Ct=c.ah.horizontal;if(o.allowVerticalPlacement&&!At&&this.prevPlacement){const wt=this.prevPlacement.placedOrientations[ae.crossTileID];wt&&(this.placedOrientations[ae.crossTileID]=wt,Ct=wt,this.markUsedOrientation(o,Ct,ae))}return Ct},Dt=(At,Ct)=>{if(o.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&de.verticalTextBox){for(const wt of o.writingModes)if(wt===c.ah.vertical?(le=Ct(),ge=le):le=At(),le&&le.placeable)break}else le=At()},ft=ae.textAnchorOffsetStartIndex,Rt=ae.textAnchorOffsetEndIndex;if(Rt===ft){const At=(Ct,wt)=>{const ut=this.collisionIndex.placeCollisionBox(Ct,B,$,C,T,U,V,I,p.predicate,se);return ut&&ut.placeable&&(this.markUsedOrientation(o,wt,ae),this.placedOrientations[ae.crossTileID]=wt),ut};Dt(()=>At(rt,c.ah.horizontal),()=>{const Ct=de.verticalTextBox;return o.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&Ct?At(Ct,c.ah.vertical):{box:null,offscreen:null}}),it(le&&le.placeable)}else{let At=c.aq[(Se=(be=this.prevPlacement)===null||be===void 0?void 0:be.variableOffsets[ae.crossTileID])===null||Se===void 0?void 0:Se.anchor];const Ct=(ut,Et,mi)=>{const ai=ut.x2-ut.x1,bi=ut.y2-ut.y1,vi=ae.textBoxScale,nn=q&&P==="never"?Et:null;let Br=null,Ss=B==="never"?1:2,ti="never";At&&Ss++;for(let sn=0;sn<Ss;sn++){for(let Qn=ft;Qn<Rt;Qn++){const no=o.textAnchorOffsets.get(Qn);if(At&&no.textAnchor!==At)continue;const As=this.attemptAnchorPlacement(no,ut,ai,bi,vi,V,U,$,C,T,p,ti,ae,o,mi,I,v,nn,se);if(As&&(Br=As.placedGlyphBoxes,Br&&Br.placeable))return K=!0,re=As.shift,Br}At?At=null:ti=B}return a&&!Br&&(Br={box:this.collisionIndex.placeCollisionBox(rt,"always",$,C,T,U,V,I,p.predicate,se,new c.P(0,0)).box,offscreen:!1,placeable:!1}),Br};Dt(()=>Ct(rt,de.iconBox,c.ah.horizontal),()=>{const ut=de.verticalTextBox;return o.allowVerticalPlacement&&(!le||!le.placeable)&&ae.numVerticalGlyphVertices>0&&ut?Ct(ut,de.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),le&&(K=le.placeable,Ae=le.offscreen);const wt=it(le&&le.placeable);if(!K&&this.prevPlacement){const ut=this.prevPlacement.variableOffsets[ae.crossTileID];ut&&(this.variableOffsets[ae.crossTileID]=ut,this.markUsedJustification(o,ut.anchor,ae,wt))}}}if(De=le,K=De&&De.placeable,Ae=De&&De.offscreen,ae.useRuntimeCollisionCircles){const it=o.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex),Dt=c.ai(o.textSizeData,m,it),ft=h.get("text-padding");Be=this.collisionIndex.placeCollisionCircles(B,it,o.lineVertexArray,o.glyphOffsetArray,Dt,C,T,F,z,a,U,p.predicate,ae.collisionCircleDiameter,ft,I,se),Be.circles.length&&Be.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),K=k||Be.circles.length>0&&!Be.collisionDetected,Ae=Ae&&Be.offscreen}if(de.iconFeatureIndex&&(We=de.iconFeatureIndex),de.iconBox){const it=Dt=>this.collisionIndex.placeCollisionBox(Dt,P,$,C,T,U,V,v,p.predicate,se,q&&re?re:void 0);ge&&ge.placeable&&de.verticalIconBox?(ke=it(de.verticalIconBox),G=ke.placeable):(ke=it(de.iconBox),G=ke.placeable),Ae=Ae&&ke.offscreen}const pt=A||ae.numHorizontalGlyphVertices===0&&ae.numVerticalGlyphVertices===0,Ve=w||ae.numIconVertices===0;pt||Ve?Ve?pt||(G=G&&K):K=G&&K:G=K=G&&K;const ze=G&&ke.placeable;if(K&&De.placeable&&this.collisionIndex.insertCollisionBox(De.box,B,h.get("text-ignore-placement"),o.bucketInstanceId,ge&&ge.placeable&&Ze?Ze:Oe,p.ID),ze&&this.collisionIndex.insertCollisionBox(ke.box,P,h.get("icon-ignore-placement"),o.bucketInstanceId,We,p.ID),Be&&K&&this.collisionIndex.insertCollisionCircles(Be.circles,B,h.get("text-ignore-placement"),o.bucketInstanceId,Oe,p.ID),a&&this.storeCollisionData(o.bucketInstanceId,xe,de,De,ke,Be),ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(o.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ae.crossTileID]=new hi(K||Z,G||N,Ae||o.justReloaded),n[ae.crossTileID]=!0};if(ne){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ae=o.getSortedSymbolIndexes(this.transform.angle);for(let de=ae.length-1;de>=0;--de){const xe=ae[de];ue(o.symbolInstances.get(xe),o.collisionArrays[xe],xe)}}else for(let ae=e.symbolInstanceStart;ae<e.symbolInstanceEnd;ae++)ue(o.symbolInstances.get(ae),o.collisionArrays[ae],ae);if(a&&o.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[o.bucketInstanceId];c.as(ae.invProjMatrix,C),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}storeCollisionData(e,n,a,o,h,I){if(a.textBox||a.iconBox){let v,C;this.collisionBoxArrays.has(e)?v=this.collisionBoxArrays.get(e):(v=new Map,this.collisionBoxArrays.set(e,v)),v.has(n)?C=v.get(n):(C={text:null,icon:null},v.set(n,C)),a.textBox&&(C.text=o.box),a.iconBox&&(C.icon=h.box)}if(I){let v=this.collisionCircleArrays[e];v===void 0&&(v=this.collisionCircleArrays[e]=new Li);for(let C=0;C<I.circles.length;C+=4)v.circles.push(I.circles[C+0]),v.circles.push(I.circles[C+1]),v.circles.push(I.circles[C+2]),v.circles.push(I.collisionDetected?1:0)}}markUsedJustification(e,n,a,o){let h;h=o===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const I=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const v of I)v>=0&&(e.text.placedSymbolArray.get(v).crossTileID=h>=0&&v!==h?0:a.crossTileID)}markUsedOrientation(e,n,a){const o=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,I=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const v of I)e.text.placedSymbolArray.get(v).placedOrientation=o;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const o=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},I=n?n.variableOffsets:{},v=n?n.placedOrientations:{};for(const C in this.placements){const T=this.placements[C],F=h[C];F?(this.opacities[C]=new Ki(F,o,T.text,T.icon),a=a||T.text!==F.text.placed||T.icon!==F.icon.placed):(this.opacities[C]=new Ki(null,o,T.text,T.icon,T.skipFade),a=a||T.text||T.icon)}for(const C in h){const T=h[C];if(!this.opacities[C]){const F=new Ki(T,o,!1,!1);F.isHidden()||(this.opacities[C]=F,a=a||T.text.placed||T.icon.placed)}}for(const C in I)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=I[C]);for(const C in v)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=v[C]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const o of n){const h=o.getBucket(e);h&&o.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,o.tileID,a,o.collisionBoxArray)}}updateBucketOpacities(e,n,a,o){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],I=h.layout,v=new Ki(null,0,!1,!1,!0),C=I.get("text-allow-overlap"),T=I.get("icon-allow-overlap"),F=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=I.get("text-rotation-alignment")==="map",$=I.get("text-pitch-alignment")==="map",ie=I.get("icon-text-fit")!=="none",ce=new Ki(null,0,C&&(T||!e.hasIconData()||I.get("icon-optional")),T&&(C||!e.hasTextData()||I.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);const m=(A,w,B)=>{for(let k=0;k<w/4;k++)A.opacityVertexArray.emplaceBack(B);A.hasVisibleVertices=A.hasVisibleVertices||B!==ua},p=this.collisionBoxArrays.get(e.bucketInstanceId);for(let A=0;A<e.symbolInstances.length;A++){const w=e.symbolInstances.get(A),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:k,crossTileID:P}=w;let S=this.opacities[P];a[P]?S=v:S||(S=ce,this.opacities[P]=S),a[P]=!0;const V=w.numIconVertices>0,U=this.placedOrientations[w.crossTileID],q=U===c.ah.vertical,ne=U===c.ah.horizontal||U===c.ah.horizontalOnly;if(B>0||k>0){const N=$r(S.text);m(e.text,B,q?ua:N),m(e.text,k,ne?ua:N);const se=S.text.isHidden();[w.rightJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.leftJustifiedTextSymbolIndex].forEach(de=>{de>=0&&(e.text.placedSymbolArray.get(de).hidden=se||q?1:0)}),w.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(w.verticalPlacedTextSymbolIndex).hidden=se||ne?1:0);const ue=this.variableOffsets[w.crossTileID];ue&&this.markUsedJustification(e,ue.anchor,w,U);const ae=this.placedOrientations[w.crossTileID];ae&&(this.markUsedJustification(e,"left",w,ae),this.markUsedOrientation(e,ae,w))}if(V){const N=$r(S.icon),se=!(ie&&w.verticalPlacedIconSymbolIndex&&q);w.placedIconSymbolIndex>=0&&(m(e.icon,w.numIconVertices,se?N:ua),e.icon.placedSymbolArray.get(w.placedIconSymbolIndex).hidden=S.icon.isHidden()),w.verticalPlacedIconSymbolIndex>=0&&(m(e.icon,w.numVerticalIconVertices,se?ua:N),e.icon.placedSymbolArray.get(w.verticalPlacedIconSymbolIndex).hidden=S.icon.isHidden())}const Z=p&&p.has(A)?p.get(A):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const N=e.collisionArrays[A];if(N){let se=new c.P(0,0);if(N.textBox||N.verticalTextBox){let ue=!0;if(F){const ae=this.variableOffsets[P];ae?(se=Ar(ae.anchor,ae.width,ae.height,ae.textOffset,ae.textBoxScale),z&&se._rotate($?this.transform.angle:-this.transform.angle)):ue=!1}if(N.textBox||N.verticalTextBox){let ae;N.textBox&&(ae=q),N.verticalTextBox&&(ae=ne),In(e.textCollisionBox.collisionVertexArray,S.text.placed,!ue||ae,Z.text,se.x,se.y)}}if(N.iconBox||N.verticalIconBox){const ue=!!(!ne&&N.verticalIconBox);let ae;N.iconBox&&(ae=ue),N.verticalIconBox&&(ae=!ue),In(e.iconCollisionBox.collisionVertexArray,S.icon.placed,ae,Z.icon,ie?se.x:0,ie?se.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const A=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=A.invProjMatrix,e.placementViewportMatrix=A.viewportMatrix,e.collisionCircleArray=A.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function In(u,e,n,a,o,h){a&&a.length!==0||(a=[0,0,0,0]);const I=a[0]-si,v=a[1]-si,C=a[2]-si,T=a[3]-si;u.emplaceBack(e?1:0,n?1:0,o||0,h||0,I,v),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,C,v),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,C,T),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,I,T)}const Ri=Math.pow(2,25),Xo=Math.pow(2,24),el=Math.pow(2,17),Rr=Math.pow(2,16),Zr=Math.pow(2,9),tl=Math.pow(2,8),Fr=Math.pow(2,1);function $r(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const e=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Ri+e*Xo+n*el+e*Rr+n*Zr+e*tl+n*Fr+e}const ua=0;function Ps(){return{isOccluded:(u,e,n)=>!1,getPitchedTextCorrection:(u,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(u,e,n,a){throw new Error("Not implemented.")},translatePosition:(u,e,n,a)=>function(o,h,I,v,C=!1){if(!I[0]&&!I[1])return[0,0];const T=C?v==="map"?o.angle:0:v==="viewport"?-o.angle:0;if(T){const F=Math.sin(T),z=Math.cos(T);I=[I[0]*z-I[1]*F,I[0]*F+I[1]*z]}return[C?I[0]:fi(h,I[0],o.zoom),C?I[1]:fi(h,I[1],o.zoom)]}(u,e,n,a),getCircleRadiusCorrection:u=>1}}class or{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,o,h){const I=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(I,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((v,C)=>v.sortKey-C.sortKey));this._currentPartIndex<I.length;)if(n.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class Aa{constructor(e,n,a,o,h,I,v,C){this.placement=new dr(e,Ps(),n,I,v,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const o=fe.now(),h=()=>!this._forceFullPlacement&&fe.now()-o>2;for(;this._currentPlacementIndex>=0;){const I=n[e[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=v)&&(!I.maxzoom||I.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new or(I)),this._inProgressLayer.continuePlacement(a[I.source],this.placement,this._showCollisionBoxes,I,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const bn=512/c.X/2;class tr{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const o=new Map;for(let h=0;h<n.length;h++){const I=n.get(h),v=I.key,C=o.get(v);C?C.push(I):o.set(v,[I])}for(const[h,I]of o){const v={positions:I.map(C=>({x:Math.floor(C.anchorX*bn),y:Math.floor(C.anchorY*bn)})),crossTileIDs:I.map(C=>C.crossTileID)};if(v.positions.length>128){const C=new c.av(v.positions.length,16,Uint16Array);for(const{x:T,y:F}of v.positions)C.add(T,F);C.finish(),delete v.positions,v.index=C}this._symbolsByKey[h]=v}}getScaledCoordinates(e,n){const{x:a,y:o,z:h}=this.tileID.canonical,{x:I,y:v,z:C}=n.canonical,T=bn/Math.pow(2,C-h),F=(v*c.X+e.anchorY)*T,z=o*c.X*bn;return{x:Math.floor((I*c.X+e.anchorX)*T-a*c.X*bn),y:Math.floor(F-z)}}findMatches(e,n,a){const o=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){const I=e.get(h);if(I.crossTileID)continue;const v=this._symbolsByKey[I.key];if(!v)continue;const C=this.getScaledCoordinates(I,n);if(v.index){const T=v.index.range(C.x-o,C.y-o,C.x+o,C.y+o).sort();for(const F of T){const z=v.crossTileIDs[F];if(!a[z]){a[z]=!0,I.crossTileID=z;break}}}else if(v.positions)for(let T=0;T<v.positions.length;T++){const F=v.positions[T],z=v.crossTileIDs[T];if(Math.abs(F.x-C.x)<=o&&Math.abs(F.y-C.y)<=o&&!a[z]){a[z]=!0,I.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class da{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const o=this.indexes[a],h={};for(const I in o){const v=o[I];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+n),h[v.tileID.key]=v}this.indexes[a]=h}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const o=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const I=this.indexes[h];if(Number(h)>e.overscaledZ)for(const v in I){const C=I[v];C.tileID.isChildOf(e)&&C.findMatches(n.symbolInstances,e,o)}else{const v=I[e.scaledTo(Number(h)).key];v&&v.findMatches(n.symbolInstances,e,o)}}for(let h=0;h<n.symbolInstances.length;h++){const I=n.symbolInstances.get(h);I.crossTileID||(I.crossTileID=a.generate(),o[I.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new tr(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const o of a)delete this.usedCrossTileIDs[e][o]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const o=this.indexes[a];for(const h in o)e[o[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,o[h]),delete o[h],n=!0)}return n}}class il{constructor(){this.layerIndexes={},this.crossTileIDs=new da,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let o=this.layerIndexes[e.id];o===void 0&&(o=this.layerIndexes[e.id]=new Wr);let h=!1;const I={};o.handleWrapJump(a);for(const v of n){const C=v.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(v.tileID,C,this.crossTileIDs)&&(h=!0),I[C.bucketInstanceId]=!0)}return o.removeStaleBuckets(I)&&(h=!0),h}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const vn=(u,e)=>c.t(u,e&&e.filter(n=>n.identifier!=="source.canvas")),_c=c.aw();class Gn extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const o=this.sourceCaches[a].getSource().type;o!=="vector"&&o!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new vr(ki(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,o)=>this.getGlyphs(a,o)),this.dispatcher.registerMessageHandler("GI",(a,o)=>this.getImages(a,o)),this.imageManager=new Vt,this.imageManager.setEventedParent(this),this.glyphManager=new Mt(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new br(256,512),this.crossTileSymbolIndex=new il,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Rn().on(gt,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const o=this.sourceCaches[a.sourceId];if(!o)return;const h=o.getSource();if(h&&h.vectorLayerIds)for(const I in this._layers){const v=this._layers[I];v.source===h.id&&this._validateLayer(v)}})}loadURL(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const o=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;c.h(o,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,n,a)}).catch(I=>{this._loadStyleRequest=null,I&&!h.signal.aborted&&this.fire(new c.j(I))})}loadJSON(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,fe.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(_c,{validate:!1})}_load(e,n,a){var o;const h=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!vn(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(const I in h.sources)this.addSource(I,h.sources[I],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new Qi(this.stylesheet.light),this.sky=new ui(this.stylesheet.sky),this.map.setTerrain((o=this.stylesheet.terrain)!==null&&o!==void 0?o:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=c.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let o;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,I,v,C){return c._(this,void 0,void 0,function*(){const T=vt(h),F=v>1?"@2x":"",z={},$={};for(const{id:ie,url:ce}of T){const m=I.transformRequest(Tt(ce,F,".json"),"SpriteJSON");z[ie]=c.h(m,C);const p=I.transformRequest(Tt(ce,F,".png"),"SpriteImage");$[ie]=He.getImage(p,C)}return yield Promise.all([...Object.values(z),...Object.values($)]),function(ie,ce){return c._(this,void 0,void 0,function*(){const m={};for(const p in ie){m[p]={};const A=fe.getImageCanvasContext((yield ce[p]).data),w=(yield ie[p]).data;for(const B in w){const{width:k,height:P,x:S,y:V,sdf:U,pixelRatio:q,stretchX:ne,stretchY:Z,content:N,textFitWidth:se,textFitHeight:ue}=w[B];m[p][B]={data:null,pixelRatio:q,sdf:U,stretchX:ne,stretchY:Z,content:N,textFitWidth:se,textFitHeight:ue,spriteData:{width:k,height:P,x:S,y:V,context:A}}}}return m})}(z,$)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const I in h){this._spritesImagesIds[I]=[];const v=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(C=>!(C in h)):[];for(const C of v)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in h[I]){const T=I==="default"?C:`${I}:${C}`;this._spritesImagesIds[I].push(T),T in this.imageManager.images?this.imageManager.updateImage(T,h[I][C],!1):this.imageManager.addImage(T,h[I][C]),n&&(this._changedImages[T]=!0)}}}).catch(h=>{this._spriteRequest=null,o=h,this.fire(new c.j(o))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(o)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const o=n.getSource();(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${o.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(a):a);const o=[];for(const h of e)if(a[h]){const I=n?c.aB(a[h]):a[h];o.push(I)}return o}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const o=this._layers[a];o.type!=="custom"&&(e[a]=o.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const o=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(o.length||h.length)&&this._updateWorkerLayers(o,h);for(const I in this._updatedSources){const v=this._updatedSources[I];if(v==="reload")this._reloadSource(I);else{if(v!=="clear")throw new Error(`Invalid action ${v}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const o in this.sourceCaches){const h=this.sourceCaches[o];a[o]=h.used,h.used=!1}for(const o of this._order){const h=this._layers[o];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const o in a){const h=this.sourceCaches[o];!!a[o]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:o}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const o=this.serialize();if(e=n.transformStyle?n.transformStyle(o,e):e,((a=n.validate)===null||a===void 0||a)&&vn(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const h=c.aC(o,e),I=this._getOperationsToPerform(h);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const v of I.operations)v();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const o of e)switch(o.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,o.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,o.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,o.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,o.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,o.args));break;case"addSource":n.push(()=>this.addSource.apply(this,o.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,o.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,o.args));break;case"setLight":n.push(()=>this.setLight.apply(this,o.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,o.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,o.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,o.args));break;case"setSky":n.push(()=>this.setSky.apply(this,o.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,o.args));break;case"setTransition":n.push(()=>{});break;default:a.push(o.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const o=this.sourceCaches[e]=new $t(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,()=>({isSourceLoaded:o.loaded(),source:o.serialize(),sourceId:e})),o.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const o=e.id;if(this.getLayer(o))return void this.fire(new c.j(new Error(`Layer "${o}" already exists on this map.`)));let h;if(e.type==="custom"){if(vn(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(o,e.source),e=c.aB(e),e=c.e(e,{source:o})),this._validate(c.u.layer,`layers.${o}`,e,{arrayIndex:-1},a))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:o}})}const I=n?this._order.indexOf(n):this._order.length;if(n&&I===-1)this.fire(new c.j(new Error(`Cannot add layer "${o}" before non-existing layer "${n}".`)));else{if(this._order.splice(I,0,o),this._layerOrderChanged=!0,this._layers[o]=h,this._removedLayers[o]&&h.source&&h.type!=="custom"){const v=this._removedLayers[o];delete this._removedLayers[o],v.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const o=n?this._order.indexOf(n):this._order.length;n&&o===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const o=this.getLayer(e);o?o.minzoom===n&&o.maxzoom===a||(n!=null&&(o.minzoom=n),a!=null&&(o.maxzoom=a),this._updateLayer(o)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!c.aE(o.filter,n))return n==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(c.u.filter,`layers.${o.id}.filter`,n,null,a)||(o.filter=c.aB(n),this._updateLayer(o)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,o={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),a)||(h.setLayoutProperty(n,a,o),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,o={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),a)||(h.setPaintProperty(n,a,o)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,o=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const I=h.getSource().type;I==="geojson"&&o?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||o?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(o,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,o=this.sourceCaches[a];if(o===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=o.getSource().type,I=h==="vector"?e.sourceLayer:void 0;h!=="vector"||I?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):o.removeFeatureState(I,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,o=this.sourceCaches[n];if(o!==void 0)return o.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),o.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,o=this.stylesheet;return c.aG({version:o.version,name:o.name,metadata:o.metadata,light:o.light,sky:o.sky,center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,sprite:o.sprite,glyphs:o.glyphs,transition:o.transition,sources:e,layers:n,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=I=>this._layers[I].type==="fill-extrusion",a={},o=[];for(let I=this._order.length-1;I>=0;I--){const v=this._order[I];if(n(v)){a[v]=I;for(const C of e){const T=C[v];if(T)for(const F of T)o.push(F)}}}o.sort((I,v)=>v.intersectionZ-I.intersectionZ);const h=[];for(let I=this._order.length-1;I>=0;I--){const v=this._order[I];if(n(v))for(let C=o.length-1;C>=0;C--){const T=o[C].feature;if(a[T.layer.id]<I)break;h.push(T),o.pop()}else for(const C of e){const T=C[v];if(T)for(const F of T)h.push(F.feature)}}return h}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const o={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const v of n.layers){const C=this._layers[v];if(!C)return this.fire(new c.j(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];o[C.source]=!0}}const h=[];n.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const v in this.sourceCaches)n.layers&&!o[v]||h.push(pi(this.sourceCaches[v],this._layers,I,e,n,a));return this.placement&&h.push(function(v,C,T,F,z,$,ie){const ce={},m=$.queryRenderedSymbols(F),p=[];for(const A of Object.keys(m).map(Number))p.push(ie[A]);p.sort(zi);for(const A of p){const w=A.featureIndex.lookupSymbolFeatures(m[A.bucketInstanceId],C,A.bucketIndex,A.sourceLayerIndex,z.filter,z.layers,z.availableImages,v);for(const B in w){const k=ce[B]=ce[B]||[],P=w[B];P.sort((S,V)=>{const U=A.featureSortOrder;if(U){const q=U.indexOf(S.featureIndex);return U.indexOf(V.featureIndex)-q}return V.featureIndex-S.featureIndex});for(const S of P)k.push(S)}}for(const A in ce)ce[A].forEach(w=>{const B=w.feature,k=T[v[A].source].getFeatureState(B.layer["source-layer"],B.id);B.source=B.layer.source,B.layer["source-layer"]&&(B.sourceLayer=B.layer["source-layer"]),B.state=k});return ce}(this._layers,I,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(o,h){const I=o.getRenderableIds().map(T=>o.getTileByID(T)),v=[],C={};for(let T=0;T<I.length;T++){const F=I[T],z=F.tileID.canonical.key;C[z]||(C[z]=!0,F.querySourceFeatures(v,h))}return v}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let o=!1;for(const I in e)if(!c.aE(e[I],a[I])){o=!0;break}if(!o)return;const h={now:fe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let o=!1;if(!e&&!a)return;if(e&&!a)o=!0;else if(!e&&a)o=!0;else for(const I in e)if(!c.aE(e[I],a[I])){o=!0;break}if(!o)return;const h={now:fe.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,a,o,h={}){return(!h||h.validate!==!1)&&vn(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},o)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Rn().off(gt,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,o,h=!1){let I=!1,v=!1;const C={};for(const T of this._order){const F=this._layers[T];if(F.type!=="symbol")continue;if(!C[F.source]){const $=this.sourceCaches[F.source];C[F.source]=$.getRenderableIds(!0).map(ie=>$.getTileByID(ie)).sort((ie,ce)=>ce.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(ce.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(F,C[F.source],e.center.lng);I=I||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(fe.now(),e.zoom))&&(this.pauseablePlacement=new Aa(e,this.map.terrain,this._order,h,n,a,o,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(fe.now()),v=!0),I&&this.pauseablePlacement.placement.setStale()),v||I)for(const T of this._order){const F=this._layers[T];F.type==="symbol"&&this.placement.updateLayerOpacities(F,C[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(fe.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const o=this.sourceCaches[n.source];return o&&o.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),o=this.sourceCaches[n.source];return o&&o.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},o){this._checkLoaded();const h=[{id:e,url:n}],I=[...vt(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",I,null,a)||(this.stylesheet.sprite=I,this._loadSprite(h,!0,o))}removeSprite(e){this._checkLoaded();const n=vt(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return vt(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var ts=c.Y([{name:"a_pos",type:"Int16",components:2}]);const Xr={prelude:Di(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Di(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Di("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Di(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Di(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Di("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Di("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Di("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Di("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Di(u,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),o=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=h?h.concat(o):o,v={};return{fragmentSource:u=u.replace(n,(C,T,F,z,$)=>(v[$]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${F} ${z} ${$};
#else
uniform ${F} ${z} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${F} ${z} ${$} = u_${$};
#endif
`)),vertexSource:e=e.replace(n,(C,T,F,z,$)=>{const ie=z==="float"?"vec2":"vec4",ce=$.match(/color/)?"color":ie;return v[$]?T==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${F} ${ie} a_${$};
varying ${F} ${z} ${$};
#else
uniform ${F} ${z} u_${$};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${F} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${ce}(a_${$}, u_${$}_t);
#else
    ${F} ${z} ${$} = u_${$};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${F} ${ie} a_${$};
#else
uniform ${F} ${z} u_${$};
#endif
`:ce==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${F} ${z} ${$} = a_${$};
#else
    ${F} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${F} ${z} ${$} = unpack_mix_${ce}(a_${$}, u_${$}_t);
#else
    ${F} ${z} ${$} = u_${$};
#endif
`}),staticAttributes:a,staticUniforms:I}}class fa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,o,h,I,v,C,T){this.context=e;let F=this.boundPaintVertexBuffers.length!==o.length;for(let z=0;!F&&z<o.length;z++)this.boundPaintVertexBuffers[z]!==o[z]&&(F=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||F||this.boundIndexBuffer!==h||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==v||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==T?this.freshBind(n,a,o,h,I,v,C,T):(e.bindVertexArray.set(this.vao),v&&v.bind(),h&&h.dynamicDraw&&h.bind(),C&&C.bind(),T&&T.bind())}freshBind(e,n,a,o,h,I,v,C){const T=e.numAttributes,F=this.context,z=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=o,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=v,this.boundDynamicVertexBuffer3=C,n.enableAttributes(z,e);for(const $ of a)$.enableAttributes(z,e);I&&I.enableAttributes(z,e),v&&v.enableAttributes(z,e),C&&C.enableAttributes(z,e),n.bind(),n.setVertexAttribPointers(z,e,h);for(const $ of a)$.bind(),$.setVertexAttribPointers(z,e,h);I&&(I.bind(),I.setVertexAttribPointers(z,e,h)),o&&o.bind(),v&&(v.bind(),v.setVertexAttribPointers(z,e,h)),C&&(C.bind(),C.setVertexAttribPointers(z,e,h)),F.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const rl=(u,e,n,a,o)=>({u_matrix:u,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(o):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function Is(u){const e=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const a=u[n].split(" ");e.push(a.pop())}return e}class ho{constructor(e,n,a,o,h,I){const v=e.gl;this.program=v.createProgram();const C=Is(n.staticAttributes),T=a?a.getBinderAttributes():[],F=C.concat(T),z=Xr.prelude.staticUniforms?Is(Xr.prelude.staticUniforms):[],$=n.staticUniforms?Is(n.staticUniforms):[],ie=a?a.getBinderUniforms():[],ce=z.concat($).concat(ie),m=[];for(const S of ce)m.indexOf(S)<0&&m.push(S);const p=a?a.defines():[];h&&p.push("#define OVERDRAW_INSPECTOR;"),I&&p.push("#define TERRAIN3D;");const A=p.concat(Xr.prelude.fragmentSource,n.fragmentSource).join(`
`),w=p.concat(Xr.prelude.vertexSource,n.vertexSource).join(`
`),B=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(B,A),v.compileShader(B),!v.getShaderParameter(B,v.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${v.getShaderInfoLog(B)}`);v.attachShader(this.program,B);const k=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);if(v.shaderSource(k,w),v.compileShader(k),!v.getShaderParameter(k,v.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${v.getShaderInfoLog(k)}`);v.attachShader(this.program,k),this.attributes={};const P={};this.numAttributes=F.length;for(let S=0;S<this.numAttributes;S++)F[S]&&(v.bindAttribLocation(this.program,S,F[S]),this.attributes[F[S]]=S);if(v.linkProgram(this.program),!v.getProgramParameter(this.program,v.LINK_STATUS))throw new Error(`Program failed to link: ${v.getProgramInfoLog(this.program)}`);v.deleteShader(k),v.deleteShader(B);for(let S=0;S<m.length;S++){const V=m[S];if(V&&!P[V]){const U=v.getUniformLocation(this.program,V);U&&(P[V]=U)}}this.fixedUniforms=o(e,P),this.terrainUniforms=((S,V)=>({u_depth:new c.aH(S,V.u_depth),u_terrain:new c.aH(S,V.u_terrain),u_terrain_dim:new c.aI(S,V.u_terrain_dim),u_terrain_matrix:new c.aJ(S,V.u_terrain_matrix),u_terrain_unpack:new c.aK(S,V.u_terrain_unpack),u_terrain_exaggeration:new c.aI(S,V.u_terrain_exaggeration)}))(e,P),this.binderUniforms=a?a.getUniforms(e,P):[]}draw(e,n,a,o,h,I,v,C,T,F,z,$,ie,ce,m,p,A,w){const B=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(o),e.setColorMode(h),e.setCullFace(I),C){e.activeTexture.set(B.TEXTURE2),B.bindTexture(B.TEXTURE_2D,C.depthTexture),e.activeTexture.set(B.TEXTURE3),B.bindTexture(B.TEXTURE_2D,C.texture);for(const P in this.terrainUniforms)this.terrainUniforms[P].set(C[P])}for(const P in this.fixedUniforms)this.fixedUniforms[P].set(v[P]);m&&m.setUniforms(e,this.binderUniforms,ie,{zoom:ce});let k=0;switch(n){case B.LINES:k=2;break;case B.TRIANGLES:k=3;break;case B.LINE_STRIP:k=1}for(const P of $.get()){const S=P.vaos||(P.vaos={});(S[T]||(S[T]=new fa)).bind(e,this,F,m?m.getPaintVertexBuffers():[],z,P.vertexOffset,p,A,w),B.drawElements(n,P.primitiveLength*k,B.UNSIGNED_SHORT,P.primitiveOffset*k*2)}}}function wn(u,e,n){const a=1/fi(n,1,e.transform.tileZoom),o=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/o,I=h*(n.tileID.canonical.x+n.tileID.wrap*o),v=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[I>>16,v>>16],u_pixel_coord_lower:[65535&I,65535&v]}}const is=(u,e,n,a)=>{const o=e.style.light,h=o.properties.get("position"),I=[h.x,h.y,h.z],v=function(){var T=new c.A(9);return c.A!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[5]=0,T[6]=0,T[7]=0),T[0]=1,T[4]=1,T[8]=1,T}();o.properties.get("anchor")==="viewport"&&function(T,F){var z=Math.sin(F),$=Math.cos(F);T[0]=$,T[1]=z,T[2]=0,T[3]=-z,T[4]=$,T[5]=0,T[6]=0,T[7]=0,T[8]=1}(v,-e.transform.angle),function(T,F,z){var $=F[0],ie=F[1],ce=F[2];T[0]=$*z[0]+ie*z[3]+ce*z[6],T[1]=$*z[1]+ie*z[4]+ce*z[7],T[2]=$*z[2]+ie*z[5]+ce*z[8]}(I,I,v);const C=o.properties.get("color");return{u_matrix:u,u_lightpos:I,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+n,u_opacity:a}},Ls=(u,e,n,a,o,h,I)=>c.e(is(u,e,n,a),wn(h,e,I),{u_height_factor:-Math.pow(2,o.overscaledZ)/I.tileSize/8}),ga=u=>({u_matrix:u}),uo=(u,e,n,a)=>c.e(ga(u),wn(n,e,a)),nl=(u,e)=>({u_matrix:u,u_world:e}),sl=(u,e,n,a,o)=>c.e(uo(u,e,n,a),{u_world:o}),Ol=(u,e,n,a)=>{const o=u.transform;let h,I;if(a.paint.get("circle-pitch-alignment")==="map"){const v=fi(n,1,o.zoom);h=!0,I=[v,v]}else h=!1,I=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:I}},bs=(u,e,n)=>({u_matrix:u,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),Rs=(u,e,n=1)=>({u_matrix:u,u_color:e,u_overlay:0,u_overlay_scale:n}),_r=u=>({u_matrix:u}),zr=(u,e,n,a)=>({u_matrix:u,u_extrude_scale:fi(e,1,n),u_intensity:a}),Ua=(u,e,n,a)=>{const o=c.H();c.aP(o,0,u.width,u.height,0,0,1);const h=u.context.gl;return{u_matrix:o,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function Ao(u,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/n).toLngLat().lat,new c.Z(0,(a+1)/n).toLngLat().lat]}const Na=(u,e,n,a)=>{const o=u.transform;return{u_matrix:fo(u,e,n,a),u_ratio:1/fi(e,1,o.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},ql=(u,e,n,a,o)=>c.e(Na(u,e,n,o),{u_image:0,u_image_height:a}),pa=(u,e,n,a,o)=>{const h=u.transform,I=Oa(e,h);return{u_matrix:fo(u,e,n,o),u_texsize:e.imageAtlasTexture.size,u_ratio:1/fi(e,1,h.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[I,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ic=(u,e,n,a,o,h)=>{const I=u.lineAtlas,v=Oa(e,u.transform),C=n.layout.get("line-cap")==="round",T=I.getDash(a.from,C),F=I.getDash(a.to,C),z=T.width*o.fromScale,$=F.width*o.toScale;return c.e(Na(u,e,n,h),{u_patternscale_a:[v/z,-T.height/2],u_patternscale_b:[v/$,-F.height/2],u_sdfgamma:I.width/(256*Math.min(z,$)*u.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:F.y,u_mix:o.t})};function Oa(u,e){return 1/fi(u,1,e.tileZoom)}function fo(u,e,n,a){return u.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Vl=(u,e,n,a,o)=>{return{u_matrix:u,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(I=o.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(h=o.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:al(o.paint.get("raster-hue-rotate"))};var h,I};function al(u){u*=Math.PI/180;const e=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const ol=(u,e,n,a,o,h,I,v,C,T,F,z,$,ie)=>{const ce=I.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:ce.width/ce.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:C,u_coord_matrix:T,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:o,u_is_variable_anchor:h,u_texsize:$,u_texture:0,u_translation:F,u_pitched_scale:ie}},rs=(u,e,n,a,o,h,I,v,C,T,F,z,$,ie,ce)=>{const m=I.transform;return c.e(ol(u,e,n,a,o,h,I,v,C,T,F,z,$,ce),{u_gamma_scale:a?Math.cos(m._pitch)*m.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},Fs=(u,e,n,a,o,h,I,v,C,T,F,z,$,ie)=>c.e(rs(u,e,n,a,o,h,I,v,C,T,F,!0,z,!0,ie),{u_texsize_icon:$,u_texture_icon:1}),zs=(u,e,n)=>({u_matrix:u,u_opacity:e,u_color:n}),vs=(u,e,n,a,o,h)=>c.e(function(I,v,C,T){const F=C.imageManager.getPattern(I.from.toString()),z=C.imageManager.getPattern(I.to.toString()),{width:$,height:ie}=C.imageManager.getPixelSize(),ce=Math.pow(2,T.tileID.overscaledZ),m=T.tileSize*Math.pow(2,C.transform.tileZoom)/ce,p=m*(T.tileID.canonical.x+T.tileID.wrap*ce),A=m*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[$,ie],u_mix:v.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/fi(T,1,C.transform.tileZoom),u_pixel_coord_upper:[p>>16,A>>16],u_pixel_coord_lower:[65535&p,65535&A]}}(a,h,n,o),{u_matrix:u,u_opacity:e}),Gs={fillExtrusion:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_lightpos:new c.aN(u,e.u_lightpos),u_lightintensity:new c.aI(u,e.u_lightintensity),u_lightcolor:new c.aN(u,e.u_lightcolor),u_vertical_gradient:new c.aI(u,e.u_vertical_gradient),u_opacity:new c.aI(u,e.u_opacity)}),fillExtrusionPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_lightpos:new c.aN(u,e.u_lightpos),u_lightintensity:new c.aI(u,e.u_lightintensity),u_lightcolor:new c.aN(u,e.u_lightcolor),u_vertical_gradient:new c.aI(u,e.u_vertical_gradient),u_height_factor:new c.aI(u,e.u_height_factor),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade),u_opacity:new c.aI(u,e.u_opacity)}),fill:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix)}),fillPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),fillOutline:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world)}),fillOutlinePattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),circle:(u,e)=>({u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(u,e.u_scale_with_map),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_extrude_scale:new c.aO(u,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_matrix:new c.aJ(u,e.u_matrix)}),collisionBox:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_pixel_extrude_scale:new c.aO(u,e.u_pixel_extrude_scale)}),collisionCircle:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_inv_matrix:new c.aJ(u,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_viewport_size:new c.aO(u,e.u_viewport_size)}),debug:(u,e)=>({u_color:new c.aL(u,e.u_color),u_matrix:new c.aJ(u,e.u_matrix),u_overlay:new c.aH(u,e.u_overlay),u_overlay_scale:new c.aI(u,e.u_overlay_scale)}),clippingMask:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix)}),heatmap:(u,e)=>({u_extrude_scale:new c.aI(u,e.u_extrude_scale),u_intensity:new c.aI(u,e.u_intensity),u_matrix:new c.aJ(u,e.u_matrix)}),heatmapTexture:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world),u_image:new c.aH(u,e.u_image),u_color_ramp:new c.aH(u,e.u_color_ramp),u_opacity:new c.aI(u,e.u_opacity)}),hillshade:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_latrange:new c.aO(u,e.u_latrange),u_light:new c.aO(u,e.u_light),u_shadow:new c.aL(u,e.u_shadow),u_highlight:new c.aL(u,e.u_highlight),u_accent:new c.aL(u,e.u_accent)}),hillshadePrepare:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_dimension:new c.aO(u,e.u_dimension),u_zoom:new c.aI(u,e.u_zoom),u_unpack:new c.aK(u,e.u_unpack)}),line:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels)}),lineGradient:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_image:new c.aH(u,e.u_image),u_image_height:new c.aI(u,e.u_image_height)}),linePattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texsize:new c.aO(u,e.u_texsize),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_image:new c.aH(u,e.u_image),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),lineSDF:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_patternscale_a:new c.aO(u,e.u_patternscale_a),u_patternscale_b:new c.aO(u,e.u_patternscale_b),u_sdfgamma:new c.aI(u,e.u_sdfgamma),u_image:new c.aH(u,e.u_image),u_tex_y_a:new c.aI(u,e.u_tex_y_a),u_tex_y_b:new c.aI(u,e.u_tex_y_b),u_mix:new c.aI(u,e.u_mix)}),raster:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_tl_parent:new c.aO(u,e.u_tl_parent),u_scale_parent:new c.aI(u,e.u_scale_parent),u_buffer_scale:new c.aI(u,e.u_buffer_scale),u_fade_t:new c.aI(u,e.u_fade_t),u_opacity:new c.aI(u,e.u_opacity),u_image0:new c.aH(u,e.u_image0),u_image1:new c.aH(u,e.u_image1),u_brightness_low:new c.aI(u,e.u_brightness_low),u_brightness_high:new c.aI(u,e.u_brightness_high),u_saturation_factor:new c.aI(u,e.u_saturation_factor),u_contrast_factor:new c.aI(u,e.u_contrast_factor),u_spin_weights:new c.aN(u,e.u_spin_weights)}),symbolIcon:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texture:new c.aH(u,e.u_texture),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),symbolSDF:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texture:new c.aH(u,e.u_texture),u_gamma_scale:new c.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_is_halo:new c.aH(u,e.u_is_halo),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),symbolTextAndIcon:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texsize_icon:new c.aO(u,e.u_texsize_icon),u_texture:new c.aH(u,e.u_texture),u_texture_icon:new c.aH(u,e.u_texture_icon),u_gamma_scale:new c.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_is_halo:new c.aH(u,e.u_is_halo),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),background:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_opacity:new c.aI(u,e.u_opacity),u_color:new c.aL(u,e.u_color)}),backgroundPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_opacity:new c.aI(u,e.u_opacity),u_image:new c.aH(u,e.u_image),u_pattern_tl_a:new c.aO(u,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(u,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(u,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(u,e.u_pattern_br_b),u_texsize:new c.aO(u,e.u_texsize),u_mix:new c.aI(u,e.u_mix),u_pattern_size_a:new c.aO(u,e.u_pattern_size_a),u_pattern_size_b:new c.aO(u,e.u_pattern_size_b),u_scale_a:new c.aI(u,e.u_scale_a),u_scale_b:new c.aI(u,e.u_scale_b),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(u,e.u_tile_units_to_pixels)}),terrain:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texture:new c.aH(u,e.u_texture),u_ele_delta:new c.aI(u,e.u_ele_delta),u_fog_matrix:new c.aJ(u,e.u_fog_matrix),u_fog_color:new c.aL(u,e.u_fog_color),u_fog_ground_blend:new c.aI(u,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(u,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(u,e.u_horizon_color),u_horizon_fog_blend:new c.aI(u,e.u_horizon_fog_blend)}),terrainDepth:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ele_delta:new c.aI(u,e.u_ele_delta)}),terrainCoords:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texture:new c.aH(u,e.u_texture),u_terrain_coords_id:new c.aI(u,e.u_terrain_coords_id),u_ele_delta:new c.aI(u,e.u_ele_delta)}),sky:(u,e)=>({u_sky_color:new c.aL(u,e.u_sky_color),u_horizon_color:new c.aL(u,e.u_horizon_color),u_horizon:new c.aI(u,e.u_horizon),u_sky_horizon_blend:new c.aI(u,e.u_sky_horizon_blend)})};class hr{constructor(e,n,a){this.context=e;const o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ll{constructor(e,n,a,o){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=o,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const o=n.attributes[this.attributes[a].name];o!==void 0&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,n,a){for(let o=0;o<this.attributes.length;o++){const h=this.attributes[o],I=n.attributes[h.name];I!==void 0&&e.vertexAttribPointer(I,h.components,e[bc[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Us=new WeakMap;function ws(u){var e;if(Us.has(u))return Us.get(u);{const n=(e=u.getParameter(u.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Us.set(u,n),n}}class Ti{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class go extends Ti{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class vc extends Ti{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ns extends Ti{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Hl extends Ti{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class cl extends Ti{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class qa extends Ti{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class hl extends Ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ma extends Ti{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class po extends Ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class kr extends Ti{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ul extends Ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Al extends Ti{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Un extends Ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class xs extends Ti{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Os extends Ti{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class dl extends Ti{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ya extends Ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class xn extends Ti{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Va extends Ti{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class mo extends Ti{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class fl extends Ti{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class yo extends Ti{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jl extends Ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class gl extends Ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class _o extends Ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Jl extends Ti{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Io extends Ti{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ns extends Ti{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;ws(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class _a extends Ti{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pl extends Ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ha extends Ti{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ia extends Ti{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class ml extends Ia{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ss extends Ia{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class yl extends Ia{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class wc{constructor(e,n,a,o,h){this.context=e,this.width=n,this.height=a;const I=e.gl,v=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new ml(e,v),o)this.depthAttachment=h?new yl(e,v):new ss(e,v);else if(h)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Zi{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}Zi.Replace=[1,0],Zi.disabled=new Zi(Zi.Replace,c.aM.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,c.aM.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,771],c.aM.transparent,[!0,!0,!0,!0]);class ba{constructor(e){var n,a;if(this.gl=e,this.clearColor=new go(this),this.clearDepth=new vc(this),this.clearStencil=new Ns(this),this.colorMask=new Hl(this),this.depthMask=new cl(this),this.stencilMask=new qa(this),this.stencilFunc=new hl(this),this.stencilOp=new ma(this),this.stencilTest=new po(this),this.depthRange=new kr(this),this.depthTest=new ul(this),this.depthFunc=new Al(this),this.blend=new Un(this),this.blendFunc=new xs(this),this.blendColor=new Os(this),this.blendEquation=new dl(this),this.cullFace=new ya(this),this.cullFaceSide=new xn(this),this.frontFace=new Va(this),this.program=new mo(this),this.activeTexture=new fl(this),this.viewport=new yo(this),this.bindFramebuffer=new jl(this),this.bindRenderbuffer=new gl(this),this.bindTexture=new _o(this),this.bindVertexBuffer=new Jl(this),this.bindElementBuffer=new Io(this),this.bindVertexArray=new ns(this),this.pixelStoreUnpack=new _a(this),this.pixelStoreUnpackPremultiplyAlpha=new pl(this),this.pixelStoreUnpackFlipY=new Ha(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ws(e)){this.HALF_FLOAT=e.HALF_FLOAT;const o=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:o==null?void 0:o.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:o==null?void 0:o.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const o=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=o==null?void 0:o.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new hr(this,e,n)}createVertexBuffer(e,n,a){return new ll(this,e,n,a)}createRenderbuffer(e,n,a){const o=this.gl,h=o.createRenderbuffer();return this.bindRenderbuffer.set(h),o.renderbufferStorage(o.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,a,o){return new wc(this,e,n,a,o)}clear({color:e,depth:n,stencil:a}){const o=this.gl;let h=0;e&&(h|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(h|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),o.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ws(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return ws(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ci{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}ci.ReadOnly=!1,ci.ReadWrite=!0,ci.disabled=new ci(519,ci.ReadOnly,[0,1]);const bo=7680;class Ui{constructor(e,n,a,o,h,I){this.test=e,this.ref=n,this.mask=a,this.fail=o,this.depthFail=h,this.pass=I}}Ui.disabled=new Ui({func:519,mask:0},0,0,bo,bo,bo);class Fi{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let Nn;function On(u,e,n,a,o){const h=u.context,I=h.gl,v=u.useProgram("collisionBox"),C=[];let T=0,F=0;for(let A=0;A<a.length;A++){const w=a[A],B=e.getTile(w).getBucket(n);if(!B)continue;const k=o?B.textCollisionBox:B.iconCollisionBox,P=B.collisionCircleArray;if(P.length>0){const S=c.H();c.aQ(S,B.placementInvProjMatrix,u.transform.glCoordMatrix),c.aQ(S,S,B.placementViewportMatrix),C.push({circleArray:P,circleOffset:F,transform:w.posMatrix,invTransform:S,coord:w}),T+=P.length/4,F=T}k&&v.draw(h,I.LINES,ci.disabled,Ui.disabled,u.colorModeForRenderPass(),Fi.disabled,{u_matrix:w.posMatrix,u_pixel_extrude_scale:[1/(z=u.transform).width,1/z.height]},u.style.map.terrain&&u.style.map.terrain.getTerrainData(w),n.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,null,u.transform.zoom,null,null,k.collisionVertexBuffer)}var z;if(!o||!C.length)return;const $=u.useProgram("collisionCircle"),ie=new c.aR;ie.resize(4*T),ie._trim();let ce=0;for(const A of C)for(let w=0;w<A.circleArray.length/4;w++){const B=4*w,k=A.circleArray[B+0],P=A.circleArray[B+1],S=A.circleArray[B+2],V=A.circleArray[B+3];ie.emplace(ce++,k,P,S,V,0),ie.emplace(ce++,k,P,S,V,1),ie.emplace(ce++,k,P,S,V,2),ie.emplace(ce++,k,P,S,V,3)}(!Nn||Nn.length<2*T)&&(Nn=function(A){const w=2*A,B=new c.aT;B.resize(w),B._trim();for(let k=0;k<w;k++){const P=6*k;B.uint16[P+0]=4*k+0,B.uint16[P+1]=4*k+1,B.uint16[P+2]=4*k+2,B.uint16[P+3]=4*k+2,B.uint16[P+4]=4*k+3,B.uint16[P+5]=4*k+0}return B}(T));const m=h.createIndexBuffer(Nn,!0),p=h.createVertexBuffer(ie,c.aS.members,!0);for(const A of C){const w=bs(A.transform,A.invTransform,u.transform);$.draw(h,I.TRIANGLES,ci.disabled,Ui.disabled,u.colorModeForRenderPass(),Fi.disabled,w,u.style.map.terrain&&u.style.map.terrain.getTerrainData(A.coord),n.id,p,m,c.a0.simpleSegment(0,2*A.circleOffset,A.circleArray.length,A.circleArray.length/2),null,u.transform.zoom,null,null,null)}p.destroy(),m.destroy()}Fi.disabled=new Fi(!1,1029,2305),Fi.backCCW=new Fi(!0,1029,2305);const va=c.an(new Float32Array(16));function _l(u,e,n,a,o,h){const{horizontalAlign:I,verticalAlign:v}=c.au(u);return new c.P((-(I-.5)*e/o+a[0])*h,(-(v-.5)*n/o+a[1])*h)}function qn(u,e,n,a,o,h){const I=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let v=a.mult(h);n||(v=v.rotate(-o));const C=I.add(v);return _e(C.x,C.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const v=Ye(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(u),C=Math.atan(v.y/v.x)+(v.x<0?Math.PI:0);return u.add(a.rotate(C))}return u.add(a)}function Bs(u,e,n,a,o,h,I,v,C,T,F,z,$,ie){const ce=u.text.placedSymbolArray,m=u.text.dynamicLayoutVertexArray,p=u.icon.dynamicLayoutVertexArray,A={};m.clear();for(let w=0;w<ce.length;w++){const B=ce.get(w),k=B.hidden||!B.crossTileID||u.allowVerticalPlacement&&!B.placedOrientation?null:a[B.crossTileID];if(k){const P=new c.P(B.anchorX,B.anchorY),S={getElevation:ie,width:o.width,height:o.height,labelPlaneMatrix:h,pitchWithMap:n,projection:F,tileAnchorPoint:P,translation:z,unwrappedTileID:$},V=n?_e(P.x,P.y,I,ie):Ye(P.x,P.y,S),U=J(o.cameraToCenterDistance,V.signedDistanceFromCamera);let q=c.ai(u.textSizeData,C,B)*U/c.ap;n&&(q*=u.tilePixelRatio/v);const{width:ne,height:Z,anchor:N,textOffset:se,textBoxScale:ue}=k,ae=_l(N,ne,Z,se,ue,q),de=F.getPitchedTextCorrection(o,P.add(new c.P(z[0],z[1])),$),xe=qn(V.point,S,e,ae,o.angle,de),be=u.allowVerticalPlacement&&B.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Se=0;Se<B.numGlyphs;Se++)c.aj(m,xe,be);T&&B.associatedIconIndex>=0&&(A[B.associatedIconIndex]={shiftedAnchor:xe,angle:be})}else jt(B.numGlyphs,m)}if(T){p.clear();const w=u.icon.placedSymbolArray;for(let B=0;B<w.length;B++){const k=w.get(B);if(k.hidden)jt(k.numGlyphs,p);else{const P=A[B];if(P)for(let S=0;S<k.numGlyphs;S++)c.aj(p,P.shiftedAnchor,P.angle);else jt(k.numGlyphs,p)}}u.icon.dynamicLayoutVertexBuffer.updateData(p)}u.text.dynamicLayoutVertexBuffer.updateData(m)}function en(u,e,n){return n.iconsInText&&e?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function vo(u,e,n,a,o,h,I,v,C,T,F,z){const $=u.context,ie=$.gl,ce=u.transform,m=Ps(),p=v==="map",A=C==="map",w=v!=="viewport"&&n.layout.get("symbol-placement")!=="point",B=p&&!A&&!w,k=!A&&w,P=!n.layout.get("symbol-sort-key").isConstant();let S=!1;const V=u.depthModeForSublayer(0,ci.ReadOnly),U=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=[],ne=m.getCircleRadiusCorrection(ce);for(const Z of a){const N=e.getTile(Z),se=N.getBucket(n);if(!se)continue;const ue=o?se.text:se.icon;if(!ue||!ue.segments.get().length||!ue.hasVisibleVertices)continue;const ae=ue.programConfigurations.get(n.id),de=o||se.sdfIcons,xe=o?se.textSizeData:se.iconSizeData,be=A||ce.pitch!==0,Se=u.useProgram(en(de,o,se),ae),K=c.ag(xe,ce.zoom),G=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Z);let Ae,re,le,ge,De=[0,0],Be=null;if(o)re=N.glyphAtlasTexture,le=ie.LINEAR,Ae=N.glyphAtlasTexture.size,se.iconsInText&&(De=N.imageAtlasTexture.size,Be=N.imageAtlasTexture,ge=be||u.options.rotating||u.options.zooming||xe.kind==="composite"||xe.kind==="camera"?ie.LINEAR:ie.NEAREST);else{const ut=n.layout.get("icon-size").constantOr(0)!==1||se.iconsNeedLinear;re=N.imageAtlasTexture,le=de||u.options.rotating||u.options.zooming||ut||be?ie.LINEAR:ie.NEAREST,Ae=N.imageAtlasTexture.size}const ke=fi(N,1,u.transform.zoom),Oe=k?Z.posMatrix:va,Ze=es(Oe,A,p,u.transform,ke),We=_n(Oe,A,p,u.transform,ke),rt=_n(Z.posMatrix,A,p,u.transform,ke),pt=m.translatePosition(u.transform,N,h,I),Ve=U&&se.hasTextData(),ze=n.layout.get("icon-text-fit")!=="none"&&Ve&&se.hasIconData();if(w){const ut=u.style.map.terrain?(mi,ai)=>u.style.map.terrain.getElevation(Z,mi,ai):null,Et=n.layout.get("text-rotation-alignment")==="map";te(se,Z.posMatrix,u,o,Ze,rt,A,T,Et,m,Z.toUnwrapped(),ce.width,ce.height,pt,ut)}const it=Z.posMatrix,Dt=o&&U||ze,ft=w||Dt?va:Ze,Rt=We,At=de&&n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ct;Ct=de?se.iconsInText?Fs(xe.kind,K,B,A,w,Dt,u,it,ft,Rt,pt,Ae,De,ne):rs(xe.kind,K,B,A,w,Dt,u,it,ft,Rt,pt,o,Ae,!0,ne):ol(xe.kind,K,B,A,w,Dt,u,it,ft,Rt,pt,o,Ae,ne);const wt={program:Se,buffers:ue,uniformValues:Ct,atlasTexture:re,atlasTextureIcon:Be,atlasInterpolation:le,atlasInterpolationIcon:ge,isSDF:de,hasHalo:At};if(P&&se.canOverlap){S=!0;const ut=ue.segments.get();for(const Et of ut)q.push({segments:new c.a0([Et]),sortKey:Et.sortKey,state:wt,terrainData:G})}else q.push({segments:ue.segments,sortKey:0,state:wt,terrainData:G})}S&&q.sort((Z,N)=>Z.sortKey-N.sortKey);for(const Z of q){const N=Z.state;if($.activeTexture.set(ie.TEXTURE0),N.atlasTexture.bind(N.atlasInterpolation,ie.CLAMP_TO_EDGE),N.atlasTextureIcon&&($.activeTexture.set(ie.TEXTURE1),N.atlasTextureIcon&&N.atlasTextureIcon.bind(N.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),N.isSDF){const se=N.uniformValues;N.hasHalo&&(se.u_is_halo=1,wo(N.buffers,Z.segments,n,u,N.program,V,F,z,se,Z.terrainData)),se.u_is_halo=0}wo(N.buffers,Z.segments,n,u,N.program,V,F,z,N.uniformValues,Z.terrainData)}}function wo(u,e,n,a,o,h,I,v,C,T){const F=a.context;o.draw(F,F.gl.TRIANGLES,h,I,v,Fi.disabled,C,T,n.id,u.layoutVertexBuffer,u.indexBuffer,e,n.paint,a.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function ja(u,e,n,a){const o=u.context,h=o.gl,I=Ui.disabled,v=new Zi([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),C=e.getBucket(n);if(!C)return;const T=a.key;let F=n.heatmapFbos.get(T);F||(F=wa(o,e.tileSize,e.tileSize),n.heatmapFbos.set(T,F)),o.bindFramebuffer.set(F.framebuffer),o.viewport.set([0,0,e.tileSize,e.tileSize]),o.clear({color:c.aM.transparent});const z=C.programConfigurations.get(n.id),$=u.useProgram("heatmap",z),ie=u.style.map.terrain.getTerrainData(a);$.draw(o,h.TRIANGLES,ci.disabled,I,v,Fi.disabled,zr(a.posMatrix,e,u.transform.zoom,n.paint.get("heatmap-intensity")),ie,n.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,n.paint,u.transform.zoom,z)}function Cs(u,e,n){const a=u.context,o=a.gl;a.setColorMode(u.colorModeForRenderPass());const h=xa(a,e),I=n.key,v=e.heatmapFbos.get(I);v&&(a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,v.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1),h.bind(o.LINEAR,o.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(a,o.TRIANGLES,ci.disabled,Ui.disabled,u.colorModeForRenderPass(),Fi.disabled,Ua(u,e,0,1),null,e.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,e.paint,u.transform.zoom),v.destroy(),e.heatmapFbos.delete(I))}function wa(u,e,n){var a,o;const h=u.gl,I=h.createTexture();h.bindTexture(h.TEXTURE_2D,I),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const v=(a=u.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,C=(o=u.RGBA16F)!==null&&o!==void 0?o:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,C,e,n,0,h.RGBA,v,null);const T=u.createFramebuffer(e,n,!1,!1);return T.colorAttachment.set(I),T}function xa(u,e){return e.colorRampTexture||(e.colorRampTexture=new bt(u,e.colorRamp,u.gl.RGBA)),e.colorRampTexture}function qs(u,e,n,a,o){if(!n||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let I=h[n.to.toString()],v=h[n.from.toString()];if(!I&&v&&(I=v),!v&&I&&(v=I),!I||!v){const C=o.getPaintProperty(e);I=h[C],v=h[C]}I&&v&&u.setConstantPatternPositions(I,v)}function Ja(u,e,n,a,o,h,I){const v=u.context.gl,C="fill-pattern",T=n.paint.get(C),F=T&&T.constantOr(1),z=n.getCrossfadeParameters();let $,ie,ce,m,p;I?(ie=F&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=v.LINES):(ie=F?"fillPattern":"fill",$=v.TRIANGLES);const A=T.constantOr(null);for(const w of a){const B=e.getTile(w);if(F&&!B.patternsLoaded())continue;const k=B.getBucket(n);if(!k)continue;const P=k.programConfigurations.get(n.id),S=u.useProgram(ie,P),V=u.style.map.terrain&&u.style.map.terrain.getTerrainData(w);F&&(u.context.activeTexture.set(v.TEXTURE0),B.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),P.updatePaintBuffers(z)),qs(P,C,A,B,n);const U=V?w:null,q=u.translatePosMatrix(U?U.posMatrix:w.posMatrix,B,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(I){m=k.indexBuffer2,p=k.segments2;const ne=[v.drawingBufferWidth,v.drawingBufferHeight];ce=ie==="fillOutlinePattern"&&F?sl(q,u,z,B,ne):nl(q,ne)}else m=k.indexBuffer,p=k.segments,ce=F?uo(q,u,z,B):ga(q);S.draw(u.context,$,o,u.stencilModeForClipping(w),h,Fi.disabled,ce,V,n.id,k.layoutVertexBuffer,m,p,n.paint,u.transform.zoom,P)}}function xo(u,e,n,a,o,h,I){const v=u.context,C=v.gl,T="fill-extrusion-pattern",F=n.paint.get(T),z=F.constantOr(1),$=n.getCrossfadeParameters(),ie=n.paint.get("fill-extrusion-opacity"),ce=F.constantOr(null);for(const m of a){const p=e.getTile(m),A=p.getBucket(n);if(!A)continue;const w=u.style.map.terrain&&u.style.map.terrain.getTerrainData(m),B=A.programConfigurations.get(n.id),k=u.useProgram(z?"fillExtrusionPattern":"fillExtrusion",B);z&&(u.context.activeTexture.set(C.TEXTURE0),p.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),B.updatePaintBuffers($)),qs(B,T,ce,p,n);const P=u.translatePosMatrix(m.posMatrix,p,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),S=n.paint.get("fill-extrusion-vertical-gradient"),V=z?Ls(P,u,S,ie,m,$,p):is(P,u,S,ie);k.draw(v,v.gl.TRIANGLES,o,h,I,Fi.backCCW,V,w,n.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,n.paint,u.transform.zoom,B,u.style.map.terrain&&A.centroidVertexBuffer)}}function Ba(u,e,n,a,o,h,I){const v=u.context,C=v.gl,T=n.fbo;if(!T)return;const F=u.useProgram("hillshade"),z=u.style.map.terrain&&u.style.map.terrain.getTerrainData(e);v.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,T.colorAttachment.get()),F.draw(v,C.TRIANGLES,o,h,I,Fi.disabled,(($,ie,ce,m)=>{const p=ce.paint.get("hillshade-shadow-color"),A=ce.paint.get("hillshade-highlight-color"),w=ce.paint.get("hillshade-accent-color");let B=ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);ce.paint.get("hillshade-illumination-anchor")==="viewport"&&(B-=$.transform.angle);const k=!$.options.moving;return{u_matrix:m?m.posMatrix:$.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),k),u_image:0,u_latrange:Ao(0,ie.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),B],u_shadow:p,u_highlight:A,u_accent:w}})(u,n,a,z?e:null),z,a.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function Vs(u,e,n,a,o,h){const I=u.context,v=I.gl,C=e.dem;if(C&&C.data){const T=C.dim,F=C.stride,z=C.getPixels();if(I.activeTexture.set(v.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||u.getTileTexture(F),e.demTexture){const ie=e.demTexture;ie.update(z,{premultiply:!1}),ie.bind(v.NEAREST,v.CLAMP_TO_EDGE)}else e.demTexture=new bt(I,z,v.RGBA,{premultiply:!1}),e.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);I.activeTexture.set(v.TEXTURE0);let $=e.fbo;if(!$){const ie=new bt(I,{width:T,height:T,data:null},v.RGBA);ie.bind(v.LINEAR,v.CLAMP_TO_EDGE),$=e.fbo=I.createFramebuffer(T,T,!0,!1),$.colorAttachment.set(ie.texture)}I.bindFramebuffer.set($.framebuffer),I.viewport.set([0,0,T,T]),u.useProgram("hillshadePrepare").draw(I,v.TRIANGLES,a,o,h,Fi.disabled,((ie,ce)=>{const m=ce.stride,p=c.H();return c.aP(p,0,c.X,-c.X,0,0,1),c.J(p,p,[0,-c.X,0]),{u_matrix:p,u_image:1,u_dimension:[m,m],u_zoom:ie.overscaledZ,u_unpack:ce.getUnpackVector()}})(e.tileID,C),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Il(u,e,n,a,o,h){const I=a.paint.get("raster-fade-duration");if(!h&&I>0){const v=fe.now(),C=(v-u.timeAdded)/I,T=e?(v-e.timeAdded)/I:-1,F=n.getSource(),z=o.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),$=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(u.tileID.overscaledZ-z),ie=$&&u.refreshedUponExpiration?1:c.ac($?C:1-T,0,1);return u.refreshedUponExpiration&&C>=1&&(u.refreshedUponExpiration=!1),e?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const Bo=new c.aM(1,0,0,1),Bi=new c.aM(0,1,0,1),Co=new c.aM(0,0,1,1),xc=new c.aM(1,0,1,1),bl=new c.aM(0,1,1,1);function Gr(u,e,n,a){Eo(u,0,e+n/2,u.transform.width,n,a)}function Yl(u,e,n,a){Eo(u,e-n/2,0,n,u.transform.height,a)}function Eo(u,e,n,a,o,h){const I=u.context,v=I.gl;v.enable(v.SCISSOR_TEST),v.scissor(e*u.pixelRatio,n*u.pixelRatio,a*u.pixelRatio,o*u.pixelRatio),I.clear({color:h}),v.disable(v.SCISSOR_TEST)}function Kl(u,e,n){const a=u.context,o=a.gl,h=n.posMatrix,I=u.useProgram("debug"),v=ci.disabled,C=Ui.disabled,T=u.colorModeForRenderPass(),F="$debug",z=u.style.map.terrain&&u.style.map.terrain.getTerrainData(n);a.activeTexture.set(o.TEXTURE0);const $=e.getTileByID(n.key).latestRawTileData,ie=Math.floor(($&&$.byteLength||0)/1024),ce=e.getTile(n).tileSize,m=512/Math.min(ce,512)*(n.overscaledZ/u.transform.zoom)*.5;let p=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(p+=` => ${n.overscaledZ}`),function(A,w){A.initDebugOverlayCanvas();const B=A.debugOverlayCanvas,k=A.context.gl,P=A.debugOverlayCanvas.getContext("2d");P.clearRect(0,0,B.width,B.height),P.shadowColor="white",P.shadowBlur=2,P.lineWidth=1.5,P.strokeStyle="white",P.textBaseline="top",P.font="bold 36px Open Sans, sans-serif",P.fillText(w,5,5),P.strokeText(w,5,5),A.debugOverlayTexture.update(B),A.debugOverlayTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE)}(u,`${p} ${ie}kB`),I.draw(a,o.TRIANGLES,v,C,Zi.alphaBlended,Fi.disabled,Rs(h,c.aM.transparent,m),null,F,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),I.draw(a,o.LINE_STRIP,v,C,T,Fi.disabled,Rs(h,c.aM.red),z,F,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function Qo(u,e,n){const a=u.context,o=a.gl,h=u.colorModeForRenderPass(),I=new ci(o.LEQUAL,ci.ReadWrite,u.depthRangeFor3D),v=u.useProgram("terrain"),C=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]);for(const T of n){const F=u.renderToTexture.getTexture(T),z=e.getTerrainData(T.tileID);a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,F.texture);const $=u.transform.calculatePosMatrix(T.tileID.toUnwrapped()),ie=e.getMeshFrameDelta(u.transform.zoom),ce=u.transform.calculateFogMatrix(T.tileID.toUnwrapped()),m=rl($,ie,ce,u.style.sky,u.transform.pitch);v.draw(a,o.TRIANGLES,I,Ui.disabled,h,Fi.backCCW,m,z,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}class Ca{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ko{constructor(e,n){this.context=new ba(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=$t.maxUnderzooming+$t.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new il}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const o of this.style._order)this.style._layers[o].resize()}setup(){const e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,ts.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,ts.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const o=new c.$;o.emplaceBack(0,0,0,0),o.emplaceBack(c.X,0,c.X,0),o.emplaceBack(0,c.X,0,c.X),o.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(o,wr.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,ts.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const I=new c.aZ;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(I);const v=new c.aY;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(v);const C=this.context.gl;this.stencilClearMode=new Ui({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,ci.disabled,this.stencilClearMode,Zi.disabled,Fi.disabled,_r(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,o=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Zi.disabled),a.setDepthMode(ci.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of n){const v=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);h.draw(a,o.TRIANGLES,ci.disabled,new Ui({func:o.ALWAYS,mask:0},v,255,o.KEEP,o.KEEP,o.REPLACE),Zi.disabled,Fi.disabled,_r(I.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Ui({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Ui({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((I,v)=>v.overscaledZ-I.overscaledZ),o=a[a.length-1].overscaledZ,h=a[0].overscaledZ-o+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const I={};for(let v=0;v<h;v++)I[v+o]=new Ui({func:n.GEQUAL,mask:255},v+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[I,a]}return[{[o]:Ui.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Zi([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return ci.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ci(a||this.context.gl.LEQUAL,n,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(fe.now()),this.imageManager.beginFrame();const a=this.style._order,o=this.style.sourceCaches,h={},I={},v={};for(const C in o){const T=o[C];T.used&&T.prepare(this.context),h[C]=T.getVisibleCoordinates(),I[C]=h[C].slice().reverse(),v[C]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<a.length;C++)if(this.style._layers[a[C]].is3D()){this.opaquePassCutoff=C;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const C of a){const T=this.style._layers[C];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const F=I[T.source];(T.type==="custom"||F.length)&&this.renderLayer(this,o[T.source],T,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(C,T){const F=C.context,z=F.gl,$=((A,w,B)=>({u_sky_color:A.properties.get("sky-color"),u_horizon_color:A.properties.get("horizon-color"),u_horizon:(w.height/2+w.getHorizon())*B,u_sky_horizon_blend:A.properties.get("sky-horizon-blend")*w.height/2*B}))(T,C.style.map.transform,C.pixelRatio),ie=new ci(z.LEQUAL,ci.ReadWrite,[0,1]),ce=Ui.disabled,m=C.colorModeForRenderPass(),p=C.useProgram("sky");if(!T.mesh){const A=new c.aX;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1);const w=new c.aY;w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),T.mesh=new Ca(F.createVertexBuffer(A,ts.members),F.createIndexBuffer(w),c.a0.simpleSegment(0,0,A.length,w.length))}p.draw(F,z.TRIANGLES,ie,ce,m,Fi.disabled,$,void 0,"sky",T.mesh.vertexBuffer,T.mesh.indexBuffer,T.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[a[this.currentLayer]],T=o[C.source],F=h[C.source];this._renderTileClippingMasks(C,F),this.renderLayer(this,T,C,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const C=this.style._layers[a[this.currentLayer]],T=o[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const F=(C.type==="symbol"?v:I)[C.source];this._renderTileClippingMasks(C,h[C.source]),this.renderLayer(this,T,C,F)}if(this.options.showTileBoundaries){const C=function(T,F){let z=null;const $=Object.values(T._layers).flatMap(p=>p.source&&!p.isHidden(F)?[T.sourceCaches[p.source]]:[]),ie=$.filter(p=>p.getSource().type==="vector"),ce=$.filter(p=>p.getSource().type!=="vector"),m=p=>{(!z||z.getSource().maxzoom<p.getSource().maxzoom)&&(z=p)};return ie.forEach(p=>m(p)),z||ce.forEach(p=>m(p)),z}(this.style,this.transform.zoom);C&&function(T,F,z){for(let $=0;$<z.length;$++)Kl(T,F,z[$])}(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const T=C.transform.padding;Gr(C,C.transform.height-(T.top||0),3,Bo),Gr(C,T.bottom||0,3,Bi),Yl(C,T.left||0,3,Co),Yl(C,C.transform.width-(T.right||0),3,xc);const F=C.transform.centerPoint;(function(z,$,ie,ce){Eo(z,$-1,ie-10,2,20,ce),Eo(z,$-10,ie-1,20,2,ce)})(C,F.x,C.transform.height-F.y,bl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let o=this.terrainFacilitator.dirty;o||(o=e?!c.a_(n,a):!c.a$(n,a)),o||(o=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),o&&(c.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,I){const v=h.context,C=v.gl,T=Zi.unblended,F=new ci(C.LEQUAL,ci.ReadWrite,[0,1]),z=I.getTerrainMesh(),$=I.sourceCache.getRenderableTiles(),ie=h.useProgram("terrainDepth");v.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),v.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),v.clear({color:c.aM.transparent,depth:1});for(const ce of $){const m=I.getTerrainData(ce.tileID),p={u_matrix:h.transform.calculatePosMatrix(ce.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(h.transform.zoom)};ie.draw(v,C.TRIANGLES,F,Ui.disabled,T,Fi.backCCW,p,m,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,I){const v=h.context,C=v.gl,T=Zi.unblended,F=new ci(C.LEQUAL,ci.ReadWrite,[0,1]),z=I.getTerrainMesh(),$=I.getCoordsTexture(),ie=I.sourceCache.getRenderableTiles(),ce=h.useProgram("terrainCoords");v.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),v.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),v.clear({color:c.aM.transparent,depth:1}),I.coordsIndex=[];for(const m of ie){const p=I.getTerrainData(m.tileID);v.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,$.texture);const A={u_matrix:h.transform.calculatePosMatrix(m.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(h.transform.zoom)};ce.draw(v,C.TRIANGLES,F,Ui.disabled,T,Fi.backCCW,A,p,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),I.coordsIndex.push(m.tileID.key)}v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,o){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(o||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,I,v,C,T){if(h.renderPass!=="translucent")return;const F=Ui.disabled,z=h.colorModeForRenderPass();(v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,ie,ce,m,p,A,w,B,k){const P=ie.transform,S=Ps(),V=p==="map",U=A==="map";for(const q of $){const ne=m.getTile(q),Z=ne.getBucket(ce);if(!Z||!Z.text||!Z.text.segments.get().length)continue;const N=c.ag(Z.textSizeData,P.zoom),se=fi(ne,1,ie.transform.zoom),ue=es(q.posMatrix,U,V,ie.transform,se),ae=ce.layout.get("icon-text-fit")!=="none"&&Z.hasIconData();if(N){const de=Math.pow(2,P.zoom-ne.tileID.overscaledZ),xe=ie.style.map.terrain?(Se,K)=>ie.style.map.terrain.getElevation(q,Se,K):null,be=S.translatePosition(P,ne,w,B);Bs(Z,V,U,k,P,ue,q.posMatrix,de,N,ae,S,be,q.toUnwrapped(),xe)}}}(C,h,v,I,v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),T),v.paint.get("icon-opacity").constantOr(1)!==0&&vo(h,I,v,C,!1,v.paint.get("icon-translate"),v.paint.get("icon-translate-anchor"),v.layout.get("icon-rotation-alignment"),v.layout.get("icon-pitch-alignment"),v.layout.get("icon-keep-upright"),F,z),v.paint.get("text-opacity").constantOr(1)!==0&&vo(h,I,v,C,!0,v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),v.layout.get("text-keep-upright"),F,z),I.map.showCollisionBoxes&&(On(h,I,v,C,!0),On(h,I,v,C,!1))})(e,n,a,o,this.style.placement.variableOffsets);break;case"circle":(function(h,I,v,C){if(h.renderPass!=="translucent")return;const T=v.paint.get("circle-opacity"),F=v.paint.get("circle-stroke-width"),z=v.paint.get("circle-stroke-opacity"),$=!v.layout.get("circle-sort-key").isConstant();if(T.constantOr(1)===0&&(F.constantOr(1)===0||z.constantOr(1)===0))return;const ie=h.context,ce=ie.gl,m=h.depthModeForSublayer(0,ci.ReadOnly),p=Ui.disabled,A=h.colorModeForRenderPass(),w=[];for(let B=0;B<C.length;B++){const k=C[B],P=I.getTile(k),S=P.getBucket(v);if(!S)continue;const V=S.programConfigurations.get(v.id),U=h.useProgram("circle",V),q=S.layoutVertexBuffer,ne=S.indexBuffer,Z=h.style.map.terrain&&h.style.map.terrain.getTerrainData(k),N={programConfiguration:V,program:U,layoutVertexBuffer:q,indexBuffer:ne,uniformValues:Ol(h,k,P,v),terrainData:Z};if($){const se=S.segments.get();for(const ue of se)w.push({segments:new c.a0([ue]),sortKey:ue.sortKey,state:N})}else w.push({segments:S.segments,sortKey:0,state:N})}$&&w.sort((B,k)=>B.sortKey-k.sortKey);for(const B of w){const{programConfiguration:k,program:P,layoutVertexBuffer:S,indexBuffer:V,uniformValues:U,terrainData:q}=B.state;P.draw(ie,ce.TRIANGLES,m,p,A,Fi.disabled,U,q,v.id,S,V,B.segments,v.paint,h.transform.zoom,k)}})(e,n,a,o);break;case"heatmap":(function(h,I,v,C){if(v.paint.get("heatmap-opacity")===0)return;const T=h.context;if(h.style.map.terrain){for(const F of C){const z=I.getTile(F);I.hasRenderableParent(F)||(h.renderPass==="offscreen"?ja(h,z,v,F):h.renderPass==="translucent"&&Cs(h,v,F))}T.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(F,z,$,ie){const ce=F.context,m=ce.gl,p=Ui.disabled,A=new Zi([m.ONE,m.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(w,B,k){const P=w.gl;w.activeTexture.set(P.TEXTURE1),w.viewport.set([0,0,B.width/4,B.height/4]);let S=k.heatmapFbos.get(c.aU);S?(P.bindTexture(P.TEXTURE_2D,S.colorAttachment.get()),w.bindFramebuffer.set(S.framebuffer)):(S=wa(w,B.width/4,B.height/4),k.heatmapFbos.set(c.aU,S))})(ce,F,$),ce.clear({color:c.aM.transparent});for(let w=0;w<ie.length;w++){const B=ie[w];if(z.hasRenderableParent(B))continue;const k=z.getTile(B),P=k.getBucket($);if(!P)continue;const S=P.programConfigurations.get($.id),V=F.useProgram("heatmap",S),{zoom:U}=F.transform;V.draw(ce,m.TRIANGLES,ci.disabled,p,A,Fi.disabled,zr(B.posMatrix,k,U,$.paint.get("heatmap-intensity")),null,$.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,$.paint,F.transform.zoom,S)}ce.viewport.set([0,0,F.width,F.height])}(h,I,v,C):h.renderPass==="translucent"&&function(F,z){const $=F.context,ie=$.gl;$.setColorMode(F.colorModeForRenderPass());const ce=z.heatmapFbos.get(c.aU);ce&&($.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,ce.colorAttachment.get()),$.activeTexture.set(ie.TEXTURE1),xa($,z).bind(ie.LINEAR,ie.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw($,ie.TRIANGLES,ci.disabled,Ui.disabled,F.colorModeForRenderPass(),Fi.disabled,Ua(F,z,0,1),null,z.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,z.paint,F.transform.zoom))}(h,v)})(e,n,a,o);break;case"line":(function(h,I,v,C){if(h.renderPass!=="translucent")return;const T=v.paint.get("line-opacity"),F=v.paint.get("line-width");if(T.constantOr(1)===0||F.constantOr(1)===0)return;const z=h.depthModeForSublayer(0,ci.ReadOnly),$=h.colorModeForRenderPass(),ie=v.paint.get("line-dasharray"),ce=v.paint.get("line-pattern"),m=ce.constantOr(1),p=v.paint.get("line-gradient"),A=v.getCrossfadeParameters(),w=m?"linePattern":ie?"lineSDF":p?"lineGradient":"line",B=h.context,k=B.gl;let P=!0;for(const S of C){const V=I.getTile(S);if(m&&!V.patternsLoaded())continue;const U=V.getBucket(v);if(!U)continue;const q=U.programConfigurations.get(v.id),ne=h.context.program.get(),Z=h.useProgram(w,q),N=P||Z.program!==ne,se=h.style.map.terrain&&h.style.map.terrain.getTerrainData(S),ue=ce.constantOr(null);if(ue&&V.imageAtlas){const xe=V.imageAtlas,be=xe.patternPositions[ue.to.toString()],Se=xe.patternPositions[ue.from.toString()];be&&Se&&q.setConstantPatternPositions(be,Se)}const ae=se?S:null,de=m?pa(h,V,v,A,ae):ie?Ic(h,V,v,ie,A,ae):p?ql(h,V,v,U.lineClipsArray.length,ae):Na(h,V,v,ae);if(m)B.activeTexture.set(k.TEXTURE0),V.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),q.updatePaintBuffers(A);else if(ie&&(N||h.lineAtlas.dirty))B.activeTexture.set(k.TEXTURE0),h.lineAtlas.bind(B);else if(p){const xe=U.gradients[v.id];let be=xe.texture;if(v.gradientVersion!==xe.version){let Se=256;if(v.stepInterpolant){const K=I.getSource().maxzoom,G=S.canonical.z===K?Math.ceil(1<<h.transform.maxZoom-S.canonical.z):1;Se=c.ac(c.aV(U.maxLineLength/c.X*1024*G),256,B.maxTextureSize)}xe.gradient=c.aW({expression:v.gradientExpression(),evaluationKey:"lineProgress",resolution:Se,image:xe.gradient||void 0,clips:U.lineClipsArray}),xe.texture?xe.texture.update(xe.gradient):xe.texture=new bt(B,xe.gradient,k.RGBA),xe.version=v.gradientVersion,be=xe.texture}B.activeTexture.set(k.TEXTURE0),be.bind(v.stepInterpolant?k.NEAREST:k.LINEAR,k.CLAMP_TO_EDGE)}Z.draw(B,k.TRIANGLES,z,h.stencilModeForClipping(S),$,Fi.disabled,de,se,v.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,v.paint,h.transform.zoom,q,U.layoutVertexBuffer2),P=!1}})(e,n,a,o);break;case"fill":(function(h,I,v,C){const T=v.paint.get("fill-color"),F=v.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const z=h.colorModeForRenderPass(),$=v.paint.get("fill-pattern"),ie=h.opaquePassEnabledForLayer()&&!$.constantOr(1)&&T.constantOr(c.aM.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===ie){const ce=h.depthModeForSublayer(1,h.renderPass==="opaque"?ci.ReadWrite:ci.ReadOnly);Ja(h,I,v,C,ce,z,!1)}if(h.renderPass==="translucent"&&v.paint.get("fill-antialias")){const ce=h.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,ci.ReadOnly);Ja(h,I,v,C,ce,z,!0)}})(e,n,a,o);break;case"fill-extrusion":(function(h,I,v,C){const T=v.paint.get("fill-extrusion-opacity");if(T!==0&&h.renderPass==="translucent"){const F=new ci(h.context.gl.LEQUAL,ci.ReadWrite,h.depthRangeFor3D);if(T!==1||v.paint.get("fill-extrusion-pattern").constantOr(1))xo(h,I,v,C,F,Ui.disabled,Zi.disabled),xo(h,I,v,C,F,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const z=h.colorModeForRenderPass();xo(h,I,v,C,F,Ui.disabled,z)}}})(e,n,a,o);break;case"hillshade":(function(h,I,v,C){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const T=h.context,F=h.depthModeForSublayer(0,ci.ReadOnly),z=h.colorModeForRenderPass(),[$,ie]=h.renderPass==="translucent"?h.stencilConfigForOverlap(C):[{},C];for(const ce of ie){const m=I.getTile(ce);m.needsHillshadePrepare!==void 0&&m.needsHillshadePrepare&&h.renderPass==="offscreen"?Vs(h,m,v,F,Ui.disabled,z):h.renderPass==="translucent"&&Ba(h,ce,m,v,F,$[ce.overscaledZ],z)}T.viewport.set([0,0,h.width,h.height])})(e,n,a,o);break;case"raster":(function(h,I,v,C){if(h.renderPass!=="translucent"||v.paint.get("raster-opacity")===0||!C.length)return;const T=h.context,F=T.gl,z=I.getSource(),$=h.useProgram("raster"),ie=h.colorModeForRenderPass(),[ce,m]=z instanceof Kr?[{},C]:h.stencilConfigForOverlap(C),p=m[m.length-1].overscaledZ,A=!h.options.moving;for(const w of m){const B=h.depthModeForSublayer(w.overscaledZ-p,v.paint.get("raster-opacity")===1?ci.ReadWrite:ci.ReadOnly,F.LESS),k=I.getTile(w);k.registerFadeDuration(v.paint.get("raster-fade-duration"));const P=I.findLoadedParent(w,0),S=I.findLoadedSibling(w),V=Il(k,P||S||null,I,v,h.transform,h.style.map.terrain);let U,q;const ne=v.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;T.activeTexture.set(F.TEXTURE0),k.texture.bind(ne,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(F.TEXTURE1),P?(P.texture.bind(ne,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),U=Math.pow(2,P.tileID.overscaledZ-k.tileID.overscaledZ),q=[k.tileID.canonical.x*U%1,k.tileID.canonical.y*U%1]):k.texture.bind(ne,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),k.texture.useMipmap&&T.extTextureFilterAnisotropic&&h.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const Z=h.style.map.terrain&&h.style.map.terrain.getTerrainData(w),N=Z?w:null,se=N?N.posMatrix:h.transform.calculatePosMatrix(w.toUnwrapped(),A),ue=Vl(se,q||[0,0],U||1,V,v);z instanceof Kr?$.draw(T,F.TRIANGLES,B,Ui.disabled,ie,Fi.disabled,ue,Z,v.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments):$.draw(T,F.TRIANGLES,B,ce[w.overscaledZ],ie,Fi.disabled,ue,Z,v.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,a,o);break;case"background":(function(h,I,v,C){const T=v.paint.get("background-color"),F=v.paint.get("background-opacity");if(F===0)return;const z=h.context,$=z.gl,ie=h.transform,ce=ie.tileSize,m=v.paint.get("background-pattern");if(h.isPatternMissing(m))return;const p=!m&&T.a===1&&F===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==p)return;const A=Ui.disabled,w=h.depthModeForSublayer(0,p==="opaque"?ci.ReadWrite:ci.ReadOnly),B=h.colorModeForRenderPass(),k=h.useProgram(m?"backgroundPattern":"background"),P=C||ie.coveringTiles({tileSize:ce,terrain:h.style.map.terrain});m&&(z.activeTexture.set($.TEXTURE0),h.imageManager.bind(h.context));const S=v.getCrossfadeParameters();for(const V of P){const U=C?V.posMatrix:h.transform.calculatePosMatrix(V.toUnwrapped()),q=m?vs(U,F,h,m,{tileID:V,tileSize:ce},S):zs(U,F,T),ne=h.style.map.terrain&&h.style.map.terrain.getTerrainData(V);k.draw(z,$.TRIANGLES,w,A,B,Fi.disabled,q,ne,v.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,a,o);break;case"custom":(function(h,I,v){const C=h.context,T=v.implementation;if(h.renderPass==="offscreen"){const F=T.prerender;F&&(h.setCustomLayerDefaults(),C.setColorMode(h.colorModeForRenderPass()),F.call(T,C.gl,h.transform.customLayerMatrix()),C.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),C.setColorMode(h.colorModeForRenderPass()),C.setStencilMode(Ui.disabled);const F=T.renderingMode==="3d"?new ci(h.context.gl.LEQUAL,ci.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ci.ReadOnly);C.setDepthMode(F),T.render(C.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),C.setDirty(),h.setBaseState(),C.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,o,h){if(!a[0]&&!a[1])return e;const I=h?o==="map"?this.transform.angle:0:o==="viewport"?-this.transform.angle:0;if(I){const T=Math.sin(I),F=Math.cos(I);a=[a[0]*F-a[1]*T,a[0]*T+a[1]*F]}const v=[h?a[0]:fi(n,a[0],this.transform.zoom),h?a[1]:fi(n,a[1],this.transform.zoom),0],C=new Float32Array(16);return c.J(C,e,v),C}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new ho(this.context,Xr[e],n,Gs[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new bt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class Ea{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const o=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const C=1/(v=c.af([],v,e))[3]/n*o;return c.b1(v,v,[C,C,1/v[3],C])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const C=function($,ie){var ce=ie[0],m=ie[1],p=ie[2],A=ce*ce+m*m+p*p;return A>0&&(A=1/Math.sqrt(A)),$[0]=ie[0]*A,$[1]=ie[1]*A,$[2]=ie[2]*A,$}([],function($,ie,ce){var m=ie[0],p=ie[1],A=ie[2],w=ce[0],B=ce[1],k=ce[2];return $[0]=p*k-A*B,$[1]=A*w-m*k,$[2]=m*B-p*w,$}([],ht([],h[v[0]],h[v[1]]),ht([],h[v[2]],h[v[1]]))),T=-((F=C)[0]*(z=h[v[1]])[0]+F[1]*z[1]+F[2]*z[2]);var F,z;return C.concat(T)});return new Ea(h,I)}}class Vn{constructor(e,n){this.min=e,this.max=n,this.center=function(a,o,h){return a[0]=.5*o[0],a[1]=.5*o[1],a[2]=.5*o[2],a}([],function(a,o,h){return a[0]=o[0]+h[0],a[1]=o[1]+h[1],a[2]=o[2]+h[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=lt(this.min),o=lt(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],o[h]=n[h]?this.center[h]:this.max[h];return o[2]=this.max[2],new Vn(a,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let o=0;o<e.planes.length;o++){const h=e.planes[o];let I=0;for(let v=0;v<n.length;v++)c.b2(h,n[v])>=0&&I++;if(I===0)return 0;I!==n.length&&(a=!1)}if(a)return 2;for(let o=0;o<3;o++){let h=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const C=e.points[v][o]-this.min[o];h=Math.min(h,C),I=Math.max(I,C)}if(I<0||h>this.max[o]-this.min[o])return 0}return 1}}class as{constructor(e=0,n=0,a=0,o=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=o}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=c.ac((this.left+e-this.right)/2,0,e),o=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(a,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qa=85.051129;class os{constructor(e,n,a,o,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=o??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new as,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new os(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,o,h){var I=o[0],v=o[1],C=o[2],T=o[3],F=Math.sin(h),z=Math.cos(h);a[0]=I*z+C*F,a[1]=v*z+T*F,a[2]=I*-F+C*z,a[3]=v*-F+T*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),o=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),I=this.pointCoordinate(new c.P(0,this.height)),v=Math.floor(Math.min(a.x,o.x,h.x,I.x)),C=Math.floor(Math.max(a.x,o.x,h.x,I.x)),T=1;for(let F=v-T;F<=C+T;F++)F!==0&&n.push(new c.b4(F,e))}return n}coveringTiles(e){var n,a;let o=this.coveringZoomLevel(e);const h=o;if(e.minzoom!==void 0&&o<e.minzoom)return[];e.maxzoom!==void 0&&o>e.maxzoom&&(o=e.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),v=c.Z.fromLngLat(this.center),C=Math.pow(2,o),T=[C*I.x,C*I.y,0],F=[C*v.x,C*v.y,0],z=Ea.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,o);let $=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=o);const ie=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,ce=B=>({aabb:new Vn([B*C,0,0],[(B+1)*C,C,0]),zoom:0,x:0,y:0,wrap:B,fullyVisible:!1}),m=[],p=[],A=o,w=e.reparseOverscaled?h:o;if(this._renderWorldCopies)for(let B=1;B<=3;B++)m.push(ce(-B)),m.push(ce(B));for(m.push(ce(0));m.length>0;){const B=m.pop(),k=B.x,P=B.y;let S=B.fullyVisible;if(!S){const Z=B.aabb.intersects(z);if(Z===0)continue;S=Z===2}const V=e.terrain?T:F,U=B.aabb.distanceX(V),q=B.aabb.distanceY(V),ne=Math.max(Math.abs(U),Math.abs(q));if(B.zoom===A||ne>ie+(1<<A-B.zoom)-2&&B.zoom>=$){const Z=A-B.zoom,N=T[0]-.5-(k<<Z),se=T[1]-.5-(P<<Z);p.push({tileID:new c.S(B.zoom===A?w:B.zoom,B.wrap,B.zoom,k,P),distanceSq:Gt([F[0]-.5-k,F[1]-.5-P]),tileDistanceToCamera:Math.sqrt(N*N+se*se)})}else for(let Z=0;Z<4;Z++){const N=(k<<1)+Z%2,se=(P<<1)+(Z>>1),ue=B.zoom+1;let ae=B.aabb.quadrant(Z);if(e.terrain){const de=new c.S(ue,B.wrap,ue,N,se),xe=e.terrain.getMinMaxElevation(de),be=(n=xe.minElevation)!==null&&n!==void 0?n:this.elevation,Se=(a=xe.maxElevation)!==null&&a!==void 0?a:this.elevation;ae=new Vn([ae.min[0],ae.min[1],be],[ae.max[0],ae.max[1],Se])}m.push({aabb:ae,zoom:ue,x:N,y:se,wrap:B.wrap,fullyVisible:S})}}return p.sort((B,k)=>B.distanceSq-k.distanceSq).map(B=>B.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=c.ac(e.lat,-85.051129,Qa);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,o=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-h))return;const I=a+n-h,v=Math.cos(this._pitch)*this.cameraToCenterDistance/I/c.b5(1,o.lat),C=this.scaleZoom(v/this.tileSize);this._elevation=h,this._center=o,this.zoom=C}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),o=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),I=new c.Z(h.x-(a.x-o.x),h.y-(a.y-o.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const $=n.pointCoordinate(e);if($!=null)return $}const a=[e.x,e.y,0,1],o=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(o,o,this.pixelMatrixInverse);const h=a[3],I=o[3],v=a[1]/h,C=o[1]/I,T=a[2]/h,F=o[2]/I,z=T===F?0:(0-T)/(F-T);return new c.Z(c.y.number(a[0]/h,o[0]/I,z)/this.worldSize,c.y.number(v,C,z)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const o=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(o,o,a),new c.P(o[0]/o[3],o[1]/o[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new qe().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new qe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Qa])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),o=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[o*a,n.y*a,0]),c.K(h,h,[a/c.X,a/c.X,1]),h}calculatePosMatrix(e,n=!1){const a=e.key,o=n?this._alignedPosMatrixCache:this._posMatrixCache;if(o[a])return o[a];const h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),o[a]=new Float32Array(h),o[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const o=this.calculateTileMatrix(e);return c.L(o,this.fogMatrix,o),a[n]=new Float32Array(o),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:n};let o=this.lngRange;if(!this._renderWorldCopies&&o===null){const B=179.9999999999;o=[-B,B]}const h=this.tileSize*this.zoomScale(a.zoom);let I=0,v=h,C=0,T=h,F=0,z=0;const{x:$,y:ie}=this.size;if(this.latRange){const B=this.latRange;I=c.Q(B[1])*h,v=c.Q(B[0])*h,v-I<ie&&(F=ie/(v-I))}o&&(C=c.b3(c.O(o[0])*h,0,h),T=c.b3(c.O(o[1])*h,0,h),T<C&&(T+=h),T-C<$&&(z=$/(T-C)));const{x:ce,y:m}=this.project.call({worldSize:h},e);let p,A;const w=Math.max(z||0,F||0);if(w){const B=new c.P(z?(T+C)/2:ce,F?(v+I)/2:m);return a.center=this.unproject.call({worldSize:h},B).wrap(),a.zoom+=this.scaleZoom(w),a}if(this.latRange){const B=ie/2;m-B<I&&(A=I+B),m+B>v&&(A=v-B)}if(o){const B=(C+T)/2;let k=ce;this._renderWorldCopies&&(k=c.b3(ce,B-h/2,B+h/2));const P=$/2;k-P<C&&(p=C+P),k+P>T&&(p=T-P)}if(p!==void 0||A!==void 0){const B=new c.P(p??ce,A??m);a.center=this.unproject.call({worldSize:h},B).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let o=c.an(new Float64Array(16));c.K(o,o,[this.width/2,-this.height/2,1]),c.J(o,o,[1,-1,0]),this.labelPlaneMatrix=o,o=c.an(new Float64Array(16)),c.K(o,o,[1,-1,1]),c.J(o,o,[-1,-1,0]),c.K(o,o,[2/this.width,2/this.height,1]),this.glCoordMatrix=o;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this.minElevationForCurrentTile),v=h-I*this._pixelPerMeter/Math.cos(this._pitch),C=I<0?v:h,T=Math.PI/2+this._pitch,F=this._fov*(.5+e.y/this.height),z=Math.sin(F)*C/Math.sin(c.ac(Math.PI-T-F,.01,Math.PI-.01)),$=this.getHorizon(),ie=2*Math.atan($/this.cameraToCenterDistance)*(.5+e.y/(2*$)),ce=Math.sin(ie)*C/Math.sin(c.ac(Math.PI-T-ie,.01,Math.PI-.01)),m=Math.min(z,ce);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*m+C),this.nearZ=this.height/50,o=new Float64Array(16),c.b6(o,this._fov,this.width/this.height,this.nearZ,this.farZ),o[8]=2*-e.x/this.width,o[9]=2*e.y/this.height,this.projectionMatrix=c.ae(o),c.K(o,o,[1,-1,1]),c.J(o,o,[0,0,-this.cameraToCenterDistance]),c.b7(o,o,this._pitch),c.ad(o,o,this.angle),c.J(o,o,[-n,-a,0]),this.mercatorMatrix=c.K([],o,[this.worldSize,this.worldSize,this.worldSize]),c.K(o,o,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,o),c.J(o,o,[0,0,-this.elevation]),this.modelViewProjectionMatrix=o,this.invModelViewProjectionMatrix=c.as([],o),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,o);const p=this.width%2/2,A=this.height%2/2,w=Math.cos(this.angle),B=Math.sin(this.angle),k=n-Math.round(n)+w*p+B*A,P=a-Math.round(a)+w*A+B*p,S=new Float64Array(o);if(c.J(S,S,[k>.5?k-1:k,P>.5?P-1:P,0]),this.alignedModelViewProjectionMatrix=S,o=c.as(new Float64Array(16),this.pixelMatrix),!o)throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,o=n.y,h=n.x,I=n.y;for(const v of e)a=Math.min(a,v.x),o=Math.min(o,v.y),h=Math.max(h,v.x),I=Math.max(I,v.y);return[new c.P(a,o),new c.P(h,o),new c.P(h,I),new c.P(a,I),new c.P(a,o)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),o=[a.x*this.worldSize,a.y*this.worldSize,n,1];return c.af(o,o,this.modelViewProjectionMatrix),o[2]/o[3]}}function Es(u,e){let n,a=!1,o=null,h=null;const I=()=>{o=null,a&&(u.apply(h,n),o=setTimeout(I,e),a=!1)};return(...v)=>(a=!0,h=this,n=v,o||I(),o)}class Hs{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(a=o)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let o=a;o.split("&").length>0&&(o=o.split("&")[0]),this._hashName&&(o=`${this._hashName}=${a}`);let h=window.location.hash.replace(o,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let I=window.location.href.replace(/(#.+)?$/,h);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Es(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,o=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,o),I=Math.round(n.lng*h)/h,v=Math.round(n.lat*h)/h,C=this._map.getBearing(),T=this._map.getPitch();let F="";if(F+=e?`/${I}/${v}/${a}`:`${a}/${v}/${I}`,(C||T)&&(F+="/"+Math.round(10*C)/10),T&&(F+=`/${Math.round(T)}`),this._hashName){const z=this._hashName;let $=!1;const ie=window.location.hash.slice(1).split("&").map(ce=>{const m=ce.split("=")[0];return m===z?($=!0,`${m}=${F}`):ce}).filter(ce=>ce);return $||ie.push(`${z}=${F}`),`#${ie.join("&")}`}return`#${F}`}}const js={linearity:.3,easing:c.b8(0,0,.3,1)},Qs=c.e({deceleration:2500,maxSpeed:1400},js),So=c.e({deceleration:20,maxSpeed:1400},js),vl=c.e({deceleration:1e3,maxSpeed:360},js),Do=c.e({deceleration:1e3,maxSpeed:90},js);class wl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:fe.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=fe.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(n.pan.mag()){const h=Ka(n.pan.mag(),a,c.e({},Qs,e||{}));o.offset=n.pan.mult(h.amount/n.pan.mag()),o.center=this._map.transform.center,Ya(o,h)}if(n.zoom){const h=Ka(n.zoom,a,So);o.zoom=this._map.transform.zoom+h.amount,Ya(o,h)}if(n.bearing){const h=Ka(n.bearing,a,vl);o.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),Ya(o,h)}if(n.pitch){const h=Ka(n.pitch,a,Do);o.pitch=this._map.transform.pitch+h.amount,Ya(o,h)}if(o.zoom||o.bearing){const h=n.pinchAround===void 0?n.around:n.pinchAround;o.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(o,{noMoveStart:!0})}}function Ya(u,e){(!u.duration||u.duration<e.duration)&&(u.duration=e.duration,u.easing=e.easing)}function Ka(u,e,n){const{maxSpeed:a,linearity:o,deceleration:h}=n,I=c.ac(u*o/(e/1e3),-a,a),v=Math.abs(I)/(h*o);return{easing:n.easing,duration:1e3*v,amount:I*(v/2)}}class ir extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,o={}){const h=oe.mousePos(n.getCanvas(),a),I=n.unproject(h);super(e,c.e({point:h,lngLat:I,originalEvent:a},o)),this._defaultPrevented=!1,this.target=n}}class Js extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const o=e==="touchend"?a.changedTouches:a.touches,h=oe.touchPos(n.getCanvasContainer(),o),I=h.map(C=>n.unproject(C)),v=h.reduce((C,T,F,z)=>C.add(T.div(z.length)),new c.P(0,0));super(e,{points:h,point:v,lngLats:I,lngLat:n.unproject(v),originalEvent:a}),this._defaultPrevented=!1}}class Zl extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class $l{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Zl(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new ir(e.type,this._map,e))}mouseup(e){this._map.fire(new ir(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ir(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ir(e.type,this._map,e))}mouseover(e){this._map.fire(new ir(e.type,this._map,e))}mouseout(e){this._map.fire(new ir(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Js(e.type,this._map,e))}touchmove(e){this._map.fire(new Js(e.type,this._map,e))}touchend(e){this._map.fire(new Js(e.type,this._map,e))}touchcancel(e){this._map.fire(new Js(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ir(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ir(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class tn{constructor(e,n){this._map=e,this._tr=new Bn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(oe.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const o=this._startPos;this._lastPos=a,this._box||(this._box=oe.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(o.x,a.x),I=Math.max(o.x,a.x),v=Math.min(o.y,a.y),C=Math.max(o.y,a.y);oe.setTransform(this._box,`translate(${h}px,${v}px)`),this._box.style.width=I-h+"px",this._box.style.height=C-v+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,o=n;if(this.reset(),oe.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(oe.remove(this._box),this._box=null),oe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function Za(u,e){if(u.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${e.length}`);const n={};for(let a=0;a<u.length;a++)n[u[a].identifier]=e[a];return n}class $a{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(o){const h=new c.P(0,0);for(const I of o)h._add(I);return h.div(o.length)}(n),this.touches=Za(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const o=Za(a,n);for(const h in this.touches){const I=o[h];(!I||I.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class Mo{constructor(e){this.singleTap=new $a(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const o=this.singleTap.touchend(e,n,a);if(o){const h=e.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(o)<30;if(h&&I||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class Sr{constructor(e){this._tr=new Bn(e),this._zoomIn=new Mo({numTouches:1,numTaps:2}),this._zoomOut=new Mo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const o=this._zoomIn.touchend(e,n,a),h=this._zoomOut.touchend(e,n,a),I=this._tr;return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(o)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const o=n.length?n[0]:n;return!this._moved&&o.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=o,this._move(a,o))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&oe.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const To={0:1,2:2};class Po{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=oe.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const o=To[a];return n.buttons===void 0||(n.buttons&o)!==o}(e,this._eventButton)}isValidEndEvent(e){return oe.mouseButton(e)===this._eventButton}}class Lo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Wa=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=e=>{e.preventDefault()}},Ys=({enable:u,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new Po({checkCorrectEvent:o=>oe.mouseButton(o)===0&&o.ctrlKey||oe.mouseButton(o)===2});return new Cn({clickTolerance:e,move:(o,h)=>({bearingDelta:(h.x-o.x)*n}),moveStateManager:a,enable:u,assignEvents:Wa})},Xa=({enable:u,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new Po({checkCorrectEvent:o=>oe.mouseButton(o)===0&&o.ctrlKey||oe.mouseButton(o)===2});return new Cn({clickTolerance:e,move:(o,h)=>({pitchDelta:(h.y-o.y)*n}),moveStateManager:a,enable:u,assignEvents:Wa})};class Ks{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const o=Za(a,n),h=new c.P(0,0),I=new c.P(0,0);let v=0;for(const T in o){const F=o[T],z=this._touches[T];z&&(h._add(F),I._add(F.sub(z)),v++,o[T]=F)}if(this._touches=o,this._shouldBePrevented(v)||!I.mag())return;const C=I.div(v);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(v),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[o,h]=this._firstTwoTouches,I=eo(a,n,o),v=eo(a,n,h);if(!I||!v)return;const C=this._aroundCenter?null:I.add(v).div(2);return this._move([I,v],C,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[o,h]=this._firstTwoTouches,I=eo(a,n,o),v=eo(a,n,h);I&&v||(this._active&&oe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function eo(u,e,n){for(let a=0;a<u.length;a++)if(u[a].identifier===n)return e[a]}function ka(u,e){return Math.log(u/e)/Math.LN2}class xl extends Zs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ka(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ka(this._distance,a),pinchAround:n}}}function Bl(u,e){return 180*u.angleWith(e)/Math.PI}class Cl extends Zs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const o=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bl(this._vector,o),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Bl(e,this._startVector);return Math.abs(a)<n}}function Ro(u){return Math.abs(u.y)>Math.abs(u.x)}class ls extends Zs{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,Ro(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const o=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(o,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const o=e.mag()>=2,h=n.mag()>=2;if(!o&&!h)return;if(!o||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const I=e.y>0==n.y>0;return Ro(e)&&Ro(n)&&I}}const El={panStep:100,bearingStep:15,pitchStep:10};class An{constructor(e){this._tr=new Bn(e);const n=El;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,o=0,h=0,I=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),I=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(a=0,o=0),{cameraAnimation:v=>{const C=this._tr;v.easeTo({duration:300,easeId:"keyboardHandler",easing:rn,zoom:n?Math.round(C.zoom)+n*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+a*this._bearingStep,pitch:C.pitch+o*this._pitchStep,offset:[-h*this._panStep,-I*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rn(u){return u*(2-u)}const cs=4.000244140625;class En{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new Bn(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=fe.now(),o=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%cs==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=oe.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(n)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>cs?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&T!==0&&(T=1/T);const F=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(F*T))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,o=this._easing;let h,I=!1;const v=fe.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&o&&v){const C=Math.min(v/200,1),T=o(C);h=c.y.number(a,n,T),C<1?this._frameId||(this._frameId=!0):I=!0}else h=n,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){const a=this._prevEase,o=(fe.now()-a.start)/a.duration,h=a.easing(o+.01)-a.easing(o),I=.27/Math.sqrt(h*h+1e-4)*.01,v=Math.sqrt(.0729-I*I);n=c.b8(I,v,.25,1)}return this._prevEase={start:fe.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class $s{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dn{constructor(e){this._tr=new Bn(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl{constructor(){this._tap=new Mo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const o=n[0],h=e.timeStamp-this._tapTime<500,I=this._tapPoint.dist(o)<30;h&&I?a.length>0&&(this._swipePoint=o,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const o=n[0],h=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const o=this._tap.touchend(e,n,a);o&&(this._tapTime=e.timeStamp,this._tapPoint=o)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xl{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fo{constructor(e,n,a,o){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class hs{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=oe.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),o=document.createElement("div");o.className="maplibregl-desktop-message",o.textContent=n,this._container.appendChild(o);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(oe.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Dr=u=>u.zoom||u.drag||u.pitch||u.rotate;class Bt extends c.k{}function Sa(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class to{constructor(e,n){this.handleWindowEvent=o=>{this.handleEvent(o,`${o.type}Window`)},this.handleEvent=(o,h)=>{if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=o.type==="renderFrame"?void 0:o,v={needsRenderFrame:!1},C={},T={},F=o.touches,z=F?this._getMapTouches(F):void 0,$=z?oe.touchPos(this._map.getCanvas(),z):oe.mousePos(this._map.getCanvas(),o);for(const{handlerName:m,handler:p,allowed:A}of this._handlers){if(!p.isEnabled())continue;let w;this._blockedByActive(T,A,m)?p.reset():p[h||o.type]&&(w=p[h||o.type](o,$,z),this.mergeHandlerResult(v,C,w,m,I),w&&w.needsRenderFrame&&this._triggerRenderFrame()),(w||p.isActive())&&(T[m]=p)}const ie={};for(const m in this._previousActiveHandlers)T[m]||(ie[m]=I);this._previousActiveHandlers=T,(Object.keys(ie).length||Sa(v))&&(this._changes.push([v,C,ie]),this._triggerRenderFrame()),(Object.keys(T).length||Sa(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ce}=v;ce&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ce(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wl(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[o,h,I]of this._listeners)oe.addEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[e,n,a]of this._listeners)oe.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new $l(n,e));const o=n.boxZoom=new tn(n,e);this._add("boxZoom",o),e.interactive&&e.boxZoom&&o.enable();const h=n.cooperativeGestures=new hs(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const I=new Sr(n),v=new dn(n);n.doubleClickZoom=new $s(v,I),this._add("tapZoom",I),this._add("clickZoom",v),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const C=new Wl;this._add("tapDragZoom",C);const T=n.touchPitch=new ls(n);this._add("touchPitch",T),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const F=Ys(e),z=Xa(e);n.dragRotate=new Xl(e,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const $=(({enable:w,clickTolerance:B})=>{const k=new Po({checkCorrectEvent:P=>oe.mouseButton(P)===0&&!P.ctrlKey});return new Cn({clickTolerance:B,move:(P,S)=>({around:S,panDelta:S.sub(P)}),activateOnStart:!0,moveStateManager:k,enable:w,assignEvents:Wa})})(e),ie=new Ks(e,n);n.dragPan=new Ql(a,$,ie),this._add("mousePan",$),this._add("touchPan",ie,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const ce=new Cl,m=new xl;n.touchZoomRotate=new Fo(a,m,ce,C),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",m,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const p=n.scrollZoom=new En(n,()=>this._triggerRenderFrame());this._add("scrollZoom",p,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const A=n.keyboard=new An(n);this._add("keyboard",A),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Xi(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const o in e)if(o!==a&&(!n||n.indexOf(o)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,o,h){if(!a)return;c.e(e,a);const I={handlerName:o,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(n.zoom=I),a.panDelta!==void 0&&(n.drag=I),a.pitchDelta!==void 0&&(n.pitch=I),a.bearingDelta!==void 0&&(n.rotate=I)}_applyChanges(){const e={},n={},a={};for(const[o,h,I]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),o.around!==void 0&&(e.around=o.around),o.pinchAround!==void 0&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),c.e(n,h),c.e(a,I);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const o=this._map,h=o._getTransformForUpdate(),I=o.terrain;if(!(Sa(e)||I&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:v,zoomDelta:C,bearingDelta:T,pitchDelta:F,around:z,pinchAround:$}=e;$!==void 0&&(z=$),o._stop(!0),z=z||o.transform.centerPoint;const ie=h.pointLocation(v?z.sub(v):z);T&&(h.bearing+=T),F&&(h.pitch+=F),C&&(h.zoom+=C),I?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(v)):h.setLocationAtPoint(ie,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(ie,z)):h.setLocationAtPoint(ie,z),o._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const o=Dr(this._eventsInProgress),h=Dr(e),I={};for(const z in e){const{originalEvent:$}=e[z];this._eventsInProgress[z]||(I[`${z}start`]=$),this._eventsInProgress[z]=e[z]}!o&&h&&this._fireEvent("movestart",h.originalEvent);for(const z in I)this._fireEvent(z,I[z]);h&&this._fireEvent("move",h.originalEvent);for(const z in e){const{originalEvent:$}=e[z];this._fireEvent(z,$)}const v={};let C;for(const z in this._eventsInProgress){const{handlerName:$,originalEvent:ie}=this._eventsInProgress[z];this._handlersById[$].isActive()||(delete this._eventsInProgress[z],C=n[$]||ie,v[`${z}end`]=C)}for(const z in v)this._fireEvent(z,v[z]);const T=Dr(this._eventsInProgress),F=(o||h)&&!T;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=ie=>ie!==0&&-this._bearingSnap<ie&&ie<this._bearingSnap;!z||!z.essential&&fe.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:C})),$(this._map.getBearing())&&this._map.resetNorth()):($(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Bt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class io extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((fe.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(c.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(c.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(c.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=qe.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,o){const h={top:0,bottom:0,right:0,left:0};if(typeof(o=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const Z=o.padding;o.padding={top:Z,bottom:Z,right:Z,left:Z}}o.padding=c.e(h,o.padding);const I=this.transform,v=I.padding,C=new qe(e,n),T=I.project(C.getNorthWest()),F=I.project(C.getNorthEast()),z=I.project(C.getSouthEast()),$=I.project(C.getSouthWest()),ie=c.ba(-a),ce=T.rotate(ie),m=F.rotate(ie),p=z.rotate(ie),A=$.rotate(ie),w=new c.P(Math.max(ce.x,m.x,A.x,p.x),Math.max(ce.y,m.y,A.y,p.y)),B=new c.P(Math.min(ce.x,m.x,A.x,p.x),Math.min(ce.y,m.y,A.y,p.y)),k=w.sub(B),P=(I.width-(v.left+v.right+o.padding.left+o.padding.right))/k.x,S=(I.height-(v.top+v.bottom+o.padding.top+o.padding.bottom))/k.y;if(S<0||P<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const V=Math.min(I.scaleZoom(I.scale*Math.min(P,S)),o.maxZoom),U=c.P.convert(o.offset),q=new c.P((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(c.ba(a)),ne=U.add(q).mult(I.scale/I.zoomScale(V));return{center:I.unproject(T.add(z).div(2).sub(ne)),zoom:V,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,o,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),a,o),o,h)}_fitInternal(e,n,a){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let o=!1,h=!1,I=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(o=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(h=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(I=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),o&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),I&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,o=0){const h=c.Z.fromLngLat(e,n),I=c.Z.fromLngLat(a,o),v=I.x-h.x,C=I.y-h.y,T=I.z-h.z,F=Math.hypot(v,C,T);if(F===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(v,C),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),ie=180*Math.atan2(v,-C)/Math.PI;let ce=180*Math.acos(z/F)/Math.PI;return ce=T<0?90-ce:90+ce,{center:I.toLngLat(),zoom:$,pitch:ce,bearing:ie}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&fe.prefersReducedMotion)&&(e.duration=0);const o=this._getTransformForUpdate(),h=o.zoom,I=o.bearing,v=o.pitch,C=o.padding,T="bearing"in e?this._normalizeBearing(e.bearing,I):I,F="pitch"in e?+e.pitch:v,z="padding"in e?e.padding:o.padding,$=c.P.convert(e.offset);let ie=o.centerPoint.add($);const ce=o.pointLocation(ie),{center:m,zoom:p}=o.getConstrained(c.N.convert(e.center||ce),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(m,o);const A=o.project(ce),w=o.project(m).sub(A),B=o.zoomScale(p-h);let k,P;e.around&&(k=c.N.convert(e.around),P=o.locationPoint(k));const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||p!==h,this._rotating=this._rotating||I!==T,this._pitching=this._pitching||F!==v,this._padding=!o.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,S),this.terrain&&this._prepareElevation(m),this._ease(V=>{if(this._zooming&&(o.zoom=c.y.number(h,p,V)),this._rotating&&(o.bearing=c.y.number(I,T,V)),this._pitching&&(o.pitch=c.y.number(v,F,V)),this._padding&&(o.interpolatePadding(C,z,V),ie=o.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(V),k)o.setLocationAtPoint(k,P);else{const U=o.zoomScale(o.zoom-h),q=p>h?Math.min(2,B):Math.max(.5,B),ne=Math.pow(q,1-V),Z=o.unproject(A.add(w.mult(V*ne)).mult(U));o.setLocationAtPoint(o.renderWorldCopies?Z.wrap():Z,ie)}this._applyUpdatedTransform(o),this._fireMoveEvents(n)},V=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,V)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const o=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:o.pitch,zoom:o.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(o=>this._elevateCameraIfInsideTerrain(o)),this.transformCameraUpdate&&n.push(o=>this.transformCameraUpdate(o)),!n.length)return;const a=e.clone();for(const o of n){const h=a.clone(),{center:I,zoom:v,pitch:C,bearing:T,elevation:F}=o(h);I&&(h.center=I),v!==void 0&&(h.zoom=v),C!==void 0&&(h.pitch=C),T!==void 0&&(h.bearing=T),F!==void 0&&(h.elevation=F),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,o=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),o&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&fe.prefersReducedMotion){const de=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(de,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const o=this._getTransformForUpdate(),h=o.zoom,I=o.bearing,v=o.pitch,C=o.padding,T="bearing"in e?this._normalizeBearing(e.bearing,I):I,F="pitch"in e?+e.pitch:v,z="padding"in e?e.padding:o.padding,$=c.P.convert(e.offset);let ie=o.centerPoint.add($);const ce=o.pointLocation(ie),{center:m,zoom:p}=o.getConstrained(c.N.convert(e.center||ce),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(m,o);const A=o.zoomScale(p-h),w=o.project(ce),B=o.project(m).sub(w);let k=e.curve;const P=Math.max(o.width,o.height),S=P/A,V=B.mag();if("minZoom"in e){const de=c.ac(Math.min(e.minZoom,h,p),o.minZoom,o.maxZoom),xe=P/o.zoomScale(de-h);k=Math.sqrt(xe/V*2)}const U=k*k;function q(de){const xe=(S*S-P*P+(de?-1:1)*U*U*V*V)/(2*(de?S:P)*U*V);return Math.log(Math.sqrt(xe*xe+1)-xe)}function ne(de){return(Math.exp(de)-Math.exp(-de))/2}function Z(de){return(Math.exp(de)+Math.exp(-de))/2}const N=q(!1);let se=function(de){return Z(N)/Z(N+k*de)},ue=function(de){return P*((Z(N)*(ne(xe=N+k*de)/Z(xe))-ne(N))/U)/V;var xe},ae=(q(!0)-N)/k;if(Math.abs(V)<1e-6||!isFinite(ae)){if(Math.abs(P-S)<1e-6)return this.easeTo(e,n);const de=S<P?-1:1;ae=Math.abs(Math.log(S/P))/k,ue=()=>0,se=xe=>Math.exp(de*k*xe)}return e.duration="duration"in e?+e.duration:1e3*ae/("screenSpeed"in e?+e.screenSpeed/k:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=I!==T,this._pitching=F!==v,this._padding=!o.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(m),this._ease(de=>{const xe=de*ae,be=1/se(xe);o.zoom=de===1?p:h+o.scaleZoom(be),this._rotating&&(o.bearing=c.y.number(I,T,de)),this._pitching&&(o.pitch=c.y.number(v,F,de)),this._padding&&(o.interpolatePadding(C,z,de),ie=o.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(de);const Se=de===1?m:o.unproject(w.add(B.mult(ue(xe))).mult(be));o.setLocationAtPoint(o.renderWorldCopies?Se.wrap():Se,ie),this._applyUpdatedTransform(o),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=fe.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const us={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ks{constructor(e=us){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=oe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=oe.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){oe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(o=>typeof o!="string"?"":o)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}const n=this._map.style.sourceCaches;for(const o in n){const h=n[o];if(h.used||h.usedForTerrain){const I=h.getSource();I.attribution&&e.indexOf(I.attribution)<0&&e.push(I.attribution)}}e=e.filter(o=>String(o).trim()),e.sort((o,h)=>o.length-h.length),e=e.filter((o,h)=>{for(let I=h+1;I<e.length;I++)if(e[I].indexOf(o)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qi{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=oe.create("div","maplibregl-ctrl");const n=oe.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){oe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class gi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const o of a)if(o.id===e)return void(o.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var kl=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ws extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const o of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[o.key]=!0,this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),c.aP(o.posMatrix,0,c.X,0,c.X,0,1),this._tiles[o.key]=new hn(o,this.tileSize));for(const o in this._tiles)a[o]||delete this._tiles[o]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const o=this._tiles[a].tileID;if(o.canonical.equals(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[a]=h}else if(o.canonical.isChildOf(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const I=o.canonical.z-e.canonical.z,v=o.canonical.x-(o.canonical.x>>I<<I),C=o.canonical.y-(o.canonical.y>>I<<I),T=c.X>>I;c.aP(h.posMatrix,0,T,0,T,0,1),c.J(h.posMatrix,h.posMatrix,[-v*T,-C*T,0]),n[a]=h}else if(e.canonical.isChildOf(o.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const I=e.canonical.z-o.canonical.z,v=e.canonical.x-(e.canonical.x>>I<<I),C=e.canonical.y-(e.canonical.y>>I<<I),T=c.X>>I;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[v*T,C*T,0]),c.K(h.posMatrix,h.posMatrix,[1/2**I,1/2**I,0]),n[a]=h}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let o=e.overscaledZ-this.deltaZoom;if(o>a.maxzoom&&(o=a.maxzoom),o<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(o).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;o>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(o--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class zo{constructor(e,n,a){this.painter=e,this.sourceCache=new Ws(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,o=c.X){var h;if(!(n>=0&&n<o&&a>=0&&a<o))return 0;const I=this.getTerrainData(e),v=(h=I.tile)===null||h===void 0?void 0:h.dem;if(!v)return 0;const C=function(ce,m,p){var A=m[0],w=m[1];return ce[0]=p[0]*A+p[4]*w+p[12],ce[1]=p[1]*A+p[5]*w+p[13],ce}([],[n/o*c.X,a/o*c.X],I.u_terrain_matrix),T=[C[0]*v.dim,C[1]*v.dim],F=Math.floor(T[0]),z=Math.floor(T[1]),$=T[0]-F,ie=T[1]-z;return v.get(F,z)*(1-$)*(1-ie)+v.get(F+1,z)*$*(1-ie)+v.get(F,z+1)*(1-$)*ie+v.get(F+1,z+1)*$*ie}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:o,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,o%c.X,h%c.X,c.X)}getElevation(e,n,a,o=c.X){return this.getDEMElevation(e,n,a,o)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const o=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new bt(o,h,o.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new bt(o,new c.R({width:1,height:1}),o.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const o=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new bt(o,n.dem.getPixels(),o.gl.RGBA,{premultiply:!1}),n.demTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const o=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=o?h=e.canonical.z-o:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=e.canonical.x-(e.canonical.x>>h<<h),v=e.canonical.y-(e.canonical.y>>h<<h),C=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(C,C,[I*c.X,v*c.X,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,o=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===o||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new bt(n.context,{width:a,height:o,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new bt(n.context,{width:a,height:o,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,o,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,o))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,I=0;h<this._coordsTextureSize;h++)for(let v=0;v<this._coordsTextureSize;v++,I+=4)n[I+0]=255&v,n[I+1]=255&h,n[I+2]=v>>8<<4|h>>8,n[I+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),o=new bt(e,a,e.gl.RGBA,{premultiply:!1});return o.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=o,o}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,o=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),v=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),o.readPixels(h,v-I-1,1,1,o.RGBA,o.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const C=n[0]+(n[2]>>4<<8),T=n[1]+((15&n[2])<<8),F=this.coordsIndex[255-n[3]],z=F&&this.sourceCache.getTileByID(F);if(!z)return null;const $=this._coordsTextureSize,ie=(1<<z.tileID.canonical.z)*$;return new c.Z((z.tileID.canonical.x*$+C)/ie+z.tileID.wrap,(z.tileID.canonical.y*$+T)/ie,this.getElevation(z.tileID,C,T,$))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,o=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),o.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,o.RGBA,o.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new c.bd,a=new c.aY,o=this.meshSize,h=c.X/o,I=o*o;for(let z=0;z<=o;z++)for(let $=0;$<=o;$++)n.emplaceBack($*h,z*h,0);for(let z=0;z<I;z+=o+1)for(let $=0;$<o;$++)a.emplaceBack($+z,o+$+z+1,o+$+z+2),a.emplaceBack($+z,o+$+z+2,$+z+1);const v=n.length,C=v+2*(o+1);for(const z of[0,1])for(let $=0;$<=o;$++)for(const ie of[0,1])n.emplaceBack($*h,z*c.X,ie);for(let z=0;z<2*o;z+=2)a.emplaceBack(C+z,C+z+1,C+z+3),a.emplaceBack(C+z,C+z+3,C+z+2),a.emplaceBack(v+z,v+z+3,v+z+1),a.emplaceBack(v+z,v+z+2,v+z+3);const T=n.length,F=T+2*(o+1);for(const z of[0,1])for(let $=0;$<=o;$++)for(const ie of[0,1])n.emplaceBack(z*c.X,$*h,ie);for(let z=0;z<2*o;z+=2)a.emplaceBack(T+z,T+z+1,T+z+3),a.emplaceBack(T+z,T+z+3,T+z+2),a.emplaceBack(F+z,F+z+3,F+z+1),a.emplaceBack(F+z,F+z+2,F+z+3);return this._mesh=new Ca(e.createVertexBuffer(n,kl.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:o}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(o).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=c.Z.fromLngLat(e.wrap()),o=(1<<n)*c.X,h=a.x*o,I=a.y*o,v=Math.floor(h/c.X),C=Math.floor(I/c.X);return{tileID:new c.S(n,0,n,v,C),mercatorX:h,mercatorY:I}}}class ec{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new bt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Xs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Sl{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new ec(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const o=e.sourceCaches[a].getVisibleCoordinates();for(const h of o){const I=this.terrain.sourceCache.getTerrainCoords(h);for(const v in I)this._coordsDescendingInv[a][v]||(this._coordsDescendingInv[a][v]=[]),this._coordsDescendingInv[a][v].push(I[v])}}this._coordsDescendingInvStr={};for(const a of e._order){const o=e._layers[a],h=o.source;if(Xs[o.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const I in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][I]=this._coordsDescendingInv[h][I].map(v=>v.key).sort().join()}}for(const a of this._renderableTiles)for(const o in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[o][a.tileID.key];h&&h!==a.rttCoords[o]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Xs[n]&&(this._prevType&&Xs[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!o))return!0;if(Xs[this._prevType]||Xs[n]&&o){this._prevType=n;const h=this._stacks.length-1,I=this._stacks[h]||[];for(const v of this._renderableTiles){if(this.pool.isFull()&&(Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(v),v.rtt[h]){const T=this.pool.getObjectForId(v.rtt[h].id);if(T.stamp===v.rtt[h].stamp){this.pool.useObject(T);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),v.rtt[h]={id:C.id,stamp:C.stamp},a.context.bindFramebuffer.set(C.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let T=0;T<I.length;T++){const F=a.style._layers[I[T]],z=F.source?this._coordsDescendingInv[F.source][v.tileID.key]:[v.tileID];a.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),a._renderTileClippingMasks(F,z),a.renderLayer(a,a.style.sourceCaches[F.source],F,z),F.source&&(v.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][v.tileID.key])}}return Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Xs[n]}return!1}}const ro={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Go=X,tc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:us,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Dl=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},ic={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bc{constructor(e,n,a=!1){this.mousedown=I=>{this.startMouse(c.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),oe.mousePos(this.element,I)),oe.addEventListener(window,"mousemove",this.mousemove),oe.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,oe.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oe.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),oe.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=oe.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const o=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Ys({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:v,bearingDegreesPerPixelMoved:C=.8})=>{const T=new Lo;return new Cn({clickTolerance:v,move:(F,z)=>({bearingDelta:(z.x-F.x)*C}),moveStateManager:T,enable:I,assignEvents:Dl})})({clickTolerance:o,enable:!0}),this.map=e,a&&(this.mousePitch=Xa({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:v,pitchDegreesPerPixelMoved:C=-.5})=>{const T=new Lo;return new Cn({clickTolerance:v,move:(F,z)=>({pitchDelta:(z.y-F.y)*C}),moveStateManager:T,enable:I,assignEvents:Dl})})({clickTolerance:h,enable:!0})),oe.addEventListener(n,"mousedown",this.mousedown),oe.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),oe.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),oe.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),oe.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:o}=this.mouseRotate.dragMove(e,n)||{};if(o&&a.setBearing(a.getBearing()+o),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(e,n){const a=this.map,{bearingDelta:o}=this.touchRotate.dragMove(e,n)||{};if(o&&a.setBearing(a.getBearing()+o),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const e=this.element;oe.removeEventListener(e,"mousedown",this.mousedown),oe.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),oe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.removeEventListener(window,"touchend",this.touchend),oe.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){oe.enableDrag(),oe.removeEventListener(window,"mousemove",this.mousemove),oe.removeEventListener(window,"mouseup",this.mouseup),oe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),oe.removeEventListener(window,"touchend",this.touchend)}}let rr;function Vi(u,e,n){const a=new c.N(u.lng,u.lat);if(u=new c.N(u.lng,u.lat),e){const o=new c.N(u.lng-360,u.lat),h=new c.N(u.lng+360,u.lat),I=n.locationPoint(u).distSqr(e);n.locationPoint(o).distSqr(e)<I?u=o:n.locationPoint(h).distSqr(e)<I&&(u=h)}for(;Math.abs(u.lng-n.center.lng)>180;){const o=n.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u.lng!==a.lng&&n.locationPoint(u).y>n.height/2-n.getHorizon()?u:a}const ea={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Uo(u,e,n){const a=u.classList;for(const o in ea)a.remove(`maplibregl-${n}-anchor-${o}`);a.add(`maplibregl-${n}-anchor-${e}`)}class No extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,o=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&o!==32&&o!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,o=this._element;this._popup&&(a===o||o.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!o)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Vi(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),oe.setTransform(this._element,`${ea[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${h}`),fe.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe.create("div");const n=oe.createNS("http://www.w3.org/2000/svg","svg"),a=41,o=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${o}px`),n.setAttributeNS(null,"viewBox",`0 0 ${o} ${a}`);const h=oe.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const I=oe.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const v=oe.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const A of C){const w=oe.createNS("http://www.w3.org/2000/svg","ellipse");w.setAttributeNS(null,"opacity","0.04"),w.setAttributeNS(null,"cx","10.5"),w.setAttributeNS(null,"cy","5.80029008"),w.setAttributeNS(null,"rx",A.rx),w.setAttributeNS(null,"ry",A.ry),v.appendChild(w)}const T=oe.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const F=oe.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(F);const z=oe.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const $=oe.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild($);const ie=oe.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ie.setAttributeNS(null,"fill","#FFFFFF");const ce=oe.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=oe.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const p=oe.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#FFFFFF"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962"),ce.appendChild(m),ce.appendChild(p),I.appendChild(v),I.appendChild(T),I.appendChild(z),I.appendChild(ie),I.appendChild(ce),n.appendChild(I),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Uo(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),oe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const o=this._map,h=o.terrain.depthAtPoint(this._pos),I=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,I)-h<.006)return void(this._element.style.opacity=this._opacity);const v=-this._offset.y/o.transform._pixelPerMeter,C=Math.sin(o.getPitch()*Math.PI/180)*v,T=o.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),F=o.transform.lngLatToCameraDepth(this._lngLat,I+C)-T>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Da={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ta=0,ia=!1;const Hn={maxWidth:100,unit:"metric"};function Ma(u,e,n){const a=n&&n.maxWidth||100,o=u._container.clientHeight/2,h=u.unproject([0,o]),I=u.unproject([a,o]),v=h.distanceTo(I);if(n&&n.unit==="imperial"){const C=3.2808*v;C>5280?zt(e,a,C/5280,u._getUIString("ScaleControl.Miles")):zt(e,a,C,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?zt(e,a,v/1852,u._getUIString("ScaleControl.NauticalMiles")):v>=1e3?zt(e,a,v/1e3,u._getUIString("ScaleControl.Kilometers")):zt(e,a,v,u._getUIString("ScaleControl.Meters"))}function zt(u,e,n,a){const o=function(h){const I=Math.pow(10,`${Math.floor(h)}`.length-1);let v=h/I;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:function(C){const T=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*T)/T}(v),I*v}(n);u.style.width=e*(o/n)+"px",u.innerHTML=`${o}&nbsp;${a}`}const Ht={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Oo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qo(u){if(u){if(typeof u=="number"){const e=Math.round(Math.abs(u)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,u),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-u),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(u,0),right:new c.P(-u,0)}}if(u instanceof c.P||Array.isArray(u)){const e=c.P.convert(u);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(u.center||[0,0]),top:c.P.convert(u.top||[0,0]),"top-left":c.P.convert(u["top-left"]||[0,0]),"top-right":c.P.convert(u["top-right"]||[0,0]),bottom:c.P.convert(u.bottom||[0,0]),"bottom-left":c.P.convert(u["bottom-left"]||[0,0]),"bottom-right":c.P.convert(u["bottom-right"]||[0,0]),left:c.P.convert(u.left||[0,0]),right:c.P.convert(u.right||[0,0])}}return qo(new c.P(0,0))}const Ml=X;E.AJAXError=c.bh,E.Evented=c.E,E.LngLat=c.N,E.MercatorCoordinate=c.Z,E.Point=c.P,E.addProtocol=c.bi,E.config=c.a,E.removeProtocol=c.bj,E.AttributionControl=ks,E.BoxZoomHandler=tn,E.CanvasSource=cn,E.CooperativeGesturesHandler=hs,E.DoubleClickZoomHandler=$s,E.DragPanHandler=Ql,E.DragRotateHandler=Xl,E.EdgeInsets=as,E.FullscreenControl=class extends c.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){oe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=oe.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);oe.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},E.GeoJSONSource=Xn,E.GeolocateControl=class extends c.E{constructor(u){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,o=this._map.getBearing(),h=c.e({bearing:o},this.options.fitBoundsOptions),I=qe.fromLngLat(n,a);this._map.fitBounds(I,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ia)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=oe.create("button","maplibregl-ctrl-geolocate",this._container),oe.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new No({element:this._dotElement}),this._circleElement=oe.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new No({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Da,u)}onAdd(u){return this._map=u,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(rr!==void 0&&!e)return rr;if(window.navigator.permissions===void 0)return rr=!!window.navigator.geolocation,rr;try{rr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{rr=!!window.navigator.geolocation}return rr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),oe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ta=0,ia=!1}_isOutOfMapMaxBounds(u){const e=this._map.getMaxBounds(),n=u.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),e=u.getSouthEast(),n=u.getNorthEast(),a=e.distanceTo(n),o=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ta--,ia=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ta++,ta>1?(u={maximumAge:6e5,timeout:0},ia=!0):(u=this.options.positionOptions,ia=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},E.Hash=Hs,E.ImageSource=Kr,E.KeyboardHandler=An,E.LngLatBounds=qe,E.LogoControl=qi,E.Map=class extends io{constructor(u){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},tc),u);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new os(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new gi,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ro),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=He.addThrottleControl(()=>this.isMoving()),this._requestManager=new $e(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=Es(o=>{this._trackResize&&!this._removed&&(this.resize(o),this.redraw())},50);this._resizeObserver=new ResizeObserver(o=>{n?a(o):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new to(this,e),this._hash=e.hash&&new Hs(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ks(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new qi,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(u,e){if(e===void 0&&(e=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(u);return e>-1&&this._controls.splice(e,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,e,n,a)}resize(u){var e;const n=this._containerDimensions(),a=n[0],o=n[1],h=this._getClampedPixelRatio(a,o);if(this._resizeCanvas(a,o,h),this.painter.resize(a,o,h),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const C=this._getClampedPixelRatio(a,o);this._resizeCanvas(a,o,C),this.painter.resize(a,o,C)}this.transform.resize(a,o),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,o);const I=!this._moving;return I&&(this.stop(),this.fire(new c.k("movestart",u)).fire(new c.k("move",u))),this.fire(new c.k("resize",u)),I&&this.fire(new c.k("moveend",u)),this}_getClampedPixelRatio(u,e){const{0:n,1:a}=this._maxCanvasSize,o=this.getPixelRatio(),h=u*o,I=e*o;return Math.min(h>n?n/h:1,I>a?a/I:1)*o}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(qe.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(c.N.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(c.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,e,n){if(u==="mouseenter"||u==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{const I=e.filter(C=>this.getLayer(C)),v=I.length!==0?this.queryRenderedFeatures(h.point,{layers:I}):[];v.length?a||(a=!0,n.call(this,new ir(u,this,h.originalEvent,{features:v}))):a=!1},mouseout:()=>{a=!1}}}}if(u==="mouseleave"||u==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:I=>{const v=e.filter(C=>this.getLayer(C));(v.length!==0?this.queryRenderedFeatures(I.point,{layers:v}):[]).length?a=!0:a&&(a=!1,n.call(this,new ir(u,this,I.originalEvent)))},mouseout:I=>{a&&(a=!1,n.call(this,new ir(u,this,I.originalEvent)))}}}}{const a=o=>{const h=e.filter(v=>this.getLayer(v)),I=h.length!==0?this.queryRenderedFeatures(o.point,{layers:h}):[];I.length&&(o.features=I,n.call(this,o),delete o.features)};return{layers:e,listener:n,delegates:{[u]:a}}}}_saveDelegatedListener(u,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(e)}_removeDelegatedListener(u,e,n){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const a=this._delegatedListeners[u];for(let o=0;o<a.length;o++){const h=a[o];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(I=>e.includes(I))){for(const I in h.delegates)this.off(I,h.delegates[I]);return void a.splice(o,1)}}}on(u,e,n){if(n===void 0)return super.on(u,e);const a=this._createDelegatedListener(u,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(u,a);for(const o in a.delegates)this.on(o,a.delegates[o]);return this}once(u,e,n){if(n===void 0)return super.once(u,e);const a=typeof e=="string"?[e]:e,o=this._createDelegatedListener(u,a,n);for(const h in o.delegates){const I=o.delegates[h];o.delegates[h]=(...v)=>{this._removeDelegatedListener(u,a,n),I(...v)}}this._saveDelegatedListener(u,o);for(const h in o.delegates)this.once(h,o.delegates[h]);return this}off(u,e,n){return n===void 0?super.off(u,e):(this._removeDelegatedListener(u,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(u,e){if(!this.style)return[];let n;const a=u instanceof c.P||Array.isArray(u),o=a?u:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:u)||{},o instanceof c.P||typeof o[0]=="number")n=[c.P.convert(o)];else{const h=c.P.convert(o[0]),I=c.P.convert(o[1]);n=[h,new c.P(I.x,h.y),I,new c.P(h.x,I.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(u,e){return this.style.querySourceFeatures(u,e)}setStyle(u,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(u,e))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const e=this._locale[u];if(e==null)throw new Error(`Missing UI string '${u}'`);return e}_updateStyle(u,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Gn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,e,n):this.style.loadJSON(u,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Gn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,e){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,"Style");c.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof u=="object"&&this._updateDiff(u,e)}_updateDiff(u,e){try{this.style.setState(u,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(u,e){return this._lazyInitEmptyStyle(),this.style.addSource(u,e),this._update(!0)}isSourceLoaded(u){const e=this.style&&this.style.sourceCaches[u];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const e=this.style.sourceCaches[u.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===u.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zo(this.painter,e,u),this.painter.renderToTexture=new Sl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==u.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:u})),this}getTerrain(){var u,e;return(e=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const e in u){const n=u[e]._tiles;for(const a in n){const o=n[a];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,e,n={}){const{pixelRatio:a=1,sdf:o=!1,stretchX:h,stretchY:I,content:v,textFitWidth:C,textFitHeight:T}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:z,data:$}=e,ie=e;return this.style.addImage(u,{data:new c.R({width:F,height:z},new Uint8Array($)),pixelRatio:a,stretchX:h,stretchY:I,content:v,textFitWidth:C,textFitHeight:T,sdf:o,version:0,userImage:ie}),ie.onAdd&&ie.onAdd(this,u),this}}{const{width:F,height:z,data:$}=fe.getImageData(e);this.style.addImage(u,{data:new c.R({width:F,height:z},$),pixelRatio:a,stretchX:h,stretchY:I,content:v,textFitWidth:C,textFitHeight:T,sdf:o,version:0})}}updateImage(u,e){const n=this.style.getImage(u);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?fe.getImageData(e):e,{width:o,height:h,data:I}=a;if(o===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const v=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(I,v),this.style.updateImage(u,n),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return He.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,e){return this._lazyInitEmptyStyle(),this.style.addLayer(u,e),this._update(!0)}moveLayer(u,e){return this.style.moveLayer(u,e),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,e,n){return this.style.setLayerZoomRange(u,e,n),this._update(!0)}setFilter(u,e,n={}){return this.style.setFilter(u,e,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,e,n,a={}){return this.style.setPaintProperty(u,e,n,a),this._update(!0)}getPaintProperty(u,e){return this.style.getPaintProperty(u,e)}setLayoutProperty(u,e,n,a={}){return this.style.setLayoutProperty(u,e,n,a),this._update(!0)}getLayoutProperty(u,e){return this.style.getLayoutProperty(u,e)}setGlyphs(u,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,e,n,a=>{a||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,e,n=>{n||this._update(!0)}),this}setLight(u,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(u){return this._lazyInitEmptyStyle(),this.style.setSky(u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,e){return this.style.setFeatureState(u,e),this._update()}removeFeatureState(u,e){return this.style.removeFeatureState(u,e),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,e=0;return this._container&&(u=this._container.clientWidth||400,e=this._container.clientHeight||300),[u,e]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const e=this._canvasContainer=oe.create("div","maplibregl-canvas-container",u);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=oe.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const o=this._controlContainer=oe.create("div","maplibregl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{h[I]=oe.create("div",`maplibregl-ctrl-${I} `,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,e,n){this._canvas.width=Math.floor(n*u),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:u},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new ko(n,this.transform),Fe.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const o=this.transform.zoom,h=fe.now();this.style.zoomHistory.update(o,h);const I=new c.z(o,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),v=I.crossFadingFactor();v===1&&v===this._crossFadingFactor||(n=!0,this._crossFadingFactor=v),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),He.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),oe.remove(this._canvasContainer),oe.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,fe.frameAsync(this._frameRequest).then(u=>{c.bf.frame(u),this._frameRequest=null,this._render(u)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return Go}getCameraTargetElevation(){return this.transform.elevation}},E.MapMouseEvent=ir,E.MapTouchEvent=Js,E.MapWheelEvent=Zl,E.Marker=No,E.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},ic,u),this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),oe.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),oe.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=oe.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){oe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,e){const n=oe.create("button",u,this._container);return n.type="button",n.addEventListener("click",e),n}},E.Popup=class extends c.E{constructor(u){super(),this.remove=()=>(this._content&&oe.remove(this._content),this._container&&(oe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=oe.create("div","maplibregl-popup",this._map.getContainer()),this._tip=oe.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Vi(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let o=this.options.anchor;const h=qo(this.options.offset);if(!o){const v=this._container.offsetWidth,C=this._container.offsetHeight;let T;T=a.y+h.bottom.y<C?["top"]:a.y>this._map.transform.height-C?["bottom"]:[],a.x<v/2?T.push("left"):a.x>this._map.transform.width-v/2&&T.push("right"),o=T.length===0?"bottom":T.join("-")}let I=a.add(h[o]);this.options.subpixelPositioning||(I=I.round()),oe.setTransform(this._container,`${ea[o]} translate(${I.x}px,${I.y}px)`),Uo(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ht),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=c.N.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=u;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=oe.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=oe.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Oo);u&&u.focus()}},E.RasterDEMTileSource=Gi,E.RasterTileSource=Ai,E.ScaleControl=class{constructor(u){this._onMove=()=>{Ma(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ma(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Hn),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){oe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},E.ScrollZoomHandler=En,E.Style=Gn,E.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=oe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=oe.create("button","maplibregl-ctrl-terrain",this._container),oe.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){oe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},E.TwoFingersTouchPitchHandler=ls,E.TwoFingersTouchRotateHandler=Cl,E.TwoFingersTouchZoomHandler=xl,E.TwoFingersTouchZoomRotateHandler=Fo,E.VectorTileSource=Pn,E.VideoSource=ca,E.addSourceType=(u,e)=>c._(void 0,void 0,void 0,function*(){if(ha(u))throw new Error(`A source type called "${u}" already exists.`);((n,a)=>{Ts[n]=a})(u,e)}),E.clearPrewarmedResources=function(){const u=ii;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Jt),ii=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},E.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},E.getRTLTextPluginStatus=function(){return Rn().getRTLTextPluginStatus()},E.getVersion=function(){return Ml},E.getWorkerCount=function(){return ei.workerCount},E.getWorkerUrl=function(){return c.a.WORKER_URL},E.importScriptInWorkers=function(u){return yr().broadcast("IS",u)},E.prewarm=function(){ki().acquire(Jt)},E.setMaxParallelImageRequests=function(u){c.a.MAX_PARALLEL_IMAGE_REQUESTS=u},E.setRTLTextPlugin=function(u,e){return Rn().setRTLTextPlugin(u,e)},E.setWorkerCount=function(u){ei.workerCount=u},E.setWorkerUrl=function(u){c.a.WORKER_URL=u}});var H=y;return H})})(Xd);var dp=Xd.exports;const mc=Ap(dp),fp="0cdoIBjm8kHZGjEGavi9",gp="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/v1",pp="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/lightning/v2",mp="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/lightning-wglc/v1",yp="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/wind/v5",_p="https://db.incusgrid.com";var du={exports:{}};(function(L,g){(function(y,x){x(g)})(Wd,function(y){function x(m){return(p,...A)=>H(m,p,A)}function D(m,p){return x(E(m,p).get)}const{apply:H,getOwnPropertyDescriptor:E,getPrototypeOf:c,ownKeys:X}=Reflect,{iterator:he,toStringTag:Ie}=Symbol,fe=Object,{create:oe,defineProperty:Fe}=fe,Ue=Array.prototype[he],Xe=x(Ue),et=ArrayBuffer;D(et.prototype,"byteLength");const st=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;st&&D(st.prototype,"byteLength");const Ne=c(Uint8Array);Ne.from;const He=Ne.prototype;He[he],x(He.keys),x(He.values),x(He.entries),x(He.set),x(He.reverse),x(He.fill),x(He.copyWithin),x(He.sort),x(He.slice),x(He.subarray),D(He,"buffer"),D(He,"byteOffset"),D(He,"length"),D(He,Ie);const $e=Uint8Array,lt=Uint16Array,Qt=Uint32Array,ht=Float32Array,Gt=c([][he]()),vt=x(Gt.next),Tt=x(function*(){}().next),bt=c(Gt),_t=x(DataView.prototype.getUint16),Vt=WeakMap,Lt=Vt.prototype,Zt=x(Lt.get),wi=x(Lt.set),Mt=new Vt,Si=oe(null,{next:{value:function(){const m=Zt(Mt,this);return vt(m)}},[he]:{value:function(){return this}}}),Ei=new Vt,Qi=oe(bt,{next:{value:function(){const m=Zt(Ei,this);return Tt(m)},writable:!0,configurable:!0}});for(const m of X(Gt))m!=="next"&&Fe(Qi,m,E(Gt,m));const oi=new et(4),ui=new ht(oi),br=new Qt(oi),Jt=new lt(512),ei=new $e(512);for(let m=0;m<256;++m){const p=m-127;p<-24?(Jt[m]=0,Jt[256|m]=32768,ei[m]=24,ei[256|m]=24):p<-14?(Jt[m]=1024>>-p-14,Jt[256|m]=1024>>-p-14|32768,ei[m]=-p-1,ei[256|m]=-p-1):p<=15?(Jt[m]=p+15<<10,Jt[256|m]=p+15<<10|32768,ei[m]=13,ei[256|m]=13):p<128?(Jt[m]=31744,Jt[256|m]=64512,ei[m]=24,ei[256|m]=24):(Jt[m]=31744,Jt[256|m]=64512,ei[m]=13,ei[256|m]=13)}const Yt=new Qt(2048);for(let m=1;m<1024;++m){let p=m<<13,A=0;for(;!(8388608&p);)p<<=1,A-=8388608;p&=-8388609,A+=947912704,Yt[m]=p|A}for(let m=1024;m<2048;++m)Yt[m]=939524096+(m-1024<<13);const ii=new Qt(64);for(let m=1;m<31;++m)ii[m]=m<<23;ii[31]=1199570944,ii[32]=2147483648;for(let m=33;m<63;++m)ii[m]=2147483648+(m-32<<23);ii[63]=3347054592;const di=new lt(64);for(let m=1;m<64;++m)m!==32&&(di[m]=1024);function ki(m,p,...A){return function(w){const B=w>>10;return br[0]=Yt[di[B]+(1023&w)]+ii[B],ui[0]}(_t(m,p,...function(w){if(w[he]===Ue&&Gt.next===vt)return w;const B=oe(Si);return wi(Mt,B,Xe(w)),B}(A)))}function vr(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var yr={exports:{}};function Wi(m,p,A){const w=A&&A.debug||!1;w&&console.log("[xml-utils] getting "+p+" in "+m);const B=typeof m=="object"?m.outer:m,k=B.slice(0,B.indexOf(">")+1),P=['"',"'"];for(let S=0;S<P.length;S++){const V=P[S],U=p+"\\="+V+"([^"+V+"]*)"+V;w&&console.log("[xml-utils] pattern:",U);const q=new RegExp(U).exec(k);if(w&&console.log("[xml-utils] match:",q),q)return q[1]}}yr.exports=Wi,yr.exports.default=Wi;var pi=vr(yr.exports),zi={exports:{}},er={exports:{}},qe={exports:{}};function cr(m,p,A){const w=new RegExp(p).exec(m.slice(A));return w?A+w.index:-1}qe.exports=cr,qe.exports.default=cr;var Pn=qe.exports,Ai={exports:{}};function Gi(m,p,A){const w=new RegExp(p).exec(m.slice(A));return w?A+w.index+w[0].length-1:-1}Ai.exports=Gi,Ai.exports.default=Gi;var Xn=Ai.exports,wr={exports:{}};function Kr(m,p){const A=new RegExp(p,"g"),w=m.match(A);return w?w.length:0}wr.exports=Kr,wr.exports.default=Kr;var ca=wr.exports;const cn=Pn,Ts=Xn,ha=ca;function gt(m,p,A){const w=A&&A.debug||!1,B=!(A&&typeof A.nested===!1),k=A&&A.startIndex||0;w&&console.log("[xml-utils] starting findTagByName with",p," and ",A);const P=cn(m,`<${p}[ 
>/]`,k);if(w&&console.log("[xml-utils] start:",P),P===-1)return;const S=m.slice(P+p.length);let V=Ts(S,"^[^<]*[ /]>",0);const U=V!==-1&&S[V-1]==="/";if(w&&console.log("[xml-utils] selfClosing:",U),U===!1)if(B){let N=0,se=1,ue=0;for(;(V=Ts(S,"[ /]"+p+">",N))!==-1;){const ae=S.substring(N,V+1);if(se+=ha(ae,"<"+p+`[ 
	>]`),ue+=ha(ae,"</"+p+">"),ue>=se)break;N=V}}else V=Ts(S,"[ /]"+p+">",0);const q=P+p.length+V+1;if(w&&console.log("[xml-utils] end:",q),q===-1)return;const ne=m.slice(P,q);let Z;return Z=U?null:ne.slice(ne.indexOf(">")+1,ne.lastIndexOf("<")),{inner:Z,outer:ne,start:P,end:q}}er.exports=gt,er.exports.default=gt;const Ln=er.exports;function xr(m,p,A){const w=[],B=A&&A.debug||!1,k=!A||typeof A.nested!="boolean"||A.nested;let P,S=A&&A.startIndex||0;for(;P=Ln(m,p,{debug:B,startIndex:S});)S=k?P.start+1+p.length:P.end,w.push(P);return B&&console.log("findTagsByName found",w.length,"tags"),w}zi.exports=xr,zi.exports.default=xr;var Rn=vr(zi.exports);const hn={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},dt={};for(const m in hn)hn.hasOwnProperty(m)&&(dt[hn[m]]=parseInt(m,10));const li=[dt.BitsPerSample,dt.ExtraSamples,dt.SampleFormat,dt.StripByteCounts,dt.StripOffsets,dt.StripRowCounts,dt.TileByteCounts,dt.TileOffsets,dt.SubIFDs],$t={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Wt={};for(const m in $t)$t.hasOwnProperty(m)&&(Wt[$t[m]]=parseInt(m,10));const un=0,ni=1,Fn=2,zn=3,es=5,_n=6,_e=8,J=0,j=1,te=0,pe=1,Ce=2,Te={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Le=new Map;function we(m,p){Array.isArray(m)||(m=[m]),m.forEach(A=>Le.set(A,p))}async function Ye(m){const p=Le.get(m.Compression);if(!p)throw new Error(`Unknown compression method identifier: ${m.Compression}`);return new(await p())(m)}function nt(m,p,A,w=1){return new(Object.getPrototypeOf(m)).constructor(p*A*w)}function Ge(m,p,A){return(1-A)*m+A*p}function It(m,p,A,w,B,k="nearest"){switch(k.toLowerCase()){case"nearest":return function(P,S,V,U,q){const ne=S/U,Z=V/q;return P.map(N=>{const se=nt(N,U,q);for(let ue=0;ue<q;++ue){const ae=Math.min(Math.round(Z*ue),V-1);for(let de=0;de<U;++de){const xe=Math.min(Math.round(ne*de),S-1),be=N[ae*S+xe];se[ue*U+de]=be}}return se})}(m,p,A,w,B);case"bilinear":case"linear":return function(P,S,V,U,q){const ne=S/U,Z=V/q;return P.map(N=>{const se=nt(N,U,q);for(let ue=0;ue<q;++ue){const ae=Z*ue,de=Math.floor(ae),xe=Math.min(Math.ceil(ae),V-1);for(let be=0;be<U;++be){const Se=ne*be,K=Se%1,G=Math.floor(Se),Ae=Math.min(Math.ceil(Se),S-1),re=N[de*S+G],le=N[de*S+Ae],ge=N[xe*S+G],De=N[xe*S+Ae],Be=Ge(Ge(re,le,K),Ge(ge,De,K),ae%1);se[ue*U+be]=Be}}return se})}(m,p,A,w,B);default:throw new Error(`Unsupported resampling method: '${k}'`)}}function Ot(m,p,A,w,B,k,P="nearest"){switch(P.toLowerCase()){case"nearest":return function(S,V,U,q,ne,Z){const N=V/q,se=U/ne,ue=nt(S,q,ne,Z);for(let ae=0;ae<ne;++ae){const de=Math.min(Math.round(se*ae),U-1);for(let xe=0;xe<q;++xe){const be=Math.min(Math.round(N*xe),V-1);for(let Se=0;Se<Z;++Se){const K=S[de*V*Z+be*Z+Se];ue[ae*q*Z+xe*Z+Se]=K}}}return ue}(m,p,A,w,B,k);case"bilinear":case"linear":return function(S,V,U,q,ne,Z){const N=V/q,se=U/ne,ue=nt(S,q,ne,Z);for(let ae=0;ae<ne;++ae){const de=se*ae,xe=Math.floor(de),be=Math.min(Math.ceil(de),U-1);for(let Se=0;Se<q;++Se){const K=N*Se,G=K%1,Ae=Math.floor(K),re=Math.min(Math.ceil(K),V-1);for(let le=0;le<Z;++le){const ge=S[xe*V*Z+Ae*Z+le],De=S[xe*V*Z+re*Z+le],Be=S[be*V*Z+Ae*Z+le],ke=S[be*V*Z+re*Z+le],Oe=Ge(Ge(ge,De,G),Ge(Be,ke,G),de%1);ue[ae*q*Z+Se*Z+le]=Oe}}}return ue}(m,p,A,w,B,k);default:throw new Error(`Unsupported resampling method: '${P}'`)}}function jt(m,p,A){let w=0;for(let B=p;B<A;++B)w+=m[B];return w}function Ii(m,p,A){switch(m){case 1:if(p<=8)return new Uint8Array(A);if(p<=16)return new Uint16Array(A);if(p<=32)return new Uint32Array(A);break;case 2:if(p===8)return new Int8Array(A);if(p===16)return new Int16Array(A);if(p===32)return new Int32Array(A);break;case 3:switch(p){case 16:case 32:return new Float32Array(A);case 64:return new Float64Array(A)}}throw Error("Unsupported data format/bitsPerSample")}we([void 0,1],()=>Promise.resolve().then(function(){return Kl}).then(m=>m.default)),we(5,()=>Promise.resolve().then(function(){return Ea}).then(m=>m.default)),we(6,()=>{throw new Error("old style JPEG compression is not supported.")}),we(7,()=>Promise.resolve().then(function(){return Ka}).then(m=>m.default)),we([8,32946],()=>Promise.resolve().then(function(){return e}).then(m=>m.default)),we(32773,()=>Promise.resolve().then(function(){return n}).then(m=>m.default)),we(34887,()=>Promise.resolve().then(function(){return z}).then(async m=>(await m.zstd.init(),m)).then(m=>m.default)),we(50001,()=>Promise.resolve().then(function(){return $}).then(m=>m.default));class si{constructor(p,A,w,B,k,P){this.fileDirectory=p,this.geoKeys=A,this.dataView=w,this.littleEndian=B,this.tiles=k?{}:null,this.isTiled=!p.StripOffsets;const S=p.PlanarConfiguration;if(this.planarConfiguration=S===void 0?1:S,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=P}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return this.fileDirectory.SamplesPerPixel!==void 0?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip!==void 0?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(p){return this.isTiled||(p+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-p*this.getTileHeight()}getBytesPerPixel(){let p=0;for(let A=0;A<this.fileDirectory.BitsPerSample.length;++A)p+=this.getSampleByteSize(A);return p}getSampleByteSize(p){if(p>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${p} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[p]/8)}getReaderForSample(p){const A=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[p]:1,w=this.fileDirectory.BitsPerSample[p];switch(A){case 1:if(w<=8)return DataView.prototype.getUint8;if(w<=16)return DataView.prototype.getUint16;if(w<=32)return DataView.prototype.getUint32;break;case 2:if(w<=8)return DataView.prototype.getInt8;if(w<=16)return DataView.prototype.getInt16;if(w<=32)return DataView.prototype.getInt32;break;case 3:switch(w){case 16:return function(B,k){return ki(this,B,k)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(p=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[p]:1}getBitsPerSample(p=0){return this.fileDirectory.BitsPerSample[p]}getArrayForSample(p,A){return Ii(this.getSampleFormat(p),this.getBitsPerSample(p),A)}async getTileOrStrip(p,A,w,B,k){const P=Math.ceil(this.getWidth()/this.getTileWidth()),S=Math.ceil(this.getHeight()/this.getTileHeight());let V;const{tiles:U}=this;let q,ne;this.planarConfiguration===1?V=A*P+p:this.planarConfiguration===2&&(V=w*P*S+A*P+p),this.isTiled?(q=this.fileDirectory.TileOffsets[V],ne=this.fileDirectory.TileByteCounts[V]):(q=this.fileDirectory.StripOffsets[V],ne=this.fileDirectory.StripByteCounts[V]);const Z=(await this.source.fetch([{offset:q,length:ne}],k))[0];let N;return U!==null&&U[V]?N=U[V]:(N=(async()=>{let se=await B.decode(this.fileDirectory,Z);const ue=this.getSampleFormat(),ae=this.getBitsPerSample();return function(de,xe){return(de!==1&&de!==2||!(xe<=32)||xe%8!=0)&&(de!==3||xe!==16&&xe!==32&&xe!==64)}(ue,ae)&&(se=function(de,xe,be,Se,K,G,Ae){const re=new DataView(de),le=be===2?1:Se,ge=Ii(xe,K,be===2?Ae*G:Ae*G*Se),De=parseInt("1".repeat(K),2);if(xe===1){let Be;Be=be===1?Se*K:K;let ke=G*Be;7&ke&&(ke=ke+7&-8);for(let Oe=0;Oe<Ae;++Oe){const Ze=Oe*ke;for(let We=0;We<G;++We){const rt=Ze+We*le*K;for(let pt=0;pt<le;++pt){const Ve=rt+pt*K,ze=(Oe*G+We)*le+pt,it=Math.floor(Ve/8),Dt=Ve%8;if(Dt+K<=8)ge[ze]=re.getUint8(it)>>8-K-Dt&De;else if(Dt+K<=16)ge[ze]=re.getUint16(it)>>16-K-Dt&De;else if(Dt+K<=24){const ft=re.getUint16(it)<<8|re.getUint8(it+2);ge[ze]=ft>>24-K-Dt&De}else ge[ze]=re.getUint32(it)>>32-K-Dt&De}}}}return ge.buffer}(se,ue,this.planarConfiguration,this.getSamplesPerPixel(),ae,this.getTileWidth(),this.getBlockHeight(A))),se})(),U!==null&&(U[V]=N)),{x:p,y:A,sample:w,data:await N}}async _readRaster(p,A,w,B,k,P,S,V,U){const q=this.getTileWidth(),ne=this.getTileHeight(),Z=this.getWidth(),N=this.getHeight(),se=Math.max(Math.floor(p[0]/q),0),ue=Math.min(Math.ceil(p[2]/q),Math.ceil(Z/q)),ae=Math.max(Math.floor(p[1]/ne),0),de=Math.min(Math.ceil(p[3]/ne),Math.ceil(N/ne)),xe=p[2]-p[0];let be=this.getBytesPerPixel();const Se=[],K=[];for(let re=0;re<A.length;++re)this.planarConfiguration===1?Se.push(jt(this.fileDirectory.BitsPerSample,0,A[re])/8):Se.push(0),K.push(this.getReaderForSample(A[re]));const G=[],{littleEndian:Ae}=this;for(let re=ae;re<de;++re)for(let le=se;le<ue;++le){let ge;this.planarConfiguration===1&&(ge=this.getTileOrStrip(le,re,0,k,U));for(let De=0;De<A.length;++De){const Be=De,ke=A[De];this.planarConfiguration===2&&(be=this.getSampleByteSize(ke),ge=this.getTileOrStrip(le,re,ke,k,U));const Oe=ge.then(Ze=>{const We=Ze.data,rt=new DataView(We),pt=this.getBlockHeight(Ze.y),Ve=Ze.y*ne,ze=Ze.x*q,it=Ve+pt,Dt=(Ze.x+1)*q,ft=K[Be],Rt=Math.min(pt,pt-(it-p[3]),N-Ve),At=Math.min(q,q-(Dt-p[2]),Z-ze);for(let Ct=Math.max(0,p[1]-Ve);Ct<Rt;++Ct)for(let wt=Math.max(0,p[0]-ze);wt<At;++wt){const ut=(Ct*q+wt)*be,Et=ft.call(rt,ut+Se[Be],Ae);let mi;B?(mi=(Ct+Ve-p[1])*xe*A.length+(wt+ze-p[0])*A.length+Be,w[mi]=Et):(mi=(Ct+Ve-p[1])*xe+wt+ze-p[0],w[Be][mi]=Et)}});G.push(Oe)}}if(await Promise.all(G),P&&p[2]-p[0]!==P||S&&p[3]-p[1]!==S){let re;return re=B?Ot(w,p[2]-p[0],p[3]-p[1],P,S,A.length,V):It(w,p[2]-p[0],p[3]-p[1],P,S,V),re.width=P,re.height=S,re}return w.width=P||p[2]-p[0],w.height=S||p[3]-p[1],w}async readRasters({window:p,samples:A=[],interleave:w,pool:B=null,width:k,height:P,resampleMethod:S,fillValue:V,signal:U}={}){const q=p||[0,0,this.getWidth(),this.getHeight()];if(q[0]>q[2]||q[1]>q[3])throw new Error("Invalid subsets");const ne=(q[2]-q[0])*(q[3]-q[1]),Z=this.getSamplesPerPixel();if(A&&A.length){for(let ue=0;ue<A.length;++ue)if(A[ue]>=Z)return Promise.reject(new RangeError(`Invalid sample index '${A[ue]}'.`))}else for(let ue=0;ue<Z;++ue)A.push(ue);let N;if(w)N=Ii(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),ne*A.length),V&&N.fill(V);else{N=[];for(let ue=0;ue<A.length;++ue){const ae=this.getArrayForSample(A[ue],ne);Array.isArray(V)&&ue<V.length?ae.fill(V[ue]):V&&!Array.isArray(V)&&ae.fill(V),N.push(ae)}}const se=B||await Ye(this.fileDirectory);return await this._readRaster(q,A,N,w,se,k,P,S,U)}async readRGB({window:p,interleave:A=!0,pool:w=null,width:B,height:k,resampleMethod:P,enableAlpha:S=!1,signal:V}={}){const U=p||[0,0,this.getWidth(),this.getHeight()];if(U[0]>U[2]||U[1]>U[3])throw new Error("Invalid subsets");const q=this.fileDirectory.PhotometricInterpretation;if(q===Fn){let de=[0,1,2];if(this.fileDirectory.ExtraSamples!==J&&S){de=[];for(let xe=0;xe<this.fileDirectory.BitsPerSample.length;xe+=1)de.push(xe)}return this.readRasters({window:p,interleave:A,samples:de,pool:w,width:B,height:k,resampleMethod:P,signal:V})}let ne;switch(q){case un:case ni:case zn:ne=[0];break;case es:ne=[0,1,2,3];break;case _n:case _e:ne=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const Z={window:U,interleave:!0,samples:ne,pool:w,width:B,height:k,resampleMethod:P,signal:V},{fileDirectory:N}=this,se=await this.readRasters(Z),ue=2**this.fileDirectory.BitsPerSample[0];let ae;switch(q){case un:ae=function(de,xe){const{width:be,height:Se}=de,K=new Uint8Array(be*Se*3);let G;for(let Ae=0,re=0;Ae<de.length;++Ae,re+=3)G=256-de[Ae]/xe*256,K[re]=G,K[re+1]=G,K[re+2]=G;return K}(se,ue);break;case ni:ae=function(de,xe){const{width:be,height:Se}=de,K=new Uint8Array(be*Se*3);let G;for(let Ae=0,re=0;Ae<de.length;++Ae,re+=3)G=de[Ae]/xe*256,K[re]=G,K[re+1]=G,K[re+2]=G;return K}(se,ue);break;case zn:ae=function(de,xe){const{width:be,height:Se}=de,K=new Uint8Array(be*Se*3),G=xe.length/3,Ae=xe.length/3*2;for(let re=0,le=0;re<de.length;++re,le+=3){const ge=de[re];K[le]=xe[ge]/65536*256,K[le+1]=xe[ge+G]/65536*256,K[le+2]=xe[ge+Ae]/65536*256}return K}(se,N.ColorMap);break;case es:ae=function(de){const{width:xe,height:be}=de,Se=new Uint8Array(xe*be*3);for(let K=0,G=0;K<de.length;K+=4,G+=3){const Ae=de[K],re=de[K+1],le=de[K+2],ge=de[K+3];Se[G]=(255-Ae)/256*255*((255-ge)/256),Se[G+1]=(255-re)/256*255*((255-ge)/256),Se[G+2]=(255-le)/256*255*((255-ge)/256)}return Se}(se);break;case _n:ae=function(de){const{width:xe,height:be}=de,Se=new Uint8ClampedArray(xe*be*3);for(let K=0,G=0;K<de.length;K+=3,G+=3){const Ae=de[K],re=de[K+1],le=de[K+2];Se[G]=Ae+1.402*(le-128),Se[G+1]=Ae-.34414*(re-128)-.71414*(le-128),Se[G+2]=Ae+1.772*(re-128)}return Se}(se);break;case _e:ae=function(de){const{width:xe,height:be}=de,Se=new Uint8Array(xe*be*3);for(let K=0,G=0;K<de.length;K+=3,G+=3){let Ae,re,le,ge=(de[K+0]+16)/116,De=(de[K+1]<<24>>24)/500+ge,Be=ge-(de[K+2]<<24>>24)/200;De=.95047*(De*De*De>.008856?De*De*De:(De-16/116)/7.787),ge=1*(ge*ge*ge>.008856?ge*ge*ge:(ge-16/116)/7.787),Be=1.08883*(Be*Be*Be>.008856?Be*Be*Be:(Be-16/116)/7.787),Ae=3.2406*De+-1.5372*ge+-.4986*Be,re=-.9689*De+1.8758*ge+.0415*Be,le=.0557*De+-.204*ge+1.057*Be,Ae=Ae>.0031308?1.055*Ae**(1/2.4)-.055:12.92*Ae,re=re>.0031308?1.055*re**(1/2.4)-.055:12.92*re,le=le>.0031308?1.055*le**(1/2.4)-.055:12.92*le,Se[G]=255*Math.max(0,Math.min(1,Ae)),Se[G+1]=255*Math.max(0,Math.min(1,re)),Se[G+2]=255*Math.max(0,Math.min(1,le))}return Se}(se);break;default:throw new Error("Unsupported photometric interpretation.")}if(!A){const de=new Uint8Array(ae.length/3),xe=new Uint8Array(ae.length/3),be=new Uint8Array(ae.length/3);for(let Se=0,K=0;Se<ae.length;Se+=3,++K)de[K]=ae[Se],xe[K]=ae[Se+1],be[K]=ae[Se+2];ae=[de,xe,be]}return ae.width=se.width,ae.height=se.height,ae}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const p=[];for(let A=0;A<this.fileDirectory.ModelTiepoint.length;A+=6)p.push({i:this.fileDirectory.ModelTiepoint[A],j:this.fileDirectory.ModelTiepoint[A+1],k:this.fileDirectory.ModelTiepoint[A+2],x:this.fileDirectory.ModelTiepoint[A+3],y:this.fileDirectory.ModelTiepoint[A+4],z:this.fileDirectory.ModelTiepoint[A+5]});return p}getGDALMetadata(p=null){const A={};if(!this.fileDirectory.GDAL_METADATA)return null;const w=this.fileDirectory.GDAL_METADATA;let B=Rn(w,"Item");B=p===null?B.filter(k=>pi(k,"sample")===void 0):B.filter(k=>Number(pi(k,"sample"))===p);for(let k=0;k<B.length;++k){const P=B[k];A[pi(P,"name")]=P.inner}return A}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const p=this.fileDirectory.GDAL_NODATA;return Number(p.substring(0,p.length-1))}getOrigin(){const p=this.fileDirectory.ModelTiepoint,A=this.fileDirectory.ModelTransformation;if(p&&p.length===6)return[p[3],p[4],p[5]];if(A)return[A[3],A[7],A[11]];throw new Error("The image does not have an affine transformation.")}getResolution(p=null){const A=this.fileDirectory.ModelPixelScale,w=this.fileDirectory.ModelTransformation;if(A)return[A[0],-A[1],A[2]];if(w)return w[1]===0&&w[4]===0?[w[0],-w[5],w[10]]:[Math.sqrt(w[0]*w[0]+w[4]*w[4]),-Math.sqrt(w[1]*w[1]+w[5]*w[5]),w[10]];if(p){const[B,k,P]=p.getResolution();return[B*p.getWidth()/this.getWidth(),k*p.getHeight()/this.getHeight(),P*p.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(p=!1){const A=this.getHeight(),w=this.getWidth();if(this.fileDirectory.ModelTransformation&&!p){const[B,k,P,S,V,U,q,ne]=this.fileDirectory.ModelTransformation,Z=[[0,0],[0,A],[w,0],[w,A]].map(([ue,ae])=>[S+B*ue+k*ae,ne+V*ue+U*ae]),N=Z.map(ue=>ue[0]),se=Z.map(ue=>ue[1]);return[Math.min(...N),Math.min(...se),Math.max(...N),Math.max(...se)]}{const B=this.getOrigin(),k=this.getResolution(),P=B[0],S=B[1],V=P+k[0]*w,U=S+k[1]*A;return[Math.min(P,V),Math.min(S,U),Math.max(P,V),Math.max(S,U)]}}}class xi{constructor(p){this._dataView=new DataView(p)}get buffer(){return this._dataView.buffer}getUint64(p,A){const w=this.getUint32(p,A),B=this.getUint32(p+4,A);let k;if(A){if(k=w+2**32*B,!Number.isSafeInteger(k))throw new Error(`${k} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return k}if(k=2**32*w+B,!Number.isSafeInteger(k))throw new Error(`${k} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return k}getInt64(p,A){let w=0;const B=(128&this._dataView.getUint8(p+(A?7:0)))>0;let k=!0;for(let P=0;P<8;P++){let S=this._dataView.getUint8(p+(A?P:7-P));B&&(k?S!==0&&(S=255&~(S-1),k=!1):S=255&~S),w+=S*256**P}return B&&(w=-w),w}getUint8(p,A){return this._dataView.getUint8(p,A)}getInt8(p,A){return this._dataView.getInt8(p,A)}getUint16(p,A){return this._dataView.getUint16(p,A)}getInt16(p,A){return this._dataView.getInt16(p,A)}getUint32(p,A){return this._dataView.getUint32(p,A)}getInt32(p,A){return this._dataView.getInt32(p,A)}getFloat16(p,A){return ki(this._dataView,p,A)}getFloat32(p,A){return this._dataView.getFloat32(p,A)}getFloat64(p,A){return this._dataView.getFloat64(p,A)}}class fi{constructor(p,A,w,B){this._dataView=new DataView(p),this._sliceOffset=A,this._littleEndian=w,this._bigTiff=B}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(p,A){return this.sliceOffset<=p&&this.sliceTop>=p+A}readUint8(p){return this._dataView.getUint8(p-this._sliceOffset,this._littleEndian)}readInt8(p){return this._dataView.getInt8(p-this._sliceOffset,this._littleEndian)}readUint16(p){return this._dataView.getUint16(p-this._sliceOffset,this._littleEndian)}readInt16(p){return this._dataView.getInt16(p-this._sliceOffset,this._littleEndian)}readUint32(p){return this._dataView.getUint32(p-this._sliceOffset,this._littleEndian)}readInt32(p){return this._dataView.getInt32(p-this._sliceOffset,this._littleEndian)}readFloat32(p){return this._dataView.getFloat32(p-this._sliceOffset,this._littleEndian)}readFloat64(p){return this._dataView.getFloat64(p-this._sliceOffset,this._littleEndian)}readUint64(p){const A=this.readUint32(p),w=this.readUint32(p+4);let B;if(this._littleEndian){if(B=A+2**32*w,!Number.isSafeInteger(B))throw new Error(`${B} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return B}if(B=2**32*A+w,!Number.isSafeInteger(B))throw new Error(`${B} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return B}readInt64(p){let A=0;const w=(128&this._dataView.getUint8(p+(this._littleEndian?7:0)))>0;let B=!0;for(let k=0;k<8;k++){let P=this._dataView.getUint8(p+(this._littleEndian?k:7-k));w&&(B?P!==0&&(P=255&~(P-1),B=!1):P=255&~P),A+=P*256**k}return w&&(A=-A),A}readOffset(p){return this._bigTiff?this.readUint64(p):this.readUint32(p)}}const sr=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Ki{constructor(p=sr,A){this.workers=null,this._awaitingDecoder=null,this.size=p,this.messageId=0,p&&(this._awaitingDecoder=A?Promise.resolve(A):new Promise(w=>{Promise.resolve().then(function(){return ce}).then(B=>{w(B.create)})}),this._awaitingDecoder.then(w=>{this._awaitingDecoder=null,this.workers=[];for(let B=0;B<p;B++)this.workers.push({worker:w(),idle:!0})}))}async decode(p,A){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?Ye(p).then(w=>w.decode(p,A)):new Promise(w=>{const B=this.workers.find(S=>S.idle)||this.workers[Math.floor(Math.random()*this.size)];B.idle=!1;const k=this.messageId++,P=S=>{S.data.id===k&&(B.idle=!0,w(S.data.decoded),B.worker.removeEventListener("message",P))};B.worker.addEventListener("message",P),B.worker.postMessage({fileDirectory:p,buffer:A,id:k},[A])})}destroy(){this.workers&&(this.workers.forEach(p=>{p.worker.terminate()}),this.workers=null)}}const hi=`\r
\r
`;function Li(m){if(Object.fromEntries!==void 0)return Object.fromEntries(m);const p={};for(const[A,w]of m)p[A.toLowerCase()]=w;return p}function ji(m){return Li(m.split(`\r
`).map(p=>{const A=p.split(":").map(w=>w.trim());return A[0]=A[0].toLowerCase(),A}))}function ar(m){let p,A,w;return m&&([,p,A,w]=m.match(/bytes (\d+)-(\d+)\/(\d+)/),p=parseInt(p,10),A=parseInt(A,10),w=parseInt(w,10)),{start:p,end:A,total:w}}class Ar{async fetch(p,A=void 0){return Promise.all(p.map(w=>this.fetchSlice(w,A)))}async fetchSlice(p){throw new Error(`fetching of slice ${p} not possible, not implemented`)}get fileSize(){return null}async close(){}}class dr extends Map{constructor(p={}){if(super(),!(p.maxSize&&p.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof p.maxAge=="number"&&p.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=p.maxSize,this.maxAge=p.maxAge||Number.POSITIVE_INFINITY,this.onEviction=p.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(p){if(typeof this.onEviction=="function")for(const[A,w]of p)this.onEviction(A,w.value)}_deleteIfExpired(p,A){return typeof A.expiry=="number"&&A.expiry<=Date.now()&&(typeof this.onEviction=="function"&&this.onEviction(p,A.value),this.delete(p))}_getOrDeleteIfExpired(p,A){if(this._deleteIfExpired(p,A)===!1)return A.value}_getItemValue(p,A){return A.expiry?this._getOrDeleteIfExpired(p,A):A.value}_peek(p,A){const w=A.get(p);return this._getItemValue(p,w)}_set(p,A){this.cache.set(p,A),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(p,A){this.oldCache.delete(p),this._set(p,A)}*_entriesAscending(){for(const p of this.oldCache){const[A,w]=p;this.cache.has(A)||this._deleteIfExpired(A,w)===!1&&(yield p)}for(const p of this.cache){const[A,w]=p;this._deleteIfExpired(A,w)===!1&&(yield p)}}get(p){if(this.cache.has(p)){const A=this.cache.get(p);return this._getItemValue(p,A)}if(this.oldCache.has(p)){const A=this.oldCache.get(p);if(this._deleteIfExpired(p,A)===!1)return this._moveToRecent(p,A),A.value}}set(p,A,{maxAge:w=this.maxAge}={}){const B=typeof w=="number"&&w!==Number.POSITIVE_INFINITY?Date.now()+w:void 0;return this.cache.has(p)?this.cache.set(p,{value:A,expiry:B}):this._set(p,{value:A,expiry:B}),this}has(p){return this.cache.has(p)?!this._deleteIfExpired(p,this.cache.get(p)):!!this.oldCache.has(p)&&!this._deleteIfExpired(p,this.oldCache.get(p))}peek(p){return this.cache.has(p)?this._peek(p,this.cache):this.oldCache.has(p)?this._peek(p,this.oldCache):void 0}delete(p){const A=this.cache.delete(p);return A&&this._size--,this.oldCache.delete(p)||A}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(p){if(!(p&&p>0))throw new TypeError("`maxSize` must be a number greater than 0");const A=[...this._entriesAscending()],w=A.length-p;w<0?(this.cache=new Map(A),this.oldCache=new Map,this._size=A.length):(w>0&&this._emitEvictions(A.slice(0,w)),this.oldCache=new Map(A.slice(w)),this.cache=new Map,this._size=0),this.maxSize=p}*keys(){for(const[p]of this)yield p}*values(){for(const[,p]of this)yield p}*[Symbol.iterator](){for(const p of this.cache){const[A,w]=p;this._deleteIfExpired(A,w)===!1&&(yield[A,w.value])}for(const p of this.oldCache){const[A,w]=p;this.cache.has(A)||this._deleteIfExpired(A,w)===!1&&(yield[A,w.value])}}*entriesDescending(){let p=[...this.cache];for(let A=p.length-1;A>=0;--A){const w=p[A],[B,k]=w;this._deleteIfExpired(B,k)===!1&&(yield[B,k.value])}p=[...this.oldCache];for(let A=p.length-1;A>=0;--A){const w=p[A],[B,k]=w;this.cache.has(B)||this._deleteIfExpired(B,k)===!1&&(yield[B,k.value])}}*entriesAscending(){for(const[p,A]of this._entriesAscending())yield[p,A.value]}get size(){if(!this._size)return this.oldCache.size;let p=0;for(const A of this.oldCache.keys())this.cache.has(A)||p++;return Math.min(this._size+p,this.maxSize)}entries(){return this.entriesAscending()}forEach(p,A=this){for(const[w,B]of this.entriesAscending())p.call(A,B,w,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class In extends Error{constructor(p){super(p),Error.captureStackTrace&&Error.captureStackTrace(this,In),this.name="AbortError"}}class Ri extends Error{constructor(p,A){super(A),this.errors=p,this.message=A,this.name="AggregateError"}}const Xo=Ri;class el{constructor(p,A,w=null){this.offset=p,this.length=A,this.data=w}get top(){return this.offset+this.length}}class Rr{constructor(p,A,w){this.offset=p,this.length=A,this.blockIds=w}}class Zr extends Ar{constructor(p,{blockSize:A=65536,cacheSize:w=100}={}){super(),this.source=p,this.blockSize=A,this.blockCache=new dr({maxSize:w,onEviction:(B,k)=>{this.evictedBlocks.set(B,k)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(p,A){const w=[],B=[],k=[];this.evictedBlocks.clear();for(const{offset:Z,length:N}of p){let se=Z+N;const{fileSize:ue}=this;ue!==null&&(se=Math.min(se,ue));for(let ae=Math.floor(Z/this.blockSize)*this.blockSize;ae<se;ae+=this.blockSize){const de=Math.floor(ae/this.blockSize);this.blockCache.has(de)||this.blockRequests.has(de)||(this.blockIdsToFetch.add(de),B.push(de)),this.blockRequests.has(de)&&w.push(this.blockRequests.get(de)),k.push(de)}}await async function(Z){return new Promise(N=>setTimeout(N,Z))}(),this.fetchBlocks(A);const P=[];for(const Z of B)this.blockRequests.has(Z)&&P.push(this.blockRequests.get(Z));await Promise.allSettled(w),await Promise.allSettled(P);const S=[],V=k.filter(Z=>this.abortedBlockIds.has(Z)||!this.blockCache.has(Z));if(V.forEach(Z=>this.blockIdsToFetch.add(Z)),V.length>0&&A&&!A.aborted){this.fetchBlocks(null);for(const Z of V){const N=this.blockRequests.get(Z);if(!N)throw new Error(`Block ${Z} is not in the block requests`);S.push(N)}await Promise.allSettled(S)}if(A&&A.aborted)throw new In("Request was aborted");const U=k.map(Z=>this.blockCache.get(Z)||this.evictedBlocks.get(Z)),q=U.filter(Z=>!Z);if(q.length)throw new Xo(q,"Request failed");const ne=new Map(function(Z,N){const se=Array.isArray(Z)?Z:Array.from(Z),ue=Array.isArray(N)?N:Array.from(N);return se.map((ae,de)=>[ae,ue[de]])}(k,U));return this.readSliceData(p,ne)}fetchBlocks(p){if(this.blockIdsToFetch.size>0){const A=this.groupBlocks(this.blockIdsToFetch),w=this.source.fetch(A,p);for(let B=0;B<A.length;++B){const k=A[B];for(const P of k.blockIds)this.blockRequests.set(P,(async()=>{try{const S=(await w)[B],V=P*this.blockSize,U=V-S.offset,q=Math.min(U+this.blockSize,S.data.byteLength),ne=S.data.slice(U,q),Z=new el(V,ne.byteLength,ne,P);this.blockCache.set(P,Z),this.abortedBlockIds.delete(P)}catch(S){if(S.name!=="AbortError")throw S;S.signal=p,this.blockCache.delete(P),this.abortedBlockIds.add(P)}finally{this.blockRequests.delete(P)}})())}this.blockIdsToFetch.clear()}}groupBlocks(p){const A=Array.from(p).sort((P,S)=>P-S);if(A.length===0)return[];let w=[],B=null;const k=[];for(const P of A)B===null||B+1===P?(w.push(P),B=P):(k.push(new Rr(w[0]*this.blockSize,w.length*this.blockSize,w)),w=[P],B=P);return k.push(new Rr(w[0]*this.blockSize,w.length*this.blockSize,w)),k}readSliceData(p,A){return p.map(w=>{let B=w.offset+w.length;this.fileSize!==null&&(B=Math.min(this.fileSize,B));const k=Math.floor(w.offset/this.blockSize),P=Math.floor(B/this.blockSize),S=new ArrayBuffer(w.length),V=new Uint8Array(S);for(let U=k;U<=P;++U){const q=A.get(U),ne=q.offset-w.offset;let Z,N=0,se=0;ne<0?N=-ne:ne>0&&(se=ne),Z=q.top-B<0?q.length-N:B-q.offset-N;const ue=new Uint8Array(q.data,N,Z);V.set(ue,se)}return S})}}class tl{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(p){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Fr{constructor(p){this.url=p}async request({headers:p,signal:A}={}){throw new Error("request is not implemented")}}class $r extends tl{constructor(p){super(),this.response=p}get status(){return this.response.status}getHeader(p){return this.response.headers.get(p)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class ua extends Fr{constructor(p,A){super(p),this.credentials=A}async request({headers:p,signal:A}={}){const w=await fetch(this.url,{headers:p,credentials:this.credentials,signal:A});return new $r(w)}}class Ps extends tl{constructor(p,A){super(),this.xhr=p,this.data=A}get status(){return this.xhr.status}getHeader(p){return this.xhr.getResponseHeader(p)}async getData(){return this.data}}class or extends Fr{constructRequest(p,A){return new Promise((w,B)=>{const k=new XMLHttpRequest;k.open("GET",this.url),k.responseType="arraybuffer";for(const[P,S]of Object.entries(p))k.setRequestHeader(P,S);k.onload=()=>{const P=k.response;w(new Ps(k,P))},k.onerror=B,k.onabort=()=>B(new In("Request aborted")),k.send(),A&&(A.aborted&&k.abort(),A.addEventListener("abort",()=>k.abort()))})}async request({headers:p,signal:A}={}){return await this.constructRequest(p,A)}}var Aa={};class bn extends tl{constructor(p,A){super(),this.response=p,this.dataPromise=A}get status(){return this.response.statusCode}getHeader(p){return this.response.headers[p]}async getData(){return await this.dataPromise}}class tr extends Fr{constructor(p){super(p),this.parsedUrl=Aa.parse(this.url),this.httpApi=(this.parsedUrl.protocol,Aa)}constructRequest(p,A){return new Promise((w,B)=>{const k=this.httpApi.get({...this.parsedUrl,headers:p},P=>{const S=new Promise(V=>{const U=[];P.on("data",q=>{U.push(q)}),P.on("end",()=>{const q=Buffer.concat(U).buffer;V(q)}),P.on("error",B)});w(new bn(P,S))});k.on("error",B),A&&(A.aborted&&k.destroy(new In("Request aborted")),A.addEventListener("abort",()=>k.destroy(new In("Request aborted"))))})}async request({headers:p,signal:A}={}){return await this.constructRequest(p,A)}}class da extends Ar{constructor(p,A,w,B){super(),this.client=p,this.headers=A,this.maxRanges=w,this.allowFullFile=B,this._fileSize=null}async fetch(p,A){return this.maxRanges>=p.length?this.fetchSlices(p,A):(this.maxRanges>0&&p.length,Promise.all(p.map(w=>this.fetchSlice(w,A))))}async fetchSlices(p,A){const w=await this.client.request({headers:{...this.headers,Range:`bytes=${p.map(({offset:B,length:k})=>`${B}-${B+k}`).join(",")}`},signal:A});if(w.ok){if(w.status===206){const{type:B,params:k}=function(ne){const[Z,...N]=ne.split(";").map(se=>se.trim());return{type:Z,params:Li(N.map(se=>se.split("=")))}}(w.getHeader("content-type"));if(B==="multipart/byteranges"){const ne=function(Z,N){let se=null;const ue=new TextDecoder("ascii"),ae=[],de=`--${N}`,xe=`${de}--`;for(let be=0;be<10;++be)ue.decode(new Uint8Array(Z,be,de.length))===de&&(se=be);if(se===null)throw new Error("Could not find initial boundary");for(;se<Z.byteLength;){const be=ue.decode(new Uint8Array(Z,se,Math.min(de.length+1024,Z.byteLength-se)));if(be.length===0||be.startsWith(xe))break;if(!be.startsWith(de))throw new Error("Part does not start with boundary");const Se=be.substr(de.length+2);if(Se.length===0)break;const K=Se.indexOf(hi),G=ji(Se.substr(0,K)),{start:Ae,end:re,total:le}=ar(G["content-range"]),ge=se+de.length+K+4,De=parseInt(re,10)+1-parseInt(Ae,10);ae.push({headers:G,data:Z.slice(ge,ge+De),offset:Ae,length:De,fileSize:le}),se=ge+De+4}return ae}(await w.getData(),k.boundary);return this._fileSize=ne[0].fileSize||null,ne}const P=await w.getData(),{start:S,end:V,total:U}=ar(w.getHeader("content-range"));this._fileSize=U||null;const q=[{data:P,offset:S,length:V-S}];if(p.length>1){const ne=await Promise.all(p.slice(1).map(Z=>this.fetchSlice(Z,A)));return q.concat(ne)}return q}{if(!this.allowFullFile)throw new Error("Server responded with full file");const B=await w.getData();return this._fileSize=B.byteLength,[{data:B,offset:0,length:B.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(p,A){const{offset:w,length:B}=p,k=await this.client.request({headers:{...this.headers,Range:`bytes=${w}-${w+B}`},signal:A});if(k.ok){if(k.status===206){const P=await k.getData(),{total:S}=ar(k.getHeader("content-range"));return this._fileSize=S||null,{data:P,offset:w,length:B}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const P=await k.getData();return this._fileSize=P.byteLength,{data:P,offset:0,length:P.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Wr(m,{blockSize:p,cacheSize:A}){return p===null?m:new Zr(m,{blockSize:p,cacheSize:A})}function il(m,{forceXHR:p=!1,...A}={}){return typeof fetch!="function"||p?typeof XMLHttpRequest<"u"?function(w,{headers:B={},maxRanges:k=0,allowFullFile:P=!1,...S}={}){const V=new or(w);return Wr(new da(V,B,k,P),S)}(m,A):function(w,{headers:B={},maxRanges:k=0,allowFullFile:P=!1,...S}={}){const V=new tr(w);return Wr(new da(V,B,k,P),S)}(m,A):function(w,{headers:B={},credentials:k,maxRanges:P=0,allowFullFile:S=!1,...V}={}){const U=new ua(w,k);return Wr(new da(U,B,P,S),V)}(m,A)}function vn(m,p){let A=m.length-p,w=0;do{for(let B=p;B>0;B--)m[w+p]+=m[w],w++;A-=p}while(A>0)}function _c(m,p,A){let w=0,B=m.length;const k=B/A;for(;B>p;){for(let S=p;S>0;--S)m[w+p]+=m[w],++w;B-=p}const P=m.slice();for(let S=0;S<k;++S)for(let V=0;V<A;++V)m[A*S+V]=P[(A-V-1)*k+S]}class Gn{async decode(p,A){const w=await this.decodeBlock(A),B=p.Predictor||1;if(B!==1){const k=!p.StripOffsets;return function(P,S,V,U,q,ne){if(S===1)return P;for(let se=0;se<q.length;++se){if(q[se]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(q[se]!==q[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const Z=q[0]/8,N=ne===2?1:q.length;for(let se=0;se<U&&!(se*N*V*Z>=P.byteLength);++se){let ue;if(S===2){switch(q[0]){case 8:ue=new Uint8Array(P,se*N*V*Z,N*V*Z);break;case 16:ue=new Uint16Array(P,se*N*V*Z,N*V*Z/2);break;case 32:ue=new Uint32Array(P,se*N*V*Z,N*V*Z/4);break;default:throw new Error(`Predictor 2 not allowed with ${q[0]} bits per sample.`)}vn(ue,N)}else S===3&&(ue=new Uint8Array(P,se*N*V*Z,N*V*Z),_c(ue,N,Z))}return P}(w,B,k?p.TileWidth:p.ImageWidth,k?p.TileLength:p.RowsPerStrip||p.ImageLength,p.BitsPerSample,p.PlanarConfiguration)}return w}}function ts(m){switch(m){case Wt.BYTE:case Wt.ASCII:case Wt.SBYTE:case Wt.UNDEFINED:return 1;case Wt.SHORT:case Wt.SSHORT:return 2;case Wt.LONG:case Wt.SLONG:case Wt.FLOAT:case Wt.IFD:return 4;case Wt.RATIONAL:case Wt.SRATIONAL:case Wt.DOUBLE:case Wt.LONG8:case Wt.SLONG8:case Wt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${m}`)}}function Xr(m,p,A,w){let B=null,k=null;const P=ts(p);switch(p){case Wt.BYTE:case Wt.ASCII:case Wt.UNDEFINED:B=new Uint8Array(A),k=m.readUint8;break;case Wt.SBYTE:B=new Int8Array(A),k=m.readInt8;break;case Wt.SHORT:B=new Uint16Array(A),k=m.readUint16;break;case Wt.SSHORT:B=new Int16Array(A),k=m.readInt16;break;case Wt.LONG:case Wt.IFD:B=new Uint32Array(A),k=m.readUint32;break;case Wt.SLONG:B=new Int32Array(A),k=m.readInt32;break;case Wt.LONG8:case Wt.IFD8:B=new Array(A),k=m.readUint64;break;case Wt.SLONG8:B=new Array(A),k=m.readInt64;break;case Wt.RATIONAL:B=new Uint32Array(2*A),k=m.readUint32;break;case Wt.SRATIONAL:B=new Int32Array(2*A),k=m.readInt32;break;case Wt.FLOAT:B=new Float32Array(A),k=m.readFloat32;break;case Wt.DOUBLE:B=new Float64Array(A),k=m.readFloat64;break;default:throw new RangeError(`Invalid field type: ${p}`)}if(p!==Wt.RATIONAL&&p!==Wt.SRATIONAL)for(let S=0;S<A;++S)B[S]=k.call(m,w+S*P);else for(let S=0;S<A;S+=2)B[S]=k.call(m,w+S*P),B[S+1]=k.call(m,w+(S*P+4));return p===Wt.ASCII?new TextDecoder("utf-8").decode(B):B}class Di{constructor(p,A,w){this.fileDirectory=p,this.geoKeyDirectory=A,this.nextIFDByteOffset=w}}class fa extends Error{constructor(p){super(`No image at index ${p}`),this.index=p}}class rl{async readRasters(p={}){const{window:A,width:w,height:B}=p;let{resX:k,resY:P,bbox:S}=p;const V=await this.getImage();let U=V;const q=await this.getImageCount(),ne=V.getBoundingBox();if(A&&S)throw new Error('Both "bbox" and "window" passed.');if(w||B){if(A){const[se,ue]=V.getOrigin(),[ae,de]=V.getResolution();S=[se+A[0]*ae,ue+A[1]*de,se+A[2]*ae,ue+A[3]*de]}const N=S||ne;if(w){if(k)throw new Error("Both width and resX passed");k=(N[2]-N[0])/w}if(B){if(P)throw new Error("Both width and resY passed");P=(N[3]-N[1])/B}}if(k||P){const N=[];for(let se=0;se<q;++se){const ue=await this.getImage(se),{SubfileType:ae,NewSubfileType:de}=ue.fileDirectory;(se===0||ae===2||1&de)&&N.push(ue)}N.sort((se,ue)=>se.getWidth()-ue.getWidth());for(let se=0;se<N.length;++se){const ue=N[se],ae=(ne[2]-ne[0])/ue.getWidth(),de=(ne[3]-ne[1])/ue.getHeight();if(U=ue,k&&k>ae||P&&P>de)break}}let Z=A;if(S){const[N,se]=V.getOrigin(),[ue,ae]=U.getResolution(V);Z=[Math.round((S[0]-N)/ue),Math.round((S[1]-se)/ae),Math.round((S[2]-N)/ue),Math.round((S[3]-se)/ae)],Z=[Math.min(Z[0],Z[2]),Math.min(Z[1],Z[3]),Math.max(Z[0],Z[2]),Math.max(Z[1],Z[3])]}return U.readRasters({...p,window:Z})}}class Is extends rl{constructor(p,A,w,B,k={}){super(),this.source=p,this.littleEndian=A,this.bigTiff=w,this.firstIFDOffset=B,this.cache=k.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(p,A){const w=this.bigTiff?4048:1024;return new fi((await this.source.fetch([{offset:p,length:A!==void 0?A:w}]))[0],p,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(p){const A=this.bigTiff?20:12,w=this.bigTiff?8:2;let B=await this.getSlice(p);const k=this.bigTiff?B.readUint64(p):B.readUint16(p),P=k*A+(this.bigTiff?16:6);B.covers(p,P)||(B=await this.getSlice(p,P));const S={};let V=p+(this.bigTiff?8:2);for(let ne=0;ne<k;V+=A,++ne){const Z=B.readUint16(V),N=B.readUint16(V+2),se=this.bigTiff?B.readUint64(V+4):B.readUint32(V+4);let ue,ae;const de=ts(N),xe=V+(this.bigTiff?12:8);if(de*se<=(this.bigTiff?8:4))ue=Xr(B,N,se,xe);else{const be=B.readOffset(xe),Se=ts(N)*se;B.covers(be,Se)?ue=Xr(B,N,se,be):ue=Xr(await this.getSlice(be,Se),N,se,be)}ae=se===1&&li.indexOf(Z)===-1&&N!==Wt.RATIONAL&&N!==Wt.SRATIONAL?ue[0]:ue,S[hn[Z]]=ae}const U=function(ne){const Z=ne.GeoKeyDirectory;if(!Z)return null;const N={};for(let se=4;se<=4*Z[3];se+=4){const ue=Te[Z[se]],ae=Z[se+1]?hn[Z[se+1]]:null,de=Z[se+2],xe=Z[se+3];let be=null;if(ae){if(be=ne[ae],be==null)throw new Error(`Could not get value of geoKey '${ue}'.`);typeof be=="string"?be=be.substring(xe,xe+de-1):be.subarray&&(be=be.subarray(xe,xe+de),de===1&&(be=be[0]))}else be=xe;N[ue]=be}return N}(S),q=B.readOffset(p+w+A*k);return new Di(S,U,q)}async requestIFD(p){if(this.ifdRequests[p])return this.ifdRequests[p];if(p===0)return this.ifdRequests[p]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[p];if(!this.ifdRequests[p-1])try{this.ifdRequests[p-1]=this.requestIFD(p-1)}catch(A){throw A instanceof fa?new fa(p):A}return this.ifdRequests[p]=(async()=>{const A=await this.ifdRequests[p-1];if(A.nextIFDByteOffset===0)throw new fa(p);return this.parseFileDirectoryAt(A.nextIFDByteOffset)})(),this.ifdRequests[p]}async getImage(p=0){const A=await this.requestIFD(p);return new si(A.fileDirectory,A.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let p=0,A=!0;for(;A;)try{await this.requestIFD(p),++p}catch(w){if(!(w instanceof fa))throw w;A=!1}return p}async getGhostValues(){const p=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const A="GDAL_STRUCTURAL_METADATA_SIZE=";let w=await this.getSlice(p,130);if(A===Xr(w,Wt.ASCII,30,p)){const B=Xr(w,Wt.ASCII,130,p).split(`
`)[0],k=Number(B.split("=")[1].split(" ")[0])+B.length;k>130&&(w=await this.getSlice(p,k));const P=Xr(w,Wt.ASCII,k,p);this.ghostValues={},P.split(`
`).filter(S=>S.length>0).map(S=>S.split("=")).forEach(([S,V])=>{this.ghostValues[S]=V})}return this.ghostValues}static async fromSource(p,A,w){const B=(await p.fetch([{offset:0,length:1024}],w))[0],k=new xi(B),P=k.getUint16(0,0);let S;if(P===18761)S=!0;else{if(P!==19789)throw new TypeError("Invalid byte order value.");S=!1}const V=k.getUint16(2,S);let U;if(V===42)U=!1;else{if(V!==43)throw new TypeError("Invalid magic number.");if(U=!0,k.getUint16(4,S)!==8)throw new Error("Unsupported offset byte-size.")}const q=U?k.getUint64(8,S):k.getUint32(4,S);return new Is(p,S,U,q,A)}close(){return typeof this.source.close=="function"&&this.source.close()}}var ho={exports:{}};(function(m,p){var A=function(){var w={},B=Math.PI/180,k=180/Math.PI,P=6378137,S=20037508342789244e-9;function V(q){return Number(q)===q&&q%1!=0}function U(q){if(q=q||{},this.size=q.size||256,this.expansion=q.antimeridian===!0?2:1,!w[this.size]){var ne=this.size,Z=w[this.size]={};Z.Bc=[],Z.Cc=[],Z.zc=[],Z.Ac=[];for(var N=0;N<30;N++)Z.Bc.push(ne/360),Z.Cc.push(ne/(2*Math.PI)),Z.zc.push(ne/2),Z.Ac.push(ne),ne*=2}this.Bc=w[this.size].Bc,this.Cc=w[this.size].Cc,this.zc=w[this.size].zc,this.Ac=w[this.size].Ac}return U.prototype.px=function(q,ne){if(V(ne)){var Z=this.size*Math.pow(2,ne),N=Z/2,se=Z/360,ue=Z/(2*Math.PI),ae=Z,de=Math.min(Math.max(Math.sin(B*q[1]),-.9999),.9999),xe=N+q[0]*se,be=N+.5*Math.log((1+de)/(1-de))*-ue;return xe>ae*this.expansion&&(xe=ae*this.expansion),be>ae&&(be=ae),[xe,be]}return N=this.zc[ne],de=Math.min(Math.max(Math.sin(B*q[1]),-.9999),.9999),xe=Math.round(N+q[0]*this.Bc[ne]),be=Math.round(N+.5*Math.log((1+de)/(1-de))*-this.Cc[ne]),xe>this.Ac[ne]*this.expansion&&(xe=this.Ac[ne]*this.expansion),be>this.Ac[ne]&&(be=this.Ac[ne]),[xe,be]},U.prototype.ll=function(q,ne){if(V(ne)){var Z=this.size*Math.pow(2,ne),N=Z/360,se=Z/(2*Math.PI),ue=Z/2,ae=(q[1]-ue)/-se;return[(q[0]-ue)/N,k*(2*Math.atan(Math.exp(ae))-.5*Math.PI)]}return ae=(q[1]-this.zc[ne])/-this.Cc[ne],[(q[0]-this.zc[ne])/this.Bc[ne],k*(2*Math.atan(Math.exp(ae))-.5*Math.PI)]},U.prototype.bbox=function(q,ne,Z,N,se){N&&(ne=Math.pow(2,Z)-1-ne);var ue=[q*this.size,(+ne+1)*this.size],ae=[(+q+1)*this.size,ne*this.size],de=this.ll(ue,Z).concat(this.ll(ae,Z));return se==="900913"?this.convert(de,"900913"):de},U.prototype.xyz=function(q,ne,Z,N){N==="900913"&&(q=this.convert(q,"WGS84"));var se=[q[0],q[1]],ue=[q[2],q[3]],ae=this.px(se,ne),de=this.px(ue,ne),xe=[Math.floor(ae[0]/this.size),Math.floor((de[0]-1)/this.size)],be=[Math.floor(de[1]/this.size),Math.floor((ae[1]-1)/this.size)],Se={minX:Math.min.apply(Math,xe)<0?0:Math.min.apply(Math,xe),minY:Math.min.apply(Math,be)<0?0:Math.min.apply(Math,be),maxX:Math.max.apply(Math,xe),maxY:Math.max.apply(Math,be)};if(Z){var K={minY:Math.pow(2,ne)-1-Se.maxY,maxY:Math.pow(2,ne)-1-Se.minY};Se.minY=K.minY,Se.maxY=K.maxY}return Se},U.prototype.convert=function(q,ne){return ne==="900913"?this.forward(q.slice(0,2)).concat(this.forward(q.slice(2,4))):this.inverse(q.slice(0,2)).concat(this.inverse(q.slice(2,4)))},U.prototype.forward=function(q){var ne=[P*q[0]*B,P*Math.log(Math.tan(.25*Math.PI+.5*q[1]*B))];return ne[0]>S&&(ne[0]=S),ne[0]<-S&&(ne[0]=-S),ne[1]>S&&(ne[1]=S),ne[1]<-S&&(ne[1]=-S),ne},U.prototype.inverse=function(q){return[q[0]*k/P,(.5*Math.PI-2*Math.atan(Math.exp(-q[1]/P)))*k]},U}();m.exports=A})(ho);const wn=256,is=4007501668557849e-8,Ls=new(vr(ho.exports))({size:wn,antimeridian:!0}),ga=({x:m,y:p,z:A})=>Ls.bbox(m,p,A,!1,"900913"),uo=36e5;let nl;const sl=new dr({maxSize:16,maxAge:uo}),Ol=new dr({maxSize:16,maxAge:uo}),bs=new dr({maxSize:1024,maxAge:uo}),Rs=m=>{nl===void 0&&(nl=new Ki);const p=w=>{const B=sl.get(w);if(B)return B;{const k=async function(P,S={},V){return Is.fromSource(il(P,S),V)}(w);return sl.set(w,k),k}},A=async()=>{var k;const w=Ol.get(m);if(w)return w;{const P=await p(m),S=await P.getImage(),V=S.getGDALMetadata(0),U=S.fileDirectory,q=(k=S.fileDirectory)==null?void 0:k.Artist,ne=(([ue,ae,de,xe])=>[...Ls.inverse([ue,ae]),...Ls.inverse([de,xe])])(S.getBoundingBox()),Z=[],N=await P.getImageCount();for(let ue=0;ue<N;ue++){const ae=await P.getImage(ue),de=(B=ae.getResolution(S)[0],Math.log2(is/(wn*B))),xe=!!(1&ae.fileDirectory.NewSubfileType),be=!!(4&ae.fileDirectory.NewSubfileType);Z.push({zoom:de,isOverview:xe,isMask:be})}const se={offset:(V==null?void 0:V.OFFSET)!==void 0?parseFloat(V.OFFSET):0,scale:(V==null?void 0:V.SCALE)!==void 0?parseFloat(V.SCALE):1,noData:S.getGDALNoData()??void 0,photometricInterpretation:U==null?void 0:U.PhotometricInterpretation,bitsPerSample:U==null?void 0:U.BitsPerSample,colorMap:U==null?void 0:U.ColorMap,artist:q,bbox:ne,images:Z};return Ol.set(m,se),se}var B};return{getTilejson:async w=>{const{artist:B,images:k,bbox:P}=await A(),S=k.map(V=>V.zoom);return{tilejson:"2.2.0",tiles:[w+"/{z}/{x}/{y}"],attribution:B,minzoom:Math.round(Math.min(...S)),maxzoom:Math.round(Math.max(...S)),bounds:P}},getMetadata:A,getRawTile:async({z:w,x:B,y:k},P=256)=>{const S=`${m}/${P}/${w}/${B}/${k}`,V=bs.get(S);if(V)return V;{const U=await p(m),{noData:q}=await A(),ne=q===void 0||isNaN(q)?1/0:q,Z=U.readRasters({bbox:ga({x:B,y:k,z:w}),width:P,height:P,interleave:!1,resampleMethod:"nearest",pool:nl,fillValue:ne});return bs.set(S,Z),Z}}}};function _r(m,p){return m==null||p==null?NaN:m<p?-1:m>p?1:m>=p?0:NaN}function zr(m,p){return m==null||p==null?NaN:p<m?-1:p>m?1:p>=m?0:NaN}function Ua(m){let p,A,w;function B(k,P,S=0,V=k.length){if(S<V){if(p(P,P)!==0)return V;do{const U=S+V>>>1;A(k[U],P)<0?S=U+1:V=U}while(S<V)}return S}return m.length!==2?(p=_r,A=(k,P)=>_r(m(k),P),w=(k,P)=>m(k)-P):(p=m===_r||m===zr?m:Ao,A=m,w=m),{left:B,center:function(k,P,S=0,V=k.length){const U=B(k,P,S,V-1);return U>S&&w(k[U-1],P)>-w(k[U],P)?U-1:U},right:function(k,P,S=0,V=k.length){if(S<V){if(p(P,P)!==0)return V;do{const U=S+V>>>1;A(k[U],P)<=0?S=U+1:V=U}while(S<V)}return S}}}function Ao(){return 0}const Na=Ua(_r).right;Ua(function(m){return m===null?NaN:+m}).center;const ql=Math.sqrt(50),pa=Math.sqrt(10),Ic=Math.sqrt(2);function Oa(m,p,A){const w=(p-m)/Math.max(0,A),B=Math.floor(Math.log10(w)),k=w/Math.pow(10,B),P=k>=ql?10:k>=pa?5:k>=Ic?2:1;let S,V,U;return B<0?(U=Math.pow(10,-B)/P,S=Math.round(m*U),V=Math.round(p*U),S/U<m&&++S,V/U>p&&--V,U=-U):(U=Math.pow(10,B)*P,S=Math.round(m/U),V=Math.round(p/U),S*U<m&&++S,V*U>p&&--V),V<S&&.5<=A&&A<2?Oa(m,p,2*A):[S,V,U]}function fo(m,p,A){return Oa(m=+m,p=+p,A=+A)[2]}function Vl(m,p){switch(arguments.length){case 0:break;case 1:this.range(m);break;default:this.range(p).domain(m)}return this}function al(m,p,A){m.prototype=p.prototype=A,A.constructor=m}function ol(m,p){var A=Object.create(m.prototype);for(var w in p)A[w]=p[w];return A}function rs(){}var Fs=.7,zs=1/Fs,vs="\\s*([+-]?\\d+)\\s*",Gs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",hr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bc=/^#([0-9a-f]{3,8})$/,ll=new RegExp(`^rgb\\(${vs},${vs},${vs}\\)$`),Us=new RegExp(`^rgb\\(${hr},${hr},${hr}\\)$`),ws=new RegExp(`^rgba\\(${vs},${vs},${vs},${Gs}\\)$`),Ti=new RegExp(`^rgba\\(${hr},${hr},${hr},${Gs}\\)$`),go=new RegExp(`^hsl\\(${Gs},${hr},${hr}\\)$`),vc=new RegExp(`^hsla\\(${Gs},${hr},${hr},${Gs}\\)$`),Ns={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Hl(){return this.rgb().formatHex()}function cl(){return this.rgb().formatRgb()}function qa(m){var p,A;return m=(m+"").trim().toLowerCase(),(p=bc.exec(m))?(A=p[1].length,p=parseInt(p[1],16),A===6?hl(p):A===3?new kr(p>>8&15|p>>4&240,p>>4&15|240&p,(15&p)<<4|15&p,1):A===8?ma(p>>24&255,p>>16&255,p>>8&255,(255&p)/255):A===4?ma(p>>12&15|p>>8&240,p>>8&15|p>>4&240,p>>4&15|240&p,((15&p)<<4|15&p)/255):null):(p=ll.exec(m))?new kr(p[1],p[2],p[3],1):(p=Us.exec(m))?new kr(255*p[1]/100,255*p[2]/100,255*p[3]/100,1):(p=ws.exec(m))?ma(p[1],p[2],p[3],p[4]):(p=Ti.exec(m))?ma(255*p[1]/100,255*p[2]/100,255*p[3]/100,p[4]):(p=go.exec(m))?dl(p[1],p[2]/100,p[3]/100,1):(p=vc.exec(m))?dl(p[1],p[2]/100,p[3]/100,p[4]):Ns.hasOwnProperty(m)?hl(Ns[m]):m==="transparent"?new kr(NaN,NaN,NaN,0):null}function hl(m){return new kr(m>>16&255,m>>8&255,255&m,1)}function ma(m,p,A,w){return w<=0&&(m=p=A=NaN),new kr(m,p,A,w)}function po(m,p,A,w){return arguments.length===1?((B=m)instanceof rs||(B=qa(B)),B?new kr((B=B.rgb()).r,B.g,B.b,B.opacity):new kr):new kr(m,p,A,w??1);var B}function kr(m,p,A,w){this.r=+m,this.g=+p,this.b=+A,this.opacity=+w}function ul(){return`#${Os(this.r)}${Os(this.g)}${Os(this.b)}`}function Al(){const m=Un(this.opacity);return`${m===1?"rgb(":"rgba("}${xs(this.r)}, ${xs(this.g)}, ${xs(this.b)}${m===1?")":`, ${m})`}`}function Un(m){return isNaN(m)?1:Math.max(0,Math.min(1,m))}function xs(m){return Math.max(0,Math.min(255,Math.round(m)||0))}function Os(m){return((m=xs(m))<16?"0":"")+m.toString(16)}function dl(m,p,A,w){return w<=0?m=p=A=NaN:A<=0||A>=1?m=p=NaN:p<=0&&(m=NaN),new xn(m,p,A,w)}function ya(m){if(m instanceof xn)return new xn(m.h,m.s,m.l,m.opacity);if(m instanceof rs||(m=qa(m)),!m)return new xn;if(m instanceof xn)return m;var p=(m=m.rgb()).r/255,A=m.g/255,w=m.b/255,B=Math.min(p,A,w),k=Math.max(p,A,w),P=NaN,S=k-B,V=(k+B)/2;return S?(P=p===k?(A-w)/S+6*(A<w):A===k?(w-p)/S+2:(p-A)/S+4,S/=V<.5?k+B:2-k-B,P*=60):S=V>0&&V<1?0:P,new xn(P,S,V,m.opacity)}function xn(m,p,A,w){this.h=+m,this.s=+p,this.l=+A,this.opacity=+w}function Va(m){return(m=(m||0)%360)<0?m+360:m}function mo(m){return Math.max(0,Math.min(1,m||0))}function fl(m,p,A){return 255*(m<60?p+(A-p)*m/60:m<180?A:m<240?p+(A-p)*(240-m)/60:p)}al(rs,qa,{copy(m){return Object.assign(new this.constructor,this,m)},displayable(){return this.rgb().displayable()},hex:Hl,formatHex:Hl,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return ya(this).formatHsl()},formatRgb:cl,toString:cl}),al(kr,po,ol(rs,{brighter(m){return m=m==null?zs:Math.pow(zs,m),new kr(this.r*m,this.g*m,this.b*m,this.opacity)},darker(m){return m=m==null?Fs:Math.pow(Fs,m),new kr(this.r*m,this.g*m,this.b*m,this.opacity)},rgb(){return this},clamp(){return new kr(xs(this.r),xs(this.g),xs(this.b),Un(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ul,formatHex:ul,formatHex8:function(){return`#${Os(this.r)}${Os(this.g)}${Os(this.b)}${Os(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Al,toString:Al})),al(xn,function(m,p,A,w){return arguments.length===1?ya(m):new xn(m,p,A,w??1)},ol(rs,{brighter(m){return m=m==null?zs:Math.pow(zs,m),new xn(this.h,this.s,this.l*m,this.opacity)},darker(m){return m=m==null?Fs:Math.pow(Fs,m),new xn(this.h,this.s,this.l*m,this.opacity)},rgb(){var m=this.h%360+360*(this.h<0),p=isNaN(m)||isNaN(this.s)?0:this.s,A=this.l,w=A+(A<.5?A:1-A)*p,B=2*A-w;return new kr(fl(m>=240?m-240:m+120,B,w),fl(m,B,w),fl(m<120?m+240:m-120,B,w),this.opacity)},clamp(){return new xn(Va(this.h),mo(this.s),mo(this.l),Un(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const m=Un(this.opacity);return`${m===1?"hsl(":"hsla("}${Va(this.h)}, ${100*mo(this.s)}%, ${100*mo(this.l)}%${m===1?")":`, ${m})`}`}}));var yo=m=>()=>m;function jl(m){return(m=+m)==1?gl:function(p,A){return A-p?function(w,B,k){return w=Math.pow(w,k),B=Math.pow(B,k)-w,k=1/k,function(P){return Math.pow(w+P*B,k)}}(p,A,m):yo(isNaN(p)?A:p)}}function gl(m,p){var A=p-m;return A?function(w,B){return function(k){return w+k*B}}(m,A):yo(isNaN(m)?p:m)}var _o=function m(p){var A=jl(p);function w(B,k){var P=A((B=po(B)).r,(k=po(k)).r),S=A(B.g,k.g),V=A(B.b,k.b),U=gl(B.opacity,k.opacity);return function(q){return B.r=P(q),B.g=S(q),B.b=V(q),B.opacity=U(q),B+""}}return w.gamma=m,w}(1);function Jl(m,p){p||(p=[]);var A,w=m?Math.min(p.length,m.length):0,B=p.slice();return function(k){for(A=0;A<w;++A)B[A]=m[A]*(1-k)+p[A]*k;return B}}function Io(m,p){var A,w=p?p.length:0,B=m?Math.min(w,m.length):0,k=new Array(B),P=new Array(w);for(A=0;A<B;++A)k[A]=ss(m[A],p[A]);for(;A<w;++A)P[A]=p[A];return function(S){for(A=0;A<B;++A)P[A]=k[A](S);return P}}function ns(m,p){var A=new Date;return m=+m,p=+p,function(w){return A.setTime(m*(1-w)+p*w),A}}function _a(m,p){return m=+m,p=+p,function(A){return m*(1-A)+p*A}}function pl(m,p){var A,w={},B={};for(A in m!==null&&typeof m=="object"||(m={}),p!==null&&typeof p=="object"||(p={}),p)A in m?w[A]=ss(m[A],p[A]):B[A]=p[A];return function(k){for(A in w)B[A]=w[A](k);return B}}var Ha=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ia=new RegExp(Ha.source,"g");function ml(m,p){var A,w,B,k=Ha.lastIndex=Ia.lastIndex=0,P=-1,S=[],V=[];for(m+="",p+="";(A=Ha.exec(m))&&(w=Ia.exec(p));)(B=w.index)>k&&(B=p.slice(k,B),S[P]?S[P]+=B:S[++P]=B),(A=A[0])===(w=w[0])?S[P]?S[P]+=w:S[++P]=w:(S[++P]=null,V.push({i:P,x:_a(A,w)})),k=Ia.lastIndex;return k<p.length&&(B=p.slice(k),S[P]?S[P]+=B:S[++P]=B),S.length<2?V[0]?function(U){return function(q){return U(q)+""}}(V[0].x):function(U){return function(){return U}}(p):(p=V.length,function(U){for(var q,ne=0;ne<p;++ne)S[(q=V[ne]).i]=q.x(U);return S.join("")})}function ss(m,p){var A,w,B=typeof p;return p==null||B==="boolean"?yo(p):(B==="number"?_a:B==="string"?(A=qa(p))?(p=A,_o):ml:p instanceof qa?_o:p instanceof Date?ns:(w=p,!ArrayBuffer.isView(w)||w instanceof DataView?Array.isArray(p)?Io:typeof p.valueOf!="function"&&typeof p.toString!="function"||isNaN(p)?pl:_a:Jl))(m,p)}function yl(m,p){return m=+m,p=+p,function(A){return Math.round(m*(1-A)+p*A)}}function wc(m){return+m}var Zi=[0,1];function ba(m){return m}function ci(m,p){return(p-=m=+m)?function(w){return(w-m)/p}:(A=isNaN(p)?NaN:.5,function(){return A});var A}function bo(m,p,A){var w=m[0],B=m[1],k=p[0],P=p[1];return B<w?(w=ci(B,w),k=A(P,k)):(w=ci(w,B),k=A(k,P)),function(S){return k(w(S))}}function Ui(m,p,A){var w=Math.min(m.length,p.length)-1,B=new Array(w),k=new Array(w),P=-1;for(m[w]<m[0]&&(m=m.slice().reverse(),p=p.slice().reverse());++P<w;)B[P]=ci(m[P],m[P+1]),k[P]=A(p[P],p[P+1]);return function(S){var V=Na(m,S,1,w)-1;return k[V](B[V](S))}}function Fi(){var m,p,A,w,B,k,P=Zi,S=Zi,V=ss,U=ba;function q(){var Z,N,se,ue=Math.min(P.length,S.length);return U!==ba&&(Z=P[0],N=P[ue-1],Z>N&&(se=Z,Z=N,N=se),U=function(ae){return Math.max(Z,Math.min(N,ae))}),w=ue>2?Ui:bo,B=k=null,ne}function ne(Z){return Z==null||isNaN(Z=+Z)?A:(B||(B=w(P.map(m),S,V)))(m(U(Z)))}return ne.invert=function(Z){return U(p((k||(k=w(S,P.map(m),_a)))(Z)))},ne.domain=function(Z){return arguments.length?(P=Array.from(Z,wc),q()):P.slice()},ne.range=function(Z){return arguments.length?(S=Array.from(Z),q()):S.slice()},ne.rangeRound=function(Z){return S=Array.from(Z),V=yl,q()},ne.clamp=function(Z){return arguments.length?(U=!!Z||ba,q()):U!==ba},ne.interpolate=function(Z){return arguments.length?(V=Z,q()):V},ne.unknown=function(Z){return arguments.length?(A=Z,ne):A},function(Z,N){return m=Z,p=N,q()}}function Nn(m,p){if((A=(m=p?m.toExponential(p-1):m.toExponential()).indexOf("e"))<0)return null;var A,w=m.slice(0,A);return[w.length>1?w[0]+w.slice(2):w,+m.slice(A+1)]}function On(m){return(m=Nn(Math.abs(m)))?m[1]:NaN}var va,_l=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function qn(m){if(!(p=_l.exec(m)))throw new Error("invalid format: "+m);var p;return new Bs({fill:p[1],align:p[2],sign:p[3],symbol:p[4],zero:p[5],width:p[6],comma:p[7],precision:p[8]&&p[8].slice(1),trim:p[9],type:p[10]})}function Bs(m){this.fill=m.fill===void 0?" ":m.fill+"",this.align=m.align===void 0?">":m.align+"",this.sign=m.sign===void 0?"-":m.sign+"",this.symbol=m.symbol===void 0?"":m.symbol+"",this.zero=!!m.zero,this.width=m.width===void 0?void 0:+m.width,this.comma=!!m.comma,this.precision=m.precision===void 0?void 0:+m.precision,this.trim=!!m.trim,this.type=m.type===void 0?"":m.type+""}function en(m,p){var A=Nn(m,p);if(!A)return m+"";var w=A[0],B=A[1];return B<0?"0."+new Array(-B).join("0")+w:w.length>B+1?w.slice(0,B+1)+"."+w.slice(B+1):w+new Array(B-w.length+2).join("0")}qn.prototype=Bs.prototype,Bs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var vo={"%":(m,p)=>(100*m).toFixed(p),b:m=>Math.round(m).toString(2),c:m=>m+"",d:function(m){return Math.abs(m=Math.round(m))>=1e21?m.toLocaleString("en").replace(/,/g,""):m.toString(10)},e:(m,p)=>m.toExponential(p),f:(m,p)=>m.toFixed(p),g:(m,p)=>m.toPrecision(p),o:m=>Math.round(m).toString(8),p:(m,p)=>en(100*m,p),r:en,s:function(m,p){var A=Nn(m,p);if(!A)return m+"";var w=A[0],B=A[1],k=B-(va=3*Math.max(-8,Math.min(8,Math.floor(B/3))))+1,P=w.length;return k===P?w:k>P?w+new Array(k-P+1).join("0"):k>0?w.slice(0,k)+"."+w.slice(k):"0."+new Array(1-k).join("0")+Nn(m,Math.max(0,p+k-1))[0]},X:m=>Math.round(m).toString(16).toUpperCase(),x:m=>Math.round(m).toString(16)};function wo(m){return m}var ja,Cs,wa,xa=Array.prototype.map,qs=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Ja(m){var p,A,w=m.grouping===void 0||m.thousands===void 0?wo:(p=xa.call(m.grouping,Number),A=m.thousands+"",function(Z,N){for(var se=Z.length,ue=[],ae=0,de=p[0],xe=0;se>0&&de>0&&(xe+de+1>N&&(de=Math.max(1,N-xe)),ue.push(Z.substring(se-=de,se+de)),!((xe+=de+1)>N));)de=p[ae=(ae+1)%p.length];return ue.reverse().join(A)}),B=m.currency===void 0?"":m.currency[0]+"",k=m.currency===void 0?"":m.currency[1]+"",P=m.decimal===void 0?".":m.decimal+"",S=m.numerals===void 0?wo:function(Z){return function(N){return N.replace(/[0-9]/g,function(se){return Z[+se]})}}(xa.call(m.numerals,String)),V=m.percent===void 0?"%":m.percent+"",U=m.minus===void 0?"":m.minus+"",q=m.nan===void 0?"NaN":m.nan+"";function ne(Z){var N=(Z=qn(Z)).fill,se=Z.align,ue=Z.sign,ae=Z.symbol,de=Z.zero,xe=Z.width,be=Z.comma,Se=Z.precision,K=Z.trim,G=Z.type;G==="n"?(be=!0,G="g"):vo[G]||(Se===void 0&&(Se=12),K=!0,G="g"),(de||N==="0"&&se==="=")&&(de=!0,N="0",se="=");var Ae=ae==="$"?B:ae==="#"&&/[boxX]/.test(G)?"0"+G.toLowerCase():"",re=ae==="$"?k:/[%p]/.test(G)?V:"",le=vo[G],ge=/[defgprs%]/.test(G);function De(Be){var ke,Oe,Ze,We=Ae,rt=re;if(G==="c")rt=le(Be)+rt,Be="";else{var pt=(Be=+Be)<0||1/Be<0;if(Be=isNaN(Be)?q:le(Math.abs(Be),Se),K&&(Be=function(it){e:for(var Dt,ft=it.length,Rt=1,At=-1;Rt<ft;++Rt)switch(it[Rt]){case".":At=Dt=Rt;break;case"0":At===0&&(At=Rt),Dt=Rt;break;default:if(!+it[Rt])break e;At>0&&(At=0)}return At>0?it.slice(0,At)+it.slice(Dt+1):it}(Be)),pt&&+Be==0&&ue!=="+"&&(pt=!1),We=(pt?ue==="("?ue:U:ue==="-"||ue==="("?"":ue)+We,rt=(G==="s"?qs[8+va/3]:"")+rt+(pt&&ue==="("?")":""),ge){for(ke=-1,Oe=Be.length;++ke<Oe;)if(48>(Ze=Be.charCodeAt(ke))||Ze>57){rt=(Ze===46?P+Be.slice(ke+1):Be.slice(ke))+rt,Be=Be.slice(0,ke);break}}}be&&!de&&(Be=w(Be,1/0));var Ve=We.length+Be.length+rt.length,ze=Ve<xe?new Array(xe-Ve+1).join(N):"";switch(be&&de&&(Be=w(ze+Be,ze.length?xe-rt.length:1/0),ze=""),se){case"<":Be=We+Be+rt+ze;break;case"=":Be=We+ze+Be+rt;break;case"^":Be=ze.slice(0,Ve=ze.length>>1)+We+Be+rt+ze.slice(Ve);break;default:Be=ze+We+Be+rt}return S(Be)}return Se=Se===void 0?6:/[gprs]/.test(G)?Math.max(1,Math.min(21,Se)):Math.max(0,Math.min(20,Se)),De.toString=function(){return Z+""},De}return{format:ne,formatPrefix:function(Z,N){var se=ne(((Z=qn(Z)).type="f",Z)),ue=3*Math.max(-8,Math.min(8,Math.floor(On(N)/3))),ae=Math.pow(10,-ue),de=qs[8+ue/3];return function(xe){return se(ae*xe)+de}}}}function xo(m,p,A,w){var B,k=function(S,V,U){U=+U;const q=(V=+V)<(S=+S),ne=q?fo(V,S,U):fo(S,V,U);return(q?-1:1)*(ne<0?1/-ne:ne)}(m,p,A);switch((w=qn(w??",f")).type){case"s":var P=Math.max(Math.abs(m),Math.abs(p));return w.precision!=null||isNaN(B=function(S,V){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(On(V)/3)))-On(Math.abs(S)))}(k,P))||(w.precision=B),wa(w,P);case"":case"e":case"g":case"p":case"r":w.precision!=null||isNaN(B=function(S,V){return S=Math.abs(S),V=Math.abs(V)-S,Math.max(0,On(V)-On(S))+1}(k,Math.max(Math.abs(m),Math.abs(p))))||(w.precision=B-(w.type==="e"));break;case"f":case"%":w.precision!=null||isNaN(B=function(S){return Math.max(0,-On(Math.abs(S)))}(k))||(w.precision=B-2*(w.type==="%"))}return Cs(w)}function Ba(m){var p=m.domain;return m.ticks=function(A){var w=p();return function(B,k,P){if(!((P=+P)>0))return[];if((B=+B)==(k=+k))return[B];const S=k<B,[V,U,q]=S?Oa(k,B,P):Oa(B,k,P);if(!(U>=V))return[];const ne=U-V+1,Z=new Array(ne);if(S)if(q<0)for(let N=0;N<ne;++N)Z[N]=(U-N)/-q;else for(let N=0;N<ne;++N)Z[N]=(U-N)*q;else if(q<0)for(let N=0;N<ne;++N)Z[N]=(V+N)/-q;else for(let N=0;N<ne;++N)Z[N]=(V+N)*q;return Z}(w[0],w[w.length-1],A??10)},m.tickFormat=function(A,w){var B=p();return xo(B[0],B[B.length-1],A??10,w)},m.nice=function(A){A==null&&(A=10);var w,B,k=p(),P=0,S=k.length-1,V=k[P],U=k[S],q=10;for(U<V&&(B=V,V=U,U=B,B=P,P=S,S=B);q-- >0;){if((B=fo(V,U,A))===w)return k[P]=V,k[S]=U,p(k);if(B>0)V=Math.floor(V/B)*B,U=Math.ceil(U/B)*B;else{if(!(B<0))break;V=Math.ceil(V*B)/B,U=Math.floor(U*B)/B}w=B}return m},m}function Vs(){var m=Fi()(ba,ba);return m.copy=function(){return p=m,Vs().domain(p.domain()).range(p.range()).interpolate(p.interpolate()).clamp(p.clamp()).unknown(p.unknown());var p},Vl.apply(m,arguments),Ba(m)}function Il(){var m,p=[.5],A=[0,1],w=1;function B(k){return k!=null&&k<=k?A[Na(p,k,0,w)]:m}return B.domain=function(k){return arguments.length?(p=Array.from(k),w=Math.min(p.length,A.length-1),B):p.slice()},B.range=function(k){return arguments.length?(A=Array.from(k),w=Math.min(p.length,A.length-1),B):A.slice()},B.invertExtent=function(k){var P=A.indexOf(k);return[p[P-1],p[P]]},B.unknown=function(k){return arguments.length?(m=k,B):m},B.copy=function(){return Il().domain(p).range(A).unknown(m)},Vl.apply(B,arguments)}ja=Ja({thousands:",",grouping:[3],currency:["$",""]}),Cs=ja.format,wa=ja.formatPrefix;const Bo={BrewerYlGn3:["#f7fcb9","#addd8e","#31a354"],BrewerYlGn4:["#ffffcc","#c2e699","#78c679","#238443"],BrewerYlGn5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],BrewerYlGn6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],BrewerYlGn7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],BrewerYlGnBu3:["#edf8b1","#7fcdbb","#2c7fb8"],BrewerYlGnBu4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],BrewerYlGnBu5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],BrewerGnBu3:["#e0f3db","#a8ddb5","#43a2ca"],BrewerGnBu4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],BrewerGnBu5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],BrewerBuGn3:["#e5f5f9","#99d8c9","#2ca25f"],BrewerBuGn4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],BrewerBuGn5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],BrewerPuBuGn3:["#ece2f0","#a6bddb","#1c9099"],BrewerPuBuGn4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],BrewerPuBuGn5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],BrewerPuBu3:["#ece7f2","#a6bddb","#2b8cbe"],BrewerPuBu4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],BrewerPuBu5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BrewerBuPu3:["#e0ecf4","#9ebcda","#8856a7"],BrewerBuPu4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],BrewerBuPu5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],BrewerBuPu6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],BrewerBuPu7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],BrewerRdPu3:["#fde0dd","#fa9fb5","#c51b8a"],BrewerRdPu4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],BrewerRdPu5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],BrewerRdPu6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],BrewerRdPu7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],BrewerPuRd3:["#e7e1ef","#c994c7","#dd1c77"],BrewerPuRd4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],BrewerPuRd5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],BrewerPuRd6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],BrewerPuRd7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],BrewerOrRd3:["#fee8c8","#fdbb84","#e34a33"],BrewerOrRd4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],BrewerOrRd5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],BrewerOrRd6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],BrewerOrRd7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],BrewerYlOrRd3:["#ffeda0","#feb24c","#f03b20"],BrewerYlOrRd4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],BrewerYlOrRd5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],BrewerYlOrBr3:["#fff7bc","#fec44f","#d95f0e"],BrewerYlOrBr4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],BrewerYlOrBr5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],BrewerYlOrBr6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],BrewerYlOrBr7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],BrewerPurples3:["#efedf5","#bcbddc","#756bb1"],BrewerPurples4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],BrewerPurples5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],BrewerPurples6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],BrewerPurples7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],BrewerBlues3:["#deebf7","#9ecae1","#3182bd"],BrewerBlues4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],BrewerBlues5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],BrewerBlues6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],BrewerBlues7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],BrewerGreens3:["#e5f5e0","#a1d99b","#31a354"],BrewerGreens4:["#edf8e9","#bae4b3","#74c476","#238b45"],BrewerGreens5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],BrewerGreens6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],BrewerGreens7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],BrewerOranges3:["#fee6ce","#fdae6b","#e6550d"],BrewerOranges4:["#feedde","#fdbe85","#fd8d3c","#d94701"],BrewerOranges5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],BrewerOranges6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],BrewerOranges7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BrewerReds3:["#fee0d2","#fc9272","#de2d26"],BrewerReds4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],BrewerReds5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],BrewerReds6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],BrewerReds7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],BrewerGreys3:["#f0f0f0","#bdbdbd","#636363"],BrewerGreys4:["#f7f7f7","#cccccc","#969696","#525252"],BrewerGreys5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],BrewerGreys6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],BrewerGreys7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],BrewerPuOr3:["#f1a340","#f7f7f7","#998ec3"],BrewerPuOr4:["#e66101","#fdb863","#b2abd2","#5e3c99"],BrewerPuOr5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],BrewerPuOr6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],BrewerPuOr7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],BrewerPuOr8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerPuOr11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerBrBG3:["#d8b365","#f5f5f5","#5ab4ac"],BrewerBrBG4:["#a6611a","#dfc27d","#80cdc1","#018571"],BrewerBrBG5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],BrewerBrBG6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerBrBG11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerPRGn3:["#af8dc3","#f7f7f7","#7fbf7b"],BrewerPRGn4:["#7b3294","#c2a5cf","#a6dba0","#008837"],BrewerPRGn5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],BrewerPRGn6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPRGn11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPiYG3:["#e9a3c9","#f7f7f7","#a1d76a"],BrewerPiYG4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],BrewerPiYG5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],BrewerPiYG6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerPiYG11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerRdBu3:["#ef8a62","#f7f7f7","#67a9cf"],BrewerRdBu4:["#ca0020","#f4a582","#92c5de","#0571b0"],BrewerRdBu5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],BrewerRdBu6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdBu11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdGy3:["#ef8a62","#ffffff","#999999"],BrewerRdGy4:["#ca0020","#f4a582","#bababa","#404040"],BrewerRdGy5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],BrewerRdGy6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdGy11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdYlBu3:["#fc8d59","#ffffbf","#91bfdb"],BrewerRdYlBu4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],BrewerRdYlBu5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],BrewerRdYlBu6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerRdYlBu11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerSpectral3:["#fc8d59","#ffffbf","#99d594"],BrewerSpectral4:["#d7191c","#fdae61","#abdda4","#2b83ba"],BrewerSpectral5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],BrewerSpectral6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],BrewerSpectral7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],BrewerSpectral8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerSpectral11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerRdYlGn3:["#fc8d59","#ffffbf","#91cf60"],BrewerRdYlGn4:["#d7191c","#fdae61","#a6d96a","#1a9641"],BrewerRdYlGn5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],BrewerRdYlGn6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerRdYlGn11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerAccent3:["#7fc97f","#beaed4","#fdc086"],BrewerAccent4:["#7fc97f","#beaed4","#fdc086","#ffff99"],BrewerAccent5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],BrewerAccent6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],BrewerAccent7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],BrewerAccent8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],BrewerDark23:["#1b9e77","#d95f02","#7570b3"],BrewerDark24:["#1b9e77","#d95f02","#7570b3","#e7298a"],BrewerDark25:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],BrewerDark26:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],BrewerDark27:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],BrewerDark28:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],BrewerPaired3:["#a6cee3","#1f78b4","#b2df8a"],BrewerPaired4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],BrewerPaired5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],BrewerPaired6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],BrewerPaired7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],BrewerPaired8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],BrewerPaired9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],BrewerPaired10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],BrewerPaired11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],BrewerPaired12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],BrewerPastel13:["#fbb4ae","#b3cde3","#ccebc5"],BrewerPastel14:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],BrewerPastel15:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],BrewerPastel16:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],BrewerPastel17:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],BrewerPastel18:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],BrewerPastel19:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],BrewerPastel23:["#b3e2cd","#fdcdac","#cbd5e8"],BrewerPastel24:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],BrewerPastel25:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],BrewerPastel26:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],BrewerPastel27:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],BrewerPastel28:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],BrewerSet13:["#e41a1c","#377eb8","#4daf4a"],BrewerSet14:["#e41a1c","#377eb8","#4daf4a","#984ea3"],BrewerSet15:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],BrewerSet16:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],BrewerSet17:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],BrewerSet18:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],BrewerSet19:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],BrewerSet23:["#66c2a5","#fc8d62","#8da0cb"],BrewerSet24:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],BrewerSet25:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],BrewerSet26:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],BrewerSet27:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],BrewerSet28:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],BrewerSet33:["#8dd3c7","#ffffb3","#bebada"],BrewerSet34:["#8dd3c7","#ffffb3","#bebada","#fb8072"],BrewerSet35:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],BrewerSet36:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],BrewerSet37:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],BrewerSet38:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],BrewerSet39:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],BrewerSet310:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],BrewerSet311:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],BrewerSet312:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],CartoBurg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],CartoBurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],CartoRedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],CartoOrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],CartoPeach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],CartoPinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],CartoMint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],CartoBluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],CartoDarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],CartoEmrld:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],CartoBluYl:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],CartoTeal:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],CartoTealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],CartoPurp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],CartoPurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],CartoSunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],CartoMagenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],CartoSunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],CartoBrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],CartoArmyRose:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],CartoFall:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoGeyser:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoTemps:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],CartoTealRose:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],CartoTropic:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],CartoEarth:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"]},Bi=Object.keys(Bo),Co=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,xc=m=>{const p=Co.exec(m);if(p!==null)return[parseInt(p[1],16),parseInt(p[2],16),parseInt(p[3],16)];throw new Error(`Cannot parse hex color "${m}"`)},bl=({colorScheme:m,customColors:p,min:A,max:w,isReverse:B=!1,isContinuous:k=!1})=>{let P;if(m){if(S=m,!Bi.includes(S))throw new Error(`"${m}" is not a supported color scheme`);P=Bo[m]}else{if(!(p.length>=2))throw new Error("You must provide at least 2 colors");P=p}var S;const V=P.map(xc),U=B?V.reverse():V;if(k){const q=((ne,Z,N)=>Array.from({length:N},(se,ue)=>ne+ue*(Z-ne)/(N-1)))(A,w,U.length);return Vs(q,U).clamp(!0)}{const q=((ne,Z,N)=>Array.from({length:N-1},(se,ue)=>ne+(ue+1)*(Z-ne)/N))(A,w,U.length);return Il(q,U)}};var Gr;(function(m){m[m.WhiteIsZero=0]="WhiteIsZero",m[m.BlackIsZero=1]="BlackIsZero",m[m.RGB=2]="RGB",m[m.Palette=3]="Palette",m[m.TransparencyMask=4]="TransparencyMask",m[m.CMYK=5]="CMYK",m[m.YCbCr=6]="YCbCr",m[m.CIELab=8]="CIELab",m[m.ICCLab=9]="ICCLab"})(Gr||(Gr={}));const Yl=(m,{noData:p,photometricInterpretation:A,bitsPerSample:w,colorMap:B})=>{const k=w&&w[0]?2**w[0]:NaN,P=p??0;let S;switch(A){case Gr.WhiteIsZero:S=function(V,U,q){const ne=new Uint8ClampedArray(4*V[0].length);let Z;for(let N=0;N<V[0].length;N++)Z=255-V[0][N]/U*255,ne[4*N]=Z,ne[4*N+1]=Z,ne[4*N+2]=Z,ne[4*N+3]=V[0][N]===q?0:255;return ne}(m,k,P);break;case Gr.BlackIsZero:S=function(V,U,q){const ne=new Uint8ClampedArray(4*V[0].length);let Z;for(let N=0;N<V[0].length;N++)Z=V[0][N]/U*255,ne[4*N]=Z,ne[4*N+1]=Z,ne[4*N+2]=Z,ne[4*N+3]=V[0][N]===q?0:255;return ne}(m,k,P);break;case Gr.RGB:S=function(V,U){const[q,ne,Z]=V,N=new Uint8ClampedArray(4*V[0].length);for(let se=0;se<V[0].length;se++)N[4*se]=q[se],N[4*se+1]=ne[se],N[4*se+2]=Z[se],N[4*se+3]=q[se]===U&&ne[se]==U&&Z[se]==U?0:255;return N}(m,P);break;case Gr.Palette:if(!B)throw new Error("colorMap for paletted image not found.");S=function(V,U,q){const ne=new Uint8ClampedArray(4*V[0].length),Z=U.length/3,N=U.length/3*2;for(let se=0;se<V[0].length;se++){const ue=V[0][se];ne[4*se]=U[ue]/65536*256,ne[4*se+1]=U[ue+Z]/65536*256,ne[4*se+2]=U[ue+N]/65536*256,ne[4*se+3]=V[0][se]===q?0:255}return ne}(m,B,P);break;case Gr.CMYK:S=function(V,U){const q=new Uint8ClampedArray(4*V[0].length),[ne,Z,N,se]=V;for(let ue=0;ue<V.length;ue++){const ae=ne[ue],de=Z[ue],xe=N[ue],be=se[ue];q[4*ue]=(255-ae)/256*255*((255-be)/256),q[4*ue+1]=(255-de)/256*255*((255-be)/256),q[4*ue+2]=(255-xe)/256*255*((255-be)/256),q[4*ue+3]=ae===U&&de===U&&xe===U&&be===U?0:255}return q}(m,P);break;case Gr.YCbCr:S=function(V,U){const[q,ne,Z]=V,N=new Uint8ClampedArray(4*V[0].length);for(let se=0;se<V[0].length;se++){const ue=q[se],ae=ne[se],de=Z[se];N[4*se]=ue+1.402*(de-128),N[4*se+1]=ue-.34414*(ae-128)-.71414*(de-128),N[4*se+2]=ue+1.772*(ae-128),N[4*se+3]=ue===U&&ae==U&&de==U?0:255}return N}(m,P);break;case Gr.CIELab:S=function(V,U){const q=new Uint8ClampedArray(V[0].length);for(let ne=0;ne<V.length;ne++){const Z=V[0][ne],N=V[1][ne]<<24>>24,se=V[2][ne]<<24>>24;let ue,ae,de,xe=(Z+16)/116,be=N/500+xe,Se=xe-se/200;be=.95047*(be*be*be>.008856?be*be*be:(be-16/116)/7.787),xe=1*(xe*xe*xe>.008856?xe*xe*xe:(xe-16/116)/7.787),Se=1.08883*(Se*Se*Se>.008856?Se*Se*Se:(Se-16/116)/7.787),ue=3.2406*be+-1.5372*xe+-.4986*Se,ae=-.9689*be+1.8758*xe+.0415*Se,de=.0557*be+-.204*xe+1.057*Se,ue=ue>.0031308?1.055*ue**(1/2.4)-.055:12.92*ue,ae=ae>.0031308?1.055*ae**(1/2.4)-.055:12.92*ae,de=de>.0031308?1.055*de**(1/2.4)-.055:12.92*de,q[4*ne]=255*Math.max(0,Math.min(1,ue)),q[4*ne+1]=255*Math.max(0,Math.min(1,ae)),q[4*ne+2]=255*Math.max(0,Math.min(1,de)),q[4*ne+3]=Z===U&&N==U&&se==U?0:255}return q}(m,P);break;default:throw new Error("Unsupported photometric interpretation.")}return S},Eo=async m=>{var N,se;const p=new RegExp(/cog:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),A=m.match(p);if(!A)throw new Error(`Invalid COG protocol URL '${m}'`);const w=A[1].split("#"),B=w[0];w.shift();const k=w.join("#")??"",P=parseInt(A[2]),S=parseInt(A[3]),V=parseInt(A[4]),U=Rs(B),q=await U.getRawTile({z:P,x:S,y:V}),ne=await U.getMetadata();let Z;if(k.startsWith("dem"))Z=((ue,{offset:ae,scale:de,noData:xe})=>{const be=ue[0],Se=be.length,K=new Uint8ClampedArray(4*Se);for(let G=0;G<Se;G++){const Ae=ae+be[G]*de,re=((Ae==xe?0:Ae)- -1e4)/.1;K[4*G]=Math.floor(re/256/256)%256,K[4*G+1]=Math.floor(re/256)%256,K[4*G+2]=re%256,K[4*G+3]=255}return K})(q,ne);else if(k.startsWith("color")){const ue=(N=k.split("color").pop())==null?void 0:N.substring(1);if(!ue)throw new Error("Color params are not defined");{const ae=(se=ue.match(/\[("#([0-9a-fA-F]{3,6})"(,(\s)?)?)+\]/))==null?void 0:se[0];let de,xe,be,Se="",K=[];ae?(K=JSON.parse(ae),[de,xe,be]=ue.replace(`${ae},`,"").split(",")):[Se,de,xe,be]=ue.split(",");const G=parseFloat(de),Ae=parseFloat(xe),re=(be==null?void 0:be.includes("-"))||!1,le=(be==null?void 0:be.includes("c"))||!1;Z=((ge,{offset:De,scale:Be,noData:ke,colorScale:Oe})=>{const Ze=ge[0],We=Ze.length,rt=new Uint8ClampedArray(4*We),pt=bl(Oe);for(let Ve=0;Ve<We;Ve++){const ze=De+Ze[Ve]*Be;if(ze===ke||isNaN(ze)||ze===1/0)rt[4*Ve]=0,rt[4*Ve+1]=0,rt[4*Ve+2]=0,rt[4*Ve+3]=0;else{const it=pt(ze);rt[4*Ve]=it[0],rt[4*Ve+1]=it[1],rt[4*Ve+2]=it[2],rt[4*Ve+3]=255}}return rt})(q,{...ne,colorScale:{colorScheme:Se,customColors:K,min:G,max:Ae,isReverse:re,isContinuous:le}})}}else Z=Yl(q,ne);return await createImageBitmap(new ImageData(Z,256,256))};var Kl=Object.freeze({__proto__:null,default:class extends Gn{decodeBlock(m){return m}}});const Qo=257;function Ca(m,p){for(let A=p.length-1;A>=0;A--)m.push(p[A]);return m}function ko(m){const p=new Uint16Array(4093),A=new Uint8Array(4093);for(let se=0;se<=257;se++)p[se]=4096,A[se]=se;let w=258,B=9,k=0;function P(){w=258,B=9}function S(se){const ue=function(ae,de,xe){const be=de%8,Se=Math.floor(de/8),K=8-be,G=de+xe-8*(Se+1);let Ae=8*(Se+2)-(de+xe);const re=8*(Se+2)-de;if(Ae=Math.max(0,Ae),Se>=ae.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),Qo;let le=ae[Se]&2**(8-be)-1;le<<=xe-K;let ge=le;if(Se+1<ae.length){let De=ae[Se+1]>>>Ae;De<<=Math.max(0,xe-re),ge+=De}if(G>8&&Se+2<ae.length){const De=8*(Se+3)-(de+xe);ge+=ae[Se+2]>>>De}return ge}(se,k,B);return k+=B,ue}function V(se,ue){return A[w]=ue,p[w]=se,w++,w-1}function U(se){const ue=[];for(let ae=se;ae!==4096;ae=p[ae])ue.push(A[ae]);return ue}const q=[];P();const ne=new Uint8Array(m);let Z,N=S(ne);for(;N!==Qo;){if(N===256){for(P(),N=S(ne);N===256;)N=S(ne);if(N===Qo)break;if(N>256)throw new Error(`corrupted code at scanline ${N}`);Ca(q,U(N)),Z=N}else if(N<w){const se=U(N);Ca(q,se),V(Z,se[se.length-1]),Z=N}else{const se=U(Z);if(!se)throw new Error(`Bogus entry. Not in dictionary, ${Z} / ${w}, position: ${k}`);Ca(q,se),q.push(se[se.length-1]),V(Z,se[se.length-1]),Z=N}w+1>=2**B&&(B===12?Z=void 0:B++),N=S(ne)}return new Uint8Array(q)}var Ea=Object.freeze({__proto__:null,default:class extends Gn{decodeBlock(m){return ko(m).buffer}}});const Vn=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),as=4017,Qa=799,os=3406,Es=2276,Hs=1567,js=3784,Qs=5793,So=2896;function vl(m,p){let A=0;const w=[];let B=16;for(;B>0&&!m[B-1];)--B;w.push({children:[],index:0});let k,P=w[0];for(let S=0;S<B;S++){for(let V=0;V<m[S];V++){for(P=w.pop(),P.children[P.index]=p[A];P.index>0;)P=w.pop();for(P.index++,w.push(P);w.length<=S;)w.push(k={children:[],index:0}),P.children[P.index]=k.children,P=k;A++}S+1<B&&(w.push(k={children:[],index:0}),P.children[P.index]=k.children,P=k)}return w[0].children}function Do(m,p,A,w,B,k,P,S,V){const{mcusPerLine:U,progressive:q}=A,ne=p;let Z=p,N=0,se=0;function ue(){if(se>0)return se--,N>>se&1;if(N=m[Z++],N===255){const Ve=m[Z++];if(Ve)throw new Error(`unexpected marker: ${(N<<8|Ve).toString(16)}`)}return se=7,N>>>7}function ae(Ve){let ze,it=Ve;for(;(ze=ue())!==null;){if(it=it[ze],typeof it=="number")return it;if(typeof it!="object")throw new Error("invalid huffman sequence")}return null}function de(Ve){let ze=Ve,it=0;for(;ze>0;){const Dt=ue();if(Dt===null)return;it=it<<1|Dt,--ze}return it}function xe(Ve){const ze=de(Ve);return ze>=1<<Ve-1?ze:ze+(-1<<Ve)+1}let be=0,Se,K=0;function G(Ve,ze,it,Dt,ft){const Rt=it%U,At=(it/U|0)*Ve.v+Dt,Ct=Rt*Ve.h+ft;ze(Ve,Ve.blocks[At][Ct])}function Ae(Ve,ze,it){const Dt=it/Ve.blocksPerLine|0,ft=it%Ve.blocksPerLine;ze(Ve,Ve.blocks[Dt][ft])}const re=w.length;let le,ge,De,Be,ke,Oe;Oe=q?k===0?S===0?function(Ve,ze){const it=ae(Ve.huffmanTableDC),Dt=it===0?0:xe(it)<<V;Ve.pred+=Dt,ze[0]=Ve.pred}:function(Ve,ze){ze[0]|=ue()<<V}:S===0?function(Ve,ze){if(be>0)return void be--;let it=k;const Dt=P;for(;it<=Dt;){const ft=ae(Ve.huffmanTableAC),Rt=15&ft,At=ft>>4;if(Rt===0){if(At<15){be=de(At)+(1<<At)-1;break}it+=16}else it+=At,ze[Vn[it]]=xe(Rt)*(1<<V),it++}}:function(Ve,ze){let it=k;const Dt=P;let ft=0;for(;it<=Dt;){const Rt=Vn[it],At=ze[Rt]<0?-1:1;switch(K){case 0:{const Ct=ae(Ve.huffmanTableAC),wt=15&Ct;if(ft=Ct>>4,wt===0)ft<15?(be=de(ft)+(1<<ft),K=4):(ft=16,K=1);else{if(wt!==1)throw new Error("invalid ACn encoding");Se=xe(wt),K=ft?2:3}continue}case 1:case 2:ze[Rt]?ze[Rt]+=(ue()<<V)*At:(ft--,ft===0&&(K=K===2?3:0));break;case 3:ze[Rt]?ze[Rt]+=(ue()<<V)*At:(ze[Rt]=Se<<V,K=0);break;case 4:ze[Rt]&&(ze[Rt]+=(ue()<<V)*At)}it++}K===4&&(be--,be===0&&(K=0))}:function(Ve,ze){const it=ae(Ve.huffmanTableDC),Dt=it===0?0:xe(it);Ve.pred+=Dt,ze[0]=Ve.pred;let ft=1;for(;ft<64;){const Rt=ae(Ve.huffmanTableAC),At=15&Rt,Ct=Rt>>4;if(At===0){if(Ct<15)break;ft+=16}else ft+=Ct,ze[Vn[ft]]=xe(At),ft++}};let Ze,We,rt=0;We=re===1?w[0].blocksPerLine*w[0].blocksPerColumn:U*A.mcusPerColumn;const pt=B||We;for(;rt<We;){for(ge=0;ge<re;ge++)w[ge].pred=0;if(be=0,re===1)for(le=w[0],ke=0;ke<pt;ke++)Ae(le,Oe,rt),rt++;else for(ke=0;ke<pt;ke++){for(ge=0;ge<re;ge++){le=w[ge];const{h:Ve,v:ze}=le;for(De=0;De<ze;De++)for(Be=0;Be<Ve;Be++)G(le,Oe,rt,De,Be)}if(rt++,rt===We)break}if(se=0,Ze=m[Z]<<8|m[Z+1],Ze<65280)throw new Error("marker was not found");if(!(Ze>=65488&&Ze<=65495))break;Z+=2}return Z-ne}function wl(m,p){const A=[],{blocksPerLine:w,blocksPerColumn:B}=p,k=w<<3,P=new Int32Array(64),S=new Uint8Array(64);function V(U,q,ne){const Z=p.quantizationTable;let N,se,ue,ae,de,xe,be,Se,K;const G=ne;let Ae;for(Ae=0;Ae<64;Ae++)G[Ae]=U[Ae]*Z[Ae];for(Ae=0;Ae<8;++Ae){const re=8*Ae;G[1+re]!==0||G[2+re]!==0||G[3+re]!==0||G[4+re]!==0||G[5+re]!==0||G[6+re]!==0||G[7+re]!==0?(N=Qs*G[0+re]+128>>8,se=Qs*G[4+re]+128>>8,ue=G[2+re],ae=G[6+re],de=So*(G[1+re]-G[7+re])+128>>8,Se=So*(G[1+re]+G[7+re])+128>>8,xe=G[3+re]<<4,be=G[5+re]<<4,K=N-se+1>>1,N=N+se+1>>1,se=K,K=ue*js+ae*Hs+128>>8,ue=ue*Hs-ae*js+128>>8,ae=K,K=de-be+1>>1,de=de+be+1>>1,be=K,K=Se+xe+1>>1,xe=Se-xe+1>>1,Se=K,K=N-ae+1>>1,N=N+ae+1>>1,ae=K,K=se-ue+1>>1,se=se+ue+1>>1,ue=K,K=de*Es+Se*os+2048>>12,de=de*os-Se*Es+2048>>12,Se=K,K=xe*Qa+be*as+2048>>12,xe=xe*as-be*Qa+2048>>12,be=K,G[0+re]=N+Se,G[7+re]=N-Se,G[1+re]=se+be,G[6+re]=se-be,G[2+re]=ue+xe,G[5+re]=ue-xe,G[3+re]=ae+de,G[4+re]=ae-de):(K=Qs*G[0+re]+512>>10,G[0+re]=K,G[1+re]=K,G[2+re]=K,G[3+re]=K,G[4+re]=K,G[5+re]=K,G[6+re]=K,G[7+re]=K)}for(Ae=0;Ae<8;++Ae){const re=Ae;G[8+re]!==0||G[16+re]!==0||G[24+re]!==0||G[32+re]!==0||G[40+re]!==0||G[48+re]!==0||G[56+re]!==0?(N=Qs*G[0+re]+2048>>12,se=Qs*G[32+re]+2048>>12,ue=G[16+re],ae=G[48+re],de=So*(G[8+re]-G[56+re])+2048>>12,Se=So*(G[8+re]+G[56+re])+2048>>12,xe=G[24+re],be=G[40+re],K=N-se+1>>1,N=N+se+1>>1,se=K,K=ue*js+ae*Hs+2048>>12,ue=ue*Hs-ae*js+2048>>12,ae=K,K=de-be+1>>1,de=de+be+1>>1,be=K,K=Se+xe+1>>1,xe=Se-xe+1>>1,Se=K,K=N-ae+1>>1,N=N+ae+1>>1,ae=K,K=se-ue+1>>1,se=se+ue+1>>1,ue=K,K=de*Es+Se*os+2048>>12,de=de*os-Se*Es+2048>>12,Se=K,K=xe*Qa+be*as+2048>>12,xe=xe*as-be*Qa+2048>>12,be=K,G[0+re]=N+Se,G[56+re]=N-Se,G[8+re]=se+be,G[48+re]=se-be,G[16+re]=ue+xe,G[40+re]=ue-xe,G[24+re]=ae+de,G[32+re]=ae-de):(K=Qs*ne[Ae+0]+8192>>14,G[0+re]=K,G[8+re]=K,G[16+re]=K,G[24+re]=K,G[32+re]=K,G[40+re]=K,G[48+re]=K,G[56+re]=K)}for(Ae=0;Ae<64;++Ae){const re=128+(G[Ae]+8>>4);q[Ae]=re<0?0:re>255?255:re}}for(let U=0;U<B;U++){const q=U<<3;for(let ne=0;ne<8;ne++)A.push(new Uint8Array(k));for(let ne=0;ne<w;ne++){V(p.blocks[U][ne],S,P);let Z=0;const N=ne<<3;for(let se=0;se<8;se++){const ue=A[q+se];for(let ae=0;ae<8;ae++)ue[N+ae]=S[Z++]}}}return A}class Ya{constructor(){this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}resetFrames(){this.frames=[]}parse(p){let A=0;function w(){const S=p[A]<<8|p[A+1];return A+=2,S}function B(){const S=w(),V=p.subarray(A,A+S-2);return A+=V.length,V}function k(S){let V,U,q=0,ne=0;for(U in S.components)S.components.hasOwnProperty(U)&&(V=S.components[U],q<V.h&&(q=V.h),ne<V.v&&(ne=V.v));const Z=Math.ceil(S.samplesPerLine/8/q),N=Math.ceil(S.scanLines/8/ne);for(U in S.components)if(S.components.hasOwnProperty(U)){V=S.components[U];const se=Math.ceil(Math.ceil(S.samplesPerLine/8)*V.h/q),ue=Math.ceil(Math.ceil(S.scanLines/8)*V.v/ne),ae=Z*V.h,de=N*V.v,xe=[];for(let be=0;be<de;be++){const Se=[];for(let K=0;K<ae;K++)Se.push(new Int32Array(64));xe.push(Se)}V.blocksPerLine=se,V.blocksPerColumn=ue,V.blocks=xe}S.maxH=q,S.maxV=ne,S.mcusPerLine=Z,S.mcusPerColumn=N}let P=w();if(P!==65496)throw new Error("SOI not found");for(P=w();P!==65497;){switch(P){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:{const S=B();P===65504&&S[0]===74&&S[1]===70&&S[2]===73&&S[3]===70&&S[4]===0&&(this.jfif={version:{major:S[5],minor:S[6]},densityUnits:S[7],xDensity:S[8]<<8|S[9],yDensity:S[10]<<8|S[11],thumbWidth:S[12],thumbHeight:S[13],thumbData:S.subarray(14,14+3*S[12]*S[13])}),P===65518&&S[0]===65&&S[1]===100&&S[2]===111&&S[3]===98&&S[4]===101&&S[5]===0&&(this.adobe={version:S[6],flags0:S[7]<<8|S[8],flags1:S[9]<<8|S[10],transformCode:S[11]});break}case 65499:{const S=w()+A-2;for(;A<S;){const V=p[A++],U=new Int32Array(64);if(V>>4){if(V>>4!=1)throw new Error("DQT: invalid table spec");for(let q=0;q<64;q++)U[Vn[q]]=w()}else for(let q=0;q<64;q++)U[Vn[q]]=p[A++];this.quantizationTables[15&V]=U}break}case 65472:case 65473:case 65474:{w();const S={extended:P===65473,progressive:P===65474,precision:p[A++],scanLines:w(),samplesPerLine:w(),components:{},componentsOrder:[]},V=p[A++];let U;for(let q=0;q<V;q++){U=p[A];const ne=p[A+1]>>4,Z=15&p[A+1],N=p[A+2];S.componentsOrder.push(U),S.components[U]={h:ne,v:Z,quantizationIdx:N},A+=3}k(S),this.frames.push(S);break}case 65476:{const S=w();for(let V=2;V<S;){const U=p[A++],q=new Uint8Array(16);let ne=0;for(let N=0;N<16;N++,A++)q[N]=p[A],ne+=q[N];const Z=new Uint8Array(ne);for(let N=0;N<ne;N++,A++)Z[N]=p[A];V+=17+ne,U>>4?this.huffmanTablesAC[15&U]=vl(q,Z):this.huffmanTablesDC[15&U]=vl(q,Z)}break}case 65501:w(),this.resetInterval=w();break;case 65498:{w();const S=p[A++],V=[],U=this.frames[0];for(let se=0;se<S;se++){const ue=U.components[p[A++]],ae=p[A++];ue.huffmanTableDC=this.huffmanTablesDC[ae>>4],ue.huffmanTableAC=this.huffmanTablesAC[15&ae],V.push(ue)}const q=p[A++],ne=p[A++],Z=p[A++],N=Do(p,A,U,V,this.resetInterval,q,ne,Z>>4,15&Z);A+=N;break}case 65535:p[A]!==255&&A--;break;default:if(p[A-3]===255&&p[A-2]>=192&&p[A-2]<=254){A-=3;break}throw new Error(`unknown JPEG marker ${P.toString(16)}`)}P=w()}}getResult(){const{frames:p}=this;if(this.frames.length===0)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(let q=0;q<this.frames.length;q++){const ne=this.frames[q].components;for(const Z of Object.keys(ne))ne[Z].quantizationTable=this.quantizationTables[ne[Z].quantizationIdx],delete ne[Z].quantizationIdx}const A=p[0],{components:w,componentsOrder:B}=A,k=[],P=A.samplesPerLine,S=A.scanLines;for(let q=0;q<B.length;q++){const ne=w[B[q]];k.push({lines:wl(0,ne),scaleX:ne.h/A.maxH,scaleY:ne.v/A.maxV})}const V=new Uint8Array(P*S*k.length);let U=0;for(let q=0;q<S;++q)for(let ne=0;ne<P;++ne)for(let Z=0;Z<k.length;++Z){const N=k[Z];V[U]=N.lines[0|q*N.scaleY][0|ne*N.scaleX],++U}return V}}var Ka=Object.freeze({__proto__:null,default:class extends Gn{constructor(m){super(),this.reader=new Ya,m.JPEGTables&&this.reader.parse(m.JPEGTables)}decodeBlock(m){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(m)),this.reader.getResult().buffer}}});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function ir(m){let p=m.length;for(;--p>=0;)m[p]=0}const Js=30,Zl=new Array(576);ir(Zl);const $l=new Array(60);ir($l);const Xi=new Array(512);ir(Xi);const Bn=new Array(256);ir(Bn);const tn=new Array(29);ir(tn);const Za=new Array(Js);ir(Za);var $a=(m,p,A,w)=>{let B=65535&m,k=m>>>16&65535,P=0;for(;A!==0;){P=A>2e3?2e3:A,A-=P;do B=B+p[w++]|0,k=k+B|0;while(--P);B%=65521,k%=65521}return B|k<<16};const Mo=new Uint32Array((()=>{let m,p=[];for(var A=0;A<256;A++){m=A;for(var w=0;w<8;w++)m=1&m?3988292384^m>>>1:m>>>1;p[A]=m}return p})());var Sr=(m,p,A,w)=>{const B=Mo,k=w+A;m^=-1;for(let P=w;P<k;P++)m=m>>>8^B[255&(m^p[P])];return~m},Cn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},To={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Po=(m,p)=>Object.prototype.hasOwnProperty.call(m,p);var Lo={assign:function(m){const p=Array.prototype.slice.call(arguments,1);for(;p.length;){const A=p.shift();if(A){if(typeof A!="object")throw new TypeError(A+"must be non-object");for(const w in A)Po(A,w)&&(m[w]=A[w])}}return m},flattenChunks:m=>{let p=0;for(let w=0,B=m.length;w<B;w++)p+=m[w].length;const A=new Uint8Array(p);for(let w=0,B=0,k=m.length;w<k;w++){let P=m[w];A.set(P,B),B+=P.length}return A}};let Wa=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Wa=!1}const Ys=new Uint8Array(256);for(let m=0;m<256;m++)Ys[m]=m>=252?6:m>=248?5:m>=240?4:m>=224?3:m>=192?2:1;Ys[254]=Ys[254]=1;var Xa={string2buf:m=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(m);let p,A,w,B,k,P=m.length,S=0;for(B=0;B<P;B++)A=m.charCodeAt(B),(64512&A)==55296&&B+1<P&&(w=m.charCodeAt(B+1),(64512&w)==56320&&(A=65536+(A-55296<<10)+(w-56320),B++)),S+=A<128?1:A<2048?2:A<65536?3:4;for(p=new Uint8Array(S),k=0,B=0;k<S;B++)A=m.charCodeAt(B),(64512&A)==55296&&B+1<P&&(w=m.charCodeAt(B+1),(64512&w)==56320&&(A=65536+(A-55296<<10)+(w-56320),B++)),A<128?p[k++]=A:A<2048?(p[k++]=192|A>>>6,p[k++]=128|63&A):A<65536?(p[k++]=224|A>>>12,p[k++]=128|A>>>6&63,p[k++]=128|63&A):(p[k++]=240|A>>>18,p[k++]=128|A>>>12&63,p[k++]=128|A>>>6&63,p[k++]=128|63&A);return p},buf2string:(m,p)=>{const A=p||m.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(m.subarray(0,p));let w,B;const k=new Array(2*A);for(B=0,w=0;w<A;){let P=m[w++];if(P<128){k[B++]=P;continue}let S=Ys[P];if(S>4)k[B++]=65533,w+=S-1;else{for(P&=S===2?31:S===3?15:7;S>1&&w<A;)P=P<<6|63&m[w++],S--;S>1?k[B++]=65533:P<65536?k[B++]=P:(P-=65536,k[B++]=55296|P>>10&1023,k[B++]=56320|1023&P)}}return((P,S)=>{if(S<65534&&P.subarray&&Wa)return String.fromCharCode.apply(null,P.length===S?P:P.subarray(0,S));let V="";for(let U=0;U<S;U++)V+=String.fromCharCode(P[U]);return V})(k,B)},utf8border:(m,p)=>{(p=p||m.length)>m.length&&(p=m.length);let A=p-1;for(;A>=0&&(192&m[A])==128;)A--;return A<0||A===0?p:A+Ys[m[A]]>p?A:p}},Ks=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Zs=16209;var eo=function(m,p){let A,w,B,k,P,S,V,U,q,ne,Z,N,se,ue,ae,de,xe,be,Se,K,G,Ae,re,le;const ge=m.state;A=m.next_in,re=m.input,w=A+(m.avail_in-5),B=m.next_out,le=m.output,k=B-(p-m.avail_out),P=B+(m.avail_out-257),S=ge.dmax,V=ge.wsize,U=ge.whave,q=ge.wnext,ne=ge.window,Z=ge.hold,N=ge.bits,se=ge.lencode,ue=ge.distcode,ae=(1<<ge.lenbits)-1,de=(1<<ge.distbits)-1;e:do{N<15&&(Z+=re[A++]<<N,N+=8,Z+=re[A++]<<N,N+=8),xe=se[Z&ae];t:for(;;){if(be=xe>>>24,Z>>>=be,N-=be,be=xe>>>16&255,be===0)le[B++]=65535&xe;else{if(!(16&be)){if(64&be){if(32&be){ge.mode=16191;break e}m.msg="invalid literal/length code",ge.mode=Zs;break e}xe=se[(65535&xe)+(Z&(1<<be)-1)];continue t}for(Se=65535&xe,be&=15,be&&(N<be&&(Z+=re[A++]<<N,N+=8),Se+=Z&(1<<be)-1,Z>>>=be,N-=be),N<15&&(Z+=re[A++]<<N,N+=8,Z+=re[A++]<<N,N+=8),xe=ue[Z&de];;){if(be=xe>>>24,Z>>>=be,N-=be,be=xe>>>16&255,16&be){if(K=65535&xe,be&=15,N<be&&(Z+=re[A++]<<N,N+=8,N<be&&(Z+=re[A++]<<N,N+=8)),K+=Z&(1<<be)-1,K>S){m.msg="invalid distance too far back",ge.mode=Zs;break e}if(Z>>>=be,N-=be,be=B-k,K>be){if(be=K-be,be>U&&ge.sane){m.msg="invalid distance too far back",ge.mode=Zs;break e}if(G=0,Ae=ne,q===0){if(G+=V-be,be<Se){Se-=be;do le[B++]=ne[G++];while(--be);G=B-K,Ae=le}}else if(q<be){if(G+=V+q-be,be-=q,be<Se){Se-=be;do le[B++]=ne[G++];while(--be);if(G=0,q<Se){be=q,Se-=be;do le[B++]=ne[G++];while(--be);G=B-K,Ae=le}}}else if(G+=q-be,be<Se){Se-=be;do le[B++]=ne[G++];while(--be);G=B-K,Ae=le}for(;Se>2;)le[B++]=Ae[G++],le[B++]=Ae[G++],le[B++]=Ae[G++],Se-=3;Se&&(le[B++]=Ae[G++],Se>1&&(le[B++]=Ae[G++]))}else{G=B-K;do le[B++]=le[G++],le[B++]=le[G++],le[B++]=le[G++],Se-=3;while(Se>2);Se&&(le[B++]=le[G++],Se>1&&(le[B++]=le[G++]))}break}if(64&be){m.msg="invalid distance code",ge.mode=Zs;break e}xe=ue[(65535&xe)+(Z&(1<<be)-1)]}}break}}while(A<w&&B<P);Se=N>>3,A-=Se,N-=Se<<3,Z&=(1<<N)-1,m.next_in=A,m.next_out=B,m.avail_in=A<w?w-A+5:5-(A-w),m.avail_out=B<P?P-B+257:257-(B-P),ge.hold=Z,ge.bits=N};const ka=15,xl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Bl=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Cl=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ro=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ls=(m,p,A,w,B,k,P,S)=>{const V=S.bits;let U,q,ne,Z,N,se,ue=0,ae=0,de=0,xe=0,be=0,Se=0,K=0,G=0,Ae=0,re=0,le=null;const ge=new Uint16Array(16),De=new Uint16Array(16);let Be,ke,Oe,Ze=null;for(ue=0;ue<=ka;ue++)ge[ue]=0;for(ae=0;ae<w;ae++)ge[p[A+ae]]++;for(be=V,xe=ka;xe>=1&&ge[xe]===0;xe--);if(be>xe&&(be=xe),xe===0)return B[k++]=20971520,B[k++]=20971520,S.bits=1,0;for(de=1;de<xe&&ge[de]===0;de++);for(be<de&&(be=de),G=1,ue=1;ue<=ka;ue++)if(G<<=1,G-=ge[ue],G<0)return-1;if(G>0&&(m===0||xe!==1))return-1;for(De[1]=0,ue=1;ue<ka;ue++)De[ue+1]=De[ue]+ge[ue];for(ae=0;ae<w;ae++)p[A+ae]!==0&&(P[De[p[A+ae]]++]=ae);if(m===0?(le=Ze=P,se=20):m===1?(le=xl,Ze=Bl,se=257):(le=Cl,Ze=Ro,se=0),re=0,ae=0,ue=de,N=k,Se=be,K=0,ne=-1,Ae=1<<be,Z=Ae-1,m===1&&Ae>852||m===2&&Ae>592)return 1;for(;;){Be=ue-K,P[ae]+1<se?(ke=0,Oe=P[ae]):P[ae]>=se?(ke=Ze[P[ae]-se],Oe=le[P[ae]-se]):(ke=96,Oe=0),U=1<<ue-K,q=1<<Se,de=q;do q-=U,B[N+(re>>K)+q]=Be<<24|ke<<16|Oe;while(q!==0);for(U=1<<ue-1;re&U;)U>>=1;if(U!==0?(re&=U-1,re+=U):re=0,ae++,--ge[ue]==0){if(ue===xe)break;ue=p[A+P[ae]]}if(ue>be&&(re&Z)!==ne){for(K===0&&(K=be),N+=de,Se=ue-K,G=1<<Se;Se+K<xe&&(G-=ge[Se+K],!(G<=0));)Se++,G<<=1;if(Ae+=1<<Se,m===1&&Ae>852||m===2&&Ae>592)return 1;ne=re&Z,B[ne]=be<<24|Se<<16|N-k}}return re!==0&&(B[N+re]=ue-K<<24|64<<16),S.bits=be,0};const{Z_FINISH:El,Z_BLOCK:An,Z_TREES:rn,Z_OK:cs,Z_STREAM_END:En,Z_NEED_DICT:$s,Z_STREAM_ERROR:dn,Z_DATA_ERROR:Wl,Z_MEM_ERROR:Ql,Z_BUF_ERROR:Xl,Z_DEFLATED:Fo}=To,hs=16180,Dr=16190,Bt=16191,Sa=16192,to=16194,io=16199,us=16200,ks=16206,qi=16209,gi=m=>(m>>>24&255)+(m>>>8&65280)+((65280&m)<<8)+((255&m)<<24);function kl(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ws=m=>{if(!m)return 1;const p=m.state;return!p||p.strm!==m||p.mode<hs||p.mode>16211?1:0},zo=m=>{if(Ws(m))return dn;const p=m.state;return m.total_in=m.total_out=p.total=0,m.msg="",p.wrap&&(m.adler=1&p.wrap),p.mode=hs,p.last=0,p.havedict=0,p.flags=-1,p.dmax=32768,p.head=null,p.hold=0,p.bits=0,p.lencode=p.lendyn=new Int32Array(852),p.distcode=p.distdyn=new Int32Array(592),p.sane=1,p.back=-1,cs},ec=m=>{if(Ws(m))return dn;const p=m.state;return p.wsize=0,p.whave=0,p.wnext=0,zo(m)},Xs=(m,p)=>{let A;if(Ws(m))return dn;const w=m.state;return p<0?(A=0,p=-p):(A=5+(p>>4),p<48&&(p&=15)),p&&(p<8||p>15)?dn:(w.window!==null&&w.wbits!==p&&(w.window=null),w.wrap=A,w.wbits=p,ec(m))},Sl=(m,p)=>{if(!m)return dn;const A=new kl;m.state=A,A.strm=m,A.window=null,A.mode=hs;const w=Xs(m,p);return w!==cs&&(m.state=null),w};let ro,Go,tc=!0;const Dl=m=>{if(tc){ro=new Int32Array(512),Go=new Int32Array(32);let p=0;for(;p<144;)m.lens[p++]=8;for(;p<256;)m.lens[p++]=9;for(;p<280;)m.lens[p++]=7;for(;p<288;)m.lens[p++]=8;for(ls(1,m.lens,0,288,ro,0,m.work,{bits:9}),p=0;p<32;)m.lens[p++]=5;ls(2,m.lens,0,32,Go,0,m.work,{bits:5}),tc=!1}m.lencode=ro,m.lenbits=9,m.distcode=Go,m.distbits=5},ic=(m,p,A,w)=>{let B;const k=m.state;return k.window===null&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new Uint8Array(k.wsize)),w>=k.wsize?(k.window.set(p.subarray(A-k.wsize,A),0),k.wnext=0,k.whave=k.wsize):(B=k.wsize-k.wnext,B>w&&(B=w),k.window.set(p.subarray(A-w,A-w+B),k.wnext),(w-=B)?(k.window.set(p.subarray(A-w,A),0),k.wnext=w,k.whave=k.wsize):(k.wnext+=B,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=B))),0};var Bc=(m,p)=>{let A,w,B,k,P,S,V,U,q,ne,Z,N,se,ue,ae,de,xe,be,Se,K,G,Ae,re=0;const le=new Uint8Array(4);let ge,De;const Be=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ws(m)||!m.output||!m.input&&m.avail_in!==0)return dn;A=m.state,A.mode===Bt&&(A.mode=Sa),P=m.next_out,B=m.output,V=m.avail_out,k=m.next_in,w=m.input,S=m.avail_in,U=A.hold,q=A.bits,ne=S,Z=V,Ae=cs;e:for(;;)switch(A.mode){case hs:if(A.wrap===0){A.mode=Sa;break}for(;q<16;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(2&A.wrap&&U===35615){A.wbits===0&&(A.wbits=15),A.check=0,le[0]=255&U,le[1]=U>>>8&255,A.check=Sr(A.check,le,2,0),U=0,q=0,A.mode=16181;break}if(A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&U)<<8)+(U>>8))%31){m.msg="incorrect header check",A.mode=qi;break}if((15&U)!==Fo){m.msg="unknown compression method",A.mode=qi;break}if(U>>>=4,q-=4,G=8+(15&U),A.wbits===0&&(A.wbits=G),G>15||G>A.wbits){m.msg="invalid window size",A.mode=qi;break}A.dmax=1<<A.wbits,A.flags=0,m.adler=A.check=1,A.mode=512&U?16189:Bt,U=0,q=0;break;case 16181:for(;q<16;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(A.flags=U,(255&A.flags)!==Fo){m.msg="unknown compression method",A.mode=qi;break}if(57344&A.flags){m.msg="unknown header flags set",A.mode=qi;break}A.head&&(A.head.text=U>>8&1),512&A.flags&&4&A.wrap&&(le[0]=255&U,le[1]=U>>>8&255,A.check=Sr(A.check,le,2,0)),U=0,q=0,A.mode=16182;case 16182:for(;q<32;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}A.head&&(A.head.time=U),512&A.flags&&4&A.wrap&&(le[0]=255&U,le[1]=U>>>8&255,le[2]=U>>>16&255,le[3]=U>>>24&255,A.check=Sr(A.check,le,4,0)),U=0,q=0,A.mode=16183;case 16183:for(;q<16;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}A.head&&(A.head.xflags=255&U,A.head.os=U>>8),512&A.flags&&4&A.wrap&&(le[0]=255&U,le[1]=U>>>8&255,A.check=Sr(A.check,le,2,0)),U=0,q=0,A.mode=16184;case 16184:if(1024&A.flags){for(;q<16;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}A.length=U,A.head&&(A.head.extra_len=U),512&A.flags&&4&A.wrap&&(le[0]=255&U,le[1]=U>>>8&255,A.check=Sr(A.check,le,2,0)),U=0,q=0}else A.head&&(A.head.extra=null);A.mode=16185;case 16185:if(1024&A.flags&&(N=A.length,N>S&&(N=S),N&&(A.head&&(G=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(w.subarray(k,k+N),G)),512&A.flags&&4&A.wrap&&(A.check=Sr(A.check,w,N,k)),S-=N,k+=N,A.length-=N),A.length))break e;A.length=0,A.mode=16186;case 16186:if(2048&A.flags){if(S===0)break e;N=0;do G=w[k+N++],A.head&&G&&A.length<65536&&(A.head.name+=String.fromCharCode(G));while(G&&N<S);if(512&A.flags&&4&A.wrap&&(A.check=Sr(A.check,w,N,k)),S-=N,k+=N,G)break e}else A.head&&(A.head.name=null);A.length=0,A.mode=16187;case 16187:if(4096&A.flags){if(S===0)break e;N=0;do G=w[k+N++],A.head&&G&&A.length<65536&&(A.head.comment+=String.fromCharCode(G));while(G&&N<S);if(512&A.flags&&4&A.wrap&&(A.check=Sr(A.check,w,N,k)),S-=N,k+=N,G)break e}else A.head&&(A.head.comment=null);A.mode=16188;case 16188:if(512&A.flags){for(;q<16;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(4&A.wrap&&U!==(65535&A.check)){m.msg="header crc mismatch",A.mode=qi;break}U=0,q=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),m.adler=A.check=0,A.mode=Bt;break;case 16189:for(;q<32;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}m.adler=A.check=gi(U),U=0,q=0,A.mode=Dr;case Dr:if(A.havedict===0)return m.next_out=P,m.avail_out=V,m.next_in=k,m.avail_in=S,A.hold=U,A.bits=q,$s;m.adler=A.check=1,A.mode=Bt;case Bt:if(p===An||p===rn)break e;case Sa:if(A.last){U>>>=7&q,q-=7&q,A.mode=ks;break}for(;q<3;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}switch(A.last=1&U,U>>>=1,q-=1,3&U){case 0:A.mode=16193;break;case 1:if(Dl(A),A.mode=io,p===rn){U>>>=2,q-=2;break e}break;case 2:A.mode=16196;break;case 3:m.msg="invalid block type",A.mode=qi}U>>>=2,q-=2;break;case 16193:for(U>>>=7&q,q-=7&q;q<32;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if((65535&U)!=(U>>>16^65535)){m.msg="invalid stored block lengths",A.mode=qi;break}if(A.length=65535&U,U=0,q=0,A.mode=to,p===rn)break e;case to:A.mode=16195;case 16195:if(N=A.length,N){if(N>S&&(N=S),N>V&&(N=V),N===0)break e;B.set(w.subarray(k,k+N),P),S-=N,k+=N,V-=N,P+=N,A.length-=N;break}A.mode=Bt;break;case 16196:for(;q<14;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(A.nlen=257+(31&U),U>>>=5,q-=5,A.ndist=1+(31&U),U>>>=5,q-=5,A.ncode=4+(15&U),U>>>=4,q-=4,A.nlen>286||A.ndist>30){m.msg="too many length or distance symbols",A.mode=qi;break}A.have=0,A.mode=16197;case 16197:for(;A.have<A.ncode;){for(;q<3;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}A.lens[Be[A.have++]]=7&U,U>>>=3,q-=3}for(;A.have<19;)A.lens[Be[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,ge={bits:A.lenbits},Ae=ls(0,A.lens,0,19,A.lencode,0,A.work,ge),A.lenbits=ge.bits,Ae){m.msg="invalid code lengths set",A.mode=qi;break}A.have=0,A.mode=16198;case 16198:for(;A.have<A.nlen+A.ndist;){for(;re=A.lencode[U&(1<<A.lenbits)-1],ae=re>>>24,de=re>>>16&255,xe=65535&re,!(ae<=q);){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(xe<16)U>>>=ae,q-=ae,A.lens[A.have++]=xe;else{if(xe===16){for(De=ae+2;q<De;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(U>>>=ae,q-=ae,A.have===0){m.msg="invalid bit length repeat",A.mode=qi;break}G=A.lens[A.have-1],N=3+(3&U),U>>>=2,q-=2}else if(xe===17){for(De=ae+3;q<De;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}U>>>=ae,q-=ae,G=0,N=3+(7&U),U>>>=3,q-=3}else{for(De=ae+7;q<De;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}U>>>=ae,q-=ae,G=0,N=11+(127&U),U>>>=7,q-=7}if(A.have+N>A.nlen+A.ndist){m.msg="invalid bit length repeat",A.mode=qi;break}for(;N--;)A.lens[A.have++]=G}}if(A.mode===qi)break;if(A.lens[256]===0){m.msg="invalid code -- missing end-of-block",A.mode=qi;break}if(A.lenbits=9,ge={bits:A.lenbits},Ae=ls(1,A.lens,0,A.nlen,A.lencode,0,A.work,ge),A.lenbits=ge.bits,Ae){m.msg="invalid literal/lengths set",A.mode=qi;break}if(A.distbits=6,A.distcode=A.distdyn,ge={bits:A.distbits},Ae=ls(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,ge),A.distbits=ge.bits,Ae){m.msg="invalid distances set",A.mode=qi;break}if(A.mode=io,p===rn)break e;case io:A.mode=us;case us:if(S>=6&&V>=258){m.next_out=P,m.avail_out=V,m.next_in=k,m.avail_in=S,A.hold=U,A.bits=q,eo(m,Z),P=m.next_out,B=m.output,V=m.avail_out,k=m.next_in,w=m.input,S=m.avail_in,U=A.hold,q=A.bits,A.mode===Bt&&(A.back=-1);break}for(A.back=0;re=A.lencode[U&(1<<A.lenbits)-1],ae=re>>>24,de=re>>>16&255,xe=65535&re,!(ae<=q);){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(de&&!(240&de)){for(be=ae,Se=de,K=xe;re=A.lencode[K+((U&(1<<be+Se)-1)>>be)],ae=re>>>24,de=re>>>16&255,xe=65535&re,!(be+ae<=q);){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}U>>>=be,q-=be,A.back+=be}if(U>>>=ae,q-=ae,A.back+=ae,A.length=xe,de===0){A.mode=16205;break}if(32&de){A.back=-1,A.mode=Bt;break}if(64&de){m.msg="invalid literal/length code",A.mode=qi;break}A.extra=15&de,A.mode=16201;case 16201:if(A.extra){for(De=A.extra;q<De;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}A.length+=U&(1<<A.extra)-1,U>>>=A.extra,q-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=16202;case 16202:for(;re=A.distcode[U&(1<<A.distbits)-1],ae=re>>>24,de=re>>>16&255,xe=65535&re,!(ae<=q);){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(!(240&de)){for(be=ae,Se=de,K=xe;re=A.distcode[K+((U&(1<<be+Se)-1)>>be)],ae=re>>>24,de=re>>>16&255,xe=65535&re,!(be+ae<=q);){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}U>>>=be,q-=be,A.back+=be}if(U>>>=ae,q-=ae,A.back+=ae,64&de){m.msg="invalid distance code",A.mode=qi;break}A.offset=xe,A.extra=15&de,A.mode=16203;case 16203:if(A.extra){for(De=A.extra;q<De;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}A.offset+=U&(1<<A.extra)-1,U>>>=A.extra,q-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){m.msg="invalid distance too far back",A.mode=qi;break}A.mode=16204;case 16204:if(V===0)break e;if(N=Z-V,A.offset>N){if(N=A.offset-N,N>A.whave&&A.sane){m.msg="invalid distance too far back",A.mode=qi;break}N>A.wnext?(N-=A.wnext,se=A.wsize-N):se=A.wnext-N,N>A.length&&(N=A.length),ue=A.window}else ue=B,se=P-A.offset,N=A.length;N>V&&(N=V),V-=N,A.length-=N;do B[P++]=ue[se++];while(--N);A.length===0&&(A.mode=us);break;case 16205:if(V===0)break e;B[P++]=A.length,V--,A.mode=us;break;case ks:if(A.wrap){for(;q<32;){if(S===0)break e;S--,U|=w[k++]<<q,q+=8}if(Z-=V,m.total_out+=Z,A.total+=Z,4&A.wrap&&Z&&(m.adler=A.check=A.flags?Sr(A.check,B,Z,P-Z):$a(A.check,B,Z,P-Z)),Z=V,4&A.wrap&&(A.flags?U:gi(U))!==A.check){m.msg="incorrect data check",A.mode=qi;break}U=0,q=0}A.mode=16207;case 16207:if(A.wrap&&A.flags){for(;q<32;){if(S===0)break e;S--,U+=w[k++]<<q,q+=8}if(4&A.wrap&&U!==(4294967295&A.total)){m.msg="incorrect length check",A.mode=qi;break}U=0,q=0}A.mode=16208;case 16208:Ae=En;break e;case qi:Ae=Wl;break e;case 16210:return Ql;default:return dn}return m.next_out=P,m.avail_out=V,m.next_in=k,m.avail_in=S,A.hold=U,A.bits=q,(A.wsize||Z!==m.avail_out&&A.mode<qi&&(A.mode<ks||p!==El))&&ic(m,m.output,m.next_out,Z-m.avail_out),ne-=m.avail_in,Z-=m.avail_out,m.total_in+=ne,m.total_out+=Z,A.total+=Z,4&A.wrap&&Z&&(m.adler=A.check=A.flags?Sr(A.check,B,Z,m.next_out-Z):$a(A.check,B,Z,m.next_out-Z)),m.data_type=A.bits+(A.last?64:0)+(A.mode===Bt?128:0)+(A.mode===io||A.mode===to?256:0),(ne===0&&Z===0||p===El)&&Ae===cs&&(Ae=Xl),Ae},rr={inflateReset:ec,inflateReset2:Xs,inflateResetKeep:zo,inflateInit:m=>Sl(m,15),inflateInit2:Sl,inflate:Bc,inflateEnd:m=>{if(Ws(m))return dn;let p=m.state;return p.window&&(p.window=null),m.state=null,cs},inflateGetHeader:(m,p)=>{if(Ws(m))return dn;const A=m.state;return 2&A.wrap?(A.head=p,p.done=!1,cs):dn},inflateSetDictionary:(m,p)=>{const A=p.length;let w,B,k;return Ws(m)?dn:(w=m.state,w.wrap!==0&&w.mode!==Dr?dn:w.mode===Dr&&(B=1,B=$a(B,p,A,0),B!==w.check)?Wl:(k=ic(m,p,A,A),k?(w.mode=16210,Ql):(w.havedict=1,cs)))},inflateInfo:"pako inflate (from Nodeca project)"},Vi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ea=Object.prototype.toString,{Z_NO_FLUSH:Uo,Z_FINISH:No,Z_OK:Da,Z_STREAM_END:ta,Z_NEED_DICT:ia,Z_STREAM_ERROR:Hn,Z_DATA_ERROR:Ma,Z_MEM_ERROR:zt}=To;function Ht(m){this.options=Lo.assign({chunkSize:65536,windowBits:15,to:""},m||{});const p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(p.windowBits>=0&&p.windowBits<16)||m&&m.windowBits||(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&(15&p.windowBits||(p.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ks,this.strm.avail_out=0;let A=rr.inflateInit2(this.strm,p.windowBits);if(A!==Da)throw new Error(Cn[A]);if(this.header=new Vi,rr.inflateGetHeader(this.strm,this.header),p.dictionary&&(typeof p.dictionary=="string"?p.dictionary=Xa.string2buf(p.dictionary):ea.call(p.dictionary)==="[object ArrayBuffer]"&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(A=rr.inflateSetDictionary(this.strm,p.dictionary),A!==Da)))throw new Error(Cn[A])}function Oo(m,p){const A=new Ht(p);if(A.push(m),A.err)throw A.msg||Cn[A.err];return A.result}Ht.prototype.push=function(m,p){const A=this.strm,w=this.options.chunkSize,B=this.options.dictionary;let k,P,S;if(this.ended)return!1;for(P=p===~~p?p:p===!0?No:Uo,ea.call(m)==="[object ArrayBuffer]"?A.input=new Uint8Array(m):A.input=m,A.next_in=0,A.avail_in=A.input.length;;){for(A.avail_out===0&&(A.output=new Uint8Array(w),A.next_out=0,A.avail_out=w),k=rr.inflate(A,P),k===ia&&B&&(k=rr.inflateSetDictionary(A,B),k===Da?k=rr.inflate(A,P):k===Ma&&(k=ia));A.avail_in>0&&k===ta&&A.state.wrap>0&&m[A.next_in]!==0;)rr.inflateReset(A),k=rr.inflate(A,P);switch(k){case Hn:case Ma:case ia:case zt:return this.onEnd(k),this.ended=!0,!1}if(S=A.avail_out,A.next_out&&(A.avail_out===0||k===ta))if(this.options.to==="string"){let V=Xa.utf8border(A.output,A.next_out),U=A.next_out-V,q=Xa.buf2string(A.output,V);A.next_out=U,A.avail_out=w-U,U&&A.output.set(A.output.subarray(V,V+U),0),this.onData(q)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(k!==Da||S!==0){if(k===ta)return k=rr.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,!0;if(A.avail_in===0)break}}return!0},Ht.prototype.onData=function(m){this.chunks.push(m)},Ht.prototype.onEnd=function(m){m===Da&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Lo.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg};var qo={inflate:Oo};const{inflate:Ml}=qo;var u=Ml,e=Object.freeze({__proto__:null,default:class extends Gn{decodeBlock(m){return u(new Uint8Array(m)).buffer}}}),n=Object.freeze({__proto__:null,default:class extends Gn{decodeBlock(m){const p=new DataView(m),A=[];for(let w=0;w<m.byteLength;++w){let B=p.getInt8(w);if(B<0){const k=p.getUint8(w+1);B=-B;for(let P=0;P<=B;++P)A.push(k);w+=1}else{for(let k=0;k<=B;++k)A.push(p.getUint8(w+k+1));w+=B+1}}return new Uint8Array(A).buffer}}}),a={exports:{}};(function(m){/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var p,A,w,B,k,P,S,V,U,q,ne,Z,N,se,ue,ae,de=(p={defaultNoDataValue:-34027999387901484e22,decode:function(K,G){var Ae=(G=G||{}).encodedMaskData||G.encodedMaskData===null,re=k(K,G.inputOffset||0,Ae),le=G.noDataValue!==null?G.noDataValue:p.defaultNoDataValue,ge=A(re,G.pixelType||Float32Array,G.encodedMaskData,le,G.returnMask),De={width:re.width,height:re.height,pixelData:ge.resultPixels,minValue:ge.minValue,maxValue:re.pixels.maxValue,noDataValue:le};return ge.resultMask&&(De.maskData=ge.resultMask),G.returnEncodedMask&&re.mask&&(De.encodedMaskData=re.mask.bitset?re.mask.bitset:null),G.returnFileInfo&&(De.fileInfo=w(re),G.computeUsedBitDepths&&(De.fileInfo.bitDepths=B(re))),De}},A=function(K,G,Ae,re,le){var ge,De,Be,ke=0,Oe=K.pixels.numBlocksX,Ze=K.pixels.numBlocksY,We=Math.floor(K.width/Oe),rt=Math.floor(K.height/Ze),pt=2*K.maxZError,Ve=Number.MAX_VALUE;Ae=Ae||(K.mask?K.mask.bitset:null),De=new G(K.width*K.height),le&&Ae&&(Be=new Uint8Array(K.width*K.height));for(var ze,it,Dt=new Float32Array(We*rt),ft=0;ft<=Ze;ft++){var Rt=ft!==Ze?rt:K.height%Ze;if(Rt!==0)for(var At=0;At<=Oe;At++){var Ct=At!==Oe?We:K.width%Oe;if(Ct!==0){var wt,ut,Et,mi,ai=ft*K.width*rt+At*We,bi=K.width-Ct,vi=K.pixels.blocks[ke];if(vi.encoding<2?(vi.encoding===0?wt=vi.rawData:(P(vi.stuffedData,vi.bitsPerPixel,vi.numValidPixels,vi.offset,pt,Dt,K.pixels.maxValue),wt=Dt),ut=0):Et=vi.encoding===2?0:vi.offset,Ae)for(it=0;it<Rt;it++){for(7&ai&&(mi=Ae[ai>>3],mi<<=7&ai),ze=0;ze<Ct;ze++)7&ai||(mi=Ae[ai>>3]),128&mi?(Be&&(Be[ai]=1),Ve=Ve>(ge=vi.encoding<2?wt[ut++]:Et)?ge:Ve,De[ai++]=ge):(Be&&(Be[ai]=0),De[ai++]=re),mi<<=1;ai+=bi}else if(vi.encoding<2)for(it=0;it<Rt;it++){for(ze=0;ze<Ct;ze++)Ve=Ve>(ge=wt[ut++])?ge:Ve,De[ai++]=ge;ai+=bi}else for(Ve=Ve>Et?Et:Ve,it=0;it<Rt;it++){for(ze=0;ze<Ct;ze++)De[ai++]=Et;ai+=bi}if(vi.encoding===1&&ut!==vi.numValidPixels)throw"Block and Mask do not match";ke++}}}return{resultPixels:De,resultMask:Be,minValue:Ve}},w=function(K){return{fileIdentifierString:K.fileIdentifierString,fileVersion:K.fileVersion,imageType:K.imageType,height:K.height,width:K.width,maxZError:K.maxZError,eofOffset:K.eofOffset,mask:K.mask?{numBlocksX:K.mask.numBlocksX,numBlocksY:K.mask.numBlocksY,numBytes:K.mask.numBytes,maxValue:K.mask.maxValue}:null,pixels:{numBlocksX:K.pixels.numBlocksX,numBlocksY:K.pixels.numBlocksY,numBytes:K.pixels.numBytes,maxValue:K.pixels.maxValue,noDataValue:K.noDataValue}}},B=function(K){for(var G=K.pixels.numBlocksX*K.pixels.numBlocksY,Ae={},re=0;re<G;re++){var le=K.pixels.blocks[re];le.encoding===0?Ae.float32=!0:le.encoding===1?Ae[le.bitsPerPixel]=!0:Ae[0]=!0}return Object.keys(Ae)},k=function(K,G,Ae){var re={},le=new Uint8Array(K,G,10);if(re.fileIdentifierString=String.fromCharCode.apply(null,le),re.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+re.fileIdentifierString;G+=10;var ge=new DataView(K,G,24);if(re.fileVersion=ge.getInt32(0,!0),re.imageType=ge.getInt32(4,!0),re.height=ge.getUint32(8,!0),re.width=ge.getUint32(12,!0),re.maxZError=ge.getFloat64(16,!0),G+=24,!Ae)if(ge=new DataView(K,G,16),re.mask={},re.mask.numBlocksY=ge.getUint32(0,!0),re.mask.numBlocksX=ge.getUint32(4,!0),re.mask.numBytes=ge.getUint32(8,!0),re.mask.maxValue=ge.getFloat32(12,!0),G+=16,re.mask.numBytes>0){var De=new Uint8Array(Math.ceil(re.width*re.height/8)),Be=(ge=new DataView(K,G,re.mask.numBytes)).getInt16(0,!0),ke=2,Oe=0;do{if(Be>0)for(;Be--;)De[Oe++]=ge.getUint8(ke++);else{var Ze=ge.getUint8(ke++);for(Be=-Be;Be--;)De[Oe++]=Ze}Be=ge.getInt16(ke,!0),ke+=2}while(ke<re.mask.numBytes);if(Be!==-32768||Oe<De.length)throw"Unexpected end of mask RLE encoding";re.mask.bitset=De,G+=re.mask.numBytes}else re.mask.numBytes|re.mask.numBlocksY|re.mask.maxValue||(re.mask.bitset=new Uint8Array(Math.ceil(re.width*re.height/8)));ge=new DataView(K,G,16),re.pixels={},re.pixels.numBlocksY=ge.getUint32(0,!0),re.pixels.numBlocksX=ge.getUint32(4,!0),re.pixels.numBytes=ge.getUint32(8,!0),re.pixels.maxValue=ge.getFloat32(12,!0),G+=16;var We=re.pixels.numBlocksX,rt=re.pixels.numBlocksY,pt=We+(re.width%We>0?1:0),Ve=rt+(re.height%rt>0?1:0);re.pixels.blocks=new Array(pt*Ve);for(var ze=0,it=0;it<Ve;it++)for(var Dt=0;Dt<pt;Dt++){var ft=0,Rt=K.byteLength-G;ge=new DataView(K,G,Math.min(10,Rt));var At={};re.pixels.blocks[ze++]=At;var Ct=ge.getUint8(0);if(ft++,At.encoding=63&Ct,At.encoding>3)throw"Invalid block encoding ("+At.encoding+")";if(At.encoding!==2){if(Ct!==0&&Ct!==2){if(Ct>>=6,At.offsetType=Ct,Ct===2)At.offset=ge.getInt8(1),ft++;else if(Ct===1)At.offset=ge.getInt16(1,!0),ft+=2;else{if(Ct!==0)throw"Invalid block offset type";At.offset=ge.getFloat32(1,!0),ft+=4}if(At.encoding===1)if(Ct=ge.getUint8(ft),ft++,At.bitsPerPixel=63&Ct,Ct>>=6,At.numValidPixelsType=Ct,Ct===2)At.numValidPixels=ge.getUint8(ft),ft++;else if(Ct===1)At.numValidPixels=ge.getUint16(ft,!0),ft+=2;else{if(Ct!==0)throw"Invalid valid pixel count type";At.numValidPixels=ge.getUint32(ft,!0),ft+=4}}var wt;if(G+=ft,At.encoding!==3){if(At.encoding===0){var ut=(re.pixels.numBytes-1)/4;if(ut!==Math.floor(ut))throw"uncompressed block has invalid length";wt=new ArrayBuffer(4*ut),new Uint8Array(wt).set(new Uint8Array(K,G,4*ut));var Et=new Float32Array(wt);At.rawData=Et,G+=4*ut}else if(At.encoding===1){var mi=Math.ceil(At.numValidPixels*At.bitsPerPixel/8),ai=Math.ceil(mi/4);wt=new ArrayBuffer(4*ai),new Uint8Array(wt).set(new Uint8Array(K,G,mi)),At.stuffedData=new Uint32Array(wt),G+=mi}}}else G++}return re.eofOffset=G,re},P=function(K,G,Ae,re,le,ge,De){var Be,ke,Oe,Ze=(1<<G)-1,We=0,rt=0,pt=Math.ceil((De-re)/le),Ve=4*K.length-Math.ceil(G*Ae/8);for(K[K.length-1]<<=8*Ve,Be=0;Be<Ae;Be++){if(rt===0&&(Oe=K[We++],rt=32),rt>=G)ke=Oe>>>rt-G&Ze,rt-=G;else{var ze=G-rt;ke=(Oe&Ze)<<ze&Ze,ke+=(Oe=K[We++])>>>(rt=32-ze)}ge[Be]=ke<pt?re+ke*le:De}return ge},p),xe=(S=function(K,G,Ae,re,le,ge,De,Be){var ke,Oe,Ze,We,rt,pt=(1<<Ae)-1,Ve=0,ze=0,it=4*K.length-Math.ceil(Ae*re/8);if(K[K.length-1]<<=8*it,le)for(ke=0;ke<re;ke++)ze===0&&(Ze=K[Ve++],ze=32),ze>=Ae?(Oe=Ze>>>ze-Ae&pt,ze-=Ae):(Oe=(Ze&pt)<<(We=Ae-ze)&pt,Oe+=(Ze=K[Ve++])>>>(ze=32-We)),G[ke]=le[Oe];else for(rt=Math.ceil((Be-ge)/De),ke=0;ke<re;ke++)ze===0&&(Ze=K[Ve++],ze=32),ze>=Ae?(Oe=Ze>>>ze-Ae&pt,ze-=Ae):(Oe=(Ze&pt)<<(We=Ae-ze)&pt,Oe+=(Ze=K[Ve++])>>>(ze=32-We)),G[ke]=Oe<rt?ge+Oe*De:Be},V=function(K,G,Ae,re,le,ge){var De,Be=(1<<G)-1,ke=0,Oe=0,Ze=0,We=0,rt=0,pt=[],Ve=4*K.length-Math.ceil(G*Ae/8);K[K.length-1]<<=8*Ve;var ze=Math.ceil((ge-re)/le);for(Oe=0;Oe<Ae;Oe++)We===0&&(De=K[ke++],We=32),We>=G?(rt=De>>>We-G&Be,We-=G):(rt=(De&Be)<<(Ze=G-We)&Be,rt+=(De=K[ke++])>>>(We=32-Ze)),pt[Oe]=rt<ze?re+rt*le:ge;return pt.unshift(re),pt},U=function(K,G,Ae,re,le,ge,De,Be){var ke,Oe,Ze,We,rt=(1<<Ae)-1,pt=0,Ve=0,ze=0;if(le)for(ke=0;ke<re;ke++)Ve===0&&(Ze=K[pt++],Ve=32,ze=0),Ve>=Ae?(Oe=Ze>>>ze&rt,Ve-=Ae,ze+=Ae):(Oe=Ze>>>ze&rt,Ve=32-(We=Ae-Ve),Oe|=((Ze=K[pt++])&(1<<We)-1)<<Ae-We,ze=We),G[ke]=le[Oe];else{var it=Math.ceil((Be-ge)/De);for(ke=0;ke<re;ke++)Ve===0&&(Ze=K[pt++],Ve=32,ze=0),Ve>=Ae?(Oe=Ze>>>ze&rt,Ve-=Ae,ze+=Ae):(Oe=Ze>>>ze&rt,Ve=32-(We=Ae-Ve),Oe|=((Ze=K[pt++])&(1<<We)-1)<<Ae-We,ze=We),G[ke]=Oe<it?ge+Oe*De:Be}return G},q=function(K,G,Ae,re,le,ge){var De,Be=(1<<G)-1,ke=0,Oe=0,Ze=0,We=0,rt=0,pt=0,Ve=[],ze=Math.ceil((ge-re)/le);for(Oe=0;Oe<Ae;Oe++)We===0&&(De=K[ke++],We=32,pt=0),We>=G?(rt=De>>>pt&Be,We-=G,pt+=G):(rt=De>>>pt&Be,We=32-(Ze=G-We),rt|=((De=K[ke++])&(1<<Ze)-1)<<G-Ze,pt=Ze),Ve[Oe]=rt<ze?re+rt*le:ge;return Ve.unshift(re),Ve},ne=function(K,G,Ae,re){var le,ge,De,Be,ke=(1<<Ae)-1,Oe=0,Ze=0,We=4*K.length-Math.ceil(Ae*re/8);for(K[K.length-1]<<=8*We,le=0;le<re;le++)Ze===0&&(De=K[Oe++],Ze=32),Ze>=Ae?(ge=De>>>Ze-Ae&ke,Ze-=Ae):(ge=(De&ke)<<(Be=Ae-Ze)&ke,ge+=(De=K[Oe++])>>>(Ze=32-Be)),G[le]=ge;return G},Z=function(K,G,Ae,re){var le,ge,De,Be,ke=(1<<Ae)-1,Oe=0,Ze=0,We=0;for(le=0;le<re;le++)Ze===0&&(De=K[Oe++],Ze=32,We=0),Ze>=Ae?(ge=De>>>We&ke,Ze-=Ae,We+=Ae):(ge=De>>>We&ke,Ze=32-(Be=Ae-Ze),ge|=((De=K[Oe++])&(1<<Be)-1)<<Ae-Be,We=Be),G[le]=ge;return G},N={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(K){for(var G=65535,Ae=65535,re=K.length,le=Math.floor(re/2),ge=0;le;){var De=le>=359?359:le;le-=De;do G+=K[ge++]<<8,Ae+=G+=K[ge++];while(--De);G=(65535&G)+(G>>>16),Ae=(65535&Ae)+(Ae>>>16)}return 1&re&&(Ae+=G+=K[ge]<<8),((Ae=(65535&Ae)+(Ae>>>16))<<16|(G=(65535&G)+(G>>>16)))>>>0},readHeaderInfo:function(K,G){var Ae=G.ptr,re=new Uint8Array(K,Ae,6),le={};if(le.fileIdentifierString=String.fromCharCode.apply(null,re),le.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+le.fileIdentifierString;Ae+=6;var ge,De=new DataView(K,Ae,8),Be=De.getInt32(0,!0);if(le.fileVersion=Be,Ae+=4,Be>=3&&(le.checksum=De.getUint32(4,!0),Ae+=4),De=new DataView(K,Ae,12),le.height=De.getUint32(0,!0),le.width=De.getUint32(4,!0),Ae+=8,Be>=4?(le.numDims=De.getUint32(8,!0),Ae+=4):le.numDims=1,De=new DataView(K,Ae,40),le.numValidPixel=De.getUint32(0,!0),le.microBlockSize=De.getInt32(4,!0),le.blobSize=De.getInt32(8,!0),le.imageType=De.getInt32(12,!0),le.maxZError=De.getFloat64(16,!0),le.zMin=De.getFloat64(24,!0),le.zMax=De.getFloat64(32,!0),Ae+=40,G.headerInfo=le,G.ptr=Ae,Be>=3&&(ge=Be>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(K,Ae-ge,le.blobSize-14))!==le.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(K,G){var Ae=G.headerInfo,re=this.getDataTypeArray(Ae.imageType),le=Ae.numDims*this.getDataTypeSize(Ae.imageType),ge=this.readSubArray(K,G.ptr,re,le),De=this.readSubArray(K,G.ptr+le,re,le);G.ptr+=2*le;var Be,ke=!0;for(Be=0;Be<Ae.numDims;Be++)if(ge[Be]!==De[Be]){ke=!1;break}return Ae.minValues=ge,Ae.maxValues=De,ke},readSubArray:function(K,G,Ae,re){var le;if(Ae===Uint8Array)le=new Uint8Array(K,G,re);else{var ge=new ArrayBuffer(re);new Uint8Array(ge).set(new Uint8Array(K,G,re)),le=new Ae(ge)}return le},readMask:function(K,G){var Ae,re,le=G.ptr,ge=G.headerInfo,De=ge.width*ge.height,Be=ge.numValidPixel,ke=new DataView(K,le,4),Oe={};if(Oe.numBytes=ke.getUint32(0,!0),le+=4,(Be===0||De===Be)&&Oe.numBytes!==0)throw"invalid mask";if(Be===0)Ae=new Uint8Array(Math.ceil(De/8)),Oe.bitset=Ae,re=new Uint8Array(De),G.pixels.resultMask=re,le+=Oe.numBytes;else if(Oe.numBytes>0){Ae=new Uint8Array(Math.ceil(De/8));var Ze=(ke=new DataView(K,le,Oe.numBytes)).getInt16(0,!0),We=2,rt=0,pt=0;do{if(Ze>0)for(;Ze--;)Ae[rt++]=ke.getUint8(We++);else for(pt=ke.getUint8(We++),Ze=-Ze;Ze--;)Ae[rt++]=pt;Ze=ke.getInt16(We,!0),We+=2}while(We<Oe.numBytes);if(Ze!==-32768||rt<Ae.length)throw"Unexpected end of mask RLE encoding";re=new Uint8Array(De);var Ve=0,ze=0;for(ze=0;ze<De;ze++)7&ze?(Ve=Ae[ze>>3],Ve<<=7&ze):Ve=Ae[ze>>3],128&Ve&&(re[ze]=1);G.pixels.resultMask=re,Oe.bitset=Ae,le+=Oe.numBytes}return G.ptr=le,G.mask=Oe,!0},readDataOneSweep:function(K,G,Ae,re){var le,ge=G.ptr,De=G.headerInfo,Be=De.numDims,ke=De.width*De.height,Oe=De.imageType,Ze=De.numValidPixel*N.getDataTypeSize(Oe)*Be,We=G.pixels.resultMask;if(Ae===Uint8Array)le=new Uint8Array(K,ge,Ze);else{var rt=new ArrayBuffer(Ze);new Uint8Array(rt).set(new Uint8Array(K,ge,Ze)),le=new Ae(rt)}if(le.length===ke*Be)G.pixels.resultPixels=re?N.swapDimensionOrder(le,ke,Be,Ae,!0):le;else{G.pixels.resultPixels=new Ae(ke*Be);var pt=0,Ve=0,ze=0,it=0;if(Be>1){if(re){for(Ve=0;Ve<ke;Ve++)if(We[Ve])for(it=Ve,ze=0;ze<Be;ze++,it+=ke)G.pixels.resultPixels[it]=le[pt++]}else for(Ve=0;Ve<ke;Ve++)if(We[Ve])for(it=Ve*Be,ze=0;ze<Be;ze++)G.pixels.resultPixels[it+ze]=le[pt++]}else for(Ve=0;Ve<ke;Ve++)We[Ve]&&(G.pixels.resultPixels[Ve]=le[pt++])}return ge+=Ze,G.ptr=ge,!0},readHuffmanTree:function(K,G){var Ae=this.HUFFMAN_LUT_BITS_MAX,re=new DataView(K,G.ptr,16);if(G.ptr+=16,re.getInt32(0,!0)<2)throw"unsupported Huffman version";var le=re.getInt32(4,!0),ge=re.getInt32(8,!0),De=re.getInt32(12,!0);if(ge>=De)return!1;var Be=new Uint32Array(De-ge);N.decodeBits(K,G,Be);var ke,Oe,Ze,We,rt=[];for(ke=ge;ke<De;ke++)rt[Oe=ke-(ke<le?0:le)]={first:Be[ke-ge],second:null};var pt=K.byteLength-G.ptr,Ve=Math.ceil(pt/4),ze=new ArrayBuffer(4*Ve);new Uint8Array(ze).set(new Uint8Array(K,G.ptr,pt));var it,Dt=new Uint32Array(ze),ft=0,Rt=0;for(it=Dt[0],ke=ge;ke<De;ke++)(We=rt[Oe=ke-(ke<le?0:le)].first)>0&&(rt[Oe].second=it<<ft>>>32-We,32-ft>=We?(ft+=We)===32&&(ft=0,it=Dt[++Rt]):(ft+=We-32,it=Dt[++Rt],rt[Oe].second|=it>>>32-ft));var At=0,Ct=0,wt=new se;for(ke=0;ke<rt.length;ke++)rt[ke]!==void 0&&(At=Math.max(At,rt[ke].first));Ct=At>=Ae?Ae:At;var ut,Et,mi,ai,bi,vi=[];for(ke=ge;ke<De;ke++)if((We=rt[Oe=ke-(ke<le?0:le)].first)>0)if(ut=[We,Oe],We<=Ct)for(Et=rt[Oe].second<<Ct-We,mi=1<<Ct-We,Ze=0;Ze<mi;Ze++)vi[Et|Ze]=ut;else for(Et=rt[Oe].second,bi=wt,ai=We-1;ai>=0;ai--)Et>>>ai&1?(bi.right||(bi.right=new se),bi=bi.right):(bi.left||(bi.left=new se),bi=bi.left),ai!==0||bi.val||(bi.val=ut[1]);return{decodeLut:vi,numBitsLUTQick:Ct,numBitsLUT:At,tree:wt,stuffedData:Dt,srcPtr:Rt,bitPos:ft}},readHuffman:function(K,G,Ae,re){var le,ge,De,Be,ke,Oe,Ze,We,rt,pt=G.headerInfo.numDims,Ve=G.headerInfo.height,ze=G.headerInfo.width,it=ze*Ve,Dt=this.readHuffmanTree(K,G),ft=Dt.decodeLut,Rt=Dt.tree,At=Dt.stuffedData,Ct=Dt.srcPtr,wt=Dt.bitPos,ut=Dt.numBitsLUTQick,Et=Dt.numBitsLUT,mi=G.headerInfo.imageType===0?128:0,ai=G.pixels.resultMask,bi=0;wt>0&&(Ct++,wt=0);var vi,nn=At[Ct],Br=G.encodeMode===1,Ss=new Ae(it*pt),ti=Ss;if(pt<2||Br){for(vi=0;vi<pt;vi++)if(pt>1&&(ti=new Ae(Ss.buffer,it*vi,it),bi=0),G.headerInfo.numValidPixel===ze*Ve)for(We=0,Oe=0;Oe<Ve;Oe++)for(Ze=0;Ze<ze;Ze++,We++){if(ge=0,ke=Be=nn<<wt>>>32-ut,32-wt<ut&&(ke=Be|=At[Ct+1]>>>64-wt-ut),ft[ke])ge=ft[ke][1],wt+=ft[ke][0];else for(ke=Be=nn<<wt>>>32-Et,32-wt<Et&&(ke=Be|=At[Ct+1]>>>64-wt-Et),le=Rt,rt=0;rt<Et;rt++)if(!(le=Be>>>Et-rt-1&1?le.right:le.left).left&&!le.right){ge=le.val,wt=wt+rt+1;break}wt>=32&&(wt-=32,nn=At[++Ct]),De=ge-mi,Br?(De+=Ze>0?bi:Oe>0?ti[We-ze]:bi,De&=255,ti[We]=De,bi=De):ti[We]=De}else for(We=0,Oe=0;Oe<Ve;Oe++)for(Ze=0;Ze<ze;Ze++,We++)if(ai[We]){if(ge=0,ke=Be=nn<<wt>>>32-ut,32-wt<ut&&(ke=Be|=At[Ct+1]>>>64-wt-ut),ft[ke])ge=ft[ke][1],wt+=ft[ke][0];else for(ke=Be=nn<<wt>>>32-Et,32-wt<Et&&(ke=Be|=At[Ct+1]>>>64-wt-Et),le=Rt,rt=0;rt<Et;rt++)if(!(le=Be>>>Et-rt-1&1?le.right:le.left).left&&!le.right){ge=le.val,wt=wt+rt+1;break}wt>=32&&(wt-=32,nn=At[++Ct]),De=ge-mi,Br?(Ze>0&&ai[We-1]?De+=bi:Oe>0&&ai[We-ze]?De+=ti[We-ze]:De+=bi,De&=255,ti[We]=De,bi=De):ti[We]=De}}else for(We=0,Oe=0;Oe<Ve;Oe++)for(Ze=0;Ze<ze;Ze++)if(We=Oe*ze+Ze,!ai||ai[We])for(vi=0;vi<pt;vi++,We+=it){if(ge=0,ke=Be=nn<<wt>>>32-ut,32-wt<ut&&(ke=Be|=At[Ct+1]>>>64-wt-ut),ft[ke])ge=ft[ke][1],wt+=ft[ke][0];else for(ke=Be=nn<<wt>>>32-Et,32-wt<Et&&(ke=Be|=At[Ct+1]>>>64-wt-Et),le=Rt,rt=0;rt<Et;rt++)if(!(le=Be>>>Et-rt-1&1?le.right:le.left).left&&!le.right){ge=le.val,wt=wt+rt+1;break}wt>=32&&(wt-=32,nn=At[++Ct]),De=ge-mi,ti[We]=De}G.ptr=G.ptr+4*(Ct+1)+(wt>0?4:0),G.pixels.resultPixels=Ss,pt>1&&!re&&(G.pixels.resultPixels=N.swapDimensionOrder(Ss,it,pt,Ae))},decodeBits:function(K,G,Ae,re,le){var ge=G.headerInfo,De=ge.fileVersion,Be=0,ke=K.byteLength-G.ptr>=5?5:K.byteLength-G.ptr,Oe=new DataView(K,G.ptr,ke),Ze=Oe.getUint8(0);Be++;var We=Ze>>6,rt=We===0?4:3-We,pt=(32&Ze)>0,Ve=31&Ze,ze=0;if(rt===1)ze=Oe.getUint8(Be),Be++;else if(rt===2)ze=Oe.getUint16(Be,!0),Be+=2;else{if(rt!==4)throw"Invalid valid pixel count type";ze=Oe.getUint32(Be,!0),Be+=4}var it,Dt,ft,Rt,At,Ct,wt,ut,Et,mi=2*ge.maxZError,ai=ge.numDims>1?ge.maxValues[le]:ge.zMax;if(pt){for(G.counter.lut++,ut=Oe.getUint8(Be),Be++,Rt=Math.ceil((ut-1)*Ve/8),At=Math.ceil(Rt/4),Dt=new ArrayBuffer(4*At),ft=new Uint8Array(Dt),G.ptr+=Be,ft.set(new Uint8Array(K,G.ptr,Rt)),wt=new Uint32Array(Dt),G.ptr+=Rt,Et=0;ut-1>>>Et;)Et++;Rt=Math.ceil(ze*Et/8),At=Math.ceil(Rt/4),Dt=new ArrayBuffer(4*At),(ft=new Uint8Array(Dt)).set(new Uint8Array(K,G.ptr,Rt)),it=new Uint32Array(Dt),G.ptr+=Rt,Ct=De>=3?q(wt,Ve,ut-1,re,mi,ai):V(wt,Ve,ut-1,re,mi,ai),De>=3?U(it,Ae,Et,ze,Ct):S(it,Ae,Et,ze,Ct)}else G.counter.bitstuffer++,Et=Ve,G.ptr+=Be,Et>0&&(Rt=Math.ceil(ze*Et/8),At=Math.ceil(Rt/4),Dt=new ArrayBuffer(4*At),(ft=new Uint8Array(Dt)).set(new Uint8Array(K,G.ptr,Rt)),it=new Uint32Array(Dt),G.ptr+=Rt,De>=3?re==null?Z(it,Ae,Et,ze):U(it,Ae,Et,ze,!1,re,mi,ai):re==null?ne(it,Ae,Et,ze):S(it,Ae,Et,ze,!1,re,mi,ai))},readTiles:function(K,G,Ae,re){var le=G.headerInfo,ge=le.width,De=le.height,Be=ge*De,ke=le.microBlockSize,Oe=le.imageType,Ze=N.getDataTypeSize(Oe),We=Math.ceil(ge/ke),rt=Math.ceil(De/ke);G.pixels.numBlocksY=rt,G.pixels.numBlocksX=We,G.pixels.ptr=0;var pt,Ve,ze,it,Dt,ft,Rt,At,Ct,wt,ut=0,Et=0,mi=0,ai=0,bi=0,vi=0,nn=0,Br=0,Ss=0,ti=0,sn=0,Qn=0,no=0,As=0,fr=0,Ta=new Ae(ke*ke),jc=De%ke||ke,Jc=ge%ke||ke,rc=le.numDims,jn=G.pixels.resultMask,Ur=G.pixels.resultPixels,so=le.fileVersion>=5?14:15,ds=le.zMax;for(mi=0;mi<rt;mi++)for(bi=mi!==rt-1?ke:jc,ai=0;ai<We;ai++)for(ti=mi*ge*ke+ai*ke,sn=ge-(vi=ai!==We-1?ke:Jc),At=0;At<rc;At++){if(rc>1?(wt=Ur,ti=mi*ge*ke+ai*ke,Ur=new Ae(G.pixels.resultPixels.buffer,Be*At*Ze,Be),ds=le.maxValues[At]):wt=null,nn=K.byteLength-G.ptr,Ve={},fr=0,Br=(pt=new DataView(K,G.ptr,Math.min(10,nn))).getUint8(0),fr++,Ct=le.fileVersion>=5?4&Br:0,Ss=Br>>6&255,(Br>>2&so)!=(ai*ke>>3&so)||Ct&&At===0)throw"integrity issue";if((Dt=3&Br)>3)throw G.ptr+=fr,"Invalid block encoding ("+Dt+")";if(Dt!==2)if(Dt===0){if(Ct)throw"integrity issue";if(G.counter.uncompressed++,G.ptr+=fr,Qn=(Qn=bi*vi*Ze)<(no=K.byteLength-G.ptr)?Qn:no,ze=new ArrayBuffer(Qn%Ze==0?Qn:Qn+Ze-Qn%Ze),new Uint8Array(ze).set(new Uint8Array(K,G.ptr,Qn)),it=new Ae(ze),As=0,jn)for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)jn[ti]&&(Ur[ti]=it[As++]),ti++;ti+=sn}else for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)Ur[ti++]=it[As++];ti+=sn}G.ptr+=As*Ze}else if(ft=N.getDataTypeUsed(Ct&&Oe<6?4:Oe,Ss),Rt=N.getOnePixel(Ve,fr,ft,pt),fr+=N.getDataTypeSize(ft),Dt===3)if(G.ptr+=fr,G.counter.constantoffset++,jn)for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)jn[ti]&&(Ur[ti]=Ct?Math.min(ds,wt[ti]+Rt):Rt),ti++;ti+=sn}else for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)Ur[ti]=Ct?Math.min(ds,wt[ti]+Rt):Rt,ti++;ti+=sn}else if(G.ptr+=fr,N.decodeBits(K,G,Ta,Rt,At),fr=0,Ct)if(jn)for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)jn[ti]&&(Ur[ti]=Ta[fr++]+wt[ti]),ti++;ti+=sn}else for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)Ur[ti]=Ta[fr++]+wt[ti],ti++;ti+=sn}else if(jn)for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)jn[ti]&&(Ur[ti]=Ta[fr++]),ti++;ti+=sn}else for(ut=0;ut<bi;ut++){for(Et=0;Et<vi;Et++)Ur[ti++]=Ta[fr++];ti+=sn}else{if(Ct)if(jn)for(ut=0;ut<bi;ut++)for(Et=0;Et<vi;Et++)jn[ti]&&(Ur[ti]=wt[ti]),ti++;else for(ut=0;ut<bi;ut++)for(Et=0;Et<vi;Et++)Ur[ti]=wt[ti],ti++;G.counter.constant++,G.ptr+=fr}}rc>1&&!re&&(G.pixels.resultPixels=N.swapDimensionOrder(G.pixels.resultPixels,Be,rc,Ae))},formatFileInfo:function(K){return{fileIdentifierString:K.headerInfo.fileIdentifierString,fileVersion:K.headerInfo.fileVersion,imageType:K.headerInfo.imageType,height:K.headerInfo.height,width:K.headerInfo.width,numValidPixel:K.headerInfo.numValidPixel,microBlockSize:K.headerInfo.microBlockSize,blobSize:K.headerInfo.blobSize,maxZError:K.headerInfo.maxZError,pixelType:N.getPixelType(K.headerInfo.imageType),eofOffset:K.eofOffset,mask:K.mask?{numBytes:K.mask.numBytes}:null,pixels:{numBlocksX:K.pixels.numBlocksX,numBlocksY:K.pixels.numBlocksY,maxValue:K.headerInfo.zMax,minValue:K.headerInfo.zMin,noDataValue:K.noDataValue}}},constructConstantSurface:function(K,G){var Ae=K.headerInfo.zMax,re=K.headerInfo.zMin,le=K.headerInfo.maxValues,ge=K.headerInfo.numDims,De=K.headerInfo.height*K.headerInfo.width,Be=0,ke=0,Oe=0,Ze=K.pixels.resultMask,We=K.pixels.resultPixels;if(Ze)if(ge>1){if(G)for(Be=0;Be<ge;Be++)for(Oe=Be*De,Ae=le[Be],ke=0;ke<De;ke++)Ze[ke]&&(We[Oe+ke]=Ae);else for(ke=0;ke<De;ke++)if(Ze[ke])for(Oe=ke*ge,Be=0;Be<ge;Be++)We[Oe+ge]=le[Be]}else for(ke=0;ke<De;ke++)Ze[ke]&&(We[ke]=Ae);else if(ge>1&&re!==Ae)if(G)for(Be=0;Be<ge;Be++)for(Oe=Be*De,Ae=le[Be],ke=0;ke<De;ke++)We[Oe+ke]=Ae;else for(ke=0;ke<De;ke++)for(Oe=ke*ge,Be=0;Be<ge;Be++)We[Oe+Be]=le[Be];else for(ke=0;ke<De*ge;ke++)We[ke]=Ae},getDataTypeArray:function(K){var G;switch(K){case 0:G=Int8Array;break;case 1:G=Uint8Array;break;case 2:G=Int16Array;break;case 3:G=Uint16Array;break;case 4:G=Int32Array;break;case 5:G=Uint32Array;break;case 6:default:G=Float32Array;break;case 7:G=Float64Array}return G},getPixelType:function(K){var G;switch(K){case 0:G="S8";break;case 1:G="U8";break;case 2:G="S16";break;case 3:G="U16";break;case 4:G="S32";break;case 5:G="U32";break;case 6:default:G="F32";break;case 7:G="F64"}return G},isValidPixelValue:function(K,G){if(G==null)return!1;var Ae;switch(K){case 0:Ae=G>=-128&&G<=127;break;case 1:Ae=G>=0&&G<=255;break;case 2:Ae=G>=-32768&&G<=32767;break;case 3:Ae=G>=0&&G<=65536;break;case 4:Ae=G>=-2147483648&&G<=2147483647;break;case 5:Ae=G>=0&&G<=4294967296;break;case 6:Ae=G>=-34027999387901484e22&&G<=34027999387901484e22;break;case 7:Ae=G>=-17976931348623157e292&&G<=17976931348623157e292;break;default:Ae=!1}return Ae},getDataTypeSize:function(K){var G=0;switch(K){case 0:case 1:G=1;break;case 2:case 3:G=2;break;case 4:case 5:case 6:G=4;break;case 7:G=8;break;default:G=K}return G},getDataTypeUsed:function(K,G){var Ae=K;switch(K){case 2:case 4:Ae=K-G;break;case 3:case 5:Ae=K-2*G;break;case 6:Ae=G===0?K:G===1?2:1;break;case 7:Ae=G===0?K:K-2*G+1;break;default:Ae=K}return Ae},getOnePixel:function(K,G,Ae,re){var le=0;switch(Ae){case 0:le=re.getInt8(G);break;case 1:le=re.getUint8(G);break;case 2:le=re.getInt16(G,!0);break;case 3:le=re.getUint16(G,!0);break;case 4:le=re.getInt32(G,!0);break;case 5:le=re.getUInt32(G,!0);break;case 6:le=re.getFloat32(G,!0);break;case 7:le=re.getFloat64(G,!0);break;default:throw"the decoder does not understand this pixel type"}return le},swapDimensionOrder:function(K,G,Ae,re,le){var ge=0,De=0,Be=0,ke=0,Oe=K;if(Ae>1)if(Oe=new re(G*Ae),le)for(ge=0;ge<G;ge++)for(ke=ge,Be=0;Be<Ae;Be++,ke+=G)Oe[ke]=K[De++];else for(ge=0;ge<G;ge++)for(ke=ge,Be=0;Be<Ae;Be++,ke+=G)Oe[De++]=K[ke];return Oe}},se=function(K,G,Ae){this.val=K,this.left=G,this.right=Ae},{decode:function(K,G){var Ae=(G=G||{}).noDataValue,re=0,le={};if(le.ptr=G.inputOffset||0,le.pixels={},N.readHeaderInfo(K,le)){var ge=le.headerInfo,De=ge.fileVersion,Be=N.getDataTypeArray(ge.imageType);if(De>5)throw"unsupported lerc version 2."+De;N.readMask(K,le),ge.numValidPixel===ge.width*ge.height||le.pixels.resultMask||(le.pixels.resultMask=G.maskData);var ke=ge.width*ge.height;le.pixels.resultPixels=new Be(ke*ge.numDims),le.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var Oe,Ze=!G.returnPixelInterleavedDims;if(ge.numValidPixel!==0)if(ge.zMax===ge.zMin)N.constructConstantSurface(le,Ze);else if(De>=4&&N.checkMinMaxRanges(K,le))N.constructConstantSurface(le,Ze);else{var We=new DataView(K,le.ptr,2),rt=We.getUint8(0);if(le.ptr++,rt)N.readDataOneSweep(K,le,Be,Ze);else if(De>1&&ge.imageType<=1&&Math.abs(ge.maxZError-.5)<1e-5){var pt=We.getUint8(1);if(le.ptr++,le.encodeMode=pt,pt>2||De<4&&pt>1)throw"Invalid Huffman flag "+pt;pt?N.readHuffman(K,le,Be,Ze):N.readTiles(K,le,Be,Ze)}else N.readTiles(K,le,Be,Ze)}le.eofOffset=le.ptr,G.inputOffset?(Oe=le.headerInfo.blobSize+G.inputOffset-le.ptr,Math.abs(Oe)>=1&&(le.eofOffset=G.inputOffset+le.headerInfo.blobSize)):(Oe=le.headerInfo.blobSize-le.ptr,Math.abs(Oe)>=1&&(le.eofOffset=le.headerInfo.blobSize));var Ve={width:ge.width,height:ge.height,pixelData:le.pixels.resultPixels,minValue:ge.zMin,maxValue:ge.zMax,validPixelCount:ge.numValidPixel,dimCount:ge.numDims,dimStats:{minValues:ge.minValues,maxValues:ge.maxValues},maskData:le.pixels.resultMask};if(le.pixels.resultMask&&N.isValidPixelValue(ge.imageType,Ae)){var ze=le.pixels.resultMask;for(re=0;re<ke;re++)ze[re]||(Ve.pixelData[re]=Ae);Ve.noDataValue=Ae}return le.noDataValue=Ae,G.returnFileInfo&&(Ve.fileInfo=N.formatFileInfo(le)),Ve}},getBandCount:function(K){for(var G=0,Ae=0,re={ptr:0,pixels:{}};Ae<K.byteLength-58;)N.readHeaderInfo(K,re),Ae+=re.headerInfo.blobSize,G++,re.ptr=Ae;return G}}),be=(ue=new ArrayBuffer(4),ae=new Uint8Array(ue),new Uint32Array(ue)[0]=1,ae[0]===1),Se={decode:function(K,G){if(!be)throw"Big endian system is not supported.";var Ae,re,le=(G=G||{}).inputOffset||0,ge=new Uint8Array(K,le,10),De=String.fromCharCode.apply(null,ge);if(De.trim()==="CntZImage")Ae=de,re=1;else{if(De.substring(0,5)!=="Lerc2")throw"Unexpected file identifier string: "+De;Ae=xe,re=2}for(var Be,ke,Oe,Ze,We,rt,pt=0,Ve=K.byteLength-10,ze=[],it={width:0,height:0,pixels:[],pixelType:G.pixelType,mask:null,statistics:[]},Dt=0;le<Ve;){var ft=Ae.decode(K,{inputOffset:le,encodedMaskData:Be,maskData:Oe,returnMask:pt===0,returnEncodedMask:pt===0,returnFileInfo:!0,returnPixelInterleavedDims:G.returnPixelInterleavedDims,pixelType:G.pixelType||null,noDataValue:G.noDataValue||null});le=ft.fileInfo.eofOffset,Oe=ft.maskData,pt===0&&(Be=ft.encodedMaskData,it.width=ft.width,it.height=ft.height,it.dimCount=ft.dimCount||1,it.pixelType=ft.pixelType||ft.fileInfo.pixelType,it.mask=Oe),re>1&&(Oe&&ze.push(Oe),ft.fileInfo.mask&&ft.fileInfo.mask.numBytes>0&&Dt++),pt++,it.pixels.push(ft.pixelData),it.statistics.push({minValue:ft.minValue,maxValue:ft.maxValue,noDataValue:ft.noDataValue,dimStats:ft.dimStats})}if(re>1&&Dt>1){for(rt=it.width*it.height,it.bandMasks=ze,(Oe=new Uint8Array(rt)).set(ze[0]),Ze=1;Ze<ze.length;Ze++)for(ke=ze[Ze],We=0;We<rt;We++)Oe[We]=Oe[We]&ke[We];it.maskData=Oe}return it}};m.exports?m.exports=Se:this.Lerc=Se})()})(a);var o=vr(a.exports);let h,I,v;const C={env:{emscripten_notify_memory_growth:function(m){v=new Uint8Array(I.exports.memory.buffer)}}},T="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",F=new class{init(){return h||(h=typeof fetch<"u"?fetch("data:application/wasm;base64,"+T).then(m=>m.arrayBuffer()).then(m=>WebAssembly.instantiate(m,C)).then(this._init):WebAssembly.instantiate(Buffer.from(T,"base64"),C).then(this._init),h)}_init(m){I=m.instance,C.env.emscripten_notify_memory_growth(0)}decode(m,p=0){if(!I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const A=m.byteLength,w=I.exports.malloc(A);v.set(m,w),p=p||Number(I.exports.ZSTD_findDecompressedSize(w,A));const B=I.exports.malloc(p),k=I.exports.ZSTD_decompress(B,p,w,A),P=v.slice(B,B+k);return I.exports.free(w),I.exports.free(B),P}};var z=Object.freeze({__proto__:null,default:class extends Gn{constructor(m){super(),this.planarConfiguration=m.PlanarConfiguration!==void 0?m.PlanarConfiguration:1,this.samplesPerPixel=m.SamplesPerPixel!==void 0?m.SamplesPerPixel:1,this.addCompression=m.LercParameters[j]}decodeBlock(m){switch(this.addCompression){case te:break;case pe:m=u(new Uint8Array(m)).buffer;break;case Ce:m=F.decode(new Uint8Array(m)).buffer;break;default:throw new Error(`Unsupported LERC additional compression method identifier: ${this.addCompression}`)}return o.decode(m,{returnPixelInterleavedDims:this.planarConfiguration===1}).pixels[0].buffer}},zstd:F}),$=Object.freeze({__proto__:null,default:class extends Gn{constructor(){if(super(),typeof createImageBitmap>"u")throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if(typeof document>"u"&&typeof OffscreenCanvas>"u")throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available")}async decode(m,p){const A=new Blob([p]),w=await createImageBitmap(A);let B;typeof document<"u"?(B=document.createElement("canvas"),B.width=w.width,B.height=w.height):B=new OffscreenCanvas(w.width,w.height);const k=B.getContext("2d");return k.drawImage(w,0,0),k.getImageData(0,0,w.width,w.height).data.buffer}}}),ie=Worker,ce=Object.freeze({__proto__:null,create:function(){const m='function A(A,e,t,i,r,I,g){try{var n=A[I](g),a=n.value}catch(A){return void t(A)}n.done?e(a):Promise.resolve(a).then(i,r)}function e(e){return function(){var t=this,i=arguments;return new Promise((function(r,I){var g=e.apply(t,i);function n(e){A(g,r,I,n,a,"next",e)}function a(e){A(g,r,I,n,a,"throw",e)}n(void 0)}))}}function t(A){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},t(A)}var i={exports:{}};!function(A){var e=function(A){var e,i=Object.prototype,r=i.hasOwnProperty,I="function"==typeof Symbol?Symbol:{},g=I.iterator||"@@iterator",n=I.asyncIterator||"@@asyncIterator",a=I.toStringTag||"@@toStringTag";function o(A,e,t){return Object.defineProperty(A,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),A[e]}try{o({},"")}catch(A){o=function(A,e,t){return A[e]=t}}function B(A,e,t,i){var r=e&&e.prototype instanceof h?e:h,I=Object.create(r.prototype),g=new S(i||[]);return I._invoke=function(A,e,t){var i=Q;return function(r,I){if(i===s)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw I;return R()}for(t.method=r,t.arg=I;;){var g=t.delegate;if(g){var n=m(g,t);if(n){if(n===c)continue;return n}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(i===Q)throw i=f,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);i=s;var a=C(A,e,t);if("normal"===a.type){if(i=t.done?f:E,a.arg===c)continue;return{value:a.arg,done:t.done}}"throw"===a.type&&(i=f,t.method="throw",t.arg=a.arg)}}}(A,t,g),I}function C(A,e,t){try{return{type:"normal",arg:A.call(e,t)}}catch(A){return{type:"throw",arg:A}}}A.wrap=B;var Q="suspendedStart",E="suspendedYield",s="executing",f="completed",c={};function h(){}function l(){}function u(){}var w={};o(w,g,(function(){return this}));var d=Object.getPrototypeOf,D=d&&d(d(v([])));D&&D!==i&&r.call(D,g)&&(w=D);var y=u.prototype=h.prototype=Object.create(w);function k(A){["next","throw","return"].forEach((function(e){o(A,e,(function(A){return this._invoke(e,A)}))}))}function p(A,e){function i(I,g,n,a){var o=C(A[I],A,g);if("throw"!==o.type){var B=o.arg,Q=B.value;return Q&&"object"===t(Q)&&r.call(Q,"__await")?e.resolve(Q.__await).then((function(A){i("next",A,n,a)}),(function(A){i("throw",A,n,a)})):e.resolve(Q).then((function(A){B.value=A,n(B)}),(function(A){return i("throw",A,n,a)}))}a(o.arg)}var I;this._invoke=function(A,t){function r(){return new e((function(e,r){i(A,t,e,r)}))}return I=I?I.then(r,r):r()}}function m(A,t){var i=A.iterator[t.method];if(i===e){if(t.delegate=null,"throw"===t.method){if(A.iterator.return&&(t.method="return",t.arg=e,m(A,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a \'throw\' method")}return c}var r=C(i,A.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var I=r.arg;return I?I.done?(t[A.resultName]=I.value,t.next=A.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,c):I:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function G(A){var e={tryLoc:A[0]};1 in A&&(e.catchLoc=A[1]),2 in A&&(e.finallyLoc=A[2],e.afterLoc=A[3]),this.tryEntries.push(e)}function F(A){var e=A.completion||{};e.type="normal",delete e.arg,A.completion=e}function S(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(G,this),this.reset(!0)}function v(A){if(A){var t=A[g];if(t)return t.call(A);if("function"==typeof A.next)return A;if(!isNaN(A.length)){var i=-1,I=function t(){for(;++i<A.length;)if(r.call(A,i))return t.value=A[i],t.done=!1,t;return t.value=e,t.done=!0,t};return I.next=I}}return{next:R}}function R(){return{value:e,done:!0}}return l.prototype=u,o(y,"constructor",u),o(u,"constructor",l),l.displayName=o(u,a,"GeneratorFunction"),A.isGeneratorFunction=function(A){var e="function"==typeof A&&A.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},A.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,u):(A.__proto__=u,o(A,a,"GeneratorFunction")),A.prototype=Object.create(y),A},A.awrap=function(A){return{__await:A}},k(p.prototype),o(p.prototype,n,(function(){return this})),A.AsyncIterator=p,A.async=function(e,t,i,r,I){void 0===I&&(I=Promise);var g=new p(B(e,t,i,r),I);return A.isGeneratorFunction(t)?g:g.next().then((function(A){return A.done?A.value:g.next()}))},k(y),o(y,a,"Generator"),o(y,g,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),A.keys=function(A){var e=[];for(var t in A)e.push(t);return e.reverse(),function t(){for(;e.length;){var i=e.pop();if(i in A)return t.value=i,t.done=!1,t}return t.done=!0,t}},A.values=v,S.prototype={constructor:S,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(F),!A)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if("throw"===A.type)throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var t=this;function i(i,r){return n.type="throw",n.arg=A,t.next=i,r&&(t.method="next",t.arg=e),!!r}for(var I=this.tryEntries.length-1;I>=0;--I){var g=this.tryEntries[I],n=g.completion;if("root"===g.tryLoc)return i("end");if(g.tryLoc<=this.prev){var a=r.call(g,"catchLoc"),o=r.call(g,"finallyLoc");if(a&&o){if(this.prev<g.catchLoc)return i(g.catchLoc,!0);if(this.prev<g.finallyLoc)return i(g.finallyLoc)}else if(a){if(this.prev<g.catchLoc)return i(g.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return i(g.finallyLoc)}}}},abrupt:function(A,e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var I=i;break}}I&&("break"===A||"continue"===A)&&I.tryLoc<=e&&e<=I.finallyLoc&&(I=null);var g=I?I.completion:{};return g.type=A,g.arg=e,I?(this.method="next",this.next=I.finallyLoc,c):this.complete(g)},complete:function(A,e){if("throw"===A.type)throw A.arg;return"break"===A.type||"continue"===A.type?this.next=A.arg:"return"===A.type?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):"normal"===A.type&&e&&(this.next=e),c},finish:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===A)return this.complete(t.completion,t.afterLoc),F(t),c}},catch:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===A){var i=t.completion;if("throw"===i.type){var r=i.arg;F(t)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(A,t,i){return this.delegate={iterator:v(A),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=e),c}},A}(A.exports);try{regeneratorRuntime=e}catch(A){"object"===("undefined"==typeof globalThis?"undefined":t(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(i);var r=i.exports,I=new Map;function g(A,e){Array.isArray(A)||(A=[A]),A.forEach((function(A){return I.set(A,e)}))}function n(A){return a.apply(this,arguments)}function a(){return(a=e(r.mark((function A(e){var t,i;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:if(t=I.get(e.Compression)){A.next=3;break}throw new Error("Unknown compression method identifier: ".concat(e.Compression));case 3:return A.next=5,t();case 5:return i=A.sent,A.abrupt("return",new i(e));case 7:case"end":return A.stop()}}),A)})))).apply(this,arguments)}g([void 0,1],(function(){return Promise.resolve().then((function(){return y})).then((function(A){return A.default}))})),g(5,(function(){return Promise.resolve().then((function(){return F})).then((function(A){return A.default}))})),g(6,(function(){throw new Error("old style JPEG compression is not supported.")})),g(7,(function(){return Promise.resolve().then((function(){return N})).then((function(A){return A.default}))})),g([8,32946],(function(){return Promise.resolve().then((function(){return OA})).then((function(A){return A.default}))})),g(32773,(function(){return Promise.resolve().then((function(){return _A})).then((function(A){return A.default}))})),g(34887,(function(){return Promise.resolve().then((function(){return le})).then(function(){var A=e(r.mark((function A(e){return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,e.zstd.init();case 2:return A.abrupt("return",e);case 3:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}()).then((function(A){return A.default}))})),g(50001,(function(){return Promise.resolve().then((function(){return de})).then((function(A){return A.default}))}));var o=globalThis;function B(A,e){if(!(A instanceof e))throw new TypeError("Cannot call a class as a function")}function C(A,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(A,i.key,i)}}function Q(A,e,t){return e&&C(A.prototype,e),t&&C(A,t),A}function E(A,e){return E=Object.setPrototypeOf||function(A,e){return A.__proto__=e,A},E(A,e)}function s(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(e&&e.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),e&&E(A,e)}function f(A,e){if(e&&("object"===t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(A){if(void 0===A)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return A}(A)}function c(A){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},c(A)}function h(A,e){var t=A.length-e,i=0;do{for(var r=e;r>0;r--)A[i+e]+=A[i],i++;t-=e}while(t>0)}function l(A,e,t){for(var i=0,r=A.length,I=r/t;r>e;){for(var g=e;g>0;--g)A[i+e]+=A[i],++i;r-=e}for(var n=A.slice(),a=0;a<I;++a)for(var o=0;o<t;++o)A[t*a+o]=n[(t-o-1)*I+a]}function u(A,e,t,i,r,I){if(!e||1===e)return A;for(var g=0;g<r.length;++g){if(r[g]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(r[g]!==r[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var n=r[0]/8,a=2===I?1:r.length,o=0;o<i&&!(o*a*t*n>=A.byteLength);++o){var B=void 0;if(2===e){switch(r[0]){case 8:B=new Uint8Array(A,o*a*t*n,a*t*n);break;case 16:B=new Uint16Array(A,o*a*t*n,a*t*n/2);break;case 32:B=new Uint32Array(A,o*a*t*n,a*t*n/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(r[0]," bits per sample."))}h(B,a)}else 3===e&&l(B=new Uint8Array(A,o*a*t*n,a*t*n),a,n)}return A}o.addEventListener("message",function(){var A=e(r.mark((function A(e){var t,i,I,g,a,B;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return t=e.data,i=t.id,I=t.fileDirectory,g=t.buffer,A.next=3,n(I);case 3:return a=A.sent,A.next=6,a.decode(I,g);case 6:B=A.sent,o.postMessage({decoded:B,id:i},[B]);case 8:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}());var w=function(){function A(){B(this,A)}var t;return Q(A,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n,a;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,this.decodeBlock(t);case 2:if(i=A.sent,1===(I=e.Predictor||1)){A.next=9;break}return g=!e.StripOffsets,n=g?e.TileWidth:e.ImageWidth,a=g?e.TileLength:e.RowsPerStrip||e.ImageLength,A.abrupt("return",u(i,I,n,a,e.BitsPerSample,e.PlanarConfiguration));case 9:return A.abrupt("return",i);case 10:case"end":return A.stop()}}),A,this)}))),function(A,e){return t.apply(this,arguments)})}]),A}();function d(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var D=function(A){s(t,w);var e=d(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return A}}]),t}(),y=Object.freeze({__proto__:null,default:D});function k(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}function p(A,e){for(var t=e.length-1;t>=0;t--)A.push(e[t]);return A}function m(A){for(var e=new Uint16Array(4093),t=new Uint8Array(4093),i=0;i<=257;i++)e[i]=4096,t[i]=i;var r=258,I=9,g=0;function n(){r=258,I=9}function a(A){var e=function(A,e,t){var i=e%8,r=Math.floor(e/8),I=8-i,g=e+t-8*(r+1),n=8*(r+2)-(e+t),a=8*(r+2)-e;if(n=Math.max(0,n),r>=A.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var o=A[r]&Math.pow(2,8-i)-1,B=o<<=t-I;if(r+1<A.length){var C=A[r+1]>>>n;B+=C<<=Math.max(0,t-a)}if(g>8&&r+2<A.length){var Q=8*(r+3)-(e+t);B+=A[r+2]>>>Q}return B}(A,g,I);return g+=I,e}function o(A,i){return t[r]=i,e[r]=A,++r-1}function B(A){for(var i=[],r=A;4096!==r;r=e[r])i.push(t[r]);return i}var C=[];n();for(var Q,E=new Uint8Array(A),s=a(E);257!==s;){if(256===s){for(n(),s=a(E);256===s;)s=a(E);if(257===s)break;if(s>256)throw new Error("corrupted code at scanline ".concat(s));p(C,B(s)),Q=s}else if(s<r){var f=B(s);p(C,f),o(Q,f[f.length-1]),Q=s}else{var c=B(Q);if(!c)throw new Error("Bogus entry. Not in dictionary, ".concat(Q," / ").concat(r,", position: ").concat(g));p(C,c),C.push(c[c.length-1]),o(Q,c[c.length-1]),Q=s}r+1>=Math.pow(2,I)&&(12===I?Q=void 0:I++),s=a(E)}return new Uint8Array(C)}var G=function(A){s(t,w);var e=k(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return m(A).buffer}}]),t}(),F=Object.freeze({__proto__:null,default:G});function S(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var v=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function R(A,e){for(var t=0,i=[],r=16;r>0&&!A[r-1];)--r;i.push({children:[],index:0});for(var I,g=i[0],n=0;n<r;n++){for(var a=0;a<A[n];a++){for((g=i.pop()).children[g.index]=e[t];g.index>0;)g=i.pop();for(g.index++,i.push(g);i.length<=n;)i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I;t++}n+1<r&&(i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I)}return i[0].children}function U(A,e,i,r,I,g,n,a,o){var B=i.mcusPerLine,C=i.progressive,Q=e,E=e,s=0,f=0;function c(){if(f>0)return f--,s>>f&1;if(255===(s=A[E++])){var e=A[E++];if(e)throw new Error("unexpected marker: ".concat((s<<8|e).toString(16)))}return f=7,s>>>7}function h(A){for(var e,i=A;null!==(e=c());){if("number"==typeof(i=i[e]))return i;if("object"!==t(i))throw new Error("invalid huffman sequence")}return null}function l(A){for(var e=A,t=0;e>0;){var i=c();if(null===i)return;t=t<<1|i,--e}return t}function u(A){var e=l(A);return e>=1<<A-1?e:e+(-1<<A)+1}var w=0;var d,D=0;function y(A,e,t,i,r){var I=t%B,g=(t/B|0)*A.v+i,n=I*A.h+r;e(A,A.blocks[g][n])}function k(A,e,t){var i=t/A.blocksPerLine|0,r=t%A.blocksPerLine;e(A,A.blocks[i][r])}var p,m,G,F,S,R,U=r.length;R=C?0===g?0===a?function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t)<<o;A.pred+=i,e[0]=A.pred}:function(A,e){e[0]|=c()<<o}:0===a?function(A,e){if(w>0)w--;else for(var t=g,i=n;t<=i;){var r=h(A.huffmanTableAC),I=15&r,a=r>>4;if(0===I){if(a<15){w=l(a)+(1<<a)-1;break}t+=16}else e[v[t+=a]]=u(I)*(1<<o),t++}}:function(A,e){for(var t=g,i=n,r=0;t<=i;){var I=v[t],a=e[I]<0?-1:1;switch(D){case 0:var B=h(A.huffmanTableAC),C=15&B;if(r=B>>4,0===C)r<15?(w=l(r)+(1<<r),D=4):(r=16,D=1);else{if(1!==C)throw new Error("invalid ACn encoding");d=u(C),D=r?2:3}continue;case 1:case 2:e[I]?e[I]+=(c()<<o)*a:0==--r&&(D=2===D?3:0);break;case 3:e[I]?e[I]+=(c()<<o)*a:(e[I]=d<<o,D=0);break;case 4:e[I]&&(e[I]+=(c()<<o)*a)}t++}4===D&&0==--w&&(D=0)}:function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t);A.pred+=i,e[0]=A.pred;for(var r=1;r<64;){var I=h(A.huffmanTableAC),g=15&I,n=I>>4;if(0===g){if(n<15)break;r+=16}else e[v[r+=n]]=u(g),r++}};var L,b,M=0;b=1===U?r[0].blocksPerLine*r[0].blocksPerColumn:B*i.mcusPerColumn;for(var N=I||b;M<b;){for(m=0;m<U;m++)r[m].pred=0;if(w=0,1===U)for(p=r[0],S=0;S<N;S++)k(p,R,M),M++;else for(S=0;S<N;S++){for(m=0;m<U;m++){var x=p=r[m],J=x.h,q=x.v;for(G=0;G<q;G++)for(F=0;F<J;F++)y(p,R,M,G,F)}if(++M===b)break}if(f=0,(L=A[E]<<8|A[E+1])<65280)throw new Error("marker was not found");if(!(L>=65488&&L<=65495))break;E+=2}return E-Q}function L(A,e){var t=[],i=e.blocksPerLine,r=e.blocksPerColumn,I=i<<3,g=new Int32Array(64),n=new Uint8Array(64);function a(A,t,i){var r,I,g,n,a,o,B,C,Q,E,s=e.quantizationTable,f=i;for(E=0;E<64;E++)f[E]=A[E]*s[E];for(E=0;E<8;++E){var c=8*E;0!==f[1+c]||0!==f[2+c]||0!==f[3+c]||0!==f[4+c]||0!==f[5+c]||0!==f[6+c]||0!==f[7+c]?(r=5793*f[0+c]+128>>8,I=5793*f[4+c]+128>>8,g=f[2+c],n=f[6+c],a=2896*(f[1+c]-f[7+c])+128>>8,C=2896*(f[1+c]+f[7+c])+128>>8,o=f[3+c]<<4,Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+128>>8,g=1567*g-3784*n+128>>8,n=Q,Q=a-(B=f[5+c]<<4)+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+c]=r+C,f[7+c]=r-C,f[1+c]=I+B,f[6+c]=I-B,f[2+c]=g+o,f[5+c]=g-o,f[3+c]=n+a,f[4+c]=n-a):(Q=5793*f[0+c]+512>>10,f[0+c]=Q,f[1+c]=Q,f[2+c]=Q,f[3+c]=Q,f[4+c]=Q,f[5+c]=Q,f[6+c]=Q,f[7+c]=Q)}for(E=0;E<8;++E){var h=E;0!==f[8+h]||0!==f[16+h]||0!==f[24+h]||0!==f[32+h]||0!==f[40+h]||0!==f[48+h]||0!==f[56+h]?(r=5793*f[0+h]+2048>>12,I=5793*f[32+h]+2048>>12,g=f[16+h],n=f[48+h],a=2896*(f[8+h]-f[56+h])+2048>>12,C=2896*(f[8+h]+f[56+h])+2048>>12,o=f[24+h],Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+2048>>12,g=1567*g-3784*n+2048>>12,n=Q,Q=a-(B=f[40+h])+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+h]=r+C,f[56+h]=r-C,f[8+h]=I+B,f[48+h]=I-B,f[16+h]=g+o,f[40+h]=g-o,f[24+h]=n+a,f[32+h]=n-a):(Q=5793*i[E+0]+8192>>14,f[0+h]=Q,f[8+h]=Q,f[16+h]=Q,f[24+h]=Q,f[32+h]=Q,f[40+h]=Q,f[48+h]=Q,f[56+h]=Q)}for(E=0;E<64;++E){var l=128+(f[E]+8>>4);t[E]=l<0?0:l>255?255:l}}for(var o=0;o<r;o++){for(var B=o<<3,C=0;C<8;C++)t.push(new Uint8Array(I));for(var Q=0;Q<i;Q++){a(e.blocks[o][Q],n,g);for(var E=0,s=Q<<3,f=0;f<8;f++)for(var c=t[B+f],h=0;h<8;h++)c[s+h]=n[E++]}}return t}var b=function(){function A(){B(this,A),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return Q(A,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(A){var e=0;function t(){var t=A[e]<<8|A[e+1];return e+=2,t}function i(A){var e,t,i=0,r=0;for(t in A.components)A.components.hasOwnProperty(t)&&(i<(e=A.components[t]).h&&(i=e.h),r<e.v&&(r=e.v));var I=Math.ceil(A.samplesPerLine/8/i),g=Math.ceil(A.scanLines/8/r);for(t in A.components)if(A.components.hasOwnProperty(t)){e=A.components[t];for(var n=Math.ceil(Math.ceil(A.samplesPerLine/8)*e.h/i),a=Math.ceil(Math.ceil(A.scanLines/8)*e.v/r),o=I*e.h,B=g*e.v,C=[],Q=0;Q<B;Q++){for(var E=[],s=0;s<o;s++)E.push(new Int32Array(64));C.push(E)}e.blocksPerLine=n,e.blocksPerColumn=a,e.blocks=C}A.maxH=i,A.maxV=r,A.mcusPerLine=I,A.mcusPerColumn=g}var r,I,g=t();if(65496!==g)throw new Error("SOI not found");for(g=t();65497!==g;){switch(g){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var n=(r=void 0,I=void 0,r=t(),I=A.subarray(e,e+r-2),e+=I.length,I);65504===g&&74===n[0]&&70===n[1]&&73===n[2]&&70===n[3]&&0===n[4]&&(this.jfif={version:{major:n[5],minor:n[6]},densityUnits:n[7],xDensity:n[8]<<8|n[9],yDensity:n[10]<<8|n[11],thumbWidth:n[12],thumbHeight:n[13],thumbData:n.subarray(14,14+3*n[12]*n[13])}),65518===g&&65===n[0]&&100===n[1]&&111===n[2]&&98===n[3]&&101===n[4]&&0===n[5]&&(this.adobe={version:n[6],flags0:n[7]<<8|n[8],flags1:n[9]<<8|n[10],transformCode:n[11]});break;case 65499:for(var a=t()+e-2;e<a;){var o=A[e++],B=new Int32Array(64);if(o>>4==0)for(var C=0;C<64;C++){B[v[C]]=A[e++]}else{if(o>>4!=1)throw new Error("DQT: invalid table spec");for(var Q=0;Q<64;Q++){B[v[Q]]=t()}}this.quantizationTables[15&o]=B}break;case 65472:case 65473:case 65474:t();for(var E={extended:65473===g,progressive:65474===g,precision:A[e++],scanLines:t(),samplesPerLine:t(),components:{},componentsOrder:[]},s=A[e++],f=void 0,c=0;c<s;c++){f=A[e];var h=A[e+1]>>4,l=15&A[e+1],u=A[e+2];E.componentsOrder.push(f),E.components[f]={h:h,v:l,quantizationIdx:u},e+=3}i(E),this.frames.push(E);break;case 65476:for(var w=t(),d=2;d<w;){for(var D=A[e++],y=new Uint8Array(16),k=0,p=0;p<16;p++,e++)y[p]=A[e],k+=y[p];for(var m=new Uint8Array(k),G=0;G<k;G++,e++)m[G]=A[e];d+=17+k,D>>4==0?this.huffmanTablesDC[15&D]=R(y,m):this.huffmanTablesAC[15&D]=R(y,m)}break;case 65501:t(),this.resetInterval=t();break;case 65498:t();for(var F=A[e++],S=[],L=this.frames[0],b=0;b<F;b++){var M=L.components[A[e++]],N=A[e++];M.huffmanTableDC=this.huffmanTablesDC[N>>4],M.huffmanTableAC=this.huffmanTablesAC[15&N],S.push(M)}var x=A[e++],J=A[e++],q=A[e++],Y=U(A,e,L,S,this.resetInterval,x,J,q>>4,15&q);e+=Y;break;case 65535:255!==A[e]&&e--;break;default:if(255===A[e-3]&&A[e-2]>=192&&A[e-2]<=254){e-=3;break}throw new Error("unknown JPEG marker ".concat(g.toString(16)))}g=t()}}},{key:"getResult",value:function(){var A=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var e=0;e<this.frames.length;e++)for(var t=this.frames[e].components,i=0,r=Object.keys(t);i<r.length;i++){var I=r[i];t[I].quantizationTable=this.quantizationTables[t[I].quantizationIdx],delete t[I].quantizationIdx}for(var g=A[0],n=g.components,a=g.componentsOrder,o=[],B=g.samplesPerLine,C=g.scanLines,Q=0;Q<a.length;Q++){var E=n[a[Q]];o.push({lines:L(0,E),scaleX:E.h/g.maxH,scaleY:E.v/g.maxV})}for(var s=new Uint8Array(B*C*o.length),f=0,c=0;c<C;++c)for(var h=0;h<B;++h)for(var l=0;l<o.length;++l){var u=o[l];s[f]=u.lines[0|c*u.scaleY][0|h*u.scaleX],++f}return s}}]),A}(),M=function(A){s(t,w);var e=S(t);function t(A){var i;return B(this,t),(i=e.call(this)).reader=new b,A.JPEGTables&&i.reader.parse(A.JPEGTables),i}return Q(t,[{key:"decodeBlock",value:function(A){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(A)),this.reader.getResult().buffer}}]),t}(),N=Object.freeze({__proto__:null,default:M});function x(A){for(var e=A.length;--e>=0;)A[e]=0}x(new Array(576)),x(new Array(60)),x(new Array(512)),x(new Array(256)),x(new Array(29)),x(new Array(30));var J=function(A,e,t,i){for(var r=65535&A|0,I=A>>>16&65535|0,g=0;0!==t;){t-=g=t>2e3?2e3:t;do{I=I+(r=r+e[i++]|0)|0}while(--g);r%=65521,I%=65521}return r|I<<16|0},q=new Uint32Array(function(){for(var A,e=[],t=0;t<256;t++){A=t;for(var i=0;i<8;i++)A=1&A?3988292384^A>>>1:A>>>1;e[t]=A}return e}()),Y=function(A,e,t,i){var r=q,I=i+t;A^=-1;for(var g=i;g<I;g++)A=A>>>8^r[255&(A^e[g])];return-1^A},K={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},O=function(A,e){return Object.prototype.hasOwnProperty.call(A,e)},P=function(A){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!==t(i))throw new TypeError(i+"must be non-object");for(var r in i)O(i,r)&&(A[r]=i[r])}}return A},T=function(A){for(var e=0,t=0,i=A.length;t<i;t++)e+=A[t].length;for(var r=new Uint8Array(e),I=0,g=0,n=A.length;I<n;I++){var a=A[I];r.set(a,g),g+=a.length}return r},V=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){V=!1}for(var _=new Uint8Array(256),X=0;X<256;X++)_[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;_[254]=_[254]=1;var Z=function(A){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(A);var e,t,i,r,I,g=A.length,n=0;for(r=0;r<g;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),n+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(n),I=0,r=0;I<n;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),t<128?e[I++]=t:t<2048?(e[I++]=192|t>>>6,e[I++]=128|63&t):t<65536?(e[I++]=224|t>>>12,e[I++]=128|t>>>6&63,e[I++]=128|63&t):(e[I++]=240|t>>>18,e[I++]=128|t>>>12&63,e[I++]=128|t>>>6&63,e[I++]=128|63&t);return e},j=function(A,e){var t,i,r=e||A.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(A.subarray(0,e));var I=new Array(2*r);for(i=0,t=0;t<r;){var g=A[t++];if(g<128)I[i++]=g;else{var n=_[g];if(n>4)I[i++]=65533,t+=n-1;else{for(g&=2===n?31:3===n?15:7;n>1&&t<r;)g=g<<6|63&A[t++],n--;n>1?I[i++]=65533:g<65536?I[i++]=g:(g-=65536,I[i++]=55296|g>>10&1023,I[i++]=56320|1023&g)}}}return function(A,e){if(e<65534&&A.subarray&&V)return String.fromCharCode.apply(null,A.length===e?A:A.subarray(0,e));for(var t="",i=0;i<e;i++)t+=String.fromCharCode(A[i]);return t}(I,i)},W=function(A,e){(e=e||A.length)>A.length&&(e=A.length);for(var t=e-1;t>=0&&128==(192&A[t]);)t--;return t<0||0===t?e:t+_[A[t]]>e?t:e};var z=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},$=function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=A.state;t=A.next_in,k=A.input,i=t+(A.avail_in-5),r=A.next_out,p=A.output,I=r-(e-A.avail_out),g=r+(A.avail_out-257),n=m.dmax,a=m.wsize,o=m.whave,B=m.wnext,C=m.window,Q=m.hold,E=m.bits,s=m.lencode,f=m.distcode,c=(1<<m.lenbits)-1,h=(1<<m.distbits)-1;A:do{E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=s[Q&c];e:for(;;){if(Q>>>=u=l>>>24,E-=u,0===(u=l>>>16&255))p[r++]=65535&l;else{if(!(16&u)){if(0==(64&u)){l=s[(65535&l)+(Q&(1<<u)-1)];continue e}if(32&u){m.mode=12;break A}A.msg="invalid literal/length code",m.mode=30;break A}w=65535&l,(u&=15)&&(E<u&&(Q+=k[t++]<<E,E+=8),w+=Q&(1<<u)-1,Q>>>=u,E-=u),E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=f[Q&h];t:for(;;){if(Q>>>=u=l>>>24,E-=u,!(16&(u=l>>>16&255))){if(0==(64&u)){l=f[(65535&l)+(Q&(1<<u)-1)];continue t}A.msg="invalid distance code",m.mode=30;break A}if(d=65535&l,E<(u&=15)&&(Q+=k[t++]<<E,(E+=8)<u&&(Q+=k[t++]<<E,E+=8)),(d+=Q&(1<<u)-1)>n){A.msg="invalid distance too far back",m.mode=30;break A}if(Q>>>=u,E-=u,d>(u=r-I)){if((u=d-u)>o&&m.sane){A.msg="invalid distance too far back",m.mode=30;break A}if(D=0,y=C,0===B){if(D+=a-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}else if(B<u){if(D+=a+B-u,(u-=B)<w){w-=u;do{p[r++]=C[D++]}while(--u);if(D=0,B<w){w-=u=B;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}}else if(D+=B-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}for(;w>2;)p[r++]=y[D++],p[r++]=y[D++],p[r++]=y[D++],w-=3;w&&(p[r++]=y[D++],w>1&&(p[r++]=y[D++]))}else{D=r-d;do{p[r++]=p[D++],p[r++]=p[D++],p[r++]=p[D++],w-=3}while(w>2);w&&(p[r++]=p[D++],w>1&&(p[r++]=p[D++]))}break}}break}}while(t<i&&r<g);t-=w=E>>3,Q&=(1<<(E-=w<<3))-1,A.next_in=t,A.next_out=r,A.avail_in=t<i?i-t+5:5-(t-i),A.avail_out=r<g?g-r+257:257-(r-g),m.hold=Q,m.bits=E},AA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),eA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),tA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),iA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),rA=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E,s,f,c,h=n.bits,l=0,u=0,w=0,d=0,D=0,y=0,k=0,p=0,m=0,G=0,F=null,S=0,v=new Uint16Array(16),R=new Uint16Array(16),U=null,L=0;for(l=0;l<=15;l++)v[l]=0;for(u=0;u<i;u++)v[e[t+u]]++;for(D=h,d=15;d>=1&&0===v[d];d--);if(D>d&&(D=d),0===d)return r[I++]=20971520,r[I++]=20971520,n.bits=1,0;for(w=1;w<d&&0===v[w];w++);for(D<w&&(D=w),p=1,l=1;l<=15;l++)if(p<<=1,(p-=v[l])<0)return-1;if(p>0&&(0===A||1!==d))return-1;for(R[1]=0,l=1;l<15;l++)R[l+1]=R[l]+v[l];for(u=0;u<i;u++)0!==e[t+u]&&(g[R[e[t+u]]++]=u);if(0===A?(F=U=g,E=19):1===A?(F=AA,S-=257,U=eA,L-=257,E=256):(F=tA,U=iA,E=-1),G=0,u=0,l=w,Q=I,y=D,k=0,B=-1,C=(m=1<<D)-1,1===A&&m>852||2===A&&m>592)return 1;for(;;){s=l-k,g[u]<E?(f=0,c=g[u]):g[u]>E?(f=U[L+g[u]],c=F[S+g[u]]):(f=96,c=0),a=1<<l-k,w=o=1<<y;do{r[Q+(G>>k)+(o-=a)]=s<<24|f<<16|c|0}while(0!==o);for(a=1<<l-1;G&a;)a>>=1;if(0!==a?(G&=a-1,G+=a):G=0,u++,0==--v[l]){if(l===d)break;l=e[t+g[u]]}if(l>D&&(G&C)!==B){for(0===k&&(k=D),Q+=w,p=1<<(y=l-k);y+k<d&&!((p-=v[y+k])<=0);)y++,p<<=1;if(m+=1<<y,1===A&&m>852||2===A&&m>592)return 1;r[B=G&C]=D<<24|y<<16|Q-I|0}}return 0!==G&&(r[Q+G]=l-k<<24|64<<16|0),n.bits=D,0},IA=H.Z_FINISH,gA=H.Z_BLOCK,nA=H.Z_TREES,aA=H.Z_OK,oA=H.Z_STREAM_END,BA=H.Z_NEED_DICT,CA=H.Z_STREAM_ERROR,QA=H.Z_DATA_ERROR,EA=H.Z_MEM_ERROR,sA=H.Z_BUF_ERROR,fA=H.Z_DEFLATED,cA=function(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)};function hA(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var lA,uA,wA=function(A){if(!A||!A.state)return CA;var e=A.state;return A.total_in=A.total_out=e.total=0,A.msg="",e.wrap&&(A.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,aA},dA=function(A){if(!A||!A.state)return CA;var e=A.state;return e.wsize=0,e.whave=0,e.wnext=0,wA(A)},DA=function(A,e){var t;if(!A||!A.state)return CA;var i=A.state;return e<0?(t=0,e=-e):(t=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?CA:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,dA(A))},yA=function(A,e){if(!A)return CA;var t=new hA;A.state=t,t.window=null;var i=DA(A,e);return i!==aA&&(A.state=null),i},kA=!0,pA=function(A){if(kA){lA=new Int32Array(512),uA=new Int32Array(32);for(var e=0;e<144;)A.lens[e++]=8;for(;e<256;)A.lens[e++]=9;for(;e<280;)A.lens[e++]=7;for(;e<288;)A.lens[e++]=8;for(rA(1,A.lens,0,288,lA,0,A.work,{bits:9}),e=0;e<32;)A.lens[e++]=5;rA(2,A.lens,0,32,uA,0,A.work,{bits:5}),kA=!1}A.lencode=lA,A.lenbits=9,A.distcode=uA,A.distbits=5},mA=function(A,e,t,i){var r,I=A.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Uint8Array(I.wsize)),i>=I.wsize?(I.window.set(e.subarray(t-I.wsize,t),0),I.wnext=0,I.whave=I.wsize):((r=I.wsize-I.wnext)>i&&(r=i),I.window.set(e.subarray(t-i,t-i+r),I.wnext),(i-=r)?(I.window.set(e.subarray(t-i,t),0),I.wnext=i,I.whave=I.wsize):(I.wnext+=r,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=r))),0},GA={inflateReset:dA,inflateReset2:DA,inflateResetKeep:wA,inflateInit:function(A){return yA(A,15)},inflateInit2:yA,inflate:function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=0,G=new Uint8Array(4),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!A||!A.state||!A.output||!A.input&&0!==A.avail_in)return CA;12===(t=A.state).mode&&(t.mode=13),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,C=n,Q=a,y=aA;A:for(;;)switch(t.mode){case 1:if(0===t.wrap){t.mode=13;break}for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(2&t.wrap&&35615===o){t.check=0,G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0),o=0,B=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&o)<<8)+(o>>8))%31){A.msg="incorrect header check",t.mode=30;break}if((15&o)!==fA){A.msg="unknown compression method",t.mode=30;break}if(B-=4,D=8+(15&(o>>>=4)),0===t.wbits)t.wbits=D;else if(D>t.wbits){A.msg="invalid window size",t.mode=30;break}t.dmax=1<<t.wbits,A.adler=t.check=1,t.mode=512&o?10:12,o=0,B=0;break;case 2:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.flags=o,(255&t.flags)!==fA){A.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){A.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=o>>8&1),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=3;case 3:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.time=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,G[2]=o>>>16&255,G[3]=o>>>24&255,t.check=Y(t.check,G,4,0)),o=0,B=0,t.mode=4;case 4:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.xflags=255&o,t.head.os=o>>8),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=5;case 5:if(1024&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length=o,t.head&&(t.head.extra_len=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((E=t.length)>n&&(E=n),E&&(t.head&&(D=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(I,I+E),D)),512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,t.length-=E),t.length))break A;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.name+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.comment+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(65535&t.check)){A.msg="header crc mismatch",t.mode=30;break}o=0,B=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),A.adler=t.check=0,t.mode=12;break;case 10:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}A.adler=t.check=cA(o),o=0,B=0,t.mode=11;case 11:if(0===t.havedict)return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,BA;A.adler=t.check=1,t.mode=12;case 12:if(e===gA||e===nA)break A;case 13:if(t.last){o>>>=7&B,B-=7&B,t.mode=27;break}for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}switch(t.last=1&o,B-=1,3&(o>>>=1)){case 0:t.mode=14;break;case 1:if(pA(t),t.mode=20,e===nA){o>>>=2,B-=2;break A}break;case 2:t.mode=17;break;case 3:A.msg="invalid block type",t.mode=30}o>>>=2,B-=2;break;case 14:for(o>>>=7&B,B-=7&B;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if((65535&o)!=(o>>>16^65535)){A.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&o,o=0,B=0,t.mode=15,e===nA)break A;case 15:t.mode=16;case 16:if(E=t.length){if(E>n&&(E=n),E>a&&(E=a),0===E)break A;r.set(i.subarray(I,I+E),g),n-=E,I+=E,a-=E,g+=E,t.length-=E;break}t.mode=12;break;case 17:for(;B<14;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.nlen=257+(31&o),o>>>=5,B-=5,t.ndist=1+(31&o),o>>>=5,B-=5,t.ncode=4+(15&o),o>>>=4,B-=4,t.nlen>286||t.ndist>30){A.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.lens[F[t.have++]]=7&o,o>>>=3,B-=3}for(;t.have<19;)t.lens[F[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,k={bits:t.lenbits},y=rA(0,t.lens,0,19,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(l<16)o>>>=c,B-=c,t.lens[t.have++]=l;else{if(16===l){for(p=c+2;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o>>>=c,B-=c,0===t.have){A.msg="invalid bit length repeat",t.mode=30;break}D=t.lens[t.have-1],E=3+(3&o),o>>>=2,B-=2}else if(17===l){for(p=c+3;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=3+(7&(o>>>=c)),o>>>=3,B-=3}else{for(p=c+7;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=11+(127&(o>>>=c)),o>>>=7,B-=7}if(t.have+E>t.nlen+t.ndist){A.msg="invalid bit length repeat",t.mode=30;break}for(;E--;)t.lens[t.have++]=D}}if(30===t.mode)break;if(0===t.lens[256]){A.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,k={bits:t.lenbits},y=rA(1,t.lens,0,t.nlen,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,k={bits:t.distbits},y=rA(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,k),t.distbits=k.bits,y){A.msg="invalid distances set",t.mode=30;break}if(t.mode=20,e===nA)break A;case 20:t.mode=21;case 21:if(n>=6&&a>=258){A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,$(A,Q),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,12===t.mode&&(t.back=-1);break}for(t.back=0;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(h&&0==(240&h)){for(u=c,w=h,d=l;h=(m=t.lencode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,t.length=l,0===h){t.mode=26;break}if(32&h){t.back=-1,t.mode=12;break}if(64&h){A.msg="invalid literal/length code",t.mode=30;break}t.extra=15&h,t.mode=22;case 22:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;h=(m=t.distcode[o&(1<<t.distbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(0==(240&h)){for(u=c,w=h,d=l;h=(m=t.distcode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,64&h){A.msg="invalid distance code",t.mode=30;break}t.offset=l,t.extra=15&h,t.mode=24;case 24:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.offset+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){A.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(0===a)break A;if(E=Q-a,t.offset>E){if((E=t.offset-E)>t.whave&&t.sane){A.msg="invalid distance too far back",t.mode=30;break}E>t.wnext?(E-=t.wnext,s=t.wsize-E):s=t.wnext-E,E>t.length&&(E=t.length),f=t.window}else f=r,s=g-t.offset,E=t.length;E>a&&(E=a),a-=E,t.length-=E;do{r[g++]=f[s++]}while(--E);0===t.length&&(t.mode=21);break;case 26:if(0===a)break A;r[g++]=t.length,a--,t.mode=21;break;case 27:if(t.wrap){for(;B<32;){if(0===n)break A;n--,o|=i[I++]<<B,B+=8}if(Q-=a,A.total_out+=Q,t.total+=Q,Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,g-Q):J(t.check,r,Q,g-Q)),Q=a,(t.flags?o:cA(o))!==t.check){A.msg="incorrect data check",t.mode=30;break}o=0,B=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(4294967295&t.total)){A.msg="incorrect length check",t.mode=30;break}o=0,B=0}t.mode=29;case 29:y=oA;break A;case 30:y=QA;break A;case 31:return EA;default:return CA}return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,(t.wsize||Q!==A.avail_out&&t.mode<30&&(t.mode<27||e!==IA))&&mA(A,A.output,A.next_out,Q-A.avail_out),C-=A.avail_in,Q-=A.avail_out,A.total_in+=C,A.total_out+=Q,t.total+=Q,t.wrap&&Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,A.next_out-Q):J(t.check,r,Q,A.next_out-Q)),A.data_type=t.bits+(t.last?64:0)+(12===t.mode?128:0)+(20===t.mode||15===t.mode?256:0),(0===C&&0===Q||e===IA)&&y===aA&&(y=sA),y},inflateEnd:function(A){if(!A||!A.state)return CA;var e=A.state;return e.window&&(e.window=null),A.state=null,aA},inflateGetHeader:function(A,e){if(!A||!A.state)return CA;var t=A.state;return 0==(2&t.wrap)?CA:(t.head=e,e.done=!1,aA)},inflateSetDictionary:function(A,e){var t,i=e.length;return A&&A.state?0!==(t=A.state).wrap&&11!==t.mode?CA:11===t.mode&&J(1,e,i,0)!==t.check?QA:mA(A,e,i,i)?(t.mode=31,EA):(t.havedict=1,aA):CA},inflateInfo:"pako inflate (from Nodeca project)"};var FA=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},SA=Object.prototype.toString,vA=H.Z_NO_FLUSH,RA=H.Z_FINISH,UA=H.Z_OK,LA=H.Z_STREAM_END,bA=H.Z_NEED_DICT,MA=H.Z_STREAM_ERROR,NA=H.Z_DATA_ERROR,xA=H.Z_MEM_ERROR;function JA(A){this.options=P({chunkSize:65536,windowBits:15,to:""},A||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||A&&A.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;var t=GA.inflateInit2(this.strm,e.windowBits);if(t!==UA)throw new Error(K[t]);if(this.header=new FA,GA.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Z(e.dictionary):"[object ArrayBuffer]"===SA.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=GA.inflateSetDictionary(this.strm,e.dictionary))!==UA))throw new Error(K[t])}function qA(A,e){var t=new JA(e);if(t.push(A),t.err)throw t.msg||K[t.err];return t.result}JA.prototype.push=function(A,e){var t,i,r,I=this.strm,g=this.options.chunkSize,n=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?RA:vA,"[object ArrayBuffer]"===SA.call(A)?I.input=new Uint8Array(A):I.input=A,I.next_in=0,I.avail_in=I.input.length;;){for(0===I.avail_out&&(I.output=new Uint8Array(g),I.next_out=0,I.avail_out=g),(t=GA.inflate(I,i))===bA&&n&&((t=GA.inflateSetDictionary(I,n))===UA?t=GA.inflate(I,i):t===NA&&(t=bA));I.avail_in>0&&t===LA&&I.state.wrap>0&&0!==A[I.next_in];)GA.inflateReset(I),t=GA.inflate(I,i);switch(t){case MA:case NA:case bA:case xA:return this.onEnd(t),this.ended=!0,!1}if(r=I.avail_out,I.next_out&&(0===I.avail_out||t===LA))if("string"===this.options.to){var a=W(I.output,I.next_out),o=I.next_out-a,B=j(I.output,a);I.next_out=o,I.avail_out=g-o,o&&I.output.set(I.output.subarray(a,a+o),0),this.onData(B)}else this.onData(I.output.length===I.next_out?I.output:I.output.subarray(0,I.next_out));if(t!==UA||0!==r){if(t===LA)return t=GA.inflateEnd(this.strm),this.onEnd(t),this.ended=!0,!0;if(0===I.avail_in)break}}return!0},JA.prototype.onData=function(A){this.chunks.push(A)},JA.prototype.onEnd=function(A){A===UA&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};var YA={Inflate:JA,inflate:qA,inflateRaw:function(A,e){return(e=e||{}).raw=!0,qA(A,e)},ungzip:qA,constants:H}.inflate;function KA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var HA=function(A){s(t,w);var e=KA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return YA(new Uint8Array(A)).buffer}}]),t}(),OA=Object.freeze({__proto__:null,default:HA});function PA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var TA,VA=function(A){s(t,w);var e=PA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){for(var e=new DataView(A),t=[],i=0;i<A.byteLength;++i){var r=e.getInt8(i);if(r<0){var I=e.getUint8(i+1);r=-r;for(var g=0;g<=r;++g)t.push(I);i+=1}else{for(var n=0;n<=r;++n)t.push(e.getUint8(i+n+1));i+=r+1}}return new Uint8Array(t).buffer}}]),t}(),_A=Object.freeze({__proto__:null,default:VA}),XA={exports:{}};TA=XA,\n/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */\nfunction(){var A,e,t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c=(A={defaultNoDataValue:-34027999387901484e22,decode:function(I,g){var n=(g=g||{}).encodedMaskData||null===g.encodedMaskData,a=r(I,g.inputOffset||0,n),o=null!==g.noDataValue?g.noDataValue:A.defaultNoDataValue,B=e(a,g.pixelType||Float32Array,g.encodedMaskData,o,g.returnMask),C={width:a.width,height:a.height,pixelData:B.resultPixels,minValue:B.minValue,maxValue:a.pixels.maxValue,noDataValue:o};return B.resultMask&&(C.maskData=B.resultMask),g.returnEncodedMask&&a.mask&&(C.encodedMaskData=a.mask.bitset?a.mask.bitset:null),g.returnFileInfo&&(C.fileInfo=t(a),g.computeUsedBitDepths&&(C.fileInfo.bitDepths=i(a))),C}},e=function(A,e,t,i,r){var g,n,a,o=0,B=A.pixels.numBlocksX,C=A.pixels.numBlocksY,Q=Math.floor(A.width/B),E=Math.floor(A.height/C),s=2*A.maxZError,f=Number.MAX_VALUE;t=t||(A.mask?A.mask.bitset:null),n=new e(A.width*A.height),r&&t&&(a=new Uint8Array(A.width*A.height));for(var c,h,l=new Float32Array(Q*E),u=0;u<=C;u++){var w=u!==C?E:A.height%C;if(0!==w)for(var d=0;d<=B;d++){var D=d!==B?Q:A.width%B;if(0!==D){var y,k,p,m,G=u*A.width*E+d*Q,F=A.width-D,S=A.pixels.blocks[o];if(S.encoding<2?(0===S.encoding?y=S.rawData:(I(S.stuffedData,S.bitsPerPixel,S.numValidPixels,S.offset,s,l,A.pixels.maxValue),y=l),k=0):p=2===S.encoding?0:S.offset,t)for(h=0;h<w;h++){for(7&G&&(m=t[G>>3],m<<=7&G),c=0;c<D;c++)7&G||(m=t[G>>3]),128&m?(a&&(a[G]=1),f=f>(g=S.encoding<2?y[k++]:p)?g:f,n[G++]=g):(a&&(a[G]=0),n[G++]=i),m<<=1;G+=F}else if(S.encoding<2)for(h=0;h<w;h++){for(c=0;c<D;c++)f=f>(g=y[k++])?g:f,n[G++]=g;G+=F}else for(f=f>p?p:f,h=0;h<w;h++){for(c=0;c<D;c++)n[G++]=p;G+=F}if(1===S.encoding&&k!==S.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:n,resultMask:a,minValue:f}},t=function(A){return{fileIdentifierString:A.fileIdentifierString,fileVersion:A.fileVersion,imageType:A.imageType,height:A.height,width:A.width,maxZError:A.maxZError,eofOffset:A.eofOffset,mask:A.mask?{numBlocksX:A.mask.numBlocksX,numBlocksY:A.mask.numBlocksY,numBytes:A.mask.numBytes,maxValue:A.mask.maxValue}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,numBytes:A.pixels.numBytes,maxValue:A.pixels.maxValue,noDataValue:A.noDataValue}}},i=function(A){for(var e=A.pixels.numBlocksX*A.pixels.numBlocksY,t={},i=0;i<e;i++){var r=A.pixels.blocks[i];0===r.encoding?t.float32=!0:1===r.encoding?t[r.bitsPerPixel]=!0:t[0]=!0}return Object.keys(t)},r=function(A,e,t){var i={},r=new Uint8Array(A,e,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,r),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;e+=10;var I=new DataView(A,e,24);if(i.fileVersion=I.getInt32(0,!0),i.imageType=I.getInt32(4,!0),i.height=I.getUint32(8,!0),i.width=I.getUint32(12,!0),i.maxZError=I.getFloat64(16,!0),e+=24,!t)if(I=new DataView(A,e,16),i.mask={},i.mask.numBlocksY=I.getUint32(0,!0),i.mask.numBlocksX=I.getUint32(4,!0),i.mask.numBytes=I.getUint32(8,!0),i.mask.maxValue=I.getFloat32(12,!0),e+=16,i.mask.numBytes>0){var g=new Uint8Array(Math.ceil(i.width*i.height/8)),n=(I=new DataView(A,e,i.mask.numBytes)).getInt16(0,!0),a=2,o=0;do{if(n>0)for(;n--;)g[o++]=I.getUint8(a++);else{var B=I.getUint8(a++);for(n=-n;n--;)g[o++]=B}n=I.getInt16(a,!0),a+=2}while(a<i.mask.numBytes);if(-32768!==n||o<g.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=g,e+=i.mask.numBytes}else 0==(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));I=new DataView(A,e,16),i.pixels={},i.pixels.numBlocksY=I.getUint32(0,!0),i.pixels.numBlocksX=I.getUint32(4,!0),i.pixels.numBytes=I.getUint32(8,!0),i.pixels.maxValue=I.getFloat32(12,!0),e+=16;var C=i.pixels.numBlocksX,Q=i.pixels.numBlocksY,E=C+(i.width%C>0?1:0),s=Q+(i.height%Q>0?1:0);i.pixels.blocks=new Array(E*s);for(var f=0,c=0;c<s;c++)for(var h=0;h<E;h++){var l=0,u=A.byteLength-e;I=new DataView(A,e,Math.min(10,u));var w={};i.pixels.blocks[f++]=w;var d=I.getUint8(0);if(l++,w.encoding=63&d,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==d&&2!==d){if(d>>=6,w.offsetType=d,2===d)w.offset=I.getInt8(1),l++;else if(1===d)w.offset=I.getInt16(1,!0),l+=2;else{if(0!==d)throw"Invalid block offset type";w.offset=I.getFloat32(1,!0),l+=4}if(1===w.encoding)if(d=I.getUint8(l),l++,w.bitsPerPixel=63&d,d>>=6,w.numValidPixelsType=d,2===d)w.numValidPixels=I.getUint8(l),l++;else if(1===d)w.numValidPixels=I.getUint16(l,!0),l+=2;else{if(0!==d)throw"Invalid valid pixel count type";w.numValidPixels=I.getUint32(l,!0),l+=4}}var D;if(e+=l,3!==w.encoding)if(0===w.encoding){var y=(i.pixels.numBytes-1)/4;if(y!==Math.floor(y))throw"uncompressed block has invalid length";D=new ArrayBuffer(4*y),new Uint8Array(D).set(new Uint8Array(A,e,4*y));var k=new Float32Array(D);w.rawData=k,e+=4*y}else if(1===w.encoding){var p=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),m=Math.ceil(p/4);D=new ArrayBuffer(4*m),new Uint8Array(D).set(new Uint8Array(A,e,p)),w.stuffedData=new Uint32Array(D),e+=p}}else e++}return i.eofOffset=e,i},I=function(A,e,t,i,r,I,g){var n,a,o,B=(1<<e)-1,C=0,Q=0,E=Math.ceil((g-i)/r),s=4*A.length-Math.ceil(e*t/8);for(A[A.length-1]<<=8*s,n=0;n<t;n++){if(0===Q&&(o=A[C++],Q=32),Q>=e)a=o>>>Q-e&B,Q-=e;else{var f=e-Q;a=(o&B)<<f&B,a+=(o=A[C++])>>>(Q=32-f)}I[n]=a<E?i+a*r:g}return I},A),h=(g=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E=(1<<t)-1,s=0,f=0,c=4*A.length-Math.ceil(t*i/8);if(A[A.length-1]<<=8*c,r)for(a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=r[o];else for(Q=Math.ceil((n-I)/g),a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=o<Q?I+o*g:n},n=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=[],s=4*A.length-Math.ceil(e*t/8);A[A.length-1]<<=8*s;var f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32),C>=e?(Q=g>>>C-e&n,C-=e):(Q=(g&n)<<(B=e-C)&n,Q+=(g=A[a++])>>>(C=32-B)),E[o]=Q<f?i+Q*r:I;return E.unshift(i),E},a=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q=(1<<t)-1,E=0,s=0,f=0;if(r)for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=r[o];else{var c=Math.ceil((n-I)/g);for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=o<c?I+o*g:n}return e},o=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=0,s=[],f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32,E=0),C>=e?(Q=g>>>E&n,C-=e,E+=e):(Q=g>>>E&n,C=32-(B=e-C),Q|=((g=A[a++])&(1<<B)-1)<<e-B,E=B),s[o]=Q<f?i+Q*r:I;return s.unshift(i),s},B=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=4*A.length-Math.ceil(t*i/8);for(A[A.length-1]<<=8*C,r=0;r<i;r++)0===B&&(g=A[o++],B=32),B>=t?(I=g>>>B-t&a,B-=t):(I=(g&a)<<(n=t-B)&a,I+=(g=A[o++])>>>(B=32-n)),e[r]=I;return e},C=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=0;for(r=0;r<i;r++)0===B&&(g=A[o++],B=32,C=0),B>=t?(I=g>>>C&a,B-=t,C+=t):(I=g>>>C&a,B=32-(n=t-B),I|=((g=A[o++])&(1<<n)-1)<<t-n,C=n),e[r]=I;return e},Q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(A){for(var e=65535,t=65535,i=A.length,r=Math.floor(i/2),I=0;r;){var g=r>=359?359:r;r-=g;do{e+=A[I++]<<8,t+=e+=A[I++]}while(--g);e=(65535&e)+(e>>>16),t=(65535&t)+(t>>>16)}return 1&i&&(t+=e+=A[I]<<8),((t=(65535&t)+(t>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(A,e){var t=e.ptr,i=new Uint8Array(A,t,6),r={};if(r.fileIdentifierString=String.fromCharCode.apply(null,i),0!==r.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+r.fileIdentifierString;t+=6;var I,g=new DataView(A,t,8),n=g.getInt32(0,!0);if(r.fileVersion=n,t+=4,n>=3&&(r.checksum=g.getUint32(4,!0),t+=4),g=new DataView(A,t,12),r.height=g.getUint32(0,!0),r.width=g.getUint32(4,!0),t+=8,n>=4?(r.numDims=g.getUint32(8,!0),t+=4):r.numDims=1,g=new DataView(A,t,40),r.numValidPixel=g.getUint32(0,!0),r.microBlockSize=g.getInt32(4,!0),r.blobSize=g.getInt32(8,!0),r.imageType=g.getInt32(12,!0),r.maxZError=g.getFloat64(16,!0),r.zMin=g.getFloat64(24,!0),r.zMax=g.getFloat64(32,!0),t+=40,e.headerInfo=r,e.ptr=t,n>=3&&(I=n>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(A,t-I,r.blobSize-14))!==r.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(A,e){var t=e.headerInfo,i=this.getDataTypeArray(t.imageType),r=t.numDims*this.getDataTypeSize(t.imageType),I=this.readSubArray(A,e.ptr,i,r),g=this.readSubArray(A,e.ptr+r,i,r);e.ptr+=2*r;var n,a=!0;for(n=0;n<t.numDims;n++)if(I[n]!==g[n]){a=!1;break}return t.minValues=I,t.maxValues=g,a},readSubArray:function(A,e,t,i){var r;if(t===Uint8Array)r=new Uint8Array(A,e,i);else{var I=new ArrayBuffer(i);new Uint8Array(I).set(new Uint8Array(A,e,i)),r=new t(I)}return r},readMask:function(A,e){var t,i,r=e.ptr,I=e.headerInfo,g=I.width*I.height,n=I.numValidPixel,a=new DataView(A,r,4),o={};if(o.numBytes=a.getUint32(0,!0),r+=4,(0===n||g===n)&&0!==o.numBytes)throw"invalid mask";if(0===n)t=new Uint8Array(Math.ceil(g/8)),o.bitset=t,i=new Uint8Array(g),e.pixels.resultMask=i,r+=o.numBytes;else if(o.numBytes>0){t=new Uint8Array(Math.ceil(g/8));var B=(a=new DataView(A,r,o.numBytes)).getInt16(0,!0),C=2,Q=0,E=0;do{if(B>0)for(;B--;)t[Q++]=a.getUint8(C++);else for(E=a.getUint8(C++),B=-B;B--;)t[Q++]=E;B=a.getInt16(C,!0),C+=2}while(C<o.numBytes);if(-32768!==B||Q<t.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(g);var s=0,f=0;for(f=0;f<g;f++)7&f?(s=t[f>>3],s<<=7&f):s=t[f>>3],128&s&&(i[f]=1);e.pixels.resultMask=i,o.bitset=t,r+=o.numBytes}return e.ptr=r,e.mask=o,!0},readDataOneSweep:function(A,e,t,i){var r,I=e.ptr,g=e.headerInfo,n=g.numDims,a=g.width*g.height,o=g.imageType,B=g.numValidPixel*Q.getDataTypeSize(o)*n,C=e.pixels.resultMask;if(t===Uint8Array)r=new Uint8Array(A,I,B);else{var E=new ArrayBuffer(B);new Uint8Array(E).set(new Uint8Array(A,I,B)),r=new t(E)}if(r.length===a*n)e.pixels.resultPixels=i?Q.swapDimensionOrder(r,a,n,t,!0):r;else{e.pixels.resultPixels=new t(a*n);var s=0,f=0,c=0,h=0;if(n>1){if(i){for(f=0;f<a;f++)if(C[f])for(h=f,c=0;c<n;c++,h+=a)e.pixels.resultPixels[h]=r[s++]}else for(f=0;f<a;f++)if(C[f])for(h=f*n,c=0;c<n;c++)e.pixels.resultPixels[h+c]=r[s++]}else for(f=0;f<a;f++)C[f]&&(e.pixels.resultPixels[f]=r[s++])}return I+=B,e.ptr=I,!0},readHuffmanTree:function(A,e){var t=this.HUFFMAN_LUT_BITS_MAX,i=new DataView(A,e.ptr,16);if(e.ptr+=16,i.getInt32(0,!0)<2)throw"unsupported Huffman version";var r=i.getInt32(4,!0),I=i.getInt32(8,!0),g=i.getInt32(12,!0);if(I>=g)return!1;var n=new Uint32Array(g-I);Q.decodeBits(A,e,n);var a,o,B,C,s=[];for(a=I;a<g;a++)s[o=a-(a<r?0:r)]={first:n[a-I],second:null};var f=A.byteLength-e.ptr,c=Math.ceil(f/4),h=new ArrayBuffer(4*c);new Uint8Array(h).set(new Uint8Array(A,e.ptr,f));var l,u=new Uint32Array(h),w=0,d=0;for(l=u[0],a=I;a<g;a++)(C=s[o=a-(a<r?0:r)].first)>0&&(s[o].second=l<<w>>>32-C,32-w>=C?32===(w+=C)&&(w=0,l=u[++d]):(w+=C-32,l=u[++d],s[o].second|=l>>>32-w));var D=0,y=0,k=new E;for(a=0;a<s.length;a++)void 0!==s[a]&&(D=Math.max(D,s[a].first));y=D>=t?t:D;var p,m,G,F,S,v=[];for(a=I;a<g;a++)if((C=s[o=a-(a<r?0:r)].first)>0)if(p=[C,o],C<=y)for(m=s[o].second<<y-C,G=1<<y-C,B=0;B<G;B++)v[m|B]=p;else for(m=s[o].second,S=k,F=C-1;F>=0;F--)m>>>F&1?(S.right||(S.right=new E),S=S.right):(S.left||(S.left=new E),S=S.left),0!==F||S.val||(S.val=p[1]);return{decodeLut:v,numBitsLUTQick:y,numBitsLUT:D,tree:k,stuffedData:u,srcPtr:d,bitPos:w}},readHuffman:function(A,e,t,i){var r,I,g,n,a,o,B,C,E,s=e.headerInfo.numDims,f=e.headerInfo.height,c=e.headerInfo.width,h=c*f,l=this.readHuffmanTree(A,e),u=l.decodeLut,w=l.tree,d=l.stuffedData,D=l.srcPtr,y=l.bitPos,k=l.numBitsLUTQick,p=l.numBitsLUT,m=0===e.headerInfo.imageType?128:0,G=e.pixels.resultMask,F=0;y>0&&(D++,y=0);var S,v=d[D],R=1===e.encodeMode,U=new t(h*s),L=U;if(s<2||R){for(S=0;S<s;S++)if(s>1&&(L=new t(U.buffer,h*S,h),F=0),e.headerInfo.numValidPixel===c*f)for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(g+=B>0?F:o>0?L[C-c]:F,g&=255,L[C]=g,F=g):L[C]=g}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++)if(G[C]){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(B>0&&G[C-1]?g+=F:o>0&&G[C-c]?g+=L[C-c]:g+=F,g&=255,L[C]=g,F=g):L[C]=g}}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++)if(C=o*c+B,!G||G[C])for(S=0;S<s;S++,C+=h){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,L[C]=g}e.ptr=e.ptr+4*(D+1)+(y>0?4:0),e.pixels.resultPixels=U,s>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(U,h,s,t))},decodeBits:function(A,e,t,i,r){var I=e.headerInfo,Q=I.fileVersion,E=0,s=A.byteLength-e.ptr>=5?5:A.byteLength-e.ptr,f=new DataView(A,e.ptr,s),c=f.getUint8(0);E++;var h=c>>6,l=0===h?4:3-h,u=(32&c)>0,w=31&c,d=0;if(1===l)d=f.getUint8(E),E++;else if(2===l)d=f.getUint16(E,!0),E+=2;else{if(4!==l)throw"Invalid valid pixel count type";d=f.getUint32(E,!0),E+=4}var D,y,k,p,m,G,F,S,v,R=2*I.maxZError,U=I.numDims>1?I.maxValues[r]:I.zMax;if(u){for(e.counter.lut++,S=f.getUint8(E),E++,p=Math.ceil((S-1)*w/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),k=new Uint8Array(y),e.ptr+=E,k.set(new Uint8Array(A,e.ptr,p)),F=new Uint32Array(y),e.ptr+=p,v=0;S-1>>>v;)v++;p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,G=Q>=3?o(F,w,S-1,i,R,U):n(F,w,S-1,i,R,U),Q>=3?a(D,t,v,d,G):g(D,t,v,d,G)}else e.counter.bitstuffer++,v=w,e.ptr+=E,v>0&&(p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,Q>=3?null==i?C(D,t,v,d):a(D,t,v,d,!1,i,R,U):null==i?B(D,t,v,d):g(D,t,v,d,!1,i,R,U))},readTiles:function(A,e,t,i){var r=e.headerInfo,I=r.width,g=r.height,n=I*g,a=r.microBlockSize,o=r.imageType,B=Q.getDataTypeSize(o),C=Math.ceil(I/a),E=Math.ceil(g/a);e.pixels.numBlocksY=E,e.pixels.numBlocksX=C,e.pixels.ptr=0;var s,f,c,h,l,u,w,d,D,y,k=0,p=0,m=0,G=0,F=0,S=0,v=0,R=0,U=0,L=0,b=0,M=0,N=0,x=0,J=0,q=new t(a*a),Y=g%a||a,K=I%a||a,H=r.numDims,O=e.pixels.resultMask,P=e.pixels.resultPixels,T=r.fileVersion>=5?14:15,V=r.zMax;for(m=0;m<E;m++)for(F=m!==E-1?a:Y,G=0;G<C;G++)for(L=m*I*a+G*a,b=I-(S=G!==C-1?a:K),d=0;d<H;d++){if(H>1?(y=P,L=m*I*a+G*a,P=new t(e.pixels.resultPixels.buffer,n*d*B,n),V=r.maxValues[d]):y=null,v=A.byteLength-e.ptr,f={},J=0,R=(s=new DataView(A,e.ptr,Math.min(10,v))).getUint8(0),J++,D=r.fileVersion>=5?4&R:0,U=R>>6&255,(R>>2&T)!=(G*a>>3&T))throw"integrity issue";if(D&&0===d)throw"integrity issue";if((l=3&R)>3)throw e.ptr+=J,"Invalid block encoding ("+l+")";if(2!==l)if(0===l){if(D)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=J,M=(M=F*S*B)<(N=A.byteLength-e.ptr)?M:N,c=new ArrayBuffer(M%B==0?M:M+B-M%B),new Uint8Array(c).set(new Uint8Array(A,e.ptr,M)),h=new t(c),x=0,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=h[x++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=h[x++];L+=b}e.ptr+=x*B}else if(u=Q.getDataTypeUsed(D&&o<6?4:o,U),w=Q.getOnePixel(f,J,u,s),J+=Q.getDataTypeSize(u),3===l)if(e.ptr+=J,e.counter.constantoffset++,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=D?Math.min(V,y[L]+w):w),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=D?Math.min(V,y[L]+w):w,L++;L+=b}else if(e.ptr+=J,Q.decodeBits(A,e,q,w,d),J=0,D)if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]+y[L]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=q[J++]+y[L],L++;L+=b}else if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=q[J++];L+=b}else{if(D)if(O)for(k=0;k<F;k++)for(p=0;p<S;p++)O[L]&&(P[L]=y[L]),L++;else for(k=0;k<F;k++)for(p=0;p<S;p++)P[L]=y[L],L++;e.counter.constant++,e.ptr+=J}}H>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(e.pixels.resultPixels,n,H,t))},formatFileInfo:function(A){return{fileIdentifierString:A.headerInfo.fileIdentifierString,fileVersion:A.headerInfo.fileVersion,imageType:A.headerInfo.imageType,height:A.headerInfo.height,width:A.headerInfo.width,numValidPixel:A.headerInfo.numValidPixel,microBlockSize:A.headerInfo.microBlockSize,blobSize:A.headerInfo.blobSize,maxZError:A.headerInfo.maxZError,pixelType:Q.getPixelType(A.headerInfo.imageType),eofOffset:A.eofOffset,mask:A.mask?{numBytes:A.mask.numBytes}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,maxValue:A.headerInfo.zMax,minValue:A.headerInfo.zMin,noDataValue:A.noDataValue}}},constructConstantSurface:function(A,e){var t=A.headerInfo.zMax,i=A.headerInfo.zMin,r=A.headerInfo.maxValues,I=A.headerInfo.numDims,g=A.headerInfo.height*A.headerInfo.width,n=0,a=0,o=0,B=A.pixels.resultMask,C=A.pixels.resultPixels;if(B)if(I>1){if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)B[a]&&(C[o+a]=t);else for(a=0;a<g;a++)if(B[a])for(o=a*I,n=0;n<I;n++)C[o+I]=r[n]}else for(a=0;a<g;a++)B[a]&&(C[a]=t);else if(I>1&&i!==t)if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)C[o+a]=t;else for(a=0;a<g;a++)for(o=a*I,n=0;n<I;n++)C[o+n]=r[n];else for(a=0;a<g*I;a++)C[a]=t},getDataTypeArray:function(A){var e;switch(A){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(A){var e;switch(A){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(A,e){if(null==e)return!1;var t;switch(A){case 0:t=e>=-128&&e<=127;break;case 1:t=e>=0&&e<=255;break;case 2:t=e>=-32768&&e<=32767;break;case 3:t=e>=0&&e<=65536;break;case 4:t=e>=-2147483648&&e<=2147483647;break;case 5:t=e>=0&&e<=4294967296;break;case 6:t=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:t=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:t=!1}return t},getDataTypeSize:function(A){var e=0;switch(A){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=A}return e},getDataTypeUsed:function(A,e){var t=A;switch(A){case 2:case 4:t=A-e;break;case 3:case 5:t=A-2*e;break;case 6:t=0===e?A:1===e?2:1;break;case 7:t=0===e?A:A-2*e+1;break;default:t=A}return t},getOnePixel:function(A,e,t,i){var r=0;switch(t){case 0:r=i.getInt8(e);break;case 1:r=i.getUint8(e);break;case 2:r=i.getInt16(e,!0);break;case 3:r=i.getUint16(e,!0);break;case 4:r=i.getInt32(e,!0);break;case 5:r=i.getUInt32(e,!0);break;case 6:r=i.getFloat32(e,!0);break;case 7:r=i.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return r},swapDimensionOrder:function(A,e,t,i,r){var I=0,g=0,n=0,a=0,o=A;if(t>1)if(o=new i(e*t),r)for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[a]=A[g++];else for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[g++]=A[a];return o}},E=function(A,e,t){this.val=A,this.left=e,this.right=t},{decode:function(A,e){var t=(e=e||{}).noDataValue,i=0,r={};r.ptr=e.inputOffset||0,r.pixels={},Q.readHeaderInfo(A,r);var I=r.headerInfo,g=I.fileVersion,n=Q.getDataTypeArray(I.imageType);if(g>5)throw"unsupported lerc version 2."+g;Q.readMask(A,r),I.numValidPixel===I.width*I.height||r.pixels.resultMask||(r.pixels.resultMask=e.maskData);var a=I.width*I.height;r.pixels.resultPixels=new n(a*I.numDims),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var o,B=!e.returnPixelInterleavedDims;if(0!==I.numValidPixel)if(I.zMax===I.zMin)Q.constructConstantSurface(r,B);else if(g>=4&&Q.checkMinMaxRanges(A,r))Q.constructConstantSurface(r,B);else{var C=new DataView(A,r.ptr,2),E=C.getUint8(0);if(r.ptr++,E)Q.readDataOneSweep(A,r,n,B);else if(g>1&&I.imageType<=1&&Math.abs(I.maxZError-.5)<1e-5){var s=C.getUint8(1);if(r.ptr++,r.encodeMode=s,s>2||g<4&&s>1)throw"Invalid Huffman flag "+s;s?Q.readHuffman(A,r,n,B):Q.readTiles(A,r,n,B)}else Q.readTiles(A,r,n,B)}r.eofOffset=r.ptr,e.inputOffset?(o=r.headerInfo.blobSize+e.inputOffset-r.ptr,Math.abs(o)>=1&&(r.eofOffset=e.inputOffset+r.headerInfo.blobSize)):(o=r.headerInfo.blobSize-r.ptr,Math.abs(o)>=1&&(r.eofOffset=r.headerInfo.blobSize));var f={width:I.width,height:I.height,pixelData:r.pixels.resultPixels,minValue:I.zMin,maxValue:I.zMax,validPixelCount:I.numValidPixel,dimCount:I.numDims,dimStats:{minValues:I.minValues,maxValues:I.maxValues},maskData:r.pixels.resultMask};if(r.pixels.resultMask&&Q.isValidPixelValue(I.imageType,t)){var c=r.pixels.resultMask;for(i=0;i<a;i++)c[i]||(f.pixelData[i]=t);f.noDataValue=t}return r.noDataValue=t,e.returnFileInfo&&(f.fileInfo=Q.formatFileInfo(r)),f},getBandCount:function(A){for(var e=0,t=0,i={ptr:0,pixels:{}};t<A.byteLength-58;)Q.readHeaderInfo(A,i),t+=i.headerInfo.blobSize,e++,i.ptr=t;return e}}),l=(s=new ArrayBuffer(4),f=new Uint8Array(s),new Uint32Array(s)[0]=1,1===f[0]),u={decode:function(A,e){if(!l)throw"Big endian system is not supported.";var t,i,r=(e=e||{}).inputOffset||0,I=new Uint8Array(A,r,10),g=String.fromCharCode.apply(null,I);if("CntZImage"===g.trim())t=c,i=1;else{if("Lerc2"!==g.substring(0,5))throw"Unexpected file identifier string: "+g;t=h,i=2}for(var n,a,o,B,C,Q,E=0,s=A.byteLength-10,f=[],u={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]},w=0;r<s;){var d=t.decode(A,{inputOffset:r,encodedMaskData:n,maskData:o,returnMask:0===E,returnEncodedMask:0===E,returnFileInfo:!0,returnPixelInterleavedDims:e.returnPixelInterleavedDims,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});r=d.fileInfo.eofOffset,o=d.maskData,0===E&&(n=d.encodedMaskData,u.width=d.width,u.height=d.height,u.dimCount=d.dimCount||1,u.pixelType=d.pixelType||d.fileInfo.pixelType,u.mask=o),i>1&&(o&&f.push(o),d.fileInfo.mask&&d.fileInfo.mask.numBytes>0&&w++),E++,u.pixels.push(d.pixelData),u.statistics.push({minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue,dimStats:d.dimStats})}if(i>1&&w>1){for(Q=u.width*u.height,u.bandMasks=f,(o=new Uint8Array(Q)).set(f[0]),B=1;B<f.length;B++)for(a=f[B],C=0;C<Q;C++)o[C]=o[C]&a[C];u.maskData=o}return u}};TA.exports?TA.exports=u:this.Lerc=u}();var ZA,jA,WA,zA=XA.exports,$A={env:{emscripten_notify_memory_growth:function(A){WA=new Uint8Array(jA.exports.memory.buffer)}}},Ae=function(){function A(){B(this,A)}return Q(A,[{key:"init",value:function(){return ZA||(ZA="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+ee).then((function(A){return A.arrayBuffer()})).then((function(A){return WebAssembly.instantiate(A,$A)})).then(this._init):WebAssembly.instantiate(Buffer.from(ee,"base64"),$A).then(this._init))}},{key:"_init",value:function(A){jA=A.instance,$A.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(A){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!jA)throw new Error("ZSTDDecoder: Await .init() before decoding.");var t=A.byteLength,i=jA.exports.malloc(t);WA.set(A,i),e=e||Number(jA.exports.ZSTD_findDecompressedSize(i,t));var r=jA.exports.malloc(e),I=jA.exports.ZSTD_decompress(r,e,i,t),g=WA.slice(r,r+I);return jA.exports.free(i),jA.exports.free(r),g}}]),A}(),ee="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",te={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ie={};for(var re in te)te.hasOwnProperty(re)&&(ie[te[re]]=parseInt(re,10));ie.BitsPerSample,ie.ExtraSamples,ie.SampleFormat,ie.StripByteCounts,ie.StripOffsets,ie.StripRowCounts,ie.TileByteCounts,ie.TileOffsets,ie.SubIFDs;var Ie={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ge={};for(var ne in Ie)Ie.hasOwnProperty(ne)&&(ge[Ie[ne]]=parseInt(ne,10));var ae=1,oe=0,Be=1,Ce=2,Qe={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Ee={};for(var se in Qe)Qe.hasOwnProperty(se)&&(Ee[Qe[se]]=parseInt(se,10));function fe(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var ce=new Ae,he=function(A){s(t,w);var e=fe(t);function t(A){var i;return B(this,t),(i=e.call(this)).planarConfiguration=void 0!==A.PlanarConfiguration?A.PlanarConfiguration:1,i.samplesPerPixel=void 0!==A.SamplesPerPixel?A.SamplesPerPixel:1,i.addCompression=A.LercParameters[ae],i}return Q(t,[{key:"decodeBlock",value:function(A){switch(this.addCompression){case oe:break;case Be:A=YA(new Uint8Array(A)).buffer;break;case Ce:A=ce.decode(new Uint8Array(A)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return zA.decode(A,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),t}(),le=Object.freeze({__proto__:null,zstd:ce,default:he});function ue(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var we=function(A){s(I,w);var t,i=ue(I);function I(){var A;if(B(this,I),A=i.call(this),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available");return A}return Q(I,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return i=new Blob([t]),A.next=3,createImageBitmap(i);case 3:return I=A.sent,"undefined"!=typeof document?((g=document.createElement("canvas")).width=I.width,g.height=I.height):g=new OffscreenCanvas(I.width,I.height),(n=g.getContext("2d")).drawImage(I,0,0),A.abrupt("return",n.getImageData(0,0,I.width,I.height).data.buffer);case 8:case"end":return A.stop()}}),A)}))),function(A,e){return t.apply(this,arguments)})}]),I}(),de=Object.freeze({__proto__:null,default:we});';return new ie(typeof Buffer<"u"?"data:application/javascript;base64,"+Buffer.from(m,"binary").toString("base64"):URL.createObjectURL(new Blob([m],{type:"application/javascript"})))}});y.cogProtocol=async m=>{if(m.type=="json"){const p=m.url.replace("cog://","").split("#")[0];return{data:await Rs(p).getTilejson(m.url)}}if(m.type=="image")return{data:await Eo(m.url)};throw new Error(`Unsupported request type '${m.type}'`)},y.colorScale=bl,y.colorSchemeNames=Bi,y.locationValues=async(m,{latitude:p,longitude:A},w)=>{const B=Rs(m),{minzoom:k,maxzoom:P}=await B.getTilejson(m),{noData:S,scale:V,offset:U}=await B.getMetadata(),q=w===void 0?P:Math.max(k,Math.min(P,Math.round(w))),{tileIndex:ne,column:Z,row:N}=(({latitude:se,longitude:ue,zoom:ae})=>{const[de,xe]=Ls.forward([ue,se]),be=(de+is/2)/is*wn*2**ae,Se=-(xe-is/2)/is*wn*2**ae;return{tileIndex:{z:ae,x:Math.floor(be/wn),y:Math.floor(Se/wn)},row:Math.floor(Se%wn),column:Math.floor(be%wn)}})({latitude:p,longitude:A,zoom:q});return(await B.getRawTile(ne)).map(se=>{const ue=U+se[256*N+Z]*V;return ue===S||isNaN(ue)||ue===1/0?NaN:ue})}})})(du,du.exports);var Iu=du.exports;const Wo=Ga(0),Ip=$d(Wo,L=>L>0),bp={overlayOpacity:.4,activeLayer:"exposure",lightningPeriod:"year",lightningSource:"wglc",windPeriod:"year",windMetric:"moderate"},Lr=Ga(bp);function vp(L){Lr.update(g=>({...g,overlayOpacity:L}))}function wp(L){Lr.update(g=>({...g,activeLayer:L}))}function xp(L){Lr.update(g=>({...g,lightningPeriod:L}))}function Bp(L){Lr.update(g=>({...g,lightningSource:L}))}function Cp(L){Lr.update(g=>({...g,windPeriod:L}))}function od(L){Lr.update(g=>({...g,windMetric:L}))}const Ep=gp,Qp=7,kp=[{color:[255,0,0]},{color:[255,80,0]},{color:[255,140,0]},{color:[255,140,0]},{color:[255,140,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]}];function Sp(L,g){const y=L>=0?"N":"S",x=g>=0?"E":"W",D=Math.floor(Math.abs(L)/10)*10,H=Math.floor(Math.abs(g)/10)*10;return`${y}${D.toString().padStart(2,"0")}_${x}${H.toString().padStart(3,"0")}`}function Dp(L,g){const y=L>=0?"N":"S",x=g>=0?"E":"W";return`${y}${Math.abs(L).toString().padStart(2,"0")}_${x}${Math.abs(g).toString().padStart(3,"0")}`}function Mp(L){const g=[],y=Math.floor(L.south),x=Math.floor(L.north),D=Math.floor(L.west),H=Math.floor(L.east);for(let E=y;E<=x;E++)for(let c=D;c<=H;c++){const X=Sp(E,c),he=Dp(E,c);g.push({region:X,tile:he,key:`${X}/${he}`})}return g}function Tp(){return`[${kp.map(g=>{const y=g.color[0].toString(16).padStart(2,"0"),x=g.color[1].toString(16).padStart(2,"0"),D=g.color[2].toString(16).padStart(2,"0");return`"#${y}${x}${D}"`}).join(",")}]`}function Pp(L){const g=Tp();return`cog://${L}#color:${g},1,255`}class Lp{constructor(g){ln(this,"map");ln(this,"loadedTiles",new Set);ln(this,"loadingTiles",new Set);ln(this,"protocolRegistered",!1);this.map=g}async init(){if(!this.protocolRegistered)try{mc.addProtocol("cog",Iu.cogProtocol),this.protocolRegistered=!0,console.log("COG protocol registered")}catch(g){console.log("COG protocol already registered or failed:",g)}return!0}boundsToMapBounds(g){return{west:g.getWest(),south:g.getSouth(),east:g.getEast(),north:g.getNorth()}}async loadTile(g){if(this.loadedTiles.has(g.key)||this.loadingTiles.has(g.key))return;this.loadingTiles.add(g.key),Wo.update(H=>H+1);const y=`${Ep}/${g.region}/${g.tile}.cog.tif`,x=`cog-${g.key.replace("/","-")}`,D=`cog-layer-${g.key.replace("/","-")}`;try{const H=await fetch(y,{method:"HEAD"});if(H.status===404){this.loadedTiles.add(g.key);return}if(!H.ok)throw new Error(`HTTP ${H.status}`);if(!this.map.getSource(x)){const E=Pp(y);this.map.addSource(x,{type:"raster",url:E,tileSize:256});const c=Wn(Lr);this.map.addLayer({id:D,type:"raster",source:x,paint:{"raster-opacity":c.overlayOpacity,"raster-resampling":"nearest"}}),console.log(`Loaded COG: ${g.key}`)}this.loadedTiles.add(g.key)}catch(H){console.error(`Failed to load COG ${g.key}:`,H)}finally{this.loadingTiles.delete(g.key),Wo.update(H=>Math.max(0,H-1))}}loadVisibleRegions(){if(this.map.getZoom()<Qp){this.hideAllLayers();return}this.showAllLayers();const y=this.boundsToMapBounds(this.map.getBounds()),x=Mp(y);for(const D of x)this.loadTile(D)}hideAllLayers(){for(const g of this.loadedTiles){const y=`cog-layer-${g.replace("/","-")}`;this.map.getLayer(y)&&this.map.setLayoutProperty(y,"visibility","none")}}showAllLayers(){for(const g of this.loadedTiles){const y=`cog-layer-${g.replace("/","-")}`;this.map.getLayer(y)&&this.map.setLayoutProperty(y,"visibility","visible")}}onViewportChange(){this.loadVisibleRegions()}updateOpacity(g){for(const y of this.loadedTiles){const x=`cog-layer-${y.replace("/","-")}`;this.map.getLayer(x)&&this.map.setPaintProperty(x,"raster-opacity",g)}}isEnabled(){return!0}destroy(){for(const g of this.loadedTiles){const y=`cog-layer-${g.replace("/","-")}`,x=`cog-${g.replace("/","-")}`;this.map.getLayer(y)&&this.map.removeLayer(y),this.map.getSource(x)&&this.map.removeSource(x)}this.loadedTiles.clear(),this.loadingTiles.clear()}}const Rp=[{id:1,min:0,max:0,level:"Exposed",color:"#FF0000"},{id:2,min:0,max:25,level:"Very Low",color:"#FF7800"},{id:3,min:25,max:50,level:"Low",color:"#FFA000"},{id:4,min:50,max:100,level:"Moderate",color:"#FFD200"},{id:5,min:100,max:150,level:"Good",color:"#FFFF00"},{id:6,min:150,max:200,level:"Very Good",color:"#C8FF00"},{id:7,min:200,max:1/0,level:"Protected",color:"#64DC00"}],tf=["#004000","#005300","#006600","#007700","#008800","#009900","#00AA00","#00BB00","#00CC00","#00DD00","#00EE00","#22F600","#44FF00","#66FF00","#88FF00","#AAFF00","#CCFF00","#E5FF00","#FFFF00","#FFF000","#FFE000","#FFD000","#FFC000","#FFB000","#FFA000","#FF9000","#FF8000","#FF7000","#FF6000","#FF5000","#FF4000","#FF2000","#FF0000","#EE002A","#DD0055","#CC0080","#BB00AA","#A200D5","#8800FF","#7700FF"],Fp={light:"Light",moderate:"Moderate",strong:"Strong",storm:"Storm",storm_detail:"Storm (Detail)",dir_n:"From N",dir_ne:"From NE",dir_e:"From E",dir_se:"From SE",dir_s:"From S",dir_sw:"From SW",dir_w:"From W",dir_nw:"From NW"},zp={storm:10,storm_detail:2,strong:30,moderate:60,light:60,dir_n:60,dir_ne:60,dir_e:60,dir_se:60,dir_s:60,dir_sw:60,dir_w:60,dir_nw:60},Gp={1:"jan",2:"feb",3:"mar",4:"apr",5:"may",6:"jun",7:"jul",8:"aug",9:"sep",10:"oct",11:"nov",12:"dec",year:"year"},rf=["#ffffcc","#fff9b0","#fff394","#ffed78","#ffe55c","#ffdd40","#ffd024","#ffc208","#ffb400","#ffa600","#ff9800","#ff8a00","#ff7b00","#ff6c00","#ff5d00","#ff4e00","#ff3a00","#ff2200","#f00000","#e00000","#cc0000","#b80000","#a00010","#8c0028","#780048","#660070","#550090","#4400a8","#3300c0"],fu={satellite:"Satellite",wglc:"WGLC"},gu={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec",year:"Year"},Up={1:"jan.cog.tif",2:"feb.cog.tif",3:"mar.cog.tif",4:"apr.cog.tif",5:"may.cog.tif",6:"jun.cog.tif",7:"jul.cog.tif",8:"aug.cog.tif",9:"sep.cog.tif",10:"oct.cog.tif",11:"nov.cog.tif",12:"dec.cog.tif",year:"year.cog.tif"},Np={satellite:pp,wglc:mp},Gl="lightning-source",aa="lightning-layer";function Op(){return`[${tf.map(g=>`"${g}"`).join(",")}]`}function qp(L){const g=Op();return`cog://${L}#color:${g},1,200`}class Vp{constructor(g){ln(this,"map");ln(this,"loaded",!1);ln(this,"visible",!1);ln(this,"protocolRegistered",!1);ln(this,"currentPeriod","year");ln(this,"currentSource","satellite");this.map=g}async init(){if(!this.protocolRegistered)try{mc.addProtocol("cog",Iu.cogProtocol),this.protocolRegistered=!0}catch{}return!0}async show(){const g=Wn(Lr);if(this.loaded&&(this.currentPeriod!==g.lightningPeriod||this.currentSource!==g.lightningSource)){await this.setSourceAndPeriod(g.lightningSource,g.lightningPeriod);return}if(!this.loaded){await this.loadLayer(g.lightningSource,g.lightningPeriod);return}this.visible||this.map.getLayer(aa)&&(this.map.setLayoutProperty(aa,"visibility","visible"),this.visible=!0)}hide(){this.visible&&(this.map.getLayer(aa)&&this.map.setLayoutProperty(aa,"visibility","none"),this.visible=!1)}async setSourceAndPeriod(g,y){g===this.currentSource&&y===this.currentPeriod&&this.loaded||(this.removeLayer(),await this.loadLayer(g,y))}async setPeriod(g){await this.setSourceAndPeriod(this.currentSource,g)}removeLayer(){this.map.getLayer(aa)&&this.map.removeLayer(aa),this.map.getSource(Gl)&&this.map.removeSource(Gl),this.loaded=!1,this.visible=!1}async loadLayer(g,y){if(this.loaded)return;const x=Np[g];if(!x){console.warn(`Lightning source '${g}' disabled: no COG base URL set`);return}Wo.update(E=>E+1);const D=Up[y],H=`${x}/${D}`;try{if(!(await fetch(H,{method:"HEAD"})).ok){console.warn(`Lightning COG not found: ${D} (source: ${g})`);return}if(!this.map.getSource(Gl)){const c=qp(H);this.map.addSource(Gl,{type:"raster",url:c,tileSize:256});const X=Wn(Lr);this.map.addLayer({id:aa,type:"raster",source:Gl,paint:{"raster-opacity":X.overlayOpacity,"raster-resampling":"linear"}}),this.loaded=!0,this.visible=!0,this.currentPeriod=y,this.currentSource=g;const he=()=>{this.map.setLayoutProperty(aa,"visibility","none"),requestAnimationFrame(()=>{this.map.setLayoutProperty(aa,"visibility","visible")})};if(this.map.isSourceLoaded(Gl))he();else{const Ie=fe=>{fe.sourceId===Gl&&fe.isSourceLoaded&&(this.map.off("sourcedata",Ie),he())};this.map.on("sourcedata",Ie)}}}catch(E){console.error("Failed to load lightning COG:",E)}finally{Wo.update(E=>Math.max(0,E-1))}}updateOpacity(g){this.map.getLayer(aa)&&this.map.setPaintProperty(aa,"raster-opacity",g)}isEnabled(){return!0}isVisible(){return this.visible}getCurrentPeriod(){return this.currentPeriod}getCurrentSource(){return this.currentSource}destroy(){this.removeLayer()}}const Hp=yp,Ul="wind-source",oa="wind-layer";function jp(){return`[${rf.map(g=>`"${g}"`).join(",")}]`}function Jp(L){const g=jp();return`cog://${L}#color:${g},1,255`}function Yp(L){switch(L){case"light":return"light_wind";case"moderate":return"moderate_wind";case"strong":return"strong_wind";case"storm":return"storm";case"storm_detail":return"storm_detail";default:return L}}function Kp(L,g){const y=Gp[g];return`${Yp(L)}_${y}.cog.tif`}class Zp{constructor(g){ln(this,"map");ln(this,"loaded",!1);ln(this,"visible",!1);ln(this,"protocolRegistered",!1);ln(this,"currentPeriod","year");ln(this,"currentMetric","storm");this.map=g}async init(){if(!this.protocolRegistered)try{mc.addProtocol("cog",Iu.cogProtocol),this.protocolRegistered=!0}catch{}return!0}async show(){const g=Wn(Lr);if(this.loaded&&(this.currentPeriod!==g.windPeriod||this.currentMetric!==g.windMetric)){await this.setMetricAndPeriod(g.windMetric,g.windPeriod);return}if(!this.loaded){await this.loadLayer(g.windMetric,g.windPeriod);return}this.visible||this.map.getLayer(oa)&&(this.map.setLayoutProperty(oa,"visibility","visible"),this.visible=!0)}hide(){this.visible&&(this.map.getLayer(oa)&&this.map.setLayoutProperty(oa,"visibility","none"),this.visible=!1)}async setPeriod(g){await this.setMetricAndPeriod(this.currentMetric,g)}async setMetric(g){await this.setMetricAndPeriod(g,this.currentPeriod)}async setMetricAndPeriod(g,y){g===this.currentMetric&&y===this.currentPeriod&&this.loaded||(this.removeLayer(),await this.loadLayer(g,y))}removeLayer(){this.map.getLayer(oa)&&this.map.removeLayer(oa),this.map.getSource(Ul)&&this.map.removeSource(Ul),this.loaded=!1,this.visible=!1}async loadLayer(g,y){if(this.loaded)return;Wo.update(H=>H+1);const x=Kp(g,y),D=`${Hp}/${x}`;try{if(!(await fetch(D,{method:"HEAD"})).ok){console.warn(`Wind COG not found: ${x}`);return}if(!this.map.getSource(Ul)){const E=Jp(D);this.map.addSource(Ul,{type:"raster",url:E,tileSize:256});const c=Wn(Lr);this.map.addLayer({id:oa,type:"raster",source:Ul,paint:{"raster-opacity":c.overlayOpacity,"raster-resampling":"linear"}}),this.loaded=!0,this.visible=!0,this.currentMetric=g,this.currentPeriod=y;const X=()=>{this.map.setLayoutProperty(oa,"visibility","none"),requestAnimationFrame(()=>{this.map.setLayoutProperty(oa,"visibility","visible")})};if(this.map.isSourceLoaded(Ul))X();else{const he=Ie=>{Ie.sourceId===Ul&&Ie.isSourceLoaded&&(this.map.off("sourcedata",he),X())};this.map.on("sourcedata",he)}}}catch(H){console.error("Failed to load wind COG:",H)}finally{Wo.update(H=>Math.max(0,H-1))}}updateOpacity(g){this.map.getLayer(oa)&&this.map.setPaintProperty(oa,"raster-opacity",g)}isVisible(){return this.visible}getCurrentPeriod(){return this.currentPeriod}getCurrentMetric(){return this.currentMetric}destroy(){this.removeLayer()}}class _s extends Error{constructor(g){var y,x,D,H;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,_s.prototype),g!==null&&typeof g=="object"&&(this.url=typeof g.url=="string"?g.url:"",this.status=typeof g.status=="number"?g.status:0,this.isAbort=!!g.isAbort,this.originalError=g.originalError,g.response!==null&&typeof g.response=="object"?this.response=g.response:g.data!==null&&typeof g.data=="object"?this.response=g.data:this.response={}),this.originalError||g instanceof _s||(this.originalError=g),typeof DOMException<"u"&&g instanceof DOMException&&(g.name=="AbortError"||g.code==20)&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(y=this.response)==null?void 0:y.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(H=(D=(x=this.originalError)==null?void 0:x.cause)==null?void 0:D.message)!=null&&H.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}const dh=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function $p(L,g){const y={};if(typeof L!="string")return y;const x=Object.assign({},{}).decode||Wp;let D=0;for(;D<L.length;){const H=L.indexOf("=",D);if(H===-1)break;let E=L.indexOf(";",D);if(E===-1)E=L.length;else if(E<H){D=L.lastIndexOf(";",H-1)+1;continue}const c=L.slice(D,H).trim();if(y[c]===void 0){let X=L.slice(H+1,E).trim();X.charCodeAt(0)===34&&(X=X.slice(1,-1));try{y[c]=x(X)}catch{y[c]=X}}D=E+1}return y}function ld(L,g,y){const x=Object.assign({},y||{}),D=x.encode||Xp;if(!dh.test(L))throw new TypeError("argument name is invalid");const H=D(g);if(H&&!dh.test(H))throw new TypeError("argument val is invalid");let E=L+"="+H;if(x.maxAge!=null){const c=x.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");E+="; Max-Age="+Math.floor(c)}if(x.domain){if(!dh.test(x.domain))throw new TypeError("option domain is invalid");E+="; Domain="+x.domain}if(x.path){if(!dh.test(x.path))throw new TypeError("option path is invalid");E+="; Path="+x.path}if(x.expires){if(!function(X){return Object.prototype.toString.call(X)==="[object Date]"||X instanceof Date}(x.expires)||isNaN(x.expires.valueOf()))throw new TypeError("option expires is invalid");E+="; Expires="+x.expires.toUTCString()}if(x.httpOnly&&(E+="; HttpOnly"),x.secure&&(E+="; Secure"),x.priority)switch(typeof x.priority=="string"?x.priority.toLowerCase():x.priority){case"low":E+="; Priority=Low";break;case"medium":E+="; Priority=Medium";break;case"high":E+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(x.sameSite)switch(typeof x.sameSite=="string"?x.sameSite.toLowerCase():x.sameSite){case!0:E+="; SameSite=Strict";break;case"lax":E+="; SameSite=Lax";break;case"strict":E+="; SameSite=Strict";break;case"none":E+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return E}function Wp(L){return L.indexOf("%")!==-1?decodeURIComponent(L):L}function Xp(L){return encodeURIComponent(L)}const em=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let nf;function yc(L){if(L)try{const g=decodeURIComponent(nf(L.split(".")[1]).split("").map(function(y){return"%"+("00"+y.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(g)||{}}catch{}return{}}function sf(L,g=0){let y=yc(L);return!(Object.keys(y).length>0&&(!y.exp||y.exp-g>Date.now()/1e3))}nf=typeof atob!="function"||em?L=>{let g=String(L).replace(/=+$/,"");if(g.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var y,x,D=0,H=0,E="";x=g.charAt(H++);~x&&(y=D%4?64*y+x:x,D++%4)?E+=String.fromCharCode(255&y>>(-2*D&6)):0)x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(x);return E}:atob;const cd="pb_auth";class bu{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!sf(this.token)}get isSuperuser(){var y,x;let g=yc(this.token);return g.type=="auth"&&(((y=this.record)==null?void 0:y.collectionName)=="_superusers"||!((x=this.record)!=null&&x.collectionName)&&g.collectionId=="pbc_3142635823")}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),yc(this.token).type=="auth"&&!this.isSuperuser}save(g,y){this.baseToken=g||"",this.baseModel=y||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(g,y=cd){const x=$p(g||"")[y]||"";let D={};try{D=JSON.parse(x),(typeof D===null||typeof D!="object"||Array.isArray(D))&&(D={})}catch{}this.save(D.token||"",D.record||D.model||null)}exportToCookie(g,y=cd){var X,he;const x={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},D=yc(this.token);x.expires=D!=null&&D.exp?new Date(1e3*D.exp):new Date("1970-01-01"),g=Object.assign({},x,g);const H={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null};let E=ld(y,JSON.stringify(H),g);const c=typeof Blob<"u"?new Blob([E]).size:E.length;if(H.record&&c>4096){H.record={id:(X=H.record)==null?void 0:X.id,email:(he=H.record)==null?void 0:he.email};const Ie=["collectionId","collectionName","verified"];for(const fe in this.record)Ie.includes(fe)&&(H.record[fe]=this.record[fe]);E=ld(y,JSON.stringify(H),g)}return E}onChange(g,y=!1){return this._onChangeCallbacks.push(g),y&&g(this.token,this.record),()=>{for(let x=this._onChangeCallbacks.length-1;x>=0;x--)if(this._onChangeCallbacks[x]==g)return delete this._onChangeCallbacks[x],void this._onChangeCallbacks.splice(x,1)}}triggerChange(){for(const g of this._onChangeCallbacks)g&&g(this.token,this.record)}}class tm extends bu{constructor(g="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=g,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){const g=this._storageGet(this.storageKey)||{};return g.record||g.model||null}get model(){return this.record}save(g,y){this._storageSet(this.storageKey,{token:g,record:y}),super.save(g,y)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(g){if(typeof window<"u"&&(window!=null&&window.localStorage)){const y=window.localStorage.getItem(g)||"";try{return JSON.parse(y)}catch{return y}}return this.storageFallback[g]}_storageSet(g,y){if(typeof window<"u"&&(window!=null&&window.localStorage)){let x=y;typeof y!="string"&&(x=JSON.stringify(y)),window.localStorage.setItem(g,x)}else this.storageFallback[g]=y}_storageRemove(g){var y;typeof window<"u"&&(window!=null&&window.localStorage)&&((y=window.localStorage)==null||y.removeItem(g)),delete this.storageFallback[g]}_bindStorageEvent(){typeof window<"u"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",g=>{if(g.key!=this.storageKey)return;const y=this._storageGet(this.storageKey)||{};super.save(y.token||"",y.record||y.model||null)})}}class co{constructor(g){this.client=g}}class im extends co{async getAll(g){return g=Object.assign({method:"GET"},g),this.client.send("/api/settings",g)}async update(g,y){return y=Object.assign({method:"PATCH",body:g},y),this.client.send("/api/settings",y)}async testS3(g="storage",y){return y=Object.assign({method:"POST",body:{filesystem:g}},y),this.client.send("/api/settings/test/s3",y).then(()=>!0)}async testEmail(g,y,x,D){return D=Object.assign({method:"POST",body:{email:y,template:x,collection:g}},D),this.client.send("/api/settings/test/email",D).then(()=>!0)}async generateAppleClientSecret(g,y,x,D,H,E){return E=Object.assign({method:"POST",body:{clientId:g,teamId:y,keyId:x,privateKey:D,duration:H}},E),this.client.send("/api/settings/apple/generate-client-secret",E)}}const rm=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function vu(L){if(L){L.query=L.query||{};for(let g in L)rm.includes(g)||(L.query[g]=L[g],delete L[g])}}function af(L){const g=[];for(const y in L){const x=encodeURIComponent(y),D=Array.isArray(L[y])?L[y]:[L[y]];for(let H of D)H=nm(H),H!==null&&g.push(x+"="+H)}return g.join("&")}function nm(L){return L==null?null:L instanceof Date?encodeURIComponent(L.toISOString().replace("T"," ")):encodeURIComponent(typeof L=="object"?JSON.stringify(L):L)}class of extends co{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(g,y,x){var E;if(!g)throw new Error("topic must be set.");let D=g;if(x){vu(x=Object.assign({},x));const c="options="+encodeURIComponent(JSON.stringify({query:x.query,headers:x.headers}));D+=(D.includes("?")?"&":"?")+c}const H=function(c){const X=c;let he;try{he=JSON.parse(X==null?void 0:X.data)}catch{}y(he||{})};return this.subscriptions[D]||(this.subscriptions[D]=[]),this.subscriptions[D].push(H),this.isConnected?this.subscriptions[D].length===1?await this.submitSubscriptions():(E=this.eventSource)==null||E.addEventListener(D,H):await this.connect(),async()=>this.unsubscribeByTopicAndListener(g,H)}async unsubscribe(g){var x;let y=!1;if(g){const D=this.getSubscriptionsByTopic(g);for(let H in D)if(this.hasSubscriptionListeners(H)){for(let E of this.subscriptions[H])(x=this.eventSource)==null||x.removeEventListener(H,E);delete this.subscriptions[H],y||(y=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?y&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(g){var x;let y=!1;for(let D in this.subscriptions)if((D+"?").startsWith(g)){y=!0;for(let H of this.subscriptions[D])(x=this.eventSource)==null||x.removeEventListener(D,H);delete this.subscriptions[D]}y&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(g,y){var H;let x=!1;const D=this.getSubscriptionsByTopic(g);for(let E in D){if(!Array.isArray(this.subscriptions[E])||!this.subscriptions[E].length)continue;let c=!1;for(let X=this.subscriptions[E].length-1;X>=0;X--)this.subscriptions[E][X]===y&&(c=!0,delete this.subscriptions[E][X],this.subscriptions[E].splice(X,1),(H=this.eventSource)==null||H.removeEventListener(E,y));c&&(this.subscriptions[E].length||delete this.subscriptions[E],x||this.hasSubscriptionListeners(E)||(x=!0))}this.hasSubscriptionListeners()?x&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(g){var y,x;if(this.subscriptions=this.subscriptions||{},g)return!!((y=this.subscriptions[g])!=null&&y.length);for(let D in this.subscriptions)if((x=this.subscriptions[D])!=null&&x.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(g=>{if(!(g!=null&&g.isAbort))throw g})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(g){const y={};g=g.includes("?")?g:g+"?";for(let x in this.subscriptions)(x+"?").startsWith(g)&&(y[x]=this.subscriptions[x]);return y}getNonEmptySubscriptionKeys(){const g=[];for(let y in this.subscriptions)this.subscriptions[y].length&&g.push(y);return g}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let g in this.subscriptions)for(let y of this.subscriptions[g])this.eventSource.addEventListener(g,y)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let g in this.subscriptions)for(let y of this.subscriptions[g])this.eventSource.removeEventListener(g,y)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((g,y)=>{this.pendingConnects.push({resolve:g,reject:y}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=g=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",g=>{const y=g;this.clientId=y==null?void 0:y.lastEventId,this.submitSubscriptions().then(async()=>{let x=3;for(;this.hasUnsentSubscriptions()&&x>0;)x--,await this.submitSubscriptions()}).then(()=>{for(let D of this.pendingConnects)D.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const x=this.getSubscriptionsByTopic("PB_CONNECT");for(let D in x)for(let H of x[D])H(g)}).catch(x=>{this.clientId="",this.connectErrorHandler(x)})})}hasUnsentSubscriptions(){const g=this.getNonEmptySubscriptionKeys();if(g.length!=this.lastSentSubscriptions.length)return!0;for(const y of g)if(!this.lastSentSubscriptions.includes(y))return!0;return!1}connectErrorHandler(g){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let x of this.pendingConnects)x.reject(new _s(g));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const y=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},y)}disconnect(g=!1){var y;if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(y=this.eventSource)==null||y.close(),this.eventSource=null,this.clientId="",!g){this.reconnectAttempts=0;for(let x of this.pendingConnects)x.resolve();this.pendingConnects=[]}}}class lf extends co{decode(g){return g}async getFullList(g,y){if(typeof g=="number")return this._getFullList(g,y);let x=500;return(y=Object.assign({},g,y)).batch&&(x=y.batch,delete y.batch),this._getFullList(x,y)}async getList(g=1,y=30,x){return(x=Object.assign({method:"GET"},x)).query=Object.assign({page:g,perPage:y},x.query),this.client.send(this.baseCrudPath,x).then(D=>{var H;return D.items=((H=D.items)==null?void 0:H.map(E=>this.decode(E)))||[],D})}async getFirstListItem(g,y){return(y=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+g},y)).query=Object.assign({filter:g,skipTotal:1},y.query),this.getList(1,1,y).then(x=>{var D;if(!((D=x==null?void 0:x.items)!=null&&D.length))throw new _s({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return x.items[0]})}async getOne(g,y){if(!g)throw new _s({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return y=Object.assign({method:"GET"},y),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(g),y).then(x=>this.decode(x))}async create(g,y){return y=Object.assign({method:"POST",body:g},y),this.client.send(this.baseCrudPath,y).then(x=>this.decode(x))}async update(g,y,x){return x=Object.assign({method:"PATCH",body:y},x),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(g),x).then(D=>this.decode(D))}async delete(g,y){return y=Object.assign({method:"DELETE"},y),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(g),y).then(()=>!0)}_getFullList(g=500,y){(y=y||{}).query=Object.assign({skipTotal:1},y.query);let x=[],D=async H=>this.getList(H,g||500,y).then(E=>{const c=E.items;return x=x.concat(c),c.length==E.perPage?D(H+1):x});return D(1)}}function $o(L,g,y,x){const D=x!==void 0;return D||y!==void 0?D?(console.warn(L),g.body=Object.assign({},g.body,y),g.query=Object.assign({},g.query,x),g):Object.assign(g,y):g}function cu(L){var g;(g=L._resetAutoRefresh)==null||g.call(L)}class sm extends lf{constructor(g,y){super(g),this.collectionIdOrName=y}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName=="_superusers"||this.collectionIdOrName=="_pbc_2773867675"}async subscribe(g,y,x){if(!g)throw new Error("Missing topic.");if(!y)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+g,y,x)}async unsubscribe(g){return g?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+g):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(g,y){if(typeof g=="number")return super.getFullList(g,y);const x=Object.assign({},g,y);return super.getFullList(x)}async getList(g=1,y=30,x){return super.getList(g,y,x)}async getFirstListItem(g,y){return super.getFirstListItem(g,y)}async getOne(g,y){return super.getOne(g,y)}async create(g,y){return super.create(g,y)}async update(g,y,x){return super.update(g,y,x).then(D=>{var H,E,c;if(((H=this.client.authStore.record)==null?void 0:H.id)===(D==null?void 0:D.id)&&(((E=this.client.authStore.record)==null?void 0:E.collectionId)===this.collectionIdOrName||((c=this.client.authStore.record)==null?void 0:c.collectionName)===this.collectionIdOrName)){let X=Object.assign({},this.client.authStore.record.expand),he=Object.assign({},this.client.authStore.record,D);X&&(he.expand=Object.assign(X,D.expand)),this.client.authStore.save(this.client.authStore.token,he)}return D})}async delete(g,y){return super.delete(g,y).then(x=>{var D,H,E;return!x||((D=this.client.authStore.record)==null?void 0:D.id)!==g||((H=this.client.authStore.record)==null?void 0:H.collectionId)!==this.collectionIdOrName&&((E=this.client.authStore.record)==null?void 0:E.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),x})}authResponse(g){const y=this.decode((g==null?void 0:g.record)||{});return this.client.authStore.save(g==null?void 0:g.token,y),Object.assign({},g,{token:(g==null?void 0:g.token)||"",record:y})}async listAuthMethods(g){return g=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},g),this.client.send(this.baseCollectionPath+"/auth-methods",g)}async authWithPassword(g,y,x){let D;x=Object.assign({method:"POST",body:{identity:g,password:y}},x),this.isSuperusers&&(D=x.autoRefreshThreshold,delete x.autoRefreshThreshold,x.autoRefresh||cu(this.client));let H=await this.client.send(this.baseCollectionPath+"/auth-with-password",x);return H=this.authResponse(H),D&&this.isSuperusers&&function(c,X,he,Ie){cu(c);const fe=c.beforeSend,oe=c.authStore.record,Fe=c.authStore.onChange((Ue,Xe)=>{(!Ue||(Xe==null?void 0:Xe.id)!=(oe==null?void 0:oe.id)||(Xe!=null&&Xe.collectionId||oe!=null&&oe.collectionId)&&(Xe==null?void 0:Xe.collectionId)!=(oe==null?void 0:oe.collectionId))&&cu(c)});c._resetAutoRefresh=function(){Fe(),c.beforeSend=fe,delete c._resetAutoRefresh},c.beforeSend=async(Ue,Xe)=>{var He;const et=c.authStore.token;if((He=Xe.query)!=null&&He.autoRefresh)return fe?fe(Ue,Xe):{url:Ue,sendOptions:Xe};let st=c.authStore.isValid;if(st&&sf(c.authStore.token,X))try{await he()}catch{st=!1}st||await Ie();const Ne=Xe.headers||{};for(let $e in Ne)if($e.toLowerCase()=="authorization"&&et==Ne[$e]&&c.authStore.token){Ne[$e]=c.authStore.token;break}return Xe.headers=Ne,fe?fe(Ue,Xe):{url:Ue,sendOptions:Xe}}}(this.client,D,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(g,y,Object.assign({autoRefresh:!0},x))),H}async authWithOAuth2Code(g,y,x,D,H,E,c){let X={method:"POST",body:{provider:g,code:y,codeVerifier:x,redirectURL:D,createData:H}};return X=$o("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",X,E,c),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",X).then(he=>this.authResponse(he))}authWithOAuth2(...g){if(g.length>1||typeof(g==null?void 0:g[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((g==null?void 0:g[0])||"",(g==null?void 0:g[1])||"",(g==null?void 0:g[2])||"",(g==null?void 0:g[3])||"",(g==null?void 0:g[4])||{},(g==null?void 0:g[5])||{},(g==null?void 0:g[6])||{});const y=(g==null?void 0:g[0])||{};let x=null;y.urlCallback||(x=hd(void 0));const D=new of(this.client);function H(){x==null||x.close(),D.unsubscribe()}const E={},c=y.requestKey;return c&&(E.requestKey=c),this.listAuthMethods(E).then(X=>{var oe;const he=X.oauth2.providers.find(Fe=>Fe.name===y.provider);if(!he)throw new _s(new Error(`Missing or invalid provider "${y.provider}".`));const Ie=this.client.buildURL("/api/oauth2-redirect"),fe=c?(oe=this.client.cancelControllers)==null?void 0:oe[c]:void 0;return fe&&(fe.signal.onabort=()=>{H()}),new Promise(async(Fe,Ue)=>{var Xe;try{await D.subscribe("@oauth2",async He=>{var lt;const $e=D.clientId;try{if(!He.state||$e!==He.state)throw new Error("State parameters don't match.");if(He.error||!He.code)throw new Error("OAuth2 redirect error or missing code: "+He.error);const Qt=Object.assign({},y);delete Qt.provider,delete Qt.scopes,delete Qt.createData,delete Qt.urlCallback,(lt=fe==null?void 0:fe.signal)!=null&&lt.onabort&&(fe.signal.onabort=null);const ht=await this.authWithOAuth2Code(he.name,He.code,he.codeVerifier,Ie,y.createData,Qt);Fe(ht)}catch(Qt){Ue(new _s(Qt))}H()});const et={state:D.clientId};(Xe=y.scopes)!=null&&Xe.length&&(et.scope=y.scopes.join(" "));const st=this._replaceQueryParams(he.authURL+Ie,et);await(y.urlCallback||function(He){x?x.location.href=He:x=hd(He)})(st)}catch(et){H(),Ue(new _s(et))}})}).catch(X=>{throw H(),X})}async authRefresh(g,y){let x={method:"POST"};return x=$o("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",x,g,y),this.client.send(this.baseCollectionPath+"/auth-refresh",x).then(D=>this.authResponse(D))}async requestPasswordReset(g,y,x){let D={method:"POST",body:{email:g}};return D=$o("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",D,y,x),this.client.send(this.baseCollectionPath+"/request-password-reset",D).then(()=>!0)}async confirmPasswordReset(g,y,x,D,H){let E={method:"POST",body:{token:g,password:y,passwordConfirm:x}};return E=$o("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",E,D,H),this.client.send(this.baseCollectionPath+"/confirm-password-reset",E).then(()=>!0)}async requestVerification(g,y,x){let D={method:"POST",body:{email:g}};return D=$o("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",D,y,x),this.client.send(this.baseCollectionPath+"/request-verification",D).then(()=>!0)}async confirmVerification(g,y,x){let D={method:"POST",body:{token:g}};return D=$o("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",D,y,x),this.client.send(this.baseCollectionPath+"/confirm-verification",D).then(()=>{const H=yc(g),E=this.client.authStore.record;return E&&!E.verified&&E.id===H.id&&E.collectionId===H.collectionId&&(E.verified=!0,this.client.authStore.save(this.client.authStore.token,E)),!0})}async requestEmailChange(g,y,x){let D={method:"POST",body:{newEmail:g}};return D=$o("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",D,y,x),this.client.send(this.baseCollectionPath+"/request-email-change",D).then(()=>!0)}async confirmEmailChange(g,y,x,D){let H={method:"POST",body:{token:g,password:y}};return H=$o("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",H,x,D),this.client.send(this.baseCollectionPath+"/confirm-email-change",H).then(()=>{const E=yc(g),c=this.client.authStore.record;return c&&c.id===E.id&&c.collectionId===E.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(g,y){return this.client.collection("_externalAuths").getFullList(Object.assign({},y,{filter:this.client.filter("recordRef = {:id}",{id:g})}))}async unlinkExternalAuth(g,y,x){const D=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:g,provider:y}));return this.client.collection("_externalAuths").delete(D.id,x).then(()=>!0)}async requestOTP(g,y){return y=Object.assign({method:"POST",body:{email:g}},y),this.client.send(this.baseCollectionPath+"/request-otp",y)}async authWithOTP(g,y,x){return x=Object.assign({method:"POST",body:{otpId:g,password:y}},x),this.client.send(this.baseCollectionPath+"/auth-with-otp",x).then(D=>this.authResponse(D))}async impersonate(g,y,x){(x=Object.assign({method:"POST",body:{duration:y}},x)).headers=x.headers||{},x.headers.Authorization||(x.headers.Authorization=this.client.authStore.token);const D=new cf(this.client.baseURL,new bu,this.client.lang),H=await D.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(g),x);return D.authStore.save(H==null?void 0:H.token,this.decode((H==null?void 0:H.record)||{})),D}_replaceQueryParams(g,y={}){let x=g,D="";g.indexOf("?")>=0&&(x=g.substring(0,g.indexOf("?")),D=g.substring(g.indexOf("?")+1));const H={},E=D.split("&");for(const c of E){if(c=="")continue;const X=c.split("=");H[decodeURIComponent(X[0].replace(/\+/g," "))]=decodeURIComponent((X[1]||"").replace(/\+/g," "))}for(let c in y)y.hasOwnProperty(c)&&(y[c]==null?delete H[c]:H[c]=y[c]);D="";for(let c in H)H.hasOwnProperty(c)&&(D!=""&&(D+="&"),D+=encodeURIComponent(c.replace(/%20/g,"+"))+"="+encodeURIComponent(H[c].replace(/%20/g,"+")));return D!=""?x+"?"+D:x}}function hd(L){if(typeof window>"u"||!(window!=null&&window.open))throw new _s(new Error("Not in a browser context - please pass a custom urlCallback function."));let g=1024,y=768,x=window.innerWidth,D=window.innerHeight;g=g>x?x:g,y=y>D?D:y;let H=x/2-g/2,E=D/2-y/2;return window.open(L,"popup_window","width="+g+",height="+y+",top="+E+",left="+H+",resizable,menubar=no")}class am extends lf{get baseCrudPath(){return"/api/collections"}async import(g,y=!1,x){return x=Object.assign({method:"PUT",body:{collections:g,deleteMissing:y}},x),this.client.send(this.baseCrudPath+"/import",x).then(()=>!0)}async getScaffolds(g){return g=Object.assign({method:"GET"},g),this.client.send(this.baseCrudPath+"/meta/scaffolds",g)}async truncate(g,y){return y=Object.assign({method:"DELETE"},y),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(g)+"/truncate",y).then(()=>!0)}}class om extends co{async getList(g=1,y=30,x){return(x=Object.assign({method:"GET"},x)).query=Object.assign({page:g,perPage:y},x.query),this.client.send("/api/logs",x)}async getOne(g,y){if(!g)throw new _s({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return y=Object.assign({method:"GET"},y),this.client.send("/api/logs/"+encodeURIComponent(g),y)}async getStats(g){return g=Object.assign({method:"GET"},g),this.client.send("/api/logs/stats",g)}}class lm extends co{async check(g){return g=Object.assign({method:"GET"},g),this.client.send("/api/health",g)}}class cm extends co{getUrl(g,y,x={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(g,y,x)}getURL(g,y,x={}){if(!y||!(g!=null&&g.id)||!(g!=null&&g.collectionId)&&!(g!=null&&g.collectionName))return"";const D=[];D.push("api"),D.push("files"),D.push(encodeURIComponent(g.collectionId||g.collectionName)),D.push(encodeURIComponent(g.id)),D.push(encodeURIComponent(y));let H=this.client.buildURL(D.join("/"));if(Object.keys(x).length){x.download===!1&&delete x.download;const E=new URLSearchParams(x);H+=(H.includes("?")?"&":"?")+E}return H}async getToken(g){return g=Object.assign({method:"POST"},g),this.client.send("/api/files/token",g).then(y=>(y==null?void 0:y.token)||"")}}class hm extends co{async getFullList(g){return g=Object.assign({method:"GET"},g),this.client.send("/api/backups",g)}async create(g,y){return y=Object.assign({method:"POST",body:{name:g}},y),this.client.send("/api/backups",y).then(()=>!0)}async upload(g,y){return y=Object.assign({method:"POST",body:g},y),this.client.send("/api/backups/upload",y).then(()=>!0)}async delete(g,y){return y=Object.assign({method:"DELETE"},y),this.client.send(`/api/backups/${encodeURIComponent(g)}`,y).then(()=>!0)}async restore(g,y){return y=Object.assign({method:"POST"},y),this.client.send(`/api/backups/${encodeURIComponent(g)}/restore`,y).then(()=>!0)}getDownloadUrl(g,y){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(g,y)}getDownloadURL(g,y){return this.client.buildURL(`/api/backups/${encodeURIComponent(y)}?token=${encodeURIComponent(g)}`)}}class um extends co{async getFullList(g){return g=Object.assign({method:"GET"},g),this.client.send("/api/crons",g)}async run(g,y){return y=Object.assign({method:"POST"},y),this.client.send(`/api/crons/${encodeURIComponent(g)}`,y).then(()=>!0)}}function pu(L){return typeof Blob<"u"&&L instanceof Blob||typeof File<"u"&&L instanceof File||L!==null&&typeof L=="object"&&L.uri&&(typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal)}function mu(L){var g;return L&&(((g=L.constructor)==null?void 0:g.name)==="FormData"||typeof FormData<"u"&&L instanceof FormData)}function ud(L){for(const g in L){const y=Array.isArray(L[g])?L[g]:[L[g]];for(const x of y)if(pu(x))return!0}return!1}const Am=/^[\-\.\d]+$/;function Ad(L){if(typeof L!="string")return L;if(L=="true")return!0;if(L=="false")return!1;if((L[0]==="-"||L[0]>="0"&&L[0]<="9")&&Am.test(L)){let g=+L;if(""+g===L)return g}return L}class dm extends co{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(g){return this.subs[g]||(this.subs[g]=new fm(this.requests,g)),this.subs[g]}async send(g){const y=new FormData,x=[];for(let D=0;D<this.requests.length;D++){const H=this.requests[D];if(x.push({method:H.method,url:H.url,headers:H.headers,body:H.json}),H.files)for(let E in H.files){const c=H.files[E]||[];for(let X of c)y.append("requests."+D+"."+E,X)}}return y.append("@jsonPayload",JSON.stringify({requests:x})),g=Object.assign({method:"POST",body:y},g),this.client.send("/api/batch",g)}}class fm{constructor(g,y){this.requests=[],this.requests=g,this.collectionIdOrName=y}upsert(g,y){y=Object.assign({body:g||{}},y);const x={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(x,y),this.requests.push(x)}create(g,y){y=Object.assign({body:g||{}},y);const x={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(x,y),this.requests.push(x)}update(g,y,x){x=Object.assign({body:y||{}},x);const D={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(g)};this.prepareRequest(D,x),this.requests.push(D)}delete(g,y){y=Object.assign({},y);const x={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(g)};this.prepareRequest(x,y),this.requests.push(x)}prepareRequest(g,y){if(vu(y),g.headers=y.headers,g.json={},g.files={},y.query!==void 0){const D=af(y.query);D&&(g.url+=(g.url.includes("?")?"&":"?")+D)}let x=y.body;mu(x)&&(x=function(H){let E={};return H.forEach((c,X)=>{if(X==="@jsonPayload"&&typeof c=="string")try{let he=JSON.parse(c);Object.assign(E,he)}catch(he){console.warn("@jsonPayload error:",he)}else E[X]!==void 0?(Array.isArray(E[X])||(E[X]=[E[X]]),E[X].push(Ad(c))):E[X]=Ad(c)}),E}(x));for(const D in x){const H=x[D];if(pu(H))g.files[D]=g.files[D]||[],g.files[D].push(H);else if(Array.isArray(H)){const E=[],c=[];for(const X of H)pu(X)?E.push(X):c.push(X);if(E.length>0&&E.length==H.length){g.files[D]=g.files[D]||[];for(let X of E)g.files[D].push(X)}else if(g.json[D]=c,E.length>0){let X=D;D.startsWith("+")||D.endsWith("+")||(X+="+"),g.files[X]=g.files[X]||[];for(let he of E)g.files[X].push(he)}}else g.json[D]=H}}}class cf{get baseUrl(){return this.baseURL}set baseUrl(g){this.baseURL=g}constructor(g="/",y,x="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=g,this.lang=x,y?this.authStore=y:typeof window<"u"&&window.Deno?this.authStore=new bu:this.authStore=new tm,this.collections=new am(this),this.files=new cm(this),this.logs=new om(this),this.settings=new im(this),this.realtime=new of(this),this.health=new lm(this),this.backups=new hm(this),this.crons=new um(this)}get admins(){return this.collection("_superusers")}createBatch(){return new dm(this)}collection(g){return this.recordServices[g]||(this.recordServices[g]=new sm(this,g)),this.recordServices[g]}autoCancellation(g){return this.enableAutoCancellation=!!g,this}cancelRequest(g){return this.cancelControllers[g]&&(this.cancelControllers[g].abort(),delete this.cancelControllers[g]),this}cancelAllRequests(){for(let g in this.cancelControllers)this.cancelControllers[g].abort();return this.cancelControllers={},this}filter(g,y){if(!y)return g;for(let x in y){let D=y[x];switch(typeof D){case"boolean":case"number":D=""+D;break;case"string":D="'"+D.replace(/'/g,"\\'")+"'";break;default:D=D===null?"null":D instanceof Date?"'"+D.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(D).replace(/'/g,"\\'")+"'"}g=g.replaceAll("{:"+x+"}",D)}return g}getFileUrl(g,y,x={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(g,y,x)}buildUrl(g){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(g)}buildURL(g){var x;let y=this.baseURL;return typeof window>"u"||!window.location||y.startsWith("https://")||y.startsWith("http://")||(y=(x=window.location.origin)!=null&&x.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseURL.startsWith("/")||(y+=window.location.pathname||"/",y+=y.endsWith("/")?"":"/"),y+=this.baseURL),g&&(y+=y.endsWith("/")?"":"/",y+=g.startsWith("/")?g.substring(1):g),y}async send(g,y){y=this.initSendOptions(g,y);let x=this.buildURL(g);if(this.beforeSend){const D=Object.assign({},await this.beforeSend(x,y));D.url!==void 0||D.options!==void 0?(x=D.url||x,y=D.options||y):Object.keys(D).length&&(y=D,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(y.query!==void 0){const D=af(y.query);D&&(x+=(x.includes("?")?"&":"?")+D),delete y.query}return this.getHeader(y.headers,"Content-Type")=="application/json"&&y.body&&typeof y.body!="string"&&(y.body=JSON.stringify(y.body)),(y.fetch||fetch)(x,y).then(async D=>{var E;let H={};try{H=await D.json()}catch(c){if((E=y.signal)!=null&&E.aborted||typeof DOMException<"u"&&c instanceof DOMException&&(c.name=="AbortError"||c.code==20))throw c}if(this.afterSend&&(H=await this.afterSend(D,H,y)),D.status>=400)throw new _s({url:D.url,status:D.status,data:H});return H}).catch(D=>{throw new _s(D)})}initSendOptions(g,y){if((y=Object.assign({method:"GET"},y)).body=function(D){if(typeof FormData>"u"||D===void 0||typeof D!="object"||D===null||mu(D)||!ud(D))return D;const H=new FormData;for(const E in D){const c=D[E];if(c!==void 0)if(typeof c!="object"||ud({data:c})){const X=Array.isArray(c)?c:[c];for(let he of X)H.append(E,he)}else{let X={};X[E]=c,H.append("@jsonPayload",JSON.stringify(X))}}return H}(y.body),vu(y),y.query=Object.assign({},y.params,y.query),y.requestKey===void 0&&(y.$autoCancel===!1||y.query.$autoCancel===!1?y.requestKey=null:(y.$cancelKey||y.query.$cancelKey)&&(y.requestKey=y.$cancelKey||y.query.$cancelKey)),delete y.$autoCancel,delete y.query.$autoCancel,delete y.$cancelKey,delete y.query.$cancelKey,this.getHeader(y.headers,"Content-Type")!==null||mu(y.body)||(y.headers=Object.assign({},y.headers,{"Content-Type":"application/json"})),this.getHeader(y.headers,"Accept-Language")===null&&(y.headers=Object.assign({},y.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(y.headers,"Authorization")===null&&(y.headers=Object.assign({},y.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&y.requestKey!==null){const x=y.requestKey||(y.method||"GET")+g;delete y.requestKey,this.cancelRequest(x);const D=new AbortController;this.cancelControllers[x]=D,y.signal=D.signal}return y}getHeader(g,y){g=g||{},y=y.toLowerCase();for(let x in g)if(x.toLowerCase()==y)return g[x];return null}}const Jr=new cf(_p),Nl=Ga(Jr.authStore.record),gm=Ga(!0);async function pm(){if(Jr.authStore.onChange((L,g)=>{Nl.set(g)}),Jr.authStore.token)if(!Jr.authStore.isValid)Jr.authStore.clear();else try{await Jr.collection("users").authRefresh()}catch{Jr.authStore.clear()}Nl.set(Jr.authStore.record),gm.set(!1)}async function hf(L,g){return(await Jr.collection("users").authWithPassword(L,g)).record}async function mm(L,g,y){const x=await Jr.collection("users").create({email:L,password:g,passwordConfirm:y});return await hf(L,g),x}function ym(){Jr.authStore.clear()}async function _m(L){return(await Jr.collection("users").authWithOAuth2({provider:L})).record}const fh=[{id:"corfu",name:"Corfu, Greece",center:{lng:19.92,lat:39.62},radiusKm:100},{id:"tortola",name:"Tortola, BVI",center:{lng:-64.62,lat:18.43},radiusKm:100},{id:"whitsundays",name:"Whitsunday Islands, Australia",center:{lng:148.95,lat:-20.08},radiusKm:100}],dd={Europe:"corfu",Africa:"corfu",America:"tortola",Australia:"whitsundays",Pacific:"whitsundays"},fd={"Asia/Auckland":"whitsundays"},Im="corfu",qc=7,bm=6e4;function vm(){try{const L=Intl.DateTimeFormat().resolvedOptions().timeZone||"";if(fd[L]){const y=fh.find(x=>x.id===fd[L]);if(y)return y}const g=L.split("/")[0];if(g&&dd[g]){const y=fh.find(x=>x.id===dd[g]);if(y)return y}}catch{}return fh.find(L=>L.id===Im)||fh[0]}function uf(L,g,y,x){const H=(x-g)*Math.PI/180,E=(y-L)*Math.PI/180,c=Math.sin(H/2)*Math.sin(H/2)+Math.cos(g*Math.PI/180)*Math.cos(x*Math.PI/180)*Math.sin(E/2)*Math.sin(E/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}const Hc=Ga(vm()),Vc=Ga(!1),yh=Ga(10),gd=Ga(0),gc=Ga(!1),yu=Ga(!1);$d([yh,Vc],([L,g])=>L>=qc&&!g);function hu(L,g){const y=Wn(Hc);return uf(y.center.lng,y.center.lat,L,g)<=y.radiusKm}function wm(L,g){const y=Wn(Hc),x=uf(y.center.lng,y.center.lat,L,g);if(x===0)return{lng:y.center.lng,lat:y.center.lat};const D=y.radiusKm/x,H=y.center.lng+(L-y.center.lng)*D,E=y.center.lat+(g-y.center.lat)*D;return{lng:H,lat:E}}function uu(){const L=Date.now(),g=Wn(gd);L-g>=bm?(gc.set(!0),gd.set(L)):(yu.set(!0),setTimeout(()=>{yu.set(!1)},3e3))}function gh(L){const g=L==="active"||L==="lifetime";Vc.set(g)}function xm(L){let g;return{c(){g=Je("div"),this.h()},l(y){g=je(y,"DIV",{class:!0}),ct(g).forEach(Qe),this.h()},h(){ye(g,"class","map-container svelte-17bvpkx")},m(y,x){at(y,g,x),L[7](g)},p:Mi,i:Mi,o:Mi,d(y){y&&Qe(g),L[7](null)}}}function Bm(L,g,y){let x,D;Pr(L,Lr,et=>y(5,x=et)),Pr(L,Nl,et=>y(6,D=et));let{mapTilerKey:H}=g,E,c=null,X=null,he=null,Ie=null,fe=!1;async function oe(){if(!D){gh(null);return}try{const et=await Jr.collection("users").getOne(D.id);gh(et.plan_status)}catch{gh(null)}}function Fe(){if(!c||fe||Wn(Vc))return;const et=c.getZoom();if(yh.set(et),et<qc)return;const st=c.getCenter();if(!hu(st.lng,st.lat)){fe=!0;const Ne=wm(st.lng,st.lat);c.setCenter([Ne.lng,Ne.lat]),uu(),setTimeout(()=>{fe=!1},100)}}function Ue(){if(!c||fe||Wn(Vc))return;const et=c.getZoom(),st=Wn(yh);if(yh.set(et),st<qc&&et>=qc){const Ne=c.getCenter();if(!hu(Ne.lng,Ne.lat)){fe=!0;const He=Wn(Hc);c.flyTo({center:[He.center.lng,He.center.lat],zoom:et}),uu(),setTimeout(()=>{fe=!1},500)}}}Ih(async()=>{const et=Wn(Hc);c=new mc.Map({container:E,style:`https://api.maptiler.com/maps/outdoor-v2/style.json?key=${H}`,center:[et.center.lng,et.center.lat],zoom:10}),c.addControl(new mc.NavigationControl,"top-right"),c.addControl(new mc.ScaleControl,"bottom-left"),c.on("move",Fe),c.on("zoom",Ue),c.on("click",st=>{if(Wn(Vc))return;((c==null?void 0:c.getZoom())??0)>=qc&&!hu(st.lngLat.lng,st.lngLat.lat)&&uu()}),c.on("load",async()=>{if(!c)return;y(2,X=new Lp(c));const st=await X.init();y(3,he=new Vp(c)),await he.init(),y(4,Ie=new Zp(c)),await Ie.init(),st?(console.log("COG overlay enabled"),x.activeLayer==="exposure"&&X.loadVisibleRegions(),c.on("moveend",()=>{x.activeLayer==="exposure"&&(X==null||X.onViewportChange())})):console.log("Shielding overlay disabled (PUBLIC_SHIELDING_COG_BASE_URL not set)")})}),Zd(()=>{X==null||X.destroy(),he==null||he.destroy(),Ie==null||Ie.destroy(),c==null||c.remove()});function Xe(et){Au[et?"unshift":"push"](()=>{E=et,y(0,E)})}return L.$$set=et=>{"mapTilerKey"in et&&y(1,H=et.mapTilerKey)},L.$$.update=()=>{L.$$.dirty&60&&x.overlayOpacity!==void 0&&(X==null||X.updateOpacity(x.overlayOpacity),he==null||he.updateOpacity(x.overlayOpacity),Ie==null||Ie.updateOpacity(x.overlayOpacity)),L.$$.dirty&60&&X&&he&&Ie&&(x.activeLayer==="exposure"?(he.hide(),Ie.hide(),X.loadVisibleRegions()):x.activeLayer==="activity"?(X.hideAllLayers(),Ie.hide(),he.show()):x.activeLayer==="wind"&&(X.hideAllLayers(),he.hide(),Ie.show())),L.$$.dirty&40&&he&&x.activeLayer==="activity"&&he.setSourceAndPeriod(x.lightningSource,x.lightningPeriod),L.$$.dirty&48&&Ie&&x.activeLayer==="wind"&&Ie.setMetricAndPeriod(x.windMetric,x.windPeriod),L.$$.dirty&64&&(D?oe():gh(null))},[E,H,X,he,Ie,x,D,Xe]}let Cm=class extends Mn{constructor(g){super(),Tn(this,g,Bm,xm,Dn,{mapTilerKey:1})}};function Em(L){let g;return{c(){g=_i("Exposure")},l(y){g=yi(y,"Exposure")},m(y,x){at(y,g,x)},p:Mi,d(y){y&&Qe(g)}}}function Qm(L){let g;return{c(){g=_i(L[2])},l(y){g=yi(y,L[2])},m(y,x){at(y,g,x)},p(y,x){x&4&&mr(g,y[2])},d(y){y&&Qe(g)}}}function km(L){let g;return{c(){g=_i(L[3])},l(y){g=yi(y,L[3])},m(y,x){at(y,g,x)},p(y,x){x&8&&mr(g,y[3])},d(y){y&&Qe(g)}}}function Sm(L){let g,y,x,D="<span>Protected</span> <span>Exposed</span>";return{c(){g=Je("div"),y=yt(),x=Je("div"),x.innerHTML=D,this.h()},l(H){g=je(H,"DIV",{class:!0,style:!0}),ct(g).forEach(Qe),y=mt(H),x=je(H,"DIV",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-1x1do4p"&&(x.innerHTML=D),this.h()},h(){ye(g,"class","gradient-bar svelte-1imlov9"),bh(g,"background",L[5]),ye(x,"class","gradient-labels svelte-1imlov9")},m(H,E){at(H,g,E),at(H,y,E),at(H,x,E)},p:Mi,d(H){H&&(Qe(g),Qe(y),Qe(x))}}}function Dm(L){let g,y,x,D,H="0%",E,c,X,he;return{c(){g=Je("div"),y=yt(),x=Je("div"),D=Je("span"),D.textContent=H,E=yt(),c=Je("span"),X=_i(L[1]),he=_i("%"),this.h()},l(Ie){g=je(Ie,"DIV",{class:!0,style:!0}),ct(g).forEach(Qe),y=mt(Ie),x=je(Ie,"DIV",{class:!0});var fe=ct(x);D=je(fe,"SPAN",{"data-svelte-h":!0}),Xt(D)!=="svelte-zm8889"&&(D.textContent=H),E=mt(fe),c=je(fe,"SPAN",{});var oe=ct(c);X=yi(oe,L[1]),he=yi(oe,"%"),oe.forEach(Qe),fe.forEach(Qe),this.h()},h(){ye(g,"class","gradient-bar svelte-1imlov9"),bh(g,"background",L[6]),ye(x,"class","gradient-labels svelte-1imlov9")},m(Ie,fe){at(Ie,g,fe),at(Ie,y,fe),at(Ie,x,fe),Me(x,D),Me(x,E),Me(x,c),Me(c,X),Me(c,he)},p(Ie,fe){fe&2&&mr(X,Ie[1])},d(Ie){Ie&&(Qe(g),Qe(y),Qe(x))}}}function Mm(L){let g,y,x,D="<span>Low</span> <span>High</span>";return{c(){g=Je("div"),y=yt(),x=Je("div"),x.innerHTML=D,this.h()},l(H){g=je(H,"DIV",{class:!0,style:!0}),ct(g).forEach(Qe),y=mt(H),x=je(H,"DIV",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-3tvt5t"&&(x.innerHTML=D),this.h()},h(){ye(g,"class","gradient-bar svelte-1imlov9"),bh(g,"background",L[4]),ye(x,"class","gradient-labels svelte-1imlov9")},m(H,E){at(H,g,E),at(H,y,E),at(H,x,E)},p:Mi,d(H){H&&(Qe(g),Qe(y),Qe(x))}}}function Tm(L){let g,y,x,D;function H(fe,oe){return fe[0].activeLayer==="activity"?km:fe[0].activeLayer==="wind"?Qm:Em}let E=H(L),c=E(L);function X(fe,oe){return fe[0].activeLayer==="activity"?Mm:fe[0].activeLayer==="wind"?Dm:Sm}let he=X(L),Ie=he(L);return{c(){g=Je("div"),y=Je("h3"),c.c(),x=yt(),D=Je("div"),Ie.c(),this.h()},l(fe){g=je(fe,"DIV",{class:!0});var oe=ct(g);y=je(oe,"H3",{class:!0});var Fe=ct(y);c.l(Fe),Fe.forEach(Qe),x=mt(oe),D=je(oe,"DIV",{class:!0});var Ue=ct(D);Ie.l(Ue),Ue.forEach(Qe),oe.forEach(Qe),this.h()},h(){ye(y,"class","svelte-1imlov9"),ye(D,"class","legend-items svelte-1imlov9"),ye(g,"class","legend svelte-1imlov9")},m(fe,oe){at(fe,g,oe),Me(g,y),c.m(y,null),Me(g,x),Me(g,D),Ie.m(D,null)},p(fe,[oe]){E===(E=H(fe))&&c?c.p(fe,oe):(c.d(1),c=E(fe),c&&(c.c(),c.m(y,null))),he===(he=X(fe))&&Ie?Ie.p(fe,oe):(Ie.d(1),Ie=he(fe),Ie&&(Ie.c(),Ie.m(D,null)))},i:Mi,o:Mi,d(fe){fe&&Qe(g),c.d(),Ie.d()}}}function Pm(L,g,y){let x,D,H,E,c;Pr(L,Lr,oe=>y(0,c=oe));const X=`linear-gradient(90deg, ${tf.join(", ")})`,Ie=`linear-gradient(90deg, ${[...Rp.map(oe=>oe.color)].reverse().join(", ")})`,fe=`linear-gradient(90deg, ${rf.join(", ")})`;return L.$$.update=()=>{L.$$.dirty&1&&y(7,x=fu[c.lightningSource]),L.$$.dirty&129&&y(3,D=c.lightningPeriod==="year"?`Activity: ${x} (Annual)`:`Activity: ${x} (${gu[c.lightningPeriod]})`),L.$$.dirty&1&&y(2,H=`Wind: ${Fp[c.windMetric]}`),L.$$.dirty&1&&y(1,E=zp[c.windMetric])},[c,E,H,D,X,Ie,fe,x]}class Lm extends Mn{constructor(g){super(),Tn(this,g,Pm,Tm,Dn,{})}}function pd(L){let g,y,x,D,H,E,c;return{c(){g=Je("div"),y=Je("div"),x=yt(),D=Je("span"),H=_i("Loading... ("),E=_i(L[1]),c=_i(" pending)"),this.h()},l(X){g=je(X,"DIV",{class:!0});var he=ct(g);y=je(he,"DIV",{class:!0}),ct(y).forEach(Qe),x=mt(he),D=je(he,"SPAN",{});var Ie=ct(D);H=yi(Ie,"Loading... ("),E=yi(Ie,L[1]),c=yi(Ie," pending)"),Ie.forEach(Qe),he.forEach(Qe),this.h()},h(){ye(y,"class","spinner svelte-hal6h8"),ye(g,"class","loading-indicator svelte-hal6h8")},m(X,he){at(X,g,he),Me(g,y),Me(g,x),Me(g,D),Me(D,H),Me(D,E),Me(D,c)},p(X,he){he&2&&mr(E,X[1])},d(X){X&&Qe(g)}}}function Rm(L){let g,y=L[0]&&pd(L);return{c(){y&&y.c(),g=Yr()},l(x){y&&y.l(x),g=Yr()},m(x,D){y&&y.m(x,D),at(x,g,D)},p(x,[D]){x[0]?y?y.p(x,D):(y=pd(x),y.c(),y.m(g.parentNode,g)):y&&(y.d(1),y=null)},i:Mi,o:Mi,d(x){x&&Qe(g),y&&y.d(x)}}}function Fm(L,g,y){let x,D;return Pr(L,Ip,H=>y(0,x=H)),Pr(L,Wo,H=>y(1,D=H)),[x,D]}class zm extends Mn{constructor(g){super(),Tn(this,g,Fm,Rm,Dn,{})}}function md(L){let g,y='<p class="svelte-1k0q185">Adjusts the transparency of the overlay layer, making it easier to see the underlying map details.</p>';return{c(){g=Je("div"),g.innerHTML=y,this.h()},l(x){g=je(x,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-kvhtey"&&(g.innerHTML=y),this.h()},h(){ye(g,"class","help-popover svelte-1k0q185")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function Gm(L){let g,y,x="Overlay Opacity",D,H,E,c,X,he=Math.round(L[1].overlayOpacity*100)+"",Ie,fe,oe,Fe,Ue="?",Xe,et,st,Ne=L[0]&&md();return{c(){g=Je("div"),y=Je("label"),y.textContent=x,D=yt(),H=Je("input"),c=yt(),X=Je("span"),Ie=_i(he),fe=_i("%"),oe=yt(),Fe=Je("button"),Fe.textContent=Ue,Xe=yt(),Ne&&Ne.c(),this.h()},l(He){g=je(He,"DIV",{class:!0});var $e=ct(g);y=je($e,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-2ehpdk"&&(y.textContent=x),D=mt($e),H=je($e,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),c=mt($e),X=je($e,"SPAN",{class:!0});var lt=ct(X);Ie=yi(lt,he),fe=yi(lt,"%"),lt.forEach(Qe),oe=mt($e),Fe=je($e,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),Xt(Fe)!=="svelte-1lgoic7"&&(Fe.textContent=Ue),Xe=mt($e),Ne&&Ne.l($e),$e.forEach(Qe),this.h()},h(){ye(y,"for","opacity-slider"),ye(y,"class","svelte-1k0q185"),ye(H,"id","opacity-slider"),ye(H,"type","range"),ye(H,"min","0"),ye(H,"max","1"),ye(H,"step","0.1"),H.value=E=L[1].overlayOpacity,ye(H,"class","svelte-1k0q185"),ye(X,"class","opacity-value svelte-1k0q185"),ye(Fe,"class","help-btn svelte-1k0q185"),ye(Fe,"title","What is this?"),ye(Fe,"aria-label","Help"),ye(g,"class","opacity-control svelte-1k0q185")},m(He,$e){at(He,g,$e),Me(g,y),Me(g,D),Me(g,H),Me(g,c),Me(g,X),Me(X,Ie),Me(X,fe),Me(g,oe),Me(g,Fe),Me(g,Xe),Ne&&Ne.m(g,null),et||(st=[Ci(window,"click",L[4]),Ci(H,"input",L[2]),Ci(Fe,"click",_u(L[3]))],et=!0)},p(He,[$e]){$e&2&&E!==(E=He[1].overlayOpacity)&&(H.value=E),$e&2&&he!==(he=Math.round(He[1].overlayOpacity*100)+"")&&mr(Ie,he),He[0]?Ne||(Ne=md(),Ne.c(),Ne.m(g,null)):Ne&&(Ne.d(1),Ne=null)},i:Mi,o:Mi,d(He){He&&Qe(g),Ne&&Ne.d(),et=!1,la(st)}}}function Um(L,g,y){let x;Pr(L,Lr,X=>y(1,x=X));let D=!1;function H(X){const he=X.target;vp(parseFloat(he.value))}function E(){y(0,D=!D)}function c(X){X.target.closest(".opacity-control")||y(0,D=!1)}return[D,x,H,E,c]}class Nm extends Mn{constructor(g){super(),Tn(this,g,Um,Gm,Dn,{})}}function yd(L){let g,y,x,D="",H,E,c=L[1]==="login"?"Login":"Create Account",X,he,Ie,fe,oe,Fe="Email",Ue,Xe,et,st,Ne,He="Password",$e,lt,Qt,ht,Gt,vt,Tt,bt=L[6]?"Please wait...":L[1]==="login"?"Login":"Create Account",_t,Vt,Lt,Zt='<span class="svelte-16siter">or</span>',wi,Mt,Si,Ei,Qi,oi,ui,br,Jt,ei,Yt,ii,di=L[1]==="register"&&_d(L),ki=L[5]&&Id(L);function vr(pi,zi){return pi[1]==="login"?qm:Om}let yr=vr(L),Wi=yr(L);return{c(){g=Je("div"),y=Je("div"),x=Je("button"),x.textContent=D,H=yt(),E=Je("h2"),X=_i(c),he=yt(),Ie=Je("form"),fe=Je("div"),oe=Je("label"),oe.textContent=Fe,Ue=yt(),Xe=Je("input"),et=yt(),st=Je("div"),Ne=Je("label"),Ne.textContent=He,$e=yt(),lt=Je("input"),ht=yt(),di&&di.c(),Gt=yt(),ki&&ki.c(),vt=yt(),Tt=Je("button"),_t=_i(bt),Vt=yt(),Lt=Je("div"),Lt.innerHTML=Zt,wi=yt(),Mt=Je("button"),Si=jr("svg"),Ei=jr("path"),Qi=jr("path"),oi=jr("path"),ui=jr("path"),br=_i(`
        Continue with Google`),Jt=yt(),ei=Je("div"),Wi.c(),this.h()},l(pi){g=je(pi,"DIV",{class:!0,role:!0,"aria-modal":!0});var zi=ct(g);y=je(zi,"DIV",{class:!0});var er=ct(y);x=je(er,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-1ngpojv"&&(x.textContent=D),H=mt(er),E=je(er,"H2",{class:!0});var qe=ct(E);X=yi(qe,c),qe.forEach(Qe),he=mt(er),Ie=je(er,"FORM",{});var cr=ct(Ie);fe=je(cr,"DIV",{class:!0});var Pn=ct(fe);oe=je(Pn,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(oe)!=="svelte-1p9d3fm"&&(oe.textContent=Fe),Ue=mt(Pn),Xe=je(Pn,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),Pn.forEach(Qe),et=mt(cr),st=je(cr,"DIV",{class:!0});var Ai=ct(st);Ne=je(Ai,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(Ne)!=="svelte-pepa0a"&&(Ne.textContent=He),$e=mt(Ai),lt=je(Ai,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),Ai.forEach(Qe),ht=mt(cr),di&&di.l(cr),Gt=mt(cr),ki&&ki.l(cr),vt=mt(cr),Tt=je(cr,"BUTTON",{type:!0,class:!0});var Gi=ct(Tt);_t=yi(Gi,bt),Gi.forEach(Qe),cr.forEach(Qe),Vt=mt(er),Lt=je(er,"DIV",{class:!0,"data-svelte-h":!0}),Xt(Lt)!=="svelte-aitez0"&&(Lt.innerHTML=Zt),wi=mt(er),Mt=je(er,"BUTTON",{class:!0});var Xn=ct(Mt);Si=Hr(Xn,"svg",{viewBox:!0,width:!0,height:!0});var wr=ct(Si);Ei=Hr(wr,"path",{fill:!0,d:!0}),ct(Ei).forEach(Qe),Qi=Hr(wr,"path",{fill:!0,d:!0}),ct(Qi).forEach(Qe),oi=Hr(wr,"path",{fill:!0,d:!0}),ct(oi).forEach(Qe),ui=Hr(wr,"path",{fill:!0,d:!0}),ct(ui).forEach(Qe),wr.forEach(Qe),br=yi(Xn,`
        Continue with Google`),Xn.forEach(Qe),Jt=mt(er),ei=je(er,"DIV",{class:!0});var Kr=ct(ei);Wi.l(Kr),Kr.forEach(Qe),er.forEach(Qe),zi.forEach(Qe),this.h()},h(){ye(x,"class","close-btn svelte-16siter"),ye(E,"class","svelte-16siter"),ye(oe,"for","email"),ye(oe,"class","svelte-16siter"),ye(Xe,"id","email"),ye(Xe,"type","email"),Xe.required=!0,ye(Xe,"autocomplete","email"),ye(Xe,"class","svelte-16siter"),ye(fe,"class","field svelte-16siter"),ye(Ne,"for","password"),ye(Ne,"class","svelte-16siter"),ye(lt,"id","password"),ye(lt,"type","password"),lt.required=!0,ye(lt,"autocomplete",Qt=L[1]==="login"?"current-password":"new-password"),ye(lt,"class","svelte-16siter"),ye(st,"class","field svelte-16siter"),ye(Tt,"type","submit"),ye(Tt,"class","submit-btn svelte-16siter"),Tt.disabled=L[6],ye(Lt,"class","divider svelte-16siter"),ye(Ei,"fill","#4285F4"),ye(Ei,"d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"),ye(Qi,"fill","#34A853"),ye(Qi,"d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"),ye(oi,"fill","#FBBC05"),ye(oi,"d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"),ye(ui,"fill","#EA4335"),ye(ui,"d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"),ye(Si,"viewBox","0 0 24 24"),ye(Si,"width","18"),ye(Si,"height","18"),ye(Mt,"class","google-btn svelte-16siter"),Mt.disabled=L[6],ye(ei,"class","toggle svelte-16siter"),ye(y,"class","modal svelte-16siter"),ye(g,"class","backdrop svelte-16siter"),ye(g,"role","dialog"),ye(g,"aria-modal","true")},m(pi,zi){at(pi,g,zi),Me(g,y),Me(y,x),Me(y,H),Me(y,E),Me(E,X),Me(y,he),Me(y,Ie),Me(Ie,fe),Me(fe,oe),Me(fe,Ue),Me(fe,Xe),pc(Xe,L[2]),Me(Ie,et),Me(Ie,st),Me(st,Ne),Me(st,$e),Me(st,lt),pc(lt,L[3]),Me(Ie,ht),di&&di.m(Ie,null),Me(Ie,Gt),ki&&ki.m(Ie,null),Me(Ie,vt),Me(Ie,Tt),Me(Tt,_t),Me(y,Vt),Me(y,Lt),Me(y,wi),Me(y,Mt),Me(Mt,Si),Me(Si,Ei),Me(Si,Qi),Me(Si,oi),Me(Si,ui),Me(Mt,br),Me(y,Jt),Me(y,ei),Wi.m(ei,null),Yt||(ii=[Ci(x,"click",L[11]),Ci(Xe,"input",L[12]),Ci(lt,"input",L[13]),Ci(Ie,"submit",op(L[7])),Ci(Mt,"click",L[8]),Ci(g,"click",L[10])],Yt=!0)},p(pi,zi){zi&2&&c!==(c=pi[1]==="login"?"Login":"Create Account")&&mr(X,c),zi&4&&Xe.value!==pi[2]&&pc(Xe,pi[2]),zi&2&&Qt!==(Qt=pi[1]==="login"?"current-password":"new-password")&&ye(lt,"autocomplete",Qt),zi&8&&lt.value!==pi[3]&&pc(lt,pi[3]),pi[1]==="register"?di?di.p(pi,zi):(di=_d(pi),di.c(),di.m(Ie,Gt)):di&&(di.d(1),di=null),pi[5]?ki?ki.p(pi,zi):(ki=Id(pi),ki.c(),ki.m(Ie,vt)):ki&&(ki.d(1),ki=null),zi&66&&bt!==(bt=pi[6]?"Please wait...":pi[1]==="login"?"Login":"Create Account")&&mr(_t,bt),zi&64&&(Tt.disabled=pi[6]),zi&64&&(Mt.disabled=pi[6]),yr===(yr=vr(pi))&&Wi?Wi.p(pi,zi):(Wi.d(1),Wi=yr(pi),Wi&&(Wi.c(),Wi.m(ei,null)))},d(pi){pi&&Qe(g),di&&di.d(),ki&&ki.d(),Wi.d(),Yt=!1,la(ii)}}}function _d(L){let g,y,x="Confirm Password",D,H,E,c;return{c(){g=Je("div"),y=Je("label"),y.textContent=x,D=yt(),H=Je("input"),this.h()},l(X){g=je(X,"DIV",{class:!0});var he=ct(g);y=je(he,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-1o1itl8"&&(y.textContent=x),D=mt(he),H=je(he,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),he.forEach(Qe),this.h()},h(){ye(y,"for","passwordConfirm"),ye(y,"class","svelte-16siter"),ye(H,"id","passwordConfirm"),ye(H,"type","password"),H.required=!0,ye(H,"autocomplete","new-password"),ye(H,"class","svelte-16siter"),ye(g,"class","field svelte-16siter")},m(X,he){at(X,g,he),Me(g,y),Me(g,D),Me(g,H),pc(H,L[4]),E||(c=Ci(H,"input",L[14]),E=!0)},p(X,he){he&16&&H.value!==X[4]&&pc(H,X[4])},d(X){X&&Qe(g),E=!1,c()}}}function Id(L){let g,y;return{c(){g=Je("div"),y=_i(L[5]),this.h()},l(x){g=je(x,"DIV",{class:!0});var D=ct(g);y=yi(D,L[5]),D.forEach(Qe),this.h()},h(){ye(g,"class","error svelte-16siter")},m(x,D){at(x,g,D),Me(g,y)},p(x,D){D&32&&mr(y,x[5])},d(x){x&&Qe(g)}}}function Om(L){let g,y,x="Login",D,H;return{c(){g=_i("Already have an account? "),y=Je("button"),y.textContent=x,this.h()},l(E){g=yi(E,"Already have an account? "),y=je(E,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-1qozt9s"&&(y.textContent=x),this.h()},h(){ye(y,"class","svelte-16siter")},m(E,c){at(E,g,c),at(E,y,c),D||(H=Ci(y,"click",L[9]),D=!0)},p:Mi,d(E){E&&(Qe(g),Qe(y)),D=!1,H()}}}function qm(L){let g,y,x="Sign up",D,H;return{c(){g=_i("Don't have an account? "),y=Je("button"),y.textContent=x,this.h()},l(E){g=yi(E,"Don't have an account? "),y=je(E,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-1uqo441"&&(y.textContent=x),this.h()},h(){ye(y,"class","svelte-16siter")},m(E,c){at(E,g,c),at(E,y,c),D||(H=Ci(y,"click",L[9]),D=!0)},p:Mi,d(E){E&&(Qe(g),Qe(y)),D=!1,H()}}}function Vm(L){let g,y=L[0]&&yd(L);return{c(){y&&y.c(),g=Yr()},l(x){y&&y.l(x),g=Yr()},m(x,D){y&&y.m(x,D),at(x,g,D)},p(x,[D]){x[0]?y?y.p(x,D):(y=yd(x),y.c(),y.m(g.parentNode,g)):y&&(y.d(1),y=null)},i:Mi,o:Mi,d(x){x&&Qe(g),y&&y.d(x)}}}function Hm(L,g,y){let{show:x=!1}=g,D="login",H="",E="",c="",X="",he=!1;async function Ie(){y(5,X=""),y(6,he=!0);try{D==="login"?await hf(H,E):await mm(H,E,c),y(0,x=!1),oe()}catch(He){y(5,X=He.message||"Authentication failed")}finally{y(6,he=!1)}}async function fe(){y(5,X=""),y(6,he=!0);try{await _m("google"),y(0,x=!1),oe()}catch(He){y(5,X=He.message||"Google login failed")}finally{y(6,he=!1)}}function oe(){y(2,H=""),y(3,E=""),y(4,c=""),y(5,X="")}function Fe(){y(1,D=D==="login"?"register":"login"),y(5,X="")}function Ue(He){He.target===He.currentTarget&&y(0,x=!1)}const Xe=()=>y(0,x=!1);function et(){H=this.value,y(2,H)}function st(){E=this.value,y(3,E)}function Ne(){c=this.value,y(4,c)}return L.$$set=He=>{"show"in He&&y(0,x=He.show)},[x,D,H,E,c,X,he,Ie,fe,Fe,Ue,Xe,et,st,Ne]}class jm extends Mn{constructor(g){super(),Tn(this,g,Hm,Vm,Dn,{show:0})}}function bd(L,g,y){var E;const x=L.slice();x[15]=g[y];const D=((E=x[1].currentPlan)==null?void 0:E.id)===x[15].id;x[16]=D;const H=!x[16]||x[1].cancelAtPeriodEnd;return x[17]=H,x}function vd(L){let g,y,x,D,H,E="",c,X,he=L[6]?"Billing":"Premium Plans",Ie,fe,oe,Fe,Ue,Xe,et=!L[3]&&L[5].some(Md),st,Ne,He=L[6]&&wd(L),$e=L[4]&&Ed(L);function lt(vt,Tt){return vt[3]?$m:vt[5].length===0?Zm:Km}let Qt=lt(L),ht=Qt(L),Gt=et&&kd();return{c(){g=Je("div"),y=Je("button"),x=yt(),D=Je("div"),H=Je("button"),H.textContent=E,c=yt(),X=Je("h2"),Ie=_i(he),fe=yt(),He&&He.c(),oe=yt(),$e&&$e.c(),Fe=yt(),Ue=Je("div"),ht.c(),Xe=yt(),Gt&&Gt.c(),this.h()},l(vt){g=je(vt,"DIV",{class:!0,role:!0,"aria-modal":!0});var Tt=ct(g);y=je(Tt,"BUTTON",{class:!0,type:!0,"aria-label":!0}),ct(y).forEach(Qe),x=mt(Tt),D=je(Tt,"DIV",{class:!0});var bt=ct(D);H=je(bt,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(H)!=="svelte-1ngpojv"&&(H.textContent=E),c=mt(bt),X=je(bt,"H2",{class:!0});var _t=ct(X);Ie=yi(_t,he),_t.forEach(Qe),fe=mt(bt),He&&He.l(bt),oe=mt(bt),$e&&$e.l(bt),Fe=mt(bt),Ue=je(bt,"DIV",{class:!0});var Vt=ct(Ue);ht.l(Vt),Vt.forEach(Qe),Xe=mt(bt),Gt&&Gt.l(bt),bt.forEach(Qe),Tt.forEach(Qe),this.h()},h(){ye(y,"class","backdrop-dismiss svelte-2oois9"),ye(y,"type","button"),ye(y,"aria-label","Close billing"),ye(H,"class","close-btn svelte-2oois9"),ye(X,"class","svelte-2oois9"),ye(Ue,"class","plans svelte-2oois9"),ye(D,"class","modal svelte-2oois9"),ye(g,"class","backdrop svelte-2oois9"),ye(g,"role","dialog"),ye(g,"aria-modal","true")},m(vt,Tt){at(vt,g,Tt),Me(g,y),Me(g,x),Me(g,D),Me(D,H),Me(D,c),Me(D,X),Me(X,Ie),Me(D,fe),He&&He.m(D,null),Me(D,oe),$e&&$e.m(D,null),Me(D,Fe),Me(D,Ue),ht.m(Ue,null),Me(D,Xe),Gt&&Gt.m(D,null),st||(Ne=[Ci(y,"click",L[9]),Ci(H,"click",L[11])],st=!0)},p(vt,Tt){Tt&64&&he!==(he=vt[6]?"Billing":"Premium Plans")&&mr(Ie,he),vt[6]?He?He.p(vt,Tt):(He=wd(vt),He.c(),He.m(D,oe)):He&&(He.d(1),He=null),vt[4]?$e?$e.p(vt,Tt):($e=Ed(vt),$e.c(),$e.m(D,Fe)):$e&&($e.d(1),$e=null),Qt===(Qt=lt(vt))&&ht?ht.p(vt,Tt):(ht.d(1),ht=Qt(vt),ht&&(ht.c(),ht.m(Ue,null))),Tt&40&&(et=!vt[3]&&vt[5].some(Md)),et?Gt||(Gt=kd(),Gt.c(),Gt.m(D,null)):Gt&&(Gt.d(1),Gt=null)},d(vt){vt&&Qe(g),He&&He.d(),$e&&$e.d(),ht.d(),Gt&&Gt.d(),st=!1,la(Ne)}}}function wd(L){let g,y,x,D="Current plan",H,E,c;function X(oe,Fe){return oe[1].currentPlan?Ym:Jm}let he=X(L),Ie=he(L),fe=L[1].currentPlan&&L[1].planStatus!=="lifetime"&&!L[1].cancelAtPeriodEnd&&Cd(L);return{c(){g=Je("div"),y=Je("div"),x=Je("div"),x.textContent=D,H=yt(),E=Je("div"),Ie.c(),c=yt(),fe&&fe.c(),this.h()},l(oe){g=je(oe,"DIV",{class:!0});var Fe=ct(g);y=je(Fe,"DIV",{class:!0});var Ue=ct(y);x=je(Ue,"DIV",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-ehgmhv"&&(x.textContent=D),H=mt(Ue),E=je(Ue,"DIV",{class:!0});var Xe=ct(E);Ie.l(Xe),Xe.forEach(Qe),Ue.forEach(Qe),c=mt(Fe),fe&&fe.l(Fe),Fe.forEach(Qe),this.h()},h(){ye(x,"class","label svelte-2oois9"),ye(E,"class","value svelte-2oois9"),ye(y,"class","current-info svelte-2oois9"),ye(g,"class","current svelte-2oois9")},m(oe,Fe){at(oe,g,Fe),Me(g,y),Me(y,x),Me(y,H),Me(y,E),Ie.m(E,null),Me(g,c),fe&&fe.m(g,null)},p(oe,Fe){he===(he=X(oe))&&Ie?Ie.p(oe,Fe):(Ie.d(1),Ie=he(oe),Ie&&(Ie.c(),Ie.m(E,null))),oe[1].currentPlan&&oe[1].planStatus!=="lifetime"&&!oe[1].cancelAtPeriodEnd?fe?fe.p(oe,Fe):(fe=Cd(oe),fe.c(),fe.m(g,null)):fe&&(fe.d(1),fe=null)},d(oe){oe&&Qe(g),Ie.d(),fe&&fe.d()}}}function Jm(L){let g,y="None";return{c(){g=Je("span"),g.textContent=y,this.h()},l(x){g=je(x,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1l9bfjs"&&(g.textContent=y),this.h()},h(){ye(g,"class","muted svelte-2oois9")},m(x,D){at(x,g,D)},p:Mi,d(x){x&&Qe(g)}}}function Ym(L){let g,y=L[1].currentPlan.name+"",x,D,H,E,c=L[1].planStatus&&xd(L),X=L[1].cancelAtPeriodEnd&&Bd();return{c(){g=Je("span"),x=_i(y),D=yt(),c&&c.c(),H=yt(),X&&X.c(),E=Yr(),this.h()},l(he){g=je(he,"SPAN",{class:!0});var Ie=ct(g);x=yi(Ie,y),Ie.forEach(Qe),D=mt(he),c&&c.l(he),H=mt(he),X&&X.l(he),E=Yr(),this.h()},h(){ye(g,"class","plan-name svelte-2oois9")},m(he,Ie){at(he,g,Ie),Me(g,x),at(he,D,Ie),c&&c.m(he,Ie),at(he,H,Ie),X&&X.m(he,Ie),at(he,E,Ie)},p(he,Ie){Ie&2&&y!==(y=he[1].currentPlan.name+"")&&mr(x,y),he[1].planStatus?c?c.p(he,Ie):(c=xd(he),c.c(),c.m(H.parentNode,H)):c&&(c.d(1),c=null),he[1].cancelAtPeriodEnd?X||(X=Bd(),X.c(),X.m(E.parentNode,E)):X&&(X.d(1),X=null)},d(he){he&&(Qe(g),Qe(D),Qe(H),Qe(E)),c&&c.d(he),X&&X.d(he)}}}function xd(L){let g,y=L[1].planStatus+"",x;return{c(){g=Je("span"),x=_i(y),this.h()},l(D){g=je(D,"SPAN",{class:!0});var H=ct(g);x=yi(H,y),H.forEach(Qe),this.h()},h(){ye(g,"class","status svelte-2oois9")},m(D,H){at(D,g,H),Me(g,x)},p(D,H){H&2&&y!==(y=D[1].planStatus+"")&&mr(x,y)},d(D){D&&Qe(g)}}}function Bd(L){let g,y="Cancels at period end";return{c(){g=Je("span"),g.textContent=y,this.h()},l(x){g=je(x,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-10njltp"&&(g.textContent=y),this.h()},h(){ye(g,"class","status canceling svelte-2oois9")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function Cd(L){let g,y=L[2]?"Canceling...":"Cancel",x,D,H,E;return{c(){g=Je("button"),x=_i(y),this.h()},l(c){g=je(c,"BUTTON",{class:!0});var X=ct(g);x=yi(X,y),X.forEach(Qe),this.h()},h(){ye(g,"class","cancel-btn svelte-2oois9"),g.disabled=D=L[2]||L[3]},m(c,X){at(c,g,X),Me(g,x),H||(E=Ci(g,"click",L[7]),H=!0)},p(c,X){X&4&&y!==(y=c[2]?"Canceling...":"Cancel")&&mr(x,y),X&12&&D!==(D=c[2]||c[3])&&(g.disabled=D)},d(c){c&&Qe(g),H=!1,E()}}}function Ed(L){let g,y;return{c(){g=Je("div"),y=_i(L[4]),this.h()},l(x){g=je(x,"DIV",{class:!0});var D=ct(g);y=yi(D,L[4]),D.forEach(Qe),this.h()},h(){ye(g,"class","error svelte-2oois9")},m(x,D){at(x,g,D),Me(g,y)},p(x,D){D&16&&mr(y,x[4])},d(x){x&&Qe(g)}}}function Km(L){let g=[],y=new Map,x,D=za(L[5]);const H=E=>E[15].id;for(let E=0;E<D.length;E+=1){let c=bd(L,D,E),X=H(c);y.set(X,g[E]=Qd(X,c))}return{c(){for(let E=0;E<g.length;E+=1)g[E].c();x=Yr()},l(E){for(let c=0;c<g.length;c+=1)g[c].l(E);x=Yr()},m(E,c){for(let X=0;X<g.length;X+=1)g[X]&&g[X].m(E,c);at(E,x,c)},p(E,c){c&298&&(D=za(E[5]),g=up(g,c,H,1,E,D,y,x.parentNode,hp,Qd,x,bd))},d(E){E&&Qe(x);for(let c=0;c<g.length;c+=1)g[c].d(E)}}}function Zm(L){let g,y="No active plans";return{c(){g=Je("div"),g.textContent=y,this.h()},l(x){g=je(x,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1i9sp8t"&&(g.textContent=y),this.h()},h(){ye(g,"class","muted svelte-2oois9")},m(x,D){at(x,g,D)},p:Mi,d(x){x&&Qe(g)}}}function $m(L){let g,y="Loading...";return{c(){g=Je("div"),g.textContent=y,this.h()},l(x){g=je(x,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-mlj0q2"&&(g.textContent=y),this.h()},h(){ye(g,"class","muted svelte-2oois9")},m(x,D){at(x,g,D)},p:Mi,d(x){x&&Qe(g)}}}function Wm(L){let g,y=L[16]&&L[1].cancelAtPeriodEnd?"Resubscribe":L[15].interval==="lifetime"?"Buy":"Subscribe",x,D,H;function E(){return L[12](L[15])}return{c(){g=Je("button"),x=_i(y),this.h()},l(c){g=je(c,"BUTTON",{class:!0});var X=ct(g);x=yi(X,y),X.forEach(Qe),this.h()},h(){ye(g,"class","checkout-btn svelte-2oois9"),g.disabled=L[3]},m(c,X){at(c,g,X),Me(g,x),D||(H=Ci(g,"click",E),D=!0)},p(c,X){L=c,X&34&&y!==(y=L[16]&&L[1].cancelAtPeriodEnd?"Resubscribe":L[15].interval==="lifetime"?"Buy":"Subscribe")&&mr(x,y),X&8&&(g.disabled=L[3])},d(c){c&&Qe(g),D=!1,H()}}}function Xm(L){let g,y="Current";return{c(){g=Je("span"),g.textContent=y,this.h()},l(x){g=je(x,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1h9p5id"&&(g.textContent=y),this.h()},h(){ye(g,"class","current-badge svelte-2oois9")},m(x,D){at(x,g,D)},p:Mi,d(x){x&&Qe(g)}}}function Qd(L,g){let y,x,D,H=g[15].name+"",E,c,X,he,Ie=Dd(g[15].price,g[15].currency)+"",fe,oe,Fe,Ue,Xe=(g[15].interval==="lifetime"?"once":g[15].interval)+"",et,st,Ne;function He(Qt,ht){return Qt[16]&&!Qt[1].cancelAtPeriodEnd?Xm:Wm}let $e=He(g),lt=$e(g);return{key:L,first:null,c(){y=Je("div"),x=Je("div"),D=Je("div"),E=_i(H),c=yt(),X=Je("div"),he=Je("span"),fe=_i(Ie),oe=yt(),Fe=Je("span"),Ue=_i("/ "),et=_i(Xe),st=yt(),lt.c(),Ne=yt(),this.h()},l(Qt){y=je(Qt,"DIV",{class:!0});var ht=ct(y);x=je(ht,"DIV",{class:!0});var Gt=ct(x);D=je(Gt,"DIV",{class:!0});var vt=ct(D);E=yi(vt,H),vt.forEach(Qe),c=mt(Gt),X=je(Gt,"DIV",{class:!0});var Tt=ct(X);he=je(Tt,"SPAN",{class:!0});var bt=ct(he);fe=yi(bt,Ie),bt.forEach(Qe),oe=mt(Tt),Fe=je(Tt,"SPAN",{class:!0});var _t=ct(Fe);Ue=yi(_t,"/ "),et=yi(_t,Xe),_t.forEach(Qe),Tt.forEach(Qe),Gt.forEach(Qe),st=mt(ht),lt.l(ht),Ne=mt(ht),ht.forEach(Qe),this.h()},h(){ye(D,"class","plan-title svelte-2oois9"),ye(he,"class","plan-price svelte-2oois9"),ye(Fe,"class","plan-interval svelte-2oois9"),ye(X,"class","plan-subtitle svelte-2oois9"),ye(x,"class","plan-meta"),ye(y,"class","plan svelte-2oois9"),Tr(y,"current-plan",g[16]&&!g[1].cancelAtPeriodEnd),this.first=y},m(Qt,ht){at(Qt,y,ht),Me(y,x),Me(x,D),Me(D,E),Me(x,c),Me(x,X),Me(X,he),Me(he,fe),Me(X,oe),Me(X,Fe),Me(Fe,Ue),Me(Fe,et),Me(y,st),lt.m(y,null),Me(y,Ne)},p(Qt,ht){g=Qt,ht&32&&H!==(H=g[15].name+"")&&mr(E,H),ht&32&&Ie!==(Ie=Dd(g[15].price,g[15].currency)+"")&&mr(fe,Ie),ht&32&&Xe!==(Xe=(g[15].interval==="lifetime"?"once":g[15].interval)+"")&&mr(et,Xe),$e===($e=He(g))&&lt?lt.p(g,ht):(lt.d(1),lt=$e(g),lt&&(lt.c(),lt.m(y,Ne))),ht&34&&Tr(y,"current-plan",g[16]&&!g[1].cancelAtPeriodEnd)},d(Qt){Qt&&Qe(y),lt.d()}}}function kd(L){let g,y="Cancel anytime with one click. No questions asked.";return{c(){g=Je("p"),g.textContent=y,this.h()},l(x){g=je(x,"P",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-kb8sv6"&&(g.textContent=y),this.h()},h(){ye(g,"class","reassurance svelte-2oois9")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function ey(L){let g,y=L[0]&&vd(L);return{c(){y&&y.c(),g=Yr()},l(x){y&&y.l(x),g=Yr()},m(x,D){y&&y.m(x,D),at(x,g,D)},p(x,[D]){x[0]?y?y.p(x,D):(y=vd(x),y.c(),y.m(g.parentNode,g)):y&&(y.d(1),y=null)},i:Mi,o:Mi,d(x){x&&Qe(g),y&&y.d(x)}}}function Sd(L,g){typeof window<"u"&&window.gtag&&window.gtag("event",L,g)}function Dd(L,g){return new Intl.NumberFormat("de-DE",{style:"currency",currency:g}).format(L)}function ty(){try{const L=Intl.DateTimeFormat().resolvedOptions().timeZone||"";if(L.startsWith("Europe/")||L==="Atlantic/Canary"||L==="Atlantic/Madeira"||L==="Atlantic/Azores")return"EUR"}catch{}return"USD"}const Md=L=>L.interval!=="lifetime";function iy(L,g,y){let x,D;Pr(L,Nl,Ne=>y(6,D=Ne));let{show:H=!1}=g,E=ty(),c=[],X={currentPlan:null,planStatus:"",cancelAtPeriodEnd:!1},he=!1,Ie=!1,fe="";async function oe(){var Ne;y(3,Ie=!0),y(4,fe="");try{if(D){const $e=await Jr.collection("users").getOne(D.id,{expand:"current_plan"}),lt=(Ne=$e==null?void 0:$e.expand)==null?void 0:Ne.current_plan;let Qt=!1;try{const ht=await Jr.collection("subscriptions").getList(1,1,{filter:`user = '${D.id}'`});ht.items.length>0&&(Qt=ht.items[0].cancel_at_period_end===!0)}catch{}y(1,X={currentPlan:lt??null,planStatus:$e.plan_status??"",cancelAtPeriodEnd:Qt})}else y(1,X={currentPlan:null,planStatus:"",cancelAtPeriodEnd:!1});const He={lifetime:0,yearly:1,monthly:2};y(10,c=(await Jr.collection("plans").getFullList({filter:`active = true && currency = '${E}'`})).sort(($e,lt)=>(He[$e.interval]??99)-(He[lt.interval]??99)))}catch(He){y(4,fe=(He==null?void 0:He.message)||"Failed to load billing info")}finally{y(3,Ie=!1)}}async function Fe(){y(2,he=!0),y(4,fe="");try{await Jr.send("/api/stripe-cancel",{method:"POST"}),await oe()}catch(Ne){y(4,fe=(Ne==null?void 0:Ne.message)||"Failed to cancel subscription")}finally{y(2,he=!1)}}async function Ue(Ne){if(Sd("billing_checkout_click",{plan_id:Ne.id,plan_name:Ne.name,plan_interval:Ne.interval,plan_price:Ne.price,plan_currency:Ne.currency,user_state:D?"logged_in":"anonymous"}),!D){y(0,H=!1),window.dispatchEvent(new CustomEvent("open-auth-modal"));return}y(3,Ie=!0),y(4,fe="");try{const He=await Jr.send("/api/stripe-checkout",{method:"POST",body:{planId:Ne.id}});if(!(He!=null&&He.url))throw new Error("Checkout did not return a redirect URL");window.location.href=He.url}catch(He){y(4,fe=(He==null?void 0:He.message)||"Checkout failed"),y(3,Ie=!1)}}function Xe(Ne){y(0,H=!1)}const et=()=>y(0,H=!1),st=Ne=>Ue(Ne);return L.$$set=Ne=>{"show"in Ne&&y(0,H=Ne.show)},L.$$.update=()=>{L.$$.dirty&1&&H&&(Sd("billing_modal_open"),oe()),L.$$.dirty&1026&&y(5,x=X.planStatus==="lifetime"?c.filter(Ne=>Ne.interval==="lifetime"):c)},[H,X,he,Ie,fe,x,D,Fe,Ue,Xe,c,et,st]}class ry extends Mn{constructor(g){super(),Tn(this,g,iy,ey,Dn,{show:0})}}function ny(L){let g,y="Login",x,D;return{c(){g=Je("button"),g.textContent=y,this.h()},l(H){g=je(H,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-5a9e8v"&&(g.textContent=y),this.h()},h(){ye(g,"class","login-btn svelte-t6wi3p")},m(H,E){at(H,g,E),x||(D=Ci(g,"click",L[4]),x=!0)},p:Mi,d(H){H&&Qe(g),x=!1,D()}}}function sy(L){let g,y=L[2].email+"",x,D,H,E="Billing",c,X,he="Logout",Ie,fe;return{c(){g=Je("span"),x=_i(y),D=yt(),H=Je("button"),H.textContent=E,c=yt(),X=Je("button"),X.textContent=he,this.h()},l(oe){g=je(oe,"SPAN",{class:!0});var Fe=ct(g);x=yi(Fe,y),Fe.forEach(Qe),D=mt(oe),H=je(oe,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(H)!=="svelte-sy610t"&&(H.textContent=E),c=mt(oe),X=je(oe,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(X)!=="svelte-nurb2"&&(X.textContent=he),this.h()},h(){ye(g,"class","user-email svelte-t6wi3p"),ye(H,"class","billing-btn svelte-t6wi3p"),ye(X,"class","logout-btn svelte-t6wi3p")},m(oe,Fe){at(oe,g,Fe),Me(g,x),at(oe,D,Fe),at(oe,H,Fe),at(oe,c,Fe),at(oe,X,Fe),Ie||(fe=[Ci(H,"click",L[3]),Ci(X,"click",ym)],Ie=!0)},p(oe,Fe){Fe&4&&y!==(y=oe[2].email+"")&&mr(x,y)},d(oe){oe&&(Qe(g),Qe(D),Qe(H),Qe(c),Qe(X)),Ie=!1,la(fe)}}}function ay(L){let g,y,x='<img src="/logo/incusgrid_logo_transparent.svg" alt="IncusGrid" class="logo svelte-t6wi3p"/> <span class="brand-name svelte-t6wi3p">IncusGrid</span>',D,H,E,c,X,he,Ie,fe,oe;function Fe($e,lt){return $e[2]?sy:ny}let Ue=Fe(L),Xe=Ue(L);function et($e){L[5]($e)}let st={};L[0]!==void 0&&(st.show=L[0]),c=new jm({props:st}),Au.push(()=>sd(c,"show",et));function Ne($e){L[6]($e)}let He={};return L[1]!==void 0&&(He.show=L[1]),Ie=new ry({props:He}),Au.push(()=>sd(Ie,"show",Ne)),{c(){g=Je("header"),y=Je("div"),y.innerHTML=x,D=yt(),H=Je("div"),Xe.c(),E=yt(),$n(c.$$.fragment),he=yt(),$n(Ie.$$.fragment),this.h()},l($e){g=je($e,"HEADER",{class:!0});var lt=ct(g);y=je(lt,"DIV",{class:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-1c2sdme"&&(y.innerHTML=x),D=mt(lt),H=je(lt,"DIV",{class:!0});var Qt=ct(H);Xe.l(Qt),Qt.forEach(Qe),lt.forEach(Qe),E=mt($e),Zn(c.$$.fragment,$e),he=mt($e),Zn(Ie.$$.fragment,$e),this.h()},h(){ye(y,"class","brand svelte-t6wi3p"),ye(H,"class","auth svelte-t6wi3p"),ye(g,"class","svelte-t6wi3p")},m($e,lt){at($e,g,lt),Me(g,y),Me(g,D),Me(g,H),Xe.m(H,null),at($e,E,lt),Kn(c,$e,lt),at($e,he,lt),Kn(Ie,$e,lt),oe=!0},p($e,[lt]){Ue===(Ue=Fe($e))&&Xe?Xe.p($e,lt):(Xe.d(1),Xe=Ue($e),Xe&&(Xe.c(),Xe.m(H,null)));const Qt={};!X&&lt&1&&(X=!0,Qt.show=$e[0],nd(()=>X=!1)),c.$set(Qt);const ht={};!fe&&lt&2&&(fe=!0,ht.show=$e[1],nd(()=>fe=!1)),Ie.$set(ht)},i($e){oe||($i(c.$$.fragment,$e),$i(Ie.$$.fragment,$e),oe=!0)},o($e){pr(c.$$.fragment,$e),pr(Ie.$$.fragment,$e),oe=!1},d($e){$e&&(Qe(g),Qe(E),Qe(he)),Xe.d(),Yn(c,$e),Yn(Ie,$e)}}}function oy(L,g,y){let x;Pr(L,Nl,oe=>y(2,x=oe));let D=!1,H=!1;function E(){y(1,H=!0)}function c(){y(0,D=!0)}Ih(()=>{window.addEventListener("open-billing-modal",E),window.addEventListener("open-auth-modal",c)}),Zd(()=>{window.removeEventListener("open-billing-modal",E),window.removeEventListener("open-auth-modal",c)});const X=()=>y(1,H=!0),he=()=>y(0,D=!0);function Ie(oe){D=oe,y(0,D)}function fe(oe){H=oe,y(1,H)}return[D,H,x,X,he,Ie,fe]}class ly extends Mn{constructor(g){super(),Tn(this,g,oy,ay,Dn,{})}}function Td(L){let g,y='<div class="help-item svelte-52kvpw"><div class="help-icon exposure svelte-52kvpw"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"></path></svg></div> <div class="help-text svelte-52kvpw"><strong class="svelte-52kvpw">Exposure</strong> <p class="svelte-52kvpw">Shows how well terrain shields each location from lightning. Green areas have nearby hills or high buildings that act as natural lightning rods. Red areas are statistically more exposed to lightning strikes than green areas.</p></div></div> <div class="help-item svelte-52kvpw"><div class="help-icon activity svelte-52kvpw"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M7 2v11h3v9l7-12h-4l4-8z"></path></svg></div> <div class="help-text svelte-52kvpw"><strong class="svelte-52kvpw">Activity</strong> <p class="svelte-52kvpw">Shows the average lightning strikes per square kilometer for any given month or over the entire year. Red areas have significantly more lightning strikes than green areas.</p></div></div> <div class="help-item svelte-52kvpw"><div class="help-icon wind svelte-52kvpw"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12.5 2C9.64 2 8 3.57 8 5.5c0 2 1.5 3.5 3.5 3.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h9.5c1.38 0 2.5-1.12 2.5-2.5S13.88 7 12.5 7h-1C10.67 7 10 6.33 10 5.5S10.67 4 11.5 4h1c1.93 0 3.5 1.57 3.5 3.5h2c0-3.04-2.46-5.5-5.5-5.5zM19 12v2h-1.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h16.5c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5H21v-2h-2z"></path></svg></div> <div class="help-text svelte-52kvpw"><strong class="svelte-52kvpw">Wind</strong> <p class="svelte-52kvpw">Shows what percentage of time a location experiences a given wind condition. Choose between speed categories (Light, Moderate, Strong, Storm) or wind directions (N, NE, etc.). The color scale ranges from 0% to a category-specific maximum. Storm* is a detail view of the Storm layer with a finer 02% scale to reveal differences in regions with rare but noteworthy storm activity.</p></div></div>';return{c(){g=Je("div"),g.innerHTML=y,this.h()},l(x){g=je(x,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1o79pgl"&&(g.innerHTML=y),this.h()},h(){ye(g,"class","help-popover svelte-52kvpw")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function cy(L){let g,y,x=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-52kvpw"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"></path></svg>
    Exposure`,D,H,E=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-52kvpw"><path d="M7 2v11h3v9l7-12h-4l4-8z"></path></svg>
    Activity`,c,X,he=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-52kvpw"><path d="M12.5 2C9.64 2 8 3.57 8 5.5c0 2 1.5 3.5 3.5 3.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h9.5c1.38 0 2.5-1.12 2.5-2.5S13.88 7 12.5 7h-1C10.67 7 10 6.33 10 5.5S10.67 4 11.5 4h1c1.93 0 3.5 1.57 3.5 3.5h2c0-3.04-2.46-5.5-5.5-5.5zM19 12v2h-1.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h16.5c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5H21v-2h-2z"></path></svg>
    Wind`,Ie,fe,oe="?",Fe,Ue,Xe,et=L[0]&&Td();return{c(){g=Je("div"),y=Je("button"),y.innerHTML=x,D=yt(),H=Je("button"),H.innerHTML=E,c=yt(),X=Je("button"),X.innerHTML=he,Ie=yt(),fe=Je("button"),fe.textContent=oe,Fe=yt(),et&&et.c(),this.h()},l(st){g=je(st,"DIV",{class:!0});var Ne=ct(g);y=je(Ne,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-1h76bnd"&&(y.innerHTML=x),D=mt(Ne),H=je(Ne,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Xt(H)!=="svelte-hl1je4"&&(H.innerHTML=E),c=mt(Ne),X=je(Ne,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Xt(X)!=="svelte-108i5nd"&&(X.innerHTML=he),Ie=mt(Ne),fe=je(Ne,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),Xt(fe)!=="svelte-s18xjb"&&(fe.textContent=oe),Fe=mt(Ne),et&&et.l(Ne),Ne.forEach(Qe),this.h()},h(){ye(y,"class","layer-btn svelte-52kvpw"),ye(y,"title","Show exposure level based on nearby protection"),Tr(y,"active",L[1].activeLayer==="exposure"),ye(H,"class","layer-btn svelte-52kvpw"),ye(H,"title","Show historical lightning activity"),Tr(H,"active",L[1].activeLayer==="activity"),ye(X,"class","layer-btn svelte-52kvpw"),ye(X,"title","Show wind data"),Tr(X,"active",L[1].activeLayer==="wind"),ye(fe,"class","help-btn svelte-52kvpw"),ye(fe,"title","Learn about layers"),ye(fe,"aria-label","Help"),ye(g,"class","layer-toggle svelte-52kvpw")},m(st,Ne){at(st,g,Ne),Me(g,y),Me(g,D),Me(g,H),Me(g,c),Me(g,X),Me(g,Ie),Me(g,fe),Me(g,Fe),et&&et.m(g,null),Ue||(Xe=[Ci(window,"click",L[4]),Ci(y,"click",L[5]),Ci(H,"click",L[6]),Ci(X,"click",L[7]),Ci(fe,"click",_u(L[3]))],Ue=!0)},p(st,[Ne]){Ne&2&&Tr(y,"active",st[1].activeLayer==="exposure"),Ne&2&&Tr(H,"active",st[1].activeLayer==="activity"),Ne&2&&Tr(X,"active",st[1].activeLayer==="wind"),st[0]?et||(et=Td(),et.c(),et.m(g,null)):et&&(et.d(1),et=null)},i:Mi,o:Mi,d(st){st&&Qe(g),et&&et.d(),Ue=!1,la(Xe)}}}function hy(L,g,y){let x;Pr(L,Lr,fe=>y(1,x=fe));let D=!1;function H(fe){wp(fe)}function E(){y(0,D=!D)}function c(fe){fe.target.closest(".layer-toggle")||y(0,D=!1)}return[D,x,H,E,c,()=>H("exposure"),()=>H("activity"),()=>H("wind")]}class uy extends Mn{constructor(g){super(),Tn(this,g,hy,cy,Dn,{})}}function Pd(L,g,y){const x=L.slice();return x[6]=g[y],x[8]=y,x}function Ay(L){let g;return{c(){g=Je("div"),this.h()},l(y){g=je(y,"DIV",{class:!0}),ct(g).forEach(Qe),this.h()},h(){ye(g,"class","timeline-line svelte-ude4px"),Tr(g,"before-year",L[1][L[8]+1]==="year")},m(y,x){at(y,g,x)},p:Mi,d(y){y&&Qe(g)}}}function Ld(L){let g,y,x,D,H=gu[L[6]]+"",E,c,X,he,Ie;function fe(){return L[5](L[6])}let oe=L[8]<L[1].length-1&&Ay(L);return{c(){g=Je("button"),y=Je("span"),x=yt(),D=Je("span"),E=_i(H),c=yt(),oe&&oe.c(),X=Yr(),this.h()},l(Fe){g=je(Fe,"BUTTON",{class:!0,"aria-label":!0});var Ue=ct(g);y=je(Ue,"SPAN",{class:!0}),ct(y).forEach(Qe),x=mt(Ue),D=je(Ue,"SPAN",{class:!0});var Xe=ct(D);E=yi(Xe,H),Xe.forEach(Qe),Ue.forEach(Qe),c=mt(Fe),oe&&oe.l(Fe),X=Yr(),this.h()},h(){ye(y,"class","point-dot svelte-ude4px"),ye(D,"class","point-label svelte-ude4px"),ye(g,"class","timeline-point svelte-ude4px"),ye(g,"aria-label",gu[L[6]]),Tr(g,"active",L[0]===L[6]),Tr(g,"is-year",L[6]==="year")},m(Fe,Ue){at(Fe,g,Ue),Me(g,y),Me(g,x),Me(g,D),Me(D,E),at(Fe,c,Ue),oe&&oe.m(Fe,Ue),at(Fe,X,Ue),he||(Ie=Ci(g,"click",fe),he=!0)},p(Fe,Ue){L=Fe,Ue&3&&Tr(g,"active",L[0]===L[6]),L[8]<L[1].length-1&&oe.p(L,Ue)},d(Fe){Fe&&(Qe(g),Qe(c),Qe(X)),oe&&oe.d(Fe),he=!1,Ie()}}}function dy(L){let g,y,x,D,H=za(L[1]),E=[];for(let c=0;c<H.length;c+=1)E[c]=Ld(Pd(L,H,c));return{c(){g=Je("div"),y=Je("div");for(let c=0;c<E.length;c+=1)E[c].c();this.h()},l(c){g=je(c,"DIV",{class:!0,role:!0,"aria-label":!0,tabindex:!0});var X=ct(g);y=je(X,"DIV",{class:!0});var he=ct(y);for(let Ie=0;Ie<E.length;Ie+=1)E[Ie].l(he);he.forEach(Qe),X.forEach(Qe),this.h()},h(){ye(y,"class","timeline-track svelte-ude4px"),ye(g,"class","timeline-container svelte-ude4px"),ye(g,"role","group"),ye(g,"aria-label","Period selector"),ye(g,"tabindex","0")},m(c,X){at(c,g,X),Me(g,y);for(let he=0;he<E.length;he+=1)E[he]&&E[he].m(y,null);x||(D=Ci(g,"keydown",L[3]),x=!0)},p(c,[X]){if(X&7){H=za(c[1]);let he;for(he=0;he<H.length;he+=1){const Ie=Pd(c,H,he);E[he]?E[he].p(Ie,X):(E[he]=Ld(Ie),E[he].c(),E[he].m(y,null))}for(;he<E.length;he+=1)E[he].d(1);E.length=H.length}},i:Mi,o:Mi,d(c){c&&Qe(g),_h(E,c),x=!1,D()}}}function fy(L,g,y){let x,D;Pr(L,Lr,he=>y(4,D=he));const H=[1,2,3,4,5,6,7,8,9,10,11,12,"year"];function E(he){D.activeLayer==="wind"?Cp(he):xp(he)}function c(he){const Ie=H.indexOf(x);he.key==="ArrowLeft"&&Ie>0?E(H[Ie-1]):he.key==="ArrowRight"&&Ie<H.length-1&&E(H[Ie+1])}const X=he=>E(he);return L.$$.update=()=>{L.$$.dirty&16&&y(0,x=D.activeLayer==="wind"?D.windPeriod:D.lightningPeriod)},[x,H,E,c,D,X]}class gy extends Mn{constructor(g){super(),Tn(this,g,fy,dy,Dn,{})}}function Rd(L,g,y){const x=L.slice();x[8]=g[y];const D=my(x[8].angle,52);return x[9]=D,x}function Fd(L,g,y){const x=L.slice();return x[12]=g[y],x}function zd(L){let g,y=L[12].label+"",x,D,H,E;function c(){return L[6](L[12])}return{c(){g=Je("button"),x=_i(y),D=yt(),this.h()},l(X){g=je(X,"BUTTON",{class:!0});var he=ct(g);x=yi(he,y),D=mt(he),he.forEach(Qe),this.h()},h(){ye(g,"class","speed-btn svelte-da5d9s"),Tr(g,"active",L[0]===L[12].id)},m(X,he){at(X,g,he),Me(g,x),Me(g,D),H||(E=Ci(g,"click",c),H=!0)},p(X,he){L=X,he&3&&Tr(g,"active",L[0]===L[12].id)},d(X){X&&Qe(g),H=!1,E()}}}function Gd(L){let g,y=L[8].label+"",x,D,H,E;function c(){return L[7](L[8])}return{c(){g=Je("button"),x=_i(y),D=yt(),this.h()},l(X){g=je(X,"BUTTON",{class:!0,style:!0});var he=ct(g);x=yi(he,y),D=mt(he),he.forEach(Qe),this.h()},h(){ye(g,"class","dir-btn svelte-da5d9s"),bh(g,"transform","translate("+L[9].x+"px, "+L[9].y+"px)"),Tr(g,"active",L[0]===`dir_${L[8].id}`),Tr(g,"cardinal",L[8].id==="n"||L[8].id==="e"||L[8].id==="s"||L[8].id==="w")},m(X,he){at(X,g,he),Me(g,x),Me(g,D),H||(E=Ci(g,"click",c),H=!0)},p(X,he){L=X,he&5&&Tr(g,"active",L[0]===`dir_${L[8].id}`)},d(X){X&&Qe(g),H=!1,E()}}}function py(L){let g,y,x,D="Speed",H,E,c,X,he,Ie="Direction",fe,oe,Fe,Ue,Xe,et,st,Ne,He,$e,lt,Qt,ht,Gt,vt,Tt,bt=za(L[1]),_t=[];for(let Zt=0;Zt<bt.length;Zt+=1)_t[Zt]=zd(Fd(L,bt,Zt));let Vt=za(L[2]),Lt=[];for(let Zt=0;Zt<Vt.length;Zt+=1)Lt[Zt]=Gd(Rd(L,Vt,Zt));return{c(){g=Je("div"),y=Je("div"),x=Je("span"),x.textContent=D,H=yt(),E=Je("div");for(let Zt=0;Zt<_t.length;Zt+=1)_t[Zt].c();c=yt(),X=Je("div"),he=Je("span"),he.textContent=Ie,fe=yt(),oe=Je("div"),Fe=jr("svg"),Ue=jr("circle"),Xe=jr("circle"),et=jr("line"),st=jr("line"),Ne=jr("line"),He=jr("line"),$e=jr("line"),lt=jr("line"),Qt=jr("line"),ht=jr("line"),Gt=jr("polygon"),vt=jr("polygon"),Tt=yt();for(let Zt=0;Zt<Lt.length;Zt+=1)Lt[Zt].c();this.h()},l(Zt){g=je(Zt,"DIV",{class:!0});var wi=ct(g);y=je(wi,"DIV",{class:!0});var Mt=ct(y);x=je(Mt,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-pyx88c"&&(x.textContent=D),H=mt(Mt),E=je(Mt,"DIV",{class:!0});var Si=ct(E);for(let ui=0;ui<_t.length;ui+=1)_t[ui].l(Si);Si.forEach(Qe),Mt.forEach(Qe),c=mt(wi),X=je(wi,"DIV",{class:!0});var Ei=ct(X);he=je(Ei,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(he)!=="svelte-xaf52q"&&(he.textContent=Ie),fe=mt(Ei),oe=je(Ei,"DIV",{class:!0});var Qi=ct(oe);Fe=Hr(Qi,"svg",{class:!0,viewBox:!0});var oi=ct(Fe);Ue=Hr(oi,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0}),ct(Ue).forEach(Qe),Xe=Hr(oi,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0}),ct(Xe).forEach(Qe),et=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(et).forEach(Qe),st=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(st).forEach(Qe),Ne=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(Ne).forEach(Qe),He=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(He).forEach(Qe),$e=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct($e).forEach(Qe),lt=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(lt).forEach(Qe),Qt=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(Qt).forEach(Qe),ht=Hr(oi,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),ct(ht).forEach(Qe),Gt=Hr(oi,"polygon",{points:!0,fill:!0,opacity:!0}),ct(Gt).forEach(Qe),vt=Hr(oi,"polygon",{points:!0,fill:!0,opacity:!0}),ct(vt).forEach(Qe),oi.forEach(Qe),Tt=mt(Qi);for(let ui=0;ui<Lt.length;ui+=1)Lt[ui].l(Qi);Qi.forEach(Qe),Ei.forEach(Qe),wi.forEach(Qe),this.h()},h(){ye(x,"class","section-label svelte-da5d9s"),ye(E,"class","speed-buttons svelte-da5d9s"),ye(y,"class","speed-section svelte-da5d9s"),ye(he,"class","section-label svelte-da5d9s"),ye(Ue,"cx","50"),ye(Ue,"cy","50"),ye(Ue,"r","48"),ye(Ue,"fill","none"),ye(Ue,"stroke","#e5e7eb"),ye(Ue,"stroke-width","1"),ye(Xe,"cx","50"),ye(Xe,"cy","50"),ye(Xe,"r","20"),ye(Xe,"fill","none"),ye(Xe,"stroke","#e5e7eb"),ye(Xe,"stroke-width","1"),ye(et,"x1","50"),ye(et,"y1","8"),ye(et,"x2","50"),ye(et,"y2","30"),ye(et,"stroke","#d1d5db"),ye(et,"stroke-width","1.5"),ye(st,"x1","50"),ye(st,"y1","70"),ye(st,"x2","50"),ye(st,"y2","92"),ye(st,"stroke","#d1d5db"),ye(st,"stroke-width","1.5"),ye(Ne,"x1","8"),ye(Ne,"y1","50"),ye(Ne,"x2","30"),ye(Ne,"y2","50"),ye(Ne,"stroke","#d1d5db"),ye(Ne,"stroke-width","1.5"),ye(He,"x1","70"),ye(He,"y1","50"),ye(He,"x2","92"),ye(He,"y2","50"),ye(He,"stroke","#d1d5db"),ye(He,"stroke-width","1.5"),ye($e,"x1","20"),ye($e,"y1","20"),ye($e,"x2","32"),ye($e,"y2","32"),ye($e,"stroke","#e5e7eb"),ye($e,"stroke-width","1"),ye(lt,"x1","80"),ye(lt,"y1","20"),ye(lt,"x2","68"),ye(lt,"y2","32"),ye(lt,"stroke","#e5e7eb"),ye(lt,"stroke-width","1"),ye(Qt,"x1","20"),ye(Qt,"y1","80"),ye(Qt,"x2","32"),ye(Qt,"y2","68"),ye(Qt,"stroke","#e5e7eb"),ye(Qt,"stroke-width","1"),ye(ht,"x1","80"),ye(ht,"y1","80"),ye(ht,"x2","68"),ye(ht,"y2","68"),ye(ht,"stroke","#e5e7eb"),ye(ht,"stroke-width","1"),ye(Gt,"points","50,22 46,38 50,34 54,38"),ye(Gt,"fill","#2563eb"),ye(Gt,"opacity","0.6"),ye(vt,"points","50,78 46,62 50,66 54,62"),ye(vt,"fill","#94a3b8"),ye(vt,"opacity","0.4"),ye(Fe,"class","compass-rose svelte-da5d9s"),ye(Fe,"viewBox","0 0 100 100"),ye(oe,"class","compass-container svelte-da5d9s"),ye(X,"class","direction-section svelte-da5d9s"),ye(g,"class","wind-controls svelte-da5d9s")},m(Zt,wi){at(Zt,g,wi),Me(g,y),Me(y,x),Me(y,H),Me(y,E);for(let Mt=0;Mt<_t.length;Mt+=1)_t[Mt]&&_t[Mt].m(E,null);Me(g,c),Me(g,X),Me(X,he),Me(X,fe),Me(X,oe),Me(oe,Fe),Me(Fe,Ue),Me(Fe,Xe),Me(Fe,et),Me(Fe,st),Me(Fe,Ne),Me(Fe,He),Me(Fe,$e),Me(Fe,lt),Me(Fe,Qt),Me(Fe,ht),Me(Fe,Gt),Me(Fe,vt),Me(oe,Tt);for(let Mt=0;Mt<Lt.length;Mt+=1)Lt[Mt]&&Lt[Mt].m(oe,null)},p(Zt,[wi]){if(wi&11){bt=za(Zt[1]);let Mt;for(Mt=0;Mt<bt.length;Mt+=1){const Si=Fd(Zt,bt,Mt);_t[Mt]?_t[Mt].p(Si,wi):(_t[Mt]=zd(Si),_t[Mt].c(),_t[Mt].m(E,null))}for(;Mt<_t.length;Mt+=1)_t[Mt].d(1);_t.length=bt.length}if(wi&21){Vt=za(Zt[2]);let Mt;for(Mt=0;Mt<Vt.length;Mt+=1){const Si=Rd(Zt,Vt,Mt);Lt[Mt]?Lt[Mt].p(Si,wi):(Lt[Mt]=Gd(Si),Lt[Mt].c(),Lt[Mt].m(oe,null))}for(;Mt<Lt.length;Mt+=1)Lt[Mt].d(1);Lt.length=Vt.length}},i:Mi,o:Mi,d(Zt){Zt&&Qe(g),_h(_t,Zt),_h(Lt,Zt)}}}function my(L,g){const y=(L-90)*(Math.PI/180),x=Math.cos(y)*g,D=Math.sin(y)*g;return{x,y:D}}function yy(L,g,y){let x,D;Pr(L,Lr,fe=>y(5,D=fe));const H=[{id:"light",label:"Light"},{id:"moderate",label:"Moderate"},{id:"strong",label:"Strong"},{id:"storm",label:"Storm"},{id:"storm_detail",label:"Storm*"}],E=[{id:"n",label:"N",angle:0},{id:"ne",label:"NE",angle:45},{id:"e",label:"E",angle:90},{id:"se",label:"SE",angle:135},{id:"s",label:"S",angle:180},{id:"sw",label:"SW",angle:225},{id:"w",label:"W",angle:270},{id:"nw",label:"NW",angle:315}];function c(fe){od(fe)}function X(fe){od(`dir_${fe}`)}const he=fe=>c(fe.id),Ie=fe=>X(fe.id);return L.$$.update=()=>{L.$$.dirty&32&&y(0,x=D.windMetric)},[x,H,E,c,X,D,he,Ie]}class _y extends Mn{constructor(g){super(),Tn(this,g,yy,py,Dn,{})}}function Ud(L,g,y){const x=L.slice();return x[7]=g[y],x}function Nd(L){let g,y=L[7].label+"",x,D,H,E;function c(){return L[6](L[7])}return{c(){g=Je("button"),x=_i(y),D=yt(),this.h()},l(X){g=je(X,"BUTTON",{class:!0});var he=ct(g);x=yi(he,y),D=mt(he),he.forEach(Qe),this.h()},h(){ye(g,"class","source-btn svelte-fgqs3g"),Tr(g,"active",L[1]===L[7].id)},m(X,he){at(X,g,he),Me(g,x),Me(g,D),H||(E=Ci(g,"click",c),H=!0)},p(X,he){L=X,he&6&&Tr(g,"active",L[1]===L[7].id)},d(X){X&&Qe(g),H=!1,E()}}}function Od(L){let g,y='<div class="help-item svelte-fgqs3g"><strong class="svelte-fgqs3g">Satellite</strong> <p class="svelte-fgqs3g">Recent data from MTG Lightning Imager (Europe/Africa) and GOES GLM (Americas). High temporal resolution, fewer years of coverage.</p></div> <div class="help-item svelte-fgqs3g"><strong class="svelte-fgqs3g">WGLC</strong> <p class="svelte-fgqs3g">WWLLN Global Lightning Climatology. Long-term average (20102024) from a ground-based sensor network (WWLLN). Global coverage but detection efficiency varies regionally depending on station density.</p></div>';return{c(){g=Je("div"),g.innerHTML=y,this.h()},l(x){g=je(x,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1grkhl9"&&(g.innerHTML=y),this.h()},h(){ye(g,"class","help-popover svelte-fgqs3g")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function Iy(L){let g,y,x,D="Source",H,E,c="?",X,he,Ie,fe,oe,Fe=za(L[2]),Ue=[];for(let et=0;et<Fe.length;et+=1)Ue[et]=Nd(Ud(L,Fe,et));let Xe=L[0]&&Od();return{c(){g=Je("div"),y=Je("div"),x=Je("span"),x.textContent=D,H=yt(),E=Je("button"),E.textContent=c,X=yt(),he=Je("div");for(let et=0;et<Ue.length;et+=1)Ue[et].c();Ie=yt(),Xe&&Xe.c(),this.h()},l(et){g=je(et,"DIV",{class:!0});var st=ct(g);y=je(st,"DIV",{class:!0});var Ne=ct(y);x=je(Ne,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(x)!=="svelte-wd4n2w"&&(x.textContent=D),H=mt(Ne),E=je(Ne,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),Xt(E)!=="svelte-r19sdj"&&(E.textContent=c),Ne.forEach(Qe),X=mt(st),he=je(st,"DIV",{class:!0});var He=ct(he);for(let $e=0;$e<Ue.length;$e+=1)Ue[$e].l(He);He.forEach(Qe),Ie=mt(st),Xe&&Xe.l(st),st.forEach(Qe),this.h()},h(){ye(x,"class","section-label svelte-fgqs3g"),ye(E,"class","help-btn svelte-fgqs3g"),ye(E,"title","Learn about lightning sources"),ye(E,"aria-label","Help"),ye(y,"class","section-header svelte-fgqs3g"),ye(he,"class","source-buttons svelte-fgqs3g"),ye(g,"class","lightning-controls svelte-fgqs3g")},m(et,st){at(et,g,st),Me(g,y),Me(y,x),Me(y,H),Me(y,E),Me(g,X),Me(g,he);for(let Ne=0;Ne<Ue.length;Ne+=1)Ue[Ne]&&Ue[Ne].m(he,null);Me(g,Ie),Xe&&Xe.m(g,null),fe||(oe=[Ci(window,"click",L[4]),Ci(E,"click",_u(L[3]))],fe=!0)},p(et,[st]){if(st&6){Fe=za(et[2]);let Ne;for(Ne=0;Ne<Fe.length;Ne+=1){const He=Ud(et,Fe,Ne);Ue[Ne]?Ue[Ne].p(He,st):(Ue[Ne]=Nd(He),Ue[Ne].c(),Ue[Ne].m(he,null))}for(;Ne<Ue.length;Ne+=1)Ue[Ne].d(1);Ue.length=Fe.length}et[0]?Xe||(Xe=Od(),Xe.c(),Xe.m(g,null)):Xe&&(Xe.d(1),Xe=null)},i:Mi,o:Mi,d(et){et&&Qe(g),_h(Ue,et),Xe&&Xe.d(),fe=!1,la(oe)}}}function by(L,g,y){let x,D;Pr(L,Lr,Ie=>y(5,D=Ie));const H=[{id:"satellite",label:fu.satellite},{id:"wglc",label:fu.wglc}];let E=!1;function c(){y(0,E=!E)}function X(Ie){Ie.target.closest(".lightning-controls")||y(0,E=!1)}const he=Ie=>Bp(Ie.id);return L.$$.update=()=>{L.$$.dirty&32&&y(1,x=D.lightningSource)},[E,x,H,c,X,D,he]}class vy extends Mn{constructor(g){super(),Tn(this,g,by,Iy,Dn,{})}}function qd(L){let g,y,x,D,H,E="",c,X,he="Payment Successful!",Ie,fe,oe="Thank you for your purchase. Your plan is now active.",Fe,Ue,Xe="Continue",et,st;return{c(){g=Je("div"),y=Je("button"),x=yt(),D=Je("div"),H=Je("div"),H.textContent=E,c=yt(),X=Je("h2"),X.textContent=he,Ie=yt(),fe=Je("p"),fe.textContent=oe,Fe=yt(),Ue=Je("button"),Ue.textContent=Xe,this.h()},l(Ne){g=je(Ne,"DIV",{class:!0,role:!0,"aria-modal":!0});var He=ct(g);y=je(He,"BUTTON",{class:!0,type:!0,"aria-label":!0}),ct(y).forEach(Qe),x=mt(He),D=je(He,"DIV",{class:!0});var $e=ct(D);H=je($e,"DIV",{class:!0,"data-svelte-h":!0}),Xt(H)!=="svelte-ngli57"&&(H.textContent=E),c=mt($e),X=je($e,"H2",{class:!0,"data-svelte-h":!0}),Xt(X)!=="svelte-15d9u2n"&&(X.textContent=he),Ie=mt($e),fe=je($e,"P",{class:!0,"data-svelte-h":!0}),Xt(fe)!=="svelte-10hsw22"&&(fe.textContent=oe),Fe=mt($e),Ue=je($e,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(Ue)!=="svelte-ac5k3r"&&(Ue.textContent=Xe),$e.forEach(Qe),He.forEach(Qe),this.h()},h(){ye(y,"class","backdrop-dismiss svelte-177sfa8"),ye(y,"type","button"),ye(y,"aria-label","Close"),ye(H,"class","icon svelte-177sfa8"),ye(X,"class","svelte-177sfa8"),ye(fe,"class","svelte-177sfa8"),ye(Ue,"class","close-btn svelte-177sfa8"),ye(D,"class","modal svelte-177sfa8"),ye(g,"class","backdrop svelte-177sfa8"),ye(g,"role","dialog"),ye(g,"aria-modal","true")},m(Ne,He){at(Ne,g,He),Me(g,y),Me(g,x),Me(g,D),Me(D,H),Me(D,c),Me(D,X),Me(D,Ie),Me(D,fe),Me(D,Fe),Me(D,Ue),et||(st=[Ci(y,"click",L[1]),Ci(Ue,"click",L[1])],et=!0)},p:Mi,d(Ne){Ne&&Qe(g),et=!1,la(st)}}}function wy(L){let g,y=L[0]&&qd(L);return{c(){y&&y.c(),g=Yr()},l(x){y&&y.l(x),g=Yr()},m(x,D){y&&y.m(x,D),at(x,g,D)},p(x,[D]){x[0]?y?y.p(x,D):(y=qd(x),y.c(),y.m(g.parentNode,g)):y&&(y.d(1),y=null)},i:Mi,o:Mi,d(x){x&&Qe(g),y&&y.d(x)}}}function xy(L,g,y){let x;Pr(L,cp,E=>y(3,x=E));let D=!1;Ih(()=>{const E=x.url.searchParams.get("billing");if(x.url.searchParams.get("session_id"),E==="success"){y(0,D=!0);const c=new URL(window.location.href);c.searchParams.delete("billing"),c.searchParams.delete("session_id"),window.history.replaceState({},"",c.pathname)}});function H(){y(0,D=!1)}return[D,H]}class By extends Mn{constructor(g){super(),Tn(this,g,xy,wy,Dn,{})}}function Vd(L){let g,y,x,D,H,E="",c,X,he;function Ie(Fe,Ue){return Fe[0]?Cy:Ey}let fe=Ie(L),oe=fe(L);return{c(){g=Je("div"),y=Je("button"),x=yt(),D=Je("div"),H=Je("button"),H.textContent=E,c=yt(),oe.c(),this.h()},l(Fe){g=je(Fe,"DIV",{class:!0,role:!0,"aria-modal":!0});var Ue=ct(g);y=je(Ue,"BUTTON",{class:!0,type:!0,"aria-label":!0}),ct(y).forEach(Qe),x=mt(Ue),D=je(Ue,"DIV",{class:!0});var Xe=ct(D);H=je(Xe,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(H)!=="svelte-moq3tb"&&(H.textContent=E),c=mt(Xe),oe.l(Xe),Xe.forEach(Qe),Ue.forEach(Qe),this.h()},h(){ye(y,"class","backdrop-dismiss svelte-1snuf20"),ye(y,"type","button"),ye(y,"aria-label","Close"),ye(H,"class","close-btn svelte-1snuf20"),ye(D,"class","modal svelte-1snuf20"),ye(g,"class","backdrop svelte-1snuf20"),ye(g,"role","dialog"),ye(g,"aria-modal","true")},m(Fe,Ue){at(Fe,g,Ue),Me(g,y),Me(g,x),Me(g,D),Me(D,H),Me(D,c),oe.m(D,null),X||(he=[Ci(y,"click",L[6]),Ci(H,"click",L[5])],X=!0)},p(Fe,Ue){fe===(fe=Ie(Fe))&&oe?oe.p(Fe,Ue):(oe.d(1),oe=fe(Fe),oe&&(oe.c(),oe.m(D,null)))},d(Fe){Fe&&Qe(g),oe.d(),X=!1,la(he)}}}function Cy(L){let g,y="",x,D,H="You've left your free zone",E,c,X,he,Ie,fe="Your current access:",oe,Fe,Ue,Xe,et,st=L[2].name+"",Ne,He,$e,lt,Qt=L[2].radiusKm+"",ht,Gt,vt,Tt,bt="Worldwide overview map",_t,Vt,Lt='<div class="section-title svelte-1snuf20">With a subscription you get:</div> <ul class="svelte-1snuf20"><li class="svelte-1snuf20">Worldwide access without restrictions</li> <li class="svelte-1snuf20">Exposure layer (topographic shielding)</li> <li class="svelte-1snuf20">Activity layer (lightning frequency)</li></ul>',Zt,wi,Mt="Find sheltered anchorages, campsites & more.",Si,Ei,Qi="View Plans",oi,ui,br="Maybe later",Jt,ei;return{c(){g=Je("div"),g.textContent=y,x=yt(),D=Je("h2"),D.textContent=H,E=yt(),c=Je("div"),X=yt(),he=Je("div"),Ie=Je("div"),Ie.textContent=fe,oe=yt(),Fe=Je("ul"),Ue=Je("li"),Xe=_i("Detail view around "),et=Je("strong"),Ne=_i(st),He=yt(),$e=Je("li"),lt=_i("~"),ht=_i(Qt),Gt=_i(" km radius at full resolution"),vt=yt(),Tt=Je("li"),Tt.textContent=bt,_t=yt(),Vt=Je("div"),Vt.innerHTML=Lt,Zt=yt(),wi=Je("div"),wi.textContent=Mt,Si=yt(),Ei=Je("button"),Ei.textContent=Qi,oi=yt(),ui=Je("button"),ui.textContent=br,this.h()},l(Yt){g=je(Yt,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-a17grk"&&(g.textContent=y),x=mt(Yt),D=je(Yt,"H2",{class:!0,"data-svelte-h":!0}),Xt(D)!=="svelte-9m3c6v"&&(D.textContent=H),E=mt(Yt),c=je(Yt,"DIV",{class:!0}),ct(c).forEach(Qe),X=mt(Yt),he=je(Yt,"DIV",{class:!0});var ii=ct(he);Ie=je(ii,"DIV",{class:!0,"data-svelte-h":!0}),Xt(Ie)!=="svelte-1nxo6uz"&&(Ie.textContent=fe),oe=mt(ii),Fe=je(ii,"UL",{class:!0});var di=ct(Fe);Ue=je(di,"LI",{class:!0});var ki=ct(Ue);Xe=yi(ki,"Detail view around "),et=je(ki,"STRONG",{class:!0});var vr=ct(et);Ne=yi(vr,st),vr.forEach(Qe),ki.forEach(Qe),He=mt(di),$e=je(di,"LI",{class:!0});var yr=ct($e);lt=yi(yr,"~"),ht=yi(yr,Qt),Gt=yi(yr," km radius at full resolution"),yr.forEach(Qe),vt=mt(di),Tt=je(di,"LI",{class:!0,"data-svelte-h":!0}),Xt(Tt)!=="svelte-1cyig4w"&&(Tt.textContent=bt),di.forEach(Qe),ii.forEach(Qe),_t=mt(Yt),Vt=je(Yt,"DIV",{class:!0,"data-svelte-h":!0}),Xt(Vt)!=="svelte-pkukma"&&(Vt.innerHTML=Lt),Zt=mt(Yt),wi=je(Yt,"DIV",{class:!0,"data-svelte-h":!0}),Xt(wi)!=="svelte-18m8cjy"&&(wi.textContent=Mt),Si=mt(Yt),Ei=je(Yt,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(Ei)!=="svelte-845pxc"&&(Ei.textContent=Qi),oi=mt(Yt),ui=je(Yt,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(ui)!=="svelte-km0892"&&(ui.textContent=br),this.h()},h(){ye(g,"class","icon svelte-1snuf20"),ye(D,"class","svelte-1snuf20"),ye(c,"class","divider svelte-1snuf20"),ye(Ie,"class","section-title svelte-1snuf20"),ye(et,"class","svelte-1snuf20"),ye(Ue,"class","svelte-1snuf20"),ye($e,"class","svelte-1snuf20"),ye(Tt,"class","svelte-1snuf20"),ye(Fe,"class","svelte-1snuf20"),ye(he,"class","section svelte-1snuf20"),ye(Vt,"class","section svelte-1snuf20"),ye(wi,"class","hint svelte-1snuf20"),ye(Ei,"class","primary-btn svelte-1snuf20"),ye(ui,"class","secondary-btn svelte-1snuf20")},m(Yt,ii){at(Yt,g,ii),at(Yt,x,ii),at(Yt,D,ii),at(Yt,E,ii),at(Yt,c,ii),at(Yt,X,ii),at(Yt,he,ii),Me(he,Ie),Me(he,oe),Me(he,Fe),Me(Fe,Ue),Me(Ue,Xe),Me(Ue,et),Me(et,Ne),Me(Fe,He),Me(Fe,$e),Me($e,lt),Me($e,ht),Me($e,Gt),Me(Fe,vt),Me(Fe,Tt),at(Yt,_t,ii),at(Yt,Vt,ii),at(Yt,Zt,ii),at(Yt,wi,ii),at(Yt,Si,ii),at(Yt,Ei,ii),at(Yt,oi,ii),at(Yt,ui,ii),Jt||(ei=[Ci(Ei,"click",L[4]),Ci(ui,"click",L[5])],Jt=!0)},p(Yt,ii){ii&4&&st!==(st=Yt[2].name+"")&&mr(Ne,st),ii&4&&Qt!==(Qt=Yt[2].radiusKm+"")&&mr(ht,Qt)},d(Yt){Yt&&(Qe(g),Qe(x),Qe(D),Qe(E),Qe(c),Qe(X),Qe(he),Qe(_t),Qe(Vt),Qe(Zt),Qe(wi),Qe(Si),Qe(Ei),Qe(oi),Qe(ui)),Jt=!1,la(ei)}}}function Ey(L){let g,y="",x,D,H="Login to continue exploring",E,c,X,he,Ie,fe="Create a free account to:",oe,Fe,Ue,Xe,et,st=L[2].name+"",Ne,He,$e,lt,Qt,ht=L[2].radiusKm+"",Gt,vt,Tt,bt,_t="Browse the worldwide overview map",Vt,Lt,Zt="Sign up in seconds - no credit card required.",wi,Mt,Si="Login / Sign Up",Ei,Qi,oi="View Premium Plans",ui,br;return{c(){g=Je("div"),g.textContent=y,x=yt(),D=Je("h2"),D.textContent=H,E=yt(),c=Je("div"),X=yt(),he=Je("div"),Ie=Je("div"),Ie.textContent=fe,oe=yt(),Fe=Je("ul"),Ue=Je("li"),Xe=_i("Explore the "),et=Je("strong"),Ne=_i(st),He=_i(" area in detail"),$e=yt(),lt=Je("li"),Qt=_i("Access ~"),Gt=_i(ht),vt=_i(" km radius at full resolution"),Tt=yt(),bt=Je("li"),bt.textContent=_t,Vt=yt(),Lt=Je("div"),Lt.textContent=Zt,wi=yt(),Mt=Je("button"),Mt.textContent=Si,Ei=yt(),Qi=Je("button"),Qi.textContent=oi,this.h()},l(Jt){g=je(Jt,"DIV",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-cpufnf"&&(g.textContent=y),x=mt(Jt),D=je(Jt,"H2",{class:!0,"data-svelte-h":!0}),Xt(D)!=="svelte-wdu9uv"&&(D.textContent=H),E=mt(Jt),c=je(Jt,"DIV",{class:!0}),ct(c).forEach(Qe),X=mt(Jt),he=je(Jt,"DIV",{class:!0});var ei=ct(he);Ie=je(ei,"DIV",{class:!0,"data-svelte-h":!0}),Xt(Ie)!=="svelte-s61fmm"&&(Ie.textContent=fe),oe=mt(ei),Fe=je(ei,"UL",{class:!0});var Yt=ct(Fe);Ue=je(Yt,"LI",{class:!0});var ii=ct(Ue);Xe=yi(ii,"Explore the "),et=je(ii,"STRONG",{class:!0});var di=ct(et);Ne=yi(di,st),di.forEach(Qe),He=yi(ii," area in detail"),ii.forEach(Qe),$e=mt(Yt),lt=je(Yt,"LI",{class:!0});var ki=ct(lt);Qt=yi(ki,"Access ~"),Gt=yi(ki,ht),vt=yi(ki," km radius at full resolution"),ki.forEach(Qe),Tt=mt(Yt),bt=je(Yt,"LI",{class:!0,"data-svelte-h":!0}),Xt(bt)!=="svelte-95uw7v"&&(bt.textContent=_t),Yt.forEach(Qe),ei.forEach(Qe),Vt=mt(Jt),Lt=je(Jt,"DIV",{class:!0,"data-svelte-h":!0}),Xt(Lt)!=="svelte-kcsnju"&&(Lt.textContent=Zt),wi=mt(Jt),Mt=je(Jt,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(Mt)!=="svelte-ymaevt"&&(Mt.textContent=Si),Ei=mt(Jt),Qi=je(Jt,"BUTTON",{class:!0,"data-svelte-h":!0}),Xt(Qi)!=="svelte-11d8v2t"&&(Qi.textContent=oi),this.h()},h(){ye(g,"class","icon svelte-1snuf20"),ye(D,"class","svelte-1snuf20"),ye(c,"class","divider svelte-1snuf20"),ye(Ie,"class","section-title svelte-1snuf20"),ye(et,"class","svelte-1snuf20"),ye(Ue,"class","svelte-1snuf20"),ye(lt,"class","svelte-1snuf20"),ye(bt,"class","svelte-1snuf20"),ye(Fe,"class","svelte-1snuf20"),ye(he,"class","section svelte-1snuf20"),ye(Lt,"class","hint svelte-1snuf20"),ye(Mt,"class","primary-btn svelte-1snuf20"),ye(Qi,"class","secondary-btn svelte-1snuf20")},m(Jt,ei){at(Jt,g,ei),at(Jt,x,ei),at(Jt,D,ei),at(Jt,E,ei),at(Jt,c,ei),at(Jt,X,ei),at(Jt,he,ei),Me(he,Ie),Me(he,oe),Me(he,Fe),Me(Fe,Ue),Me(Ue,Xe),Me(Ue,et),Me(et,Ne),Me(Ue,He),Me(Fe,$e),Me(Fe,lt),Me(lt,Qt),Me(lt,Gt),Me(lt,vt),Me(Fe,Tt),Me(Fe,bt),at(Jt,Vt,ei),at(Jt,Lt,ei),at(Jt,wi,ei),at(Jt,Mt,ei),at(Jt,Ei,ei),at(Jt,Qi,ei),ui||(br=[Ci(Mt,"click",L[3]),Ci(Qi,"click",L[4])],ui=!0)},p(Jt,ei){ei&4&&st!==(st=Jt[2].name+"")&&mr(Ne,st),ei&4&&ht!==(ht=Jt[2].radiusKm+"")&&mr(Gt,ht)},d(Jt){Jt&&(Qe(g),Qe(x),Qe(D),Qe(E),Qe(c),Qe(X),Qe(he),Qe(Vt),Qe(Lt),Qe(wi),Qe(Mt),Qe(Ei),Qe(Qi)),ui=!1,la(br)}}}function Qy(L){let g,y=L[1]&&Vd(L);return{c(){y&&y.c(),g=Yr()},l(x){y&&y.l(x),g=Yr()},m(x,D){y&&y.m(x,D),at(x,g,D)},p(x,[D]){x[1]?y?y.p(x,D):(y=Vd(x),y.c(),y.m(g.parentNode,g)):y&&(y.d(1),y=null)},i:Mi,o:Mi,d(x){x&&Qe(g),y&&y.d(x)}}}function ky(L,g,y){let x,D,H;Pr(L,Nl,Ie=>y(0,x=Ie)),Pr(L,gc,Ie=>y(1,D=Ie)),Pr(L,Hc,Ie=>y(2,H=Ie));function E(){gc.set(!1),window.dispatchEvent(new CustomEvent("open-auth-modal"))}function c(){typeof window<"u"&&window.gtag&&window.gtag("event","view_premium_plans_click",{user_state:x?"logged_in":"anonymous"}),gc.set(!1),window.dispatchEvent(new CustomEvent("open-billing-modal"))}function X(){gc.set(!1)}function he(){gc.set(!1)}return[x,D,H,E,c,X,he]}class Sy extends Mn{constructor(g){super(),Tn(this,g,ky,Qy,Dn,{})}}function Hd(L,{delay:g=0,duration:y=400,easing:x=sp}={}){const D=+getComputedStyle(L).opacity;return{delay:g,duration:y,easing:x,css:H=>`opacity: ${H*D}`}}function jd(L){let g,y,x="",D,H,E;function c(Ie,fe){return Ie[1]?Dy:My}let X=c(L),he=X(L);return{c(){g=Je("div"),y=Je("span"),y.textContent=x,D=yt(),he.c(),this.h()},l(Ie){g=je(Ie,"DIV",{class:!0});var fe=ct(g);y=je(fe,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(y)!=="svelte-1xc37j3"&&(y.textContent=x),D=mt(fe),he.l(fe),fe.forEach(Qe),this.h()},h(){ye(y,"class","icon svelte-d8da0u"),ye(g,"class","toast svelte-d8da0u")},m(Ie,fe){at(Ie,g,fe),Me(g,y),Me(g,D),he.m(g,null),E=!0},p(Ie,fe){X!==(X=c(Ie))&&(he.d(1),he=X(Ie),he&&(he.c(),he.m(g,null)))},i(Ie){E||(Ie&&ap(()=>{E&&(H||(H=ad(g,Hd,{duration:200},!0)),H.run(1))}),E=!0)},o(Ie){Ie&&(H||(H=ad(g,Hd,{duration:200},!1)),H.run(0)),E=!1},d(Ie){Ie&&Qe(g),he.d(),Ie&&H&&H.end()}}}function Dy(L){let g,y="This area requires a subscription";return{c(){g=Je("span"),g.textContent=y,this.h()},l(x){g=je(x,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-1eg0wtp"&&(g.textContent=y),this.h()},h(){ye(g,"class","message svelte-d8da0u")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function My(L){let g,y="Login to explore beyond the free zone";return{c(){g=Je("span"),g.textContent=y,this.h()},l(x){g=je(x,"SPAN",{class:!0,"data-svelte-h":!0}),Xt(g)!=="svelte-141ga3v"&&(g.textContent=y),this.h()},h(){ye(g,"class","message svelte-d8da0u")},m(x,D){at(x,g,D)},d(x){x&&Qe(g)}}}function Ty(L){let g,y=L[0]&&jd(L);return{c(){y&&y.c(),g=Yr()},l(x){y&&y.l(x),g=Yr()},m(x,D){y&&y.m(x,D),at(x,g,D)},p(x,[D]){x[0]?y?(y.p(x,D),D&1&&$i(y,1)):(y=jd(x),y.c(),$i(y,1),y.m(g.parentNode,g)):y&&(ph(),pr(y,1,1,()=>{y=null}),mh())},i(x){$i(y)},o(x){pr(y)},d(x){x&&Qe(g),y&&y.d(x)}}}function Py(L,g,y){let x,D;return Pr(L,yu,H=>y(0,x=H)),Pr(L,Nl,H=>y(1,D=H)),[x,D]}class Ly extends Mn{constructor(g){super(),Tn(this,g,Py,Ty,Dn,{})}}function Jd(L){let g,y;return g=new gy({}),{c(){$n(g.$$.fragment)},l(x){Zn(g.$$.fragment,x)},m(x,D){Kn(g,x,D),y=!0},i(x){y||($i(g.$$.fragment,x),y=!0)},o(x){pr(g.$$.fragment,x),y=!1},d(x){Yn(g,x)}}}function Yd(L){let g,y,x;return y=new vy({}),{c(){g=Je("div"),$n(y.$$.fragment),this.h()},l(D){g=je(D,"DIV",{class:!0});var H=ct(g);Zn(y.$$.fragment,H),H.forEach(Qe),this.h()},h(){ye(g,"class","lightning-controls-wrapper svelte-14j9tx5")},m(D,H){at(D,g,H),Kn(y,g,null),x=!0},i(D){x||($i(y.$$.fragment,D),x=!0)},o(D){pr(y.$$.fragment,D),x=!1},d(D){D&&Qe(g),Yn(y)}}}function Kd(L){let g,y,x;return y=new _y({}),{c(){g=Je("div"),$n(y.$$.fragment),this.h()},l(D){g=je(D,"DIV",{class:!0});var H=ct(g);Zn(y.$$.fragment,H),H.forEach(Qe),this.h()},h(){ye(g,"class","wind-controls-wrapper svelte-14j9tx5")},m(D,H){at(D,g,H),Kn(y,g,null),x=!0},i(D){x||($i(y.$$.fragment,D),x=!0)},o(D){pr(y.$$.fragment,D),x=!1},d(D){D&&Qe(g),Yn(y)}}}function Ry(L){let g,y,x,D,H,E,c,X,he,Ie,fe,oe,Fe,Ue,Xe,et,st,Ne,He,$e,lt,Qt,ht,Gt;x=new ly({}),H=new Cm({props:{mapTilerKey:fp}}),c=new zm({}),Ie=new uy({}),oe=new Nm({}),Ue=new Lm({});let vt=(L[0].activeLayer==="activity"||L[0].activeLayer==="wind")&&Jd(),Tt=L[0].activeLayer==="activity"&&Yd(),bt=L[0].activeLayer==="wind"&&Kd();return He=new By({}),lt=new Sy({}),ht=new Ly({}),{c(){g=yt(),y=Je("div"),$n(x.$$.fragment),D=yt(),$n(H.$$.fragment),E=yt(),$n(c.$$.fragment),X=yt(),he=Je("div"),$n(Ie.$$.fragment),fe=yt(),$n(oe.$$.fragment),Fe=yt(),$n(Ue.$$.fragment),Xe=yt(),vt&&vt.c(),et=yt(),Tt&&Tt.c(),st=yt(),bt&&bt.c(),Ne=yt(),$n(He.$$.fragment),$e=yt(),$n(lt.$$.fragment),Qt=yt(),$n(ht.$$.fragment),this.h()},l(_t){lp("svelte-1wptagv",document.head).forEach(Qe),g=mt(_t),y=je(_t,"DIV",{class:!0});var Lt=ct(y);Zn(x.$$.fragment,Lt),D=mt(Lt),Zn(H.$$.fragment,Lt),E=mt(Lt),Zn(c.$$.fragment,Lt),X=mt(Lt),he=je(Lt,"DIV",{class:!0});var Zt=ct(he);Zn(Ie.$$.fragment,Zt),Zt.forEach(Qe),fe=mt(Lt),Zn(oe.$$.fragment,Lt),Fe=mt(Lt),Zn(Ue.$$.fragment,Lt),Xe=mt(Lt),vt&&vt.l(Lt),et=mt(Lt),Tt&&Tt.l(Lt),st=mt(Lt),bt&&bt.l(Lt),Lt.forEach(Qe),Ne=mt(_t),Zn(He.$$.fragment,_t),$e=mt(_t),Zn(lt.$$.fragment,_t),Qt=mt(_t),Zn(ht.$$.fragment,_t),this.h()},h(){document.title="IncusGrid - Lightning Risk Map",ye(he,"class","controls-left svelte-14j9tx5"),ye(y,"class","app svelte-14j9tx5")},m(_t,Vt){at(_t,g,Vt),at(_t,y,Vt),Kn(x,y,null),Me(y,D),Kn(H,y,null),Me(y,E),Kn(c,y,null),Me(y,X),Me(y,he),Kn(Ie,he,null),Me(y,fe),Kn(oe,y,null),Me(y,Fe),Kn(Ue,y,null),Me(y,Xe),vt&&vt.m(y,null),Me(y,et),Tt&&Tt.m(y,null),Me(y,st),bt&&bt.m(y,null),at(_t,Ne,Vt),Kn(He,_t,Vt),at(_t,$e,Vt),Kn(lt,_t,Vt),at(_t,Qt,Vt),Kn(ht,_t,Vt),Gt=!0},p(_t,[Vt]){_t[0].activeLayer==="activity"||_t[0].activeLayer==="wind"?vt?Vt&1&&$i(vt,1):(vt=Jd(),vt.c(),$i(vt,1),vt.m(y,et)):vt&&(ph(),pr(vt,1,1,()=>{vt=null}),mh()),_t[0].activeLayer==="activity"?Tt?Vt&1&&$i(Tt,1):(Tt=Yd(),Tt.c(),$i(Tt,1),Tt.m(y,st)):Tt&&(ph(),pr(Tt,1,1,()=>{Tt=null}),mh()),_t[0].activeLayer==="wind"?bt?Vt&1&&$i(bt,1):(bt=Kd(),bt.c(),$i(bt,1),bt.m(y,null)):bt&&(ph(),pr(bt,1,1,()=>{bt=null}),mh())},i(_t){Gt||($i(x.$$.fragment,_t),$i(H.$$.fragment,_t),$i(c.$$.fragment,_t),$i(Ie.$$.fragment,_t),$i(oe.$$.fragment,_t),$i(Ue.$$.fragment,_t),$i(vt),$i(Tt),$i(bt),$i(He.$$.fragment,_t),$i(lt.$$.fragment,_t),$i(ht.$$.fragment,_t),Gt=!0)},o(_t){pr(x.$$.fragment,_t),pr(H.$$.fragment,_t),pr(c.$$.fragment,_t),pr(Ie.$$.fragment,_t),pr(oe.$$.fragment,_t),pr(Ue.$$.fragment,_t),pr(vt),pr(Tt),pr(bt),pr(He.$$.fragment,_t),pr(lt.$$.fragment,_t),pr(ht.$$.fragment,_t),Gt=!1},d(_t){_t&&(Qe(g),Qe(y),Qe(Ne),Qe($e),Qe(Qt)),Yn(x),Yn(H),Yn(c),Yn(Ie),Yn(oe),Yn(Ue),vt&&vt.d(),Tt&&Tt.d(),bt&&bt.d(),Yn(He,_t),Yn(lt,_t),Yn(ht,_t)}}}function Fy(L,g,y){let x;return Pr(L,Lr,D=>y(0,x=D)),Ih(async()=>{await pm()}),[x]}class Vy extends Mn{constructor(g){super(),Tn(this,g,Fy,Ry,Dn,{})}}export{Vy as component};
