var $g=Object.defineProperty;var Wg=(L,p,y)=>p in L?$g(L,p,{enumerable:!0,configurable:!0,writable:!0,value:y}):L[p]=y;var yn=(L,p,y)=>Wg(L,typeof p!="symbol"?p+"":p,y);import{r as Fa,y as Hn,s as jn,n as Li,c as Hr,o as mh,z as qd,e as cu,A as id,f as Xg,h as ep}from"../chunks/CSkVN5vT.js";import{l as Ar,S as Jn,i as Yn,d as De,a as ot,w as ye,c as je,e as dt,h as Je,b as Te,g as bt,j as wt,s as Ir,f as Bi,t as Ci,x as yh,y as ti,o as jr,z as Ti,A as Vd,B as pc,C as tp,D as Or,E as qr,F as an,G as rd,q as gs,k as Mr,u as ps,v as ms,r as ys,H as hu,m as uu,n as Au,I as nd,J as ip}from"../chunks/CeV1JoeD.js";import{d as Hd,w as za}from"../chunks/9FCY9KVv.js";import{p as rp}from"../chunks/DwlrAuyN.js";function $o(L){return(L==null?void 0:L.length)!==void 0?L:Array.from(L)}function np(L,p){L.d(1),p.delete(L.key)}function sp(L,p,y,B,T,J,Q,c,ne,fe,xe,me){let he=L.length,Ue=J.length,Ze=he;const nt={};for(;Ze--;)nt[L[Ze].key]=Ze;const it=[],at=new Map,Ye=new Map,$e=[];for(Ze=Ue;Ze--;){const yt=me(T,J,Ze),Pt=y(yt);let Ft=Q.get(Pt);Ft?$e.push(()=>Ft.p(yt,p)):(Ft=fe(Pt,yt),Ft.c()),at.set(Pt,it[Ze]=Ft),Pt in nt&&Ye.set(Pt,Math.abs(Ze-nt[Pt]))}const Xe=new Set,lt=new Set;function Bt(yt){Ar(yt,1),yt.m(c,xe),Q.set(yt.key,yt),xe=yt.first,Ue--}for(;he&&Ue;){const yt=it[Ue-1],Pt=L[he-1],Ft=yt.key,gt=Pt.key;yt===Pt?(xe=yt.first,he--,Ue--):at.has(gt)?!Q.has(Ft)||Xe.has(Ft)?Bt(yt):lt.has(gt)?he--:Ye.get(Ft)>Ye.get(gt)?(lt.add(Ft),Bt(yt)):(Xe.add(gt),he--):(ne(Pt,Q),he--)}for(;he--;){const yt=L[he];at.has(yt.key)||ne(yt,Q)}for(;Ue;)Bt(it[Ue-1]);return Fa($e),it}var jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ap(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}var Jd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(L,p){(function(y,B){L.exports=B()})(jd,function(){var y={},B={};function T(Q,c,ne){if(B[Q]=ne,Q==="index"){var fe="var sharedModule = {}; ("+B.shared+")(sharedModule); ("+B.worker+")(sharedModule);",xe={};return B.shared(xe),B.index(y,xe),typeof window<"u"&&y.setWorkerUrl(window.URL.createObjectURL(new Blob([fe],{type:"text/javascript"}))),y}}T("shared",["exports"],function(Q){function c(i,t,r,s){return new(r||(r=Promise))(function(l,d){function f(E){try{b(s.next(E))}catch(D){d(D)}}function _(E){try{b(s.throw(E))}catch(D){d(D)}}function b(E){var D;E.done?l(E.value):(D=E.value,D instanceof r?D:new r(function(R){R(D)})).then(f,_)}b((s=s.apply(i,t||[])).next())})}function ne(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var fe=xe;function xe(i,t){this.x=i,this.y=t}xe.prototype={clone:function(){return new xe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,t){var r=Math.cos(i),s=Math.sin(i),l=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},xe.convert=function(i){return i instanceof xe?i:Array.isArray(i)?new xe(i[0],i[1]):i};var me=ne(fe),he=Ue;function Ue(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}Ue.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,_=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ze=ne(he);let nt,it;function at(){return nt==null&&(nt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),nt}function Ye(){if(it==null&&(it=!1,at())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const l=4*s;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){it=!0;break}}}return it||!1}function $e(i,t,r,s){const l=new Ze(i,t,r,s);return d=>l.solve(d)}const Xe=$e(.25,.1,.25,1);function lt(i,t,r){return Math.min(r,Math.max(t,i))}function Bt(i,t,r){const s=r-t,l=((i-t)%s+s)%s+t;return l===t?r:l}function yt(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let Pt=1;function Ft(i,t,r){const s={};for(const l in i)s[l]=t.call(this,i[l],l,i);return s}function gt(i,t,r){const s={};for(const l in i)t.call(this,i[l],l,i)&&(s[l]=i[l]);return s}function Qt(i){return Array.isArray(i)?i.map(Qt):typeof i=="object"&&i?Ft(i,Qt):i}const Tt={};function Ot(i){Tt[i]||(typeof console<"u"&&console.warn(i),Tt[i]=!0)}function Yt(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Kt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let li=null;function pt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function si(i,t,r,s,l){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(i,{timestamp:0});try{const f=d==null?void 0:d.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const _=f.startsWith("BGR"),b=new Uint8ClampedArray(s*l*4);if(yield d.copyTo(b,function(E,D,R,O,Y){const W=4*Math.max(-D,0),X=(Math.max(0,R)-R)*O*4+W,pe=4*O,be=Math.max(0,D),Re=Math.max(0,R);return{rect:{x:be,y:Re,width:Math.min(E.width,D+O)-be,height:Math.min(E.height,R+Y)-Re},layout:[{offset:X,stride:pe}]}}(i,t,r,s,l)),_)for(let E=0;E<b.length;E+=4){const D=b[E];b[E]=b[E+2],b[E+2]=D}return b}finally{d.close()}})}let ci,ai;const Ai="AbortError";function lr(){return new Error(Ai)}const Ht={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ei(i){return Ht.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Zt="global-dispatcher";class ri extends Error{constructor(t,r,s,l){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=l}}const mi=()=>Kt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ki=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=ei(i.url);if(s)return s(i,t);if(Kt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Zt},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(mi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,l){return c(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:mi(),signal:l.signal});s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");const f=yield fetch(d);if(!f.ok){const E=yield f.blob();throw new ri(f.status,f.statusText,s.url,E)}let _;_=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const b=yield _;if(l.signal.aborted)throw lr();return{data:b,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})}(i,t);if(Kt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Zt},t)}var r;return function(s,l){return new Promise((d,f)=>{var _;const b=new XMLHttpRequest;b.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(b.responseType="arraybuffer");for(const E in s.headers)b.setRequestHeader(E,s.headers[E]);s.type==="json"&&(b.responseType="text",!((_=s.headers)===null||_===void 0)&&_.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=s.credentials==="include",b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if(!l.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let E=b.response;if(s.type==="json")try{E=JSON.parse(b.response)}catch(D){return void f(D)}d({data:E,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const E=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});f(new ri(b.status,b.statusText,s.url,E))}},l.signal.addEventListener("abort",()=>{b.abort(),f(lr())}),b.send(s.body)})}(i,t)};function br(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function mr(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function $i(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class Ii{constructor(t,r={}){yt(this,r),this.type=t}}class zi extends Ii{constructor(t,r={}){super("error",yt({error:t},r))}}class Xi{on(t,r){return this._listeners=this._listeners||{},mr(t,r,this._listeners),this}off(t,r){return $i(t,r,this._listeners),$i(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mr(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new Ii(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of l)_.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of d)$i(s,_,this._oneTimeListeners),_.call(this,t);const f=this._eventedParent;f&&(yt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof zi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Ne={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Dn(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return cr.forEach(s=>{s in t&&(r[s]=t[s])}),r}function pi(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!pi(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!pi(i[r],t[r]))return!1;return!0}return i===t}function Gi(i,t){i.push(t)}function Kn(i,t,r){Gi(r,{command:"addSource",args:[i,t[i]]})}function wr(i,t,r){Gi(t,{command:"removeSource",args:[i]}),r[i]=!0}function Jr(i,t,r,s){wr(i,r,s),Kn(i,t,r)}function la(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!pi(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!pi(i[r][s],t[r][s]))return!1;return!0}function ln(i,t,r,s,l,d){i=i||{},t=t||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(pi(i[f],t[f])||r.push({command:d,args:[s,f,t[f],l]}));for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(pi(i[f],t[f])||r.push({command:d,args:[s,f,t[f],l]}))}function Ts(i){return i.id}function ca(i,t){return i[t.id]=t,i}class ft{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Mn(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class vr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Tn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new Tn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const cn={kind:"null"},ut={kind:"number"},di={kind:"string"},Wt={kind:"boolean"},Xt={kind:"color"},hn={kind:"object"},oi={kind:"value"},Pn={kind:"collator"},Ln={kind:"formatted"},Zn={kind:"padding"},_n={kind:"resolvedImage"},_e={kind:"variableAnchorOffsetCollection"};function j(i,t){return{kind:"array",itemType:i,N:t}}function H(i){if(i.kind==="array"){const t=H(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const ee=[cn,ut,di,Wt,Xt,Ln,hn,j(oi),Zn,_n,_e];function ge(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ge(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of ee)if(!ge(r,t))return null}}return`Expected ${H(i)} but found ${H(t)} instead.`}function Ce(i,t){return t.some(r=>r.kind===i.kind)}function Me(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Le(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const we=.96422,qe=.82521,rt=4/29,ze=6/29,_t=3*ze*ze,Nt=ze*ze*ze,Jt=Math.PI/180,wi=180/Math.PI;function hi(i){return(i%=360)<0&&(i+=360),i}function Ei([i,t,r,s]){let l,d;const f=nr((.2225045*(i=yi(i))+.7168786*(t=yi(t))+.0606169*(r=yi(r)))/1);i===t&&t===r?l=d=f:(l=nr((.4360747*i+.3850649*t+.1430804*r)/we),d=nr((.0139322*i+.0971045*t+.7141733*r)/qe));const _=116*f-16;return[_<0?0:_,500*(l-f),200*(f-d),s]}function yi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function nr(i){return i>Nt?Math.pow(i,1/3):i/_t+rt}function Ki([i,t,r,s]){let l=(i+16)/116,d=isNaN(t)?l:l+t/500,f=isNaN(r)?l:l-r/200;return l=1*Pi(l),d=we*Pi(d),f=qe*Pi(f),[gi(3.1338561*d-1.6168667*l-.4906146*f),gi(-.9787684*d+1.9161415*l+.033454*f),gi(.0719453*d-.2289914*l+1.4052427*f),s]}function gi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Pi(i){return i>ze?i*i*i:_t*(i-rt)}function ji(i){return parseInt(i.padEnd(2,i),16)/255}function sr(i,t){return dr(t?i/100:i,0,1)}function dr(i,t,r){return Math.min(Math.max(t,i),r)}function fr(i){return!i.some(Number.isNaN)}const In={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ri{constructor(t,r,s,l=1,d=!0){this.r=t,this.g=r,this.b=s,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,s,l]))}static parse(t){if(t instanceof Ri)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=In[s];if(l){const[f,_,b]=l;return[f/255,_/255,b/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let _=1;return[ji(s.slice(_,_+=f)),ji(s.slice(_,_+=f)),ji(s.slice(_,_+=f)),ji(s.slice(_,_+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[_,b,E,D,R,O,Y,W,X,pe,be,Re]=f,Ee=[D||" ",Y||" ",pe].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const Pe=[E,O,X].join(""),Ve=Pe==="%%%"?100:Pe===""?255:0;if(Ve){const st=[dr(+b/Ve,0,1),dr(+R/Ve,0,1),dr(+W/Ve,0,1),be?sr(+be,Re):1];if(fr(st))return st}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,_,b,E,D,R,O,Y,W]=d,X=[b||" ",D||" ",O].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const pe=[+_,dr(+E,0,100),dr(+R,0,100),Y?sr(+Y,W):1];if(fr(pe))return function([be,Re,Ee,Pe]){function Ve(st){const St=(st+be/30)%12,$t=Re*Math.min(Ee,1-Ee);return Ee-$t*Math.max(-1,Math.min(St-3,9-St,1))}return be=hi(be),Re/=100,Ee/=100,[Ve(0),Ve(8),Ve(4),Pe]}(pe)}}}(t);return r?new Ri(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,r/d,s/d,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,l,d]=Ei(t),f=Math.sqrt(s*s+l*l);return[Math.round(1e4*f)?hi(Math.atan2(l,s)*wi):NaN,f,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ei(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,l]=this.rgb;return`rgba(${[t,r,s].map(d=>Math.round(255*d)).join(",")},${l})`}}Ri.black=new Ri(0,0,0,1),Ri.white=new Ri(1,1,1,1),Ri.transparent=new Ri(0,0,0,0),Ri.red=new Ri(1,0,0,1);class Xo{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class el{constructor(t,r,s,l,d){this.text=t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=d}}class Tr{constructor(t){this.sections=t}static fromString(t){return new Tr([new el(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Tr?t:Tr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Yr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Yr)return t;if(typeof t=="number")return new Yr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Yr(t)}}toString(){return JSON.stringify(this.values)}}const tl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];if(typeof s!="string"||!tl.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Pr(t)}}toString(){return JSON.stringify(this.values)}}class Kr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Kr({name:t,available:!1}):null}}function ha(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ps(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ri||i instanceof Xo||i instanceof Tr||i instanceof Yr||i instanceof Pr||i instanceof Kr)return!0;if(Array.isArray(i)){for(const t of i)if(!Ps(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ps(i[t]))return!1;return!0}return!1}function ar(i){if(i===null)return cn;if(typeof i=="string")return di;if(typeof i=="boolean")return Wt;if(typeof i=="number")return ut;if(i instanceof Ri)return Xt;if(i instanceof Xo)return Pn;if(i instanceof Tr)return Ln;if(i instanceof Yr)return Zn;if(i instanceof Pr)return _e;if(i instanceof Kr)return _n;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const l=ar(s);if(r){if(r===l)continue;r=oi;break}r=l}return j(r||oi,t)}return hn}function ua(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Ri||i instanceof Tr||i instanceof Yr||i instanceof Pr||i instanceof Kr?i.toString():JSON.stringify(i)}class bn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ps(t[1]))return r.error("invalid value");const s=t[1];let l=ar(s);const d=r.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new bn(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class er{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Aa={string:di,number:ut,boolean:Wt,object:hn};class Zr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const d=t[0];if(d==="array"){let _,b;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in Aa)||E==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Aa[E],l++}else _=oi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],l++}s=j(_,b)}else{if(!Aa[d])throw new Error(`Types doesn't contain name = ${d}`);s=Aa[d]}const f=[];for(;l<t.length;l++){const _=r.parse(t[l],l,oi);if(!_)return null;f.push(_)}return new Zr(s,f)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!ge(this.type,ar(s)))return s;if(r===this.args.length-1)throw new er(`Expected value to be of type ${H(this.type)}, but found ${H(ar(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const il={"to-boolean":Wt,"to-color":Xt,"to-number":ut,"to-string":di};class wn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!il[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=il[s],d=[];for(let f=1;f<t.length;f++){const _=r.parse(t[f],f,oi);if(!_)return null;d.push(_)}return new wn(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof Ri)return r;if(typeof r=="string"){const d=t.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ha(r[0],r[1],r[2],r[3]),!s))return new Ri(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new er(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const l=Yr.parse(r);if(l)return l}throw new er(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const l=Pr.parse(r);if(l)return l}throw new er(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new er(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Tr.fromString(ua(this.args[0].evaluate(t)));case"resolvedImage":return Kr.fromString(ua(this.args[0].evaluate(t)));default:return ua(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const _c=["Unknown","Point","LineString","Polygon"];class Rn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_c[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Ri.parse(t)),r}}class $n{constructor(t,r,s=[],l,d=new Tn,f=[]){this.registry=t,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=f,this.expectedType=l,this._isConstant=r}parse(t,r,s,l,d={}){return r?this.concat(r,s,l)._parse(t,d):this._parse(t,d)}_parse(t,r){function s(l,d,f){return f==="assert"?new Zr(d,[l]):f==="coerce"?new wn(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[l];if(d){let f=d.parse(t,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,b=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||b.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(_.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(_,b))return null}else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"assert")}if(!(f instanceof bn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const _=new Rn;try{f=new bn(f.type,f.evaluate(_))}catch(b){return this.error(b.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l=typeof t=="number"?this.path.concat(t):this.path,d=s?this.scope.concat(s):this.scope;return new $n(this.registry,this._isConstant,l,r||null,d,this.errors)}error(t,...r){const s=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new vr(s,t))}checkSubtype(t,r){const s=ge(t,r);return s&&this.error(s),s}}class $r{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let d=1;d<t.length-1;d+=2){const f=t[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=r.parse(t[d+1],d+1);if(!_)return null;s.push([f,_])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new $r(s,l):null}outputDefined(){return this.result.outputDefined()}}class Si{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new Si(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class da{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,ut),l=r.parse(t[2],2,j(r.expectedType||oi));return s&&l?new da(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new er(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new er(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new er(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class rl{constructor(t,r){this.type=Wt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,oi),l=r.parse(t[2],2,oi);return s&&l?Ce(s.type,[Wt,di,ut,cn,oi])?new rl(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Me(r,["boolean","string","number","null"]))throw new er(`Expected first argument to be of type boolean, string, number or null, but found ${H(ar(r))} instead.`);if(!Me(s,["string","array"]))throw new er(`Expected second argument to be of type array or string, but found ${H(ar(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Is{constructor(t,r,s){this.type=ut,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,oi),l=r.parse(t[2],2,oi);if(!s||!l)return null;if(!Ce(s.type,[Wt,di,ut,cn,oi]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${H(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,ut);return d?new Is(s,l,d):null}return new Is(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Me(r,["boolean","string","number","null"]))throw new er(`Expected first argument to be of type boolean, string, number or null, but found ${H(ar(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Me(s,["string"])){const d=s.indexOf(r,l);return d===-1?-1:[...s.slice(0,d)].length}if(Me(s,["array"]))return s.indexOf(r,l);throw new er(`Expected second argument to be of type array or string, but found ${H(ar(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class co{constructor(t,r,s,l,d,f){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=d,this.otherwise=f}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d={},f=[];for(let E=2;E<t.length-1;E+=2){let D=t[E];const R=t[E+1];Array.isArray(D)||(D=[D]);const O=r.concat(E);if(D.length===0)return O.error("Expected at least one branch label.");for(const W of D){if(typeof W!="number"&&typeof W!="string")return O.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return O.error("Numeric branch labels must be integer values.");if(s){if(O.checkSubtype(s,ar(W)))return null}else s=ar(W);if(d[String(W)]!==void 0)return O.error("Branch labels must be unique.");d[String(W)]=f.length}const Y=r.parse(R,E,l);if(!Y)return null;l=l||Y.type,f.push(Y)}const _=r.parse(t[1],1,oi);if(!_)return null;const b=r.parse(t[t.length-1],t.length-1,l);return b?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new co(s,l,_,d,f,b):null}evaluate(t){const r=this.input.evaluate(t);return(ar(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class vn{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let f=1;f<t.length-1;f+=2){const _=r.parse(t[f],f,Wt);if(!_)return null;const b=r.parse(t[f+1],f+1,s);if(!b)return null;l.push([_,b]),s=s||b.type}const d=r.parse(t[t.length-1],t.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new vn(s,l,d)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Wn{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,oi),l=r.parse(t[2],2,ut);if(!s||!l)return null;if(!Ce(s.type,[j(oi),di,oi]))return r.error(`Expected first argument to be of type array or string, but found ${H(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,ut);return d?new Wn(s.type,s,l,d):null}return new Wn(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Me(r,["string"]))return[...r].slice(s,l).join("");if(Me(r,["array"]))return r.slice(s,l);throw new er(`Expected first argument to be of type array or string, but found ${H(ar(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ls(i,t){const r=i.length-1;let s,l,d=0,f=r,_=0;for(;d<=f;)if(_=Math.floor((d+f)/2),s=i[_],l=i[_+1],s<=t){if(_===r||t<l)return _;d=_+1}else{if(!(s>t))throw new er("Input is not a number.");f=_-1}return 0}class fa{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,d]of s)this.labels.push(l),this.outputs.push(d)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,ut);if(!s)return null;const l=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<t.length;f+=2){const _=f===1?-1/0:t[f],b=t[f+1],E=f,D=f+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(l.length&&l[l.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const R=r.parse(b,D,d);if(!R)return null;d=d||R.type,l.push([_,R])}return new fa(d,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;return l>=r[d-1]?s[d-1].evaluate(t):s[Ls(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ho(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var nl=sl;function sl(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}sl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var l=this.sampleCurveX(r)-i;if(Math.abs(l)<t)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=l/d}var f=0,_=1;for(r=i,s=0;s<20&&(l=this.sampleCurveX(r),!(Math.abs(l-i)<t));s++)i>l?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ol=ho(nl);function bs(i,t,r){return i+r*(t-i)}function Rs(i,t,r){return i.map((s,l)=>bs(s,t[l],r))}const yr={number:bs,color:function(i,t,r,s="rgb"){switch(s){case"rgb":{const[l,d,f,_]=Rs(i.rgb,t.rgb,r);return new Ri(l,d,f,_,!1)}case"hcl":{const[l,d,f,_]=i.hcl,[b,E,D,R]=t.hcl;let O,Y;if(isNaN(l)||isNaN(b))isNaN(l)?isNaN(b)?O=NaN:(O=b,f!==1&&f!==0||(Y=E)):(O=l,D!==1&&D!==0||(Y=d));else{let Re=b-l;b>l&&Re>180?Re-=360:b<l&&l-b>180&&(Re+=360),O=l+r*Re}const[W,X,pe,be]=function([Re,Ee,Pe,Ve]){return Re=isNaN(Re)?0:Re*Jt,Ki([Pe,Math.cos(Re)*Ee,Math.sin(Re)*Ee,Ve])}([O,Y??bs(d,E,r),bs(f,D,r),bs(_,R,r)]);return new Ri(W,X,pe,be,!1)}case"lab":{const[l,d,f,_]=Ki(Rs(i.lab,t.lab,r));return new Ri(l,d,f,_,!1)}}},array:Rs,padding:function(i,t,r){return new Yr(Rs(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const s=i.values,l=t.values;if(s.length!==l.length)throw new er(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const d=[];for(let f=0;f<s.length;f+=2){if(s[f]!==l[f])throw new er(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${s[f]}, to[${f}]: ${l[f]}`);d.push(s[f]);const[_,b]=s[f+1],[E,D]=l[f+1];d.push([bs(_,E,r),bs(b,D,r)])}return new Pr(d)}};class Lr{constructor(t,r,s,l,d){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of d)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(t,r,s,l){let d=0;if(t.name==="exponential")d=Ga(r,t.base,s,l);else if(t.name==="linear")d=Ga(r,1,s,l);else if(t.name==="cubic-bezier"){const f=t.controlPoints;d=new Ol(f[0],f[1],f[2],f[3]).solve(Ga(r,1,s,l))}return d}static parse(t,r){let[s,l,d,...f]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const E=l[1];if(typeof E!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:E}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const E=l.slice(1);if(E.length!==4||E.some(D=>typeof D!="number"||D<0||D>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ut),!d)return null;const _=[];let b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=Xt:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let E=0;E<f.length;E+=2){const D=f[E],R=f[E+1],O=E+3,Y=E+4;if(typeof D!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(_.length&&_[_.length-1][0]>=D)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const W=r.parse(R,Y,b);if(!W)return null;b=b||W.type,_.push([D,W])}return Le(b,ut)||Le(b,Xt)||Le(b,Zn)||Le(b,_e)||Le(b,j(ut))?new Lr(b,s,l,d,_):r.error(`Type ${H(b)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const d=r.length;if(l>=r[d-1])return s[d-1].evaluate(t);const f=Ls(r,l),_=Lr.interpolationFactor(this.interpolation,l,r[f],r[f+1]),b=s[f].evaluate(t),E=s[f+1].evaluate(t);switch(this.operator){case"interpolate":return yr[this.type.kind](b,E,_);case"interpolate-hcl":return yr.color(b,E,_,"hcl");case"interpolate-lab":return yr.color(b,E,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ga(i,t,r,s){const l=s-r,d=i-r;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}class uo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const d=[];for(const _ of t.slice(1)){const b=r.parse(_,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,d.push(b)}if(!s)throw new Error("No output type");const f=l&&d.some(_=>ge(l,_.type));return new uo(f?oi:s,d)}evaluate(t){let r,s=null,l=0;for(const d of this.args)if(l++,s=d.evaluate(t),s&&s instanceof Kr&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ua(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ql(i,t,r,s){return s.compare(t,r)===0}function ga(i,t,r){const s=i!=="=="&&i!=="!=";return class Yd{constructor(d,f,_){this.type=Wt,this.lhs=d,this.rhs=f,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const _=d[0];let b=f.parse(d[1],1,oi);if(!b)return null;if(!Ua(_,b.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${H(b.type)}'.`);let E=f.parse(d[2],2,oi);if(!E)return null;if(!Ua(_,E.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${H(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return f.error(`Cannot compare types '${H(b.type)}' and '${H(E.type)}'.`);s&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new Zr(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new Zr(b.type,[E])));let D=null;if(d.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(D=f.parse(d[3],3,Pn),!D)return null}return new Yd(b,E,D)}evaluate(d){const f=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const b=ar(f),E=ar(_);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new er(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=ar(f),E=ar(_);if(b.kind!=="string"||E.kind!=="string")return t(d,f,_)}return this.collator?r(d,f,_,this.collator.evaluate(d)):t(d,f,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Ic=ga("==",function(i,t,r){return t===r},ql),Na=ga("!=",function(i,t,r){return t!==r},function(i,t,r,s){return!ql(0,t,r,s)}),Ao=ga("<",function(i,t,r){return t<r},function(i,t,r,s){return s.compare(t,r)<0}),Vl=ga(">",function(i,t,r){return t>r},function(i,t,r,s){return s.compare(t,r)>0}),al=ga("<=",function(i,t,r){return t<=r},function(i,t,r,s){return s.compare(t,r)<=0}),ol=ga(">=",function(i,t,r){return t>=r},function(i,t,r,s){return s.compare(t,r)>=0});class Xn{constructor(t,r,s){this.type=Pn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Wt);if(!l)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Wt);if(!d)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,di),!f)?null:new Xn(l,d,f)}evaluate(t){return new Xo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Fs{constructor(t,r,s,l,d){this.type=di,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,ut);if(!s)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=r.parse(l.locale,1,di),!d))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,di),!f))return null;let _=null;if(l["min-fraction-digits"]&&(_=r.parse(l["min-fraction-digits"],1,ut),!_))return null;let b=null;return l["max-fraction-digits"]&&(b=r.parse(l["max-fraction-digits"],1,ut),!b)?null:new Fs(s,d,f,_,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class zs{constructor(t){this.type=Ln,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=t.length-1;++f){const _=t[f];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let b=null;if(_["font-scale"]&&(b=r.parse(_["font-scale"],1,ut),!b))return null;let E=null;if(_["text-font"]&&(E=r.parse(_["text-font"],1,j(di)),!E))return null;let D=null;if(_["text-color"]&&(D=r.parse(_["text-color"],1,Xt),!D))return null;const R=l[l.length-1];R.scale=b,R.font=E,R.textColor=D}else{const b=r.parse(t[f],1,oi);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:b,scale:null,font:null,textColor:null})}}return new zs(l)}evaluate(t){return new Tr(this.sections.map(r=>{const s=r.content.evaluate(t);return ar(s)===_n?new el("",s,null,null,null):new el(ua(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class ws{constructor(t){this.type=_n,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,di);return s?new ws(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=Kr.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Gs{constructor(t){this.type=ut,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${H(s.type)} instead.`):new Gs(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new er(`Expected value to be of type string or array, but found ${H(ar(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const hr=8192;function bc(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*hr),Math.round(s*l*hr)]}function ll(i,t){const r=Math.pow(2,t.z);return[(l=(i[0]/hr+t.x)/r,360*l-180),(s=(i[1]/hr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function Us(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function vs(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Di(i,t,r){const s=i[0]-t[0],l=i[1]-t[1],d=i[0]-r[0],f=i[1]-r[1];return s*f-d*l==0&&s*d<=0&&l*f<=0}function fo(i,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(d=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*d[0]!=0&&!(!hl(i,t,r,s)||!hl(r,s,i,t));var l,d}function wc(i,t,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(fo(i,t,s[l],s[l+1]))return!0;return!1}function Ns(i,t,r=!1){let s=!1;for(const _ of t)for(let b=0;b<_.length-1;b++){if(Di(i,_[b],_[b+1]))return r;(d=_[b])[1]>(l=i)[1]!=(f=_[b+1])[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}var l,d,f;return s}function Hl(i,t){for(const r of t)if(Ns(i,r))return!0;return!1}function cl(i,t){for(const r of i)if(!Ns(r,t))return!1;for(let r=0;r<i.length-1;++r)if(wc(i[r],i[r+1],t))return!1;return!0}function Oa(i,t){for(const r of t)if(cl(i,r))return!0;return!1}function hl(i,t,r,s){const l=s[0]-r[0],d=s[1]-r[1],f=(i[0]-r[0])*d-l*(i[1]-r[1]),_=(t[0]-r[0])*d-l*(t[1]-r[1]);return f>0&&_<0||f<0&&_>0}function pa(i,t,r){const s=[];for(let l=0;l<i.length;l++){const d=[];for(let f=0;f<i[l].length;f++){const _=bc(i[l][f],r);Us(t,_),d.push(_)}s.push(d)}return s}function go(i,t,r){const s=[];for(let l=0;l<i.length;l++){const d=pa(i[l],t,r);s.push(d)}return s}function Qr(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let d=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;d===0&&(d=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=d}Us(t,i)}function ul(i,t,r,s){const l=Math.pow(2,s.z)*hr,d=[s.x*hr,s.y*hr],f=[];for(const _ of i)for(const b of _){const E=[b.x+d[0],b.y+d[1]];Qr(E,t,r,l),f.push(E)}return f}function Al(i,t,r,s){const l=Math.pow(2,s.z)*hr,d=[s.x*hr,s.y*hr],f=[];for(const b of i){const E=[];for(const D of b){const R=[D.x+d[0],D.y+d[1]];Us(t,R),E.push(R)}f.push(E)}if(t[2]-t[0]<=l/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const b of f)for(const E of b)Qr(E,t,r,l)}var _;return f}class Fn{constructor(t,r){this.type=Wt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ps(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const l=[];for(const d of s.features){const{type:f,coordinates:_}=d.geometry;f==="Polygon"&&l.push(_),f==="MultiPolygon"&&l.push(..._)}if(l.length)return new Fn(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Fn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Fn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=pa(s.coordinates,d,f),b=ul(r.geometry(),l,d,f);if(!vs(l,d))return!1;for(const E of b)if(!Ns(E,_))return!1}if(s.type==="MultiPolygon"){const _=go(s.coordinates,d,f),b=ul(r.geometry(),l,d,f);if(!vs(l,d))return!1;for(const E of b)if(!Hl(E,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=pa(s.coordinates,d,f),b=Al(r.geometry(),l,d,f);if(!vs(l,d))return!1;for(const E of b)if(!cl(E,_))return!1}if(s.type==="MultiPolygon"){const _=go(s.coordinates,d,f),b=Al(r.geometry(),l,d,f);if(!vs(l,d))return!1;for(const E of b)if(!Oa(E,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let xs=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const l=i-1>>1,d=t[l];if(r(s,d)>=0)break;t[i]=d,i=l}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,l=t[i];for(;i<s;){let d=1+(i<<1);const f=d+1;if(f<this.length&&r(t[f],t[d])<0&&(d=f),r(t[d],l)>=0)break;t[i]=t[d],i=d}t[i]=l}};function Os(i,t,r,s,l){dl(i,t,r,s||i.length-1,l||xn)}function dl(i,t,r,s,l){for(;s>r;){if(s-r>600){var d=s-r+1,f=t-r+1,_=Math.log(d),b=.5*Math.exp(2*_/3),E=.5*Math.sqrt(_*b*(d-b)/d)*(f-d/2<0?-1:1);dl(i,t,Math.max(r,Math.floor(t-f*b/d+E)),Math.min(s,Math.floor(t+(d-f)*b/d+E)),l)}var D=i[t],R=r,O=s;for(ma(i,r,t),l(i[s],D)>0&&ma(i,r,s);R<O;){for(ma(i,R,O),R++,O--;l(i[R],D)<0;)R++;for(;l(i[O],D)>0;)O--}l(i[r],D)===0?ma(i,r,O):ma(i,++O,s),O<=t&&(r=O+1),t<=O&&(s=O-1)}}function ma(i,t,r){var s=i[t];i[t]=i[r],i[r]=s}function xn(i,t){return i<t?-1:i>t?1:0}function qa(i,t){if(i.length<=1)return[i];const r=[];let s,l;for(const d of i){const f=fl(d);f!==0&&(d.area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),t>1)for(let d=0;d<r.length;d++)r[d].length<=t||(Os(r[d],t,1,r[d].length-1,po),r[d]=r[d].slice(0,t));return r}function po(i,t){return t.area-i.area}function fl(i){let t=0;for(let r,s,l=0,d=i.length,f=d-1;l<d;f=l++)r=i[l],s=i[f],t+=(s.x-r.x)*(r.y+s.y);return t}const mo=1/298.257223563,jl=mo*(2-mo),gl=Math.PI/180;class yo{constructor(t){const r=6378.137*gl*1e3,s=Math.cos(t*gl),l=1/(1-jl*(1-s*s)),d=Math.sqrt(l);this.kx=r*d*s,this.ky=r*d*l*(1-jl)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(t,r){let s,l,d,f,_=1/0;for(let b=0;b<t.length-1;b++){let E=t[b][0],D=t[b][1],R=this.wrap(t[b+1][0]-E)*this.kx,O=(t[b+1][1]-D)*this.ky,Y=0;R===0&&O===0||(Y=(this.wrap(r[0]-E)*this.kx*R+(r[1]-D)*this.ky*O)/(R*R+O*O),Y>1?(E=t[b+1][0],D=t[b+1][1]):Y>0&&(E+=R/this.kx*Y,D+=O/this.ky*Y)),R=this.wrap(r[0]-E)*this.kx,O=(r[1]-D)*this.ky;const W=R*R+O*O;W<_&&(_=W,s=E,l=D,d=b,f=Y)}return{point:[s,l],index:d,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Jl(i,t){return t[0]-i[0]}function _o(i){return i[1]-i[0]+1}function es(i,t){return i[1]>=i[0]&&i[1]<t}function ya(i,t){if(i[0]>i[1])return[null,null];const r=_o(i);if(t){if(r===2)return[i,null];const l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function pl(i,t){if(!es(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)Us(r,i[s]);return r}function Va(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)Us(t,s);return t}function _a(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ml(i,t,r){if(!_a(i)||!_a(t))return NaN;let s=0,l=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[s,l])}function ts(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function yl(i,t,r,s,l){const d=Math.min(ts(i,[r,s],l),ts(t,[r,s],l)),f=Math.min(ts(r,[i,t],l),ts(s,[i,t],l));return Math.min(d,f)}function vc(i,t,r,s,l){if(!es(t,i.length)||!es(s,r.length))return 1/0;let d=1/0;for(let f=t[0];f<t[1];++f){const _=i[f],b=i[f+1];for(let E=s[0];E<s[1];++E){const D=r[E],R=r[E+1];if(fo(_,b,D,R))return 0;d=Math.min(d,yl(_,b,D,R,l))}}return d}function Zi(i,t,r,s,l){if(!es(t,i.length)||!es(s,r.length))return NaN;let d=1/0;for(let f=t[0];f<=t[1];++f)for(let _=s[0];_<=s[1];++_)if(d=Math.min(d,l.distance(i[f],r[_])),d===0)return d;return d}function Ia(i,t,r){if(Ns(i,t,!0))return 0;let s=1/0;for(const l of t){const d=l[0],f=l[l.length-1];if(d!==f&&(s=Math.min(s,ts(i,[f,d],r)),s===0))return s;const _=r.pointOnLine(l,i);if(s=Math.min(s,r.distance(i,_.point)),s===0)return s}return s}function fi(i,t,r,s){if(!es(t,i.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Ns(i[d],r,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){const f=i[d],_=i[d+1];for(const b of r)for(let E=0,D=b.length,R=D-1;E<D;R=E++){const O=b[R],Y=b[E];if(fo(f,_,O,Y))return 0;l=Math.min(l,yl(f,_,O,Y,s))}}return l}function Io(i,t){for(const r of i)for(const s of r)if(Ns(s,t,!0))return!0;return!1}function Ui(i,t,r,s=1/0){const l=Va(i),d=Va(t);if(s!==1/0&&ml(l,d,r)>=s)return s;if(vs(l,d)){if(Io(i,t))return 0}else if(Io(t,i))return 0;let f=1/0;for(const _ of i)for(let b=0,E=_.length,D=E-1;b<E;D=b++){const R=_[D],O=_[b];for(const Y of t)for(let W=0,X=Y.length,pe=X-1;W<X;pe=W++){const be=Y[pe],Re=Y[W];if(fo(R,O,be,Re))return 0;f=Math.min(f,yl(R,O,be,Re,r))}}return f}function Fi(i,t,r,s,l,d){if(!d)return;const f=ml(pl(s,d),l,r);f<t&&i.push([f,d,[0,0]])}function zn(i,t,r,s,l,d,f){if(!d||!f)return;const _=ml(pl(s,d),pl(l,f),r);_<t&&i.push([_,d,f])}function Gn(i,t,r,s,l=1/0){let d=Math.min(s.distance(i[0],r[0][0]),l);if(d===0)return d;const f=new xs([[0,[0,i.length-1],[0,0]]],Jl),_=Va(r);for(;f.length>0;){const b=f.pop();if(b[0]>=d)continue;const E=b[1],D=t?50:100;if(_o(E)<=D){if(!es(E,i.length))return NaN;if(t){const R=fi(i,E,r,s);if(isNaN(R)||R===0)return R;d=Math.min(d,R)}else for(let R=E[0];R<=E[1];++R){const O=Ia(i[R],r,s);if(d=Math.min(d,O),d===0)return 0}}else{const R=ya(E,t);Fi(f,d,s,i,_,R[0]),Fi(f,d,s,i,_,R[1])}}return d}function ba(i,t,r,s,l,d=1/0){let f=Math.min(d,l.distance(i[0],r[0]));if(f===0)return f;const _=new xs([[0,[0,i.length-1],[0,r.length-1]]],Jl);for(;_.length>0;){const b=_.pop();if(b[0]>=f)continue;const E=b[1],D=b[2],R=t?50:100,O=s?50:100;if(_o(E)<=R&&_o(D)<=O){if(!es(E,i.length)&&es(D,r.length))return NaN;let Y;if(t&&s)Y=vc(i,E,r,D,l),f=Math.min(f,Y);else if(t&&!s){const W=i.slice(E[0],E[1]+1);for(let X=D[0];X<=D[1];++X)if(Y=ts(r[X],W,l),f=Math.min(f,Y),f===0)return f}else if(!t&&s){const W=r.slice(D[0],D[1]+1);for(let X=E[0];X<=E[1];++X)if(Y=ts(i[X],W,l),f=Math.min(f,Y),f===0)return f}else Y=Zi(i,E,r,D,l),f=Math.min(f,Y)}else{const Y=ya(E,t),W=ya(D,s);zn(_,f,l,i,r,Y[0],W[0]),zn(_,f,l,i,r,Y[0],W[1]),zn(_,f,l,i,r,Y[1],W[0]),zn(_,f,l,i,r,Y[1],W[1])}}return f}function _l(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Un{constructor(t,r){this.type=ut,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ps(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new Un(s,s.features.map(l=>_l(l.geometry)).flat());if(s.type==="Feature")return new Un(s,_l(s.geometry));if("type"in s&&"coordinates"in s)return new Un(s,_l(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const l=r.geometry(),d=l.flat().map(b=>ll([b.x,b.y],r.canonical));if(l.length===0)return NaN;const f=new yo(d[0][1]);let _=1/0;for(const b of s){switch(b.type){case"Point":_=Math.min(_,ba(d,!1,[b.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,ba(d,!1,b.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,Gn(d,!1,b.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const l=r.geometry(),d=l.flat().map(b=>ll([b.x,b.y],r.canonical));if(l.length===0)return NaN;const f=new yo(d[0][1]);let _=1/0;for(const b of s){switch(b.type){case"Point":_=Math.min(_,ba(d,!0,[b.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,ba(d,!0,b.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,Gn(d,!0,b.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const d=qa(l,0).map(b=>b.map(E=>E.map(D=>ll([D.x,D.y],r.canonical)))),f=new yo(d[0][0][0][1]);let _=1/0;for(const b of s)for(const E of d){switch(b.type){case"Point":_=Math.min(_,Gn([b.coordinates],!1,E,f,_));break;case"LineString":_=Math.min(_,Gn(b.coordinates,!0,E,f,_));break;case"Polygon":_=Math.min(_,Ui(E,b.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Bs={"==":Ic,"!=":Na,">":Vl,"<":Ao,">=":ol,"<=":al,array:Zr,at:da,boolean:Zr,case:vn,coalesce:uo,collator:Xn,format:zs,image:ws,in:rl,"index-of":Is,interpolate:Lr,"interpolate-hcl":Lr,"interpolate-lab":Lr,length:Gs,let:$r,literal:bn,match:co,number:Zr,"number-format":Fs,object:Zr,slice:Wn,step:fa,string:Zr,"to-boolean":wn,"to-color":wn,"to-number":wn,"to-string":wn,var:Si,within:Fn,distance:Un};class Wr{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],l=Wr.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,_=f.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let b=null;for(const[E,D]of _){b=new $n(r.registry,wa,r.path,null,r.scope);const R=[];let O=!1;for(let Y=1;Y<t.length;Y++){const W=t[Y],X=Array.isArray(E)?E[Y-1]:E.type,pe=b.parse(W,1+R.length,X);if(!pe){O=!0;break}R.push(pe)}if(!O)if(Array.isArray(E)&&E.length!==R.length)b.error(`Expected ${E.length} arguments, but found ${R.length} instead.`);else{for(let Y=0;Y<R.length;Y++){const W=Array.isArray(E)?E[Y]:E.type,X=R[Y];b.concat(Y+1).checkSubtype(W,X.type)}if(b.errors.length===0)return new Wr(s,d,D,R)}}if(_.length===1)r.errors.push(...b.errors);else{const E=(_.length?_:f).map(([R])=>{return O=R,Array.isArray(O)?`(${O.map(H).join(", ")})`:`(${H(O.type)}...)`;var O}).join(" | "),D=[];for(let R=1;R<t.length;R++){const O=r.parse(t[R],1+D.length);if(!O)return null;D.push(H(O.type))}r.error(`Expected arguments of type ${E}, but found (${D.join(", ")}) instead.`)}return null}static register(t,r){Wr.definitions=r;for(const s in r)t[s]=Wr}}function bo(i,[t,r,s,l]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const d=l?l.evaluate(i):1,f=ha(t,r,s,d);if(f)throw new er(f);return new Ri(t/255,r/255,s/255,d,!1)}function wo(i,t){return i in t}function Ha(i,t){const r=t[i];return r===void 0?null:r}function Cs(i){return{type:i}}function wa(i){if(i instanceof Si)return wa(i.boundExpression);if(i instanceof Wr&&i.name==="error"||i instanceof Xn||i instanceof Fn||i instanceof Un)return!1;const t=i instanceof wn||i instanceof Zr;let r=!0;return i.eachChild(s=>{r=t?r&&wa(s):r&&s instanceof bn}),!!r&&va(i)&&ja(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function va(i){if(i instanceof Wr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Fn||i instanceof Un)return!1;let t=!0;return i.eachChild(r=>{t&&!va(r)&&(t=!1)}),t}function qs(i){if(i instanceof Wr&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!qs(r)&&(t=!1)}),t}function ja(i,t){if(i instanceof Wr&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!ja(s,t)&&(r=!1)}),r}function vo(i){return{result:"success",value:i}}function xa(i){return{result:"error",value:i}}function Vs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Il(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function xo(i){return!!i.expression&&i.expression.interpolated}function Qi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Bo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function xc(i){return i}function bl(i,t){const r=t.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",l=s||!(s||i.property!==void 0),d=i.type||(xo(t)?"exponential":"interval");if(r||t.type==="padding"){const D=r?Ri.parse:Yr.parse;(i=Mn({},i)).stops&&(i.stops=i.stops.map(R=>[R[0],D(R[1])])),i.default=D(i.default?i.default:t.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let _,b,E;if(d==="exponential")_=Kl;else if(d==="interval")_=Co;else if(d==="categorical"){_=Yl,b=Object.create(null);for(const D of i.stops)b[D[0]]=D[1];E=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);_=Eo}if(s){const D={},R=[];for(let W=0;W<i.stops.length;W++){const X=i.stops[W],pe=X[0].zoom;D[pe]===void 0&&(D[pe]={zoom:pe,type:i.type,property:i.property,default:i.default,stops:[]},R.push(pe)),D[pe].stops.push([X[0].value,X[1]])}const O=[];for(const W of R)O.push([D[W].zoom,bl(D[W],t)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:Lr.interpolationFactor.bind(void 0,Y),zoomStops:O.map(W=>W[0]),evaluate:({zoom:W},X)=>Kl({stops:O,base:i.base},t,W).evaluate(W,X)}}if(l){const D=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Lr.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(i,t,R,b,E)}}return{kind:"source",evaluate(D,R){const O=R&&R.properties?R.properties[i.property]:void 0;return O===void 0?Rr(i.default,t.default):_(i,t,O,b,E)}}}function Rr(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Yl(i,t,r,s,l){return Rr(typeof r===l?s[r]:void 0,i.default,t.default)}function Co(i,t,r){if(Qi(r)!=="number")return Rr(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=Ls(i.stops.map(d=>d[0]),r);return i.stops[l][1]}function Kl(i,t,r){const s=i.base!==void 0?i.base:1;if(Qi(r)!=="number")return Rr(i.default,t.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const d=Ls(i.stops.map(D=>D[0]),r),f=function(D,R,O,Y){const W=Y-O,X=D-O;return W===0?0:R===1?X/W:(Math.pow(R,X)-1)/(Math.pow(R,W)-1)}(r,s,i.stops[d][0],i.stops[d+1][0]),_=i.stops[d][1],b=i.stops[d+1][1],E=yr[t.type]||xc;return typeof _.evaluate=="function"?{evaluate(...D){const R=_.evaluate.apply(void 0,D),O=b.evaluate.apply(void 0,D);if(R!==void 0&&O!==void 0)return E(R,O,f,i.colorSpace)}}:E(_,b,f,i.colorSpace)}function Eo(i,t,r){switch(t.type){case"color":r=Ri.parse(r);break;case"formatted":r=Tr.fromString(r.toString());break;case"resolvedImage":r=Kr.fromString(r.toString());break;case"padding":r=Yr.parse(r);break;default:Qi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return Rr(r,i.default,t.default)}Wr.register(Bs,{error:[{kind:"error"},[di],(i,[t])=>{throw new er(t.evaluate(i))}],typeof:[di,[oi],(i,[t])=>H(ar(t.evaluate(i)))],"to-rgba":[j(ut,4),[Xt],(i,[t])=>{const[r,s,l,d]=t.evaluate(i).rgb;return[255*r,255*s,255*l,d]}],rgb:[Xt,[ut,ut,ut],bo],rgba:[Xt,[ut,ut,ut,ut],bo],has:{type:Wt,overloads:[[[di],(i,[t])=>wo(t.evaluate(i),i.properties())],[[di,hn],(i,[t,r])=>wo(t.evaluate(i),r.evaluate(i))]]},get:{type:oi,overloads:[[[di],(i,[t])=>Ha(t.evaluate(i),i.properties())],[[di,hn],(i,[t,r])=>Ha(t.evaluate(i),r.evaluate(i))]]},"feature-state":[oi,[di],(i,[t])=>Ha(t.evaluate(i),i.featureState||{})],properties:[hn,[],i=>i.properties()],"geometry-type":[di,[],i=>i.geometryType()],id:[oi,[],i=>i.id()],zoom:[ut,[],i=>i.globals.zoom],"heatmap-density":[ut,[],i=>i.globals.heatmapDensity||0],"line-progress":[ut,[],i=>i.globals.lineProgress||0],accumulated:[oi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ut,Cs(ut),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[ut,Cs(ut),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:ut,overloads:[[[ut,ut],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[ut],(i,[t])=>-t.evaluate(i)]]},"/":[ut,[ut,ut],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[ut,[ut,ut],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[ut,[ut],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[ut,[ut],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[ut,[ut],(i,[t])=>Math.log(t.evaluate(i))],log2:[ut,[ut],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[ut,[ut],(i,[t])=>Math.sin(t.evaluate(i))],cos:[ut,[ut],(i,[t])=>Math.cos(t.evaluate(i))],tan:[ut,[ut],(i,[t])=>Math.tan(t.evaluate(i))],asin:[ut,[ut],(i,[t])=>Math.asin(t.evaluate(i))],acos:[ut,[ut],(i,[t])=>Math.acos(t.evaluate(i))],atan:[ut,[ut],(i,[t])=>Math.atan(t.evaluate(i))],min:[ut,Cs(ut),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[ut,Cs(ut),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[ut,[ut],(i,[t])=>Math.abs(t.evaluate(i))],round:[ut,[ut],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[ut,[ut],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[ut,[ut],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Wt,[di,oi],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Wt,[oi],(i,[t])=>i.id()===t.value],"filter-type-==":[Wt,[di],(i,[t])=>i.geometryType()===t.value],"filter-<":[Wt,[di,oi],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[Wt,[oi],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Wt,[di,oi],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[Wt,[oi],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Wt,[di,oi],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[Wt,[oi],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Wt,[di,oi],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[Wt,[oi],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Wt,[oi],(i,[t])=>t.value in i.properties()],"filter-has-id":[Wt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Wt,[j(di)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Wt,[j(oi)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Wt,[di,j(oi)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Wt,[di,j(oi)],(i,[t,r])=>function(s,l,d,f){for(;d<=f;){const _=d+f>>1;if(l[_]===s)return!0;l[_]>s?f=_-1:d=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Wt,overloads:[[[Wt,Wt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Cs(Wt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Wt,overloads:[[[Wt,Wt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Cs(Wt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Wt,[Wt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Wt,[di],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[di,[di],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[di,[di],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[di,Cs(oi),(i,t)=>t.map(r=>ua(r.evaluate(i))).join("")],"resolved-locale":[di,[Pn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ba{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new Rn,this._defaultValue=r?(s=r).type==="color"&&Bo(s.default)?new Ri(0,0,0,0):s.type==="color"?Ri.parse(s.default)||null:s.type==="padding"?Yr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Pr.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,d,f){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new er(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Qo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Bs}function Ca(i,t){const r=new $n(Bs,wa,[],t?function(l){const d={color:Xt,string:di,number:ut,enum:di,boolean:Wt,formatted:Ln,padding:Zn,resolvedImage:_n,variableAnchorOffsetCollection:_e};return l.type==="array"?j(d[l.value]||oi,l.length):d[l.type]}(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?vo(new Ba(s,t)):xa(r.errors)}class Nn{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!qs(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,f)}evaluate(t,r,s,l,d,f){return this._styleExpression.evaluate(t,r,s,l,d,f)}}class is{constructor(t,r,s,l){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!qs(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,d,f)}evaluate(t,r,s,l,d,f){return this._styleExpression.evaluate(t,r,s,l,d,f)}interpolationFactor(t,r,s){return this.interpolationType?Lr.interpolationFactor(this.interpolationType,t,r,s):0}}function Ea(i,t){const r=Ca(i,t);if(r.result==="error")return r;const s=r.value.expression,l=va(s);if(!l&&!Vs(t))return xa([new vr("","data expressions not supported")]);const d=ja(s,["zoom"]);if(!d&&!Il(t))return xa([new vr("","zoom expressions not supported")]);const f=Es(s);return f||d?f instanceof vr?xa([f]):f instanceof Lr&&!xo(t)?xa([new vr("",'"interpolate" expressions cannot be used with this property')]):vo(f?new is(l?"camera":"composite",r.value,f.labels,f instanceof Lr?f.interpolation:void 0):new Nn(l?"constant":"source",r.value)):xa([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rs{constructor(t,r){this._parameters=t,this._specification=r,Mn(this,bl(this._parameters,this._specification))}static deserialize(t){return new rs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Es(i){let t=null;if(i instanceof $r)t=Es(i.result);else if(i instanceof uo){for(const r of i.args)if(t=Es(r),t)break}else(i instanceof fa||i instanceof Lr)&&i.input instanceof Wr&&i.input.name==="zoom"&&(t=i);return t instanceof vr||i.eachChild(r=>{const s=Es(r);s instanceof vr?t=s:!t&&s?t=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Hs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Hs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const js={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Qs(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Hs(i)||(i=So(i));const t=Ca(i,js);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,l)=>t.value.evaluate(r,s,{},l),needGeometry:wl(i)}}function ko(i,t){return i<t?-1:i>t?1:0}function wl(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(wl(i[t]))return!0;return!1}function So(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?vl(i[1],i[2],"=="):t==="!="?tr(vl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?vl(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(So))):t==="all"?["all"].concat(i.slice(1).map(So)):t==="none"?["all"].concat(i.slice(1).map(So).map(tr)):t==="in"?Ja(i[1],i.slice(2)):t==="!in"?tr(Ja(i[1],i.slice(2))):t==="has"?Ya(i[1]):t!=="!has"||tr(Ya(i[1]));var r}function vl(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Ja(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(ko)]]:["filter-in-small",i,["literal",t]]}}function Ya(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function tr(i){return["!",i]}function Js(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const d of i)l+=`${Js(d)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${Js(i[r[l]])},`;return`${s}}`}function Zl(i){let t="";for(const r of cr)t+=`/${Js(i[r])}`;return t}function $l(i){const t=i.value;return t?[new ft(i.key,t,"constants have been deprecated as of v8")]:[]}function Wi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Bn(i){if(Array.isArray(i))return i.map(Bn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=Bn(i[r]);return t}return Wi(i)}function Xr(i){const t=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},d=i.style,f=i.styleSpec,_=i.validateSpec;let b=[];const E=Qi(r);if(E!=="object")return[new ft(t,r,`object expected, ${E} found`)];for(const D in r){const R=D.split(".")[0],O=s[R]||s["*"];let Y;if(l[R])Y=l[R];else if(s[R])Y=_;else if(l["*"])Y=l["*"];else{if(!s["*"]){b.push(new ft(t,r[D],`unknown property "${D}"`));continue}Y=_}b=b.concat(Y({key:(t&&`${t}.`)+D,value:r[D],valueSpec:O,style:d,styleSpec:f,object:r,objectKey:D,validateSpec:_},r))}for(const D in s)l[D]||s[D].required&&s[D].default===void 0&&r[D]===void 0&&b.push(new ft(t,r,`missing required property "${D}"`));return b}function Ka(i){const t=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,d=i.key,f=i.arrayElementValidator||i.validateSpec;if(Qi(t)!=="array")return[new ft(d,t,`array expected, ${Qi(t)} found`)];if(r.length&&t.length!==r.length)return[new ft(d,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ft(d,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};l.$version<7&&(_.function=r.function),Qi(r.value)==="object"&&(_=r.value);let b=[];for(let E=0;E<t.length;E++)b=b.concat(f({array:t,arrayIndex:E,value:t[E],valueSpec:_,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${d}[${E}]`}));return b}function Za(i){const t=i.key,r=i.value,s=i.valueSpec;let l=Qi(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new ft(t,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new ft(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new ft(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Do(i){const t=i.valueSpec,r=Wi(i.value.type);let s,l,d,f={};const _=r!=="categorical"&&i.value.property===void 0,b=!_,E=Qi(i.value.stops)==="array"&&Qi(i.value.stops[0])==="array"&&Qi(i.value.stops[0][0])==="object",D=Xr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Y){if(r==="identity")return[new ft(Y.key,Y.value,'identity function may not have a "stops" property')];let W=[];const X=Y.value;return W=W.concat(Ka({key:Y.key,value:X,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:R})),Qi(X)==="array"&&X.length===0&&W.push(new ft(Y.key,X,"array must have at least one stop")),W},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:t,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return r==="identity"&&_&&D.push(new ft(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||D.push(new ft(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!xo(i.valueSpec)&&D.push(new ft(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Vs(i.valueSpec)?D.push(new ft(i.key,i.value,"property functions not supported")):_&&!Il(i.valueSpec)&&D.push(new ft(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!E||i.value.property!==void 0||D.push(new ft(i.key,i.value,'"property" property is required')),D;function R(Y){let W=[];const X=Y.value,pe=Y.key;if(Qi(X)!=="array")return[new ft(pe,X,`array expected, ${Qi(X)} found`)];if(X.length!==2)return[new ft(pe,X,`array length 2 expected, length ${X.length} found`)];if(E){if(Qi(X[0])!=="object")return[new ft(pe,X,`object expected, ${Qi(X[0])} found`)];if(X[0].zoom===void 0)return[new ft(pe,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new ft(pe,X,"object stop key must have value")];if(d&&d>Wi(X[0].zoom))return[new ft(pe,X[0].zoom,"stop zoom values must appear in ascending order")];Wi(X[0].zoom)!==d&&(d=Wi(X[0].zoom),l=void 0,f={}),W=W.concat(Xr({key:`${pe}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Za,value:O}}))}else W=W.concat(O({key:`${pe}[0]`,value:X[0],validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},X));return Qo(Bn(X[1]))?W.concat([new ft(`${pe}[1]`,X[1],"expressions are not allowed in function stops.")]):W.concat(Y.validateSpec({key:`${pe}[1]`,value:X[1],valueSpec:t,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function O(Y,W){const X=Qi(Y.value),pe=Wi(Y.value),be=Y.value!==null?Y.value:W;if(s){if(X!==s)return[new ft(Y.key,be,`${X} stop domain type must match previous stop domain type ${s}`)]}else s=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new ft(Y.key,be,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&r!=="categorical"){let Re=`number expected, ${X} found`;return Vs(t)&&r===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(Y.key,be,Re)]}return r!=="categorical"||X!=="number"||isFinite(pe)&&Math.floor(pe)===pe?r!=="categorical"&&X==="number"&&l!==void 0&&pe<l?[new ft(Y.key,be,"stop domain values must appear in ascending order")]:(l=pe,r==="categorical"&&pe in f?[new ft(Y.key,be,"stop domain values must be unique")]:(f[pe]=!0,[])):[new ft(Y.key,be,`integer expected, found ${pe}`)]}}function kr(i){const t=(i.expressionContext==="property"?Ea:Ca)(Bn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(s=>new ft(`${i.key}${s.key}`,i.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ft(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!qs(r))return[new ft(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!qs(r))return[new ft(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ja(r,["zoom","feature-state"]))return[new ft(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!va(r))return[new ft(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cn(i){const t=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Wi(r))===-1&&l.push(new ft(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Wi(r))===-1&&l.push(new ft(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Mo(i){return Hs(Bn(i.value))?kr(Mn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):To(i)}function To(i){const t=i.value,r=i.key;if(Qi(t)!=="array")return[new ft(r,t,`array expected, ${Qi(t)} found`)];const s=i.styleSpec;let l,d=[];if(t.length<1)return[new ft(r,t,"filter array must have at least 1 element")];switch(d=d.concat(Cn({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Wi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Wi(t[1])==="$type"&&d.push(new ft(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new ft(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Qi(t[1]),l!=="string"&&d.push(new ft(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let f=2;f<t.length;f++)l=Qi(t[f]),Wi(t[1])==="$type"?d=d.concat(Cn({key:`${r}[${f}]`,value:t[f],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new ft(`${r}[${f}]`,t[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)d=d.concat(To({key:`${r}[${f}]`,value:t[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Qi(t[1]),t.length!==2?d.push(new ft(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new ft(`${r}[1]`,t[1],`string expected, ${l} found`))}return d}function Po(i,t){const r=i.key,s=i.validateSpec,l=i.style,d=i.styleSpec,f=i.value,_=i.objectKey,b=d[`${t}_${i.layerType}`];if(!b)return[];const E=_.match(/^(.*)-transition$/);if(t==="paint"&&E&&b[E[1]]&&b[E[1]].transition)return s({key:r,value:f,valueSpec:d.transition,style:l,styleSpec:d});const D=i.valueSpec||b[_];if(!D)return[new ft(r,f,`unknown property "${_}"`)];let R;if(Qi(f)==="string"&&Vs(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(f)))return[new ft(r,f,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const O=[];return i.layerType==="symbol"&&(_==="text-field"&&l&&!l.glyphs&&O.push(new ft(r,f,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Bo(Bn(f))&&Wi(f.type)==="identity"&&O.push(new ft(r,f,'"text-font" does not support identity functions'))),O.concat(s({key:i.key,value:f,valueSpec:D,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:_}))}function $a(i){return Po(i,"paint")}function Ys(i){return Po(i,"layout")}function Wa(i){let t=[];const r=i.value,s=i.key,l=i.style,d=i.styleSpec;r.type||r.ref||t.push(new ft(s,r,'either "type" or "ref" is required'));let f=Wi(r.type);const _=Wi(r.ref);if(r.id){const b=Wi(r.id);for(let E=0;E<i.arrayIndex;E++){const D=l.layers[E];Wi(D.id)===b&&t.push(new ft(s,r.id,`duplicate layer id "${r.id}", previously used at line ${D.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in r&&t.push(new ft(s,r[E],`"${E}" is prohibited for ref layers`))}),l.layers.forEach(E=>{Wi(E.id)===_&&(b=E)}),b?b.ref?t.push(new ft(s,r.ref,"ref cannot reference another ref layer")):f=Wi(b.type):t.push(new ft(s,r.ref,`ref layer "${_}" not found`))}else if(f!=="background")if(r.source){const b=l.sources&&l.sources[r.source],E=b&&Wi(b.type);b?E==="vector"&&f==="raster"?t.push(new ft(s,r.source,`layer "${r.id}" requires a raster source`)):E!=="raster-dem"&&f==="hillshade"?t.push(new ft(s,r.source,`layer "${r.id}" requires a raster-dem source`)):E==="raster"&&f!=="raster"?t.push(new ft(s,r.source,`layer "${r.id}" requires a vector source`)):E!=="vector"||r["source-layer"]?E==="raster-dem"&&f!=="hillshade"?t.push(new ft(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||E==="geojson"&&b.lineMetrics||t.push(new ft(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ft(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ft(s,r.source,`source "${r.source}" not found`))}else t.push(new ft(s,r,'missing required property "source"'));return t=t.concat(Xr({key:s,value:r,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Mo,layout:b=>Xr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":E=>Ys(Mn({layerType:f},E))}}),paint:b=>Xr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":E=>$a(Mn({layerType:f},E))}})}})),t}function Ks(i){const t=i.value,r=i.key,s=Qi(t);return s!=="string"?[new ft(r,t,`string expected, ${s} found`)]:[]}const Zs={promoteId:function({key:i,value:t}){if(Qi(t)==="string")return Ks({key:i,value:t});{const r=[];for(const s in t)r.push(...Ks({key:`${i}.${s}`,value:t[s]}));return r}}};function Xa(i){const t=i.value,r=i.key,s=i.styleSpec,l=i.style,d=i.validateSpec;if(!t.type)return[new ft(r,t,'"type" is required')];const f=Wi(t.type);let _;switch(f){case"vector":case"raster":return _=Xr({key:r,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:Zs,validateSpec:d}),_;case"raster-dem":return _=function(b){var E;const D=(E=b.sourceName)!==null&&E!==void 0?E:"",R=b.value,O=b.styleSpec,Y=O.source_raster_dem,W=b.style;let X=[];const pe=Qi(R);if(R===void 0)return X;if(pe!=="object")return X.push(new ft("source_raster_dem",R,`object expected, ${pe} found`)),X;const be=Wi(R.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],Ee=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const Pe in R)!be&&Re.includes(Pe)?X.push(new ft(Pe,R[Pe],`In "${D}": "${Pe}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):Y[Pe]?X=X.concat(b.validateSpec({key:Pe,value:R[Pe],valueSpec:Y[Pe],validateSpec:b.validateSpec,style:W,styleSpec:O})):X.push(new ft(Pe,R[Pe],`unknown property "${Pe}"`));return X}({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:d}),_;case"geojson":if(_=Xr({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:d,objectElementValidators:Zs}),t.cluster)for(const b in t.clusterProperties){const[E,D]=t.clusterProperties[b],R=typeof E=="string"?[E,["accumulated"],["get",b]]:E;_.push(...kr({key:`${r}.${b}.map`,value:D,expressionContext:"cluster-map"})),_.push(...kr({key:`${r}.${b}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return Xr({key:r,value:t,valueSpec:s.source_video,style:l,validateSpec:d,styleSpec:s});case"image":return Xr({key:r,value:t,valueSpec:s.source_image,style:l,validateSpec:d,styleSpec:s});case"canvas":return[new ft(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Qa(i){const t=i.value,r=i.styleSpec,s=r.light,l=i.style;let d=[];const f=Qi(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new ft("light",t,`object expected, ${f} found`)]),d;for(const _ in t){const b=_.match(/^(.*)-transition$/);d=d.concat(b&&s[b[1]]&&s[b[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ft(_,t[_],`unknown property "${_}"`)])}return d}function xl(i){const t=i.value,r=i.styleSpec,s=r.sky,l=i.style,d=Qi(t);if(t===void 0)return[];if(d!=="object")return[new ft("sky",t,`object expected, ${d} found`)];let f=[];for(const _ in t)f=f.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:l,styleSpec:r}):[new ft(_,t[_],`unknown property "${_}"`)]);return f}function Bl(i){const t=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let d=[];const f=Qi(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new ft("terrain",t,`object expected, ${f} found`)]),d;for(const _ in t)d=d.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new ft(_,t[_],`unknown property "${_}"`)]);return d}function Cl(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],d=[];for(const f in r)r[f].id&&l.includes(r[f].id)&&t.push(new ft(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),l.push(r[f].id),r[f].url&&d.includes(r[f].url)&&t.push(new ft(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),t=t.concat(Xr({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ks({key:s,value:r})}const Lo={"*":()=>[],array:Ka,boolean:function(i){const t=i.value,r=i.key,s=Qi(t);return s!=="boolean"?[new ft(r,t,`boolean expected, ${s} found`)]:[]},number:Za,color:function(i){const t=i.key,r=i.value,s=Qi(r);return s!=="string"?[new ft(t,r,`color expected, ${s} found`)]:Ri.parse(String(r))?[]:[new ft(t,r,`color expected, "${r}" found`)]},constants:$l,enum:Cn,filter:Mo,function:Do,layer:Wa,object:Xr,source:Xa,light:Qa,sky:xl,terrain:Bl,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,l=i.style,d=Qi(t);if(t===void 0)return[];if(d!=="object")return[new ft("projection",t,`object expected, ${d} found`)];let f=[];for(const _ in t)f=f.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:l,styleSpec:r}):[new ft(_,t[_],`unknown property "${_}"`)]);return f},string:Ks,formatted:function(i){return Ks(i).length===0?[]:kr(i)},resolvedImage:function(i){return Ks(i).length===0?[]:kr(i)},padding:function(i){const t=i.key,r=i.value;if(Qi(r)==="array"){if(r.length<1||r.length>4)return[new ft(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let d=0;d<r.length;d++)l=l.concat(i.validateSpec({key:`${t}[${d}]`,value:r[d],validateSpec:i.validateSpec,valueSpec:s}));return l}return Za({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=Qi(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new ft(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(Cn({key:`${t}[${f}]`,value:r[f],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(Ka({key:`${t}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return d},sprite:Cl};function ns(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=ns,r.expression&&Bo(Wi(t))?Do(i):r.expression&&Qo(Bn(t))?kr(i):r.type&&Lo[r.type]?Lo[r.type](i):Xr(Mn({},i,{valueSpec:r.type?s[r.type]:r}))}function El(i){const t=i.value,r=i.key,s=Ks(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new ft(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new ft(r,t,'"glyphs" url must include a "{range}" token'))),s}function un(i,t=Ne){let r=[];return r=r.concat(ns({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:ns,objectElementValidators:{glyphs:El,"*":()=>[]}})),i.constants&&(r=r.concat($l({key:"constants",value:i.constants}))),ss(r)}function en(i){return function(t){return i({...t,validateSpec:ns})}}function ss(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function En(i){return function(...t){return ss(i.apply(this,t))}}un.source=En(en(Xa)),un.sprite=En(en(Cl)),un.glyphs=En(en(El)),un.light=En(en(Qa)),un.sky=En(en(xl)),un.terrain=En(en(Bl)),un.layer=En(en(Wa)),un.filter=En(en(Mo)),un.paintProperty=En(en($a)),un.layoutProperty=En(en(Ys));const $s=un,An=$s.light,Wl=$s.sky,Ql=$s.paintProperty,Xl=$s.layoutProperty;function Ro(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new zi(new Error(s.message))),r=!0;return r}class as{constructor(t,r,s){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let b=0;b<this.d*this.d;b++){const E=f[3+b],D=f[3+b+1];l.push(E===D?null:f.subarray(E,D))}const _=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const d=s/r*t;this.min=-d,this.max=t+d}insert(t,r,s,l,d){this._forEachCell(r,s,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,l,d,f){this.cells[d].push(f)}query(t,r,s,l,d){const f=this.min,_=this.max;if(t<=f&&r<=f&&_<=s&&_<=l&&!d)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,r,s,l,this._queryCell,b,{},d),b}}_queryCell(t,r,s,l,d,f,_,b){const E=this.cells[d];if(E!==null){const D=this.keys,R=this.bboxes;for(let O=0;O<E.length;O++){const Y=E[O];if(_[Y]===void 0){const W=4*Y;(b?b(R[W+0],R[W+1],R[W+2],R[W+3]):t<=R[W+2]&&r<=R[W+3]&&s>=R[W+0]&&l>=R[W+1])?(_[Y]=!0,f.push(D[Y])):_[Y]=!1}}}}_forEachCell(t,r,s,l,d,f,_,b){const E=this._convertToCellCoord(t),D=this._convertToCellCoord(r),R=this._convertToCellCoord(s),O=this._convertToCellCoord(l);for(let Y=E;Y<=R;Y++)for(let W=D;W<=O;W++){const X=this.d*W+Y;if((!b||b(this._convertFromCellCoord(Y),this._convertFromCellCoord(W),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(W+1)))&&d.call(this,t,r,s,l,X,f,_,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=r;for(let f=0;f<t.length;f++){const _=t[f];l[3+f]=d,l.set(_,d),d+=_.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new as(t.buffer)}}const Sr={};function xt(i,t,r={}){if(Sr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Sr[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}xt("Object",Object),xt("TransferableGridIndex",as),xt("Color",Ri),xt("Error",Error),xt("AJAXError",ri),xt("ResolvedImage",Kr),xt("StylePropertyFunction",rs),xt("StyleExpression",Ba,{omit:["_evaluator"]}),xt("ZoomDependentExpression",is),xt("ZoomConstantExpression",Nn),xt("CompoundExpression",Wr,{omit:["_evaluate"]});for(const i in Bs)Bs[i]._classRegistryKey||xt(`Expression_${i}`,Bs[i]);function ka(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function eo(i){return i.$name||i.constructor._classRegistryKey}function to(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=eo(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ka(i)||pt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function os(i,t){if(to(i))return(ka(i)||pt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const d=[];for(const f of i)d.push(os(f,t));return d}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=eo(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Sr[r])throw new Error(`${r} is not registered.`);const{klass:s}=Sr[r],l=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||Sr[r].omit.indexOf(d)>=0)continue;const f=i[d];l[d]=Sr[r].shallow.indexOf(d)>=0?f:os(f,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function ks(i){if(to(i))return i;if(Array.isArray(i))return i.map(ks);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=eo(i)||"Object";if(!Sr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Sr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const d=i[l];s[l]=Sr[t].shallow.indexOf(l)>=0?d:ks(d)}return s}class qi{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const _i={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function kl(i){for(const t of i)if(io(t.charCodeAt(0)))return!0;return!1}function Ws(i){for(const t of i)if(!Xs(t.charCodeAt(0)))return!1;return!0}function Fo(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const ec=Fo(["Arab","Dupl","Mong","Ougr","Syrc"]);function Xs(i){return!ec.test(String.fromCodePoint(i))}const Sl=Fo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function io(i){return!(i!==746&&i!==747&&(i<4352||!(_i["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||_i["CJK Compatibility"](i)||_i["CJK Strokes"](i)||!(!_i["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||_i["Enclosed CJK Letters and Months"](i)||_i["Ideographic Description Characters"](i)||_i.Kanbun(i)||_i.Katakana(i)&&i!==12540||!(!_i["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!_i["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||_i["Vertical Forms"](i)||_i["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Sl.test(String.fromCodePoint(i)))))}function zo(i){return!(io(i)||function(t){return!!(_i["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||_i["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||_i["Letterlike Symbols"](t)||_i["Number Forms"](t)||_i["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||_i["Control Pictures"](t)&&t!==9251||_i["Optical Character Recognition"](t)||_i["Enclosed Alphanumerics"](t)||_i["Geometric Shapes"](t)||_i["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||_i["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||_i["CJK Symbols and Punctuation"](t)||_i.Katakana(t)||_i["Private Use Area"](t)||_i["CJK Compatibility Forms"](t)||_i["Small Form Variants"](t)||_i["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const tc=Fo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Dl(i){return tc.test(String.fromCodePoint(i))}function ic(i,t){return!(!t&&Dl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||_i.Khmer(i))}function Bc(i){for(const t of i)if(Dl(t.charCodeAt(0)))return!0;return!1}const ir=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Vi{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qi,this.transition={})}isSupportedScript(t){return function(r,s){for(const l of r)if(!ic(l.charCodeAt(0),s))return!1;return!0}(t,ir.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class ea{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,l){if(Bo(s))return new rs(s,l);if(Qo(s)){const d=Ea(s,l);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return l.type==="color"&&typeof s=="string"?d=Ri.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(d=Pr.parse(s)):d=Yr.parse(s),{kind:"constant",evaluate:()=>d}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class Go{constructor(t){this.property=t,this.value=new ea(t,void 0)}transitioned(t,r){return new Sa(this.property,this.value,r,yt({},t.transition,this.transition),t.now)}untransitioned(){return new Sa(this.property,this.value,null,{},0)}}class Uo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Qt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Go(this._values[t].property)),this._values[t].value=new ea(this._values[t].property,r===null?void 0:Qt(r))}getTransition(t){return Qt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Go(this._values[t].property)),this._values[t].transition=Qt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new ta(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new ta(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Sa{constructor(t,r,s,l,d){this.property=t,this.value=r,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,d=this.value.possiblyEvaluate(t,r,s),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(t,r,s);{const _=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,r,s),d,function(b){if(b<=0)return 0;if(b>=1)return 1;const E=b*b,D=E*b;return 4*(b<.5?D:3*(b-E)+D-.75)}(_))}}return d}}class ta{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new Da(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ia{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Qt(this._values[t].value)}setValue(t,r){this._values[t]=new ea(this._values[t].property,r===null?void 0:Qt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new Da(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,r,s);return l}}class On{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class Da{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class zt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const l=yr[this.specification.type];return l?l(t,r,s):t}}class jt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new On(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new On(this,{kind:"constant",value:void 0},t.parameters);const l=yr[this.specification.type];if(l){const d=l(t.value.value,r.value.value,s);return new On(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,r,s,l,d,f){return t.kind==="constant"?t.value:t.evaluate(r,s,l,d,f)}}class No extends jt{possiblyEvaluate(t,r,s,l){if(t.value===void 0)return new On(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l),f=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,_=this._calculate(f,f,f,r);return new On(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new On(this,{kind:"constant",value:d},r)}return new On(this,t.expression,r)}evaluate(t,r,s,l,d,f){if(t.kind==="source"){const _=t.evaluate(r,s,l,d,f);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,l),t.evaluate({zoom:Math.floor(r.zoom)},s,l),t.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):t.value}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Oo{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,l);return this._calculate(d,d,d,r)}return this._calculate(t.expression.evaluate(new Vi(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Ml{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class u{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new ea(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new Go(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}xt("DataDrivenProperty",jt),xt("DataConstantProperty",zt),xt("CrossFadedDataDrivenProperty",No),xt("CrossFadedProperty",Oo),xt("ColorRampProperty",Ml);const e="-transition";class n extends Xi{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new ia(r.layout)),r.paint)){this._transitionablePaint=new Uo(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Da(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(Xl,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(Ql,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),_=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(t,_,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),gt(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,l,d={}){return(!d||d.validate!==!1)&&Ro(this,t.call($s,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:Ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof On&&Vs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class o{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function I(i,t=1){let r=0,s=0;return{members:i.map(l=>{const d=a[l.type].BYTES_PER_ELEMENT,f=r=w(r,Math.max(t,d)),_=l.components||1;return s=Math.max(s,d),r+=d*_,{name:l.name,type:l.type,components:_,offset:f}}),size:w(r,Math.max(s,t)),alignment:t}}function w(i,t){return Math.ceil(i/t)*t}class C extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}C.prototype.bytesPerElement=4,xt("StructArrayLayout2i4",C);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=l,t}}M.prototype.bytesPerElement=6,xt("StructArrayLayout3i6",M);class F extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const f=4*t;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=l,this.int16[f+3]=d,t}}F.prototype.bytesPerElement=8,xt("StructArrayLayout4i8",F);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=_,t}}z.prototype.bytesPerElement=12,xt("StructArrayLayout2i4i12",z);class $ extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=4*t,E=8*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[E+4]=l,this.uint8[E+5]=d,this.uint8[E+6]=f,this.uint8[E+7]=_,t}}$.prototype.bytesPerElement=8,xt("StructArrayLayout2i4ub8",$);class te extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}te.prototype.bytesPerElement=8,xt("StructArrayLayout2f8",te);class le extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,E,D){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,s,l,d,f,_,b,E,D)}emplace(t,r,s,l,d,f,_,b,E,D,R){const O=10*t;return this.uint16[O+0]=r,this.uint16[O+1]=s,this.uint16[O+2]=l,this.uint16[O+3]=d,this.uint16[O+4]=f,this.uint16[O+5]=_,this.uint16[O+6]=b,this.uint16[O+7]=E,this.uint16[O+8]=D,this.uint16[O+9]=R,t}}le.prototype.bytesPerElement=20,xt("StructArrayLayout10ui20",le);class m extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,E,D,R,O){const Y=this.length;return this.resize(Y+1),this.emplace(Y,t,r,s,l,d,f,_,b,E,D,R,O)}emplace(t,r,s,l,d,f,_,b,E,D,R,O,Y){const W=12*t;return this.int16[W+0]=r,this.int16[W+1]=s,this.int16[W+2]=l,this.int16[W+3]=d,this.uint16[W+4]=f,this.uint16[W+5]=_,this.uint16[W+6]=b,this.uint16[W+7]=E,this.int16[W+8]=D,this.int16[W+9]=R,this.int16[W+10]=O,this.int16[W+11]=Y,t}}m.prototype.bytesPerElement=24,xt("StructArrayLayout4i4ui4i24",m);class g extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}g.prototype.bytesPerElement=12,xt("StructArrayLayout3f12",g);class A extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}A.prototype.bytesPerElement=4,xt("StructArrayLayout1ul4",A);class v extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,E){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,s,l,d,f,_,b,E)}emplace(t,r,s,l,d,f,_,b,E,D){const R=10*t,O=5*t;return this.int16[R+0]=r,this.int16[R+1]=s,this.int16[R+2]=l,this.int16[R+3]=d,this.int16[R+4]=f,this.int16[R+5]=_,this.uint32[O+3]=b,this.uint16[R+8]=E,this.uint16[R+9]=D,t}}v.prototype.bytesPerElement=20,xt("StructArrayLayout6i1ul2ui20",v);class x extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=_,t}}x.prototype.bytesPerElement=12,xt("StructArrayLayout2i2i2i12",x);class k extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l,d)}emplace(t,r,s,l,d,f){const _=4*t,b=8*t;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=l,this.int16[b+6]=d,this.int16[b+7]=f,t}}k.prototype.bytesPerElement=16,xt("StructArrayLayout2f1f2i16",k);class P extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,l,d,f)}emplace(t,r,s,l,d,f,_){const b=16*t,E=4*t,D=8*t;return this.uint8[b+0]=r,this.uint8[b+1]=s,this.float32[E+1]=l,this.float32[E+2]=d,this.int16[D+6]=f,this.int16[D+7]=_,t}}P.prototype.bytesPerElement=16,xt("StructArrayLayout2ub2f2i16",P);class S extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=l,t}}S.prototype.bytesPerElement=6,xt("StructArrayLayout3ui6",S);class V extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,E,D,R,O,Y,W,X,pe,be){const Re=this.length;return this.resize(Re+1),this.emplace(Re,t,r,s,l,d,f,_,b,E,D,R,O,Y,W,X,pe,be)}emplace(t,r,s,l,d,f,_,b,E,D,R,O,Y,W,X,pe,be,Re){const Ee=24*t,Pe=12*t,Ve=48*t;return this.int16[Ee+0]=r,this.int16[Ee+1]=s,this.uint16[Ee+2]=l,this.uint16[Ee+3]=d,this.uint32[Pe+2]=f,this.uint32[Pe+3]=_,this.uint32[Pe+4]=b,this.uint16[Ee+10]=E,this.uint16[Ee+11]=D,this.uint16[Ee+12]=R,this.float32[Pe+7]=O,this.float32[Pe+8]=Y,this.uint8[Ve+36]=W,this.uint8[Ve+37]=X,this.uint8[Ve+38]=pe,this.uint32[Pe+10]=be,this.int16[Ee+22]=Re,t}}V.prototype.bytesPerElement=48,xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",V);class U extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,d,f,_,b,E,D,R,O,Y,W,X,pe,be,Re,Ee,Pe,Ve,st,St,$t,kt,vt,Ut,Rt){const Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,t,r,s,l,d,f,_,b,E,D,R,O,Y,W,X,pe,be,Re,Ee,Pe,Ve,st,St,$t,kt,vt,Ut,Rt)}emplace(t,r,s,l,d,f,_,b,E,D,R,O,Y,W,X,pe,be,Re,Ee,Pe,Ve,st,St,$t,kt,vt,Ut,Rt,Mt){const We=32*t,qt=16*t;return this.int16[We+0]=r,this.int16[We+1]=s,this.int16[We+2]=l,this.int16[We+3]=d,this.int16[We+4]=f,this.int16[We+5]=_,this.int16[We+6]=b,this.int16[We+7]=E,this.uint16[We+8]=D,this.uint16[We+9]=R,this.uint16[We+10]=O,this.uint16[We+11]=Y,this.uint16[We+12]=W,this.uint16[We+13]=X,this.uint16[We+14]=pe,this.uint16[We+15]=be,this.uint16[We+16]=Re,this.uint16[We+17]=Ee,this.uint16[We+18]=Pe,this.uint16[We+19]=Ve,this.uint16[We+20]=st,this.uint16[We+21]=St,this.uint16[We+22]=$t,this.uint32[qt+12]=kt,this.float32[qt+13]=vt,this.float32[qt+14]=Ut,this.uint16[We+30]=Rt,this.uint16[We+31]=Mt,t}}U.prototype.bytesPerElement=64,xt("StructArrayLayout8i15ui1ul2f2ui64",U);class q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}q.prototype.bytesPerElement=4,xt("StructArrayLayout1f4",q);class re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=3*t;return this.uint16[6*t+0]=r,this.float32[d+1]=s,this.float32[d+2]=l,t}}re.prototype.bytesPerElement=12,xt("StructArrayLayout1ui2f12",re);class Z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const d=4*t;return this.uint32[2*t+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=l,t}}Z.prototype.bytesPerElement=8,xt("StructArrayLayout1ul2ui8",Z);class N extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}N.prototype.bytesPerElement=4,xt("StructArrayLayout2ui4",N);class se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}se.prototype.bytesPerElement=2,xt("StructArrayLayout1ui2",se);class ce extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,l)}emplace(t,r,s,l,d){const f=4*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.float32[f+3]=d,t}}ce.prototype.bytesPerElement=16,xt("StructArrayLayout4f16",ce);class ae extends o{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new me(this.anchorPointX,this.anchorPointY)}}ae.prototype.size=20;class Ae extends v{get(t){return new ae(this,t)}}xt("CollisionBoxArray",Ae);class ve extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ve.prototype.size=48;class Ie extends V{get(t){return new ve(this,t)}}xt("PlacedSymbolArray",Ie);class ke extends o{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ke.prototype.size=64;class K extends U{get(t){return new ke(this,t)}}xt("SymbolInstanceArray",K);class G extends q{getoffsetX(t){return this.float32[1*t+0]}}xt("GlyphOffsetArray",G);class ue extends M{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}xt("SymbolLineVertexArray",ue);class ie extends o{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ie.prototype.size=12;class oe extends re{get(t){return new ie(this,t)}}xt("TextAnchorOffsetArray",oe);class de extends o{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}de.prototype.size=8;class Se extends Z{get(t){return new de(this,t)}}xt("FeatureIndexArray",Se);class Be extends C{}class Qe extends C{}class Ge extends C{}class He extends z{}class Ke extends ${}class tt extends te{}class mt extends le{}class Oe extends m{}class Fe extends g{}class et extends A{}class Dt extends x{}class At extends P{}class Lt extends S{}class ht extends N{}const Ct=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:It}=Ct;class ct{constructor(t=[]){this.segments=t}prepareSegment(t,r,s,l){let d=this.segments[this.segments.length-1];return t>ct.MAX_VERTEX_ARRAY_LENGTH&&Ot(`Max vertices per segment is ${ct.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>ct.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new ct([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function Et(i,t){return 256*(i=lt(Math.floor(i),0,255))+lt(Math.floor(t),0,255)}ct.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt("SegmentVector",ct);const bi=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ui={exports:{}},vi={exports:{}};vi.exports=function(i,t){var r,s,l,d,f,_,b,E;for(s=i.length-(r=3&i.length),l=t,f=3432918353,_=461845907,E=0;E<s;)b=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,l=27492+(65535&(d=5*(65535&(l=(l^=b=(65535&(b=(b=(65535&b)*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&i.charCodeAt(E+2))<<16;case 2:b^=(255&i.charCodeAt(E+1))<<8;case 1:l^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(E)))*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295}return l^=i.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0};var xi=vi.exports,tn={exports:{}};tn.exports=function(i,t){for(var r,s=i.length,l=t^s,d=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:l^=(255&i.charCodeAt(d+2))<<16;case 2:l^=(255&i.charCodeAt(d+1))<<8;case 1:l=1540483477*(65535&(l^=255&i.charCodeAt(d)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0};var xr=xi,Ss=tn.exports;ui.exports=xr,ui.exports.murmur3=xr,ui.exports.murmur2=Ss;var ii=ne(ui.exports);class rn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(Qn(t)),this.positions.push(r,s,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Qn(t);let s=0,l=this.ids.length-1;for(;s<l;){const f=s+l>>1;this.ids[f]>=r?l=f:s=f+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return ro(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(t){const r=new rn;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Qn(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ii(String(i))}function ro(i,t,r,s){for(;r<s;){const l=i[r+s>>1];let d=r-1,f=s+1;for(;;){do d++;while(i[d]<l);do f--;while(i[f]>l);if(d>=f)break;ls(i,d,f),ls(t,3*d,3*f),ls(t,3*d+1,3*f+1),ls(t,3*d+2,3*f+2)}f-r<s-f?(ro(i,t,r,f),r=f+1):(ro(i,t,f+1,s),s=f)}}function ls(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}xt("FeaturePositionMap",rn);class gr{constructor(t,r){this.gl=t.gl,this.location=r}}class Ma extends gr{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class jc extends gr{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Jc extends gr{constructor(t,r){super(t,r),this.current=Ri.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const rc=new Float32Array(16);function qn(i){return[Et(255*i.r,255*i.g),Et(255*i.b,255*i.a)]}class Fr{constructor(t,r,s){this.value=t,this.uniformNames=r.map(l=>`u_${l}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new Jc(t,r):new Ma(t,r)}}class no{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,l){const d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new jc(t,r):new Ma(t,r)}}class cs{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,d){const f=this.paintVertexArray.length,_=this.expression.evaluate(new Vi(0),r,{},l,[],d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,_)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(t,r,d)}_setPaintValue(t,r,s){if(this.type==="color"){const l=qn(s);for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ra{constructor(t,r,s,l,d,f){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,s,l,d){const f=this.expression.evaluate(new Vi(this.zoom),r,{},l,[],d),_=this.expression.evaluate(new Vi(this.zoom+1),r,{},l,[],d),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,f,_)}updatePaintArray(t,r,s,l){const d=this.expression.evaluate({zoom:this.zoom},s,l),f=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(t,r,d,f)}_setPaintValue(t,r,s,l){if(this.type==="color"){const d=qn(s),f=qn(l);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1],f[0],f[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=lt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,s){return new Ma(t,r)}}class qo{constructor(t,r,s,l,d,f){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,d){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(t,r,s,l){if(!l||!s)return;const{min:d,mid:f,max:_}=s,b=l[d],E=l[f],D=l[_];if(b&&E&&D)for(let R=t;R<r;R++)this.zoomInPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],E.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],E.pixelRatio,D.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,bi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,bi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bu{constructor(t,r,s){this.binders={},this._buffers=[];const l=[];for(const d in t.paint._values){if(!s(d))continue;const f=t.paint.get(d);if(!(f instanceof On&&Vs(f.property.specification)))continue;const _=af(d,t.type),b=f.value,E=f.property.specification.type,D=f.property.useIntegerZoom,R=f.property.specification["property-type"],O=R==="cross-faded"||R==="cross-faded-data-driven";if(b.kind==="constant")this.binders[d]=O?new no(b.value,_):new Fr(b.value,_,E),l.push(`/u_${d}`);else if(b.kind==="source"||O){const Y=wu(d,E,"source");this.binders[d]=O?new qo(b,E,D,r,Y,t.id):new cs(b,_,E,Y),l.push(`/a_${d}`)}else{const Y=wu(d,E,"composite");this.binders[d]=new ra(b,_,E,D,r,Y),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof cs||r instanceof ra?r.maxValue:0}populatePaintArrays(t,r,s,l,d){for(const f in this.binders){const _=this.binders[f];(_ instanceof cs||_ instanceof ra||_ instanceof qo)&&_.populatePaintArray(t,r,s,l,d)}}setConstantPatternPositions(t,r){for(const s in this.binders){const l=this.binders[s];l instanceof no&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,l,d){let f=!1;for(const _ in t){const b=r.getPositions(_);for(const E of b){const D=s.feature(E.index);for(const R in this.binders){const O=this.binders[R];if((O instanceof cs||O instanceof ra||O instanceof qo)&&O.expression.isStateDependent===!0){const Y=l.paint.get(R);O.expression=Y.value,O.updatePaintArray(E.start,E.end,D,t[_],d),f=!0}}}}return f}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Fr||s instanceof no)&&t.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof cs||s instanceof ra)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name);else if(s instanceof qo)for(let l=0;l<bi.members.length;l++)t.push(bi.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Fr||s instanceof no||s instanceof ra)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Fr||d instanceof no||d instanceof ra){for(const f of d.uniformNames)if(r[f]){const _=d.getBinding(t,r[f],f);s.push({name:f,property:l,binding:_})}}}return s}setUniforms(t,r,s,l){for(const{name:d,property:f,binding:_}of r)this.binders[f].setUniform(_,l,s.get(f),d)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof qo){const l=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof cs||s instanceof ra)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof cs||s instanceof ra||s instanceof qo)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof cs||r instanceof ra||r instanceof qo)&&r.destroy()}}}class Tl{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new bu(l,r,s);this.needsUpload=!1,this._featureMap=new rn,this._bufferOffset=0}populatePaintArrays(t,r,s,l,d,f){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,l,d,f);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,r,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function af(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function wu(i,t,r){const s={color:{source:te,composite:ce},number:{source:q,composite:te}},l=function(d){return{"line-pattern":{source:mt,composite:mt},"fill-pattern":{source:mt,composite:mt},"fill-extrusion-pattern":{source:mt,composite:mt}}[d]}(i);return l&&l[r]||s[t][r]}xt("ConstantBinder",Fr),xt("CrossFadedConstantBinder",no),xt("SourceExpressionBinder",cs),xt("CrossFadedCompositeBinder",qo),xt("CompositeExpressionBinder",ra),xt("ProgramConfiguration",bu,{omit:["_buffers"]}),xt("ProgramConfigurationSet",Tl);const pr=8192,_h=Math.pow(2,14)-1,vu=-_h-1;function Pl(i){const t=pr/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let d=0;d<l.length;d++){const f=l[d],_=Math.round(f.x*t),b=Math.round(f.y*t);f.x=lt(_,vu,_h),f.y=lt(b,vu,_h),(_<f.x||_>f.x+1||b<f.y||b>f.y+1)&&Ot("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ll(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Pl(i):[]}}function Yc(i,t,r,s,l){i.emplaceBack(2*t+(s+1)/2,2*r+(l+1)/2)}class Ih{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Qe,this.indexArray=new Lt,this.segments=new ct,this.programConfigurations=new Tl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const l=this.layers[0],d=[];let f=null,_=!1;l.type==="circle"&&(f=l.layout.get("circle-sort-key"),_=!f.isConstant());for(const{feature:b,id:E,index:D,sourceLayerIndex:R}of t){const O=this.layers[0]._featureFilter.needGeometry,Y=Ll(b,O);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),Y,s))continue;const W=_?f.evaluate(Y,{},s):void 0,X={id:E,properties:b.properties,type:b.type,sourceLayerIndex:R,index:D,geometry:O?Y.geometry:Pl(b),patterns:{},sortKey:W};d.push(X)}_&&d.sort((b,E)=>b.sortKey-E.sortKey);for(const b of d){const{geometry:E,index:D,sourceLayerIndex:R}=b,O=t[D].feature;this.addFeature(b,E,D,s),r.featureIndex.insert(O,E,D,R,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,It),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l){for(const d of r)for(const f of d){const _=f.x,b=f.y;if(_<0||_>=pr||b<0||b>=pr)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),D=E.vertexLength;Yc(this.layoutVertexArray,_,b,-1,-1),Yc(this.layoutVertexArray,_,b,1,-1),Yc(this.layoutVertexArray,_,b,1,1),Yc(this.layoutVertexArray,_,b,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l)}}function xu(i,t){for(let r=0;r<i.length;r++)if(nc(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(nc(i,t[r]))return!0;return!!bh(i,t)}function of(i,t,r){return!!nc(i,t)||!!wh(t,i,r)}function Bu(i,t){if(i.length===1)return Eu(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if(nc(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(Eu(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(bh(i,t[r]))return!0;return!1}function lf(i,t,r){if(i.length>1){if(bh(i,t))return!0;for(let s=0;s<t.length;s++)if(wh(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if(wh(i[s],t,r))return!0;return!1}function bh(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let d=0;d<t.length-1;d++)if(cf(s,l,t[d],t[d+1]))return!0}return!1}function cf(i,t,r,s){return Yt(i,r,s)!==Yt(t,r,s)&&Yt(i,t,r)!==Yt(i,t,s)}function wh(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(Cu(i,t[l-1],t[l])<s)return!0;return!1}function Cu(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function Eu(i,t){let r,s,l,d=!1;for(let f=0;f<i.length;f++){r=i[f];for(let _=0,b=r.length-1;_<r.length;b=_++)s=r[_],l=r[b],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(d=!d)}return d}function nc(i,t){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const d=i[s],f=i[l];d.y>t.y!=f.y>t.y&&t.x<(f.x-d.x)*(t.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function hf(i,t,r){const s=r[0],l=r[2];if(i.x<s.x&&t.x<s.x||i.x>l.x&&t.x>l.x||i.y<s.y&&t.y<s.y||i.y>l.y&&t.y>l.y)return!1;const d=Yt(i,t,r[0]);return d!==Yt(i,t,r[1])||d!==Yt(i,t,r[2])||d!==Yt(i,t,r[3])}function Cc(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Kc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Zc(i,t,r,s,l){if(!t[0]&&!t[1])return i;const d=me.convert(t)._mult(l);r==="viewport"&&d._rotate(-s);const f=[];for(let _=0;_<i.length;_++)f.push(i[_].sub(d));return f}let Qu,ku;xt("CircleBucket",Ih,{omit:["layers"]});var uf={get paint(){return ku=ku||new u({"circle-radius":new jt(Ne.paint_circle["circle-radius"]),"circle-color":new jt(Ne.paint_circle["circle-color"]),"circle-blur":new jt(Ne.paint_circle["circle-blur"]),"circle-opacity":new jt(Ne.paint_circle["circle-opacity"]),"circle-translate":new zt(Ne.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(Ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(Ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(Ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jt(Ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jt(Ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jt(Ne.paint_circle["circle-stroke-opacity"])})},get layout(){return Qu=Qu||new u({"circle-sort-key":new jt(Ne.layout_circle["circle-sort-key"])})}},dn=1e-6,sc=typeof Float32Array<"u"?Float32Array:Array;function vh(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Su(i,t,r){var s=t[0],l=t[1],d=t[2],f=t[3],_=t[4],b=t[5],E=t[6],D=t[7],R=t[8],O=t[9],Y=t[10],W=t[11],X=t[12],pe=t[13],be=t[14],Re=t[15],Ee=r[0],Pe=r[1],Ve=r[2],st=r[3];return i[0]=Ee*s+Pe*_+Ve*R+st*X,i[1]=Ee*l+Pe*b+Ve*O+st*pe,i[2]=Ee*d+Pe*E+Ve*Y+st*be,i[3]=Ee*f+Pe*D+Ve*W+st*Re,i[4]=(Ee=r[4])*s+(Pe=r[5])*_+(Ve=r[6])*R+(st=r[7])*X,i[5]=Ee*l+Pe*b+Ve*O+st*pe,i[6]=Ee*d+Pe*E+Ve*Y+st*be,i[7]=Ee*f+Pe*D+Ve*W+st*Re,i[8]=(Ee=r[8])*s+(Pe=r[9])*_+(Ve=r[10])*R+(st=r[11])*X,i[9]=Ee*l+Pe*b+Ve*O+st*pe,i[10]=Ee*d+Pe*E+Ve*Y+st*be,i[11]=Ee*f+Pe*D+Ve*W+st*Re,i[12]=(Ee=r[12])*s+(Pe=r[13])*_+(Ve=r[14])*R+(st=r[15])*X,i[13]=Ee*l+Pe*b+Ve*O+st*pe,i[14]=Ee*d+Pe*E+Ve*Y+st*be,i[15]=Ee*f+Pe*D+Ve*W+st*Re,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Ec,Af=Su;function $c(i,t,r){var s=t[0],l=t[1],d=t[2],f=t[3];return i[0]=r[0]*s+r[4]*l+r[8]*d+r[12]*f,i[1]=r[1]*s+r[5]*l+r[9]*d+r[13]*f,i[2]=r[2]*s+r[6]*l+r[10]*d+r[14]*f,i[3]=r[3]*s+r[7]*l+r[11]*d+r[15]*f,i}Ec=new sc(4),sc!=Float32Array&&(Ec[0]=0,Ec[1]=0,Ec[2]=0,Ec[3]=0);class df extends n{constructor(t){super(t,uf)}createBucket(t){return new Ih(t)}queryRadius(t){const r=t;return Cc("circle-radius",this,r)+Cc("circle-stroke-width",this,r)+Kc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,s,l,d,f,_,b){const E=Zc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,_),D=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),R=this.paint.get("circle-pitch-alignment")==="map",O=R?E:function(W,X){return W.map(pe=>Du(pe,X))}(E,b),Y=R?D*_:D;for(const W of l)for(const X of W){const pe=R?X:Du(X,b);let be=Y;const Re=$c([],[X.x,X.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?be*=Re[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(be*=f.cameraToCenterDistance/Re[3]),of(O,pe,be))return!0}return!1}}function Du(i,t){const r=$c([],[i.x,i.y,0,1],t);return new me(r[0]/r[3],r[1]/r[3])}class Mu extends Ih{}let Tu;xt("HeatmapBucket",Mu,{omit:["layers"]});var ff={get paint(){return Tu=Tu||new u({"heatmap-radius":new jt(Ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jt(Ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(Ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ml(Ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(Ne.paint_heatmap["heatmap-opacity"])})}};function xh(i,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*s}`)}else l=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=l,i}function Pu(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const l=xh({},{width:t,height:r},s);Bh(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=l.data}function Bh(i,t,r,s,l,d){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,_=t.data;if(f===_)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<l.height;b++){const E=((r.y+b)*i.width+r.x)*d,D=((s.y+b)*t.width+s.x)*d;for(let R=0;R<l.width*d;R++)_[D+R]=f[E+R]}return t}class Qc{constructor(t,r){xh(this,t,1,r)}resize(t){Pu(this,t,1)}clone(){return new Qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){Bh(t,r,s,l,d,1)}}class hs{constructor(t,r){xh(this,t,4,r)}resize(t){Pu(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,d){Bh(t,r,s,l,d,4)}}function Lu(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new hs({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,_,b)=>{t[i.evaluationKey]=b;const E=i.expression.evaluate(t);l.data[f+_+0]=Math.floor(255*E.r/E.a),l.data[f+_+1]=Math.floor(255*E.g/E.a),l.data[f+_+2]=Math.floor(255*E.b/E.a),l.data[f+_+3]=Math.floor(255*E.a)};if(i.clips)for(let f=0,_=0;f<s;++f,_+=4*r)for(let b=0,E=0;b<r;b++,E+=4){const D=b/(r-1),{start:R,end:O}=i.clips[f];d(_,E,R*(1-D)+O*D)}else for(let f=0,_=0;f<r;f++,_+=4)d(0,_,f/(r-1));return l}xt("AlphaImage",Qc),xt("RGBAImage",hs);const Ch="big-fb";class gf extends n{createBucket(t){return new Mu(t)}constructor(t){super(t,ff),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ch)&&this.heatmapFbos.delete(Ch)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Ru;var pf={get paint(){return Ru=Ru||new u({"hillshade-illumination-direction":new zt(Ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(Ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(Ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(Ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(Ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(Ne.paint_hillshade["hillshade-accent-color"])})}};class mf extends n{constructor(t){super(t,pf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const yf=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:_f}=yf;function Fu(i,t,r=2){const s=t&&t.length,l=s?t[0]*r:i.length;let d=zu(i,0,l,r,!0);const f=[];if(!d||d.next===d.prev)return f;let _,b,E;if(s&&(d=function(D,R,O,Y){const W=[];for(let X=0,pe=R.length;X<pe;X++){const be=zu(D,R[X]*Y,X<pe-1?R[X+1]*Y:D.length,Y,!1);be===be.next&&(be.steiner=!0),W.push(Ef(be))}W.sort(xf);for(let X=0;X<W.length;X++)O=Bf(W[X],O);return O}(i,t,d,r)),i.length>80*r){_=1/0,b=1/0;let D=-1/0,R=-1/0;for(let O=r;O<l;O+=r){const Y=i[O],W=i[O+1];Y<_&&(_=Y),W<b&&(b=W),Y>D&&(D=Y),W>R&&(R=W)}E=Math.max(D-_,R-b),E=E!==0?32767/E:0}return kc(d,f,r,_,b,E,0),f}function zu(i,t,r,s,l){let d;if(l===function(f,_,b,E){let D=0;for(let R=_,O=b-E;R<b;R+=E)D+=(f[O]-f[R])*(f[R+1]+f[O+1]),O=R;return D}(i,t,r,s)>0)for(let f=t;f<r;f+=s)d=Nu(f/s|0,i[f],i[f+1],d);else for(let f=r-s;f>=t;f-=s)d=Nu(f/s|0,i[f],i[f+1],d);return d&&Wc(d,d.next)&&(Dc(d),d=d.next),d}function Rl(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!Wc(s,s.next)&&ur(s.prev,s,s.next)!==0)s=s.next;else{if(Dc(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function kc(i,t,r,s,l,d,f){if(!i)return;!f&&d&&function(b,E,D,R){let O=b;do O.z===0&&(O.z=Eh(O.x,O.y,E,D,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==b);O.prevZ.nextZ=null,O.prevZ=null,function(Y){let W,X=1;do{let pe,be=Y;Y=null;let Re=null;for(W=0;be;){W++;let Ee=be,Pe=0;for(let st=0;st<X&&(Pe++,Ee=Ee.nextZ,Ee);st++);let Ve=X;for(;Pe>0||Ve>0&&Ee;)Pe!==0&&(Ve===0||!Ee||be.z<=Ee.z)?(pe=be,be=be.nextZ,Pe--):(pe=Ee,Ee=Ee.nextZ,Ve--),Re?Re.nextZ=pe:Y=pe,pe.prevZ=Re,Re=pe;be=Ee}Re.nextZ=null,X*=2}while(W>1)}(O)}(i,s,l,d);let _=i;for(;i.prev!==i.next;){const b=i.prev,E=i.next;if(d?bf(i,s,l,d):If(i))t.push(b.i,i.i,E.i),Dc(i),i=E.next,_=E.next;else if((i=E)===_){f?f===1?kc(i=wf(Rl(i),t),t,r,s,l,d,2):f===2&&vf(i,t,r,s,l,d):kc(Rl(i),t,r,s,l,d,1);break}}}function If(i){const t=i.prev,r=i,s=i.next;if(ur(t,r,s)>=0)return!1;const l=t.x,d=r.x,f=s.x,_=t.y,b=r.y,E=s.y,D=l<d?l<f?l:f:d<f?d:f,R=_<b?_<E?_:E:b<E?b:E,O=l>d?l>f?l:f:d>f?d:f,Y=_>b?_>E?_:E:b>E?b:E;let W=s.next;for(;W!==t;){if(W.x>=D&&W.x<=O&&W.y>=R&&W.y<=Y&&ac(l,_,d,b,f,E,W.x,W.y)&&ur(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function bf(i,t,r,s){const l=i.prev,d=i,f=i.next;if(ur(l,d,f)>=0)return!1;const _=l.x,b=d.x,E=f.x,D=l.y,R=d.y,O=f.y,Y=_<b?_<E?_:E:b<E?b:E,W=D<R?D<O?D:O:R<O?R:O,X=_>b?_>E?_:E:b>E?b:E,pe=D>R?D>O?D:O:R>O?R:O,be=Eh(Y,W,t,r,s),Re=Eh(X,pe,t,r,s);let Ee=i.prevZ,Pe=i.nextZ;for(;Ee&&Ee.z>=be&&Pe&&Pe.z<=Re;){if(Ee.x>=Y&&Ee.x<=X&&Ee.y>=W&&Ee.y<=pe&&Ee!==l&&Ee!==f&&ac(_,D,b,R,E,O,Ee.x,Ee.y)&&ur(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,Pe.x>=Y&&Pe.x<=X&&Pe.y>=W&&Pe.y<=pe&&Pe!==l&&Pe!==f&&ac(_,D,b,R,E,O,Pe.x,Pe.y)&&ur(Pe.prev,Pe,Pe.next)>=0))return!1;Pe=Pe.nextZ}for(;Ee&&Ee.z>=be;){if(Ee.x>=Y&&Ee.x<=X&&Ee.y>=W&&Ee.y<=pe&&Ee!==l&&Ee!==f&&ac(_,D,b,R,E,O,Ee.x,Ee.y)&&ur(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;Pe&&Pe.z<=Re;){if(Pe.x>=Y&&Pe.x<=X&&Pe.y>=W&&Pe.y<=pe&&Pe!==l&&Pe!==f&&ac(_,D,b,R,E,O,Pe.x,Pe.y)&&ur(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.nextZ}return!0}function wf(i,t){let r=i;do{const s=r.prev,l=r.next.next;!Wc(s,l)&&Gu(s,r,r.next,l)&&Sc(s,l)&&Sc(l,s)&&(t.push(s.i,r.i,l.i),Dc(r),Dc(r.next),r=i=l),r=r.next}while(r!==i);return Rl(r)}function vf(i,t,r,s,l,d){let f=i;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&Qf(f,_)){let b=Uu(f,_);return f=Rl(f,f.next),b=Rl(b,b.next),kc(f,t,r,s,l,d,0),void kc(b,t,r,s,l,d,0)}_=_.next}f=f.next}while(f!==i)}function xf(i,t){return i.x-t.x}function Bf(i,t){const r=function(l,d){let f=d;const _=l.x,b=l.y;let E,D=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const X=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(X<=_&&X>D&&(D=X,E=f.x<f.next.x?f:f.next,X===_))return E}f=f.next}while(f!==d);if(!E)return null;const R=E,O=E.x,Y=E.y;let W=1/0;f=E;do{if(_>=f.x&&f.x>=O&&_!==f.x&&ac(b<Y?_:D,b,O,Y,b<Y?D:_,b,f.x,f.y)){const X=Math.abs(b-f.y)/(_-f.x);Sc(f,l)&&(X<W||X===W&&(f.x>E.x||f.x===E.x&&Cf(E,f)))&&(E=f,W=X)}f=f.next}while(f!==R);return E}(i,t);if(!r)return t;const s=Uu(r,i);return Rl(s,s.next),Rl(r,r.next)}function Cf(i,t){return ur(i.prev,i,t.prev)<0&&ur(t.next,i,i.next)<0}function Eh(i,t,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ef(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function ac(i,t,r,s,l,d,f,_){return(l-f)*(t-_)>=(i-f)*(d-_)&&(i-f)*(s-_)>=(r-f)*(t-_)&&(r-f)*(d-_)>=(l-f)*(s-_)}function Qf(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&Gu(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1}(i,t)&&(Sc(i,t)&&Sc(t,i)&&function(r,s){let l=r,d=!1;const f=(r.x+s.x)/2,_=(r.y+s.y)/2;do l.y>_!=l.next.y>_&&l.next.y!==l.y&&f<(l.next.x-l.x)*(_-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==r);return d}(i,t)&&(ur(i.prev,i,t.prev)||ur(i,t.prev,t))||Wc(i,t)&&ur(i.prev,i,i.next)>0&&ur(t.prev,t,t.next)>0)}function ur(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Wc(i,t){return i.x===t.x&&i.y===t.y}function Gu(i,t,r,s){const l=eh(ur(i,t,r)),d=eh(ur(i,t,s)),f=eh(ur(r,s,i)),_=eh(ur(r,s,t));return l!==d&&f!==_||!(l!==0||!Xc(i,r,t))||!(d!==0||!Xc(i,s,t))||!(f!==0||!Xc(r,i,s))||!(_!==0||!Xc(r,t,s))}function Xc(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function eh(i){return i>0?1:i<0?-1:0}function Sc(i,t){return ur(i.prev,i,i.next)<0?ur(i,t,i.next)>=0&&ur(i,i.prev,t)>=0:ur(i,t,i.prev)<0||ur(i,i.next,t)<0}function Uu(i,t){const r=Qh(i.i,i.x,i.y),s=Qh(t.i,t.x,t.y),l=i.next,d=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function Nu(i,t,r,s){const l=Qh(i,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function Dc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Qh(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function kh(i,t,r){const s=r.patternDependencies;let l=!1;for(const d of t){const f=d.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const _=f.constantOr(null);_&&(l=!0,s[_.to]=!0,s[_.from]=!0)}return l}function Sh(i,t,r,s,l){const d=l.patternDependencies;for(const f of t){const _=f.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let b=_.evaluate({zoom:s-1},r,{},l.availableImages),E=_.evaluate({zoom:s},r,{},l.availableImages),D=_.evaluate({zoom:s+1},r,{},l.availableImages);b=b&&b.name?b.name:b,E=E&&E.name?E.name:E,D=D&&D.name?D.name:D,d[b]=!0,d[E]=!0,d[D]=!0,r.patterns[f.id]={min:b,mid:E,max:D}}}return r}class Dh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ge,this.indexArray=new Lt,this.indexArray2=new ht,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new ct,this.segments2=new ct,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=kh("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),f=[];for(const{feature:_,id:b,index:E,sourceLayerIndex:D}of t){const R=this.layers[0]._featureFilter.needGeometry,O=Ll(_,R);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),O,s))continue;const Y=d?l.evaluate(O,{},s,r.availableImages):void 0,W={id:b,properties:_.properties,type:_.type,sourceLayerIndex:D,index:E,geometry:R?O.geometry:Pl(_),patterns:{},sortKey:Y};f.push(W)}d&&f.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of f){const{geometry:b,index:E,sourceLayerIndex:D}=_;if(this.hasPattern){const R=Sh("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(_,b,E,s,{});r.featureIndex.insert(t[E].feature,b,E,D,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_f),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,d){for(const f of qa(r,500)){let _=0;for(const Y of f)_+=Y.length;const b=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),E=b.vertexLength,D=[],R=[];for(const Y of f){if(Y.length===0)continue;Y!==f[0]&&R.push(D.length/2);const W=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),X=W.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(X+Y.length-1,X),D.push(Y[0].x),D.push(Y[0].y);for(let pe=1;pe<Y.length;pe++)this.layoutVertexArray.emplaceBack(Y[pe].x,Y[pe].y),this.indexArray2.emplaceBack(X+pe-1,X+pe),D.push(Y[pe].x),D.push(Y[pe].y);W.vertexLength+=Y.length,W.primitiveLength+=Y.length}const O=Fu(D,R);for(let Y=0;Y<O.length;Y+=3)this.indexArray.emplaceBack(E+O[Y],E+O[Y+1],E+O[Y+2]);b.vertexLength+=_,b.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}let Ou,qu;xt("FillBucket",Dh,{omit:["layers","patternFeatures"]});var kf={get paint(){return qu=qu||new u({"fill-antialias":new zt(Ne.paint_fill["fill-antialias"]),"fill-opacity":new jt(Ne.paint_fill["fill-opacity"]),"fill-color":new jt(Ne.paint_fill["fill-color"]),"fill-outline-color":new jt(Ne.paint_fill["fill-outline-color"]),"fill-translate":new zt(Ne.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(Ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new No(Ne.paint_fill["fill-pattern"])})},get layout(){return Ou=Ou||new u({"fill-sort-key":new jt(Ne.layout_fill["fill-sort-key"])})}};class Sf extends n{constructor(t){super(t,kf)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Dh(t)}queryRadius(){return Kc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,s,l,d,f,_){return Bu(Zc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,_),l)}isTileClipped(){return!0}}const Df=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Mf=I([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Tf}=Df;var Vo={},Pf=fe,Vu=oc;function oc(i,t,r,s,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=l,i.readFields(Lf,this,t)}function Lf(i,t,r){i==1?t.id=r.readVarint():i==2?function(s,l){for(var d=s.readVarint()+s.pos;s.pos<d;){var f=l._keys[s.readVarint()],_=l._values[s.readVarint()];l.properties[f]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function Rf(i){for(var t,r,s=0,l=0,d=i.length,f=d-1;l<d;f=l++)s+=((r=i[f]).x-(t=i[l]).x)*(t.y+r.y);return s}oc.types=["Unknown","Point","LineString","Polygon"],oc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,s=1,l=0,d=0,f=0,_=[];i.pos<r;){if(l<=0){var b=i.readVarint();s=7&b,l=b>>3}if(l--,s===1||s===2)d+=i.readSVarint(),f+=i.readSVarint(),s===1&&(t&&_.push(t),t=[]),t.push(new Pf(d,f));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&_.push(t),_},oc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,s=0,l=0,d=0,f=1/0,_=-1/0,b=1/0,E=-1/0;i.pos<t;){if(s<=0){var D=i.readVarint();r=7&D,s=D>>3}if(s--,r===1||r===2)(l+=i.readSVarint())<f&&(f=l),l>_&&(_=l),(d+=i.readSVarint())<b&&(b=d),d>E&&(E=d);else if(r!==7)throw new Error("unknown command "+r)}return[f,b,_,E]},oc.prototype.toGeoJSON=function(i,t,r){var s,l,d=this.extent*Math.pow(2,r),f=this.extent*i,_=this.extent*t,b=this.loadGeometry(),E=oc.types[this.type];function D(Y){for(var W=0;W<Y.length;W++){var X=Y[W];Y[W]=[360*(X.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(s=0;s<b.length;s++)R[s]=b[s][0];D(b=R);break;case 2:for(s=0;s<b.length;s++)D(b[s]);break;case 3:for(b=function(Y){var W=Y.length;if(W<=1)return[Y];for(var X,pe,be=[],Re=0;Re<W;Re++){var Ee=Rf(Y[Re]);Ee!==0&&(pe===void 0&&(pe=Ee<0),pe===Ee<0?(X&&be.push(X),X=[Y[Re]]):X.push(Y[Re]))}return X&&be.push(X),be}(b),s=0;s<b.length;s++)for(l=0;l<b[s].length;l++)D(b[s][l])}b.length===1?b=b[0]:E="Multi"+E;var O={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Ff=Vu,Hu=ju;function ju(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(zf,this,t),this.length=this._features.length}function zf(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(s){for(var l=null,d=s.readVarint()+s.pos;s.pos<d;){var f=s.readVarint()>>3;l=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return l}(r))}ju.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Ff(this._pbf,t,this.extent,this._keys,this._values)};var Gf=Hu;function Uf(i,t,r){if(i===3){var s=new Gf(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}Vo.VectorTile=function(i,t){this.layers=i.readFields(Uf,{},t)},Vo.VectorTileFeature=Vu,Vo.VectorTileLayer=Hu;const Nf=Vo.VectorTileFeature.types,Mh=Math.pow(2,13);function Mc(i,t,r,s,l,d,f,_){i.emplaceBack(t,r,2*Math.floor(s*Mh)+f,l*Mh*2,d*Mh*2,Math.round(_))}class Th{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new He,this.centroidVertexArray=new Be,this.indexArray=new Lt,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new ct,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=kh("fill-extrusion",this.layers,r);for(const{feature:l,id:d,index:f,sourceLayerIndex:_}of t){const b=this.layers[0]._featureFilter.needGeometry,E=Ll(l,b);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),E,s))continue;const D={id:d,sourceLayerIndex:_,index:f,geometry:b?E.geometry:Pl(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Sh("fill-extrusion",this.layers,D,this.zoom,r)):this.addFeature(D,D.geometry,f,s,{}),r.featureIndex.insert(l,D.geometry,f,_,this.index,!0)}}addFeatures(t,r,s){for(const l of this.features){const{geometry:d}=l;this.addFeature(l,d,l.index,r,s)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tf),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Mf.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,l,d){for(const f of qa(r,500)){const _={x:0,y:0,vertexCount:0};let b=0;for(const W of f)b+=W.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const W of f){if(W.length===0||qf(W))continue;let X=0;for(let pe=0;pe<W.length;pe++){const be=W[pe];if(pe>=1){const Re=W[pe-1];if(!Of(be,Re)){E.vertexLength+4>ct.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ee=be.sub(Re)._perp()._unit(),Pe=Re.dist(be);X+Pe>32768&&(X=0),Mc(this.layoutVertexArray,be.x,be.y,Ee.x,Ee.y,0,0,X),Mc(this.layoutVertexArray,be.x,be.y,Ee.x,Ee.y,0,1,X),_.x+=2*be.x,_.y+=2*be.y,_.vertexCount+=2,X+=Pe,Mc(this.layoutVertexArray,Re.x,Re.y,Ee.x,Ee.y,0,0,X),Mc(this.layoutVertexArray,Re.x,Re.y,Ee.x,Ee.y,0,1,X),_.x+=2*Re.x,_.y+=2*Re.y,_.vertexCount+=2;const Ve=E.vertexLength;this.indexArray.emplaceBack(Ve,Ve+2,Ve+1),this.indexArray.emplaceBack(Ve+1,Ve+2,Ve+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+b>ct.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),Nf[t.type]!=="Polygon")continue;const D=[],R=[],O=E.vertexLength;for(const W of f)if(W.length!==0){W!==f[0]&&R.push(D.length/2);for(let X=0;X<W.length;X++){const pe=W[X];Mc(this.layoutVertexArray,pe.x,pe.y,0,0,1,1,0),_.x+=pe.x,_.y+=pe.y,_.vertexCount+=1,D.push(pe.x),D.push(pe.y)}}const Y=Fu(D,R);for(let W=0;W<Y.length;W+=3)this.indexArray.emplaceBack(O+Y[W],O+Y[W+2],O+Y[W+1]);E.primitiveLength+=Y.length/3,E.vertexLength+=b;for(let W=0;W<_.vertexCount;W++){const X=Math.floor(_.x/_.vertexCount),pe=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(X,pe)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}}function Of(i,t){return i.x===t.x&&(i.x<0||i.x>pr)||i.y===t.y&&(i.y<0||i.y>pr)}function qf(i){return i.every(t=>t.x<0)||i.every(t=>t.x>pr)||i.every(t=>t.y<0)||i.every(t=>t.y>pr)}let Ju;xt("FillExtrusionBucket",Th,{omit:["layers","features"]});var Vf={get paint(){return Ju=Ju||new u({"fill-extrusion-opacity":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jt(Ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new No(Ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jt(Ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jt(Ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(Ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hf extends n{constructor(t){super(t,Vf)}createBucket(t){return new Th(t)}queryRadius(){return Kc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,s,l,d,f,_,b){const E=Zc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,_),D=this.paint.get("fill-extrusion-height").evaluate(r,s),R=this.paint.get("fill-extrusion-base").evaluate(r,s),O=function(W,X,pe,be){const Re=[];for(const Ee of W){const Pe=[Ee.x,Ee.y,0,1];$c(Pe,Pe,X),Re.push(new me(Pe[0]/Pe[3],Pe[1]/Pe[3]))}return Re}(E,b),Y=function(W,X,pe,be){const Re=[],Ee=[],Pe=be[8]*X,Ve=be[9]*X,st=be[10]*X,St=be[11]*X,$t=be[8]*pe,kt=be[9]*pe,vt=be[10]*pe,Ut=be[11]*pe;for(const Rt of W){const Mt=[],We=[];for(const qt of Rt){const Gt=qt.x,ni=qt.y,Hi=be[0]*Gt+be[4]*ni+be[12],Oi=be[1]*Gt+be[5]*ni+be[13],Br=be[2]*Gt+be[6]*ni+be[14],Ds=be[3]*Gt+be[7]*ni+be[15],Gr=Br+st,Cr=Ds+St,fn=Hi+$t,gn=Oi+kt,pn=Br+vt,or=Ds+Ut,Er=new me((Hi+Pe)/Cr,(Oi+Ve)/Cr);Er.z=Gr/Cr,Mt.push(Er);const nn=new me(fn/or,gn/or);nn.z=pn/or,We.push(nn)}Re.push(Mt),Ee.push(We)}return[Re,Ee]}(l,R,D,b);return function(W,X,pe){let be=1/0;Bu(pe,X)&&(be=Yu(pe,X[0]));for(let Re=0;Re<X.length;Re++){const Ee=X[Re],Pe=W[Re];for(let Ve=0;Ve<Ee.length-1;Ve++){const st=Ee[Ve],St=[st,Ee[Ve+1],Pe[Ve+1],Pe[Ve],st];xu(pe,St)&&(be=Math.min(be,Yu(pe,St)))}}return be!==1/0&&be}(Y[0],Y[1],O)}}function Tc(i,t){return i.x*t.x+i.y*t.y}function Yu(i,t){if(i.length===1){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const d=t[r],f=i[0],_=l.sub(s),b=d.sub(s),E=f.sub(s),D=Tc(_,_),R=Tc(_,b),O=Tc(b,b),Y=Tc(E,_),W=Tc(E,b),X=D*O-R*R,pe=(O*Y-R*W)/X,be=(D*W-R*Y)/X,Re=s.z*(1-pe-be)+l.z*pe+d.z*be;if(isFinite(Re))return Re}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const jf=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Jf}=jf,Yf=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Kf}=Yf,Zf=Vo.VectorTileFeature.types,$f=Math.cos(Math.PI/180*37.5),Ku=Math.pow(2,14)/.5;class Ph{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ke,this.layoutVertexArray2=new tt,this.indexArray=new Lt,this.programConfigurations=new Tl(t.layers,t.zoom),this.segments=new ct,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=kh("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),f=[];for(const{feature:_,id:b,index:E,sourceLayerIndex:D}of t){const R=this.layers[0]._featureFilter.needGeometry,O=Ll(_,R);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),O,s))continue;const Y=d?l.evaluate(O,{},s):void 0,W={id:b,properties:_.properties,type:_.type,sourceLayerIndex:D,index:E,geometry:R?O.geometry:Pl(_),patterns:{},sortKey:Y};f.push(W)}d&&f.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of f){const{geometry:b,index:E,sourceLayerIndex:D}=_;if(this.hasPattern){const R=Sh("line",this.layers,_,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(_,b,E,s,{});r.featureIndex.insert(t[E].feature,b,E,D,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Kf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,d){const f=this.layers[0].layout,_=f.get("line-join").evaluate(t,{}),b=f.get("line-cap"),E=f.get("line-miter-limit"),D=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const R of r)this.addLine(R,t,_,b,E,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,l)}addLine(t,r,s,l,d,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<t.length-1;be++)this.totalDistance+=t[be].dist(t[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=Zf[r.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let E=0;for(;E<b-1&&t[E].equals(t[E+1]);)E++;if(b<(_?3:2))return;s==="bevel"&&(d=1.05);const D=this.overscaling<=16?15*pr/(512*this.overscaling):0,R=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let O,Y,W,X,pe;this.e1=this.e2=-1,_&&(O=t[b-2],pe=t[E].sub(O)._unit()._perp());for(let be=E;be<b;be++){if(W=be===b-1?_?t[E+1]:void 0:t[be+1],W&&t[be].equals(W))continue;pe&&(X=pe),O&&(Y=O),O=t[be],pe=W?W.sub(O)._unit()._perp():X,X=X||pe;let Re=X.add(pe);Re.x===0&&Re.y===0||Re._unit();const Ee=X.x*pe.x+X.y*pe.y,Pe=Re.x*pe.x+Re.y*pe.y,Ve=Pe!==0?1/Pe:1/0,st=2*Math.sqrt(2-2*Pe),St=Pe<$f&&Y&&W,$t=X.x*pe.y-X.y*pe.x>0;if(St&&be>E){const Ut=O.dist(Y);if(Ut>2*D){const Rt=O.sub(O.sub(Y)._mult(D/Ut)._round());this.updateDistance(Y,Rt),this.addCurrentVertex(Rt,X,0,0,R),Y=Rt}}const kt=Y&&W;let vt=kt?s:_?"butt":l;if(kt&&vt==="round"&&(Ve<f?vt="miter":Ve<=2&&(vt="fakeround")),vt==="miter"&&Ve>d&&(vt="bevel"),vt==="bevel"&&(Ve>2&&(vt="flipbevel"),Ve<d&&(vt="miter")),Y&&this.updateDistance(Y,O),vt==="miter")Re._mult(Ve),this.addCurrentVertex(O,Re,0,0,R);else if(vt==="flipbevel"){if(Ve>100)Re=pe.mult(-1);else{const Ut=Ve*X.add(pe).mag()/X.sub(pe).mag();Re._perp()._mult(Ut*($t?-1:1))}this.addCurrentVertex(O,Re,0,0,R),this.addCurrentVertex(O,Re.mult(-1),0,0,R)}else if(vt==="bevel"||vt==="fakeround"){const Ut=-Math.sqrt(Ve*Ve-1),Rt=$t?Ut:0,Mt=$t?0:Ut;if(Y&&this.addCurrentVertex(O,X,Rt,Mt,R),vt==="fakeround"){const We=Math.round(180*st/Math.PI/20);for(let qt=1;qt<We;qt++){let Gt=qt/We;if(Gt!==.5){const Hi=Gt-.5;Gt+=Gt*Hi*(Gt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Hi*Hi+(.848013+Ee*(.215638*Ee-1.06021)))}const ni=pe.sub(X)._mult(Gt)._add(X)._unit()._mult($t?-1:1);this.addHalfVertex(O,ni.x,ni.y,!1,$t,0,R)}}W&&this.addCurrentVertex(O,pe,-Rt,-Mt,R)}else if(vt==="butt")this.addCurrentVertex(O,Re,0,0,R);else if(vt==="square"){const Ut=Y?1:-1;this.addCurrentVertex(O,Re,Ut,Ut,R)}else vt==="round"&&(Y&&(this.addCurrentVertex(O,X,0,0,R),this.addCurrentVertex(O,X,1,1,R,!0)),W&&(this.addCurrentVertex(O,pe,-1,-1,R,!0),this.addCurrentVertex(O,pe,0,0,R)));if(St&&be<b-1){const Ut=O.dist(W);if(Ut>2*D){const Rt=O.add(W.sub(O)._mult(D/Ut)._round());this.updateDistance(O,Rt),this.addCurrentVertex(Rt,pe,0,0,R),O=Rt}}}}addCurrentVertex(t,r,s,l,d,f=!1){const _=r.y*l-r.x,b=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,f,!1,s,d),this.addHalfVertex(t,_,b,f,!0,-l,d),this.distance>Ku/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,l,d,f))}addHalfVertex({x:t,y:r},s,l,d,f,_,b){const E=.5*(this.lineClips?this.scaledDistance*(Ku-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(_===0?0:_<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),b.primitiveLength++),f?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Zu,$u;xt("LineBucket",Ph,{omit:["layers","patternFeatures"]});var Wu={get paint(){return $u=$u||new u({"line-opacity":new jt(Ne.paint_line["line-opacity"]),"line-color":new jt(Ne.paint_line["line-color"]),"line-translate":new zt(Ne.paint_line["line-translate"]),"line-translate-anchor":new zt(Ne.paint_line["line-translate-anchor"]),"line-width":new jt(Ne.paint_line["line-width"]),"line-gap-width":new jt(Ne.paint_line["line-gap-width"]),"line-offset":new jt(Ne.paint_line["line-offset"]),"line-blur":new jt(Ne.paint_line["line-blur"]),"line-dasharray":new Oo(Ne.paint_line["line-dasharray"]),"line-pattern":new No(Ne.paint_line["line-pattern"]),"line-gradient":new Ml(Ne.paint_line["line-gradient"])})},get layout(){return Zu=Zu||new u({"line-cap":new zt(Ne.layout_line["line-cap"]),"line-join":new jt(Ne.layout_line["line-join"]),"line-miter-limit":new zt(Ne.layout_line["line-miter-limit"]),"line-round-limit":new zt(Ne.layout_line["line-round-limit"]),"line-sort-key":new jt(Ne.layout_line["line-sort-key"])})}};class Wf extends jt{possiblyEvaluate(t,r){return r=new Vi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,l){return r=yt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,l)}}let th;class Xf extends n{constructor(t){super(t,Wu),this.gradientVersion=0,th||(th=new Wf(Wu.paint.properties["line-width"].specification),th.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof fa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=th.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ph(t)}queryRadius(t){const r=t,s=Xu(Cc("line-width",this,r),Cc("line-gap-width",this,r)),l=Cc("line-offset",this,r);return s/2+Math.abs(l)+Kc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,s,l,d,f,_){const b=Zc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,_),E=_/2*Xu(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),D=this.paint.get("line-offset").evaluate(r,s);return D&&(l=function(R,O){const Y=[];for(let W=0;W<R.length;W++){const X=R[W],pe=[];for(let be=0;be<X.length;be++){const Re=X[be-1],Ee=X[be],Pe=X[be+1],Ve=be===0?new me(0,0):Ee.sub(Re)._unit()._perp(),st=be===X.length-1?new me(0,0):Pe.sub(Ee)._unit()._perp(),St=Ve._add(st)._unit(),$t=St.x*st.x+St.y*st.y;$t!==0&&St._mult(1/$t),pe.push(St._mult(O)._add(Ee))}Y.push(pe)}return Y}(l,D*_)),function(R,O,Y){for(let W=0;W<O.length;W++){const X=O[W];if(R.length>=3){for(let pe=0;pe<X.length;pe++)if(nc(R,X[pe]))return!0}if(lf(R,X,Y))return!0}return!1}(b,l,E)}isTileClipped(){return!0}}function Xu(i,t){return t>0?t+2*i:i}const eg=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tg=I([{name:"a_projected_pos",components:3,type:"Float32"}],4);I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ig=I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const eA=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rg=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ng(i,t,r){return i.sections.forEach(s=>{s.text=function(l,d,f){const _=d.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?l=l.toLocaleUpperCase():_==="lowercase"&&(l=l.toLocaleLowerCase()),ir.applyArabicShaping&&(l=ir.applyArabicShaping(l)),l}(s.text,t,r)}),i}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),I([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Pc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var _r=24,tA=Ni,iA=function(i,t,r,s,l){var d,f,_=8*l-s-1,b=(1<<_)-1,E=b>>1,D=-7,R=l-1,O=-1,Y=i[t+R];for(R+=O,d=Y&(1<<-D)-1,Y>>=-D,D+=_;D>0;d=256*d+i[t+R],R+=O,D-=8);for(f=d&(1<<-D)-1,d>>=-D,D+=s;D>0;f=256*f+i[t+R],R+=O,D-=8);if(d===0)d=1-E;else{if(d===b)return f?NaN:1/0*(Y?-1:1);f+=Math.pow(2,s),d-=E}return(Y?-1:1)*f*Math.pow(2,d-s)},rA=function(i,t,r,s,l,d){var f,_,b,E=8*d-l-1,D=(1<<E)-1,R=D>>1,O=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=0,W=1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,f=D):(f=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-f))<1&&(f--,b*=2),(t+=f+R>=1?O/b:O*Math.pow(2,1-R))*b>=2&&(f++,b/=2),f+R>=D?(_=0,f=D):f+R>=1?(_=(t*b-1)*Math.pow(2,l),f+=R):(_=t*Math.pow(2,R-1)*Math.pow(2,l),f=0));l>=8;i[r+Y]=255&_,Y+=W,_/=256,l-=8);for(f=f<<l|_,E+=l;E>0;i[r+Y]=255&f,Y+=W,f/=256,E-=8);i[r+Y-W]|=128*X};function Ni(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ni.Varint=0,Ni.Fixed64=1,Ni.Bytes=2,Ni.Fixed32=5;var Lh=4294967296,nA=1/Lh,sA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function so(i){return i.type===Ni.Bytes?i.readVarint()+i.pos:i.pos+1}function lc(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function aA(i,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function sg(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function ag(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function og(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function lg(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function cg(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function hg(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function ug(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function Ag(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function dg(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function ih(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function cc(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function oA(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Ni.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),l=s>>3,d=this.pos;this.type=7&s,i(l,t,this),this.pos===d&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=ih(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=oA(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=ih(this.buf,this.pos)+ih(this.buf,this.pos+4)*Lh;return this.pos+=8,i},readSFixed64:function(){var i=ih(this.buf,this.pos)+oA(this.buf,this.pos+4)*Lh;return this.pos+=8,i},readFloat:function(){var i=iA(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=iA(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(l,d,f){var _,b,E=f.buf;if(_=(112&(b=E[f.pos++]))>>4,b<128||(_|=(127&(b=E[f.pos++]))<<3,b<128)||(_|=(127&(b=E[f.pos++]))<<10,b<128)||(_|=(127&(b=E[f.pos++]))<<17,b<128)||(_|=(127&(b=E[f.pos++]))<<24,b<128)||(_|=(1&(b=E[f.pos++]))<<31,b<128))return lc(l,_,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&sA?function(r,s,l){return sA.decode(r.subarray(s,l))}(this.buf,t,i):function(r,s,l){for(var d="",f=s;f<l;){var _,b,E,D=r[f],R=null,O=D>239?4:D>223?3:D>191?2:1;if(f+O>l)break;O===1?D<128&&(R=D):O===2?(192&(_=r[f+1]))==128&&(R=(31&D)<<6|63&_)<=127&&(R=null):O===3?(b=r[f+2],(192&(_=r[f+1]))==128&&(192&b)==128&&((R=(15&D)<<12|(63&_)<<6|63&b)<=2047||R>=55296&&R<=57343)&&(R=null)):O===4&&(b=r[f+2],E=r[f+3],(192&(_=r[f+1]))==128&&(192&b)==128&&(192&E)==128&&((R=(15&D)<<18|(63&_)<<12|(63&b)<<6|63&E)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,O=1):R>65535&&(R-=65536,d+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),d+=String.fromCharCode(R),f+=O}return d}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Ni.Bytes)return i.push(this.readVarint(t));var r=so(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSVarint());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ni.Bytes)return i.push(this.readBoolean());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFloat());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ni.Bytes)return i.push(this.readDouble());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFixed32());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSFixed32());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ni.Bytes)return i.push(this.readFixed64());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ni.Bytes)return i.push(this.readSFixed64());var t=so(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Ni.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ni.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ni.Fixed32)this.pos+=4;else{if(t!==Ni.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),cc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*nA),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),cc(this.buf,-1&i,this.pos),cc(this.buf,Math.floor(i*nA),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var s,l;if(t>=0?(s=t%4294967296|0,l=t/4294967296|0):(l=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,l=l+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,f,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(s,0,r),function(d,f){var _=(7&d)<<4;f.buf[f.pos++]|=_|((d>>>=3)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d|((d>>>=7)?128:0),d&&(f.buf[f.pos++]=127&d)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,l,d){for(var f,_,b=0;b<l.length;b++){if((f=l.charCodeAt(b))>55295&&f<57344){if(!_){f>56319||b+1===l.length?(s[d++]=239,s[d++]=191,s[d++]=189):_=f;continue}if(f<56320){s[d++]=239,s[d++]=191,s[d++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(s[d++]=239,s[d++]=191,s[d++]=189,_=null);f<128?s[d++]=f:(f<2048?s[d++]=f>>6|192:(f<65536?s[d++]=f>>12|224:(s[d++]=f>>18|240,s[d++]=f>>12&63|128),s[d++]=f>>6&63|128),s[d++]=63&f|128)}return d}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&aA(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),rA(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),rA(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var s=this.pos-r;s>=128&&aA(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,r){this.writeTag(i,Ni.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,sg,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,ag,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,cg,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,og,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,lg,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,hg,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,ug,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Ag,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,dg,t)},writeBytesField:function(i,t){this.writeTag(i,Ni.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Ni.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Ni.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Ni.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Ni.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Ni.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Ni.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Ni.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Ni.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Ni.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var Rh=ne(tA);const Fh=3;function fg(i,t,r){i===1&&r.readMessage(gg,t)}function gg(i,t,r){if(i===3){const{id:s,bitmap:l,width:d,height:f,left:_,top:b,advance:E}=r.readMessage(pg,{});t.push({id:s,bitmap:new Qc({width:d+2*Fh,height:f+2*Fh},l),metrics:{width:d,height:f,left:_,top:b,advance:E}})}}function pg(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const lA=Fh;function cA(i){let t=0,r=0;for(const f of i)t+=f.w*f.h,r=Math.max(r,f.w);i.sort((f,_)=>_.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,d=0;for(const f of i)for(let _=s.length-1;_>=0;_--){const b=s[_];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===b.w&&f.h===b.h){const E=s.pop();_<s.length&&(s[_]=E)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(s.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}const kn=1;class zh{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:d,content:f,textFitWidth:_,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=d,this.content=f,this.version=s,this.textFitWidth=_,this.textFitHeight=b}get tl(){return[this.paddedRect.x+kn,this.paddedRect.y+kn]}get br(){return[this.paddedRect.x+this.paddedRect.w-kn,this.paddedRect.y+this.paddedRect.h-kn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*kn)/this.pixelRatio,(this.paddedRect.h-2*kn)/this.pixelRatio]}}class hA{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,s,d),this.addImages(r,l,d);const{w:f,h:_}=cA(d),b=new hs({width:f||1,height:_||1});for(const E in t){const D=t[E],R=s[E].paddedRect;hs.copy(D.data,b,{x:0,y:0},{x:R.x+kn,y:R.y+kn},D.data)}for(const E in r){const D=r[E],R=l[E].paddedRect,O=R.x+kn,Y=R.y+kn,W=D.data.width,X=D.data.height;hs.copy(D.data,b,{x:0,y:0},{x:O,y:Y},D.data),hs.copy(D.data,b,{x:0,y:X-1},{x:O,y:Y-1},{width:W,height:1}),hs.copy(D.data,b,{x:0,y:0},{x:O,y:Y+X},{width:W,height:1}),hs.copy(D.data,b,{x:W-1,y:0},{x:O-1,y:Y},{width:1,height:X}),hs.copy(D.data,b,{x:0,y:0},{x:O+W,y:Y},{width:1,height:X})}this.image=b,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const d=t[l],f={x:0,y:0,w:d.data.width+2*kn,h:d.data.height+2*kn};s.push(f),r[l]=new zh(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,d]=t.tl;s.update(r.data,void 0,{x:l,y:d})}}var Ho;xt("ImagePosition",zh),xt("ImageAtlas",hA),Q.ah=void 0,(Ho=Q.ah||(Q.ah={}))[Ho.none=0]="none",Ho[Ho.horizontal=1]="horizontal",Ho[Ho.vertical=2]="vertical",Ho[Ho.horizontalOnly=3]="horizontalOnly";const Lc=-17;class Rc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Rc;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Rc;return r.imageName=t,r}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new hc;for(let l=0;l<t.sections.length;l++){const d=t.sections[l];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const l=t.charCodeAt(s+1)||null,d=t.charCodeAt(s-1)||null;r+=l&&zo(l)&&!Pc[t[s+1]]||d&&zo(d)&&!Pc[t[s-1]]||!Pc[t[s]]?t[s]:Pc[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&nh[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&nh[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new hc;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Rc.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Ot("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Rc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rh(i,t,r,s,l,d,f,_,b,E,D,R,O,Y,W){const X=hc.fromFeature(i,l);let pe;R===Q.ah.vertical&&X.verticalizePunctuation();const{processBidirectionalText:be,processStyledBidirectionalText:Re}=ir;if(be&&X.sections.length===1){pe=[];const Ve=be(X.toString(),Gh(X,E,d,t,s,Y));for(const st of Ve){const St=new hc;St.text=st,St.sections=X.sections;for(let $t=0;$t<st.length;$t++)St.sectionIndex.push(0);pe.push(St)}}else if(Re){pe=[];const Ve=Re(X.text,X.sectionIndex,Gh(X,E,d,t,s,Y));for(const st of Ve){const St=new hc;St.text=st[0],St.sectionIndex=st[1],St.sections=X.sections,pe.push(St)}}else pe=function(Ve,st){const St=[],$t=Ve.text;let kt=0;for(const vt of st)St.push(Ve.substring(kt,vt)),kt=vt;return kt<$t.length&&St.push(Ve.substring(kt,$t.length)),St}(X,Gh(X,E,d,t,s,Y));const Ee=[],Pe={positionedLines:Ee,text:X.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(Ve,st,St,$t,kt,vt,Ut,Rt,Mt,We,qt,Gt){let ni=0,Hi=Lc,Oi=0,Br=0;const Ds=Rt==="right"?1:Rt==="left"?0:.5;let Gr=0;for(const or of kt){or.trim();const Er=or.getMaxScale(),nn=(Er-1)*_r,Ur={positionedGlyphs:[],lineOffset:0};Ve.positionedLines[Gr]=Ur;const mn=Ur.positionedGlyphs;let Nr=0;if(!or.length()){Hi+=vt,++Gr;continue}for(let Sn=0;Sn<or.length();Sn++){const Mi=or.getSection(Sn),Ji=or.getSectionIndex(Sn),Yi=or.getCharCode(Sn);let Vn=0,rr=null,fc=null,Pa=null,La=_r;const Ms=!(Mt===Q.ah.horizontal||!qt&&!io(Yi)||qt&&(nh[Yi]||(Cr=Yi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Cr)))));if(Mi.imageName){const ds=$t[Mi.imageName];if(!ds)continue;Pa=Mi.imageName,Ve.iconsInText=Ve.iconsInText||!0,fc=ds.paddedRect;const Dr=ds.displaySize;Mi.scale=Mi.scale*_r/Gt,rr={width:Dr[0],height:Dr[1],left:kn,top:-lA,advance:Ms?Dr[1]:Dr[0]},Vn=nn+(_r-Dr[1]*Mi.scale),La=rr.advance;const ao=Ms?Dr[0]*Mi.scale-_r*Er:Dr[1]*Mi.scale-_r*Er;ao>0&&ao>Nr&&(Nr=ao)}else{const ds=St[Mi.fontStack],Dr=ds&&ds[Yi];if(Dr&&Dr.rect)fc=Dr.rect,rr=Dr.metrics;else{const ao=st[Mi.fontStack],Oc=ao&&ao[Yi];if(!Oc)continue;rr=Oc.metrics}Vn=(Er-Mi.scale)*_r}Ms?(Ve.verticalizable=!0,mn.push({glyph:Yi,imageName:Pa,x:ni,y:Hi+Vn,vertical:Ms,scale:Mi.scale,fontStack:Mi.fontStack,sectionIndex:Ji,metrics:rr,rect:fc}),ni+=La*Mi.scale+We):(mn.push({glyph:Yi,imageName:Pa,x:ni,y:Hi+Vn,vertical:Ms,scale:Mi.scale,fontStack:Mi.fontStack,sectionIndex:Ji,metrics:rr,rect:fc}),ni+=rr.advance*Mi.scale+We)}mn.length!==0&&(Oi=Math.max(ni-We,Oi),Ig(mn,0,mn.length-1,Ds,Nr)),ni=0;const As=vt*Er+Nr;Ur.lineOffset=Math.max(Nr,nn),Hi+=As,Br=Math.max(As,Br),++Gr}var Cr;const fn=Hi-Lc,{horizontalAlign:gn,verticalAlign:pn}=Uh(Ut);(function(or,Er,nn,Ur,mn,Nr,As,Sn,Mi){const Ji=(Er-nn)*mn;let Yi=0;Yi=Nr!==As?-Sn*Ur-Lc:(-Ur*Mi+.5)*As;for(const Vn of or)for(const rr of Vn.positionedGlyphs)rr.x+=Ji,rr.y+=Yi})(Ve.positionedLines,Ds,gn,pn,Oi,Br,vt,fn,kt.length),Ve.top+=-pn*fn,Ve.bottom=Ve.top+fn,Ve.left+=-gn*Oi,Ve.right=Ve.left+Oi}(Pe,t,r,s,pe,f,_,b,R,E,O,W),!function(Ve){for(const st of Ve)if(st.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&Pe}const nh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mg={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},yg={40:!0};function uA(i,t,r,s,l,d){if(t.imageName){const f=s[t.imageName];return f?f.displaySize[0]*t.scale*_r/d+l:0}{const f=r[t.fontStack],_=f&&f[i];return _?_.metrics.advance*t.scale+l:0}}function AA(i,t,r,s){const l=Math.pow(i-t,2);return s?i<t?l/2:2*l:l+Math.abs(r)*r}function _g(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function dA(i,t,r,s,l,d){let f=null,_=AA(t,r,l,d);for(const b of s){const E=AA(t-b.x,r,l,d)+b.badness;E<=_&&(f=b,_=E)}return{index:i,x:t,priorBreak:f,badness:_}}function fA(i){return i?fA(i.priorBreak).concat(i.index):[]}function Gh(i,t,r,s,l,d){if(!i)return[];const f=[],_=function(R,O,Y,W,X,pe){let be=0;for(let Re=0;Re<R.length();Re++){const Ee=R.getSection(Re);be+=uA(R.getCharCode(Re),Ee,W,X,O,pe)}return be/Math.max(1,Math.ceil(be/Y))}(i,t,r,s,l,d),b=i.text.indexOf("")>=0;let E=0;for(let R=0;R<i.length();R++){const O=i.getSection(R),Y=i.getCharCode(R);if(nh[Y]||(E+=uA(Y,O,s,l,t,d)),R<i.length()-1){const W=!((D=Y)<11904)&&(!!_i["CJK Compatibility Forms"](D)||!!_i["CJK Compatibility"](D)||!!_i["CJK Strokes"](D)||!!_i["CJK Symbols and Punctuation"](D)||!!_i["Enclosed CJK Letters and Months"](D)||!!_i["Halfwidth and Fullwidth Forms"](D)||!!_i["Ideographic Description Characters"](D)||!!_i["Vertical Forms"](D)||Sl.test(String.fromCodePoint(D)));(mg[Y]||W||O.imageName||R!==i.length()-2&&yg[i.getCharCode(R+1)])&&f.push(dA(R+1,E,_,f,_g(Y,i.getCharCode(R+1),W&&b),!1))}}var D;return fA(dA(i.length(),E,_,f,0,!0))}function Uh(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ig(i,t,r,s,l){if(!s&&!l)return;const d=i[r],f=(i[r].x+d.metrics.advance*d.scale)*s;for(let _=t;_<=r;_++)i[_].x-=f,i[_].y+=l}function bg(i,t,r){const{horizontalAlign:s,verticalAlign:l}=Uh(r),d=t[0]-i.displaySize[0]*s,f=t[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function gA(i){var t,r;let s=i.left,l=i.top,d=i.right-s,f=i.bottom-l;const _=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",E=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(b==="proportional"){if(_==="stretchOnly"&&d/f<E||_==="proportional"){const D=Math.ceil(f*E);s*=D/d,d=D}}else if(_==="proportional"&&b==="stretchOnly"&&E!==0&&d/f>E){const D=Math.ceil(d/E);l*=D/f,f=D}return{x1:s,y1:l,x2:s+d,y2:l+f}}function pA(i,t,r,s,l,d){const f=i.image;let _;if(f.content){const pe=f.content,be=f.pixelRatio||1;_=[pe[0]/be,pe[1]/be,f.displaySize[0]-pe[2]/be,f.displaySize[1]-pe[3]/be]}const b=t.left*d,E=t.right*d;let D,R,O,Y;r==="width"||r==="both"?(Y=l[0]+b-s[3],R=l[0]+E+s[1]):(Y=l[0]+(b+E-f.displaySize[0])/2,R=Y+f.displaySize[0]);const W=t.top*d,X=t.bottom*d;return r==="height"||r==="both"?(D=l[1]+W-s[0],O=l[1]+X+s[2]):(D=l[1]+(W+X-f.displaySize[1])/2,O=D+f.displaySize[1]),{image:f,top:D,right:R,bottom:O,left:Y,collisionPadding:_}}const Fc=255,Ta=128,jo=Fc*Ta;function mA(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Vi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let d=0;for(;d<s.length&&s[d]<=i;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<i+1;)f++;f=Math.min(s.length-1,f);const _=s[d],b=s[f];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:_,maxZoom:b,minSize:r.evaluate(new Vi(_)),maxSize:r.evaluate(new Vi(b)),interpolationType:l}}}function Nh(i,t,r){let s="never";const l=i.get(t);return l?s=l:i.get(r)&&(s="always"),s}const wg=Vo.VectorTileFeature.types,vg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sh(i,t,r,s,l,d,f,_,b,E,D,R,O){const Y=_?Math.min(jo,Math.round(_[0])):0,W=_?Math.min(jo,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),d,f,(Y<<1)+(b?1:0),W,16*E,16*D,256*R,256*O)}function Oh(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function xg(i){for(const t of i.sections)if(Bc(t.text))return!0;return!1}class qh{constructor(t){this.layoutVertexArray=new Oe,this.indexArray=new Lt,this.programConfigurations=t,this.segments=new ct,this.dynamicLayoutVertexArray=new Fe,this.opacityVertexArray=new et,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,eg.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,tg.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,vg,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xt("SymbolBuffers",qh);class Vh{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ct,this.collisionVertexArray=new At}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ig.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xt("CollisionBuffers",Vh);class uc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vh([]),this.placementViewportMatrix=vh([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mA(this.zoom,r["text-size"]),this.iconSizeData=mA(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=Nh(s,"text-overlap","text-allow-overlap")!=="never"||Nh(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(f=>Q.ah[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new qh(new Tl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qh(new Tl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new G,this.lineVertexArray=new ue,this.symbolInstances=new K,this.textAnchorOffsets=new oe}calculateGlyphDependencies(t,r,s,l,d){for(let f=0;f<t.length;f++)if(r[t.charCodeAt(f)]=!0,(s||l)&&d){const _=Pc[t.charAt(f)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,s){const l=this.layers[0],d=l.layout,f=d.get("text-font"),_=d.get("text-field"),b=d.get("icon-image"),E=(_.value.kind!=="constant"||_.value.value instanceof Tr&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),D=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,R=d.get("symbol-sort-key");if(this.features=[],!E&&!D)return;const O=r.iconDependencies,Y=r.glyphDependencies,W=r.availableImages,X=new Vi(this.zoom);for(const{feature:pe,id:be,index:Re,sourceLayerIndex:Ee}of t){const Pe=l._featureFilter.needGeometry,Ve=Ll(pe,Pe);if(!l._featureFilter.filter(X,Ve,s))continue;let st,St;if(Pe||(Ve.geometry=Pl(pe)),E){const kt=l.getValueAndResolveTokens("text-field",Ve,s,W),vt=Tr.factory(kt),Ut=this.hasRTLText=this.hasRTLText||xg(vt);(!Ut||ir.getRTLTextPluginStatus()==="unavailable"||Ut&&ir.isParsed())&&(st=ng(vt,l,Ve))}if(D){const kt=l.getValueAndResolveTokens("icon-image",Ve,s,W);St=kt instanceof Kr?kt:Kr.fromString(kt)}if(!st&&!St)continue;const $t=this.sortFeaturesByKey?R.evaluate(Ve,{},s):void 0;if(this.features.push({id:be,text:st,icon:St,index:Re,sourceLayerIndex:Ee,geometry:Ve.geometry,properties:pe.properties,type:wg[pe.type],sortKey:$t}),St&&(O[St.name]=!0),st){const kt=f.evaluate(Ve,{},s).join(","),vt=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Q.ah.vertical)>=0;for(const Ut of st.sections)if(Ut.image)O[Ut.image.name]=!0;else{const Rt=kl(st.toString()),Mt=Ut.fontStack||kt,We=Y[Mt]=Y[Mt]||{};this.calculateGlyphDependencies(Ut.text,We,vt,this.allowVerticalPlacement,Rt)}}}d.get("symbol-placement")==="line"&&(this.features=function(pe){const be={},Re={},Ee=[];let Pe=0;function Ve(kt){Ee.push(pe[kt]),Pe++}function st(kt,vt,Ut){const Rt=Re[kt];return delete Re[kt],Re[vt]=Rt,Ee[Rt].geometry[0].pop(),Ee[Rt].geometry[0]=Ee[Rt].geometry[0].concat(Ut[0]),Rt}function St(kt,vt,Ut){const Rt=be[vt];return delete be[vt],be[kt]=Rt,Ee[Rt].geometry[0].shift(),Ee[Rt].geometry[0]=Ut[0].concat(Ee[Rt].geometry[0]),Rt}function $t(kt,vt,Ut){const Rt=Ut?vt[0][vt[0].length-1]:vt[0][0];return`${kt}:${Rt.x}:${Rt.y}`}for(let kt=0;kt<pe.length;kt++){const vt=pe[kt],Ut=vt.geometry,Rt=vt.text?vt.text.toString():null;if(!Rt){Ve(kt);continue}const Mt=$t(Rt,Ut),We=$t(Rt,Ut,!0);if(Mt in Re&&We in be&&Re[Mt]!==be[We]){const qt=St(Mt,We,Ut),Gt=st(Mt,We,Ee[qt].geometry);delete be[Mt],delete Re[We],Re[$t(Rt,Ee[Gt].geometry,!0)]=Gt,Ee[qt].geometry=null}else Mt in Re?st(Mt,We,Ut):We in be?St(Mt,We,Ut):(Ve(kt),be[Mt]=Pe-1,Re[We]=Pe-1)}return Ee.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,be)=>pe.sortKey-be.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),d=t.dist(r[t.segment]);const f={};for(let _=t.segment+1;_<r.length;_++)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:l},_<r.length-1&&(l+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:d},_>0&&(d+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const b=f[_];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,d,f,_,b,E,D,R,O){const Y=t.indexArray,W=t.layoutVertexArray,X=t.segments.prepareSegment(4*r.length,W,Y,this.canOverlap?f.sortKey:void 0),pe=this.glyphOffsetArray.length,be=X.vertexLength,Re=this.allowVerticalPlacement&&_===Q.ah.vertical?Math.PI/2:0,Ee=f.text&&f.text.sections;for(let Pe=0;Pe<r.length;Pe++){const{tl:Ve,tr:st,bl:St,br:$t,tex:kt,pixelOffsetTL:vt,pixelOffsetBR:Ut,minFontScaleX:Rt,minFontScaleY:Mt,glyphOffset:We,isSDF:qt,sectionIndex:Gt}=r[Pe],ni=X.vertexLength,Hi=We[1];sh(W,b.x,b.y,Ve.x,Hi+Ve.y,kt.x,kt.y,s,qt,vt.x,vt.y,Rt,Mt),sh(W,b.x,b.y,st.x,Hi+st.y,kt.x+kt.w,kt.y,s,qt,Ut.x,vt.y,Rt,Mt),sh(W,b.x,b.y,St.x,Hi+St.y,kt.x,kt.y+kt.h,s,qt,vt.x,Ut.y,Rt,Mt),sh(W,b.x,b.y,$t.x,Hi+$t.y,kt.x+kt.w,kt.y+kt.h,s,qt,Ut.x,Ut.y,Rt,Mt),Oh(t.dynamicLayoutVertexArray,b,Re),Y.emplaceBack(ni,ni+1,ni+2),Y.emplaceBack(ni+1,ni+2,ni+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),Pe!==r.length-1&&Gt===r[Pe+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,f,f.index,{},O,Ee&&Ee[Gt])}t.placedSymbolArray.emplaceBack(b.x,b.y,pe,this.glyphOffsetArray.length-pe,be,E,D,b.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],_,0,!1,0,R)}_addCollisionDebugVertex(t,r,s,l,d,f){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,l,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,r,s,l,d,f,_){const b=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),E=b.vertexLength,D=d.layoutVertexArray,R=d.collisionVertexArray,O=_.anchorX,Y=_.anchorY;this._addCollisionDebugVertex(D,R,f,O,Y,new me(t,r)),this._addCollisionDebugVertex(D,R,f,O,Y,new me(s,r)),this._addCollisionDebugVertex(D,R,f,O,Y,new me(s,l)),this._addCollisionDebugVertex(D,R,f,O,Y,new me(t,l)),b.vertexLength+=4;const W=d.indexArray;W.emplaceBack(E,E+1),W.emplaceBack(E+1,E+2),W.emplaceBack(E+2,E+3),W.emplaceBack(E+3,E),b.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,l){for(let d=t;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vh(Dt,eA.members,ht),this.iconCollisionBox=new Vh(Dt,eA.members,ht);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,l,d,f,_,b,E){const D={};for(let R=r;R<s;R++){const O=t.get(R);D.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},D.textFeatureIndex=O.featureIndex;break}for(let R=l;R<d;R++){const O=t.get(R);D.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},D.verticalTextFeatureIndex=O.featureIndex;break}for(let R=f;R<_;R++){const O=t.get(R);D.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},D.iconFeatureIndex=O.featureIndex;break}for(let R=b;R<E;R++){const O=t.get(R);D.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},D.verticalIconFeatureIndex=O.featureIndex;break}return D}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],d=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const b=this.symbolInstances.get(_);l.push(0|Math.round(r*b.anchorX+s*b.anchorY)),d.push(b.featureIndex)}return f.sort((_,b)=>l[_]-l[b]||d[b]-d[_]),f}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((l,d,f)=>{l>=0&&f.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yA,_A;xt("SymbolBucket",uc,{omit:["layers","collisionBoxArray","features","compareText"]}),uc.MAX_GLYPHS=65535,uc.addDynamicAttributes=Oh;var Hh={get paint(){return _A=_A||new u({"icon-opacity":new jt(Ne.paint_symbol["icon-opacity"]),"icon-color":new jt(Ne.paint_symbol["icon-color"]),"icon-halo-color":new jt(Ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new jt(Ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jt(Ne.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(Ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(Ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new jt(Ne.paint_symbol["text-opacity"]),"text-color":new jt(Ne.paint_symbol["text-color"],{runtimeType:Xt,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new jt(Ne.paint_symbol["text-halo-color"]),"text-halo-width":new jt(Ne.paint_symbol["text-halo-width"]),"text-halo-blur":new jt(Ne.paint_symbol["text-halo-blur"]),"text-translate":new zt(Ne.paint_symbol["text-translate"]),"text-translate-anchor":new zt(Ne.paint_symbol["text-translate-anchor"])})},get layout(){return yA=yA||new u({"symbol-placement":new zt(Ne.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(Ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(Ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jt(Ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(Ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(Ne.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(Ne.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(Ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(Ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(Ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new jt(Ne.layout_symbol["icon-size"]),"icon-text-fit":new zt(Ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(Ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new jt(Ne.layout_symbol["icon-image"]),"icon-rotate":new jt(Ne.layout_symbol["icon-rotate"]),"icon-padding":new jt(Ne.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(Ne.layout_symbol["icon-keep-upright"]),"icon-offset":new jt(Ne.layout_symbol["icon-offset"]),"icon-anchor":new jt(Ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(Ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(Ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(Ne.layout_symbol["text-rotation-alignment"]),"text-field":new jt(Ne.layout_symbol["text-field"]),"text-font":new jt(Ne.layout_symbol["text-font"]),"text-size":new jt(Ne.layout_symbol["text-size"]),"text-max-width":new jt(Ne.layout_symbol["text-max-width"]),"text-line-height":new zt(Ne.layout_symbol["text-line-height"]),"text-letter-spacing":new jt(Ne.layout_symbol["text-letter-spacing"]),"text-justify":new jt(Ne.layout_symbol["text-justify"]),"text-radial-offset":new jt(Ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(Ne.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new jt(Ne.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new jt(Ne.layout_symbol["text-anchor"]),"text-max-angle":new zt(Ne.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(Ne.layout_symbol["text-writing-mode"]),"text-rotate":new jt(Ne.layout_symbol["text-rotate"]),"text-padding":new zt(Ne.layout_symbol["text-padding"]),"text-keep-upright":new zt(Ne.layout_symbol["text-keep-upright"]),"text-transform":new jt(Ne.layout_symbol["text-transform"]),"text-offset":new jt(Ne.layout_symbol["text-offset"]),"text-allow-overlap":new zt(Ne.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(Ne.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(Ne.layout_symbol["text-ignore-placement"]),"text-optional":new zt(Ne.layout_symbol["text-optional"])})}};class IA{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt("FormatSectionOverride",IA,{omit:["defaultValue"]});class ah extends n{constructor(t){super(t,Hh)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const d of s)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const d=this.layout.get(t).evaluate(r,{},s,l),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||Qo(f.value)||!d?d:function(_,b){return b.replace(/{([^{}]+)}/g,(E,D)=>_&&D in _?String(_[D]):"")}(r.properties,d)}createBucket(t){return new uc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Hh.paint.overridableProperties){if(!ah.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new IA(r),l=new Ba(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Nn("source",l):new is("composite",l,r.value.zoomStops),this.paint._values[t]=new On(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&ah.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=Hh.paint.properties[r];let d=!1;const f=_=>{for(const b of _)if(l.overrides&&l.overrides.hasOverride(b))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Tr)f(s.value.value.sections);else if(s.value.kind==="source"){const _=E=>{d||(E instanceof bn&&ar(E.value)===Ln?f(E.value.sections):E instanceof zs?f(E.sections):E.eachChild(_))},b=s.value;b._styleExpression&&_(b._styleExpression.expression)}return d}}let bA;var Bg={get paint(){return bA=bA||new u({"background-color":new zt(Ne.paint_background["background-color"]),"background-pattern":new Oo(Ne.paint_background["background-pattern"]),"background-opacity":new zt(Ne.paint_background["background-opacity"])})}};class Cg extends n{constructor(t){super(t,Bg)}}let wA;var Eg={get paint(){return wA=wA||new u({"raster-opacity":new zt(Ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(Ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(Ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(Ne.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(Ne.paint_raster["raster-saturation"]),"raster-contrast":new zt(Ne.paint_raster["raster-contrast"]),"raster-resampling":new zt(Ne.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(Ne.paint_raster["raster-fade-duration"])})}};class Qg extends n{constructor(t){super(t,Eg)}}class kg extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Sg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const jh=63710088e-1;class Jo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jo(Bt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,d=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return jh*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof Jo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Jo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Jo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vA=2*Math.PI*jh;function xA(i){return vA*Math.cos(i*Math.PI/180)}function BA(i){return(180+i)/360}function CA(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function EA(i,t){return i/xA(t)}function Jh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class zc{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Jo.convert(t);return new zc(BA(s.lng),CA(s.lat),EA(r,s.lat))}toLngLat(){return new Jo(360*this.x-180,Jh(this.y))}toAltitude(){return this.z*xA(Jh(this.y))}meterInMercatorCoordinateUnits(){return 1/vA*(t=Jh(this.y),1/Math.cos(t*Math.PI/180));var t}}function QA(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class Yh{constructor(t,r,s){if(!function(l,d,f){return!(l<0||l>25||f<0||f>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Gc(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const l=(f=this.y,_=this.z,b=QA(256*(d=this.x),256*(f=Math.pow(2,_)-f-1),_),E=QA(256*(d+1),256*(f+1),_),b[0]+","+b[1]+","+E[0]+","+E[1]);var d,f,_,b,E;const D=function(R,O,Y){let W,X="";for(let pe=R;pe>0;pe--)W=1<<pe-1,X+=(O&W?1:0)+(Y&W?2:0);return X}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new me((t.x*r-this.x)*pr,(t.y*r-this.y)*pr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kA{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Gc(t,r.z,r.z,r.x,r.y)}}class us{constructor(t,r,s,l,d){if(t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Yh(s,+l,+d),this.key=Gc(r,t,s,l,d)}clone(){return new us(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new us(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Gc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Gc(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new us(r,this.wrap,r,s,l),new us(r,this.wrap,r,s+1,l),new us(r,this.wrap,r,s,l+1),new us(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new us(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new zc(t.x-this.wrap,t.y))}}function Gc(i,t,r,s,l){(i*=2)<0&&(i=-1*i-1);const d=1<<r;return(d*d*i+d*l+s).toString(36)+r.toString(36)+t.toString(36)}xt("CanonicalTileID",Yh),xt("OverscaledTileID",us,{omit:["posMatrix"]});class SA{constructor(t,r,s,l=1,d=1,f=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Ot(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=f,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<b;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(b,E)]=this.data[this._idx(b-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,b)]=this.data[this._idx(E,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<b;E++)for(let D=0;D<b;D++){const R=this.get(E,D);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(t,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,d=r*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:l=d-1;break;case 1:d=l+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const b=-r*this.dim,E=-s*this.dim;for(let D=f;D<_;D++)for(let R=l;R<d;R++)this.data[this._idx(R,D)]=t.data[this._idx(R+b,D+E)]}}xt("DEMData",SA);class DA{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class MA{constructor(t,r,s,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class TA{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new as(pr,16,0),this.grid3D=new as(pr,16,0),this.featureIndexArray=new Se,this.promoteId=r}insert(t,r,s,l,d,f){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,d);const b=f?this.grid3D:this.grid;for(let E=0;E<r.length;E++){const D=r[E],R=[1/0,1/0,-1/0,-1/0];for(let O=0;O<D.length;O++){const Y=D[O];R[0]=Math.min(R[0],Y.x),R[1]=Math.min(R[1],Y.y),R[2]=Math.max(R[2],Y.x),R[3]=Math.max(R[3],Y.y)}R[0]<pr&&R[1]<pr&&R[2]>=0&&R[3]>=0&&b.insert(_,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Vo.VectorTile(new Rh(this.rawTileData)).layers,this.sourceLayerCoder=new DA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,l){this.loadVTLayers();const d=t.params||{},f=pr/t.tileSize/t.scale,_=Qs(d.filter),b=t.queryGeometry,E=t.queryPadding*f,D=LA(b),R=this.grid.query(D.minX-E,D.minY-E,D.maxX+E,D.maxY+E),O=LA(t.cameraQueryGeometry),Y=this.grid3D.query(O.minX-E,O.minY-E,O.maxX+E,O.maxY+E,(pe,be,Re,Ee)=>function(Pe,Ve,st,St,$t){for(const vt of Pe)if(Ve<=vt.x&&st<=vt.y&&St>=vt.x&&$t>=vt.y)return!0;const kt=[new me(Ve,st),new me(Ve,$t),new me(St,$t),new me(St,st)];if(Pe.length>2){for(const vt of kt)if(nc(Pe,vt))return!0}for(let vt=0;vt<Pe.length-1;vt++)if(hf(Pe[vt],Pe[vt+1],kt))return!0;return!1}(t.cameraQueryGeometry,pe-E,be-E,Re+E,Ee+E));for(const pe of Y)R.push(pe);R.sort(Dg);const W={};let X;for(let pe=0;pe<R.length;pe++){const be=R[pe];if(be===X)continue;X=be;const Re=this.featureIndexArray.get(be);let Ee=null;this.loadMatchingFeature(W,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,_,d.layers,d.availableImages,r,s,l,(Pe,Ve,st)=>(Ee||(Ee=Pl(Pe)),Ve.queryIntersectsFeature(b,Pe,st,Ee,this.z,t.transform,f,t.pixelPosMatrix)))}return W}loadMatchingFeature(t,r,s,l,d,f,_,b,E,D,R){const O=this.bucketLayerIDs[r];if(f&&!function(pe,be){for(let Re=0;Re<pe.length;Re++)if(be.indexOf(pe[Re])>=0)return!0;return!1}(f,O))return;const Y=this.sourceLayerCoder.decode(s),W=this.vtLayers[Y].feature(l);if(d.needGeometry){const pe=Ll(W,!0);if(!d.filter(new Vi(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!d.filter(new Vi(this.tileID.overscaledZ),W))return;const X=this.getId(W,Y);for(let pe=0;pe<O.length;pe++){const be=O[pe];if(f&&f.indexOf(be)<0)continue;const Re=b[be];if(!Re)continue;let Ee={};X&&D&&(Ee=D.getState(Re.sourceLayer||"_geojsonTileLayer",X));const Pe=yt({},E[be]);Pe.paint=PA(Pe.paint,Re.paint,W,Ee,_),Pe.layout=PA(Pe.layout,Re.layout,W,Ee,_);const Ve=!R||R(W,Re,Ee);if(!Ve)continue;const st=new MA(W,this.z,this.x,this.y,X);st.layer=Pe;let St=t[be];St===void 0&&(St=t[be]=[]),St.push({featureIndex:l,feature:st,intersectionZ:Ve})}}lookupSymbolFeatures(t,r,s,l,d,f,_,b){const E={};this.loadVTLayers();const D=Qs(d);for(const R of t)this.loadMatchingFeature(E,s,l,R,D,f,_,b,r);return E}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;return this.promoteId&&(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function PA(i,t,r,s,l){return Ft(i,(d,f)=>{const _=t instanceof Da?t.get(f):null;return _&&_.evaluate?_.evaluate(r,s,l):_})}function LA(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of i)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return{minX:t,minY:r,maxX:s,maxY:l}}function Dg(i,t){return t-i}function RA(i,t,r,s,l){const d=[];for(let f=0;f<i.length;f++){const _=i[f];let b;for(let E=0;E<_.length-1;E++){let D=_[E],R=_[E+1];D.x<t&&R.x<t||(D.x<t?D=new me(t,D.y+(t-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x<t&&(R=new me(t,D.y+(t-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y<r&&R.y<r||(D.y<r?D=new me(D.x+(r-D.y)/(R.y-D.y)*(R.x-D.x),r)._round():R.y<r&&(R=new me(D.x+(r-D.y)/(R.y-D.y)*(R.x-D.x),r)._round()),D.x>=s&&R.x>=s||(D.x>=s?D=new me(s,D.y+(s-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x>=s&&(R=new me(s,D.y+(s-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y>=l&&R.y>=l||(D.y>=l?D=new me(D.x+(l-D.y)/(R.y-D.y)*(R.x-D.x),l)._round():R.y>=l&&(R=new me(D.x+(l-D.y)/(R.y-D.y)*(R.x-D.x),l)._round()),b&&D.equals(b[b.length-1])||(b=[D],d.push(b)),b.push(R)))))}}return d}xt("FeatureIndex",TA,{omit:["rawTileData","sourceLayerCoder"]});class Yo extends me{constructor(t,r,s,l){super(t,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new Yo(this.x,this.y,this.angle,this.segment)}}function FA(i,t,r,s,l){if(t.segment===void 0||r===0)return!0;let d=t,f=t.segment+1,_=0;for(;_>-r/2;){if(f--,f<0)return!1;_-=i[f].dist(d),d=i[f]}_+=i[f].dist(i[f+1]),f++;const b=[];let E=0;for(;_<r/2;){const D=i[f],R=i[f+1];if(!R)return!1;let O=i[f-1].angleTo(D)-D.angleTo(R);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:_,angleDelta:O}),E+=O;_-b[0].distance>s;)E-=b.shift().angleDelta;if(E>l)return!1;f++,_+=D.dist(R)}return!0}function zA(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function GA(i,t,r){return i?.6*t*r:0}function UA(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function Mg(i,t,r,s,l,d){const f=GA(r,l,d),_=UA(r,s)*d;let b=0;const E=zA(i)/2;for(let D=0;D<i.length-1;D++){const R=i[D],O=i[D+1],Y=R.dist(O);if(b+Y>E){const W=(E-b)/Y,X=yr.number(R.x,O.x,W),pe=yr.number(R.y,O.y,W),be=new Yo(X,pe,O.angleTo(R),D);return be._round(),!f||FA(i,be,_,f,t)?be:void 0}b+=Y}}function Tg(i,t,r,s,l,d,f,_,b){const E=GA(s,d,f),D=UA(s,l),R=D*f,O=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return t-R<t/4&&(t=R+t/4),NA(i,O?t/2*_%t:(D/2+2*d)*f*_%t,t,E,r,R,O,!1,b)}function NA(i,t,r,s,l,d,f,_,b){const E=d/2,D=zA(i);let R=0,O=t-r,Y=[];for(let W=0;W<i.length-1;W++){const X=i[W],pe=i[W+1],be=X.dist(pe),Re=pe.angleTo(X);for(;O+r<R+be;){O+=r;const Ee=(O-R)/be,Pe=yr.number(X.x,pe.x,Ee),Ve=yr.number(X.y,pe.y,Ee);if(Pe>=0&&Pe<b&&Ve>=0&&Ve<b&&O-E>=0&&O+E<=D){const st=new Yo(Pe,Ve,Re,W);st._round(),s&&!FA(i,st,d,s,l)||Y.push(st)}}R+=be}return _||Y.length||f||(Y=NA(i,R/2,r,s,l,d,f,!0,b)),Y}xt("Anchor",Yo);const Ac=kn;function OA(i,t,r,s){const l=[],d=i.image,f=d.pixelRatio,_=d.paddedRect.w-2*Ac,b=d.paddedRect.h-2*Ac;let E={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const D=d.stretchX||[[0,_]],R=d.stretchY||[[0,b]],O=(We,qt)=>We+qt[1]-qt[0],Y=D.reduce(O,0),W=R.reduce(O,0),X=_-Y,pe=b-W;let be=0,Re=Y,Ee=0,Pe=W,Ve=0,st=X,St=0,$t=pe;if(d.content&&s){const We=d.content,qt=We[2]-We[0],Gt=We[3]-We[1];(d.textFitWidth||d.textFitHeight)&&(E=gA(i)),be=oh(D,0,We[0]),Ee=oh(R,0,We[1]),Re=oh(D,We[0],We[2]),Pe=oh(R,We[1],We[3]),Ve=We[0]-be,St=We[1]-Ee,st=qt-Re,$t=Gt-Pe}const kt=E.x1,vt=E.y1,Ut=E.x2-kt,Rt=E.y2-vt,Mt=(We,qt,Gt,ni)=>{const Hi=lh(We.stretch-be,Re,Ut,kt),Oi=ch(We.fixed-Ve,st,We.stretch,Y),Br=lh(qt.stretch-Ee,Pe,Rt,vt),Ds=ch(qt.fixed-St,$t,qt.stretch,W),Gr=lh(Gt.stretch-be,Re,Ut,kt),Cr=ch(Gt.fixed-Ve,st,Gt.stretch,Y),fn=lh(ni.stretch-Ee,Pe,Rt,vt),gn=ch(ni.fixed-St,$t,ni.stretch,W),pn=new me(Hi,Br),or=new me(Gr,Br),Er=new me(Gr,fn),nn=new me(Hi,fn),Ur=new me(Oi/f,Ds/f),mn=new me(Cr/f,gn/f),Nr=t*Math.PI/180;if(Nr){const Mi=Math.sin(Nr),Ji=Math.cos(Nr),Yi=[Ji,-Mi,Mi,Ji];pn._matMult(Yi),or._matMult(Yi),nn._matMult(Yi),Er._matMult(Yi)}const As=We.stretch+We.fixed,Sn=qt.stretch+qt.fixed;return{tl:pn,tr:or,bl:nn,br:Er,tex:{x:d.paddedRect.x+Ac+As,y:d.paddedRect.y+Ac+Sn,w:Gt.stretch+Gt.fixed-As,h:ni.stretch+ni.fixed-Sn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ur,pixelOffsetBR:mn,minFontScaleX:st/f/Ut,minFontScaleY:$t/f/Rt,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const We=qA(D,X,Y),qt=qA(R,pe,W);for(let Gt=0;Gt<We.length-1;Gt++){const ni=We[Gt],Hi=We[Gt+1];for(let Oi=0;Oi<qt.length-1;Oi++)l.push(Mt(ni,qt[Oi],Hi,qt[Oi+1]))}}else l.push(Mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:b+1}));return l}function oh(i,t,r){let s=0;for(const l of i)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function qA(i,t,r){const s=[{fixed:-Ac,stretch:0}];for(const[l,d]of i){const f=s[s.length-1];s.push({fixed:l-f.stretch,stretch:f.stretch}),s.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return s.push({fixed:t+Ac,stretch:r}),s}function lh(i,t,r,s){return i/t*r+s}function ch(i,t,r,s){return i-t*r/s}class hh{constructor(t,r,s,l,d,f,_,b,E,D){var R;if(this.boxStartIndex=t.length,E){let O=f.top,Y=f.bottom;const W=f.collisionPadding;W&&(O-=W[1],Y+=W[3]);let X=Y-O;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const O=!((R=f.image)===null||R===void 0)&&R.content&&(f.image.textFitWidth||f.image.textFitHeight)?gA(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};O.y1=O.y1*_-b[0],O.y2=O.y2*_+b[2],O.x1=O.x1*_-b[3],O.x2=O.x2*_+b[1];const Y=f.collisionPadding;if(Y&&(O.x1-=Y[0]*_,O.y1-=Y[1]*_,O.x2+=Y[2]*_,O.y2+=Y[3]*_),D){const W=new me(O.x1,O.y1),X=new me(O.x2,O.y1),pe=new me(O.x1,O.y2),be=new me(O.x2,O.y2),Re=D*Math.PI/180;W._rotate(Re),X._rotate(Re),pe._rotate(Re),be._rotate(Re),O.x1=Math.min(W.x,X.x,pe.x,be.x),O.x2=Math.max(W.x,X.x,pe.x,be.x),O.y1=Math.min(W.y,X.y,pe.y,be.y),O.y2=Math.max(W.y,X.y,pe.y,be.y)}t.emplaceBack(r.x,r.y,O.x1,O.y1,O.x2,O.y2,s,l,d)}this.boxEndIndex=t.length}}class Pg{constructor(t=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,l=r[t];for(;t>0;){const d=t-1>>1,f=r[d];if(s(l,f)>=0)break;r[t]=f,t=d}r[t]=l}_down(t){const{data:r,compare:s}=this,l=this.length>>1,d=r[t];for(;t<l;){let f=1+(t<<1);const _=f+1;if(_<this.length&&s(r[_],r[f])<0&&(f=_),s(r[f],d)>=0)break;r[t]=r[f],t=f}r[t]=d}}function Lg(i,t=1,r=!1){let s=1/0,l=1/0,d=-1/0,f=-1/0;const _=i[0];for(let Y=0;Y<_.length;Y++){const W=_[Y];(!Y||W.x<s)&&(s=W.x),(!Y||W.y<l)&&(l=W.y),(!Y||W.x>d)&&(d=W.x),(!Y||W.y>f)&&(f=W.y)}const b=Math.min(d-s,f-l);let E=b/2;const D=new Pg([],Rg);if(b===0)return new me(s,l);for(let Y=s;Y<d;Y+=b)for(let W=l;W<f;W+=b)D.push(new dc(Y+E,W+E,E,i));let R=function(Y){let W=0,X=0,pe=0;const be=Y[0];for(let Re=0,Ee=be.length,Pe=Ee-1;Re<Ee;Pe=Re++){const Ve=be[Re],st=be[Pe],St=Ve.x*st.y-st.x*Ve.y;X+=(Ve.x+st.x)*St,pe+=(Ve.y+st.y)*St,W+=3*St}return new dc(X/W,pe/W,0,Y)}(i),O=D.length;for(;D.length;){const Y=D.pop();(Y.d>R.d||!R.d)&&(R=Y,r&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,O)),Y.max-R.d<=t||(E=Y.h/2,D.push(new dc(Y.p.x-E,Y.p.y-E,E,i)),D.push(new dc(Y.p.x+E,Y.p.y-E,E,i)),D.push(new dc(Y.p.x-E,Y.p.y+E,E,i)),D.push(new dc(Y.p.x+E,Y.p.y+E,E,i)),O+=4)}return r&&(console.log(`num probes: ${O}`),console.log(`best distance: ${R.d}`)),R.p}function Rg(i,t){return t.max-i.max}function dc(i,t,r,s){this.p=new me(i,t),this.h=r,this.d=function(l,d){let f=!1,_=1/0;for(let b=0;b<d.length;b++){const E=d[b];for(let D=0,R=E.length,O=R-1;D<R;O=D++){const Y=E[D],W=E[O];Y.y>l.y!=W.y>l.y&&l.x<(W.x-Y.x)*(l.y-Y.y)/(W.y-Y.y)+Y.x&&(f=!f),_=Math.min(_,Cu(l,Y,W))}}return(f?1:-1)*Math.sqrt(_)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var zr;Q.aq=void 0,(zr=Q.aq||(Q.aq={}))[zr.center=1]="center",zr[zr.left=2]="left",zr[zr.right=3]="right",zr[zr.top=4]="top",zr[zr.bottom=5]="bottom",zr[zr["top-left"]=6]="top-left",zr[zr["top-right"]=7]="top-right",zr[zr["bottom-left"]=8]="bottom-left",zr[zr["bottom-right"]=9]="bottom-right";const Ko=7,Kh=Number.POSITIVE_INFINITY;function VA(i,t){return t[1]!==Kh?function(r,s,l){let d=0,f=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":f=l-Ko;break;case"bottom-right":case"bottom-left":case"bottom":f=-l+Ko}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(i,t[0],t[1]):function(r,s){let l=0,d=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-Ko;break;case"bottom-right":case"bottom-left":d=-f+Ko;break;case"bottom":d=-s+Ko;break;case"top":d=s-Ko}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=s;break;case"right":l=-s}return[l,d]}(i,t[0])}function HA(i,t,r){var s;const l=i.layout,d=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(d){const _=d.values,b=[];for(let E=0;E<_.length;E+=2){const D=b[E]=_[E],R=_[E+1].map(O=>O*_r);D.startsWith("top")?R[1]-=Ko:D.startsWith("bottom")&&(R[1]+=Ko),b[E+1]=R}return new Pr(b)}const f=l.get("text-variable-anchor");if(f){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*_r,Kh]:l.get("text-offset").evaluate(t,{},r).map(E=>E*_r);const b=[];for(const E of f)b.push(E,VA(E,_));return new Pr(b)}return null}function Zh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fg(i,t,r,s,l,d,f,_,b,E,D){let R=d.textMaxSize.evaluate(t,{});R===void 0&&(R=f);const O=i.layers[0].layout,Y=O.get("icon-offset").evaluate(t,{},D),W=JA(r.horizontal),X=f/24,pe=i.tilePixelRatio*X,be=i.tilePixelRatio*R/24,Re=i.tilePixelRatio*_,Ee=i.tilePixelRatio*O.get("symbol-spacing"),Pe=O.get("text-padding")*i.tilePixelRatio,Ve=function(We,qt,Gt,ni=1){const Hi=We.get("icon-padding").evaluate(qt,{},Gt),Oi=Hi&&Hi.values;return[Oi[0]*ni,Oi[1]*ni,Oi[2]*ni,Oi[3]*ni]}(O,t,D,i.tilePixelRatio),st=O.get("text-max-angle")/180*Math.PI,St=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",$t=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",kt=O.get("symbol-placement"),vt=Ee/2,Ut=O.get("icon-text-fit");let Rt;s&&Ut!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Rt=pA(s,r.vertical,Ut,O.get("icon-text-fit-padding"),Y,X)),W&&(s=pA(s,W,Ut,O.get("icon-text-fit-padding"),Y,X)));const Mt=(We,qt)=>{qt.x<0||qt.x>=pr||qt.y<0||qt.y>=pr||function(Gt,ni,Hi,Oi,Br,Ds,Gr,Cr,fn,gn,pn,or,Er,nn,Ur,mn,Nr,As,Sn,Mi,Ji,Yi,Vn,rr,fc){const Pa=Gt.addToLineVertexArray(ni,Hi);let La,Ms,ds,Dr,ao=0,Oc=0,$A=0,WA=0,nu=-1,su=-1;const oo={};let XA=ii("");if(Gt.allowVerticalPlacement&&Oi.vertical){const sn=Cr.layout.get("text-rotate").evaluate(Ji,{},rr)+90;ds=new hh(fn,ni,gn,pn,or,Oi.vertical,Er,nn,Ur,sn),Gr&&(Dr=new hh(fn,ni,gn,pn,or,Gr,Nr,As,Ur,sn))}if(Br){const sn=Cr.layout.get("icon-rotate").evaluate(Ji,{}),fs=Cr.layout.get("icon-text-fit")!=="none",Fl=OA(Br,sn,Vn,fs),sa=Gr?OA(Gr,sn,Vn,fs):void 0;Ms=new hh(fn,ni,gn,pn,or,Br,Nr,As,!1,sn),ao=4*Fl.length;const zl=Gt.iconSizeData;let Ra=null;zl.kind==="source"?(Ra=[Ta*Cr.layout.get("icon-size").evaluate(Ji,{})],Ra[0]>jo&&Ot(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${Fc}. Reduce your "icon-size".`)):zl.kind==="composite"&&(Ra=[Ta*Yi.compositeIconSizes[0].evaluate(Ji,{},rr),Ta*Yi.compositeIconSizes[1].evaluate(Ji,{},rr)],(Ra[0]>jo||Ra[1]>jo)&&Ot(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${Fc}. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Fl,Ra,Mi,Sn,Ji,Q.ah.none,ni,Pa.lineStartIndex,Pa.lineLength,-1,rr),nu=Gt.icon.placedSymbolArray.length-1,sa&&(Oc=4*sa.length,Gt.addSymbols(Gt.icon,sa,Ra,Mi,Sn,Ji,Q.ah.vertical,ni,Pa.lineStartIndex,Pa.lineLength,-1,rr),su=Gt.icon.placedSymbolArray.length-1)}const ed=Object.keys(Oi.horizontal);for(const sn of ed){const fs=Oi.horizontal[sn];if(!La){XA=ii(fs.text);const sa=Cr.layout.get("text-rotate").evaluate(Ji,{},rr);La=new hh(fn,ni,gn,pn,or,fs,Er,nn,Ur,sa)}const Fl=fs.positionedLines.length===1;if($A+=jA(Gt,ni,fs,Ds,Cr,Ur,Ji,mn,Pa,Oi.vertical?Q.ah.horizontal:Q.ah.horizontalOnly,Fl?ed:[sn],oo,nu,Yi,rr),Fl)break}Oi.vertical&&(WA+=jA(Gt,ni,Oi.vertical,Ds,Cr,Ur,Ji,mn,Pa,Q.ah.vertical,["vertical"],oo,su,Yi,rr));const Ug=La?La.boxStartIndex:Gt.collisionBoxArray.length,Ng=La?La.boxEndIndex:Gt.collisionBoxArray.length,Og=ds?ds.boxStartIndex:Gt.collisionBoxArray.length,qg=ds?ds.boxEndIndex:Gt.collisionBoxArray.length,Vg=Ms?Ms.boxStartIndex:Gt.collisionBoxArray.length,Hg=Ms?Ms.boxEndIndex:Gt.collisionBoxArray.length,jg=Dr?Dr.boxStartIndex:Gt.collisionBoxArray.length,Jg=Dr?Dr.boxEndIndex:Gt.collisionBoxArray.length;let na=-1;const Ah=(sn,fs)=>sn&&sn.circleDiameter?Math.max(sn.circleDiameter,fs):fs;na=Ah(La,na),na=Ah(ds,na),na=Ah(Ms,na),na=Ah(Dr,na);const td=na>-1?1:0;td&&(na*=fc/_r),Gt.glyphOffsetArray.length>=uc.MAX_GLYPHS&&Ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ji.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Ji.sortKey);const Yg=HA(Cr,Ji,rr),[Kg,Zg]=function(sn,fs){const Fl=sn.length,sa=fs==null?void 0:fs.values;if((sa==null?void 0:sa.length)>0)for(let zl=0;zl<sa.length;zl+=2){const Ra=sa[zl+1];sn.emplaceBack(Q.aq[sa[zl]],Ra[0],Ra[1])}return[Fl,sn.length]}(Gt.textAnchorOffsets,Yg);Gt.symbolInstances.emplaceBack(ni.x,ni.y,oo.right>=0?oo.right:-1,oo.center>=0?oo.center:-1,oo.left>=0?oo.left:-1,oo.vertical||-1,nu,su,XA,Ug,Ng,Og,qg,Vg,Hg,jg,Jg,gn,$A,WA,ao,Oc,td,0,Er,na,Kg,Zg)}(i,qt,We,r,s,l,Rt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,pe,[Pe,Pe,Pe,Pe],St,b,Re,Ve,$t,Y,t,d,E,D,f)};if(kt==="line")for(const We of RA(t.geometry,0,0,pr,pr)){const qt=Tg(We,Ee,st,r.vertical||W,s,24,be,i.overscaling,pr);for(const Gt of qt)W&&zg(i,W.text,vt,Gt)||Mt(We,Gt)}else if(kt==="line-center"){for(const We of t.geometry)if(We.length>1){const qt=Mg(We,st,r.vertical||W,s,24,be);qt&&Mt(We,qt)}}else if(t.type==="Polygon")for(const We of qa(t.geometry,0)){const qt=Lg(We,16);Mt(We[0],new Yo(qt.x,qt.y,0))}else if(t.type==="LineString")for(const We of t.geometry)Mt(We,new Yo(We[0].x,We[0].y,0));else if(t.type==="Point")for(const We of t.geometry)for(const qt of We)Mt([qt],new Yo(qt.x,qt.y,0))}function jA(i,t,r,s,l,d,f,_,b,E,D,R,O,Y,W){const X=function(Re,Ee,Pe,Ve,st,St,$t,kt){const vt=Ve.layout.get("text-rotate").evaluate(St,{})*Math.PI/180,Ut=[];for(const Rt of Ee.positionedLines)for(const Mt of Rt.positionedGlyphs){if(!Mt.rect)continue;const We=Mt.rect||{};let qt=lA+1,Gt=!0,ni=1,Hi=0;const Oi=(st||kt)&&Mt.vertical,Br=Mt.metrics.advance*Mt.scale/2;if(kt&&Ee.verticalizable&&(Hi=Rt.lineOffset/2-(Mt.imageName?-(_r-Mt.metrics.width*Mt.scale)/2:(Mt.scale-1)*_r)),Mt.imageName){const Mi=$t[Mt.imageName];Gt=Mi.sdf,ni=Mi.pixelRatio,qt=kn/ni}const Ds=st?[Mt.x+Br,Mt.y]:[0,0];let Gr=st?[0,0]:[Mt.x+Br+Pe[0],Mt.y+Pe[1]-Hi],Cr=[0,0];Oi&&(Cr=Gr,Gr=[0,0]);const fn=Mt.metrics.isDoubleResolution?2:1,gn=(Mt.metrics.left-qt)*Mt.scale-Br+Gr[0],pn=(-Mt.metrics.top-qt)*Mt.scale+Gr[1],or=gn+We.w/fn*Mt.scale/ni,Er=pn+We.h/fn*Mt.scale/ni,nn=new me(gn,pn),Ur=new me(or,pn),mn=new me(gn,Er),Nr=new me(or,Er);if(Oi){const Mi=new me(-Br,Br-Lc),Ji=-Math.PI/2,Yi=_r/2-Br,Vn=new me(5-Lc-Yi,-(Mt.imageName?Yi:0)),rr=new me(...Cr);nn._rotateAround(Ji,Mi)._add(Vn)._add(rr),Ur._rotateAround(Ji,Mi)._add(Vn)._add(rr),mn._rotateAround(Ji,Mi)._add(Vn)._add(rr),Nr._rotateAround(Ji,Mi)._add(Vn)._add(rr)}if(vt){const Mi=Math.sin(vt),Ji=Math.cos(vt),Yi=[Ji,-Mi,Mi,Ji];nn._matMult(Yi),Ur._matMult(Yi),mn._matMult(Yi),Nr._matMult(Yi)}const As=new me(0,0),Sn=new me(0,0);Ut.push({tl:nn,tr:Ur,bl:mn,br:Nr,tex:We,writingMode:Ee.writingMode,glyphOffset:Ds,sectionIndex:Mt.sectionIndex,isSDF:Gt,pixelOffsetTL:As,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}return Ut}(0,r,_,l,d,f,s,i.allowVerticalPlacement),pe=i.textSizeData;let be=null;pe.kind==="source"?(be=[Ta*l.layout.get("text-size").evaluate(f,{})],be[0]>jo&&Ot(`${i.layerIds[0]}: Value for "text-size" is >= ${Fc}. Reduce your "text-size".`)):pe.kind==="composite"&&(be=[Ta*Y.compositeTextSizes[0].evaluate(f,{},W),Ta*Y.compositeTextSizes[1].evaluate(f,{},W)],(be[0]>jo||be[1]>jo)&&Ot(`${i.layerIds[0]}: Value for "text-size" is >= ${Fc}. Reduce your "text-size".`)),i.addSymbols(i.text,X,be,_,d,f,E,t,b.lineStartIndex,b.lineLength,O,W);for(const Re of D)R[Re]=i.text.placedSymbolArray.length-1;return 4*X.length}function JA(i){for(const t in i)return i[t];return null}function zg(i,t,r,s){const l=i.compareText;if(t in l){const d=l[t];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<r)return!0}else l[t]=[];return l[t].push(s),!1}const YA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $h{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=YA[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new $h(_,f,d,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=YA.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Wh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:_}=this,b=[0,d.length-1,0],E=[];for(;b.length;){const D=b.pop()||0,R=b.pop()||0,O=b.pop()||0;if(R-O<=_){for(let pe=O;pe<=R;pe++){const be=f[2*pe],Re=f[2*pe+1];be>=t&&be<=s&&Re>=r&&Re<=l&&E.push(d[pe])}continue}const Y=O+R>>1,W=f[2*Y],X=f[2*Y+1];W>=t&&W<=s&&X>=r&&X<=l&&E.push(d[Y]),(D===0?t<=W:r<=X)&&(b.push(O),b.push(Y-1),b.push(1-D)),(D===0?s>=W:l>=X)&&(b.push(Y+1),b.push(R),b.push(1-D))}return E}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,_=[0,l.length-1,0],b=[],E=s*s;for(;_.length;){const D=_.pop()||0,R=_.pop()||0,O=_.pop()||0;if(R-O<=f){for(let pe=O;pe<=R;pe++)ZA(d[2*pe],d[2*pe+1],t,r)<=E&&b.push(l[pe]);continue}const Y=O+R>>1,W=d[2*Y],X=d[2*Y+1];ZA(W,X,t,r)<=E&&b.push(l[Y]),(D===0?t-s<=W:r-s<=X)&&(_.push(O),_.push(Y-1),_.push(1-D)),(D===0?t+s>=W:r+s>=X)&&(_.push(Y+1),_.push(R),_.push(1-D))}return b}}function Wh(i,t,r,s,l,d){if(l-s<=r)return;const f=s+l>>1;KA(i,t,f,s,l,d),Wh(i,t,r,s,f-1,1-d),Wh(i,t,r,f+1,l,1-d)}function KA(i,t,r,s,l,d){for(;l>s;){if(l-s>600){const E=l-s+1,D=r-s+1,R=Math.log(E),O=.5*Math.exp(2*R/3),Y=.5*Math.sqrt(R*O*(E-O)/E)*(D-E/2<0?-1:1);KA(i,t,r,Math.max(s,Math.floor(r-D*O/E+Y)),Math.min(l,Math.floor(r+(E-D)*O/E+Y)),d)}const f=t[2*r+d];let _=s,b=l;for(Uc(i,t,s,r),t[2*l+d]>f&&Uc(i,t,s,l);_<b;){for(Uc(i,t,_,b),_++,b--;t[2*_+d]<f;)_++;for(;t[2*b+d]>f;)b--}t[2*s+d]===f?Uc(i,t,s,b):(b++,Uc(i,t,b,l)),b<=r&&(s=b+1),r<=b&&(l=b-1)}}function Uc(i,t,r,s){Xh(i,r,s),Xh(t,2*r,2*s),Xh(t,2*r+1,2*s+1)}function Xh(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function ZA(i,t,r,s){const l=i-r,d=t-s;return l*l+d*d}var eu;Q.bg=void 0,(eu=Q.bg||(Q.bg={})).create="create",eu.load="load",eu.fullLoad="fullLoad";let uh=null,Nc=[];const tu=1e3/60,iu="loadTime",ru="fullLoadTime",Gg={mark(i){performance.mark(i)},frame(i){const t=i;uh!=null&&Nc.push(t-uh),uh=t},clearMetrics(){uh=null,Nc=[],performance.clearMeasures(iu),performance.clearMeasures(ru);for(const i in Q.bg)performance.clearMarks(Q.bg[i])},getPerformanceMetrics(){performance.measure(iu,Q.bg.create,Q.bg.load),performance.measure(ru,Q.bg.create,Q.bg.fullLoad);const i=performance.getEntriesByName(iu)[0].duration,t=performance.getEntriesByName(ru)[0].duration,r=Nc.length,s=1/(Nc.reduce((d,f)=>d+f,0)/r/1e3),l=Nc.filter(d=>d>tu).reduce((d,f)=>d+(f-tu)/tu,0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};Q.$=class extends F{},Q.A=sc,Q.B=Wl,Q.C=function(i){if(li==null){const t=i.navigator?i.navigator.userAgent:null;li=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return li},Q.D=zt,Q.E=Xi,Q.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Sg(()=>this.process()),this.subscription=function(r,s,l,d){return r.addEventListener(s,l,!1),{unsubscribe:()=>{r.removeEventListener(s,l,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Kt(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[l]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[l];const _={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const d=[],f=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:os(i.data,d)});this.target.postMessage(f,{transfer:d})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Kt(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(ks(t.error)):l.resolve(ks(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=ks(t.data),s=new AbortController;this.abortControllers[i]=s;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}})}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?os(t):null,data:os(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},Q.G=Zt,Q.H=function(){var i=new sc(16);return sc!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Q.I=zh,Q.J=function(i,t,r){var s,l,d,f,_,b,E,D,R,O,Y,W,X=r[0],pe=r[1],be=r[2];return t===i?(i[12]=t[0]*X+t[4]*pe+t[8]*be+t[12],i[13]=t[1]*X+t[5]*pe+t[9]*be+t[13],i[14]=t[2]*X+t[6]*pe+t[10]*be+t[14],i[15]=t[3]*X+t[7]*pe+t[11]*be+t[15]):(l=t[1],d=t[2],f=t[3],_=t[4],b=t[5],E=t[6],D=t[7],R=t[8],O=t[9],Y=t[10],W=t[11],i[0]=s=t[0],i[1]=l,i[2]=d,i[3]=f,i[4]=_,i[5]=b,i[6]=E,i[7]=D,i[8]=R,i[9]=O,i[10]=Y,i[11]=W,i[12]=s*X+_*pe+R*be+t[12],i[13]=l*X+b*pe+O*be+t[13],i[14]=d*X+E*pe+Y*be+t[14],i[15]=f*X+D*pe+W*be+t[15]),i},Q.K=function(i,t,r){var s=r[0],l=r[1],d=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*d,i[9]=t[9]*d,i[10]=t[10]*d,i[11]=t[11]*d,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},Q.L=Su,Q.M=function(i,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in i&&(r[l]=i[l])}return r},Q.N=Jo,Q.O=BA,Q.P=me,Q.Q=CA,Q.R=hs,Q.S=us,Q.T=Uo,Q.U=at,Q.V=Ye,Q.W=si,Q.X=pr,Q.Y=I,Q.Z=zc,Q._=c,Q.a=Ht,Q.a$=function(i,t){var r=i[0],s=i[1],l=i[2],d=i[3],f=i[4],_=i[5],b=i[6],E=i[7],D=i[8],R=i[9],O=i[10],Y=i[11],W=i[12],X=i[13],pe=i[14],be=i[15],Re=t[0],Ee=t[1],Pe=t[2],Ve=t[3],st=t[4],St=t[5],$t=t[6],kt=t[7],vt=t[8],Ut=t[9],Rt=t[10],Mt=t[11],We=t[12],qt=t[13],Gt=t[14],ni=t[15];return Math.abs(r-Re)<=dn*Math.max(1,Math.abs(r),Math.abs(Re))&&Math.abs(s-Ee)<=dn*Math.max(1,Math.abs(s),Math.abs(Ee))&&Math.abs(l-Pe)<=dn*Math.max(1,Math.abs(l),Math.abs(Pe))&&Math.abs(d-Ve)<=dn*Math.max(1,Math.abs(d),Math.abs(Ve))&&Math.abs(f-st)<=dn*Math.max(1,Math.abs(f),Math.abs(st))&&Math.abs(_-St)<=dn*Math.max(1,Math.abs(_),Math.abs(St))&&Math.abs(b-$t)<=dn*Math.max(1,Math.abs(b),Math.abs($t))&&Math.abs(E-kt)<=dn*Math.max(1,Math.abs(E),Math.abs(kt))&&Math.abs(D-vt)<=dn*Math.max(1,Math.abs(D),Math.abs(vt))&&Math.abs(R-Ut)<=dn*Math.max(1,Math.abs(R),Math.abs(Ut))&&Math.abs(O-Rt)<=dn*Math.max(1,Math.abs(O),Math.abs(Rt))&&Math.abs(Y-Mt)<=dn*Math.max(1,Math.abs(Y),Math.abs(Mt))&&Math.abs(W-We)<=dn*Math.max(1,Math.abs(W),Math.abs(We))&&Math.abs(X-qt)<=dn*Math.max(1,Math.abs(X),Math.abs(qt))&&Math.abs(pe-Gt)<=dn*Math.max(1,Math.abs(pe),Math.abs(Gt))&&Math.abs(be-ni)<=dn*Math.max(1,Math.abs(be),Math.abs(ni))},Q.a0=ct,Q.a1=Yh,Q.a2=ft,Q.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of i){const l=window.document.createElement("source");br(s)||(t.crossOrigin="Anonymous"),l.src=s,t.appendChild(l)}})},Q.a4=function(){return Pt++},Q.a5=Ae,Q.a6=uc,Q.a7=Qs,Q.a8=Ll,Q.a9=MA,Q.aA=function(i){if(i.type==="custom")return new kg(i);switch(i.type){case"background":return new Cg(i);case"circle":return new df(i);case"fill":return new Sf(i);case"fill-extrusion":return new Hf(i);case"heatmap":return new gf(i);case"hillshade":return new mf(i);case"line":return new Xf(i);case"raster":return new Qg(i);case"symbol":return new ah(i)}},Q.aB=Qt,Q.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!pi(i.version,t.version))return[{command:"setStyle",args:[t]}];pi(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),pi(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),pi(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),pi(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),pi(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),pi(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),pi(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),pi(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),pi(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),pi(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),pi(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},l=[];(function(f,_,b,E){let D;for(D in _=_||{},f=f||{})Object.prototype.hasOwnProperty.call(f,D)&&(Object.prototype.hasOwnProperty.call(_,D)||wr(D,b,E));for(D in _)Object.prototype.hasOwnProperty.call(_,D)&&(Object.prototype.hasOwnProperty.call(f,D)?pi(f[D],_[D])||(f[D].type==="geojson"&&_[D].type==="geojson"&&la(f,_,D)?Gi(b,{command:"setGeoJSONSourceData",args:[D,_[D].data]}):Jr(D,_,b,E)):Kn(D,_,b))})(i.sources,t.sources,l,s);const d=[];i.layers&&i.layers.forEach(f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):d.push(f)}),r=r.concat(l),function(f,_,b){_=_||[];const E=(f=f||[]).map(Ts),D=_.map(Ts),R=f.reduce(ca,{}),O=_.reduce(ca,{}),Y=E.slice(),W=Object.create(null);let X,pe,be,Re,Ee;for(let Pe=0,Ve=0;Pe<E.length;Pe++)X=E[Pe],Object.prototype.hasOwnProperty.call(O,X)?Ve++:(Gi(b,{command:"removeLayer",args:[X]}),Y.splice(Y.indexOf(X,Ve),1));for(let Pe=0,Ve=0;Pe<D.length;Pe++)X=D[D.length-1-Pe],Y[Y.length-1-Pe]!==X&&(Object.prototype.hasOwnProperty.call(R,X)?(Gi(b,{command:"removeLayer",args:[X]}),Y.splice(Y.lastIndexOf(X,Y.length-Ve),1)):Ve++,Re=Y[Y.length-Pe],Gi(b,{command:"addLayer",args:[O[X],Re]}),Y.splice(Y.length-Pe,0,X),W[X]=!0);for(let Pe=0;Pe<D.length;Pe++)if(X=D[Pe],pe=R[X],be=O[X],!W[X]&&!pi(pe,be))if(pi(pe.source,be.source)&&pi(pe["source-layer"],be["source-layer"])&&pi(pe.type,be.type)){for(Ee in ln(pe.layout,be.layout,b,X,null,"setLayoutProperty"),ln(pe.paint,be.paint,b,X,null,"setPaintProperty"),pi(pe.filter,be.filter)||Gi(b,{command:"setFilter",args:[X,be.filter]}),pi(pe.minzoom,be.minzoom)&&pi(pe.maxzoom,be.maxzoom)||Gi(b,{command:"setLayerZoomRange",args:[X,be.minzoom,be.maxzoom]}),pe)Object.prototype.hasOwnProperty.call(pe,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ln(pe[Ee],be[Ee],b,X,Ee.slice(6),"setPaintProperty"):pi(pe[Ee],be[Ee])||Gi(b,{command:"setLayerProperty",args:[X,Ee,be[Ee]]}));for(Ee in be)Object.prototype.hasOwnProperty.call(be,Ee)&&!Object.prototype.hasOwnProperty.call(pe,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?ln(pe[Ee],be[Ee],b,X,Ee.slice(6),"setPaintProperty"):pi(pe[Ee],be[Ee])||Gi(b,{command:"setLayerProperty",args:[X,Ee,be[Ee]]}))}else Gi(b,{command:"removeLayer",args:[X]}),Re=Y[Y.lastIndexOf(X)+1],Gi(b,{command:"addLayer",args:[be,Re]})}(d,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},Q.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},Q.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},Q.aF=Ft,Q.aG=gt,Q.aH=class extends gr{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},Q.aI=Ma,Q.aJ=class extends gr{constructor(i,t){super(i,t),this.current=rc}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},Q.aK=jc,Q.aL=Jc,Q.aM=Ri,Q.aN=class extends gr{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},Q.aO=class extends gr{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},Q.aP=function(i,t,r,s,l,d,f){var _=1/(t-r),b=1/(s-l),E=1/(d-f);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(t+r)*_,i[13]=(l+s)*b,i[14]=(f+d)*E,i[15]=1,i},Q.aQ=Af,Q.aR=class extends k{},Q.aS=rg,Q.aT=class extends S{},Q.aU=Ch,Q.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},Q.aW=Lu,Q.aX=Be,Q.aY=Lt,Q.aZ=class extends se{},Q.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},Q.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,l,d)=>{const f=l||d;return t[s]=!f||f.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},Q.ab=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},Q.ac=lt,Q.ad=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[0],f=t[1],_=t[2],b=t[3],E=t[4],D=t[5],R=t[6],O=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=d*l+E*s,i[1]=f*l+D*s,i[2]=_*l+R*s,i[3]=b*l+O*s,i[4]=E*l-d*s,i[5]=D*l-f*s,i[6]=R*l-_*s,i[7]=O*l-b*s,i},Q.ae=function(i){var t=new sc(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},Q.af=$c,Q.ag=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:f}=i,_=l?lt(Lr.interpolationFactor(l,t,d,f),0,1):0;i.kind==="camera"?s=yr.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:s}},Q.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Ta:i.kind==="composite"?yr.number(s/Ta,l/Ta,r):t},Q.aj=Oh,Q.ak=function(i,t,r,s){const l=t.y-i.y,d=t.x-i.x,f=s.y-r.y,_=s.x-r.x,b=f*d-_*l;if(b===0)return null;const E=(_*(i.y-r.y)-f*(i.x-r.x))/b;return new me(i.x+E*d,i.y+E*l)},Q.al=RA,Q.am=xu,Q.an=vh,Q.ao=function(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const d of i)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return[t,r,s,l]},Q.ap=_r,Q.ar=Nh,Q.as=function(i,t){var r=t[0],s=t[1],l=t[2],d=t[3],f=t[4],_=t[5],b=t[6],E=t[7],D=t[8],R=t[9],O=t[10],Y=t[11],W=t[12],X=t[13],pe=t[14],be=t[15],Re=r*_-s*f,Ee=r*b-l*f,Pe=r*E-d*f,Ve=s*b-l*_,st=s*E-d*_,St=l*E-d*b,$t=D*X-R*W,kt=D*pe-O*W,vt=D*be-Y*W,Ut=R*pe-O*X,Rt=R*be-Y*X,Mt=O*be-Y*pe,We=Re*Mt-Ee*Rt+Pe*Ut+Ve*vt-st*kt+St*$t;return We?(i[0]=(_*Mt-b*Rt+E*Ut)*(We=1/We),i[1]=(l*Rt-s*Mt-d*Ut)*We,i[2]=(X*St-pe*st+be*Ve)*We,i[3]=(O*st-R*St-Y*Ve)*We,i[4]=(b*vt-f*Mt-E*kt)*We,i[5]=(r*Mt-l*vt+d*kt)*We,i[6]=(pe*Pe-W*St-be*Ee)*We,i[7]=(D*St-O*Pe+Y*Ee)*We,i[8]=(f*Rt-_*vt+E*$t)*We,i[9]=(s*vt-r*Rt-d*$t)*We,i[10]=(W*st-X*Pe+be*Re)*We,i[11]=(R*Pe-D*st-Y*Re)*We,i[12]=(_*kt-f*Ut-b*$t)*We,i[13]=(r*Ut-s*kt+l*$t)*We,i[14]=(X*Ee-W*Ve-pe*Re)*We,i[15]=(D*Ve-R*Ee+O*Re)*We,i):null},Q.at=Zh,Q.au=Uh,Q.av=$h,Q.aw=function(){const i={},t=Ne.$version;for(const r in Ne.$root){const s=Ne.$root[r];if(s.required){let l=null;l=r==="version"?t:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},Q.ax=qi,Q.ay=mi,Q.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Dn(i[r],t[i[r].ref]));return i},Q.b=pt,Q.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},Q.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},Q.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},Q.b3=Bt,Q.b4=kA,Q.b5=EA,Q.b6=function(i,t,r,s,l){var d,f=1/Math.tan(t/2);return i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(d=1/(s-l)),i[14]=2*l*s*d):(i[10]=-1,i[14]=-2*s),i},Q.b7=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),d=t[4],f=t[5],_=t[6],b=t[7],E=t[8],D=t[9],R=t[10],O=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=d*l+E*s,i[5]=f*l+D*s,i[6]=_*l+R*s,i[7]=b*l+O*s,i[8]=E*l-d*s,i[9]=D*l-f*s,i[10]=R*l-_*s,i[11]=O*l-b*s,i},Q.b8=$e,Q.b9=Xe,Q.bA=tA,Q.bB=function(i){return i.message===Ai},Q.bC=Ca,Q.bD=ir,Q.ba=function(i){return i*Math.PI/180},Q.bb=function(i,t){const{x:r,y:s}=zc.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},Q.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Q.bd=class extends M{},Q.be=jh,Q.bf=Gg,Q.bh=ri,Q.bi=function(i,t){Ht.REGISTERED_PROTOCOLS[i]=t},Q.bj=function(i){delete Ht.REGISTERED_PROTOCOLS[i]},Q.bk=function(i,t){const r={};for(let l=0;l<i.length;l++){const d=t&&t[i[l].id]||Zl(i[l]);t&&(t[i[l].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},Q.bl=xt,Q.bm=DA,Q.bn=TA,Q.bo=hA,Q.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=pr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new Vi(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Vi(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Vi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:D}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Vi(E),i.canonical),s["text-size"].possiblyEvaluate(new Vi(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:D}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Vi(E),i.canonical),s["icon-size"].possiblyEvaluate(new Vi(D),i.canonical)]}const d=r.get("text-line-height")*_r,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),b=r.get("text-size");for(const E of i.bucket.features){const D=r.get("text-font").evaluate(E,{},i.canonical).join(","),R=b.evaluate(E,{},i.canonical),O=l.layoutTextSize.evaluate(E,{},i.canonical),Y=l.layoutIconSize.evaluate(E,{},i.canonical),W={horizontal:{},vertical:void 0},X=E.text;let pe,be=[0,0];if(X){const Pe=X.toString(),Ve=r.get("text-letter-spacing").evaluate(E,{},i.canonical)*_r,st=Ws(Pe)?Ve:0,St=r.get("text-anchor").evaluate(E,{},i.canonical),$t=HA(t,E,i.canonical);if(!$t){const Rt=r.get("text-radial-offset").evaluate(E,{},i.canonical);be=Rt?VA(St,[Rt*_r,Kh]):r.get("text-offset").evaluate(E,{},i.canonical).map(Mt=>Mt*_r)}let kt=f?"center":r.get("text-justify").evaluate(E,{},i.canonical);const vt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(E,{},i.canonical)*_r:1/0,Ut=()=>{i.bucket.allowVerticalPlacement&&kl(Pe)&&(W.vertical=rh(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,vt,d,St,"left",st,be,Q.ah.vertical,!0,O,R))};if(!f&&$t){const Rt=new Set;if(kt==="auto")for(let We=0;We<$t.values.length;We+=2)Rt.add(Zh($t.values[We]));else Rt.add(kt);let Mt=!1;for(const We of Rt)if(!W.horizontal[We])if(Mt)W.horizontal[We]=W.horizontal[0];else{const qt=rh(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,vt,d,"center",We,st,be,Q.ah.horizontal,!1,O,R);qt&&(W.horizontal[We]=qt,Mt=qt.positionedLines.length===1)}Ut()}else{kt==="auto"&&(kt=Zh(St));const Rt=rh(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,vt,d,St,kt,st,be,Q.ah.horizontal,!1,O,R);Rt&&(W.horizontal[kt]=Rt),Ut(),kl(Pe)&&f&&_&&(W.vertical=rh(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,vt,d,St,kt,st,be,Q.ah.vertical,!1,O,R))}}let Re=!1;if(E.icon&&E.icon.name){const Pe=i.imageMap[E.icon.name];Pe&&(pe=bg(i.imagePositions[E.icon.name],r.get("icon-offset").evaluate(E,{},i.canonical),r.get("icon-anchor").evaluate(E,{},i.canonical)),Re=!!Pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Re:i.bucket.sdfIcons!==Re&&Ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Ee=JA(W.horizontal)||W.vertical;i.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||pe)&&Fg(i.bucket,E,W,pe,i.imageMap,l,O,Y,be,Re,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},Q.bq=Ph,Q.br=Dh,Q.bs=Th,Q.bt=Vo,Q.bu=Rh,Q.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},Q.bw=function(i,t,r,s,l){return c(this,void 0,void 0,function*(){if(Ye())try{return yield si(i,t,r,s,l)}catch{}return function(d,f,_,b,E){const D=d.width,R=d.height;ci&&ai||(ci=new OffscreenCanvas(D,R),ai=ci.getContext("2d",{willReadFrequently:!0})),ci.width=D,ci.height=R,ai.drawImage(d,0,0,D,R);const O=ai.getImageData(f,_,b,E);return ai.clearRect(0,0,D,R),O.data}(i,t,r,s,l)})},Q.bx=SA,Q.by=ne,Q.bz=fe,Q.c=lr,Q.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),Q.e=yt,Q.f=i=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=Vt})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(l):Vt}),Q.g=ei,Q.h=(i,t)=>ki(yt(i,{type:"json"}),t),Q.i=Kt,Q.j=zi,Q.k=Ii,Q.l=(i,t)=>ki(yt(i,{type:"arrayBuffer"}),t),Q.m=ki,Q.n=function(i){return new Rh(i).readFields(fg,[])},Q.o=Qc,Q.p=cA,Q.q=u,Q.r=An,Q.s=br,Q.t=Ro,Q.u=$s,Q.v=Ne,Q.w=Ot,Q.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},Q.y=yr,Q.z=Vi}),T("worker",["./shared"],function(Q){class c{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,H){for(const ge of j){this._layerConfigs[ge.id]=ge;const Ce=this._layers[ge.id]=Q.aA(ge);Ce._featureFilter=Q.a7(Ce.filter),this.keyCache[ge.id]&&delete this.keyCache[ge.id]}for(const ge of H)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const ee=Q.bk(Object.values(this._layerConfigs),this.keyCache);for(const ge of ee){const Ce=ge.map(ze=>this._layers[ze.id]),Me=Ce[0];if(Me.visibility==="none")continue;const Le=Me.source||"";let we=this.familiesBySource[Le];we||(we=this.familiesBySource[Le]={});const qe=Me.sourceLayer||"_geojsonTileLayer";let rt=we[qe];rt||(rt=we[qe]=[]),rt.push(Ce)}}}class ne{constructor(j){const H={},ee=[];for(const Le in j){const we=j[Le],qe=H[Le]={};for(const rt in we){const ze=we[+rt];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const _t={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};ee.push(_t),qe[rt]={rect:_t,metrics:ze.metrics}}}const{w:ge,h:Ce}=Q.p(ee),Me=new Q.o({width:ge||1,height:Ce||1});for(const Le in j){const we=j[Le];for(const qe in we){const rt=we[+qe];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const ze=H[Le][qe].rect;Q.o.copy(rt.bitmap,Me,{x:0,y:0},{x:ze.x+1,y:ze.y+1},rt.bitmap)}}this.image=Me,this.positions=H}}Q.bl("GlyphAtlas",ne);class fe{constructor(j){this.tileID=new Q.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,H,ee,ge){return Q._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new Q.a5;const Ce=new Q.bm(Object.keys(j.layers).sort()),Me=new Q.bn(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const Le={},we={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},qe=H.familiesBySource[this.source];for(const gi in qe){const Pi=j.layers[gi];if(!Pi)continue;Pi.version===1&&Q.w(`Vector tile source "${this.source}" layer "${gi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ji=Ce.encode(gi),sr=[];for(let dr=0;dr<Pi.length;dr++){const fr=Pi.feature(dr),In=Me.getId(fr,gi);sr.push({feature:fr,id:In,index:dr,sourceLayerIndex:ji})}for(const dr of qe[gi]){const fr=dr[0];fr.source!==this.source&&Q.w(`layer.source = ${fr.source} does not equal this.source = ${this.source}`),fr.minzoom&&this.zoom<Math.floor(fr.minzoom)||fr.maxzoom&&this.zoom>=fr.maxzoom||fr.visibility!=="none"&&(xe(dr,this.zoom,ee),(Le[fr.id]=fr.createBucket({index:Me.bucketLayerIDs.length,layers:dr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ji,sourceID:this.source})).populate(sr,we,this.tileID.canonical),Me.bucketLayerIDs.push(dr.map(In=>In.id)))}}const rt=Q.aF(we.glyphDependencies,gi=>Object.keys(gi).map(Number));this.inFlightDependencies.forEach(gi=>gi==null?void 0:gi.abort()),this.inFlightDependencies=[];let ze=Promise.resolve({});if(Object.keys(rt).length){const gi=new AbortController;this.inFlightDependencies.push(gi),ze=ge.sendAsync({type:"GG",data:{stacks:rt,source:this.source,tileID:this.tileID,type:"glyphs"}},gi)}const _t=Object.keys(we.iconDependencies);let Nt=Promise.resolve({});if(_t.length){const gi=new AbortController;this.inFlightDependencies.push(gi),Nt=ge.sendAsync({type:"GI",data:{icons:_t,source:this.source,tileID:this.tileID,type:"icons"}},gi)}const Jt=Object.keys(we.patternDependencies);let wi=Promise.resolve({});if(Jt.length){const gi=new AbortController;this.inFlightDependencies.push(gi),wi=ge.sendAsync({type:"GI",data:{icons:Jt,source:this.source,tileID:this.tileID,type:"patterns"}},gi)}const[hi,Ei,yi]=yield Promise.all([ze,Nt,wi]),nr=new ne(hi),Ki=new Q.bo(Ei,yi);for(const gi in Le){const Pi=Le[gi];Pi instanceof Q.a6?(xe(Pi.layers,this.zoom,ee),Q.bp({bucket:Pi,glyphMap:hi,glyphPositions:nr.positions,imageMap:Ei,imagePositions:Ki.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Pi.hasPattern&&(Pi instanceof Q.bq||Pi instanceof Q.br||Pi instanceof Q.bs)&&(xe(Pi.layers,this.zoom,ee),Pi.addFeatures(we,this.tileID.canonical,Ki.patternPositions))}return this.status="done",{buckets:Object.values(Le).filter(gi=>!gi.isEmpty()),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nr.image,imageAtlas:Ki,glyphMap:this.returnDependencies?hi:null,iconMap:this.returnDependencies?Ei:null,glyphPositions:this.returnDependencies?nr.positions:null}})}}function xe(_e,j,H){const ee=new Q.z(j);for(const ge of _e)ge.recalculate(ee,H)}class me{constructor(j,H,ee){this.actor=j,this.layerIndex=H,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,H){return Q._(this,void 0,void 0,function*(){const ee=yield Q.l(j.request,H);try{return{vectorTile:new Q.bt.VectorTile(new Q.bu(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(ge){const Ce=new Uint8Array(ee.data);let Me=`Unable to parse the tile at ${j.request.url}, `;throw Me+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ge.message}`,new Error(Me)}})}loadTile(j){return Q._(this,void 0,void 0,function*(){const H=j.uid,ee=!!(j&&j.request&&j.request.collectResourceTiming)&&new Q.bv(j.request),ge=new fe(j);this.loading[H]=ge;const Ce=new AbortController;ge.abort=Ce;try{const Me=yield this.loadVectorTile(j,Ce);if(delete this.loading[H],!Me)return null;const Le=Me.rawData,we={};Me.expires&&(we.expires=Me.expires),Me.cacheControl&&(we.cacheControl=Me.cacheControl);const qe={};if(ee){const ze=ee.finish();ze&&(qe.resourceTiming=JSON.parse(JSON.stringify(ze)))}ge.vectorTile=Me.vectorTile;const rt=ge.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[H]=ge,this.fetching[H]={rawTileData:Le,cacheControl:we,resourceTiming:qe};try{const ze=yield rt;return Q.e({rawTileData:Le.slice(0)},ze,we,qe)}finally{delete this.fetching[H]}}catch(Me){throw delete this.loading[H],ge.status="done",this.loaded[H]=ge,Me}})}reloadTile(j){return Q._(this,void 0,void 0,function*(){const H=j.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[H];if(ee.showCollisionBoxes=j.showCollisionBoxes,ee.status==="parsing"){const ge=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ce;if(this.fetching[H]){const{rawTileData:Me,cacheControl:Le,resourceTiming:we}=this.fetching[H];delete this.fetching[H],Ce=Q.e({rawTileData:Me.slice(0)},ge,Le,we)}else Ce=ge;return Ce}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(j){return Q._(this,void 0,void 0,function*(){const H=this.loading,ee=j.uid;H&&H[ee]&&H[ee].abort&&(H[ee].abort.abort(),delete H[ee])})}removeTile(j){return Q._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class he{constructor(){this.loaded={}}loadTile(j){return Q._(this,void 0,void 0,function*(){const{uid:H,encoding:ee,rawImageData:ge,redFactor:Ce,greenFactor:Me,blueFactor:Le,baseShift:we}=j,qe=ge.width+2,rt=ge.height+2,ze=Q.b(ge)?new Q.R({width:qe,height:rt},yield Q.bw(ge,-1,-1,qe,rt)):ge,_t=new Q.bx(H,ze,ee,Ce,Me,Le,we);return this.loaded=this.loaded||{},this.loaded[H]=_t,_t})}removeTile(j){const H=this.loaded,ee=j.uid;H&&H[ee]&&delete H[ee]}}function Ue(_e,j){if(_e.length!==0){Ze(_e[0],j);for(var H=1;H<_e.length;H++)Ze(_e[H],!j)}}function Ze(_e,j){for(var H=0,ee=0,ge=0,Ce=_e.length,Me=Ce-1;ge<Ce;Me=ge++){var Le=(_e[ge][0]-_e[Me][0])*(_e[Me][1]+_e[ge][1]),we=H+Le;ee+=Math.abs(H)>=Math.abs(Le)?H-we+Le:Le-we+H,H=we}H+ee>=0!=!!j&&_e.reverse()}var nt=Q.by(function _e(j,H){var ee,ge=j&&j.type;if(ge==="FeatureCollection")for(ee=0;ee<j.features.length;ee++)_e(j.features[ee],H);else if(ge==="GeometryCollection")for(ee=0;ee<j.geometries.length;ee++)_e(j.geometries[ee],H);else if(ge==="Feature")_e(j.geometry,H);else if(ge==="Polygon")Ue(j.coordinates,H);else if(ge==="MultiPolygon")for(ee=0;ee<j.coordinates.length;ee++)Ue(j.coordinates[ee],H);return j});const it=Q.bt.VectorTileFeature.prototype.toGeoJSON;var at={exports:{}},Ye=Q.bz,$e=Q.bt.VectorTileFeature,Xe=lt;function lt(_e,j){this.options=j||{},this.features=_e,this.length=_e.length}function Bt(_e,j){this.id=typeof _e.id=="number"?_e.id:void 0,this.type=_e.type,this.rawGeometry=_e.type===1?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=j||4096}lt.prototype.feature=function(_e){return new Bt(this.features[_e],this.options.extent)},Bt.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var j=0;j<_e.length;j++){for(var H=_e[j],ee=[],ge=0;ge<H.length;ge++)ee.push(new Ye(H[ge][0],H[ge][1]));this.geometry.push(ee)}return this.geometry},Bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,j=1/0,H=-1/0,ee=1/0,ge=-1/0,Ce=0;Ce<_e.length;Ce++)for(var Me=_e[Ce],Le=0;Le<Me.length;Le++){var we=Me[Le];j=Math.min(j,we.x),H=Math.max(H,we.x),ee=Math.min(ee,we.y),ge=Math.max(ge,we.y)}return[j,ee,H,ge]},Bt.prototype.toGeoJSON=$e.prototype.toGeoJSON;var yt=Q.bA,Pt=Xe;function Ft(_e){var j=new yt;return function(H,ee){for(var ge in H.layers)ee.writeMessage(3,gt,H.layers[ge])}(_e,j),j.finish()}function gt(_e,j){var H;j.writeVarintField(15,_e.version||1),j.writeStringField(1,_e.name||""),j.writeVarintField(5,_e.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<_e.length;H++)ee.feature=_e.feature(H),j.writeMessage(2,Qt,ee);var ge=ee.keys;for(H=0;H<ge.length;H++)j.writeStringField(3,ge[H]);var Ce=ee.values;for(H=0;H<Ce.length;H++)j.writeMessage(4,li,Ce[H])}function Qt(_e,j){var H=_e.feature;H.id!==void 0&&j.writeVarintField(1,H.id),j.writeMessage(2,Tt,_e),j.writeVarintField(3,H.type),j.writeMessage(4,Kt,H)}function Tt(_e,j){var H=_e.feature,ee=_e.keys,ge=_e.values,Ce=_e.keycache,Me=_e.valuecache;for(var Le in H.properties){var we=H.properties[Le],qe=Ce[Le];if(we!==null){qe===void 0&&(ee.push(Le),Ce[Le]=qe=ee.length-1),j.writeVarint(qe);var rt=typeof we;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(we=JSON.stringify(we));var ze=rt+":"+we,_t=Me[ze];_t===void 0&&(ge.push(we),Me[ze]=_t=ge.length-1),j.writeVarint(_t)}}}function Ot(_e,j){return(j<<3)+(7&_e)}function Yt(_e){return _e<<1^_e>>31}function Kt(_e,j){for(var H=_e.loadGeometry(),ee=_e.type,ge=0,Ce=0,Me=H.length,Le=0;Le<Me;Le++){var we=H[Le],qe=1;ee===1&&(qe=we.length),j.writeVarint(Ot(1,qe));for(var rt=ee===3?we.length-1:we.length,ze=0;ze<rt;ze++){ze===1&&ee!==1&&j.writeVarint(Ot(2,rt-1));var _t=we[ze].x-ge,Nt=we[ze].y-Ce;j.writeVarint(Yt(_t)),j.writeVarint(Yt(Nt)),ge+=_t,Ce+=Nt}ee===3&&j.writeVarint(Ot(7,1))}}function li(_e,j){var H=typeof _e;H==="string"?j.writeStringField(1,_e):H==="boolean"?j.writeBooleanField(7,_e):H==="number"&&(_e%1!=0?j.writeDoubleField(3,_e):_e<0?j.writeSVarintField(6,_e):j.writeVarintField(5,_e))}at.exports=Ft,at.exports.fromVectorTileJs=Ft,at.exports.fromGeojsonVt=function(_e,j){j=j||{};var H={};for(var ee in _e)H[ee]=new Pt(_e[ee].features,j),H[ee].name=ee,H[ee].version=j.version,H[ee].extent=j.extent;return Ft({layers:H})},at.exports.GeoJSONWrapper=Pt;var pt=Q.by(at.exports);const Vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},si=Math.fround||(ci=new Float32Array(1),_e=>(ci[0]=+_e,ci[0]));var ci;const ai=3,Ai=5,lr=6;class Ht{constructor(j){this.options=Object.assign(Object.create(Vt),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:H,minZoom:ee,maxZoom:ge}=this.options;H&&console.time("total time");const Ce=`prepare ${j.length} points`;H&&console.time(Ce),this.points=j;const Me=[];for(let we=0;we<j.length;we++){const qe=j[we];if(!qe.geometry)continue;const[rt,ze]=qe.geometry.coordinates,_t=si(ri(rt)),Nt=si(mi(ze));Me.push(_t,Nt,1/0,we,-1,1),this.options.reduce&&Me.push(0)}let Le=this.trees[ge+1]=this._createTree(Me);H&&console.timeEnd(Ce);for(let we=ge;we>=ee;we--){const qe=+Date.now();Le=this.trees[we]=this._createTree(this._cluster(Le,we)),H&&console.log("z%d: %d clusters in %dms",we,Le.numItems,+Date.now()-qe)}return H&&console.timeEnd("total time"),this}getClusters(j,H){let ee=((j[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,j[1]));let Ce=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ee=-180,Ce=180;else if(ee>Ce){const ze=this.getClusters([ee,ge,180,Me],H),_t=this.getClusters([-180,ge,Ce,Me],H);return ze.concat(_t)}const Le=this.trees[this._limitZoom(H)],we=Le.range(ri(ee),mi(Me),ri(Ce),mi(ge)),qe=Le.data,rt=[];for(const ze of we){const _t=this.stride*ze;rt.push(qe[_t+Ai]>1?ei(qe,_t,this.clusterProps):this.points[qe[_t+ai]])}return rt}getChildren(j){const H=this._getOriginId(j),ee=this._getOriginZoom(j),ge="No cluster with the specified id.",Ce=this.trees[ee];if(!Ce)throw new Error(ge);const Me=Ce.data;if(H*this.stride>=Me.length)throw new Error(ge);const Le=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),we=Ce.within(Me[H*this.stride],Me[H*this.stride+1],Le),qe=[];for(const rt of we){const ze=rt*this.stride;Me[ze+4]===j&&qe.push(Me[ze+Ai]>1?ei(Me,ze,this.clusterProps):this.points[Me[ze+ai]])}if(qe.length===0)throw new Error(ge);return qe}getLeaves(j,H,ee){const ge=[];return this._appendLeaves(ge,j,H=H||10,ee=ee||0,0),ge}getTile(j,H,ee){const ge=this.trees[this._limitZoom(j)],Ce=Math.pow(2,j),{extent:Me,radius:Le}=this.options,we=Le/Me,qe=(ee-we)/Ce,rt=(ee+1+we)/Ce,ze={features:[]};return this._addTileFeatures(ge.range((H-we)/Ce,qe,(H+1+we)/Ce,rt),ge.data,H,ee,Ce,ze),H===0&&this._addTileFeatures(ge.range(1-we/Ce,qe,1,rt),ge.data,Ce,ee,Ce,ze),H===Ce-1&&this._addTileFeatures(ge.range(0,qe,we/Ce,rt),ge.data,-1,ee,Ce,ze),ze.features.length?ze:null}getClusterExpansionZoom(j){let H=this._getOriginZoom(j)-1;for(;H<=this.options.maxZoom;){const ee=this.getChildren(j);if(H++,ee.length!==1)break;j=ee[0].properties.cluster_id}return H}_appendLeaves(j,H,ee,ge,Ce){const Me=this.getChildren(H);for(const Le of Me){const we=Le.properties;if(we&&we.cluster?Ce+we.point_count<=ge?Ce+=we.point_count:Ce=this._appendLeaves(j,we.cluster_id,ee,ge,Ce):Ce<ge?Ce++:j.push(Le),j.length===ee)break}return Ce}_createTree(j){const H=new Q.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<j.length;ee+=this.stride)H.add(j[ee],j[ee+1]);return H.finish(),H.data=j,H}_addTileFeatures(j,H,ee,ge,Ce,Me){for(const Le of j){const we=Le*this.stride,qe=H[we+Ai]>1;let rt,ze,_t;if(qe)rt=Zt(H,we,this.clusterProps),ze=H[we],_t=H[we+1];else{const wi=this.points[H[we+ai]];rt=wi.properties;const[hi,Ei]=wi.geometry.coordinates;ze=ri(hi),_t=mi(Ei)}const Nt={type:1,geometry:[[Math.round(this.options.extent*(ze*Ce-ee)),Math.round(this.options.extent*(_t*Ce-ge))]],tags:rt};let Jt;Jt=qe||this.options.generateId?H[we+ai]:this.points[H[we+ai]].id,Jt!==void 0&&(Nt.id=Jt),Me.features.push(Nt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,H){const{radius:ee,extent:ge,reduce:Ce,minPoints:Me}=this.options,Le=ee/(ge*Math.pow(2,H)),we=j.data,qe=[],rt=this.stride;for(let ze=0;ze<we.length;ze+=rt){if(we[ze+2]<=H)continue;we[ze+2]=H;const _t=we[ze],Nt=we[ze+1],Jt=j.within(we[ze],we[ze+1],Le),wi=we[ze+Ai];let hi=wi;for(const Ei of Jt){const yi=Ei*rt;we[yi+2]>H&&(hi+=we[yi+Ai])}if(hi>wi&&hi>=Me){let Ei,yi=_t*wi,nr=Nt*wi,Ki=-1;const gi=((ze/rt|0)<<5)+(H+1)+this.points.length;for(const Pi of Jt){const ji=Pi*rt;if(we[ji+2]<=H)continue;we[ji+2]=H;const sr=we[ji+Ai];yi+=we[ji]*sr,nr+=we[ji+1]*sr,we[ji+4]=gi,Ce&&(Ei||(Ei=this._map(we,ze,!0),Ki=this.clusterProps.length,this.clusterProps.push(Ei)),Ce(Ei,this._map(we,ji)))}we[ze+4]=gi,qe.push(yi/hi,nr/hi,1/0,gi,-1,hi),Ce&&qe.push(Ki)}else{for(let Ei=0;Ei<rt;Ei++)qe.push(we[ze+Ei]);if(hi>1)for(const Ei of Jt){const yi=Ei*rt;if(!(we[yi+2]<=H)){we[yi+2]=H;for(let nr=0;nr<rt;nr++)qe.push(we[yi+nr])}}}}return qe}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,H,ee){if(j[H+Ai]>1){const Me=this.clusterProps[j[H+lr]];return ee?Object.assign({},Me):Me}const ge=this.points[j[H+ai]].properties,Ce=this.options.map(ge);return ee&&Ce===ge?Object.assign({},Ce):Ce}}function ei(_e,j,H){return{type:"Feature",id:_e[j+ai],properties:Zt(_e,j,H),geometry:{type:"Point",coordinates:[(ee=_e[j],360*(ee-.5)),ki(_e[j+1])]}};var ee}function Zt(_e,j,H){const ee=_e[j+Ai],ge=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,Ce=_e[j+lr],Me=Ce===-1?{}:Object.assign({},H[Ce]);return Object.assign(Me,{cluster:!0,cluster_id:_e[j+ai],point_count:ee,point_count_abbreviated:ge})}function ri(_e){return _e/360+.5}function mi(_e){const j=Math.sin(_e*Math.PI/180),H=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return H<0?0:H>1?1:H}function ki(_e){const j=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function br(_e,j,H,ee){let ge=ee;const Ce=j+(H-j>>1);let Me,Le=H-j;const we=_e[j],qe=_e[j+1],rt=_e[H],ze=_e[H+1];for(let _t=j+3;_t<H;_t+=3){const Nt=mr(_e[_t],_e[_t+1],we,qe,rt,ze);if(Nt>ge)Me=_t,ge=Nt;else if(Nt===ge){const Jt=Math.abs(_t-Ce);Jt<Le&&(Me=_t,Le=Jt)}}ge>ee&&(Me-j>3&&br(_e,j,Me,ee),_e[Me+2]=ge,H-Me>3&&br(_e,Me,H,ee))}function mr(_e,j,H,ee,ge,Ce){let Me=ge-H,Le=Ce-ee;if(Me!==0||Le!==0){const we=((_e-H)*Me+(j-ee)*Le)/(Me*Me+Le*Le);we>1?(H=ge,ee=Ce):we>0&&(H+=Me*we,ee+=Le*we)}return Me=_e-H,Le=j-ee,Me*Me+Le*Le}function $i(_e,j,H,ee){const ge={id:_e??null,type:j,geometry:H,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Ii(ge,H);else if(j==="Polygon")Ii(ge,H[0]);else if(j==="MultiLineString")for(const Ce of H)Ii(ge,Ce);else if(j==="MultiPolygon")for(const Ce of H)Ii(ge,Ce[0]);return ge}function Ii(_e,j){for(let H=0;H<j.length;H+=3)_e.minX=Math.min(_e.minX,j[H]),_e.minY=Math.min(_e.minY,j[H+1]),_e.maxX=Math.max(_e.maxX,j[H]),_e.maxY=Math.max(_e.maxY,j[H+1])}function zi(_e,j,H,ee){if(!j.geometry)return;const ge=j.geometry.coordinates;if(ge&&ge.length===0)return;const Ce=j.geometry.type,Me=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let Le=[],we=j.id;if(H.promoteId?we=j.properties[H.promoteId]:H.generateId&&(we=ee||0),Ce==="Point")Xi(ge,Le);else if(Ce==="MultiPoint")for(const qe of ge)Xi(qe,Le);else if(Ce==="LineString")Ne(ge,Le,Me,!1);else if(Ce==="MultiLineString"){if(H.lineMetrics){for(const qe of ge)Le=[],Ne(qe,Le,Me,!1),_e.push($i(we,"LineString",Le,j.properties));return}cr(ge,Le,Me,!1)}else if(Ce==="Polygon")cr(ge,Le,Me,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const qe of j.geometry.geometries)zi(_e,{id:we,geometry:qe,properties:j.properties},H,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of ge){const rt=[];cr(qe,rt,Me,!0),Le.push(rt)}}_e.push($i(we,Ce,Le,j.properties))}function Xi(_e,j){j.push(Dn(_e[0]),pi(_e[1]),0)}function Ne(_e,j,H,ee){let ge,Ce,Me=0;for(let we=0;we<_e.length;we++){const qe=Dn(_e[we][0]),rt=pi(_e[we][1]);j.push(qe,rt,0),we>0&&(Me+=ee?(ge*rt-qe*Ce)/2:Math.sqrt(Math.pow(qe-ge,2)+Math.pow(rt-Ce,2))),ge=qe,Ce=rt}const Le=j.length-3;j[2]=1,br(j,0,Le,H),j[Le+2]=1,j.size=Math.abs(Me),j.start=0,j.end=j.size}function cr(_e,j,H,ee){for(let ge=0;ge<_e.length;ge++){const Ce=[];Ne(_e[ge],Ce,H,ee),j.push(Ce)}}function Dn(_e){return _e/360+.5}function pi(_e){const j=Math.sin(_e*Math.PI/180),H=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return H<0?0:H>1?1:H}function Gi(_e,j,H,ee,ge,Ce,Me,Le){if(ee/=j,Ce>=(H/=j)&&Me<ee)return _e;if(Me<H||Ce>=ee)return null;const we=[];for(const qe of _e){const rt=qe.geometry;let ze=qe.type;const _t=ge===0?qe.minX:qe.minY,Nt=ge===0?qe.maxX:qe.maxY;if(_t>=H&&Nt<ee){we.push(qe);continue}if(Nt<H||_t>=ee)continue;let Jt=[];if(ze==="Point"||ze==="MultiPoint")Kn(rt,Jt,H,ee,ge);else if(ze==="LineString")wr(rt,Jt,H,ee,ge,!1,Le.lineMetrics);else if(ze==="MultiLineString")la(rt,Jt,H,ee,ge,!1);else if(ze==="Polygon")la(rt,Jt,H,ee,ge,!0);else if(ze==="MultiPolygon")for(const wi of rt){const hi=[];la(wi,hi,H,ee,ge,!0),hi.length&&Jt.push(hi)}if(Jt.length){if(Le.lineMetrics&&ze==="LineString"){for(const wi of Jt)we.push($i(qe.id,ze,wi,qe.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(Jt.length===1?(ze="LineString",Jt=Jt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=Jt.length===3?"Point":"MultiPoint"),we.push($i(qe.id,ze,Jt,qe.tags))}}return we.length?we:null}function Kn(_e,j,H,ee,ge){for(let Ce=0;Ce<_e.length;Ce+=3){const Me=_e[Ce+ge];Me>=H&&Me<=ee&&ln(j,_e[Ce],_e[Ce+1],_e[Ce+2])}}function wr(_e,j,H,ee,ge,Ce,Me){let Le=Jr(_e);const we=ge===0?Ts:ca;let qe,rt,ze=_e.start;for(let hi=0;hi<_e.length-3;hi+=3){const Ei=_e[hi],yi=_e[hi+1],nr=_e[hi+2],Ki=_e[hi+3],gi=_e[hi+4],Pi=ge===0?Ei:yi,ji=ge===0?Ki:gi;let sr=!1;Me&&(qe=Math.sqrt(Math.pow(Ei-Ki,2)+Math.pow(yi-gi,2))),Pi<H?ji>H&&(rt=we(Le,Ei,yi,Ki,gi,H),Me&&(Le.start=ze+qe*rt)):Pi>ee?ji<ee&&(rt=we(Le,Ei,yi,Ki,gi,ee),Me&&(Le.start=ze+qe*rt)):ln(Le,Ei,yi,nr),ji<H&&Pi>=H&&(rt=we(Le,Ei,yi,Ki,gi,H),sr=!0),ji>ee&&Pi<=ee&&(rt=we(Le,Ei,yi,Ki,gi,ee),sr=!0),!Ce&&sr&&(Me&&(Le.end=ze+qe*rt),j.push(Le),Le=Jr(_e)),Me&&(ze+=qe)}let _t=_e.length-3;const Nt=_e[_t],Jt=_e[_t+1],wi=ge===0?Nt:Jt;wi>=H&&wi<=ee&&ln(Le,Nt,Jt,_e[_t+2]),_t=Le.length-3,Ce&&_t>=3&&(Le[_t]!==Le[0]||Le[_t+1]!==Le[1])&&ln(Le,Le[0],Le[1],Le[2]),Le.length&&j.push(Le)}function Jr(_e){const j=[];return j.size=_e.size,j.start=_e.start,j.end=_e.end,j}function la(_e,j,H,ee,ge,Ce){for(const Me of _e)wr(Me,j,H,ee,ge,Ce,!1)}function ln(_e,j,H,ee){_e.push(j,H,ee)}function Ts(_e,j,H,ee,ge,Ce){const Me=(Ce-j)/(ee-j);return ln(_e,Ce,H+(ge-H)*Me,1),Me}function ca(_e,j,H,ee,ge,Ce){const Me=(Ce-H)/(ge-H);return ln(_e,j+(ee-j)*Me,Ce,1),Me}function ft(_e,j){const H=[];for(let ee=0;ee<_e.length;ee++){const ge=_e[ee],Ce=ge.type;let Me;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Me=Mn(ge.geometry,j);else if(Ce==="MultiLineString"||Ce==="Polygon"){Me=[];for(const Le of ge.geometry)Me.push(Mn(Le,j))}else if(Ce==="MultiPolygon"){Me=[];for(const Le of ge.geometry){const we=[];for(const qe of Le)we.push(Mn(qe,j));Me.push(we)}}H.push($i(ge.id,Ce,Me,ge.tags))}return H}function Mn(_e,j){const H=[];H.size=_e.size,_e.start!==void 0&&(H.start=_e.start,H.end=_e.end);for(let ee=0;ee<_e.length;ee+=3)H.push(_e[ee]+j,_e[ee+1],_e[ee+2]);return H}function vr(_e,j){if(_e.transformed)return _e;const H=1<<_e.z,ee=_e.x,ge=_e.y;for(const Ce of _e.features){const Me=Ce.geometry,Le=Ce.type;if(Ce.geometry=[],Le===1)for(let we=0;we<Me.length;we+=2)Ce.geometry.push(Tn(Me[we],Me[we+1],j,H,ee,ge));else for(let we=0;we<Me.length;we++){const qe=[];for(let rt=0;rt<Me[we].length;rt+=2)qe.push(Tn(Me[we][rt],Me[we][rt+1],j,H,ee,ge));Ce.geometry.push(qe)}}return _e.transformed=!0,_e}function Tn(_e,j,H,ee,ge,Ce){return[Math.round(H*(_e*ee-ge)),Math.round(H*(j*ee-Ce))]}function cn(_e,j,H,ee,ge){const Ce=j===ge.maxZoom?0:ge.tolerance/((1<<j)*ge.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:_e.length,source:null,x:H,y:ee,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Le of _e)ut(Me,Le,Ce,ge);return Me}function ut(_e,j,H,ee){const ge=j.geometry,Ce=j.type,Me=[];if(_e.minX=Math.min(_e.minX,j.minX),_e.minY=Math.min(_e.minY,j.minY),_e.maxX=Math.max(_e.maxX,j.maxX),_e.maxY=Math.max(_e.maxY,j.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Le=0;Le<ge.length;Le+=3)Me.push(ge[Le],ge[Le+1]),_e.numPoints++,_e.numSimplified++;else if(Ce==="LineString")di(Me,ge,_e,H,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Le=0;Le<ge.length;Le++)di(Me,ge[Le],_e,H,Ce==="Polygon",Le===0);else if(Ce==="MultiPolygon")for(let Le=0;Le<ge.length;Le++){const we=ge[Le];for(let qe=0;qe<we.length;qe++)di(Me,we[qe],_e,H,!0,qe===0)}if(Me.length){let Le=j.tags||null;if(Ce==="LineString"&&ee.lineMetrics){Le={};for(const qe in j.tags)Le[qe]=j.tags[qe];Le.mapbox_clip_start=ge.start/ge.size,Le.mapbox_clip_end=ge.end/ge.size}const we={geometry:Me,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Le};j.id!==null&&(we.id=j.id),_e.features.push(we)}}function di(_e,j,H,ee,ge,Ce){const Me=ee*ee;if(ee>0&&j.size<(ge?Me:ee))return void(H.numPoints+=j.length/3);const Le=[];for(let we=0;we<j.length;we+=3)(ee===0||j[we+2]>Me)&&(H.numSimplified++,Le.push(j[we],j[we+1])),H.numPoints++;ge&&function(we,qe){let rt=0;for(let ze=0,_t=we.length,Nt=_t-2;ze<_t;Nt=ze,ze+=2)rt+=(we[ze]-we[Nt])*(we[ze+1]+we[Nt+1]);if(rt>0===qe)for(let ze=0,_t=we.length;ze<_t/2;ze+=2){const Nt=we[ze],Jt=we[ze+1];we[ze]=we[_t-2-ze],we[ze+1]=we[_t-1-ze],we[_t-2-ze]=Nt,we[_t-1-ze]=Jt}}(Le,Ce),_e.push(Le)}const Wt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xt{constructor(j,H){const ee=(H=this.options=function(Ce,Me){for(const Le in Me)Ce[Le]=Me[Le];return Ce}(Object.create(Wt),H)).debug;if(ee&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let ge=function(Ce,Me){const Le=[];if(Ce.type==="FeatureCollection")for(let we=0;we<Ce.features.length;we++)zi(Le,Ce.features[we],Me,we);else zi(Le,Ce.type==="Feature"?Ce:{geometry:Ce},Me);return Le}(j,H);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(Ce,Me){const Le=Me.buffer/Me.extent;let we=Ce;const qe=Gi(Ce,1,-1-Le,Le,0,-1,2,Me),rt=Gi(Ce,1,1-Le,2+Le,0,-1,2,Me);return(qe||rt)&&(we=Gi(Ce,1,-Le,1+Le,0,-1,2,Me)||[],qe&&(we=ft(qe,1).concat(we)),rt&&(we=we.concat(ft(rt,-1)))),we}(ge,H),ge.length&&this.splitTile(ge,0,0,0),ee&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,H,ee,ge,Ce,Me,Le){const we=[j,H,ee,ge],qe=this.options,rt=qe.debug;for(;we.length;){ge=we.pop(),ee=we.pop(),H=we.pop(),j=we.pop();const ze=1<<H,_t=hn(H,ee,ge);let Nt=this.tiles[_t];if(!Nt&&(rt>1&&console.time("creation"),Nt=this.tiles[_t]=cn(j,H,ee,ge,qe),this.tileCoords.push({z:H,x:ee,y:ge}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,ee,ge,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));const sr=`z${H}`;this.stats[sr]=(this.stats[sr]||0)+1,this.total++}if(Nt.source=j,Ce==null){if(H===qe.indexMaxZoom||Nt.numPoints<=qe.indexMaxPoints)continue}else{if(H===qe.maxZoom||H===Ce)continue;if(Ce!=null){const sr=Ce-H;if(ee!==Me>>sr||ge!==Le>>sr)continue}}if(Nt.source=null,j.length===0)continue;rt>1&&console.time("clipping");const Jt=.5*qe.buffer/qe.extent,wi=.5-Jt,hi=.5+Jt,Ei=1+Jt;let yi=null,nr=null,Ki=null,gi=null,Pi=Gi(j,ze,ee-Jt,ee+hi,0,Nt.minX,Nt.maxX,qe),ji=Gi(j,ze,ee+wi,ee+Ei,0,Nt.minX,Nt.maxX,qe);j=null,Pi&&(yi=Gi(Pi,ze,ge-Jt,ge+hi,1,Nt.minY,Nt.maxY,qe),nr=Gi(Pi,ze,ge+wi,ge+Ei,1,Nt.minY,Nt.maxY,qe),Pi=null),ji&&(Ki=Gi(ji,ze,ge-Jt,ge+hi,1,Nt.minY,Nt.maxY,qe),gi=Gi(ji,ze,ge+wi,ge+Ei,1,Nt.minY,Nt.maxY,qe),ji=null),rt>1&&console.timeEnd("clipping"),we.push(yi||[],H+1,2*ee,2*ge),we.push(nr||[],H+1,2*ee,2*ge+1),we.push(Ki||[],H+1,2*ee+1,2*ge),we.push(gi||[],H+1,2*ee+1,2*ge+1)}}getTile(j,H,ee){j=+j,H=+H,ee=+ee;const ge=this.options,{extent:Ce,debug:Me}=ge;if(j<0||j>24)return null;const Le=1<<j,we=hn(j,H=H+Le&Le-1,ee);if(this.tiles[we])return vr(this.tiles[we],Ce);Me>1&&console.log("drilling down to z%d-%d-%d",j,H,ee);let qe,rt=j,ze=H,_t=ee;for(;!qe&&rt>0;)rt--,ze>>=1,_t>>=1,qe=this.tiles[hn(rt,ze,_t)];return qe&&qe.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",rt,ze,_t),console.time("drilling down")),this.splitTile(qe.source,rt,ze,_t,j,H,ee),Me>1&&console.timeEnd("drilling down"),this.tiles[we]?vr(this.tiles[we],Ce):null):null}}function hn(_e,j,H){return 32*((1<<_e)*H+j)+_e}function oi(_e,j){return j?_e.properties[j]:_e.id}function Pn(_e,j){if(_e==null)return!0;if(_e.type==="Feature")return oi(_e,j)!=null;if(_e.type==="FeatureCollection"){const H=new Set;for(const ee of _e.features){const ge=oi(ee,j);if(ge==null||H.has(ge))return!1;H.add(ge)}return!0}return!1}function Ln(_e,j){const H=new Map;if(_e!=null)if(_e.type==="Feature")H.set(oi(_e,j),_e);else for(const ee of _e.features)H.set(oi(ee,j),ee);return H}class Zn extends me{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,H){return Q._(this,void 0,void 0,function*(){const ee=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ge=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!ge)return null;const Ce=new class{constructor(Le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Q.X,this.length=Le.length,this._features=Le}feature(Le){return new class{constructor(we){this._feature=we,this.extent=Q.X,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const qe of this._feature.geometry)we.push([new Q.P(qe[0],qe[1])]);return we}{const we=[];for(const qe of this._feature.geometry){const rt=[];for(const ze of qe)rt.push(new Q.P(ze[0],ze[1]));we.push(rt)}return we}}toGeoJSON(we,qe,rt){return it.call(this,we,qe,rt)}}(this._features[Le])}}(ge.features);let Me=pt(Ce);return Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),{vectorTile:Ce,rawData:Me.buffer}})}loadData(j){return Q._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const ee=!!(j&&j.request&&j.request.collectResourceTiming)&&new Q.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new Ht(function({superclusterOptions:Me,clusterProperties:Le}){if(!Le||!Me)return Me;const we={},qe={},rt={accumulated:null,zoom:0},ze={properties:null},_t=Object.keys(Le);for(const Nt of _t){const[Jt,wi]=Le[Nt],hi=Q.bC(wi),Ei=Q.bC(typeof Jt=="string"?[Jt,["accumulated"],["get",Nt]]:Jt);we[Nt]=hi.value,qe[Nt]=Ei.value}return Me.map=Nt=>{ze.properties=Nt;const Jt={};for(const wi of _t)Jt[wi]=we[wi].evaluate(rt,ze);return Jt},Me.reduce=(Nt,Jt)=>{ze.properties=Jt;for(const wi of _t)rt.accumulated=Nt[wi],Nt[wi]=qe[wi].evaluate(rt,ze)},Me}(j)).load((yield this._pendingData).features):(ge=yield this._pendingData,new Xt(ge,j.geojsonVtOptions)),this.loaded={};const Ce={};if(ee){const Me=ee.finish();Me&&(Ce.resourceTiming={},Ce.resourceTiming[j.source]=JSON.parse(JSON.stringify(Me)))}return Ce}catch(Ce){if(delete this._pendingRequest,Q.bB(Ce))return{abandoned:!0};throw Ce}var ge})}getData(){return Q._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const H=this.loaded;return H&&H[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,H){return Q._(this,void 0,void 0,function*(){let ee=yield this.loadGeoJSON(j,H);if(delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(nt(ee,!0),j.filter){const ge=Q.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(Me=>ge.value.evaluate({zoom:0},Me))}}return ee})}loadGeoJSON(j,H){return Q._(this,void 0,void 0,function*(){const{promoteId:ee}=j;if(j.request){const ge=yield Q.h(j.request,H);return this._dataUpdateable=Pn(ge.data,ee)?Ln(ge.data,ee):void 0,ge.data}if(typeof j.data=="string")try{const ge=JSON.parse(j.data);return this._dataUpdateable=Pn(ge,ee)?Ln(ge,ee):void 0,ge}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(ge,Ce,Me){var Le,we,qe,rt;if(Ce.removeAll&&ge.clear(),Ce.remove)for(const ze of Ce.remove)ge.delete(ze);if(Ce.add)for(const ze of Ce.add){const _t=oi(ze,Me);_t!=null&&ge.set(_t,ze)}if(Ce.update)for(const ze of Ce.update){let _t=ge.get(ze.id);if(_t==null)continue;const Nt=!ze.removeAllProperties&&(((Le=ze.removeProperties)===null||Le===void 0?void 0:Le.length)>0||((we=ze.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((ze.newGeometry||ze.removeAllProperties||Nt)&&(_t=Object.assign({},_t),ge.set(ze.id,_t),Nt&&(_t.properties=Object.assign({},_t.properties))),ze.newGeometry&&(_t.geometry=ze.newGeometry),ze.removeAllProperties)_t.properties={};else if(((qe=ze.removeProperties)===null||qe===void 0?void 0:qe.length)>0)for(const Jt of ze.removeProperties)Object.prototype.hasOwnProperty.call(_t.properties,Jt)&&delete _t.properties[Jt];if(((rt=ze.addOrUpdateProperties)===null||rt===void 0?void 0:rt.length)>0)for(const{key:Jt,value:wi}of ze.addOrUpdateProperties)_t.properties[Jt]=wi}}(this._dataUpdateable,j.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return Q._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class _n{constructor(j){this.self=j,this.actor=new Q.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,ee)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=ee},this.self.addProtocol=Q.bi,this.self.removeProtocol=Q.bj,this.self.registerRTLTextPlugin=H=>{if(Q.bD.isParsed())throw new Error("RTL text plugin already registered.");Q.bD.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,ee)=>this._getDEMWorkerSource(H,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(H,ee)=>Q._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(H,ee)=>Q._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(H,ee)=>Q._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(H,ee)=>Q._(this,void 0,void 0,function*(){return this._getWorkerSource(H,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("GD",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).getData()),this.actor.registerMessageHandler("LT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(H,ee)=>this._getWorkerSource(H,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(H,ee)=>Q._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][ee.type]||!this.workerSources[H][ee.type][ee.source])return;const ge=this.workerSources[H][ee.type][ee.source];delete this.workerSources[H][ee.type][ee.source],ge.removeSource!==void 0&&ge.removeSource(ee)})),this.actor.registerMessageHandler("RM",H=>Q._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,ee)=>Q._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(H,ee)=>this._syncRTLPluginState(H,ee)),this.actor.registerMessageHandler("IS",(H,ee)=>Q._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(H,ee)=>this._setImages(H,ee)),this.actor.registerMessageHandler("UL",(H,ee)=>Q._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(H,ee)=>Q._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(ee)}))}_setImages(j,H){return Q._(this,void 0,void 0,function*(){this.availableImages[j]=H;for(const ee in this.workerSources[j]){const ge=this.workerSources[j][ee];for(const Ce in ge)ge[Ce].availableImages=H}})}_syncRTLPluginState(j,H){return Q._(this,void 0,void 0,function*(){if(Q.bD.isParsed())return Q.bD.getState();if(H.pluginStatus!=="loading")return Q.bD.setState(H),H;const ee=H.pluginURL;if(this.self.importScripts(ee),Q.bD.isParsed()){const ge={pluginStatus:"loaded",pluginURL:ee};return Q.bD.setState(ge),ge}throw Q.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ee}`)})}_getAvailableImages(j){let H=this.availableImages[j];return H||(H=[]),H}_getLayerIndex(j){let H=this.layerIndexes[j];return H||(H=this.layerIndexes[j]=new c),H}_getWorkerSource(j,H,ee){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][H]||(this.workerSources[j][H]={}),!this.workerSources[j][H][ee]){const ge={sendAsync:(Ce,Me)=>(Ce.targetMapId=j,this.actor.sendAsync(Ce,Me))};switch(H){case"vector":this.workerSources[j][H][ee]=new me(ge,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][H][ee]=new Zn(ge,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][H][ee]=new this.externalWorkerSourceTypes[H](ge,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][H][ee]}_getDEMWorkerSource(j,H){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][H]||(this.demWorkerSources[j][H]=new he),this.demWorkerSources[j][H]}}return Q.i(self)&&(self.worker=new _n(self)),_n}),T("index",["exports","./shared"],function(Q,c){var ne="4.7.1";let fe,xe;const me={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:u=>new Promise((e,n)=>{const a=requestAnimationFrame(e);u.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(c.c())})}),getImageData(u,e=0){return this.getImageCanvasContext(u).getImageData(-e,-e,u.width+2*e,u.height+2*e)},getImageCanvasContext(u){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=u.width,e.height=u.height,n.drawImage(u,0,0,u.width,u.height),n},resolveURL:u=>(fe||(fe=document.createElement("a")),fe.href=u,fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(xe==null&&(xe=matchMedia("(prefers-reduced-motion: reduce)")),xe.matches)}};class he{static testProp(e){if(!he.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in he.docStyle)return e[n];return e[0]}static create(e,n,a){const o=window.document.createElement(e);return n!==void 0&&(o.className=n),a&&a.appendChild(o),o}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(e,n){e.style[he.transformProp]=n}static addEventListener(e,n,a,o={}){e.addEventListener(n,a,"passive"in o?o:o.capture)}static removeEventListener(e,n,a,o={}){e.removeEventListener(n,a,"passive"in o?o:o.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",he.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const o=n.boundingClientRect;return new c.P((a.clientX-o.left)/n.x-e.clientLeft,(a.clientY-o.top)/n.y-e.clientTop)}static mousePos(e,n){const a=he.getScale(e);return he.getPoint(e,a,n)}static touchPos(e,n){const a=[],o=he.getScale(e);for(let h=0;h<n.length;h++)a.push(he.getPoint(e,o,n[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const Ue={supported:!1,testSupport:function(u){!it&&nt&&(at?Ye(u):Ze=u)}};let Ze,nt,it=!1,at=!1;function Ye(u){const e=u.createTexture();u.bindTexture(u.TEXTURE_2D,e);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,nt),u.isContextLost())return;Ue.supported=!0}catch{}u.deleteTexture(e),it=!0}var $e;typeof document<"u"&&(nt=document.createElement("img"),nt.onload=()=>{Ze&&Ye(Ze),Ze=null,at=!0},nt.onerror=()=>{it=!0,Ze=null},nt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let e,n,a,o;u.resetRequestQueue=()=>{e=[],n=0,a=0,o={}},u.addThrottleControl=C=>{const M=a++;return o[M]=C,M},u.removeThrottleControl=C=>{delete o[C],I()},u.getImage=(C,M,F=!0)=>new Promise((z,$)=>{Ue.supported&&(C.headers||(C.headers={}),C.headers.accept="image/webp,*/*"),c.e(C,{type:"image"}),e.push({abortController:M,requestParameters:C,supportImageRefresh:F,state:"queued",onError:te=>{$(te)},onSuccess:te=>{z(te)}}),I()});const h=C=>c._(this,void 0,void 0,function*(){C.state="running";const{requestParameters:M,supportImageRefresh:F,onError:z,onSuccess:$,abortController:te}=C,le=F===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((A,v)=>A&&v==="accept",!0));n++;const m=le?w(M,te):c.m(M,te);try{const A=yield m;delete C.abortController,C.state="completed",A.data instanceof HTMLImageElement||c.b(A.data)?$(A):A.data&&$({data:yield(g=A.data,typeof createImageBitmap=="function"?c.d(g):c.f(g)),cacheControl:A.cacheControl,expires:A.expires})}catch(A){delete C.abortController,z(A)}finally{n--,I()}var g}),I=()=>{const C=(()=>{for(const M of Object.keys(o))if(o[M]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=n;M<C&&e.length>0;M++){const F=e.shift();F.abortController.signal.aborted?M--:h(F)}},w=(C,M)=>new Promise((F,z)=>{const $=new Image,te=C.url,le=C.credentials;le&&le==="include"?$.crossOrigin="use-credentials":(le&&le==="same-origin"||!c.s(te))&&($.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{$.src="",z(c.c())}),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,F({data:$})},$.onerror=()=>{$.onerror=$.onload=null,M.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=te})}($e||($e={})),$e.resetRequestQueue();class Xe{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function lt(u){var e=new c.A(3);return e[0]=u[0],e[1]=u[1],e[2]=u[2],e}var Bt,yt=function(u,e,n){return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],u};Bt=new c.A(3),c.A!=Float32Array&&(Bt[0]=0,Bt[1]=0,Bt[2]=0);var Pt=function(u){var e=u[0],n=u[1];return e*e+n*n};function Ft(u){const e=[];if(typeof u=="string")e.push({id:"default",url:u});else if(u&&u.length>0){const n=[];for(const{id:a,url:o}of u){const h=`${a}${o}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:a,url:o}))}}return e}function gt(u,e,n){const a=u.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var u=new c.A(2);c.A!=Float32Array&&(u[0]=0,u[1]=0)})();class Qt{constructor(e,n,a,o){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,o)}update(e,n,a){const{width:o,height:h}=e,I=!(this.size&&this.size[0]===o&&this.size[1]===h||a),{context:w}=this,{gl:C}=w;if(this.useMipmap=!!(n&&n.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!n||n.premultiply!==!1)),I)this.size=[o,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,e):C.texImage2D(C.TEXTURE_2D,0,this.format,o,h,0,this.format,C.UNSIGNED_BYTE,e.data);else{const{x:M,y:F}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?C.texSubImage2D(C.TEXTURE_2D,0,M,F,C.RGBA,C.UNSIGNED_BYTE,e):C.texSubImage2D(C.TEXTURE_2D,0,M,F,o,h,C.RGBA,C.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(e,n,a){const{context:o}=this,{gl:h}=o;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Tt(u){const{userImage:e}=u;return!!(e&&e.render&&e.render())&&(u.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ot extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const o=n.data||n.spriteData;return this._validateStretch(n.stretchX,o&&o.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,o&&o.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const o of e){if(o[0]<a||o[1]<o[0]||n<o[1])return!1;a=o[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,o=a&&a.width||n.data.width,h=a&&a.height||n.data.height;return!(e[0]<0||o<e[0]||e[1]<0||h<e[1]||e[2]<0||o<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const o=this.getImage(e);if(a&&(o.data.width!==n.data.width||o.data.height!==n.data.height))throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let o=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(o=!1);this.isLoaded()||o?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let o=this.getImage(a);o||(this.fire(new c.k("styleimagemissing",{id:a})),o=this.getImage(a)),o?n[a]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,textFitWidth:o.textFitWidth,textFitHeight:o.textFitHeight,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const o={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new c.I(o,a);this.patterns[e]={bin:o,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Qt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:n,h:a}=c.p(e),o=this.atlasImage;o.resize({width:n||1,height:a||1});for(const h in this.patterns){const{bin:I}=this.patterns[h],w=I.x+1,C=I.y+1,M=this.getImage(h).data,F=M.width,z=M.height;c.R.copy(M,o,{x:0,y:0},{x:w,y:C},{width:F,height:z}),c.R.copy(M,o,{x:0,y:z-1},{x:w,y:C-1},{width:F,height:1}),c.R.copy(M,o,{x:0,y:0},{x:w,y:C+z},{width:F,height:1}),c.R.copy(M,o,{x:F-1,y:0},{x:w-1,y:C},{width:1,height:z}),c.R.copy(M,o,{x:0,y:0},{x:w+F,y:C},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),Tt(a)&&this.updateImage(n,a)}}}const Yt=1e20;function Kt(u,e,n,a,o,h,I,w,C){for(let M=e;M<e+a;M++)li(u,n*h+M,h,o,I,w,C);for(let M=n;M<n+o;M++)li(u,M*h+e,1,a,I,w,C)}function li(u,e,n,a,o,h,I){h[0]=0,I[0]=-Yt,I[1]=Yt,o[0]=u[e];for(let w=1,C=0,M=0;w<a;w++){o[w]=u[e+w*n];const F=w*w;do{const z=h[C];M=(o[w]-o[z]+F-z*z)/(w-z)/2}while(M<=I[C]&&--C>-1);C++,h[C]=w,I[C]=M,I[C+1]=Yt}for(let w=0,C=0;w<a;w++){for(;I[C+1]<w;)C++;const M=h[C],F=w-M;u[e+w*n]=o[M]+F*F}}class pt{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const h in e)for(const I of e[h])n.push(this._getAndCacheGlyphsPromise(h,I));const a=yield Promise.all(n),o={};for(const{stack:h,id:I,glyph:w}of a)o[h]||(o[h]={}),o[h][I]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return o})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let o=a.glyphs[n];if(o!==void 0)return{stack:e,id:n,glyph:o};if(o=this._tinySDF(a,e,n),o)return a.glyphs[n]=o,{stack:e,id:n,glyph:o};const h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:n,glyph:o};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const w=pt.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=w}const I=yield a.requests[h];for(const w in I)this._doesCharSupportLocalGlyph(+w)||(a.glyphs[+w]=I[+w]);return a.ranges[h]=!0,{stack:e,id:n,glyph:I[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const o=this.localIdeographFontFamily;if(!o||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let w="400";/bold/i.test(n)?w="900":/medium/i.test(n)?w="500":/light/i.test(n)&&(w="200"),h=e.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:o,fontWeight:w})}const I=h.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(u,e,n,a){return c._(this,void 0,void 0,function*(){const o=256*e,h=o+255,I=a.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${o}-${h}`),"Glyphs"),w=yield c.l(I,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${o}-${h}`);const C={};for(const M of c.n(w.data))C[M.id]=M;return C})},pt.TinySDF=class{constructor({fontSize:u=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:o="sans-serif",fontWeight:h="normal",fontStyle:I="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const w=this.size=u+4*e,C=this._createCanvas(w),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${I} ${h} ${u}px ${o}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(u){const e=document.createElement("canvas");return e.width=e.height=u,e}draw(u){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:o,actualBoundingBoxRight:h}=this.ctx.measureText(u),I=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-o))),C=Math.min(this.size-this.buffer,I+Math.ceil(a)),M=w+2*this.buffer,F=C+2*this.buffer,z=Math.max(M*F,0),$=new Uint8ClampedArray(z),te={data:$,width:M,height:F,glyphWidth:w,glyphHeight:C,glyphTop:I,glyphLeft:0,glyphAdvance:e};if(w===0||C===0)return te;const{ctx:le,buffer:m,gridInner:g,gridOuter:A}=this;le.clearRect(m,m,w,C),le.fillText(u,m,m+I);const v=le.getImageData(m,m,w,C);A.fill(Yt,0,z),g.fill(0,0,z);for(let x=0;x<C;x++)for(let k=0;k<w;k++){const P=v.data[4*(x*w+k)+3]/255;if(P===0)continue;const S=(x+m)*M+k+m;if(P===1)A[S]=0,g[S]=Yt;else{const V=.5-P;A[S]=V>0?V*V:0,g[S]=V<0?V*V:0}}Kt(A,0,0,M,F,M,this.f,this.v,this.z),Kt(g,m,m,w,C,M,this.f,this.v,this.z);for(let x=0;x<z;x++){const k=Math.sqrt(A[x])-Math.sqrt(g[x]);$[x]=Math.round(255-255*(k/this.radius+this.cutoff))}return te}};class Vt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:c.y.number(e.x,n.x,a),y:c.y.number(e.y,n.y,a),z:c.y.number(e.z,n.z,a)}}}let si;class ci extends c.E{constructor(e){super(),si=si||new c.q({anchor:new c.D(c.v.light.anchor),position:new Vt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(si),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const ai=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Ai extends c.E{constructor(e){super(),this._transitionable=new c.T(ai),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const o=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),o):this._transitionable.setValue(a,o)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class lr{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const o=[];let h=e.length%2==1?-e[e.length-1]*a:0,I=e[0]*a,w=!0;o.push({left:h,right:I,isDash:w,zeroLength:e[0]===0});let C=e[0];for(let M=1;M<e.length;M++){w=!w;const F=e[M];h=C*a,C+=F,I=C*a,o.push({left:h,right:I,isDash:w,zeroLength:F===0})}return o}addRoundDash(e,n,a){const o=n/2;for(let h=-a;h<=a;h++){const I=this.width*(this.nextRow+a+h);let w=0,C=e[w];for(let M=0;M<this.width;M++){M/C.right>1&&(C=e[++w]);const F=Math.abs(M-C.left),z=Math.abs(M-C.right),$=Math.min(F,z);let te;const le=h/a*(o+1);if(C.isDash){const m=o-Math.abs(le);te=Math.sqrt($*$+m*m)}else te=o-Math.sqrt($*$+le*le);this.data[I+M]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const C=e[w],M=e[w+1];C.zeroLength?e.splice(w,1):M&&M.isDash===C.isDash&&(M.left=C.left,e.splice(w,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const o=this.width*this.nextRow;let h=0,I=e[h];for(let w=0;w<this.width;w++){w/I.right>1&&(I=e[++h]);const C=Math.abs(w-I.left),M=Math.abs(w-I.right),F=Math.min(C,M);this.data[o+w]=Math.max(0,Math.min(255,(I.isDash?F:-F)+128))}}addDash(e,n){const a=n?7:0,o=2*a+1;if(this.nextRow+o>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let w=0;w<e.length;w++)h+=e[w];if(h!==0){const w=this.width/h,C=this.getDashRanges(e,this.width,w);n?this.addRoundDash(C,w,a):this.addRegularDash(C)}const I={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=o,this.dirty=!0,I}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Ht="maplibre_preloaded_worker_pool";class ei{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ei.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ht]}numActive(){return Object.keys(this.active).length}}const Zt=Math.floor(me.hardwareConcurrency/2);let ri,mi;function ki(){return ri||(ri=new ei),ri}ei.workerCount=c.C(globalThis)?Math.max(Math.min(Zt,3),1):1;class br{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let o=0;o<a.length;o++){const h=new c.F(a[o],n);h.name=`Worker ${o}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const o of this.actors)a.push(o.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function mr(){return mi||(mi=new br(ki(),c.G),mi.registerMessageHandler("GR",(u,e,n)=>c.m(e,n))),mi}function $i(u,e){const n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*u.width,.5*u.height,1]),c.L(n,n,u.calculatePosMatrix(e.toUnwrapped()))}function Ii(u,e,n,a,o,h){const I=function(z,$,te){if(z)for(const le of z){const m=$[le];if(m&&m.source===te&&m.type==="fill-extrusion")return!0}else for(const le in $){const m=$[le];if(m.source===te&&m.type==="fill-extrusion")return!0}return!1}(o&&o.layers,e,u.id),w=h.maxPitchScaleFactor(),C=u.tilesIn(a,w,I);C.sort(zi);const M=[];for(const z of C)M.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,u._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,o,h,w,$i(u.transform,z.tileID))});const F=function(z){const $={},te={};for(const le of z){const m=le.queryResults,g=le.wrappedTileID,A=te[g]=te[g]||{};for(const v in m){const x=m[v],k=A[v]=A[v]||{},P=$[v]=$[v]||[];for(const S of x)k[S.featureIndex]||(k[S.featureIndex]=!0,P.push(S))}}return $}(M);for(const z in F)F[z].forEach($=>{const te=$.feature,le=u.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=le});return F}function zi(u,e){const n=u.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Xi(u,e,n){return c._(this,void 0,void 0,function*(){let a=u;if(u.url?a=(yield c.h(e.transformRequest(u.url,"Source"),n)).data:yield me.frameAsync(n),!a)return null;const o=c.M(c.e(a,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(o.vectorLayerIds=a.vector_layers.map(h=>h.id)),o})}class Ne{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let o,h;if(e instanceof c.N)o=e,h=e;else{if(!(e instanceof Ne))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ne.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(o=e._sw,h=e._ne,!o||!h)return this}return n||a?(n.lng=Math.min(o.lng,n.lng),n.lat=Math.min(o.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new c.N(o.lng,o.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=c.N.convert(e);let o=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&o}static convert(e){return e instanceof Ne?e:e&&new Ne(e)}static fromLngLat(e,n=0){const a=360*n/40075017,o=a/Math.cos(Math.PI/180*e.lat);return new Ne(new c.N(e.lng-o,e.lat-a),new c.N(e.lng+o,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new Ne(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class cr{constructor(e,n,a){this.bounds=Ne.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*n),o=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),I=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<h&&e.y>=o&&e.y<I}}class Dn extends c.E{constructor(e,n,a,o){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Xi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new cr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let o="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,I)=>{e.reloadPromise={resolve:h,reject:I}})}else e.actor=this.dispatcher.getActor(),o="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:o,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class pi extends c.E{constructor(e,n,a,o){super(),this.id=e,this.dispatcher=a,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Xi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new cr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield $e.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const o=this.map.painter.context,h=o.gl,I=a.data;e.texture=this.map.painter.getTileTexture(I.width),e.texture?e.texture.update(I,{useMipmap:!0}):(e.texture=new Qt(o,I,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Gi extends pi{constructor(e,n,a,o){super(e,n,a,o),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const o=yield $e.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(o&&o.data){const h=o.data;this.map._refreshExpiredTiles&&o.cacheControl&&o.expires&&e.setExpiryData({cacheControl:o.cacheControl,expires:o.expires});const I=c.b(h)&&c.U()?h:yield this.readImageNow(h),w={type:this.type,uid:e.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const C=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=C,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(o){if(delete e.abortController,e.aborted)e.state="unloaded";else if(o)throw e.state="errored",o}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const n=e.width+2,a=e.height+2;try{return new c.R({width:n,height:a},yield c.W(e,-1,-1,n,a))}catch{}}return me.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),o=(n.x-1+a)%a,h=n.x===0?e.wrap-1:e.wrap,I=(n.x+1+a)%a,w=n.x+1===a?e.wrap+1:e.wrap,C={};return C[new c.S(e.overscaledZ,h,n.z,o,n.y).key]={backfilled:!1},C[new c.S(e.overscaledZ,w,n.z,I,n.y).key]={backfilled:!1},n.y>0&&(C[new c.S(e.overscaledZ,h,n.z,o,n.y-1).key]={backfilled:!1},C[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new c.S(e.overscaledZ,w,n.z,I,n.y-1).key]={backfilled:!1}),n.y+1<a&&(C[new c.S(e.overscaledZ,h,n.z,o,n.y+1).key]={backfilled:!1},C[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new c.S(e.overscaledZ,w,n.z,I,n.y+1).key]={backfilled:!1}),C}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Kn extends c.E{constructor(e,n,a,o){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(o),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(me.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let o=null;a.resourceTiming&&a.resourceTiming[this.id]&&(o=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&o&&o.length>0&&c.e(h,{resourceTiming:o}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const o=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(o,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var wr=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Jr extends c.E{constructor(e,n,a,o){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(o),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield $e.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.Z.fromLngLat);this.tileID=function(o){let h=1/0,I=1/0,w=-1/0,C=-1/0;for(const $ of o)h=Math.min(h,$.x),I=Math.min(I,$.y),w=Math.max(w,$.x),C=Math.max(C,$.y);const M=Math.max(w-h,C-I),F=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),z=Math.pow(2,F);return new c.a1(F,Math.floor((h+w)/2*z),Math.floor((I+C)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(o=>this.tileID.getTilePoint(o)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,wr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Qt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const h=this.tiles[o];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class la extends Jr{constructor(e,n,a,o){super(e,n,a,o),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,wr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new Qt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const o in this.tiles){const h=this.tiles[o];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ln extends Jr{constructor(e,n,a,o){super(e,n,a,o),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(I=>typeof I!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,wr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Qt(n,this.canvas,a.RGBA,{premultiply:!0});let o=!1;for(const h in this.tiles){const I=this.tiles[h];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,o=!0)}o&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ts={},ca=u=>{switch(u){case"geojson":return Kn;case"image":return Jr;case"raster":return pi;case"raster-dem":return Gi;case"vector":return Dn;case"video":return la;case"canvas":return ln}return Ts[u]},ft="RTLPluginLoaded";class Mn extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=mr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=me.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ft))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let vr=null;function Tn(){return vr||(vr=new Mn),vr}class cn{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,h){const I={};if(!h)return I;for(const w of o){const C=w.layerIds.map(M=>h.getLayer(M)).filter(Boolean);if(C.length!==0){w.layers=C,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(M=>C.filter(F=>F.id===M)[0]));for(const M of C)I[M.id]=w}}return I}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const h=this.buckets[o];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const h=this.buckets[o];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,Tn().lazyLoad();break}}this.queryPadding=0;for(const o in this.buckets){const h=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(o).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const o=this.buckets[a];o.uploadPending()&&o.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,o,h,I,w,C,M,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:o,cameraQueryGeometry:h,scale:I,tileSize:this.tileSize,pixelPosMatrix:F,transform:C,params:w,queryPadding:this.queryPadding*M},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const o=a.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",I=o._geojsonTileLayer||o[h];if(!I)return;const w=c.a7(n&&n.filter),{z:C,x:M,y:F}=this.tileID.canonical,z={z:C,x:M,y:F};for(let $=0;$<I.length;$++){const te=I.feature($);if(w.needGeometry){const g=c.a8(te,!0);if(!w.filter(new c.z(this.tileID.overscaledZ),g,this.tileID.canonical))continue}else if(!w.filter(new c.z(this.tileID.overscaledZ),te))continue;const le=a.getId(te,h),m=new c.a9(te,C,M,F,le);m.tile=z,e.push(m)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let o=!1;if(this.expirationTime>a)o=!1;else if(n)if(this.expirationTime<n)o=!0;else{const h=this.expirationTime-n;h?this.expirationTime=a+Math.max(h,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const o in this.buckets){if(!n.style.hasLayer(o))continue;const h=this.buckets[o],I=h.layers[0].sourceLayer||"_geojsonTileLayer",w=a[I],C=e[I];if(!w||!C||Object.keys(C).length===0)continue;h.update(C,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=n&&n.style&&n.style.getLayer(o);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<me.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=me.now()+e}setDependencies(e,n){const a={};for(const o of n)a[o]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const o=this.dependencies[a];if(o){for(const h of n)if(o[h])return!0}}return!1}}class ut{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const o=e.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const h={value:n,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[o].push(h),this.order.push(o),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,o=n===void 0?0:this.data[a].indexOf(n),h=this.data[a][o];return this.data[a].splice(o,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const o of this.data[a])e(o.value)||n.push(o);for(const a of n)this.remove(a.value.tileID,a)}}class di{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const o=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},c.e(this.stateChanges[e][o],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==o&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][o]===null){this.deletedStates[e][o]={};for(const h in this.state[e][o])a[h]||(this.deletedStates[e][o][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][o]&&this.deletedStates[e][o][h]===null&&delete this.deletedStates[e][o][h]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const o=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][o]!==null&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][o])for(a in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][a]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),o=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const I in h)delete o[I]}return o}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const h={};for(const I in this.stateChanges[o])this.state[o][I]||(this.state[o][I]={}),c.e(this.state[o][I],this.stateChanges[o][I]),h[I]=this.state[o][I];a[o]=h}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const h={};if(this.deletedStates[o]===null)for(const I in this.state[o])h[I]={},this.state[o][I]={};else for(const I in this.deletedStates[o]){if(this.deletedStates[o][I]===null)this.state[o][I]={};else for(const w of Object.keys(this.deletedStates[o][I]))delete this.state[o][I][w];h[I]=this.state[o][I]}a[o]=a[o]||{},c.e(a[o],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const o in e)e[o].setFeatureState(a,n)}}class Wt extends c.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",o=>this._dataHandler(o)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((o,h,I,w)=>{const C=new(ca(h.type))(o,h,I,w);if(C.id!==o)throw new Error(`Expected Source id to be ${o} instead of ${C.id}`);return C})(e,n,a,this),this._tiles={},this._cache=new ut(0,o=>this._unloadTile(o)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new di,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(o){e.state="errored",o.status!==404?this._source.fire(new c.j(o,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Xt).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,o)=>{const h=a.tileID,I=o.tileID,w=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),C=new c.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-I.overscaledZ||C.y-w.y||C.x-w.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Xt).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=me.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let o=0;o<n.length;o++){const h=n[o];if(e.neighboringTiles&&e.neighboringTiles[h]){const I=this.getTileByID(h);a(e,I),a(I,e)}}function a(o,h){o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0;let I=h.tileID.canonical.x-o.tileID.canonical.x;const w=h.tileID.canonical.y-o.tileID.canonical.y,C=Math.pow(2,o.tileID.canonical.z),M=h.tileID.key;I===0&&w===0||Math.abs(w)>1||(Math.abs(I)>1&&(Math.abs(I+C)===1?I+=C:Math.abs(I-C)===1&&(I-=C)),h.dem&&o.dem&&(o.dem.backfillBorder(h.dem,I,w),o.neighboringTiles&&o.neighboringTiles[M]&&(o.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,o){for(const h in this._tiles){let I=this._tiles[h];if(o[h]||!I.hasData()||I.tileID.overscaledZ<=n||I.tileID.overscaledZ>a)continue;let w=I.tileID;for(;I&&I.tileID.overscaledZ>n+1;){const M=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[M.key],I&&I.hasData()&&(w=M)}let C=w;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),e[C.key]){o[w.key]=w;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const o=e.scaledTo(a),h=this._getLoadedTile(o);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,o=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const o in this._tiles){const h=this._tiles[o];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),a[h.tileID.key]=h}this._tiles=a;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}}_updateCoveredAndRetainedTiles(e,n,a,o,h,I){const w={},C={},M=Object.keys(e),F=me.now();for(const z of M){const $=e[z],te=this._tiles[z];if(!te||te.fadeEndTime!==0&&te.fadeEndTime<=F)continue;const le=this.findLoadedParent($,n),m=this.findLoadedSibling($),g=le||m||null;g&&(this._addTile(g.tileID),w[g.tileID.key]=g.tileID),C[z]=$}this._retainLoadedChildren(C,o,a,e);for(const z in w)e[z]||(this._coveredTiles[z]=!0,e[z]=w[z]);if(I){const z={},$={};for(const te of h)this._tiles[te.key].hasData()?z[te.key]=te:$[te.key]=te;for(const te in $){const le=$[te].children(this._source.maxzoom);this._tiles[le[0].key]&&this._tiles[le[1].key]&&this._tiles[le[2].key]&&this._tiles[le[3].key]&&(z[le[0].key]=e[le[0].key]=le[0],z[le[1].key]=e[le[1].key]=le[1],z[le[2].key]=e[le[2].key]=le[2],z[le[3].key]=e[le[3].key]=le[3],delete $[te])}for(const te in $){const le=$[te],m=this.findLoadedParent(le,this._source.minzoom),g=this.findLoadedSibling(le),A=m||g||null;if(A){z[A.tileID.key]=e[A.tileID.key]=A.tileID;for(const v in z)z[v].isChildOf(A.tileID)&&delete z[v]}}for(const te in this._tiles)z[te]||(this._coveredTiles[te]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new c.S(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(F=>this._source.hasTile(F)))):a=[];const o=e.coveringZoomLevel(this._source),h=Math.max(o-Wt.maxOverzooming,this._source.minzoom),I=Math.max(o+Wt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const z of a)if(z.canonical.z>this._source.minzoom){const $=z.scaledTo(z.canonical.z-1);F[$.key]=$;const te=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));F[te.key]=te}a=a.concat(Object.values(F))}const w=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(a,o);hn(this._source.type)&&this._updateCoveredAndRetainedTiles(C,h,I,o,a,n);for(const F in C)this._tiles[F].clearFadeHold();const M=c.ab(this._tiles,C);for(const F of M){const z=this._tiles[F];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const o={},h={},I=Math.max(n-Wt.maxOverzooming,this._source.minzoom),w=Math.max(n+Wt.maxUnderzooming,this._source.minzoom),C={};for(const M of e){const F=this._addTile(M);o[M.key]=M,F.hasData()||n<this._source.maxzoom&&(C[M.key]=M)}this._retainLoadedChildren(C,n,w,o);for(const M of e){let F=this._tiles[M.key];if(F.hasData())continue;if(n+1>this._source.maxzoom){const $=M.children(this._source.maxzoom)[0],te=this.getTile($);if(te&&te.hasData()){o[$.key]=$;continue}}else{const $=M.children(this._source.maxzoom);if(o[$[0].key]&&o[$[1].key]&&o[$[2].key]&&o[$[3].key])continue}let z=F.wasRequested();for(let $=M.overscaledZ-1;$>=I;--$){const te=M.scaledTo($);if(h[te.key])break;if(h[te.key]=!0,F=this.getTile(te),!F&&z&&(F=this._addTile(te)),F){const le=F.hasData();if((le||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(o[te.key]=te),z=F.wasRequested(),le)break}}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){a=this._loadedParentTiles[o.key];break}n.push(o.key);const h=o.scaledTo(o.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;o=h}for(const h of n)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new cn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const o=[],h=this.transform;if(!h)return o;const I=a?h.getCameraQueryGeometry(e):e,w=e.map(le=>h.pointCoordinate(le,this.terrain)),C=I.map(le=>h.pointCoordinate(le,this.terrain)),M=this.getIds();let F=1/0,z=1/0,$=-1/0,te=-1/0;for(const le of C)F=Math.min(F,le.x),z=Math.min(z,le.y),$=Math.max($,le.x),te=Math.max(te,le.y);for(let le=0;le<M.length;le++){const m=this._tiles[M[le]];if(m.holdingForFade())continue;const g=m.tileID,A=Math.pow(2,h.zoom-m.tileID.overscaledZ),v=n*m.queryPadding*c.X/m.tileSize/A,x=[g.getTilePoint(new c.Z(F,z)),g.getTilePoint(new c.Z($,te))];if(x[0].x-v<c.X&&x[0].y-v<c.X&&x[1].x+v>=0&&x[1].y+v>=0){const k=w.map(S=>g.getTilePoint(S)),P=C.map(S=>g.getTilePoint(S));o.push({tile:m,tileID:g,queryGeometry:k,cameraQueryGeometry:P,scale:A})}}return o}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(hn(this._source.type)){const e=me.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const o=this._tiles[e];o&&o.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function Xt(u,e){const n=Math.abs(2*u.wrap)-+(u.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return u.overscaledZ-e.overscaledZ||a-n||e.canonical.y-u.canonical.y||e.canonical.x-u.canonical.x}function hn(u){return u==="raster"||u==="image"||u==="video"}Wt.maxOverzooming=10,Wt.maxUnderzooming=3;class oi{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,a=this._distances[n];const o=e*this.paddedLength+this.padding;for(;a<o&&n<this._distances.length;)a=this._distances[++n];const h=n-1,I=this._distances[h],w=a-I,C=w>0?(o-I)/w:0;return this.points[h].mult(1-C).add(this.points[n].mult(C))}}function Pn(u,e){let n=!0;return u==="always"||u!=="never"&&e!=="never"||(n=!1),n}class Ln{constructor(e,n,a){const o=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let I=0;I<this.xCellCount*this.yCellCount;I++)o.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,o,h){this._forEachCell(n,a,o,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(h)}insertCircle(e,n,a,o){this._forEachCell(n-o,a-o,n+o,a+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(o)}_insertBoxCell(e,n,a,o,h,I){this.boxCells[h].push(I)}_insertCircleCell(e,n,a,o,h,I){this.circleCells[h].push(I)}_query(e,n,a,o,h,I,w){if(a<0||e>this.width||o<0||n>this.height)return[];const C=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=o){if(h)return[{key:null,x1:e,y1:n,x2:a,y2:o}];for(let M=0;M<this.boxKeys.length;M++)C.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const F=this.circles[3*M],z=this.circles[3*M+1],$=this.circles[3*M+2];C.push({key:this.circleKeys[M],x1:F-$,y1:z-$,x2:F+$,y2:z+$})}}else this._forEachCell(e,n,a,o,this._queryCell,C,{hitTest:h,overlapMode:I,seenUids:{box:{},circle:{}}},w);return C}query(e,n,a,o){return this._query(e,n,a,o,!1,null)}hitTest(e,n,a,o,h,I){return this._query(e,n,a,o,!0,h,I).length>0}hitTestCircle(e,n,a,o,h){const I=e-a,w=e+a,C=n-a,M=n+a;if(w<0||I>this.width||M<0||C>this.height)return!1;const F=[];return this._forEachCell(I,C,w,M,this._queryCellCircle,F,{hitTest:!0,overlapMode:o,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},h),F.length>0}_queryCell(e,n,a,o,h,I,w,C){const{seenUids:M,hitTest:F,overlapMode:z}=w,$=this.boxCells[h];if($!==null){const le=this.bboxes;for(const m of $)if(!M.box[m]){M.box[m]=!0;const g=4*m,A=this.boxKeys[m];if(e<=le[g+2]&&n<=le[g+3]&&a>=le[g+0]&&o>=le[g+1]&&(!C||C(A))&&(!F||!Pn(z,A.overlapMode))&&(I.push({key:A,x1:le[g],y1:le[g+1],x2:le[g+2],y2:le[g+3]}),F))return!0}}const te=this.circleCells[h];if(te!==null){const le=this.circles;for(const m of te)if(!M.circle[m]){M.circle[m]=!0;const g=3*m,A=this.circleKeys[m];if(this._circleAndRectCollide(le[g],le[g+1],le[g+2],e,n,a,o)&&(!C||C(A))&&(!F||!Pn(z,A.overlapMode))){const v=le[g],x=le[g+1],k=le[g+2];if(I.push({key:A,x1:v-k,y1:x-k,x2:v+k,y2:x+k}),F)return!0}}}return!1}_queryCellCircle(e,n,a,o,h,I,w,C){const{circle:M,seenUids:F,overlapMode:z}=w,$=this.boxCells[h];if($!==null){const le=this.bboxes;for(const m of $)if(!F.box[m]){F.box[m]=!0;const g=4*m,A=this.boxKeys[m];if(this._circleAndRectCollide(M.x,M.y,M.radius,le[g+0],le[g+1],le[g+2],le[g+3])&&(!C||C(A))&&!Pn(z,A.overlapMode))return I.push(!0),!0}}const te=this.circleCells[h];if(te!==null){const le=this.circles;for(const m of te)if(!F.circle[m]){F.circle[m]=!0;const g=3*m,A=this.circleKeys[m];if(this._circlesCollide(le[g],le[g+1],le[g+2],M.x,M.y,M.radius)&&(!C||C(A))&&!Pn(z,A.overlapMode))return I.push(!0),!0}}}_forEachCell(e,n,a,o,h,I,w,C){const M=this._convertToXCellCoord(e),F=this._convertToYCellCoord(n),z=this._convertToXCellCoord(a),$=this._convertToYCellCoord(o);for(let te=M;te<=z;te++)for(let le=F;le<=$;le++)if(h.call(this,e,n,a,o,this.xCellCount*le+te,I,w,C))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,o,h,I){const w=o-e,C=h-n,M=a+I;return M*M>w*w+C*C}_circleAndRectCollide(e,n,a,o,h,I,w){const C=(I-o)/2,M=Math.abs(e-(o+C));if(M>C+a)return!1;const F=(w-h)/2,z=Math.abs(n-(h+F));if(z>F+a)return!1;if(M<=C||z<=F)return!0;const $=M-C,te=z-F;return $*$+te*te<=a*a}}function Zn(u,e,n,a,o){const h=c.H();return e?(c.K(h,h,[1/o,1/o,1]),n||c.ad(h,h,a.angle)):c.L(h,a.labelPlaneMatrix,u),h}function _n(u,e,n,a,o){if(e){const h=c.ae(u);return c.K(h,h,[o,o,1]),n||c.ad(h,h,-a.angle),h}return a.glCoordMatrix}function _e(u,e,n,a){let o;a?(o=[u,e,a(u,e),1],c.af(o,o,n)):(o=[u,e,0,1],wi(o,o,n));const h=o[3];return{point:new c.P(o[0]/h,o[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function j(u,e){return .5+u/e*.5}function H(u,e){return u.x>=-e[0]&&u.x<=e[0]&&u.y>=-e[1]&&u.y<=e[1]}function ee(u,e,n,a,o,h,I,w,C,M,F,z,$,te,le){const m=a?u.textSizeData:u.iconSizeData,g=c.ag(m,n.transform.zoom),A=[256/n.width*2+1,256/n.height*2+1],v=a?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;v.clear();const x=u.lineVertexArray,k=a?u.text.placedSymbolArray:u.icon.placedSymbolArray,P=n.transform.width/n.transform.height;let S=!1;for(let V=0;V<k.length;V++){const U=k.get(V);if(U.hidden||U.writingMode===c.ah.vertical&&!S){Jt(U.numGlyphs,v);continue}S=!1;const q=_e(U.anchorX,U.anchorY,e,le);if(!H(q.point,A)){Jt(U.numGlyphs,v);continue}const re=j(n.transform.cameraToCenterDistance,q.signedDistanceFromCamera),Z=c.ai(m,g,U),N=I?Z/re:Z*re,se={getElevation:le,labelPlaneMatrix:o,lineVertexArray:x,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:M,tileAnchorPoint:new c.P(U.anchorX,U.anchorY),unwrappedTileID:F,width:z,height:$,translation:te},ce=Me(se,U,N,!1,w,e,h,u.glyphOffsetArray,v,P,C);S=ce.useVertical,(ce.notEnoughRoom||S||ce.needsFlipping&&Me(se,U,N,!0,w,e,h,u.glyphOffsetArray,v,P,C).notEnoughRoom)&&Jt(U.numGlyphs,v)}a?u.text.dynamicLayoutVertexBuffer.updateData(v):u.icon.dynamicLayoutVertexBuffer.updateData(v)}function ge(u,e,n,a,o,h,I,w){const C=h.glyphStartIndex+h.numGlyphs,M=h.lineStartIndex,F=h.lineStartIndex+h.lineLength,z=e.getoffsetX(h.glyphStartIndex),$=e.getoffsetX(C-1),te=_t(u*z,n,a,o,h.segment,M,F,w,I);if(!te)return null;const le=_t(u*$,n,a,o,h.segment,M,F,w,I);return le?w.projectionCache.anyProjectionOccluded?null:{first:te,last:le}:null}function Ce(u,e,n,a){return u===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(u===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Me(u,e,n,a,o,h,I,w,C,M,F){const z=n/24,$=e.lineOffsetX*z,te=e.lineOffsetY*z;let le;if(e.numGlyphs>1){const m=e.glyphStartIndex+e.numGlyphs,g=e.lineStartIndex,A=e.lineStartIndex+e.lineLength,v=ge(z,w,$,te,a,e,F,u);if(!v)return{notEnoughRoom:!0};const x=_e(v.first.point.x,v.first.point.y,I,u.getElevation).point,k=_e(v.last.point.x,v.last.point.y,I,u.getElevation).point;if(o&&!a){const P=Ce(e.writingMode,x,k,M);if(P)return P}le=[v.first];for(let P=e.glyphStartIndex+1;P<m-1;P++)le.push(_t(z*w.getoffsetX(P),$,te,a,e.segment,g,A,u,F));le.push(v.last)}else{if(o&&!a){const g=_e(u.tileAnchorPoint.x,u.tileAnchorPoint.y,h,u.getElevation).point,A=e.lineStartIndex+e.segment+1,v=new c.P(u.lineVertexArray.getx(A),u.lineVertexArray.gety(A)),x=_e(v.x,v.y,h,u.getElevation),k=x.signedDistanceFromCamera>0?x.point:function(S,V,U,q,re,Z){return Le(S,V,U,1,re,Z)}(u.tileAnchorPoint,v,g,0,h,u),P=Ce(e.writingMode,g,k,M);if(P)return P}const m=_t(z*w.getoffsetX(e.glyphStartIndex),$,te,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,u,F);if(!m||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};le=[m]}for(const m of le)c.aj(C,m.point,m.angle);return{}}function Le(u,e,n,a,o,h){const I=u.add(u.sub(e)._unit()),w=o!==void 0?_e(I.x,I.y,o,h.getElevation).point:qe(I.x,I.y,h).point,C=n.sub(w);return n.add(C._mult(a/C.mag()))}function we(u,e,n){const a=e.projectionCache;if(a.projections[u])return a.projections[u];const o=new c.P(e.lineVertexArray.getx(u),e.lineVertexArray.gety(u)),h=qe(o.x,o.y,e);if(h.signedDistanceFromCamera>0)return a.projections[u]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const I=u-n.direction;return function(w,C,M,F,z){return Le(w,C,M,F,void 0,z)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(I),e.lineVertexArray.gety(I)),o,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function qe(u,e,n){const a=u+n.translation[0],o=e+n.translation[1];let h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(a,o,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=_e(a,o,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function rt(u,e,n){return u._unit()._perp()._mult(e*n)}function ze(u,e,n,a,o,h,I,w,C){if(w.projectionCache.offsets[u])return w.projectionCache.offsets[u];const M=n.add(e);if(u+C.direction<a||u+C.direction>=o)return w.projectionCache.offsets[u]=M,M;const F=we(u+C.direction,w,C),z=rt(F.sub(n),I,C.direction),$=n.add(z),te=F.add(z);return w.projectionCache.offsets[u]=c.ak(h,M,$,te)||M,w.projectionCache.offsets[u]}function _t(u,e,n,a,o,h,I,w,C){const M=a?u-e:u+e;let F=M>0?1:-1,z=0;a&&(F*=-1,z=Math.PI),F<0&&(z+=Math.PI);let $,te=F>0?h+o:h+o+1;w.projectionCache.cachedAnchorPoint?$=w.projectionCache.cachedAnchorPoint:($=qe(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=$);let le,m,g=$,A=$,v=0,x=0;const k=Math.abs(M),P=[];let S;for(;v+x<=k;){if(te+=F,te<h||te>=I)return null;v+=x,A=g,m=le;const q={absOffsetX:k,direction:F,distanceFromAnchor:v,previousVertex:A};if(g=we(te,w,q),n===0)P.push(A),S=g.sub(A);else{let re;const Z=g.sub(A);re=Z.mag()===0?rt(we(te+F,w,q).sub(g),n,F):rt(Z,n,F),m||(m=A.add(re)),le=ze(te,re,g,h,I,m,n,w,q),P.push(m),S=le.sub(m)}x=S.mag()}const V=S._mult((k-v)/x)._add(m||A),U=z+Math.atan2(g.y-A.y,g.x-A.x);return P.push(V),{point:V,angle:C?U:0,path:P}}const Nt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Jt(u,e){for(let n=0;n<u;n++){const a=e.length;e.resize(a+4),e.float32.set(Nt,3*a)}}function wi(u,e,n){const a=e[0],o=e[1];return u[0]=n[0]*a+n[4]*o+n[12],u[1]=n[1]*a+n[5]*o+n[13],u[3]=n[3]*a+n[7]*o+n[15],u}const hi=100;class Ei{constructor(e,n,a=new Ln(e.width+200,e.height+200,25),o=new Ln(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=o,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+hi,this.screenBottomBoundary=e.height+hi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,o,h,I,w,C,M,F,z){const $=e.anchorPointX+C[0],te=e.anchorPointY+C[1],le=this.projectAndGetPerspectiveRatio(o,$,te,h,F),m=a*le.perspectiveRatio;let g;if(I||w)g=this._projectCollisionBox(e,m,o,h,I,w,C,le,F,z);else{const P=le.point.x+(z?z.x*m:0),S=le.point.y+(z?z.y*m:0);g={allPointsOccluded:!1,box:[P+e.x1*m,S+e.y1*m,P+e.x2*m,S+e.y2*m]}}const[A,v,x,k]=g.box;return this.mapProjection.useSpecialProjectionForSymbols&&(I?g.allPointsOccluded:this.mapProjection.isOccluded($,te,h))||le.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(A,v,x,k)||n!=="always"&&this.grid.hitTest(A,v,x,k,n,M)?{box:[A,v,x,k],placeable:!1,offscreen:!1}:{box:[A,v,x,k],placeable:!0,offscreen:this.isOffscreen(A,v,x,k)}}placeCollisionCircles(e,n,a,o,h,I,w,C,M,F,z,$,te,le,m,g){const A=[],v=new c.P(n.anchorX,n.anchorY),x=this.getPerspectiveRatio(I,v.x,v.y,w,g),k=(z?h/x:h*x)/c.ap,P={getElevation:g,labelPlaneMatrix:C,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:v,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:m},S=ge(k,o,n.lineOffsetX*k,n.lineOffsetY*k,!1,n,!1,P);let V=!1,U=!1,q=!0;if(S){const re=.5*te*x+le,Z=new c.P(-100,-100),N=new c.P(this.screenRightBoundary,this.screenBottomBoundary),se=new oi,ce=S.first,ae=S.last;let Ae=[];for(let ke=ce.path.length-1;ke>=1;ke--)Ae.push(ce.path[ke]);for(let ke=1;ke<ae.path.length;ke++)Ae.push(ae.path[ke]);const ve=2.5*re;if(M){const ke=this.projectPathToScreenSpace(Ae,P,M);Ae=ke.some(K=>K.signedDistanceFromCamera<=0)?[]:ke.map(K=>K.point)}let Ie=[];if(Ae.length>0){const ke=Ae[0].clone(),K=Ae[0].clone();for(let G=1;G<Ae.length;G++)ke.x=Math.min(ke.x,Ae[G].x),ke.y=Math.min(ke.y,Ae[G].y),K.x=Math.max(K.x,Ae[G].x),K.y=Math.max(K.y,Ae[G].y);Ie=ke.x>=Z.x&&K.x<=N.x&&ke.y>=Z.y&&K.y<=N.y?[Ae]:K.x<Z.x||ke.x>N.x||K.y<Z.y||ke.y>N.y?[]:c.al([Ae],Z.x,Z.y,N.x,N.y)}for(const ke of Ie){se.reset(ke,.25*re);let K=0;K=se.length<=.5*re?1:Math.ceil(se.paddedLength/ve)+1;for(let G=0;G<K;G++){const ue=G/Math.max(K-1,1),ie=se.lerp(ue),oe=ie.x+hi,de=ie.y+hi;A.push(oe,de,re,0);const Se=oe-re,Be=de-re,Qe=oe+re,Ge=de+re;if(q=q&&this.isOffscreen(Se,Be,Qe,Ge),U=U||this.isInsideGrid(Se,Be,Qe,Ge),e!=="always"&&this.grid.hitTestCircle(oe,de,re,e,$)&&(V=!0,!F))return{circles:[],offscreen:!1,collisionDetected:V}}}}return{circles:!F&&V||!U||x<this.perspectiveRatioCutoff?[]:A,offscreen:q,collisionDetected:V}}projectPathToScreenSpace(e,n,a){return e.map(o=>_e(o.x,o.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,o=1/0,h=-1/0,I=-1/0;for(const F of e){const z=new c.P(F.x+hi,F.y+hi);a=Math.min(a,z.x),o=Math.min(o,z.y),h=Math.max(h,z.x),I=Math.max(I,z.y),n.push(z)}const w=this.grid.query(a,o,h,I).concat(this.ignoredGrid.query(a,o,h,I)),C={},M={};for(const F of w){const z=F.key;if(C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]={}),C[z.bucketInstanceId][z.featureIndex])continue;const $=[new c.P(F.x1,F.y1),new c.P(F.x2,F.y1),new c.P(F.x2,F.y2),new c.P(F.x1,F.y2)];c.am(n,$)&&(C[z.bucketInstanceId][z.featureIndex]=!0,M[z.bucketInstanceId]===void 0&&(M[z.bucketInstanceId]=[]),M[z.bucketInstanceId].push(z.featureIndex))}return M}insertCollisionBox(e,n,a,o,h,I){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:I,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,o,h,I){const w=a?this.ignoredGrid:this.grid,C={bucketInstanceId:o,featureIndex:h,collisionGroupID:I,overlapMode:n};for(let M=0;M<e.length;M+=4)w.insertCircle(C,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,n,a,o,h){let I;h?(I=[n,a,h(n,a),1],c.af(I,I,e)):(I=[n,a,0,1],wi(I,I,e));const w=I[3];return{point:new c.P((I[0]/w+1)/2*this.transform.width+hi,(-I[1]/w+1)/2*this.transform.height+hi),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,n,a,o,h){const I=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,o,h):_e(n,a,e,h);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(e,n,a,o){return a<hi||e>=this.screenRightBoundary||o<hi||n>this.screenBottomBoundary}isInsideGrid(e,n,a,o){return a>=0&&e<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,o,h,I,w,C,M,F){let z=new c.P(1,0),$=new c.P(0,1);const te=new c.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(I&&!h){const q=this.projectAndGetPerspectiveRatio(a,te.x+1,te.y,o,M).point.sub(C.point).unit(),re=Math.atan(q.y/q.x)+(q.x<0?Math.PI:0),Z=Math.sin(re),N=Math.cos(re);z=new c.P(N,Z),$=new c.P(-Z,N)}else if(!I&&h){const q=-this.transform.angle,re=Math.sin(q),Z=Math.cos(q);z=new c.P(Z,re),$=new c.P(-re,Z)}let le=C.point,m=n;if(h){le=te;const q=this.transform.zoom-Math.floor(this.transform.zoom);m=Math.pow(2,-q),m*=this.mapProjection.getPitchedTextCorrection(this.transform,te,o),F||(m*=c.ac(.5+C.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}F&&(le=le.add(z.mult(F.x*m)).add($.mult(F.y*m)));const g=e.x1*m,A=e.x2*m,v=(g+A)/2,x=e.y1*m,k=e.y2*m,P=(x+k)/2,S=[{offsetX:g,offsetY:x},{offsetX:v,offsetY:x},{offsetX:A,offsetY:x},{offsetX:A,offsetY:P},{offsetX:A,offsetY:k},{offsetX:v,offsetY:k},{offsetX:g,offsetY:k},{offsetX:g,offsetY:P}];let V=[];for(const{offsetX:q,offsetY:re}of S)V.push(new c.P(le.x+z.x*q+$.x*re,le.y+z.y*q+$.y*re));let U=!1;if(h){const q=V.map(re=>this.projectAndGetPerspectiveRatio(a,re.x,re.y,o,M));U=q.some(re=>!re.isOccluded),V=q.map(re=>re.point)}else U=!0;return{box:c.ao(V),allPointsOccluded:!U}}}function yi(u,e,n){return e*(c.X/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class nr{constructor(e,n,a,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):o&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ki{constructor(e,n,a,o,h){this.text=new nr(e?e.text:null,n,a,h),this.icon=new nr(e?e.icon:null,n,o,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gi{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class Pi{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class ji{constructor(e,n,a,o,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=o,this.tileID=h}}class sr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function dr(u,e,n,a,o){const{horizontalAlign:h,verticalAlign:I}=c.au(u);return new c.P(-(h-.5)*e+a[0]*o,-(I-.5)*n+a[1]*o)}class fr{constructor(e,n,a,o,h,I){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new Ei(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new sr(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,o)=>n.getElevation(e,a,o):null}getBucketParts(e,n,a,o){const h=a.getBucket(n),I=a.latestFeatureIndex;if(!h||!I||n.id!==h.layerIds[0])return;const w=a.collisionBoxArray,C=h.layers[0].layout,M=h.layers[0].paint,F=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.X,$=a.tileID.toUnwrapped(),te=this.transform.calculatePosMatrix($),le=C.get("text-pitch-alignment")==="map",m=C.get("text-rotation-alignment")==="map",g=yi(a,1,this.transform.zoom),A=this.collisionIndex.mapProjection.translatePosition(this.transform,a,M.get("text-translate"),M.get("text-translate-anchor")),v=this.collisionIndex.mapProjection.translatePosition(this.transform,a,M.get("icon-translate"),M.get("icon-translate-anchor")),x=Zn(te,le,m,this.transform,g);let k=null;if(le){const S=_n(te,le,m,this.transform,g);k=c.L([],this.transform.labelPlaneMatrix,S)}this.retainedQueryData[h.bucketInstanceId]=new ji(h.bucketInstanceId,I,h.sourceLayerIndex,h.index,a.tileID);const P={bucket:h,layout:C,translationText:A,translationIcon:v,posMatrix:te,unwrappedTileID:$,textLabelPlaneMatrix:x,labelToScreenMatrix:k,scale:F,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(o)for(const S of h.sortKeyRanges){const{sortKey:V,symbolInstanceStart:U,symbolInstanceEnd:q}=S;e.push({sortKey:V,symbolInstanceStart:U,symbolInstanceEnd:q,parameters:P})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:P})}attemptAnchorPlacement(e,n,a,o,h,I,w,C,M,F,z,$,te,le,m,g,A,v,x){const k=c.aq[e.textAnchor],P=[e.textOffset0,e.textOffset1],S=dr(k,a,o,P,h),V=this.collisionIndex.placeCollisionBox(n,$,C,M,F,w,I,g,z.predicate,x,S);if((!v||this.collisionIndex.placeCollisionBox(v,$,C,M,F,w,I,A,z.predicate,x,S).placeable)&&V.placeable){let U;if(this.prevPlacement&&this.prevPlacement.variableOffsets[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID].text&&(U=this.prevPlacement.variableOffsets[te.crossTileID].anchor),te.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[te.crossTileID]={textOffset:P,width:a,height:o,anchor:k,textBoxScale:h,prevAnchor:U},this.markUsedJustification(le,k,te,m),le.allowVerticalPlacement&&(this.markUsedOrientation(le,m,te),this.placedOrientations[te.crossTileID]=m),{shift:S,placedGlyphBoxes:V}}}placeLayerBucketPart(e,n,a){const{bucket:o,layout:h,translationText:I,translationIcon:w,posMatrix:C,unwrappedTileID:M,textLabelPlaneMatrix:F,labelToScreenMatrix:z,textPixelRatio:$,holdingForFade:te,collisionBoxArray:le,partiallyEvaluatedTextSize:m,collisionGroup:g}=e.parameters,A=h.get("text-optional"),v=h.get("icon-optional"),x=c.ar(h,"text-overlap","text-allow-overlap"),k=x==="always",P=c.ar(h,"icon-overlap","icon-allow-overlap"),S=P==="always",V=h.get("text-rotation-alignment")==="map",U=h.get("text-pitch-alignment")==="map",q=h.get("icon-text-fit")!=="none",re=h.get("symbol-z-order")==="viewport-y",Z=k&&(S||!o.hasIconData()||v),N=S&&(k||!o.hasTextData()||A);!o.collisionArrays&&le&&o.deserializeCollisionBoxes(le);const se=this._getTerrainElevationFunc(this.retainedQueryData[o.bucketInstanceId].tileID),ce=(ae,Ae,ve)=>{var Ie,ke;if(n[ae.crossTileID])return;if(te)return void(this.placements[ae.crossTileID]=new gi(!1,!1,!1));let K=!1,G=!1,ue=!0,ie=null,oe={box:null,placeable:!1,offscreen:null},de={placeable:!1},Se=null,Be=null,Qe=null,Ge=0,He=0,Ke=0;Ae.textFeatureIndex?Ge=Ae.textFeatureIndex:ae.useRuntimeCollisionCircles&&(Ge=ae.featureIndex),Ae.verticalTextFeatureIndex&&(He=Ae.verticalTextFeatureIndex);const tt=Ae.textBox;if(tt){const et=ht=>{let Ct=c.ah.horizontal;if(o.allowVerticalPlacement&&!ht&&this.prevPlacement){const It=this.prevPlacement.placedOrientations[ae.crossTileID];It&&(this.placedOrientations[ae.crossTileID]=It,Ct=It,this.markUsedOrientation(o,Ct,ae))}return Ct},Dt=(ht,Ct)=>{if(o.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&Ae.verticalTextBox){for(const It of o.writingModes)if(It===c.ah.vertical?(oe=Ct(),de=oe):oe=ht(),oe&&oe.placeable)break}else oe=ht()},At=ae.textAnchorOffsetStartIndex,Lt=ae.textAnchorOffsetEndIndex;if(Lt===At){const ht=(Ct,It)=>{const ct=this.collisionIndex.placeCollisionBox(Ct,x,$,C,M,U,V,I,g.predicate,se);return ct&&ct.placeable&&(this.markUsedOrientation(o,It,ae),this.placedOrientations[ae.crossTileID]=It),ct};Dt(()=>ht(tt,c.ah.horizontal),()=>{const Ct=Ae.verticalTextBox;return o.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&Ct?ht(Ct,c.ah.vertical):{box:null,offscreen:null}}),et(oe&&oe.placeable)}else{let ht=c.aq[(ke=(Ie=this.prevPlacement)===null||Ie===void 0?void 0:Ie.variableOffsets[ae.crossTileID])===null||ke===void 0?void 0:ke.anchor];const Ct=(ct,Et,bi)=>{const ui=ct.x2-ct.x1,vi=ct.y2-ct.y1,xi=ae.textBoxScale,tn=q&&P==="never"?Et:null;let xr=null,Ss=x==="never"?1:2,ii="never";ht&&Ss++;for(let rn=0;rn<Ss;rn++){for(let Qn=At;Qn<Lt;Qn++){const ro=o.textAnchorOffsets.get(Qn);if(ht&&ro.textAnchor!==ht)continue;const ls=this.attemptAnchorPlacement(ro,ct,ui,vi,xi,V,U,$,C,M,g,ii,ae,o,bi,I,w,tn,se);if(ls&&(xr=ls.placedGlyphBoxes,xr&&xr.placeable))return K=!0,ie=ls.shift,xr}ht?ht=null:ii=x}return a&&!xr&&(xr={box:this.collisionIndex.placeCollisionBox(tt,"always",$,C,M,U,V,I,g.predicate,se,new c.P(0,0)).box,offscreen:!1,placeable:!1}),xr};Dt(()=>Ct(tt,Ae.iconBox,c.ah.horizontal),()=>{const ct=Ae.verticalTextBox;return o.allowVerticalPlacement&&(!oe||!oe.placeable)&&ae.numVerticalGlyphVertices>0&&ct?Ct(ct,Ae.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),oe&&(K=oe.placeable,ue=oe.offscreen);const It=et(oe&&oe.placeable);if(!K&&this.prevPlacement){const ct=this.prevPlacement.variableOffsets[ae.crossTileID];ct&&(this.variableOffsets[ae.crossTileID]=ct,this.markUsedJustification(o,ct.anchor,ae,It))}}}if(Se=oe,K=Se&&Se.placeable,ue=Se&&Se.offscreen,ae.useRuntimeCollisionCircles){const et=o.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex),Dt=c.ai(o.textSizeData,m,et),At=h.get("text-padding");Be=this.collisionIndex.placeCollisionCircles(x,et,o.lineVertexArray,o.glyphOffsetArray,Dt,C,M,F,z,a,U,g.predicate,ae.collisionCircleDiameter,At,I,se),Be.circles.length&&Be.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),K=k||Be.circles.length>0&&!Be.collisionDetected,ue=ue&&Be.offscreen}if(Ae.iconFeatureIndex&&(Ke=Ae.iconFeatureIndex),Ae.iconBox){const et=Dt=>this.collisionIndex.placeCollisionBox(Dt,P,$,C,M,U,V,w,g.predicate,se,q&&ie?ie:void 0);de&&de.placeable&&Ae.verticalIconBox?(Qe=et(Ae.verticalIconBox),G=Qe.placeable):(Qe=et(Ae.iconBox),G=Qe.placeable),ue=ue&&Qe.offscreen}const mt=A||ae.numHorizontalGlyphVertices===0&&ae.numVerticalGlyphVertices===0,Oe=v||ae.numIconVertices===0;mt||Oe?Oe?mt||(G=G&&K):K=G&&K:G=K=G&&K;const Fe=G&&Qe.placeable;if(K&&Se.placeable&&this.collisionIndex.insertCollisionBox(Se.box,x,h.get("text-ignore-placement"),o.bucketInstanceId,de&&de.placeable&&He?He:Ge,g.ID),Fe&&this.collisionIndex.insertCollisionBox(Qe.box,P,h.get("icon-ignore-placement"),o.bucketInstanceId,Ke,g.ID),Be&&K&&this.collisionIndex.insertCollisionCircles(Be.circles,x,h.get("text-ignore-placement"),o.bucketInstanceId,Ge,g.ID),a&&this.storeCollisionData(o.bucketInstanceId,ve,Ae,Se,Qe,Be),ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(o.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ae.crossTileID]=new gi(K||Z,G||N,ue||o.justReloaded),n[ae.crossTileID]=!0};if(re){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ae=o.getSortedSymbolIndexes(this.transform.angle);for(let Ae=ae.length-1;Ae>=0;--Ae){const ve=ae[Ae];ce(o.symbolInstances.get(ve),o.collisionArrays[ve],ve)}}else for(let ae=e.symbolInstanceStart;ae<e.symbolInstanceEnd;ae++)ce(o.symbolInstances.get(ae),o.collisionArrays[ae],ae);if(a&&o.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[o.bucketInstanceId];c.as(ae.invProjMatrix,C),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}storeCollisionData(e,n,a,o,h,I){if(a.textBox||a.iconBox){let w,C;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(n)?C=w.get(n):(C={text:null,icon:null},w.set(n,C)),a.textBox&&(C.text=o.box),a.iconBox&&(C.icon=h.box)}if(I){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new Pi);for(let C=0;C<I.circles.length;C+=4)w.circles.push(I.circles[C+0]),w.circles.push(I.circles[C+1]),w.circles.push(I.circles[C+2]),w.circles.push(I.collisionDetected?1:0)}}markUsedJustification(e,n,a,o){let h;h=o===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const I=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const w of I)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=h>=0&&w!==h?0:a.crossTileID)}markUsedOrientation(e,n,a){const o=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,I=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const w of I)e.text.placedSymbolArray.get(w).placedOrientation=o;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const o=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},I=n?n.variableOffsets:{},w=n?n.placedOrientations:{};for(const C in this.placements){const M=this.placements[C],F=h[C];F?(this.opacities[C]=new Ki(F,o,M.text,M.icon),a=a||M.text!==F.text.placed||M.icon!==F.icon.placed):(this.opacities[C]=new Ki(null,o,M.text,M.icon,M.skipFade),a=a||M.text||M.icon)}for(const C in h){const M=h[C];if(!this.opacities[C]){const F=new Ki(M,o,!1,!1);F.isHidden()||(this.opacities[C]=F,a=a||M.text.placed||M.icon.placed)}}for(const C in I)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=I[C]);for(const C in w)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=w[C]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const o of n){const h=o.getBucket(e);h&&o.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,o.tileID,a,o.collisionBoxArray)}}updateBucketOpacities(e,n,a,o){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],I=h.layout,w=new Ki(null,0,!1,!1,!0),C=I.get("text-allow-overlap"),M=I.get("icon-allow-overlap"),F=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=I.get("text-rotation-alignment")==="map",$=I.get("text-pitch-alignment")==="map",te=I.get("icon-text-fit")!=="none",le=new Ki(null,0,C&&(M||!e.hasIconData()||I.get("icon-optional")),M&&(C||!e.hasTextData()||I.get("text-optional")),!0);!e.collisionArrays&&o&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(o);const m=(A,v,x)=>{for(let k=0;k<v/4;k++)A.opacityVertexArray.emplaceBack(x);A.hasVisibleVertices=A.hasVisibleVertices||x!==ha},g=this.collisionBoxArrays.get(e.bucketInstanceId);for(let A=0;A<e.symbolInstances.length;A++){const v=e.symbolInstances.get(A),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:k,crossTileID:P}=v;let S=this.opacities[P];a[P]?S=w:S||(S=le,this.opacities[P]=S),a[P]=!0;const V=v.numIconVertices>0,U=this.placedOrientations[v.crossTileID],q=U===c.ah.vertical,re=U===c.ah.horizontal||U===c.ah.horizontalOnly;if(x>0||k>0){const N=Kr(S.text);m(e.text,x,q?ha:N),m(e.text,k,re?ha:N);const se=S.text.isHidden();[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(Ae=>{Ae>=0&&(e.text.placedSymbolArray.get(Ae).hidden=se||q?1:0)}),v.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).hidden=se||re?1:0);const ce=this.variableOffsets[v.crossTileID];ce&&this.markUsedJustification(e,ce.anchor,v,U);const ae=this.placedOrientations[v.crossTileID];ae&&(this.markUsedJustification(e,"left",v,ae),this.markUsedOrientation(e,ae,v))}if(V){const N=Kr(S.icon),se=!(te&&v.verticalPlacedIconSymbolIndex&&q);v.placedIconSymbolIndex>=0&&(m(e.icon,v.numIconVertices,se?N:ha),e.icon.placedSymbolArray.get(v.placedIconSymbolIndex).hidden=S.icon.isHidden()),v.verticalPlacedIconSymbolIndex>=0&&(m(e.icon,v.numVerticalIconVertices,se?ha:N),e.icon.placedSymbolArray.get(v.verticalPlacedIconSymbolIndex).hidden=S.icon.isHidden())}const Z=g&&g.has(A)?g.get(A):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const N=e.collisionArrays[A];if(N){let se=new c.P(0,0);if(N.textBox||N.verticalTextBox){let ce=!0;if(F){const ae=this.variableOffsets[P];ae?(se=dr(ae.anchor,ae.width,ae.height,ae.textOffset,ae.textBoxScale),z&&se._rotate($?this.transform.angle:-this.transform.angle)):ce=!1}if(N.textBox||N.verticalTextBox){let ae;N.textBox&&(ae=q),N.verticalTextBox&&(ae=re),In(e.textCollisionBox.collisionVertexArray,S.text.placed,!ce||ae,Z.text,se.x,se.y)}}if(N.iconBox||N.verticalIconBox){const ce=!!(!re&&N.verticalIconBox);let ae;N.iconBox&&(ae=ce),N.verticalIconBox&&(ae=!ce),In(e.iconCollisionBox.collisionVertexArray,S.icon.placed,ae,Z.icon,te?se.x:0,te?se.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const A=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=A.invProjMatrix,e.placementViewportMatrix=A.viewportMatrix,e.collisionCircleArray=A.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function In(u,e,n,a,o,h){a&&a.length!==0||(a=[0,0,0,0]);const I=a[0]-hi,w=a[1]-hi,C=a[2]-hi,M=a[3]-hi;u.emplaceBack(e?1:0,n?1:0,o||0,h||0,I,w),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,C,w),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,C,M),u.emplaceBack(e?1:0,n?1:0,o||0,h||0,I,M)}const Ri=Math.pow(2,25),Xo=Math.pow(2,24),el=Math.pow(2,17),Tr=Math.pow(2,16),Yr=Math.pow(2,9),tl=Math.pow(2,8),Pr=Math.pow(2,1);function Kr(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const e=u.placed?1:0,n=Math.floor(127*u.opacity);return n*Ri+e*Xo+n*el+e*Tr+n*Yr+e*tl+n*Pr+e}const ha=0;function Ps(){return{isOccluded:(u,e,n)=>!1,getPitchedTextCorrection:(u,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(u,e,n,a){throw new Error("Not implemented.")},translatePosition:(u,e,n,a)=>function(o,h,I,w,C=!1){if(!I[0]&&!I[1])return[0,0];const M=C?w==="map"?o.angle:0:w==="viewport"?-o.angle:0;if(M){const F=Math.sin(M),z=Math.cos(M);I=[I[0]*z-I[1]*F,I[0]*F+I[1]*z]}return[C?I[0]:yi(h,I[0],o.zoom),C?I[1]:yi(h,I[1],o.zoom)]}(u,e,n,a),getCircleRadiusCorrection:u=>1}}class ar{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,o,h){const I=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(I,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((w,C)=>w.sortKey-C.sortKey));this._currentPartIndex<I.length;)if(n.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class ua{constructor(e,n,a,o,h,I,w,C){this.placement=new fr(e,Ps(),n,I,w,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const o=me.now(),h=()=>!this._forceFullPlacement&&me.now()-o>2;for(;this._currentPlacementIndex>=0;){const I=n[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=w)&&(!I.maxzoom||I.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new ar(I)),this._inProgressLayer.continuePlacement(a[I.source],this.placement,this._showCollisionBoxes,I,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const bn=512/c.X/2;class er{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const o=new Map;for(let h=0;h<n.length;h++){const I=n.get(h),w=I.key,C=o.get(w);C?C.push(I):o.set(w,[I])}for(const[h,I]of o){const w={positions:I.map(C=>({x:Math.floor(C.anchorX*bn),y:Math.floor(C.anchorY*bn)})),crossTileIDs:I.map(C=>C.crossTileID)};if(w.positions.length>128){const C=new c.av(w.positions.length,16,Uint16Array);for(const{x:M,y:F}of w.positions)C.add(M,F);C.finish(),delete w.positions,w.index=C}this._symbolsByKey[h]=w}}getScaledCoordinates(e,n){const{x:a,y:o,z:h}=this.tileID.canonical,{x:I,y:w,z:C}=n.canonical,M=bn/Math.pow(2,C-h),F=(w*c.X+e.anchorY)*M,z=o*c.X*bn;return{x:Math.floor((I*c.X+e.anchorX)*M-a*c.X*bn),y:Math.floor(F-z)}}findMatches(e,n,a){const o=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){const I=e.get(h);if(I.crossTileID)continue;const w=this._symbolsByKey[I.key];if(!w)continue;const C=this.getScaledCoordinates(I,n);if(w.index){const M=w.index.range(C.x-o,C.y-o,C.x+o,C.y+o).sort();for(const F of M){const z=w.crossTileIDs[F];if(!a[z]){a[z]=!0,I.crossTileID=z;break}}}else if(w.positions)for(let M=0;M<w.positions.length;M++){const F=w.positions[M],z=w.crossTileIDs[M];if(Math.abs(F.x-C.x)<=o&&Math.abs(F.y-C.y)<=o&&!a[z]){a[z]=!0,I.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Aa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const o=this.indexes[a],h={};for(const I in o){const w=o[I];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+n),h[w.tileID.key]=w}this.indexes[a]=h}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const o=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const I=this.indexes[h];if(Number(h)>e.overscaledZ)for(const w in I){const C=I[w];C.tileID.isChildOf(e)&&C.findMatches(n.symbolInstances,e,o)}else{const w=I[e.scaledTo(Number(h)).key];w&&w.findMatches(n.symbolInstances,e,o)}}for(let h=0;h<n.symbolInstances.length;h++){const I=n.symbolInstances.get(h);I.crossTileID||(I.crossTileID=a.generate(),o[I.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new er(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const o of a)delete this.usedCrossTileIDs[e][o]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const o=this.indexes[a];for(const h in o)e[o[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,o[h]),delete o[h],n=!0)}return n}}class il{constructor(){this.layerIndexes={},this.crossTileIDs=new Aa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let o=this.layerIndexes[e.id];o===void 0&&(o=this.layerIndexes[e.id]=new Zr);let h=!1;const I={};o.handleWrapJump(a);for(const w of n){const C=w.getBucket(e);C&&e.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(w.tileID,C,this.crossTileIDs)&&(h=!0),I[C.bucketInstanceId]=!0)}return o.removeStaleBuckets(I)&&(h=!0),h}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const wn=(u,e)=>c.t(u,e&&e.filter(n=>n.identifier!=="source.canvas")),_c=c.aw();class Rn extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const o=this.sourceCaches[a].getSource().type;o!=="vector"&&o!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new br(ki(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,o)=>this.getGlyphs(a,o)),this.dispatcher.registerMessageHandler("GI",(a,o)=>this.getImages(a,o)),this.imageManager=new Ot,this.imageManager.setEventedParent(this),this.glyphManager=new pt(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new lr(256,512),this.crossTileSymbolIndex=new il,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Tn().on(ft,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const o=this.sourceCaches[a.sourceId];if(!o)return;const h=o.getSource();if(h&&h.vectorLayerIds)for(const I in this._layers){const w=this._layers[I];w.source===h.id&&this._validateLayer(w)}})}loadURL(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const o=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;c.h(o,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,n,a)}).catch(I=>{this._loadStyleRequest=null,I&&!h.signal.aborted&&this.fire(new c.j(I))})}loadJSON(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,me.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(_c,{validate:!1})}_load(e,n,a){var o;const h=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!wn(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(const I in h.sources)this.addSource(I,h.sources[I],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new ci(this.stylesheet.light),this.sky=new Ai(this.stylesheet.sky),this.map.setTerrain((o=this.stylesheet.terrain)!==null&&o!==void 0?o:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=c.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let o;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,I,w,C){return c._(this,void 0,void 0,function*(){const M=Ft(h),F=w>1?"@2x":"",z={},$={};for(const{id:te,url:le}of M){const m=I.transformRequest(gt(le,F,".json"),"SpriteJSON");z[te]=c.h(m,C);const g=I.transformRequest(gt(le,F,".png"),"SpriteImage");$[te]=$e.getImage(g,C)}return yield Promise.all([...Object.values(z),...Object.values($)]),function(te,le){return c._(this,void 0,void 0,function*(){const m={};for(const g in te){m[g]={};const A=me.getImageCanvasContext((yield le[g]).data),v=(yield te[g]).data;for(const x in v){const{width:k,height:P,x:S,y:V,sdf:U,pixelRatio:q,stretchX:re,stretchY:Z,content:N,textFitWidth:se,textFitHeight:ce}=v[x];m[g][x]={data:null,pixelRatio:q,sdf:U,stretchX:re,stretchY:Z,content:N,textFitWidth:se,textFitHeight:ce,spriteData:{width:k,height:P,x:S,y:V,context:A}}}}return m})}(z,$)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const I in h){this._spritesImagesIds[I]=[];const w=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(C=>!(C in h)):[];for(const C of w)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in h[I]){const M=I==="default"?C:`${I}:${C}`;this._spritesImagesIds[I].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,h[I][C],!1):this.imageManager.addImage(M,h[I][C]),n&&(this._changedImages[M]=!0)}}}).catch(h=>{this._spriteRequest=null,o=h,this.fire(new c.j(o))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(o)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const o=n.getSource();(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${o.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(a):a);const o=[];for(const h of e)if(a[h]){const I=n?c.aB(a[h]):a[h];o.push(I)}return o}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const o=this._layers[a];o.type!=="custom"&&(e[a]=o.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const o=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(o.length||h.length)&&this._updateWorkerLayers(o,h);for(const I in this._updatedSources){const w=this._updatedSources[I];if(w==="reload")this._reloadSource(I);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const o in this.sourceCaches){const h=this.sourceCaches[o];a[o]=h.used,h.used=!1}for(const o of this._order){const h=this._layers[o];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const o in a){const h=this.sourceCaches[o];!!a[o]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:o}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const o=this.serialize();if(e=n.transformStyle?n.transformStyle(o,e):e,((a=n.validate)===null||a===void 0||a)&&wn(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const h=c.aC(o,e),I=this._getOperationsToPerform(h);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const w of I.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const o of e)switch(o.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,o.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,o.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,o.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,o.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,o.args));break;case"addSource":n.push(()=>this.addSource.apply(this,o.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,o.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,o.args));break;case"setLight":n.push(()=>this.setLight.apply(this,o.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,o.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,o.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,o.args));break;case"setSky":n.push(()=>this.setSky.apply(this,o.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,o.args));break;case"setTransition":n.push(()=>{});break;default:a.push(o.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const o=this.sourceCaches[e]=new Wt(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,()=>({isSourceLoaded:o.loaded(),source:o.serialize(),sourceId:e})),o.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const o=e.id;if(this.getLayer(o))return void this.fire(new c.j(new Error(`Layer "${o}" already exists on this map.`)));let h;if(e.type==="custom"){if(wn(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(o,e.source),e=c.aB(e),e=c.e(e,{source:o})),this._validate(c.u.layer,`layers.${o}`,e,{arrayIndex:-1},a))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:o}})}const I=n?this._order.indexOf(n):this._order.length;if(n&&I===-1)this.fire(new c.j(new Error(`Cannot add layer "${o}" before non-existing layer "${n}".`)));else{if(this._order.splice(I,0,o),this._layerOrderChanged=!0,this._layers[o]=h,this._removedLayers[o]&&h.source&&h.type!=="custom"){const w=this._removedLayers[o];delete this._removedLayers[o],w.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const o=n?this._order.indexOf(n):this._order.length;n&&o===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(o,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const o=this.getLayer(e);o?o.minzoom===n&&o.maxzoom===a||(n!=null&&(o.minzoom=n),a!=null&&(o.maxzoom=a),this._updateLayer(o)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!c.aE(o.filter,n))return n==null?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(c.u.filter,`layers.${o.id}.filter`,n,null,a)||(o.filter=c.aB(n),this._updateLayer(o)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,o={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),a)||(h.setLayoutProperty(n,a,o),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,o={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),a)||(h.setPaintProperty(n,a,o)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,o=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const I=h.getSource().type;I==="geojson"&&o?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||o?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(o,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,o=this.sourceCaches[a];if(o===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=o.getSource().type,I=h==="vector"?e.sourceLayer:void 0;h!=="vector"||I?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):o.removeFeatureState(I,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,o=this.sourceCaches[n];if(o!==void 0)return o.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),o.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,o=this.stylesheet;return c.aG({version:o.version,name:o.name,metadata:o.metadata,light:o.light,sky:o.sky,center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch,sprite:o.sprite,glyphs:o.glyphs,transition:o.transition,sources:e,layers:n,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=I=>this._layers[I].type==="fill-extrusion",a={},o=[];for(let I=this._order.length-1;I>=0;I--){const w=this._order[I];if(n(w)){a[w]=I;for(const C of e){const M=C[w];if(M)for(const F of M)o.push(F)}}}o.sort((I,w)=>w.intersectionZ-I.intersectionZ);const h=[];for(let I=this._order.length-1;I>=0;I--){const w=this._order[I];if(n(w))for(let C=o.length-1;C>=0;C--){const M=o[C].feature;if(a[M.layer.id]<I)break;h.push(M),o.pop()}else for(const C of e){const M=C[w];if(M)for(const F of M)h.push(F.feature)}}return h}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const o={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const w of n.layers){const C=this._layers[w];if(!C)return this.fire(new c.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];o[C.source]=!0}}const h=[];n.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const w in this.sourceCaches)n.layers&&!o[w]||h.push(Ii(this.sourceCaches[w],this._layers,I,e,n,a));return this.placement&&h.push(function(w,C,M,F,z,$,te){const le={},m=$.queryRenderedSymbols(F),g=[];for(const A of Object.keys(m).map(Number))g.push(te[A]);g.sort(zi);for(const A of g){const v=A.featureIndex.lookupSymbolFeatures(m[A.bucketInstanceId],C,A.bucketIndex,A.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const x in v){const k=le[x]=le[x]||[],P=v[x];P.sort((S,V)=>{const U=A.featureSortOrder;if(U){const q=U.indexOf(S.featureIndex);return U.indexOf(V.featureIndex)-q}return V.featureIndex-S.featureIndex});for(const S of P)k.push(S)}}for(const A in le)le[A].forEach(v=>{const x=v.feature,k=M[w[A].source].getFeatureState(x.layer["source-layer"],x.id);x.source=x.layer.source,x.layer["source-layer"]&&(x.sourceLayer=x.layer["source-layer"]),x.state=k});return le}(this._layers,I,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(o,h){const I=o.getRenderableIds().map(M=>o.getTileByID(M)),w=[],C={};for(let M=0;M<I.length;M++){const F=I[M],z=F.tileID.canonical.key;C[z]||(C[z]=!0,F.querySourceFeatures(w,h))}return w}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let o=!1;for(const I in e)if(!c.aE(e[I],a[I])){o=!0;break}if(!o)return;const h={now:me.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let o=!1;if(!e&&!a)return;if(e&&!a)o=!0;else if(!e&&a)o=!0;else for(const I in e)if(!c.aE(e[I],a[I])){o=!0;break}if(!o)return;const h={now:me.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,a,o,h={}){return(!h||h.validate!==!1)&&wn(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},o)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Tn().off(ft,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,o,h=!1){let I=!1,w=!1;const C={};for(const M of this._order){const F=this._layers[M];if(F.type!=="symbol")continue;if(!C[F.source]){const $=this.sourceCaches[F.source];C[F.source]=$.getRenderableIds(!0).map(te=>$.getTileByID(te)).sort((te,le)=>le.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(le.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(F,C[F.source],e.center.lng);I=I||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(me.now(),e.zoom))&&(this.pauseablePlacement=new ua(e,this.map.terrain,this._order,h,n,a,o,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(me.now()),w=!0),I&&this.pauseablePlacement.placement.setStale()),w||I)for(const M of this._order){const F=this._layers[M];F.type==="symbol"&&this.placement.updateLayerOpacities(F,C[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(me.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const o=this.sourceCaches[n.source];return o&&o.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),o=this.sourceCaches[n.source];return o&&o.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},o){this._checkLoaded();const h=[{id:e,url:n}],I=[...Ft(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",I,null,a)||(this.stylesheet.sprite=I,this._loadSprite(h,!0,o))}removeSprite(e){this._checkLoaded();const n=Ft(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ft(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var $n=c.Y([{name:"a_pos",type:"Int16",components:2}]);const $r={prelude:Si(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Si(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Si(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Si(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Si("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Si(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Si("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Si("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Si("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Si(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Si(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Si(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Si(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Si(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Si(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Si(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Si(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Si(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Si(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Si(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Si(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Si(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Si(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Si(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Si(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Si("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Si("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Si("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Si("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Si(u,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),o=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=h?h.concat(o):o,w={};return{fragmentSource:u=u.replace(n,(C,M,F,z,$)=>(w[$]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${F} ${z} ${$};
#else
uniform ${F} ${z} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${F} ${z} ${$} = u_${$};
#endif
`)),vertexSource:e=e.replace(n,(C,M,F,z,$)=>{const te=z==="float"?"vec2":"vec4",le=$.match(/color/)?"color":te;return w[$]?M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${F} ${te} a_${$};
varying ${F} ${z} ${$};
#else
uniform ${F} ${z} u_${$};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${F} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${le}(a_${$}, u_${$}_t);
#else
    ${F} ${z} ${$} = u_${$};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${F} ${te} a_${$};
#else
uniform ${F} ${z} u_${$};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${F} ${z} ${$} = a_${$};
#else
    ${F} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${F} ${z} ${$} = unpack_mix_${le}(a_${$}, u_${$}_t);
#else
    ${F} ${z} ${$} = u_${$};
#endif
`}),staticAttributes:a,staticUniforms:I}}class da{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,o,h,I,w,C,M){this.context=e;let F=this.boundPaintVertexBuffers.length!==o.length;for(let z=0;!F&&z<o.length;z++)this.boundPaintVertexBuffers[z]!==o[z]&&(F=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||F||this.boundIndexBuffer!==h||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==M?this.freshBind(n,a,o,h,I,w,C,M):(e.bindVertexArray.set(this.vao),w&&w.bind(),h&&h.dynamicDraw&&h.bind(),C&&C.bind(),M&&M.bind())}freshBind(e,n,a,o,h,I,w,C){const M=e.numAttributes,F=this.context,z=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=o,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=C,n.enableAttributes(z,e);for(const $ of a)$.enableAttributes(z,e);I&&I.enableAttributes(z,e),w&&w.enableAttributes(z,e),C&&C.enableAttributes(z,e),n.bind(),n.setVertexAttribPointers(z,e,h);for(const $ of a)$.bind(),$.setVertexAttribPointers(z,e,h);I&&(I.bind(),I.setVertexAttribPointers(z,e,h)),o&&o.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,e,h)),C&&(C.bind(),C.setVertexAttribPointers(z,e,h)),F.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const rl=(u,e,n,a,o)=>({u_matrix:u,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(o):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function Is(u){const e=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const a=u[n].split(" ");e.push(a.pop())}return e}class co{constructor(e,n,a,o,h,I){const w=e.gl;this.program=w.createProgram();const C=Is(n.staticAttributes),M=a?a.getBinderAttributes():[],F=C.concat(M),z=$r.prelude.staticUniforms?Is($r.prelude.staticUniforms):[],$=n.staticUniforms?Is(n.staticUniforms):[],te=a?a.getBinderUniforms():[],le=z.concat($).concat(te),m=[];for(const S of le)m.indexOf(S)<0&&m.push(S);const g=a?a.defines():[];h&&g.push("#define OVERDRAW_INSPECTOR;"),I&&g.push("#define TERRAIN3D;");const A=g.concat($r.prelude.fragmentSource,n.fragmentSource).join(`
`),v=g.concat($r.prelude.vertexSource,n.vertexSource).join(`
`),x=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(x,A),w.compileShader(x),!w.getShaderParameter(x,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(x)}`);w.attachShader(this.program,x);const k=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(k,v),w.compileShader(k),!w.getShaderParameter(k,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(k)}`);w.attachShader(this.program,k),this.attributes={};const P={};this.numAttributes=F.length;for(let S=0;S<this.numAttributes;S++)F[S]&&(w.bindAttribLocation(this.program,S,F[S]),this.attributes[F[S]]=S);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(k),w.deleteShader(x);for(let S=0;S<m.length;S++){const V=m[S];if(V&&!P[V]){const U=w.getUniformLocation(this.program,V);U&&(P[V]=U)}}this.fixedUniforms=o(e,P),this.terrainUniforms=((S,V)=>({u_depth:new c.aH(S,V.u_depth),u_terrain:new c.aH(S,V.u_terrain),u_terrain_dim:new c.aI(S,V.u_terrain_dim),u_terrain_matrix:new c.aJ(S,V.u_terrain_matrix),u_terrain_unpack:new c.aK(S,V.u_terrain_unpack),u_terrain_exaggeration:new c.aI(S,V.u_terrain_exaggeration)}))(e,P),this.binderUniforms=a?a.getUniforms(e,P):[]}draw(e,n,a,o,h,I,w,C,M,F,z,$,te,le,m,g,A,v){const x=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(o),e.setColorMode(h),e.setCullFace(I),C){e.activeTexture.set(x.TEXTURE2),x.bindTexture(x.TEXTURE_2D,C.depthTexture),e.activeTexture.set(x.TEXTURE3),x.bindTexture(x.TEXTURE_2D,C.texture);for(const P in this.terrainUniforms)this.terrainUniforms[P].set(C[P])}for(const P in this.fixedUniforms)this.fixedUniforms[P].set(w[P]);m&&m.setUniforms(e,this.binderUniforms,te,{zoom:le});let k=0;switch(n){case x.LINES:k=2;break;case x.TRIANGLES:k=3;break;case x.LINE_STRIP:k=1}for(const P of $.get()){const S=P.vaos||(P.vaos={});(S[M]||(S[M]=new da)).bind(e,this,F,m?m.getPaintVertexBuffers():[],z,P.vertexOffset,g,A,v),x.drawElements(n,P.primitiveLength*k,x.UNSIGNED_SHORT,P.primitiveOffset*k*2)}}}function vn(u,e,n){const a=1/yi(n,1,e.transform.tileZoom),o=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/o,I=h*(n.tileID.canonical.x+n.tileID.wrap*o),w=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[I>>16,w>>16],u_pixel_coord_lower:[65535&I,65535&w]}}const Wn=(u,e,n,a)=>{const o=e.style.light,h=o.properties.get("position"),I=[h.x,h.y,h.z],w=function(){var M=new c.A(9);return c.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();o.properties.get("anchor")==="viewport"&&function(M,F){var z=Math.sin(F),$=Math.cos(F);M[0]=$,M[1]=z,M[2]=0,M[3]=-z,M[4]=$,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(w,-e.transform.angle),function(M,F,z){var $=F[0],te=F[1],le=F[2];M[0]=$*z[0]+te*z[3]+le*z[6],M[1]=$*z[1]+te*z[4]+le*z[7],M[2]=$*z[2]+te*z[5]+le*z[8]}(I,I,w);const C=o.properties.get("color");return{u_matrix:u,u_lightpos:I,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+n,u_opacity:a}},Ls=(u,e,n,a,o,h,I)=>c.e(Wn(u,e,n,a),vn(h,e,I),{u_height_factor:-Math.pow(2,o.overscaledZ)/I.tileSize/8}),fa=u=>({u_matrix:u}),ho=(u,e,n,a)=>c.e(fa(u),vn(n,e,a)),nl=(u,e)=>({u_matrix:u,u_world:e}),sl=(u,e,n,a,o)=>c.e(ho(u,e,n,a),{u_world:o}),Ol=(u,e,n,a)=>{const o=u.transform;let h,I;if(a.paint.get("circle-pitch-alignment")==="map"){const w=yi(n,1,o.zoom);h=!0,I=[w,w]}else h=!1,I=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:I}},bs=(u,e,n)=>({u_matrix:u,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),Rs=(u,e,n=1)=>({u_matrix:u,u_color:e,u_overlay:0,u_overlay_scale:n}),yr=u=>({u_matrix:u}),Lr=(u,e,n,a)=>({u_matrix:u,u_extrude_scale:yi(e,1,n),u_intensity:a}),Ga=(u,e,n,a)=>{const o=c.H();c.aP(o,0,u.width,u.height,0,0,1);const h=u.context.gl;return{u_matrix:o,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function uo(u,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/n).toLngLat().lat,new c.Z(0,(a+1)/n).toLngLat().lat]}const Ua=(u,e,n,a)=>{const o=u.transform;return{u_matrix:Ao(u,e,n,a),u_ratio:1/yi(e,1,o.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},ql=(u,e,n,a,o)=>c.e(Ua(u,e,n,o),{u_image:0,u_image_height:a}),ga=(u,e,n,a,o)=>{const h=u.transform,I=Na(e,h);return{u_matrix:Ao(u,e,n,o),u_texsize:e.imageAtlasTexture.size,u_ratio:1/yi(e,1,h.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[I,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ic=(u,e,n,a,o,h)=>{const I=u.lineAtlas,w=Na(e,u.transform),C=n.layout.get("line-cap")==="round",M=I.getDash(a.from,C),F=I.getDash(a.to,C),z=M.width*o.fromScale,$=F.width*o.toScale;return c.e(Ua(u,e,n,h),{u_patternscale_a:[w/z,-M.height/2],u_patternscale_b:[w/$,-F.height/2],u_sdfgamma:I.width/(256*Math.min(z,$)*u.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:F.y,u_mix:o.t})};function Na(u,e){return 1/yi(u,1,e.tileZoom)}function Ao(u,e,n,a){return u.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Vl=(u,e,n,a,o)=>{return{u_matrix:u,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*o.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:o.paint.get("raster-brightness-min"),u_brightness_high:o.paint.get("raster-brightness-max"),u_saturation_factor:(I=o.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(h=o.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:al(o.paint.get("raster-hue-rotate"))};var h,I};function al(u){u*=Math.PI/180;const e=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const ol=(u,e,n,a,o,h,I,w,C,M,F,z,$,te)=>{const le=I.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:le.width/le.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:o,u_is_variable_anchor:h,u_texsize:$,u_texture:0,u_translation:F,u_pitched_scale:te}},Xn=(u,e,n,a,o,h,I,w,C,M,F,z,$,te,le)=>{const m=I.transform;return c.e(ol(u,e,n,a,o,h,I,w,C,M,F,z,$,le),{u_gamma_scale:a?Math.cos(m._pitch)*m.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},Fs=(u,e,n,a,o,h,I,w,C,M,F,z,$,te)=>c.e(Xn(u,e,n,a,o,h,I,w,C,M,F,!0,z,!0,te),{u_texsize_icon:$,u_texture_icon:1}),zs=(u,e,n)=>({u_matrix:u,u_opacity:e,u_color:n}),ws=(u,e,n,a,o,h)=>c.e(function(I,w,C,M){const F=C.imageManager.getPattern(I.from.toString()),z=C.imageManager.getPattern(I.to.toString()),{width:$,height:te}=C.imageManager.getPixelSize(),le=Math.pow(2,M.tileID.overscaledZ),m=M.tileSize*Math.pow(2,C.transform.tileZoom)/le,g=m*(M.tileID.canonical.x+M.tileID.wrap*le),A=m*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[$,te],u_mix:w.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/yi(M,1,C.transform.tileZoom),u_pixel_coord_upper:[g>>16,A>>16],u_pixel_coord_lower:[65535&g,65535&A]}}(a,h,n,o),{u_matrix:u,u_opacity:e}),Gs={fillExtrusion:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_lightpos:new c.aN(u,e.u_lightpos),u_lightintensity:new c.aI(u,e.u_lightintensity),u_lightcolor:new c.aN(u,e.u_lightcolor),u_vertical_gradient:new c.aI(u,e.u_vertical_gradient),u_opacity:new c.aI(u,e.u_opacity)}),fillExtrusionPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_lightpos:new c.aN(u,e.u_lightpos),u_lightintensity:new c.aI(u,e.u_lightintensity),u_lightcolor:new c.aN(u,e.u_lightcolor),u_vertical_gradient:new c.aI(u,e.u_vertical_gradient),u_height_factor:new c.aI(u,e.u_height_factor),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade),u_opacity:new c.aI(u,e.u_opacity)}),fill:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix)}),fillPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),fillOutline:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world)}),fillOutlinePattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world),u_image:new c.aH(u,e.u_image),u_texsize:new c.aO(u,e.u_texsize),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),circle:(u,e)=>({u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(u,e.u_scale_with_map),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_extrude_scale:new c.aO(u,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_matrix:new c.aJ(u,e.u_matrix)}),collisionBox:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_pixel_extrude_scale:new c.aO(u,e.u_pixel_extrude_scale)}),collisionCircle:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_inv_matrix:new c.aJ(u,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_viewport_size:new c.aO(u,e.u_viewport_size)}),debug:(u,e)=>({u_color:new c.aL(u,e.u_color),u_matrix:new c.aJ(u,e.u_matrix),u_overlay:new c.aH(u,e.u_overlay),u_overlay_scale:new c.aI(u,e.u_overlay_scale)}),clippingMask:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix)}),heatmap:(u,e)=>({u_extrude_scale:new c.aI(u,e.u_extrude_scale),u_intensity:new c.aI(u,e.u_intensity),u_matrix:new c.aJ(u,e.u_matrix)}),heatmapTexture:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_world:new c.aO(u,e.u_world),u_image:new c.aH(u,e.u_image),u_color_ramp:new c.aH(u,e.u_color_ramp),u_opacity:new c.aI(u,e.u_opacity)}),hillshade:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_latrange:new c.aO(u,e.u_latrange),u_light:new c.aO(u,e.u_light),u_shadow:new c.aL(u,e.u_shadow),u_highlight:new c.aL(u,e.u_highlight),u_accent:new c.aL(u,e.u_accent)}),hillshadePrepare:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_image:new c.aH(u,e.u_image),u_dimension:new c.aO(u,e.u_dimension),u_zoom:new c.aI(u,e.u_zoom),u_unpack:new c.aK(u,e.u_unpack)}),line:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels)}),lineGradient:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_image:new c.aH(u,e.u_image),u_image_height:new c.aI(u,e.u_image_height)}),linePattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texsize:new c.aO(u,e.u_texsize),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_image:new c.aH(u,e.u_image),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_scale:new c.aN(u,e.u_scale),u_fade:new c.aI(u,e.u_fade)}),lineSDF:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ratio:new c.aI(u,e.u_ratio),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(u,e.u_units_to_pixels),u_patternscale_a:new c.aO(u,e.u_patternscale_a),u_patternscale_b:new c.aO(u,e.u_patternscale_b),u_sdfgamma:new c.aI(u,e.u_sdfgamma),u_image:new c.aH(u,e.u_image),u_tex_y_a:new c.aI(u,e.u_tex_y_a),u_tex_y_b:new c.aI(u,e.u_tex_y_b),u_mix:new c.aI(u,e.u_mix)}),raster:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_tl_parent:new c.aO(u,e.u_tl_parent),u_scale_parent:new c.aI(u,e.u_scale_parent),u_buffer_scale:new c.aI(u,e.u_buffer_scale),u_fade_t:new c.aI(u,e.u_fade_t),u_opacity:new c.aI(u,e.u_opacity),u_image0:new c.aH(u,e.u_image0),u_image1:new c.aH(u,e.u_image1),u_brightness_low:new c.aI(u,e.u_brightness_low),u_brightness_high:new c.aI(u,e.u_brightness_high),u_saturation_factor:new c.aI(u,e.u_saturation_factor),u_contrast_factor:new c.aI(u,e.u_contrast_factor),u_spin_weights:new c.aN(u,e.u_spin_weights)}),symbolIcon:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texture:new c.aH(u,e.u_texture),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),symbolSDF:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texture:new c.aH(u,e.u_texture),u_gamma_scale:new c.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_is_halo:new c.aH(u,e.u_is_halo),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),symbolTextAndIcon:(u,e)=>({u_is_size_zoom_constant:new c.aH(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(u,e.u_is_size_feature_constant),u_size_t:new c.aI(u,e.u_size_t),u_size:new c.aI(u,e.u_size),u_camera_to_center_distance:new c.aI(u,e.u_camera_to_center_distance),u_pitch:new c.aI(u,e.u_pitch),u_rotate_symbol:new c.aH(u,e.u_rotate_symbol),u_aspect_ratio:new c.aI(u,e.u_aspect_ratio),u_fade_change:new c.aI(u,e.u_fade_change),u_matrix:new c.aJ(u,e.u_matrix),u_label_plane_matrix:new c.aJ(u,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(u,e.u_coord_matrix),u_is_text:new c.aH(u,e.u_is_text),u_pitch_with_map:new c.aH(u,e.u_pitch_with_map),u_is_along_line:new c.aH(u,e.u_is_along_line),u_is_variable_anchor:new c.aH(u,e.u_is_variable_anchor),u_texsize:new c.aO(u,e.u_texsize),u_texsize_icon:new c.aO(u,e.u_texsize_icon),u_texture:new c.aH(u,e.u_texture),u_texture_icon:new c.aH(u,e.u_texture_icon),u_gamma_scale:new c.aI(u,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(u,e.u_device_pixel_ratio),u_is_halo:new c.aH(u,e.u_is_halo),u_translation:new c.aO(u,e.u_translation),u_pitched_scale:new c.aI(u,e.u_pitched_scale)}),background:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_opacity:new c.aI(u,e.u_opacity),u_color:new c.aL(u,e.u_color)}),backgroundPattern:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_opacity:new c.aI(u,e.u_opacity),u_image:new c.aH(u,e.u_image),u_pattern_tl_a:new c.aO(u,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(u,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(u,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(u,e.u_pattern_br_b),u_texsize:new c.aO(u,e.u_texsize),u_mix:new c.aI(u,e.u_mix),u_pattern_size_a:new c.aO(u,e.u_pattern_size_a),u_pattern_size_b:new c.aO(u,e.u_pattern_size_b),u_scale_a:new c.aI(u,e.u_scale_a),u_scale_b:new c.aI(u,e.u_scale_b),u_pixel_coord_upper:new c.aO(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(u,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(u,e.u_tile_units_to_pixels)}),terrain:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texture:new c.aH(u,e.u_texture),u_ele_delta:new c.aI(u,e.u_ele_delta),u_fog_matrix:new c.aJ(u,e.u_fog_matrix),u_fog_color:new c.aL(u,e.u_fog_color),u_fog_ground_blend:new c.aI(u,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(u,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(u,e.u_horizon_color),u_horizon_fog_blend:new c.aI(u,e.u_horizon_fog_blend)}),terrainDepth:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_ele_delta:new c.aI(u,e.u_ele_delta)}),terrainCoords:(u,e)=>({u_matrix:new c.aJ(u,e.u_matrix),u_texture:new c.aH(u,e.u_texture),u_terrain_coords_id:new c.aI(u,e.u_terrain_coords_id),u_ele_delta:new c.aI(u,e.u_ele_delta)}),sky:(u,e)=>({u_sky_color:new c.aL(u,e.u_sky_color),u_horizon_color:new c.aL(u,e.u_horizon_color),u_horizon:new c.aI(u,e.u_horizon),u_sky_horizon_blend:new c.aI(u,e.u_sky_horizon_blend)})};class hr{constructor(e,n,a){this.context=e;const o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ll{constructor(e,n,a,o){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=o,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const o=n.attributes[this.attributes[a].name];o!==void 0&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,n,a){for(let o=0;o<this.attributes.length;o++){const h=this.attributes[o],I=n.attributes[h.name];I!==void 0&&e.vertexAttribPointer(I,h.components,e[bc[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Us=new WeakMap;function vs(u){var e;if(Us.has(u))return Us.get(u);{const n=(e=u.getParameter(u.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Us.set(u,n),n}}class Di{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fo extends Di{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class wc extends Di{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ns extends Di{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Hl extends Di{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class cl extends Di{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Oa extends Di{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class hl extends Di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class pa extends Di{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class go extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Qr extends Di{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ul extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Al extends Di{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Fn extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class xs extends Di{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Os extends Di{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class dl extends Di{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ma extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class xn extends Di{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class qa extends Di{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class po extends Di{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class fl extends Di{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class mo extends Di{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jl extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class gl extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class yo extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Jl extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class _o extends Di{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class es extends Di{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;vs(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ya extends Di{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pl extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Va extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class _a extends Di{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class ml extends _a{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ts extends _a{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class yl extends _a{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class vc{constructor(e,n,a,o,h){this.context=e,this.width=n,this.height=a;const I=e.gl,w=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new ml(e,w),o)this.depthAttachment=h?new yl(e,w):new ts(e,w);else if(h)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Zi{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}Zi.Replace=[1,0],Zi.disabled=new Zi(Zi.Replace,c.aM.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,c.aM.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,771],c.aM.transparent,[!0,!0,!0,!0]);class Ia{constructor(e){var n,a;if(this.gl=e,this.clearColor=new fo(this),this.clearDepth=new wc(this),this.clearStencil=new Ns(this),this.colorMask=new Hl(this),this.depthMask=new cl(this),this.stencilMask=new Oa(this),this.stencilFunc=new hl(this),this.stencilOp=new pa(this),this.stencilTest=new go(this),this.depthRange=new Qr(this),this.depthTest=new ul(this),this.depthFunc=new Al(this),this.blend=new Fn(this),this.blendFunc=new xs(this),this.blendColor=new Os(this),this.blendEquation=new dl(this),this.cullFace=new ma(this),this.cullFaceSide=new xn(this),this.frontFace=new qa(this),this.program=new po(this),this.activeTexture=new fl(this),this.viewport=new mo(this),this.bindFramebuffer=new jl(this),this.bindRenderbuffer=new gl(this),this.bindTexture=new yo(this),this.bindVertexBuffer=new Jl(this),this.bindElementBuffer=new _o(this),this.bindVertexArray=new es(this),this.pixelStoreUnpack=new ya(this),this.pixelStoreUnpackPremultiplyAlpha=new pl(this),this.pixelStoreUnpackFlipY=new Va(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),vs(e)){this.HALF_FLOAT=e.HALF_FLOAT;const o=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:o==null?void 0:o.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:o==null?void 0:o.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const o=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=o==null?void 0:o.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new hr(this,e,n)}createVertexBuffer(e,n,a){return new ll(this,e,n,a)}createRenderbuffer(e,n,a){const o=this.gl,h=o.createRenderbuffer();return this.bindRenderbuffer.set(h),o.renderbufferStorage(o.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,a,o){return new vc(this,e,n,a,o)}clear({color:e,depth:n,stencil:a}){const o=this.gl;let h=0;e&&(h|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(h|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),o.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return vs(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return vs(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class fi{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}fi.ReadOnly=!1,fi.ReadWrite=!0,fi.disabled=new fi(519,fi.ReadOnly,[0,1]);const Io=7680;class Ui{constructor(e,n,a,o,h,I){this.test=e,this.ref=n,this.mask=a,this.fail=o,this.depthFail=h,this.pass=I}}Ui.disabled=new Ui({func:519,mask:0},0,0,Io,Io,Io);class Fi{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let zn;function Gn(u,e,n,a,o){const h=u.context,I=h.gl,w=u.useProgram("collisionBox"),C=[];let M=0,F=0;for(let A=0;A<a.length;A++){const v=a[A],x=e.getTile(v).getBucket(n);if(!x)continue;const k=o?x.textCollisionBox:x.iconCollisionBox,P=x.collisionCircleArray;if(P.length>0){const S=c.H();c.aQ(S,x.placementInvProjMatrix,u.transform.glCoordMatrix),c.aQ(S,S,x.placementViewportMatrix),C.push({circleArray:P,circleOffset:F,transform:v.posMatrix,invTransform:S,coord:v}),M+=P.length/4,F=M}k&&w.draw(h,I.LINES,fi.disabled,Ui.disabled,u.colorModeForRenderPass(),Fi.disabled,{u_matrix:v.posMatrix,u_pixel_extrude_scale:[1/(z=u.transform).width,1/z.height]},u.style.map.terrain&&u.style.map.terrain.getTerrainData(v),n.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,null,u.transform.zoom,null,null,k.collisionVertexBuffer)}var z;if(!o||!C.length)return;const $=u.useProgram("collisionCircle"),te=new c.aR;te.resize(4*M),te._trim();let le=0;for(const A of C)for(let v=0;v<A.circleArray.length/4;v++){const x=4*v,k=A.circleArray[x+0],P=A.circleArray[x+1],S=A.circleArray[x+2],V=A.circleArray[x+3];te.emplace(le++,k,P,S,V,0),te.emplace(le++,k,P,S,V,1),te.emplace(le++,k,P,S,V,2),te.emplace(le++,k,P,S,V,3)}(!zn||zn.length<2*M)&&(zn=function(A){const v=2*A,x=new c.aT;x.resize(v),x._trim();for(let k=0;k<v;k++){const P=6*k;x.uint16[P+0]=4*k+0,x.uint16[P+1]=4*k+1,x.uint16[P+2]=4*k+2,x.uint16[P+3]=4*k+2,x.uint16[P+4]=4*k+3,x.uint16[P+5]=4*k+0}return x}(M));const m=h.createIndexBuffer(zn,!0),g=h.createVertexBuffer(te,c.aS.members,!0);for(const A of C){const v=bs(A.transform,A.invTransform,u.transform);$.draw(h,I.TRIANGLES,fi.disabled,Ui.disabled,u.colorModeForRenderPass(),Fi.disabled,v,u.style.map.terrain&&u.style.map.terrain.getTerrainData(A.coord),n.id,g,m,c.a0.simpleSegment(0,2*A.circleOffset,A.circleArray.length,A.circleArray.length/2),null,u.transform.zoom,null,null,null)}g.destroy(),m.destroy()}Fi.disabled=new Fi(!1,1029,2305),Fi.backCCW=new Fi(!0,1029,2305);const ba=c.an(new Float32Array(16));function _l(u,e,n,a,o,h){const{horizontalAlign:I,verticalAlign:w}=c.au(u);return new c.P((-(I-.5)*e/o+a[0])*h,(-(w-.5)*n/o+a[1])*h)}function Un(u,e,n,a,o,h){const I=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=a.mult(h);n||(w=w.rotate(-o));const C=I.add(w);return _e(C.x,C.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const w=qe(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(u),C=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return u.add(a.rotate(C))}return u.add(a)}function Bs(u,e,n,a,o,h,I,w,C,M,F,z,$,te){const le=u.text.placedSymbolArray,m=u.text.dynamicLayoutVertexArray,g=u.icon.dynamicLayoutVertexArray,A={};m.clear();for(let v=0;v<le.length;v++){const x=le.get(v),k=x.hidden||!x.crossTileID||u.allowVerticalPlacement&&!x.placedOrientation?null:a[x.crossTileID];if(k){const P=new c.P(x.anchorX,x.anchorY),S={getElevation:te,width:o.width,height:o.height,labelPlaneMatrix:h,pitchWithMap:n,projection:F,tileAnchorPoint:P,translation:z,unwrappedTileID:$},V=n?_e(P.x,P.y,I,te):qe(P.x,P.y,S),U=j(o.cameraToCenterDistance,V.signedDistanceFromCamera);let q=c.ai(u.textSizeData,C,x)*U/c.ap;n&&(q*=u.tilePixelRatio/w);const{width:re,height:Z,anchor:N,textOffset:se,textBoxScale:ce}=k,ae=_l(N,re,Z,se,ce,q),Ae=F.getPitchedTextCorrection(o,P.add(new c.P(z[0],z[1])),$),ve=Un(V.point,S,e,ae,o.angle,Ae),Ie=u.allowVerticalPlacement&&x.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let ke=0;ke<x.numGlyphs;ke++)c.aj(m,ve,Ie);M&&x.associatedIconIndex>=0&&(A[x.associatedIconIndex]={shiftedAnchor:ve,angle:Ie})}else Jt(x.numGlyphs,m)}if(M){g.clear();const v=u.icon.placedSymbolArray;for(let x=0;x<v.length;x++){const k=v.get(x);if(k.hidden)Jt(k.numGlyphs,g);else{const P=A[x];if(P)for(let S=0;S<k.numGlyphs;S++)c.aj(g,P.shiftedAnchor,P.angle);else Jt(k.numGlyphs,g)}}u.icon.dynamicLayoutVertexBuffer.updateData(g)}u.text.dynamicLayoutVertexBuffer.updateData(m)}function Wr(u,e,n){return n.iconsInText&&e?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function bo(u,e,n,a,o,h,I,w,C,M,F,z){const $=u.context,te=$.gl,le=u.transform,m=Ps(),g=w==="map",A=C==="map",v=w!=="viewport"&&n.layout.get("symbol-placement")!=="point",x=g&&!A&&!v,k=!A&&v,P=!n.layout.get("symbol-sort-key").isConstant();let S=!1;const V=u.depthModeForSublayer(0,fi.ReadOnly),U=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=[],re=m.getCircleRadiusCorrection(le);for(const Z of a){const N=e.getTile(Z),se=N.getBucket(n);if(!se)continue;const ce=o?se.text:se.icon;if(!ce||!ce.segments.get().length||!ce.hasVisibleVertices)continue;const ae=ce.programConfigurations.get(n.id),Ae=o||se.sdfIcons,ve=o?se.textSizeData:se.iconSizeData,Ie=A||le.pitch!==0,ke=u.useProgram(Wr(Ae,o,se),ae),K=c.ag(ve,le.zoom),G=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Z);let ue,ie,oe,de,Se=[0,0],Be=null;if(o)ie=N.glyphAtlasTexture,oe=te.LINEAR,ue=N.glyphAtlasTexture.size,se.iconsInText&&(Se=N.imageAtlasTexture.size,Be=N.imageAtlasTexture,de=Ie||u.options.rotating||u.options.zooming||ve.kind==="composite"||ve.kind==="camera"?te.LINEAR:te.NEAREST);else{const ct=n.layout.get("icon-size").constantOr(0)!==1||se.iconsNeedLinear;ie=N.imageAtlasTexture,oe=Ae||u.options.rotating||u.options.zooming||ct||Ie?te.LINEAR:te.NEAREST,ue=N.imageAtlasTexture.size}const Qe=yi(N,1,u.transform.zoom),Ge=k?Z.posMatrix:ba,He=Zn(Ge,A,g,u.transform,Qe),Ke=_n(Ge,A,g,u.transform,Qe),tt=_n(Z.posMatrix,A,g,u.transform,Qe),mt=m.translatePosition(u.transform,N,h,I),Oe=U&&se.hasTextData(),Fe=n.layout.get("icon-text-fit")!=="none"&&Oe&&se.hasIconData();if(v){const ct=u.style.map.terrain?(bi,ui)=>u.style.map.terrain.getElevation(Z,bi,ui):null,Et=n.layout.get("text-rotation-alignment")==="map";ee(se,Z.posMatrix,u,o,He,tt,A,M,Et,m,Z.toUnwrapped(),le.width,le.height,mt,ct)}const et=Z.posMatrix,Dt=o&&U||Fe,At=v||Dt?ba:He,Lt=Ke,ht=Ae&&n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ct;Ct=Ae?se.iconsInText?Fs(ve.kind,K,x,A,v,Dt,u,et,At,Lt,mt,ue,Se,re):Xn(ve.kind,K,x,A,v,Dt,u,et,At,Lt,mt,o,ue,!0,re):ol(ve.kind,K,x,A,v,Dt,u,et,At,Lt,mt,o,ue,re);const It={program:ke,buffers:ce,uniformValues:Ct,atlasTexture:ie,atlasTextureIcon:Be,atlasInterpolation:oe,atlasInterpolationIcon:de,isSDF:Ae,hasHalo:ht};if(P&&se.canOverlap){S=!0;const ct=ce.segments.get();for(const Et of ct)q.push({segments:new c.a0([Et]),sortKey:Et.sortKey,state:It,terrainData:G})}else q.push({segments:ce.segments,sortKey:0,state:It,terrainData:G})}S&&q.sort((Z,N)=>Z.sortKey-N.sortKey);for(const Z of q){const N=Z.state;if($.activeTexture.set(te.TEXTURE0),N.atlasTexture.bind(N.atlasInterpolation,te.CLAMP_TO_EDGE),N.atlasTextureIcon&&($.activeTexture.set(te.TEXTURE1),N.atlasTextureIcon&&N.atlasTextureIcon.bind(N.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),N.isSDF){const se=N.uniformValues;N.hasHalo&&(se.u_is_halo=1,wo(N.buffers,Z.segments,n,u,N.program,V,F,z,se,Z.terrainData)),se.u_is_halo=0}wo(N.buffers,Z.segments,n,u,N.program,V,F,z,N.uniformValues,Z.terrainData)}}function wo(u,e,n,a,o,h,I,w,C,M){const F=a.context;o.draw(F,F.gl.TRIANGLES,h,I,w,Fi.disabled,C,M,n.id,u.layoutVertexBuffer,u.indexBuffer,e,n.paint,a.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Ha(u,e,n,a){const o=u.context,h=o.gl,I=Ui.disabled,w=new Zi([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),C=e.getBucket(n);if(!C)return;const M=a.key;let F=n.heatmapFbos.get(M);F||(F=wa(o,e.tileSize,e.tileSize),n.heatmapFbos.set(M,F)),o.bindFramebuffer.set(F.framebuffer),o.viewport.set([0,0,e.tileSize,e.tileSize]),o.clear({color:c.aM.transparent});const z=C.programConfigurations.get(n.id),$=u.useProgram("heatmap",z),te=u.style.map.terrain.getTerrainData(a);$.draw(o,h.TRIANGLES,fi.disabled,I,w,Fi.disabled,Lr(a.posMatrix,e,u.transform.zoom,n.paint.get("heatmap-intensity")),te,n.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,n.paint,u.transform.zoom,z)}function Cs(u,e,n){const a=u.context,o=a.gl;a.setColorMode(u.colorModeForRenderPass());const h=va(a,e),I=n.key,w=e.heatmapFbos.get(I);w&&(a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,w.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1),h.bind(o.LINEAR,o.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(a,o.TRIANGLES,fi.disabled,Ui.disabled,u.colorModeForRenderPass(),Fi.disabled,Ga(u,e,0,1),null,e.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,e.paint,u.transform.zoom),w.destroy(),e.heatmapFbos.delete(I))}function wa(u,e,n){var a,o;const h=u.gl,I=h.createTexture();h.bindTexture(h.TEXTURE_2D,I),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const w=(a=u.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,C=(o=u.RGBA16F)!==null&&o!==void 0?o:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,C,e,n,0,h.RGBA,w,null);const M=u.createFramebuffer(e,n,!1,!1);return M.colorAttachment.set(I),M}function va(u,e){return e.colorRampTexture||(e.colorRampTexture=new Qt(u,e.colorRamp,u.gl.RGBA)),e.colorRampTexture}function qs(u,e,n,a,o){if(!n||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let I=h[n.to.toString()],w=h[n.from.toString()];if(!I&&w&&(I=w),!w&&I&&(w=I),!I||!w){const C=o.getPaintProperty(e);I=h[C],w=h[C]}I&&w&&u.setConstantPatternPositions(I,w)}function ja(u,e,n,a,o,h,I){const w=u.context.gl,C="fill-pattern",M=n.paint.get(C),F=M&&M.constantOr(1),z=n.getCrossfadeParameters();let $,te,le,m,g;I?(te=F&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=w.LINES):(te=F?"fillPattern":"fill",$=w.TRIANGLES);const A=M.constantOr(null);for(const v of a){const x=e.getTile(v);if(F&&!x.patternsLoaded())continue;const k=x.getBucket(n);if(!k)continue;const P=k.programConfigurations.get(n.id),S=u.useProgram(te,P),V=u.style.map.terrain&&u.style.map.terrain.getTerrainData(v);F&&(u.context.activeTexture.set(w.TEXTURE0),x.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),P.updatePaintBuffers(z)),qs(P,C,A,x,n);const U=V?v:null,q=u.translatePosMatrix(U?U.posMatrix:v.posMatrix,x,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(I){m=k.indexBuffer2,g=k.segments2;const re=[w.drawingBufferWidth,w.drawingBufferHeight];le=te==="fillOutlinePattern"&&F?sl(q,u,z,x,re):nl(q,re)}else m=k.indexBuffer,g=k.segments,le=F?ho(q,u,z,x):fa(q);S.draw(u.context,$,o,u.stencilModeForClipping(v),h,Fi.disabled,le,V,n.id,k.layoutVertexBuffer,m,g,n.paint,u.transform.zoom,P)}}function vo(u,e,n,a,o,h,I){const w=u.context,C=w.gl,M="fill-extrusion-pattern",F=n.paint.get(M),z=F.constantOr(1),$=n.getCrossfadeParameters(),te=n.paint.get("fill-extrusion-opacity"),le=F.constantOr(null);for(const m of a){const g=e.getTile(m),A=g.getBucket(n);if(!A)continue;const v=u.style.map.terrain&&u.style.map.terrain.getTerrainData(m),x=A.programConfigurations.get(n.id),k=u.useProgram(z?"fillExtrusionPattern":"fillExtrusion",x);z&&(u.context.activeTexture.set(C.TEXTURE0),g.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),x.updatePaintBuffers($)),qs(x,M,le,g,n);const P=u.translatePosMatrix(m.posMatrix,g,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),S=n.paint.get("fill-extrusion-vertical-gradient"),V=z?Ls(P,u,S,te,m,$,g):Wn(P,u,S,te);k.draw(w,w.gl.TRIANGLES,o,h,I,Fi.backCCW,V,v,n.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,n.paint,u.transform.zoom,x,u.style.map.terrain&&A.centroidVertexBuffer)}}function xa(u,e,n,a,o,h,I){const w=u.context,C=w.gl,M=n.fbo;if(!M)return;const F=u.useProgram("hillshade"),z=u.style.map.terrain&&u.style.map.terrain.getTerrainData(e);w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,M.colorAttachment.get()),F.draw(w,C.TRIANGLES,o,h,I,Fi.disabled,(($,te,le,m)=>{const g=le.paint.get("hillshade-shadow-color"),A=le.paint.get("hillshade-highlight-color"),v=le.paint.get("hillshade-accent-color");let x=le.paint.get("hillshade-illumination-direction")*(Math.PI/180);le.paint.get("hillshade-illumination-anchor")==="viewport"&&(x-=$.transform.angle);const k=!$.options.moving;return{u_matrix:m?m.posMatrix:$.transform.calculatePosMatrix(te.tileID.toUnwrapped(),k),u_image:0,u_latrange:uo(0,te.tileID),u_light:[le.paint.get("hillshade-exaggeration"),x],u_shadow:g,u_highlight:A,u_accent:v}})(u,n,a,z?e:null),z,a.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function Vs(u,e,n,a,o,h){const I=u.context,w=I.gl,C=e.dem;if(C&&C.data){const M=C.dim,F=C.stride,z=C.getPixels();if(I.activeTexture.set(w.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||u.getTileTexture(F),e.demTexture){const te=e.demTexture;te.update(z,{premultiply:!1}),te.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new Qt(I,z,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);I.activeTexture.set(w.TEXTURE0);let $=e.fbo;if(!$){const te=new Qt(I,{width:M,height:M,data:null},w.RGBA);te.bind(w.LINEAR,w.CLAMP_TO_EDGE),$=e.fbo=I.createFramebuffer(M,M,!0,!1),$.colorAttachment.set(te.texture)}I.bindFramebuffer.set($.framebuffer),I.viewport.set([0,0,M,M]),u.useProgram("hillshadePrepare").draw(I,w.TRIANGLES,a,o,h,Fi.disabled,((te,le)=>{const m=le.stride,g=c.H();return c.aP(g,0,c.X,-c.X,0,0,1),c.J(g,g,[0,-c.X,0]),{u_matrix:g,u_image:1,u_dimension:[m,m],u_zoom:te.overscaledZ,u_unpack:le.getUnpackVector()}})(e.tileID,C),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Il(u,e,n,a,o,h){const I=a.paint.get("raster-fade-duration");if(!h&&I>0){const w=me.now(),C=(w-u.timeAdded)/I,M=e?(w-e.timeAdded)/I:-1,F=n.getSource(),z=o.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),$=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(u.tileID.overscaledZ-z),te=$&&u.refreshedUponExpiration?1:c.ac($?C:1-M,0,1);return u.refreshedUponExpiration&&C>=1&&(u.refreshedUponExpiration=!1),e?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const xo=new c.aM(1,0,0,1),Qi=new c.aM(0,1,0,1),Bo=new c.aM(0,0,1,1),xc=new c.aM(1,0,1,1),bl=new c.aM(0,1,1,1);function Rr(u,e,n,a){Co(u,0,e+n/2,u.transform.width,n,a)}function Yl(u,e,n,a){Co(u,e-n/2,0,n,u.transform.height,a)}function Co(u,e,n,a,o,h){const I=u.context,w=I.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*u.pixelRatio,n*u.pixelRatio,a*u.pixelRatio,o*u.pixelRatio),I.clear({color:h}),w.disable(w.SCISSOR_TEST)}function Kl(u,e,n){const a=u.context,o=a.gl,h=n.posMatrix,I=u.useProgram("debug"),w=fi.disabled,C=Ui.disabled,M=u.colorModeForRenderPass(),F="$debug",z=u.style.map.terrain&&u.style.map.terrain.getTerrainData(n);a.activeTexture.set(o.TEXTURE0);const $=e.getTileByID(n.key).latestRawTileData,te=Math.floor(($&&$.byteLength||0)/1024),le=e.getTile(n).tileSize,m=512/Math.min(le,512)*(n.overscaledZ/u.transform.zoom)*.5;let g=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(g+=` => ${n.overscaledZ}`),function(A,v){A.initDebugOverlayCanvas();const x=A.debugOverlayCanvas,k=A.context.gl,P=A.debugOverlayCanvas.getContext("2d");P.clearRect(0,0,x.width,x.height),P.shadowColor="white",P.shadowBlur=2,P.lineWidth=1.5,P.strokeStyle="white",P.textBaseline="top",P.font="bold 36px Open Sans, sans-serif",P.fillText(v,5,5),P.strokeText(v,5,5),A.debugOverlayTexture.update(x),A.debugOverlayTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE)}(u,`${g} ${te}kB`),I.draw(a,o.TRIANGLES,w,C,Zi.alphaBlended,Fi.disabled,Rs(h,c.aM.transparent,m),null,F,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),I.draw(a,o.LINE_STRIP,w,C,M,Fi.disabled,Rs(h,c.aM.red),z,F,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function Eo(u,e,n){const a=u.context,o=a.gl,h=u.colorModeForRenderPass(),I=new fi(o.LEQUAL,fi.ReadWrite,u.depthRangeFor3D),w=u.useProgram("terrain"),C=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,u.width,u.height]);for(const M of n){const F=u.renderToTexture.getTexture(M),z=e.getTerrainData(M.tileID);a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,F.texture);const $=u.transform.calculatePosMatrix(M.tileID.toUnwrapped()),te=e.getMeshFrameDelta(u.transform.zoom),le=u.transform.calculateFogMatrix(M.tileID.toUnwrapped()),m=rl($,te,le,u.style.sky,u.transform.pitch);w.draw(a,o.TRIANGLES,I,Ui.disabled,h,Fi.backCCW,m,z,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}class Ba{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Qo{constructor(e,n){this.context=new Ia(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Wt.maxUnderzooming+Wt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new il}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const o of this.style._order)this.style._layers[o].resize()}setup(){const e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,$n.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,$n.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const o=new c.$;o.emplaceBack(0,0,0,0),o.emplaceBack(c.X,0,c.X,0),o.emplaceBack(0,c.X,0,c.X),o.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(o,wr.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,$n.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const I=new c.aZ;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(I);const w=new c.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const C=this.context.gl;this.stencilClearMode=new Ui({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,fi.disabled,this.stencilClearMode,Zi.disabled,Fi.disabled,yr(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,o=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Zi.disabled),a.setDepthMode(fi.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of n){const w=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);h.draw(a,o.TRIANGLES,fi.disabled,new Ui({func:o.ALWAYS,mask:0},w,255,o.KEEP,o.KEEP,o.REPLACE),Zi.disabled,Fi.disabled,yr(I.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Ui({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Ui({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((I,w)=>w.overscaledZ-I.overscaledZ),o=a[a.length-1].overscaledZ,h=a[0].overscaledZ-o+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const I={};for(let w=0;w<h;w++)I[w+o]=new Ui({func:n.GEQUAL,mask:255},w+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[I,a]}return[{[o]:Ui.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Zi([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return fi.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new fi(a||this.context.gl.LEQUAL,n,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(me.now()),this.imageManager.beginFrame();const a=this.style._order,o=this.style.sourceCaches,h={},I={},w={};for(const C in o){const M=o[C];M.used&&M.prepare(this.context),h[C]=M.getVisibleCoordinates(),I[C]=h[C].slice().reverse(),w[C]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<a.length;C++)if(this.style._layers[a[C]].is3D()){this.opaquePassCutoff=C;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const C of a){const M=this.style._layers[C];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const F=I[M.source];(M.type==="custom"||F.length)&&this.renderLayer(this,o[M.source],M,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(C,M){const F=C.context,z=F.gl,$=((A,v,x)=>({u_sky_color:A.properties.get("sky-color"),u_horizon_color:A.properties.get("horizon-color"),u_horizon:(v.height/2+v.getHorizon())*x,u_sky_horizon_blend:A.properties.get("sky-horizon-blend")*v.height/2*x}))(M,C.style.map.transform,C.pixelRatio),te=new fi(z.LEQUAL,fi.ReadWrite,[0,1]),le=Ui.disabled,m=C.colorModeForRenderPass(),g=C.useProgram("sky");if(!M.mesh){const A=new c.aX;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1);const v=new c.aY;v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),M.mesh=new Ba(F.createVertexBuffer(A,$n.members),F.createIndexBuffer(v),c.a0.simpleSegment(0,0,A.length,v.length))}g.draw(F,z.TRIANGLES,te,le,m,Fi.disabled,$,void 0,"sky",M.mesh.vertexBuffer,M.mesh.indexBuffer,M.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[a[this.currentLayer]],M=o[C.source],F=h[C.source];this._renderTileClippingMasks(C,F),this.renderLayer(this,M,C,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const C=this.style._layers[a[this.currentLayer]],M=o[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const F=(C.type==="symbol"?w:I)[C.source];this._renderTileClippingMasks(C,h[C.source]),this.renderLayer(this,M,C,F)}if(this.options.showTileBoundaries){const C=function(M,F){let z=null;const $=Object.values(M._layers).flatMap(g=>g.source&&!g.isHidden(F)?[M.sourceCaches[g.source]]:[]),te=$.filter(g=>g.getSource().type==="vector"),le=$.filter(g=>g.getSource().type!=="vector"),m=g=>{(!z||z.getSource().maxzoom<g.getSource().maxzoom)&&(z=g)};return te.forEach(g=>m(g)),z||le.forEach(g=>m(g)),z}(this.style,this.transform.zoom);C&&function(M,F,z){for(let $=0;$<z.length;$++)Kl(M,F,z[$])}(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const M=C.transform.padding;Rr(C,C.transform.height-(M.top||0),3,xo),Rr(C,M.bottom||0,3,Qi),Yl(C,M.left||0,3,Bo),Yl(C,C.transform.width-(M.right||0),3,xc);const F=C.transform.centerPoint;(function(z,$,te,le){Co(z,$-1,te-10,2,20,le),Co(z,$-10,te-1,20,2,le)})(C,F.x,C.transform.height-F.y,bl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let o=this.terrainFacilitator.dirty;o||(o=e?!c.a_(n,a):!c.a$(n,a)),o||(o=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),o&&(c.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,I){const w=h.context,C=w.gl,M=Zi.unblended,F=new fi(C.LEQUAL,fi.ReadWrite,[0,1]),z=I.getTerrainMesh(),$=I.sourceCache.getRenderableTiles(),te=h.useProgram("terrainDepth");w.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),w.clear({color:c.aM.transparent,depth:1});for(const le of $){const m=I.getTerrainData(le.tileID),g={u_matrix:h.transform.calculatePosMatrix(le.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(h.transform.zoom)};te.draw(w,C.TRIANGLES,F,Ui.disabled,M,Fi.backCCW,g,m,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,I){const w=h.context,C=w.gl,M=Zi.unblended,F=new fi(C.LEQUAL,fi.ReadWrite,[0,1]),z=I.getTerrainMesh(),$=I.getCoordsTexture(),te=I.sourceCache.getRenderableTiles(),le=h.useProgram("terrainCoords");w.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),w.clear({color:c.aM.transparent,depth:1}),I.coordsIndex=[];for(const m of te){const g=I.getTerrainData(m.tileID);w.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,$.texture);const A={u_matrix:h.transform.calculatePosMatrix(m.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(h.transform.zoom)};le.draw(w,C.TRIANGLES,F,Ui.disabled,M,Fi.backCCW,A,g,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),I.coordsIndex.push(m.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,o){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(o||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,I,w,C,M){if(h.renderPass!=="translucent")return;const F=Ui.disabled,z=h.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,te,le,m,g,A,v,x,k){const P=te.transform,S=Ps(),V=g==="map",U=A==="map";for(const q of $){const re=m.getTile(q),Z=re.getBucket(le);if(!Z||!Z.text||!Z.text.segments.get().length)continue;const N=c.ag(Z.textSizeData,P.zoom),se=yi(re,1,te.transform.zoom),ce=Zn(q.posMatrix,U,V,te.transform,se),ae=le.layout.get("icon-text-fit")!=="none"&&Z.hasIconData();if(N){const Ae=Math.pow(2,P.zoom-re.tileID.overscaledZ),ve=te.style.map.terrain?(ke,K)=>te.style.map.terrain.getElevation(q,ke,K):null,Ie=S.translatePosition(P,re,v,x);Bs(Z,V,U,k,P,ce,q.posMatrix,Ae,N,ae,S,Ie,q.toUnwrapped(),ve)}}}(C,h,w,I,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),M),w.paint.get("icon-opacity").constantOr(1)!==0&&bo(h,I,w,C,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),F,z),w.paint.get("text-opacity").constantOr(1)!==0&&bo(h,I,w,C,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),F,z),I.map.showCollisionBoxes&&(Gn(h,I,w,C,!0),Gn(h,I,w,C,!1))})(e,n,a,o,this.style.placement.variableOffsets);break;case"circle":(function(h,I,w,C){if(h.renderPass!=="translucent")return;const M=w.paint.get("circle-opacity"),F=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),$=!w.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(F.constantOr(1)===0||z.constantOr(1)===0))return;const te=h.context,le=te.gl,m=h.depthModeForSublayer(0,fi.ReadOnly),g=Ui.disabled,A=h.colorModeForRenderPass(),v=[];for(let x=0;x<C.length;x++){const k=C[x],P=I.getTile(k),S=P.getBucket(w);if(!S)continue;const V=S.programConfigurations.get(w.id),U=h.useProgram("circle",V),q=S.layoutVertexBuffer,re=S.indexBuffer,Z=h.style.map.terrain&&h.style.map.terrain.getTerrainData(k),N={programConfiguration:V,program:U,layoutVertexBuffer:q,indexBuffer:re,uniformValues:Ol(h,k,P,w),terrainData:Z};if($){const se=S.segments.get();for(const ce of se)v.push({segments:new c.a0([ce]),sortKey:ce.sortKey,state:N})}else v.push({segments:S.segments,sortKey:0,state:N})}$&&v.sort((x,k)=>x.sortKey-k.sortKey);for(const x of v){const{programConfiguration:k,program:P,layoutVertexBuffer:S,indexBuffer:V,uniformValues:U,terrainData:q}=x.state;P.draw(te,le.TRIANGLES,m,g,A,Fi.disabled,U,q,w.id,S,V,x.segments,w.paint,h.transform.zoom,k)}})(e,n,a,o);break;case"heatmap":(function(h,I,w,C){if(w.paint.get("heatmap-opacity")===0)return;const M=h.context;if(h.style.map.terrain){for(const F of C){const z=I.getTile(F);I.hasRenderableParent(F)||(h.renderPass==="offscreen"?Ha(h,z,w,F):h.renderPass==="translucent"&&Cs(h,w,F))}M.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(F,z,$,te){const le=F.context,m=le.gl,g=Ui.disabled,A=new Zi([m.ONE,m.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(v,x,k){const P=v.gl;v.activeTexture.set(P.TEXTURE1),v.viewport.set([0,0,x.width/4,x.height/4]);let S=k.heatmapFbos.get(c.aU);S?(P.bindTexture(P.TEXTURE_2D,S.colorAttachment.get()),v.bindFramebuffer.set(S.framebuffer)):(S=wa(v,x.width/4,x.height/4),k.heatmapFbos.set(c.aU,S))})(le,F,$),le.clear({color:c.aM.transparent});for(let v=0;v<te.length;v++){const x=te[v];if(z.hasRenderableParent(x))continue;const k=z.getTile(x),P=k.getBucket($);if(!P)continue;const S=P.programConfigurations.get($.id),V=F.useProgram("heatmap",S),{zoom:U}=F.transform;V.draw(le,m.TRIANGLES,fi.disabled,g,A,Fi.disabled,Lr(x.posMatrix,k,U,$.paint.get("heatmap-intensity")),null,$.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,$.paint,F.transform.zoom,S)}le.viewport.set([0,0,F.width,F.height])}(h,I,w,C):h.renderPass==="translucent"&&function(F,z){const $=F.context,te=$.gl;$.setColorMode(F.colorModeForRenderPass());const le=z.heatmapFbos.get(c.aU);le&&($.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,le.colorAttachment.get()),$.activeTexture.set(te.TEXTURE1),va($,z).bind(te.LINEAR,te.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw($,te.TRIANGLES,fi.disabled,Ui.disabled,F.colorModeForRenderPass(),Fi.disabled,Ga(F,z,0,1),null,z.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,z.paint,F.transform.zoom))}(h,w)})(e,n,a,o);break;case"line":(function(h,I,w,C){if(h.renderPass!=="translucent")return;const M=w.paint.get("line-opacity"),F=w.paint.get("line-width");if(M.constantOr(1)===0||F.constantOr(1)===0)return;const z=h.depthModeForSublayer(0,fi.ReadOnly),$=h.colorModeForRenderPass(),te=w.paint.get("line-dasharray"),le=w.paint.get("line-pattern"),m=le.constantOr(1),g=w.paint.get("line-gradient"),A=w.getCrossfadeParameters(),v=m?"linePattern":te?"lineSDF":g?"lineGradient":"line",x=h.context,k=x.gl;let P=!0;for(const S of C){const V=I.getTile(S);if(m&&!V.patternsLoaded())continue;const U=V.getBucket(w);if(!U)continue;const q=U.programConfigurations.get(w.id),re=h.context.program.get(),Z=h.useProgram(v,q),N=P||Z.program!==re,se=h.style.map.terrain&&h.style.map.terrain.getTerrainData(S),ce=le.constantOr(null);if(ce&&V.imageAtlas){const ve=V.imageAtlas,Ie=ve.patternPositions[ce.to.toString()],ke=ve.patternPositions[ce.from.toString()];Ie&&ke&&q.setConstantPatternPositions(Ie,ke)}const ae=se?S:null,Ae=m?ga(h,V,w,A,ae):te?Ic(h,V,w,te,A,ae):g?ql(h,V,w,U.lineClipsArray.length,ae):Ua(h,V,w,ae);if(m)x.activeTexture.set(k.TEXTURE0),V.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),q.updatePaintBuffers(A);else if(te&&(N||h.lineAtlas.dirty))x.activeTexture.set(k.TEXTURE0),h.lineAtlas.bind(x);else if(g){const ve=U.gradients[w.id];let Ie=ve.texture;if(w.gradientVersion!==ve.version){let ke=256;if(w.stepInterpolant){const K=I.getSource().maxzoom,G=S.canonical.z===K?Math.ceil(1<<h.transform.maxZoom-S.canonical.z):1;ke=c.ac(c.aV(U.maxLineLength/c.X*1024*G),256,x.maxTextureSize)}ve.gradient=c.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:ke,image:ve.gradient||void 0,clips:U.lineClipsArray}),ve.texture?ve.texture.update(ve.gradient):ve.texture=new Qt(x,ve.gradient,k.RGBA),ve.version=w.gradientVersion,Ie=ve.texture}x.activeTexture.set(k.TEXTURE0),Ie.bind(w.stepInterpolant?k.NEAREST:k.LINEAR,k.CLAMP_TO_EDGE)}Z.draw(x,k.TRIANGLES,z,h.stencilModeForClipping(S),$,Fi.disabled,Ae,se,w.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,w.paint,h.transform.zoom,q,U.layoutVertexBuffer2),P=!1}})(e,n,a,o);break;case"fill":(function(h,I,w,C){const M=w.paint.get("fill-color"),F=w.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const z=h.colorModeForRenderPass(),$=w.paint.get("fill-pattern"),te=h.opaquePassEnabledForLayer()&&!$.constantOr(1)&&M.constantOr(c.aM.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===te){const le=h.depthModeForSublayer(1,h.renderPass==="opaque"?fi.ReadWrite:fi.ReadOnly);ja(h,I,w,C,le,z,!1)}if(h.renderPass==="translucent"&&w.paint.get("fill-antialias")){const le=h.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,fi.ReadOnly);ja(h,I,w,C,le,z,!0)}})(e,n,a,o);break;case"fill-extrusion":(function(h,I,w,C){const M=w.paint.get("fill-extrusion-opacity");if(M!==0&&h.renderPass==="translucent"){const F=new fi(h.context.gl.LEQUAL,fi.ReadWrite,h.depthRangeFor3D);if(M!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))vo(h,I,w,C,F,Ui.disabled,Zi.disabled),vo(h,I,w,C,F,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const z=h.colorModeForRenderPass();vo(h,I,w,C,F,Ui.disabled,z)}}})(e,n,a,o);break;case"hillshade":(function(h,I,w,C){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const M=h.context,F=h.depthModeForSublayer(0,fi.ReadOnly),z=h.colorModeForRenderPass(),[$,te]=h.renderPass==="translucent"?h.stencilConfigForOverlap(C):[{},C];for(const le of te){const m=I.getTile(le);m.needsHillshadePrepare!==void 0&&m.needsHillshadePrepare&&h.renderPass==="offscreen"?Vs(h,m,w,F,Ui.disabled,z):h.renderPass==="translucent"&&xa(h,le,m,w,F,$[le.overscaledZ],z)}M.viewport.set([0,0,h.width,h.height])})(e,n,a,o);break;case"raster":(function(h,I,w,C){if(h.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!C.length)return;const M=h.context,F=M.gl,z=I.getSource(),$=h.useProgram("raster"),te=h.colorModeForRenderPass(),[le,m]=z instanceof Jr?[{},C]:h.stencilConfigForOverlap(C),g=m[m.length-1].overscaledZ,A=!h.options.moving;for(const v of m){const x=h.depthModeForSublayer(v.overscaledZ-g,w.paint.get("raster-opacity")===1?fi.ReadWrite:fi.ReadOnly,F.LESS),k=I.getTile(v);k.registerFadeDuration(w.paint.get("raster-fade-duration"));const P=I.findLoadedParent(v,0),S=I.findLoadedSibling(v),V=Il(k,P||S||null,I,w,h.transform,h.style.map.terrain);let U,q;const re=w.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;M.activeTexture.set(F.TEXTURE0),k.texture.bind(re,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(F.TEXTURE1),P?(P.texture.bind(re,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),U=Math.pow(2,P.tileID.overscaledZ-k.tileID.overscaledZ),q=[k.tileID.canonical.x*U%1,k.tileID.canonical.y*U%1]):k.texture.bind(re,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),k.texture.useMipmap&&M.extTextureFilterAnisotropic&&h.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Z=h.style.map.terrain&&h.style.map.terrain.getTerrainData(v),N=Z?v:null,se=N?N.posMatrix:h.transform.calculatePosMatrix(v.toUnwrapped(),A),ce=Vl(se,q||[0,0],U||1,V,w);z instanceof Jr?$.draw(M,F.TRIANGLES,x,Ui.disabled,te,Fi.disabled,ce,Z,w.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments):$.draw(M,F.TRIANGLES,x,le[v.overscaledZ],te,Fi.disabled,ce,Z,w.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,a,o);break;case"background":(function(h,I,w,C){const M=w.paint.get("background-color"),F=w.paint.get("background-opacity");if(F===0)return;const z=h.context,$=z.gl,te=h.transform,le=te.tileSize,m=w.paint.get("background-pattern");if(h.isPatternMissing(m))return;const g=!m&&M.a===1&&F===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==g)return;const A=Ui.disabled,v=h.depthModeForSublayer(0,g==="opaque"?fi.ReadWrite:fi.ReadOnly),x=h.colorModeForRenderPass(),k=h.useProgram(m?"backgroundPattern":"background"),P=C||te.coveringTiles({tileSize:le,terrain:h.style.map.terrain});m&&(z.activeTexture.set($.TEXTURE0),h.imageManager.bind(h.context));const S=w.getCrossfadeParameters();for(const V of P){const U=C?V.posMatrix:h.transform.calculatePosMatrix(V.toUnwrapped()),q=m?ws(U,F,h,m,{tileID:V,tileSize:le},S):zs(U,F,M),re=h.style.map.terrain&&h.style.map.terrain.getTerrainData(V);k.draw(z,$.TRIANGLES,v,A,x,Fi.disabled,q,re,w.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,a,o);break;case"custom":(function(h,I,w){const C=h.context,M=w.implementation;if(h.renderPass==="offscreen"){const F=M.prerender;F&&(h.setCustomLayerDefaults(),C.setColorMode(h.colorModeForRenderPass()),F.call(M,C.gl,h.transform.customLayerMatrix()),C.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),C.setColorMode(h.colorModeForRenderPass()),C.setStencilMode(Ui.disabled);const F=M.renderingMode==="3d"?new fi(h.context.gl.LEQUAL,fi.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,fi.ReadOnly);C.setDepthMode(F),M.render(C.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),C.setDirty(),h.setBaseState(),C.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,o,h){if(!a[0]&&!a[1])return e;const I=h?o==="map"?this.transform.angle:0:o==="viewport"?-this.transform.angle:0;if(I){const M=Math.sin(I),F=Math.cos(I);a=[a[0]*F-a[1]*M,a[0]*M+a[1]*F]}const w=[h?a[0]:yi(n,a[0],this.transform.zoom),h?a[1]:yi(n,a[1],this.transform.zoom),0],C=new Float32Array(16);return c.J(C,e,w),C}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new co(this.context,$r[e],n,Gs[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Qt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class Ca{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const o=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const C=1/(w=c.af([],w,e))[3]/n*o;return c.b1(w,w,[C,C,1/w[3],C])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const C=function($,te){var le=te[0],m=te[1],g=te[2],A=le*le+m*m+g*g;return A>0&&(A=1/Math.sqrt(A)),$[0]=te[0]*A,$[1]=te[1]*A,$[2]=te[2]*A,$}([],function($,te,le){var m=te[0],g=te[1],A=te[2],v=le[0],x=le[1],k=le[2];return $[0]=g*k-A*x,$[1]=A*v-m*k,$[2]=m*x-g*v,$}([],yt([],h[w[0]],h[w[1]]),yt([],h[w[2]],h[w[1]]))),M=-((F=C)[0]*(z=h[w[1]])[0]+F[1]*z[1]+F[2]*z[2]);var F,z;return C.concat(M)});return new Ca(h,I)}}class Nn{constructor(e,n){this.min=e,this.max=n,this.center=function(a,o,h){return a[0]=.5*o[0],a[1]=.5*o[1],a[2]=.5*o[2],a}([],function(a,o,h){return a[0]=o[0]+h[0],a[1]=o[1]+h[1],a[2]=o[2]+h[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=lt(this.min),o=lt(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],o[h]=n[h]?this.center[h]:this.max[h];return o[2]=this.max[2],new Nn(a,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let o=0;o<e.planes.length;o++){const h=e.planes[o];let I=0;for(let w=0;w<n.length;w++)c.b2(h,n[w])>=0&&I++;if(I===0)return 0;I!==n.length&&(a=!1)}if(a)return 2;for(let o=0;o<3;o++){let h=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const C=e.points[w][o]-this.min[o];h=Math.min(h,C),I=Math.max(I,C)}if(I<0||h>this.max[o]-this.min[o])return 0}return 1}}class is{constructor(e=0,n=0,a=0,o=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=o}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=c.ac((this.left+e-this.right)/2,0,e),o=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(a,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new is(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ea=85.051129;class rs{constructor(e,n,a,o,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=o??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new is,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new rs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,o,h){var I=o[0],w=o[1],C=o[2],M=o[3],F=Math.sin(h),z=Math.cos(h);a[0]=I*z+C*F,a[1]=w*z+M*F,a[2]=I*-F+C*z,a[3]=w*-F+M*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),o=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),I=this.pointCoordinate(new c.P(0,this.height)),w=Math.floor(Math.min(a.x,o.x,h.x,I.x)),C=Math.floor(Math.max(a.x,o.x,h.x,I.x)),M=1;for(let F=w-M;F<=C+M;F++)F!==0&&n.push(new c.b4(F,e))}return n}coveringTiles(e){var n,a;let o=this.coveringZoomLevel(e);const h=o;if(e.minzoom!==void 0&&o<e.minzoom)return[];e.maxzoom!==void 0&&o>e.maxzoom&&(o=e.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),w=c.Z.fromLngLat(this.center),C=Math.pow(2,o),M=[C*I.x,C*I.y,0],F=[C*w.x,C*w.y,0],z=Ca.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,o);let $=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=o);const te=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,le=x=>({aabb:new Nn([x*C,0,0],[(x+1)*C,C,0]),zoom:0,x:0,y:0,wrap:x,fullyVisible:!1}),m=[],g=[],A=o,v=e.reparseOverscaled?h:o;if(this._renderWorldCopies)for(let x=1;x<=3;x++)m.push(le(-x)),m.push(le(x));for(m.push(le(0));m.length>0;){const x=m.pop(),k=x.x,P=x.y;let S=x.fullyVisible;if(!S){const Z=x.aabb.intersects(z);if(Z===0)continue;S=Z===2}const V=e.terrain?M:F,U=x.aabb.distanceX(V),q=x.aabb.distanceY(V),re=Math.max(Math.abs(U),Math.abs(q));if(x.zoom===A||re>te+(1<<A-x.zoom)-2&&x.zoom>=$){const Z=A-x.zoom,N=M[0]-.5-(k<<Z),se=M[1]-.5-(P<<Z);g.push({tileID:new c.S(x.zoom===A?v:x.zoom,x.wrap,x.zoom,k,P),distanceSq:Pt([F[0]-.5-k,F[1]-.5-P]),tileDistanceToCamera:Math.sqrt(N*N+se*se)})}else for(let Z=0;Z<4;Z++){const N=(k<<1)+Z%2,se=(P<<1)+(Z>>1),ce=x.zoom+1;let ae=x.aabb.quadrant(Z);if(e.terrain){const Ae=new c.S(ce,x.wrap,ce,N,se),ve=e.terrain.getMinMaxElevation(Ae),Ie=(n=ve.minElevation)!==null&&n!==void 0?n:this.elevation,ke=(a=ve.maxElevation)!==null&&a!==void 0?a:this.elevation;ae=new Nn([ae.min[0],ae.min[1],Ie],[ae.max[0],ae.max[1],ke])}m.push({aabb:ae,zoom:ce,x:N,y:se,wrap:x.wrap,fullyVisible:S})}}return g.sort((x,k)=>x.distanceSq-k.distanceSq).map(x=>x.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=c.ac(e.lat,-85.051129,Ea);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,o=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-h))return;const I=a+n-h,w=Math.cos(this._pitch)*this.cameraToCenterDistance/I/c.b5(1,o.lat),C=this.scaleZoom(w/this.tileSize);this._elevation=h,this._center=o,this.zoom=C}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),o=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),I=new c.Z(h.x-(a.x-o.x),h.y-(a.y-o.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const $=n.pointCoordinate(e);if($!=null)return $}const a=[e.x,e.y,0,1],o=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(o,o,this.pixelMatrixInverse);const h=a[3],I=o[3],w=a[1]/h,C=o[1]/I,M=a[2]/h,F=o[2]/I,z=M===F?0:(0-M)/(F-M);return new c.Z(c.y.number(a[0]/h,o[0]/I,z)/this.worldSize,c.y.number(w,C,z)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const o=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(o,o,a),new c.P(o[0]/o[3],o[1]/o[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Ne().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ea])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),o=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[o*a,n.y*a,0]),c.K(h,h,[a/c.X,a/c.X,1]),h}calculatePosMatrix(e,n=!1){const a=e.key,o=n?this._alignedPosMatrixCache:this._posMatrixCache;if(o[a])return o[a];const h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),o[a]=new Float32Array(h),o[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const o=this.calculateTileMatrix(e);return c.L(o,this.fogMatrix,o),a[n]=new Float32Array(o),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:n};let o=this.lngRange;if(!this._renderWorldCopies&&o===null){const x=179.9999999999;o=[-x,x]}const h=this.tileSize*this.zoomScale(a.zoom);let I=0,w=h,C=0,M=h,F=0,z=0;const{x:$,y:te}=this.size;if(this.latRange){const x=this.latRange;I=c.Q(x[1])*h,w=c.Q(x[0])*h,w-I<te&&(F=te/(w-I))}o&&(C=c.b3(c.O(o[0])*h,0,h),M=c.b3(c.O(o[1])*h,0,h),M<C&&(M+=h),M-C<$&&(z=$/(M-C)));const{x:le,y:m}=this.project.call({worldSize:h},e);let g,A;const v=Math.max(z||0,F||0);if(v){const x=new c.P(z?(M+C)/2:le,F?(w+I)/2:m);return a.center=this.unproject.call({worldSize:h},x).wrap(),a.zoom+=this.scaleZoom(v),a}if(this.latRange){const x=te/2;m-x<I&&(A=I+x),m+x>w&&(A=w-x)}if(o){const x=(C+M)/2;let k=le;this._renderWorldCopies&&(k=c.b3(le,x-h/2,x+h/2));const P=$/2;k-P<C&&(g=C+P),k+P>M&&(g=M-P)}if(g!==void 0||A!==void 0){const x=new c.P(g??le,A??m);a.center=this.unproject.call({worldSize:h},x).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let o=c.an(new Float64Array(16));c.K(o,o,[this.width/2,-this.height/2,1]),c.J(o,o,[1,-1,0]),this.labelPlaneMatrix=o,o=c.an(new Float64Array(16)),c.K(o,o,[1,-1,1]),c.J(o,o,[-1,-1,0]),c.K(o,o,[2/this.width,2/this.height,1]),this.glCoordMatrix=o;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this.minElevationForCurrentTile),w=h-I*this._pixelPerMeter/Math.cos(this._pitch),C=I<0?w:h,M=Math.PI/2+this._pitch,F=this._fov*(.5+e.y/this.height),z=Math.sin(F)*C/Math.sin(c.ac(Math.PI-M-F,.01,Math.PI-.01)),$=this.getHorizon(),te=2*Math.atan($/this.cameraToCenterDistance)*(.5+e.y/(2*$)),le=Math.sin(te)*C/Math.sin(c.ac(Math.PI-M-te,.01,Math.PI-.01)),m=Math.min(z,le);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*m+C),this.nearZ=this.height/50,o=new Float64Array(16),c.b6(o,this._fov,this.width/this.height,this.nearZ,this.farZ),o[8]=2*-e.x/this.width,o[9]=2*e.y/this.height,this.projectionMatrix=c.ae(o),c.K(o,o,[1,-1,1]),c.J(o,o,[0,0,-this.cameraToCenterDistance]),c.b7(o,o,this._pitch),c.ad(o,o,this.angle),c.J(o,o,[-n,-a,0]),this.mercatorMatrix=c.K([],o,[this.worldSize,this.worldSize,this.worldSize]),c.K(o,o,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,o),c.J(o,o,[0,0,-this.elevation]),this.modelViewProjectionMatrix=o,this.invModelViewProjectionMatrix=c.as([],o),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,o);const g=this.width%2/2,A=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),k=n-Math.round(n)+v*g+x*A,P=a-Math.round(a)+v*A+x*g,S=new Float64Array(o);if(c.J(S,S,[k>.5?k-1:k,P>.5?P-1:P,0]),this.alignedModelViewProjectionMatrix=S,o=c.as(new Float64Array(16),this.pixelMatrix),!o)throw new Error("failed to invert matrix");this.pixelMatrixInverse=o,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,o=n.y,h=n.x,I=n.y;for(const w of e)a=Math.min(a,w.x),o=Math.min(o,w.y),h=Math.max(h,w.x),I=Math.max(I,w.y);return[new c.P(a,o),new c.P(h,o),new c.P(h,I),new c.P(a,I),new c.P(a,o)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),o=[a.x*this.worldSize,a.y*this.worldSize,n,1];return c.af(o,o,this.modelViewProjectionMatrix),o[2]/o[3]}}function Es(u,e){let n,a=!1,o=null,h=null;const I=()=>{o=null,a&&(u.apply(h,n),o=setTimeout(I,e),a=!1)};return(...w)=>(a=!0,h=this,n=w,o||I(),o)}class Hs{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(a=o)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let o=a;o.split("&").length>0&&(o=o.split("&")[0]),this._hashName&&(o=`${this._hashName}=${a}`);let h=window.location.hash.replace(o,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let I=window.location.href.replace(/(#.+)?$/,h);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Es(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,o=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,o),I=Math.round(n.lng*h)/h,w=Math.round(n.lat*h)/h,C=this._map.getBearing(),M=this._map.getPitch();let F="";if(F+=e?`/${I}/${w}/${a}`:`${a}/${w}/${I}`,(C||M)&&(F+="/"+Math.round(10*C)/10),M&&(F+=`/${Math.round(M)}`),this._hashName){const z=this._hashName;let $=!1;const te=window.location.hash.slice(1).split("&").map(le=>{const m=le.split("=")[0];return m===z?($=!0,`${m}=${F}`):le}).filter(le=>le);return $||te.push(`${z}=${F}`),`#${te.join("&")}`}return`#${F}`}}const js={linearity:.3,easing:c.b8(0,0,.3,1)},Qs=c.e({deceleration:2500,maxSpeed:1400},js),ko=c.e({deceleration:20,maxSpeed:1400},js),wl=c.e({deceleration:1e3,maxSpeed:360},js),So=c.e({deceleration:1e3,maxSpeed:90},js);class vl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:me.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=me.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(n.pan.mag()){const h=Ya(n.pan.mag(),a,c.e({},Qs,e||{}));o.offset=n.pan.mult(h.amount/n.pan.mag()),o.center=this._map.transform.center,Ja(o,h)}if(n.zoom){const h=Ya(n.zoom,a,ko);o.zoom=this._map.transform.zoom+h.amount,Ja(o,h)}if(n.bearing){const h=Ya(n.bearing,a,wl);o.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),Ja(o,h)}if(n.pitch){const h=Ya(n.pitch,a,So);o.pitch=this._map.transform.pitch+h.amount,Ja(o,h)}if(o.zoom||o.bearing){const h=n.pinchAround===void 0?n.around:n.pinchAround;o.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(o,{noMoveStart:!0})}}function Ja(u,e){(!u.duration||u.duration<e.duration)&&(u.duration=e.duration,u.easing=e.easing)}function Ya(u,e,n){const{maxSpeed:a,linearity:o,deceleration:h}=n,I=c.ac(u*o/(e/1e3),-a,a),w=Math.abs(I)/(h*o);return{easing:n.easing,duration:1e3*w,amount:I*(w/2)}}class tr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,o={}){const h=he.mousePos(n.getCanvas(),a),I=n.unproject(h);super(e,c.e({point:h,lngLat:I,originalEvent:a},o)),this._defaultPrevented=!1,this.target=n}}class Js extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const o=e==="touchend"?a.changedTouches:a.touches,h=he.touchPos(n.getCanvasContainer(),o),I=h.map(C=>n.unproject(C)),w=h.reduce((C,M,F,z)=>C.add(M.div(z.length)),new c.P(0,0));super(e,{points:h,point:w,lngLats:I,lngLat:n.unproject(w),originalEvent:a}),this._defaultPrevented=!1}}class Zl extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class $l{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Zl(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new tr(e.type,this._map,e))}mouseup(e){this._map.fire(new tr(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new tr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new tr(e.type,this._map,e))}mouseover(e){this._map.fire(new tr(e.type,this._map,e))}mouseout(e){this._map.fire(new tr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Js(e.type,this._map,e))}touchmove(e){this._map.fire(new Js(e.type,this._map,e))}touchend(e){this._map.fire(new Js(e.type,this._map,e))}touchcancel(e){this._map.fire(new Js(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new tr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new tr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Xr{constructor(e,n){this._map=e,this._tr=new Bn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(he.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const o=this._startPos;this._lastPos=a,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(o.x,a.x),I=Math.max(o.x,a.x),w=Math.min(o.y,a.y),C=Math.max(o.y,a.y);he.setTransform(this._box,`translate(${h}px,${w}px)`),this._box.style.width=I-h+"px",this._box.style.height=C-w+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,o=n;if(this.reset(),he.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function Ka(u,e){if(u.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${e.length}`);const n={};for(let a=0;a<u.length;a++)n[u[a].identifier]=e[a];return n}class Za{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(o){const h=new c.P(0,0);for(const I of o)h._add(I);return h.div(o.length)}(n),this.touches=Ka(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const o=Ka(a,n);for(const h in this.touches){const I=o[h];(!I||I.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const o=!this.aborted&&this.centroid;if(this.reset(),o)return o}}}class Do{constructor(e){this.singleTap=new Za(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const o=this.singleTap.touchend(e,n,a);if(o){const h=e.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(o)<30;if(h&&I||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class kr{constructor(e){this._tr=new Bn(e),this._zoomIn=new Do({numTouches:1,numTaps:2}),this._zoomOut=new Do({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const o=this._zoomIn.touchend(e,n,a),h=this._zoomOut.touchend(e,n,a),I=this._tr;return o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(o)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const o=n.length?n[0]:n;return!this._moved&&o.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=o,this._move(a,o))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&he.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Mo={0:1,2:2};class To{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=he.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const o=Mo[a];return n.buttons===void 0||(n.buttons&o)!==o}(e,this._eventButton)}isValidEndEvent(e){return he.mouseButton(e)===this._eventButton}}class Po{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const $a=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=e=>{e.preventDefault()}},Ys=({enable:u,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new To({checkCorrectEvent:o=>he.mouseButton(o)===0&&o.ctrlKey||he.mouseButton(o)===2});return new Cn({clickTolerance:e,move:(o,h)=>({bearingDelta:(h.x-o.x)*n}),moveStateManager:a,enable:u,assignEvents:$a})},Wa=({enable:u,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new To({checkCorrectEvent:o=>he.mouseButton(o)===0&&o.ctrlKey||he.mouseButton(o)===2});return new Cn({clickTolerance:e,move:(o,h)=>({pitchDelta:(h.y-o.y)*n}),moveStateManager:a,enable:u,assignEvents:$a})};class Ks{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const o=Ka(a,n),h=new c.P(0,0),I=new c.P(0,0);let w=0;for(const M in o){const F=o[M],z=this._touches[M];z&&(h._add(F),I._add(F.sub(z)),w++,o[M]=F)}if(this._touches=o,this._shouldBePrevented(w)||!I.mag())return;const C=I.div(w);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(w),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[o,h]=this._firstTwoTouches,I=Xa(a,n,o),w=Xa(a,n,h);if(!I||!w)return;const C=this._aroundCenter?null:I.add(w).div(2);return this._move([I,w],C,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[o,h]=this._firstTwoTouches,I=Xa(a,n,o),w=Xa(a,n,h);I&&w||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Xa(u,e,n){for(let a=0;a<u.length;a++)if(u[a].identifier===n)return e[a]}function Qa(u,e){return Math.log(u/e)/Math.LN2}class xl extends Zs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Qa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qa(this._distance,a),pinchAround:n}}}function Bl(u,e){return 180*u.angleWith(e)/Math.PI}class Cl extends Zs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const o=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bl(this._vector,o),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Bl(e,this._startVector);return Math.abs(a)<n}}function Lo(u){return Math.abs(u.y)>Math.abs(u.x)}class ns extends Zs{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,Lo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const o=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(o,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const o=e.mag()>=2,h=n.mag()>=2;if(!o&&!h)return;if(!o||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const I=e.y>0==n.y>0;return Lo(e)&&Lo(n)&&I}}const El={panStep:100,bearingStep:15,pitchStep:10};class un{constructor(e){this._tr=new Bn(e);const n=El;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,o=0,h=0,I=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),I=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(a=0,o=0),{cameraAnimation:w=>{const C=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:en,zoom:n?Math.round(C.zoom)+n*(e.shiftKey?2:1):C.zoom,bearing:C.bearing+a*this._bearingStep,pitch:C.pitch+o*this._pitchStep,offset:[-h*this._panStep,-I*this._panStep],center:C.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function en(u){return u*(2-u)}const ss=4.000244140625;class En{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new Bn(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=me.now(),o=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%ss==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(o*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=he.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(n)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>ss?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&M!==0&&(M=1/M);const F=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(F*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,o=this._easing;let h,I=!1;const w=me.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&o&&w){const C=Math.min(w/200,1),M=o(C);h=c.y.number(a,n,M),C<1?this._frameId||(this._frameId=!0):I=!0}else h=n,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){const a=this._prevEase,o=(me.now()-a.start)/a.duration,h=a.easing(o+.01)-a.easing(o),I=.27/Math.sqrt(h*h+1e-4)*.01,w=Math.sqrt(.0729-I*I);n=c.b8(I,w,.25,1)}return this._prevEase={start:me.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class $s{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class An{constructor(e){this._tr=new Bn(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl{constructor(){this._tap=new Do({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const o=n[0],h=e.timeStamp-this._tapTime<500,I=this._tapPoint.dist(o)<30;h&&I?a.length>0&&(this._swipePoint=o,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const o=n[0],h=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const o=this._tap.touchend(e,n,a);o&&(this._tapTime=e.timeStamp,this._tapPoint=o)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xl{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ro{constructor(e,n,a,o){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class as{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),o=document.createElement("div");o.className="maplibregl-desktop-message",o.textContent=n,this._container.appendChild(o);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Sr=u=>u.zoom||u.drag||u.pitch||u.rotate;class xt extends c.k{}function ka(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class eo{constructor(e,n){this.handleWindowEvent=o=>{this.handleEvent(o,`${o.type}Window`)},this.handleEvent=(o,h)=>{if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=o.type==="renderFrame"?void 0:o,w={needsRenderFrame:!1},C={},M={},F=o.touches,z=F?this._getMapTouches(F):void 0,$=z?he.touchPos(this._map.getCanvas(),z):he.mousePos(this._map.getCanvas(),o);for(const{handlerName:m,handler:g,allowed:A}of this._handlers){if(!g.isEnabled())continue;let v;this._blockedByActive(M,A,m)?g.reset():g[h||o.type]&&(v=g[h||o.type](o,$,z),this.mergeHandlerResult(w,C,v,m,I),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||g.isActive())&&(M[m]=g)}const te={};for(const m in this._previousActiveHandlers)M[m]||(te[m]=I);this._previousActiveHandlers=M,(Object.keys(te).length||ka(w))&&(this._changes.push([w,C,te]),this._triggerRenderFrame()),(Object.keys(M).length||ka(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:le}=w;le&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],le(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vl(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[o,h,I]of this._listeners)he.addEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[e,n,a]of this._listeners)he.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new $l(n,e));const o=n.boxZoom=new Xr(n,e);this._add("boxZoom",o),e.interactive&&e.boxZoom&&o.enable();const h=n.cooperativeGestures=new as(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const I=new kr(n),w=new An(n);n.doubleClickZoom=new $s(w,I),this._add("tapZoom",I),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const C=new Wl;this._add("tapDragZoom",C);const M=n.touchPitch=new ns(n);this._add("touchPitch",M),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const F=Ys(e),z=Wa(e);n.dragRotate=new Xl(e,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const $=(({enable:v,clickTolerance:x})=>{const k=new To({checkCorrectEvent:P=>he.mouseButton(P)===0&&!P.ctrlKey});return new Cn({clickTolerance:x,move:(P,S)=>({around:S,panDelta:S.sub(P)}),activateOnStart:!0,moveStateManager:k,enable:v,assignEvents:$a})})(e),te=new Ks(e,n);n.dragPan=new Ql(a,$,te),this._add("mousePan",$),this._add("touchPan",te,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const le=new Cl,m=new xl;n.touchZoomRotate=new Ro(a,m,le,C),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",m,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const g=n.scrollZoom=new En(n,()=>this._triggerRenderFrame());this._add("scrollZoom",g,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const A=n.keyboard=new un(n);this._add("keyboard",A),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Wi(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Sr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const o in e)if(o!==a&&(!n||n.indexOf(o)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,o,h){if(!a)return;c.e(e,a);const I={handlerName:o,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(n.zoom=I),a.panDelta!==void 0&&(n.drag=I),a.pitchDelta!==void 0&&(n.pitch=I),a.bearingDelta!==void 0&&(n.rotate=I)}_applyChanges(){const e={},n={},a={};for(const[o,h,I]of this._changes)o.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(o.panDelta)),o.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+o.pitchDelta),o.around!==void 0&&(e.around=o.around),o.pinchAround!==void 0&&(e.pinchAround=o.pinchAround),o.noInertia&&(e.noInertia=o.noInertia),c.e(n,h),c.e(a,I);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const o=this._map,h=o._getTransformForUpdate(),I=o.terrain;if(!(ka(e)||I&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:w,zoomDelta:C,bearingDelta:M,pitchDelta:F,around:z,pinchAround:$}=e;$!==void 0&&(z=$),o._stop(!0),z=z||o.transform.centerPoint;const te=h.pointLocation(w?z.sub(w):z);M&&(h.bearing+=M),F&&(h.pitch+=F),C&&(h.zoom+=C),I?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(w)):h.setLocationAtPoint(te,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(te,z)):h.setLocationAtPoint(te,z),o._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const o=Sr(this._eventsInProgress),h=Sr(e),I={};for(const z in e){const{originalEvent:$}=e[z];this._eventsInProgress[z]||(I[`${z}start`]=$),this._eventsInProgress[z]=e[z]}!o&&h&&this._fireEvent("movestart",h.originalEvent);for(const z in I)this._fireEvent(z,I[z]);h&&this._fireEvent("move",h.originalEvent);for(const z in e){const{originalEvent:$}=e[z];this._fireEvent(z,$)}const w={};let C;for(const z in this._eventsInProgress){const{handlerName:$,originalEvent:te}=this._eventsInProgress[z];this._handlersById[$].isActive()||(delete this._eventsInProgress[z],C=n[$]||te,w[`${z}end`]=C)}for(const z in w)this._fireEvent(z,w[z]);const M=Sr(this._eventsInProgress),F=(o||h)&&!M;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;!z||!z.essential&&me.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:C})),$(this._map.getBearing())&&this._map.resetNorth()):($(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:C})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new xt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class to extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((me.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(c.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(c.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(c.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Ne.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,o){const h={top:0,bottom:0,right:0,left:0};if(typeof(o=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const Z=o.padding;o.padding={top:Z,bottom:Z,right:Z,left:Z}}o.padding=c.e(h,o.padding);const I=this.transform,w=I.padding,C=new Ne(e,n),M=I.project(C.getNorthWest()),F=I.project(C.getNorthEast()),z=I.project(C.getSouthEast()),$=I.project(C.getSouthWest()),te=c.ba(-a),le=M.rotate(te),m=F.rotate(te),g=z.rotate(te),A=$.rotate(te),v=new c.P(Math.max(le.x,m.x,A.x,g.x),Math.max(le.y,m.y,A.y,g.y)),x=new c.P(Math.min(le.x,m.x,A.x,g.x),Math.min(le.y,m.y,A.y,g.y)),k=v.sub(x),P=(I.width-(w.left+w.right+o.padding.left+o.padding.right))/k.x,S=(I.height-(w.top+w.bottom+o.padding.top+o.padding.bottom))/k.y;if(S<0||P<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const V=Math.min(I.scaleZoom(I.scale*Math.min(P,S)),o.maxZoom),U=c.P.convert(o.offset),q=new c.P((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(c.ba(a)),re=U.add(q).mult(I.scale/I.zoomScale(V));return{center:I.unproject(M.add(z).div(2).sub(re)),zoom:V,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,o,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),a,o),o,h)}_fitInternal(e,n,a){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let o=!1,h=!1,I=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(o=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(h=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(I=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),o&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),I&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,o=0){const h=c.Z.fromLngLat(e,n),I=c.Z.fromLngLat(a,o),w=I.x-h.x,C=I.y-h.y,M=I.z-h.z,F=Math.hypot(w,C,M);if(F===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,C),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),te=180*Math.atan2(w,-C)/Math.PI;let le=180*Math.acos(z/F)/Math.PI;return le=M<0?90-le:90+le,{center:I.toLngLat(),zoom:$,pitch:le,bearing:te}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&me.prefersReducedMotion)&&(e.duration=0);const o=this._getTransformForUpdate(),h=o.zoom,I=o.bearing,w=o.pitch,C=o.padding,M="bearing"in e?this._normalizeBearing(e.bearing,I):I,F="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:o.padding,$=c.P.convert(e.offset);let te=o.centerPoint.add($);const le=o.pointLocation(te),{center:m,zoom:g}=o.getConstrained(c.N.convert(e.center||le),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(m,o);const A=o.project(le),v=o.project(m).sub(A),x=o.zoomScale(g-h);let k,P;e.around&&(k=c.N.convert(e.around),P=o.locationPoint(k));const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||g!==h,this._rotating=this._rotating||I!==M,this._pitching=this._pitching||F!==w,this._padding=!o.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,S),this.terrain&&this._prepareElevation(m),this._ease(V=>{if(this._zooming&&(o.zoom=c.y.number(h,g,V)),this._rotating&&(o.bearing=c.y.number(I,M,V)),this._pitching&&(o.pitch=c.y.number(w,F,V)),this._padding&&(o.interpolatePadding(C,z,V),te=o.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(V),k)o.setLocationAtPoint(k,P);else{const U=o.zoomScale(o.zoom-h),q=g>h?Math.min(2,x):Math.max(.5,x),re=Math.pow(q,1-V),Z=o.unproject(A.add(v.mult(V*re)).mult(U));o.setLocationAtPoint(o.renderWorldCopies?Z.wrap():Z,te)}this._applyUpdatedTransform(o),this._fireMoveEvents(n)},V=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,V)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const o=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:o.pitch,zoom:o.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(o=>this._elevateCameraIfInsideTerrain(o)),this.transformCameraUpdate&&n.push(o=>this.transformCameraUpdate(o)),!n.length)return;const a=e.clone();for(const o of n){const h=a.clone(),{center:I,zoom:w,pitch:C,bearing:M,elevation:F}=o(h);I&&(h.center=I),w!==void 0&&(h.zoom=w),C!==void 0&&(h.pitch=C),M!==void 0&&(h.bearing=M),F!==void 0&&(h.elevation=F),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,o=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),o&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&me.prefersReducedMotion){const Ae=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ae,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const o=this._getTransformForUpdate(),h=o.zoom,I=o.bearing,w=o.pitch,C=o.padding,M="bearing"in e?this._normalizeBearing(e.bearing,I):I,F="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:o.padding,$=c.P.convert(e.offset);let te=o.centerPoint.add($);const le=o.pointLocation(te),{center:m,zoom:g}=o.getConstrained(c.N.convert(e.center||le),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(m,o);const A=o.zoomScale(g-h),v=o.project(le),x=o.project(m).sub(v);let k=e.curve;const P=Math.max(o.width,o.height),S=P/A,V=x.mag();if("minZoom"in e){const Ae=c.ac(Math.min(e.minZoom,h,g),o.minZoom,o.maxZoom),ve=P/o.zoomScale(Ae-h);k=Math.sqrt(ve/V*2)}const U=k*k;function q(Ae){const ve=(S*S-P*P+(Ae?-1:1)*U*U*V*V)/(2*(Ae?S:P)*U*V);return Math.log(Math.sqrt(ve*ve+1)-ve)}function re(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function Z(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}const N=q(!1);let se=function(Ae){return Z(N)/Z(N+k*Ae)},ce=function(Ae){return P*((Z(N)*(re(ve=N+k*Ae)/Z(ve))-re(N))/U)/V;var ve},ae=(q(!0)-N)/k;if(Math.abs(V)<1e-6||!isFinite(ae)){if(Math.abs(P-S)<1e-6)return this.easeTo(e,n);const Ae=S<P?-1:1;ae=Math.abs(Math.log(S/P))/k,ce=()=>0,se=ve=>Math.exp(Ae*k*ve)}return e.duration="duration"in e?+e.duration:1e3*ae/("screenSpeed"in e?+e.screenSpeed/k:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=I!==M,this._pitching=F!==w,this._padding=!o.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(m),this._ease(Ae=>{const ve=Ae*ae,Ie=1/se(ve);o.zoom=Ae===1?g:h+o.scaleZoom(Ie),this._rotating&&(o.bearing=c.y.number(I,M,Ae)),this._pitching&&(o.pitch=c.y.number(w,F,Ae)),this._padding&&(o.interpolatePadding(C,z,Ae),te=o.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ae);const ke=Ae===1?m:o.unproject(v.add(x.mult(ce(ve))).mult(Ie));o.setLocationAtPoint(o.renderWorldCopies?ke.wrap():ke,te),this._applyUpdatedTransform(o),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=me.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const os={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ks{constructor(e=os){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(o=>typeof o!="string"?"":o)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const o=this._map.style.stylesheet;this.styleOwner=o.owner,this.styleId=o.id}const n=this._map.style.sourceCaches;for(const o in n){const h=n[o];if(h.used||h.usedForTerrain){const I=h.getSource();I.attribution&&e.indexOf(I.attribution)<0&&e.push(I.attribution)}}e=e.filter(o=>String(o).trim()),e.sort((o,h)=>o.length-h.length),e=e.filter((o,h)=>{for(let I=h+1;I<e.length;I++)if(e[I].indexOf(o)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qi{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const n=he.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class _i{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const o of a)if(o.id===e)return void(o.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var kl=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ws extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const o of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[o.key]=!0,this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),c.aP(o.posMatrix,0,c.X,0,c.X,0,1),this._tiles[o.key]=new cn(o,this.tileSize));for(const o in this._tiles)a[o]||delete this._tiles[o]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const o=this._tiles[a].tileID;if(o.canonical.equals(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[a]=h}else if(o.canonical.isChildOf(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const I=o.canonical.z-e.canonical.z,w=o.canonical.x-(o.canonical.x>>I<<I),C=o.canonical.y-(o.canonical.y>>I<<I),M=c.X>>I;c.aP(h.posMatrix,0,M,0,M,0,1),c.J(h.posMatrix,h.posMatrix,[-w*M,-C*M,0]),n[a]=h}else if(e.canonical.isChildOf(o.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const I=e.canonical.z-o.canonical.z,w=e.canonical.x-(e.canonical.x>>I<<I),C=e.canonical.y-(e.canonical.y>>I<<I),M=c.X>>I;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[w*M,C*M,0]),c.K(h.posMatrix,h.posMatrix,[1/2**I,1/2**I,0]),n[a]=h}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let o=e.overscaledZ-this.deltaZoom;if(o>a.maxzoom&&(o=a.maxzoom),o<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(o).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;o>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(o--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class Fo{constructor(e,n,a){this.painter=e,this.sourceCache=new Ws(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,o=c.X){var h;if(!(n>=0&&n<o&&a>=0&&a<o))return 0;const I=this.getTerrainData(e),w=(h=I.tile)===null||h===void 0?void 0:h.dem;if(!w)return 0;const C=function(le,m,g){var A=m[0],v=m[1];return le[0]=g[0]*A+g[4]*v+g[12],le[1]=g[1]*A+g[5]*v+g[13],le}([],[n/o*c.X,a/o*c.X],I.u_terrain_matrix),M=[C[0]*w.dim,C[1]*w.dim],F=Math.floor(M[0]),z=Math.floor(M[1]),$=M[0]-F,te=M[1]-z;return w.get(F,z)*(1-$)*(1-te)+w.get(F+1,z)*$*(1-te)+w.get(F,z+1)*(1-$)*te+w.get(F+1,z+1)*$*te}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:o,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,o%c.X,h%c.X,c.X)}getElevation(e,n,a,o=c.X){return this.getDEMElevation(e,n,a,o)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const o=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Qt(o,h,o.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Qt(o,new c.R({width:1,height:1}),o.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const o=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Qt(o,n.dem.getPixels(),o.gl.RGBA,{premultiply:!1}),n.demTexture.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const o=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=o?h=e.canonical.z-o:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=e.canonical.x-(e.canonical.x>>h<<h),w=e.canonical.y-(e.canonical.y>>h<<h),C=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(C,C,[I*c.X,w*c.X,0]),this._demMatrixCache[e.key]={matrix:C,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,o=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===o||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Qt(n.context,{width:a,height:o,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Qt(n.context,{width:a,height:o,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,o,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,o))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,I=0;h<this._coordsTextureSize;h++)for(let w=0;w<this._coordsTextureSize;w++,I+=4)n[I+0]=255&w,n[I+1]=255&h,n[I+2]=w>>8<<4|h>>8,n[I+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),o=new Qt(e,a,e.gl.RGBA,{premultiply:!1});return o.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=o,o}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,o=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),o.readPixels(h,w-I-1,1,1,o.RGBA,o.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const C=n[0]+(n[2]>>4<<8),M=n[1]+((15&n[2])<<8),F=this.coordsIndex[255-n[3]],z=F&&this.sourceCache.getTileByID(F);if(!z)return null;const $=this._coordsTextureSize,te=(1<<z.tileID.canonical.z)*$;return new c.Z((z.tileID.canonical.x*$+C)/te+z.tileID.wrap,(z.tileID.canonical.y*$+M)/te,this.getElevation(z.tileID,C,M,$))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,o=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),o.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,o.RGBA,o.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new c.bd,a=new c.aY,o=this.meshSize,h=c.X/o,I=o*o;for(let z=0;z<=o;z++)for(let $=0;$<=o;$++)n.emplaceBack($*h,z*h,0);for(let z=0;z<I;z+=o+1)for(let $=0;$<o;$++)a.emplaceBack($+z,o+$+z+1,o+$+z+2),a.emplaceBack($+z,o+$+z+2,$+z+1);const w=n.length,C=w+2*(o+1);for(const z of[0,1])for(let $=0;$<=o;$++)for(const te of[0,1])n.emplaceBack($*h,z*c.X,te);for(let z=0;z<2*o;z+=2)a.emplaceBack(C+z,C+z+1,C+z+3),a.emplaceBack(C+z,C+z+3,C+z+2),a.emplaceBack(w+z,w+z+3,w+z+1),a.emplaceBack(w+z,w+z+2,w+z+3);const M=n.length,F=M+2*(o+1);for(const z of[0,1])for(let $=0;$<=o;$++)for(const te of[0,1])n.emplaceBack(z*c.X,$*h,te);for(let z=0;z<2*o;z+=2)a.emplaceBack(M+z,M+z+1,M+z+3),a.emplaceBack(M+z,M+z+3,M+z+2),a.emplaceBack(F+z,F+z+3,F+z+1),a.emplaceBack(F+z,F+z+2,F+z+3);return this._mesh=new Ba(e.createVertexBuffer(n,kl.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:o}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(o).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=c.Z.fromLngLat(e.wrap()),o=(1<<n)*c.X,h=a.x*o,I=a.y*o,w=Math.floor(h/c.X),C=Math.floor(I/c.X);return{tileID:new c.S(n,0,n,w,C),mercatorX:h,mercatorY:I}}}class ec{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Qt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Xs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Sl{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new ec(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const o=e.sourceCaches[a].getVisibleCoordinates();for(const h of o){const I=this.terrain.sourceCache.getTerrainCoords(h);for(const w in I)this._coordsDescendingInv[a][w]||(this._coordsDescendingInv[a][w]=[]),this._coordsDescendingInv[a][w].push(I[w])}}this._coordsDescendingInvStr={};for(const a of e._order){const o=e._layers[a],h=o.source;if(Xs[o.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const I in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][I]=this._coordsDescendingInv[h][I].map(w=>w.key).sort().join()}}for(const a of this._renderableTiles)for(const o in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[o][a.tileID.key];h&&h!==a.rttCoords[o]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,o=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Xs[n]&&(this._prevType&&Xs[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!o))return!0;if(Xs[this._prevType]||Xs[n]&&o){this._prevType=n;const h=this._stacks.length-1,I=this._stacks[h]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Eo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[h]){const M=this.pool.getObjectForId(w.rtt[h].id);if(M.stamp===w.rtt[h].stamp){this.pool.useObject(M);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),w.rtt[h]={id:C.id,stamp:C.stamp},a.context.bindFramebuffer.set(C.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let M=0;M<I.length;M++){const F=a.style._layers[I[M]],z=F.source?this._coordsDescendingInv[F.source][w.tileID.key]:[w.tileID];a.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),a._renderTileClippingMasks(F,z),a.renderLayer(a,a.style.sourceCaches[F.source],F,z),F.source&&(w.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][w.tileID.key])}}return Eo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Xs[n]}return!1}}const io={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},zo=ne,tc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:os,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Dl=u=>{u.touchstart=u.dragStart,u.touchmoveWindow=u.dragMove,u.touchend=u.dragEnd},ic={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bc{constructor(e,n,a=!1){this.mousedown=I=>{this.startMouse(c.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),he.mousePos(this.element,I)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,he.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const o=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Ys({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:w,bearingDegreesPerPixelMoved:C=.8})=>{const M=new Po;return new Cn({clickTolerance:w,move:(F,z)=>({bearingDelta:(z.x-F.x)*C}),moveStateManager:M,enable:I,assignEvents:Dl})})({clickTolerance:o,enable:!0}),this.map=e,a&&(this.mousePitch=Wa({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:w,pitchDegreesPerPixelMoved:C=-.5})=>{const M=new Po;return new Cn({clickTolerance:w,move:(F,z)=>({pitchDelta:(z.y-F.y)*C}),moveStateManager:M,enable:I,assignEvents:Dl})})({clickTolerance:h,enable:!0})),he.addEventListener(n,"mousedown",this.mousedown),he.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),he.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),he.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:o}=this.mouseRotate.dragMove(e,n)||{};if(o&&a.setBearing(a.getBearing()+o),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(e,n){const a=this.map,{bearingDelta:o}=this.touchRotate.dragMove(e,n)||{};if(o&&a.setBearing(a.getBearing()+o),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const e=this.element;he.removeEventListener(e,"mousedown",this.mousedown),he.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let ir;function Vi(u,e,n){const a=new c.N(u.lng,u.lat);if(u=new c.N(u.lng,u.lat),e){const o=new c.N(u.lng-360,u.lat),h=new c.N(u.lng+360,u.lat),I=n.locationPoint(u).distSqr(e);n.locationPoint(o).distSqr(e)<I?u=o:n.locationPoint(h).distSqr(e)<I&&(u=h)}for(;Math.abs(u.lng-n.center.lng)>180;){const o=n.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u.lng!==a.lng&&n.locationPoint(u).y>n.height/2-n.getHorizon()?u:a}const ea={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Go(u,e,n){const a=u.classList;for(const o in ea)a.remove(`maplibregl-${n}-anchor-${o}`);a.add(`maplibregl-${n}-anchor-${e}`)}class Uo extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,o=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&o!==32&&o!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,o=this._element;this._popup&&(a===o||o.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const o=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!o)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Vi(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${ea[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${h}`),me.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const n=he.createNS("http://www.w3.org/2000/svg","svg"),a=41,o=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${o}px`),n.setAttributeNS(null,"viewBox",`0 0 ${o} ${a}`);const h=he.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const I=he.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const w=he.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const A of C){const v=he.createNS("http://www.w3.org/2000/svg","ellipse");v.setAttributeNS(null,"opacity","0.04"),v.setAttributeNS(null,"cx","10.5"),v.setAttributeNS(null,"cy","5.80029008"),v.setAttributeNS(null,"rx",A.rx),v.setAttributeNS(null,"ry",A.ry),w.appendChild(v)}const M=he.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const F=he.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(F);const z=he.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const $=he.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild($);const te=he.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const le=he.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=he.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const g=he.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),le.appendChild(m),le.appendChild(g),I.appendChild(w),I.appendChild(M),I.appendChild(z),I.appendChild(te),I.appendChild(le),n.appendChild(I),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Go(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const o=this._map,h=o.terrain.depthAtPoint(this._pos),I=o.terrain.getElevationForLngLatZoom(this._lngLat,o.transform.tileZoom);if(o.transform.lngLatToCameraDepth(this._lngLat,I)-h<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/o.transform._pixelPerMeter,C=Math.sin(o.getPitch()*Math.PI/180)*w,M=o.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),F=o.transform.lngLatToCameraDepth(this._lngLat,I+C)-M>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Sa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ta=0,ia=!1;const On={maxWidth:100,unit:"metric"};function Da(u,e,n){const a=n&&n.maxWidth||100,o=u._container.clientHeight/2,h=u.unproject([0,o]),I=u.unproject([a,o]),w=h.distanceTo(I);if(n&&n.unit==="imperial"){const C=3.2808*w;C>5280?zt(e,a,C/5280,u._getUIString("ScaleControl.Miles")):zt(e,a,C,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?zt(e,a,w/1852,u._getUIString("ScaleControl.NauticalMiles")):w>=1e3?zt(e,a,w/1e3,u._getUIString("ScaleControl.Kilometers")):zt(e,a,w,u._getUIString("ScaleControl.Meters"))}function zt(u,e,n,a){const o=function(h){const I=Math.pow(10,`${Math.floor(h)}`.length-1);let w=h/I;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(C){const M=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*M)/M}(w),I*w}(n);u.style.width=e*(o/n)+"px",u.innerHTML=`${o}&nbsp;${a}`}const jt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},No=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Oo(u){if(u){if(typeof u=="number"){const e=Math.round(Math.abs(u)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,u),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-u),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(u,0),right:new c.P(-u,0)}}if(u instanceof c.P||Array.isArray(u)){const e=c.P.convert(u);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(u.center||[0,0]),top:c.P.convert(u.top||[0,0]),"top-left":c.P.convert(u["top-left"]||[0,0]),"top-right":c.P.convert(u["top-right"]||[0,0]),bottom:c.P.convert(u.bottom||[0,0]),"bottom-left":c.P.convert(u["bottom-left"]||[0,0]),"bottom-right":c.P.convert(u["bottom-right"]||[0,0]),left:c.P.convert(u.left||[0,0]),right:c.P.convert(u.right||[0,0])}}return Oo(new c.P(0,0))}const Ml=ne;Q.AJAXError=c.bh,Q.Evented=c.E,Q.LngLat=c.N,Q.MercatorCoordinate=c.Z,Q.Point=c.P,Q.addProtocol=c.bi,Q.config=c.a,Q.removeProtocol=c.bj,Q.AttributionControl=ks,Q.BoxZoomHandler=Xr,Q.CanvasSource=ln,Q.CooperativeGesturesHandler=as,Q.DoubleClickZoomHandler=$s,Q.DragPanHandler=Ql,Q.DragRotateHandler=Xl,Q.EdgeInsets=is,Q.FullscreenControl=class extends c.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Q.GeoJSONSource=Kn,Q.GeolocateControl=class extends c.E{constructor(u){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,o=this._map.getBearing(),h=c.e({bearing:o},this.options.fitBoundsOptions),I=Ne.fromLngLat(n,a);this._map.fitBounds(I,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ia)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Uo({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Sa,u)}onAdd(u){return this._map=u,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(ir!==void 0&&!e)return ir;if(window.navigator.permissions===void 0)return ir=!!window.navigator.geolocation,ir;try{ir=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ir=!!window.navigator.geolocation}return ir})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ta=0,ia=!1}_isOutOfMapMaxBounds(u){const e=this._map.getMaxBounds(),n=u.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),e=u.getSouthEast(),n=u.getNorthEast(),a=e.distanceTo(n),o=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ta--,ia=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ta++,ta>1?(u={maximumAge:6e5,timeout:0},ia=!0):(u=this.options.positionOptions,ia=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Q.Hash=Hs,Q.ImageSource=Jr,Q.KeyboardHandler=un,Q.LngLatBounds=Ne,Q.LogoControl=qi,Q.Map=class extends to{constructor(u){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},tc),u);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rs(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new _i,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},io),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$e.addThrottleControl(()=>this.isMoving()),this._requestManager=new Xe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=Es(o=>{this._trackResize&&!this._removed&&(this.resize(o),this.redraw())},50);this._resizeObserver=new ResizeObserver(o=>{n?a(o):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new eo(this,e),this._hash=e.hash&&new Hs(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ks(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new qi,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(u,e){if(e===void 0&&(e=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(u);return e>-1&&this._controls.splice(e,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,e,n,a)}resize(u){var e;const n=this._containerDimensions(),a=n[0],o=n[1],h=this._getClampedPixelRatio(a,o);if(this._resizeCanvas(a,o,h),this.painter.resize(a,o,h),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const C=this._getClampedPixelRatio(a,o);this._resizeCanvas(a,o,C),this.painter.resize(a,o,C)}this.transform.resize(a,o),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,o);const I=!this._moving;return I&&(this.stop(),this.fire(new c.k("movestart",u)).fire(new c.k("move",u))),this.fire(new c.k("resize",u)),I&&this.fire(new c.k("moveend",u)),this}_getClampedPixelRatio(u,e){const{0:n,1:a}=this._maxCanvasSize,o=this.getPixelRatio(),h=u*o,I=e*o;return Math.min(h>n?n/h:1,I>a?a/I:1)*o}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(Ne.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(c.N.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.pointLocation(c.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,e,n){if(u==="mouseenter"||u==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{const I=e.filter(C=>this.getLayer(C)),w=I.length!==0?this.queryRenderedFeatures(h.point,{layers:I}):[];w.length?a||(a=!0,n.call(this,new tr(u,this,h.originalEvent,{features:w}))):a=!1},mouseout:()=>{a=!1}}}}if(u==="mouseleave"||u==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:I=>{const w=e.filter(C=>this.getLayer(C));(w.length!==0?this.queryRenderedFeatures(I.point,{layers:w}):[]).length?a=!0:a&&(a=!1,n.call(this,new tr(u,this,I.originalEvent)))},mouseout:I=>{a&&(a=!1,n.call(this,new tr(u,this,I.originalEvent)))}}}}{const a=o=>{const h=e.filter(w=>this.getLayer(w)),I=h.length!==0?this.queryRenderedFeatures(o.point,{layers:h}):[];I.length&&(o.features=I,n.call(this,o),delete o.features)};return{layers:e,listener:n,delegates:{[u]:a}}}}_saveDelegatedListener(u,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(e)}_removeDelegatedListener(u,e,n){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const a=this._delegatedListeners[u];for(let o=0;o<a.length;o++){const h=a[o];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(I=>e.includes(I))){for(const I in h.delegates)this.off(I,h.delegates[I]);return void a.splice(o,1)}}}on(u,e,n){if(n===void 0)return super.on(u,e);const a=this._createDelegatedListener(u,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(u,a);for(const o in a.delegates)this.on(o,a.delegates[o]);return this}once(u,e,n){if(n===void 0)return super.once(u,e);const a=typeof e=="string"?[e]:e,o=this._createDelegatedListener(u,a,n);for(const h in o.delegates){const I=o.delegates[h];o.delegates[h]=(...w)=>{this._removeDelegatedListener(u,a,n),I(...w)}}this._saveDelegatedListener(u,o);for(const h in o.delegates)this.once(h,o.delegates[h]);return this}off(u,e,n){return n===void 0?super.off(u,e):(this._removeDelegatedListener(u,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(u,e){if(!this.style)return[];let n;const a=u instanceof c.P||Array.isArray(u),o=a?u:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:u)||{},o instanceof c.P||typeof o[0]=="number")n=[c.P.convert(o)];else{const h=c.P.convert(o[0]),I=c.P.convert(o[1]);n=[h,new c.P(I.x,h.y),I,new c.P(h.x,I.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(u,e){return this.style.querySourceFeatures(u,e)}setStyle(u,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(u,e))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const e=this._locale[u];if(e==null)throw new Error(`Missing UI string '${u}'`);return e}_updateStyle(u,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Rn(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,e,n):this.style.loadJSON(u,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Rn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,e){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,"Style");c.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof u=="object"&&this._updateDiff(u,e)}_updateDiff(u,e){try{this.style.setState(u,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(u,e){return this._lazyInitEmptyStyle(),this.style.addSource(u,e),this._update(!0)}isSourceLoaded(u){const e=this.style&&this.style.sourceCaches[u];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const e=this.style.sourceCaches[u.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===u.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Fo(this.painter,e,u),this.painter.renderToTexture=new Sl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==u.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:u})),this}getTerrain(){var u,e;return(e=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const e in u){const n=u[e]._tiles;for(const a in n){const o=n[a];if(o.state!=="loaded"&&o.state!=="errored")return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,e,n={}){const{pixelRatio:a=1,sdf:o=!1,stretchX:h,stretchY:I,content:w,textFitWidth:C,textFitHeight:M}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:z,data:$}=e,te=e;return this.style.addImage(u,{data:new c.R({width:F,height:z},new Uint8Array($)),pixelRatio:a,stretchX:h,stretchY:I,content:w,textFitWidth:C,textFitHeight:M,sdf:o,version:0,userImage:te}),te.onAdd&&te.onAdd(this,u),this}}{const{width:F,height:z,data:$}=me.getImageData(e);this.style.addImage(u,{data:new c.R({width:F,height:z},$),pixelRatio:a,stretchX:h,stretchY:I,content:w,textFitWidth:C,textFitHeight:M,sdf:o,version:0})}}updateImage(u,e){const n=this.style.getImage(u);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?me.getImageData(e):e,{width:o,height:h,data:I}=a;if(o===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(I,w),this.style.updateImage(u,n),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return $e.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,e){return this._lazyInitEmptyStyle(),this.style.addLayer(u,e),this._update(!0)}moveLayer(u,e){return this.style.moveLayer(u,e),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,e,n){return this.style.setLayerZoomRange(u,e,n),this._update(!0)}setFilter(u,e,n={}){return this.style.setFilter(u,e,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,e,n,a={}){return this.style.setPaintProperty(u,e,n,a),this._update(!0)}getPaintProperty(u,e){return this.style.getPaintProperty(u,e)}setLayoutProperty(u,e,n,a={}){return this.style.setLayoutProperty(u,e,n,a),this._update(!0)}getLayoutProperty(u,e){return this.style.getLayoutProperty(u,e)}setGlyphs(u,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,e,n,a=>{a||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,e,n=>{n||this._update(!0)}),this}setLight(u,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(u){return this._lazyInitEmptyStyle(),this.style.setSky(u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,e){return this.style.setFeatureState(u,e),this._update()}removeFeatureState(u,e){return this.style.removeFeatureState(u,e),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,e=0;return this._container&&(u=this._container.clientWidth||400,e=this._container.clientHeight||300),[u,e]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const e=this._canvasContainer=he.create("div","maplibregl-canvas-container",u);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const o=this._controlContainer=he.create("div","maplibregl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{h[I]=he.create("div",`maplibregl-ctrl-${I} `,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,e,n){this._canvas.width=Math.floor(n*u),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const u={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:u},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new Qo(n,this.transform),Ue.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const o=this.transform.zoom,h=me.now();this.style.zoomHistory.update(o,h);const I=new c.z(o,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=I.crossFadingFactor();w===1&&w===this._crossFadingFactor||(n=!0,this._crossFadingFactor=w),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$e.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,me.frameAsync(this._frameRequest).then(u=>{c.bf.frame(u),this._frameRequest=null,this._render(u)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return zo}getCameraTargetElevation(){return this.transform.elevation}},Q.MapMouseEvent=tr,Q.MapTouchEvent=Js,Q.MapWheelEvent=Zl,Q.Marker=Uo,Q.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},ic,u),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,e){const n=he.create("button",u,this._container);return n.type="button",n.addEventListener("click",e),n}},Q.Popup=class extends c.E{constructor(u){super(),this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Vi(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let o=this.options.anchor;const h=Oo(this.options.offset);if(!o){const w=this._container.offsetWidth,C=this._container.offsetHeight;let M;M=a.y+h.bottom.y<C?["top"]:a.y>this._map.transform.height-C?["bottom"]:[],a.x<w/2?M.push("left"):a.x>this._map.transform.width-w/2&&M.push("right"),o=M.length===0?"bottom":M.join("-")}let I=a.add(h[o]);this.options.subpixelPositioning||(I=I.round()),he.setTransform(this._container,`${ea[o]} translate(${I.x}px,${I.y}px)`),Go(this._container,o,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(jt),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=c.N.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=u;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(No);u&&u.focus()}},Q.RasterDEMTileSource=Gi,Q.RasterTileSource=pi,Q.ScaleControl=class{constructor(u){this._onMove=()=>{Da(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Da(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},On),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Q.ScrollZoomHandler=En,Q.Style=Rn,Q.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Q.TwoFingersTouchPitchHandler=ns,Q.TwoFingersTouchRotateHandler=Cl,Q.TwoFingersTouchZoomHandler=xl,Q.TwoFingersTouchZoomRotateHandler=Ro,Q.VectorTileSource=Dn,Q.VideoSource=la,Q.addSourceType=(u,e)=>c._(void 0,void 0,void 0,function*(){if(ca(u))throw new Error(`A source type called "${u}" already exists.`);((n,a)=>{Ts[n]=a})(u,e)}),Q.clearPrewarmedResources=function(){const u=ri;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Ht),ri=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Q.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},Q.getRTLTextPluginStatus=function(){return Tn().getRTLTextPluginStatus()},Q.getVersion=function(){return Ml},Q.getWorkerCount=function(){return ei.workerCount},Q.getWorkerUrl=function(){return c.a.WORKER_URL},Q.importScriptInWorkers=function(u){return mr().broadcast("IS",u)},Q.prewarm=function(){ki().acquire(Ht)},Q.setMaxParallelImageRequests=function(u){c.a.MAX_PARALLEL_IMAGE_REQUESTS=u},Q.setRTLTextPlugin=function(u,e){return Tn().setRTLTextPlugin(u,e)},Q.setWorkerCount=function(u){ei.workerCount=u},Q.setWorkerUrl=function(u){c.a.WORKER_URL=u}});var J=y;return J})})(Jd);var op=Jd.exports;const mc=ap(op),lp="0cdoIBjm8kHZGjEGavi9",cp="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/v1",hp="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/lightning/v2",up="https://pub-52f3a84d855d426f8854434b69877ae0.r2.dev/wind/v5",Ap="https://db.incusgrid.com";var du={exports:{}};(function(L,p){(function(y,B){B(p)})(jd,function(y){function B(m){return(g,...A)=>J(m,g,A)}function T(m,g){return B(Q(m,g).get)}const{apply:J,getOwnPropertyDescriptor:Q,getPrototypeOf:c,ownKeys:ne}=Reflect,{iterator:fe,toStringTag:xe}=Symbol,me=Object,{create:he,defineProperty:Ue}=me,Ze=Array.prototype[fe],nt=B(Ze),it=ArrayBuffer;T(it.prototype,"byteLength");const at=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;at&&T(at.prototype,"byteLength");const Ye=c(Uint8Array);Ye.from;const $e=Ye.prototype;$e[fe],B($e.keys),B($e.values),B($e.entries),B($e.set),B($e.reverse),B($e.fill),B($e.copyWithin),B($e.sort),B($e.slice),B($e.subarray),T($e,"buffer"),T($e,"byteOffset"),T($e,"length"),T($e,xe);const Xe=Uint8Array,lt=Uint16Array,Bt=Uint32Array,yt=Float32Array,Pt=c([][fe]()),Ft=B(Pt.next),gt=B(function*(){}().next),Qt=c(Pt),Tt=B(DataView.prototype.getUint16),Ot=WeakMap,Yt=Ot.prototype,Kt=B(Yt.get),li=B(Yt.set),pt=new Ot,Vt=he(null,{next:{value:function(){const m=Kt(pt,this);return Ft(m)}},[fe]:{value:function(){return this}}}),si=new Ot,ci=he(Qt,{next:{value:function(){const m=Kt(si,this);return gt(m)},writable:!0,configurable:!0}});for(const m of ne(Pt))m!=="next"&&Ue(ci,m,Q(Pt,m));const ai=new it(4),Ai=new yt(ai),lr=new Bt(ai),Ht=new lt(512),ei=new Xe(512);for(let m=0;m<256;++m){const g=m-127;g<-24?(Ht[m]=0,Ht[256|m]=32768,ei[m]=24,ei[256|m]=24):g<-14?(Ht[m]=1024>>-g-14,Ht[256|m]=1024>>-g-14|32768,ei[m]=-g-1,ei[256|m]=-g-1):g<=15?(Ht[m]=g+15<<10,Ht[256|m]=g+15<<10|32768,ei[m]=13,ei[256|m]=13):g<128?(Ht[m]=31744,Ht[256|m]=64512,ei[m]=24,ei[256|m]=24):(Ht[m]=31744,Ht[256|m]=64512,ei[m]=13,ei[256|m]=13)}const Zt=new Bt(2048);for(let m=1;m<1024;++m){let g=m<<13,A=0;for(;!(8388608&g);)g<<=1,A-=8388608;g&=-8388609,A+=947912704,Zt[m]=g|A}for(let m=1024;m<2048;++m)Zt[m]=939524096+(m-1024<<13);const ri=new Bt(64);for(let m=1;m<31;++m)ri[m]=m<<23;ri[31]=1199570944,ri[32]=2147483648;for(let m=33;m<63;++m)ri[m]=2147483648+(m-32<<23);ri[63]=3347054592;const mi=new lt(64);for(let m=1;m<64;++m)m!==32&&(mi[m]=1024);function ki(m,g,...A){return function(v){const x=v>>10;return lr[0]=Zt[mi[x]+(1023&v)]+ri[x],Ai[0]}(Tt(m,g,...function(v){if(v[fe]===Ze&&Pt.next===Ft)return v;const x=he(Vt);return li(pt,x,nt(v)),x}(A)))}function br(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var mr={exports:{}};function $i(m,g,A){const v=A&&A.debug||!1;v&&console.log("[xml-utils] getting "+g+" in "+m);const x=typeof m=="object"?m.outer:m,k=x.slice(0,x.indexOf(">")+1),P=['"',"'"];for(let S=0;S<P.length;S++){const V=P[S],U=g+"\\="+V+"([^"+V+"]*)"+V;v&&console.log("[xml-utils] pattern:",U);const q=new RegExp(U).exec(k);if(v&&console.log("[xml-utils] match:",q),q)return q[1]}}mr.exports=$i,mr.exports.default=$i;var Ii=br(mr.exports),zi={exports:{}},Xi={exports:{}},Ne={exports:{}};function cr(m,g,A){const v=new RegExp(g).exec(m.slice(A));return v?A+v.index:-1}Ne.exports=cr,Ne.exports.default=cr;var Dn=Ne.exports,pi={exports:{}};function Gi(m,g,A){const v=new RegExp(g).exec(m.slice(A));return v?A+v.index+v[0].length-1:-1}pi.exports=Gi,pi.exports.default=Gi;var Kn=pi.exports,wr={exports:{}};function Jr(m,g){const A=new RegExp(g,"g"),v=m.match(A);return v?v.length:0}wr.exports=Jr,wr.exports.default=Jr;var la=wr.exports;const ln=Dn,Ts=Kn,ca=la;function ft(m,g,A){const v=A&&A.debug||!1,x=!(A&&typeof A.nested===!1),k=A&&A.startIndex||0;v&&console.log("[xml-utils] starting findTagByName with",g," and ",A);const P=ln(m,`<${g}[ 
>/]`,k);if(v&&console.log("[xml-utils] start:",P),P===-1)return;const S=m.slice(P+g.length);let V=Ts(S,"^[^<]*[ /]>",0);const U=V!==-1&&S[V-1]==="/";if(v&&console.log("[xml-utils] selfClosing:",U),U===!1)if(x){let N=0,se=1,ce=0;for(;(V=Ts(S,"[ /]"+g+">",N))!==-1;){const ae=S.substring(N,V+1);if(se+=ca(ae,"<"+g+`[ 
	>]`),ce+=ca(ae,"</"+g+">"),ce>=se)break;N=V}}else V=Ts(S,"[ /]"+g+">",0);const q=P+g.length+V+1;if(v&&console.log("[xml-utils] end:",q),q===-1)return;const re=m.slice(P,q);let Z;return Z=U?null:re.slice(re.indexOf(">")+1,re.lastIndexOf("<")),{inner:Z,outer:re,start:P,end:q}}Xi.exports=ft,Xi.exports.default=ft;const Mn=Xi.exports;function vr(m,g,A){const v=[],x=A&&A.debug||!1,k=!A||typeof A.nested!="boolean"||A.nested;let P,S=A&&A.startIndex||0;for(;P=Mn(m,g,{debug:x,startIndex:S});)S=k?P.start+1+g.length:P.end,v.push(P);return x&&console.log("findTagsByName found",v.length,"tags"),v}zi.exports=vr,zi.exports.default=vr;var Tn=br(zi.exports);const cn={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ut={};for(const m in cn)cn.hasOwnProperty(m)&&(ut[cn[m]]=parseInt(m,10));const di=[ut.BitsPerSample,ut.ExtraSamples,ut.SampleFormat,ut.StripByteCounts,ut.StripOffsets,ut.StripRowCounts,ut.TileByteCounts,ut.TileOffsets,ut.SubIFDs],Wt={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Xt={};for(const m in Wt)Wt.hasOwnProperty(m)&&(Xt[Wt[m]]=parseInt(m,10));const hn=0,oi=1,Pn=2,Ln=3,Zn=5,_n=6,_e=8,j=0,H=1,ee=0,ge=1,Ce=2,Me={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Le=new Map;function we(m,g){Array.isArray(m)||(m=[m]),m.forEach(A=>Le.set(A,g))}async function qe(m){const g=Le.get(m.Compression);if(!g)throw new Error(`Unknown compression method identifier: ${m.Compression}`);return new(await g())(m)}function rt(m,g,A,v=1){return new(Object.getPrototypeOf(m)).constructor(g*A*v)}function ze(m,g,A){return(1-A)*m+A*g}function _t(m,g,A,v,x,k="nearest"){switch(k.toLowerCase()){case"nearest":return function(P,S,V,U,q){const re=S/U,Z=V/q;return P.map(N=>{const se=rt(N,U,q);for(let ce=0;ce<q;++ce){const ae=Math.min(Math.round(Z*ce),V-1);for(let Ae=0;Ae<U;++Ae){const ve=Math.min(Math.round(re*Ae),S-1),Ie=N[ae*S+ve];se[ce*U+Ae]=Ie}}return se})}(m,g,A,v,x);case"bilinear":case"linear":return function(P,S,V,U,q){const re=S/U,Z=V/q;return P.map(N=>{const se=rt(N,U,q);for(let ce=0;ce<q;++ce){const ae=Z*ce,Ae=Math.floor(ae),ve=Math.min(Math.ceil(ae),V-1);for(let Ie=0;Ie<U;++Ie){const ke=re*Ie,K=ke%1,G=Math.floor(ke),ue=Math.min(Math.ceil(ke),S-1),ie=N[Ae*S+G],oe=N[Ae*S+ue],de=N[ve*S+G],Se=N[ve*S+ue],Be=ze(ze(ie,oe,K),ze(de,Se,K),ae%1);se[ce*U+Ie]=Be}}return se})}(m,g,A,v,x);default:throw new Error(`Unsupported resampling method: '${k}'`)}}function Nt(m,g,A,v,x,k,P="nearest"){switch(P.toLowerCase()){case"nearest":return function(S,V,U,q,re,Z){const N=V/q,se=U/re,ce=rt(S,q,re,Z);for(let ae=0;ae<re;++ae){const Ae=Math.min(Math.round(se*ae),U-1);for(let ve=0;ve<q;++ve){const Ie=Math.min(Math.round(N*ve),V-1);for(let ke=0;ke<Z;++ke){const K=S[Ae*V*Z+Ie*Z+ke];ce[ae*q*Z+ve*Z+ke]=K}}}return ce}(m,g,A,v,x,k);case"bilinear":case"linear":return function(S,V,U,q,re,Z){const N=V/q,se=U/re,ce=rt(S,q,re,Z);for(let ae=0;ae<re;++ae){const Ae=se*ae,ve=Math.floor(Ae),Ie=Math.min(Math.ceil(Ae),U-1);for(let ke=0;ke<q;++ke){const K=N*ke,G=K%1,ue=Math.floor(K),ie=Math.min(Math.ceil(K),V-1);for(let oe=0;oe<Z;++oe){const de=S[ve*V*Z+ue*Z+oe],Se=S[ve*V*Z+ie*Z+oe],Be=S[Ie*V*Z+ue*Z+oe],Qe=S[Ie*V*Z+ie*Z+oe],Ge=ze(ze(de,Se,G),ze(Be,Qe,G),Ae%1);ce[ae*q*Z+ke*Z+oe]=Ge}}}return ce}(m,g,A,v,x,k);default:throw new Error(`Unsupported resampling method: '${P}'`)}}function Jt(m,g,A){let v=0;for(let x=g;x<A;++x)v+=m[x];return v}function wi(m,g,A){switch(m){case 1:if(g<=8)return new Uint8Array(A);if(g<=16)return new Uint16Array(A);if(g<=32)return new Uint32Array(A);break;case 2:if(g===8)return new Int8Array(A);if(g===16)return new Int16Array(A);if(g===32)return new Int32Array(A);break;case 3:switch(g){case 16:case 32:return new Float32Array(A);case 64:return new Float64Array(A)}}throw Error("Unsupported data format/bitsPerSample")}we([void 0,1],()=>Promise.resolve().then(function(){return Kl}).then(m=>m.default)),we(5,()=>Promise.resolve().then(function(){return Ca}).then(m=>m.default)),we(6,()=>{throw new Error("old style JPEG compression is not supported.")}),we(7,()=>Promise.resolve().then(function(){return Ya}).then(m=>m.default)),we([8,32946],()=>Promise.resolve().then(function(){return e}).then(m=>m.default)),we(32773,()=>Promise.resolve().then(function(){return n}).then(m=>m.default)),we(34887,()=>Promise.resolve().then(function(){return z}).then(async m=>(await m.zstd.init(),m)).then(m=>m.default)),we(50001,()=>Promise.resolve().then(function(){return $}).then(m=>m.default));class hi{constructor(g,A,v,x,k,P){this.fileDirectory=g,this.geoKeys=A,this.dataView=v,this.littleEndian=x,this.tiles=k?{}:null,this.isTiled=!g.StripOffsets;const S=g.PlanarConfiguration;if(this.planarConfiguration=S===void 0?1:S,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=P}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return this.fileDirectory.SamplesPerPixel!==void 0?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip!==void 0?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(g){return this.isTiled||(g+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-g*this.getTileHeight()}getBytesPerPixel(){let g=0;for(let A=0;A<this.fileDirectory.BitsPerSample.length;++A)g+=this.getSampleByteSize(A);return g}getSampleByteSize(g){if(g>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${g} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[g]/8)}getReaderForSample(g){const A=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[g]:1,v=this.fileDirectory.BitsPerSample[g];switch(A){case 1:if(v<=8)return DataView.prototype.getUint8;if(v<=16)return DataView.prototype.getUint16;if(v<=32)return DataView.prototype.getUint32;break;case 2:if(v<=8)return DataView.prototype.getInt8;if(v<=16)return DataView.prototype.getInt16;if(v<=32)return DataView.prototype.getInt32;break;case 3:switch(v){case 16:return function(x,k){return ki(this,x,k)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(g=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[g]:1}getBitsPerSample(g=0){return this.fileDirectory.BitsPerSample[g]}getArrayForSample(g,A){return wi(this.getSampleFormat(g),this.getBitsPerSample(g),A)}async getTileOrStrip(g,A,v,x,k){const P=Math.ceil(this.getWidth()/this.getTileWidth()),S=Math.ceil(this.getHeight()/this.getTileHeight());let V;const{tiles:U}=this;let q,re;this.planarConfiguration===1?V=A*P+g:this.planarConfiguration===2&&(V=v*P*S+A*P+g),this.isTiled?(q=this.fileDirectory.TileOffsets[V],re=this.fileDirectory.TileByteCounts[V]):(q=this.fileDirectory.StripOffsets[V],re=this.fileDirectory.StripByteCounts[V]);const Z=(await this.source.fetch([{offset:q,length:re}],k))[0];let N;return U!==null&&U[V]?N=U[V]:(N=(async()=>{let se=await x.decode(this.fileDirectory,Z);const ce=this.getSampleFormat(),ae=this.getBitsPerSample();return function(Ae,ve){return(Ae!==1&&Ae!==2||!(ve<=32)||ve%8!=0)&&(Ae!==3||ve!==16&&ve!==32&&ve!==64)}(ce,ae)&&(se=function(Ae,ve,Ie,ke,K,G,ue){const ie=new DataView(Ae),oe=Ie===2?1:ke,de=wi(ve,K,Ie===2?ue*G:ue*G*ke),Se=parseInt("1".repeat(K),2);if(ve===1){let Be;Be=Ie===1?ke*K:K;let Qe=G*Be;7&Qe&&(Qe=Qe+7&-8);for(let Ge=0;Ge<ue;++Ge){const He=Ge*Qe;for(let Ke=0;Ke<G;++Ke){const tt=He+Ke*oe*K;for(let mt=0;mt<oe;++mt){const Oe=tt+mt*K,Fe=(Ge*G+Ke)*oe+mt,et=Math.floor(Oe/8),Dt=Oe%8;if(Dt+K<=8)de[Fe]=ie.getUint8(et)>>8-K-Dt&Se;else if(Dt+K<=16)de[Fe]=ie.getUint16(et)>>16-K-Dt&Se;else if(Dt+K<=24){const At=ie.getUint16(et)<<8|ie.getUint8(et+2);de[Fe]=At>>24-K-Dt&Se}else de[Fe]=ie.getUint32(et)>>32-K-Dt&Se}}}}return de.buffer}(se,ce,this.planarConfiguration,this.getSamplesPerPixel(),ae,this.getTileWidth(),this.getBlockHeight(A))),se})(),U!==null&&(U[V]=N)),{x:g,y:A,sample:v,data:await N}}async _readRaster(g,A,v,x,k,P,S,V,U){const q=this.getTileWidth(),re=this.getTileHeight(),Z=this.getWidth(),N=this.getHeight(),se=Math.max(Math.floor(g[0]/q),0),ce=Math.min(Math.ceil(g[2]/q),Math.ceil(Z/q)),ae=Math.max(Math.floor(g[1]/re),0),Ae=Math.min(Math.ceil(g[3]/re),Math.ceil(N/re)),ve=g[2]-g[0];let Ie=this.getBytesPerPixel();const ke=[],K=[];for(let ie=0;ie<A.length;++ie)this.planarConfiguration===1?ke.push(Jt(this.fileDirectory.BitsPerSample,0,A[ie])/8):ke.push(0),K.push(this.getReaderForSample(A[ie]));const G=[],{littleEndian:ue}=this;for(let ie=ae;ie<Ae;++ie)for(let oe=se;oe<ce;++oe){let de;this.planarConfiguration===1&&(de=this.getTileOrStrip(oe,ie,0,k,U));for(let Se=0;Se<A.length;++Se){const Be=Se,Qe=A[Se];this.planarConfiguration===2&&(Ie=this.getSampleByteSize(Qe),de=this.getTileOrStrip(oe,ie,Qe,k,U));const Ge=de.then(He=>{const Ke=He.data,tt=new DataView(Ke),mt=this.getBlockHeight(He.y),Oe=He.y*re,Fe=He.x*q,et=Oe+mt,Dt=(He.x+1)*q,At=K[Be],Lt=Math.min(mt,mt-(et-g[3]),N-Oe),ht=Math.min(q,q-(Dt-g[2]),Z-Fe);for(let Ct=Math.max(0,g[1]-Oe);Ct<Lt;++Ct)for(let It=Math.max(0,g[0]-Fe);It<ht;++It){const ct=(Ct*q+It)*Ie,Et=At.call(tt,ct+ke[Be],ue);let bi;x?(bi=(Ct+Oe-g[1])*ve*A.length+(It+Fe-g[0])*A.length+Be,v[bi]=Et):(bi=(Ct+Oe-g[1])*ve+It+Fe-g[0],v[Be][bi]=Et)}});G.push(Ge)}}if(await Promise.all(G),P&&g[2]-g[0]!==P||S&&g[3]-g[1]!==S){let ie;return ie=x?Nt(v,g[2]-g[0],g[3]-g[1],P,S,A.length,V):_t(v,g[2]-g[0],g[3]-g[1],P,S,V),ie.width=P,ie.height=S,ie}return v.width=P||g[2]-g[0],v.height=S||g[3]-g[1],v}async readRasters({window:g,samples:A=[],interleave:v,pool:x=null,width:k,height:P,resampleMethod:S,fillValue:V,signal:U}={}){const q=g||[0,0,this.getWidth(),this.getHeight()];if(q[0]>q[2]||q[1]>q[3])throw new Error("Invalid subsets");const re=(q[2]-q[0])*(q[3]-q[1]),Z=this.getSamplesPerPixel();if(A&&A.length){for(let ce=0;ce<A.length;++ce)if(A[ce]>=Z)return Promise.reject(new RangeError(`Invalid sample index '${A[ce]}'.`))}else for(let ce=0;ce<Z;++ce)A.push(ce);let N;if(v)N=wi(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),re*A.length),V&&N.fill(V);else{N=[];for(let ce=0;ce<A.length;++ce){const ae=this.getArrayForSample(A[ce],re);Array.isArray(V)&&ce<V.length?ae.fill(V[ce]):V&&!Array.isArray(V)&&ae.fill(V),N.push(ae)}}const se=x||await qe(this.fileDirectory);return await this._readRaster(q,A,N,v,se,k,P,S,U)}async readRGB({window:g,interleave:A=!0,pool:v=null,width:x,height:k,resampleMethod:P,enableAlpha:S=!1,signal:V}={}){const U=g||[0,0,this.getWidth(),this.getHeight()];if(U[0]>U[2]||U[1]>U[3])throw new Error("Invalid subsets");const q=this.fileDirectory.PhotometricInterpretation;if(q===Pn){let Ae=[0,1,2];if(this.fileDirectory.ExtraSamples!==j&&S){Ae=[];for(let ve=0;ve<this.fileDirectory.BitsPerSample.length;ve+=1)Ae.push(ve)}return this.readRasters({window:g,interleave:A,samples:Ae,pool:v,width:x,height:k,resampleMethod:P,signal:V})}let re;switch(q){case hn:case oi:case Ln:re=[0];break;case Zn:re=[0,1,2,3];break;case _n:case _e:re=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const Z={window:U,interleave:!0,samples:re,pool:v,width:x,height:k,resampleMethod:P,signal:V},{fileDirectory:N}=this,se=await this.readRasters(Z),ce=2**this.fileDirectory.BitsPerSample[0];let ae;switch(q){case hn:ae=function(Ae,ve){const{width:Ie,height:ke}=Ae,K=new Uint8Array(Ie*ke*3);let G;for(let ue=0,ie=0;ue<Ae.length;++ue,ie+=3)G=256-Ae[ue]/ve*256,K[ie]=G,K[ie+1]=G,K[ie+2]=G;return K}(se,ce);break;case oi:ae=function(Ae,ve){const{width:Ie,height:ke}=Ae,K=new Uint8Array(Ie*ke*3);let G;for(let ue=0,ie=0;ue<Ae.length;++ue,ie+=3)G=Ae[ue]/ve*256,K[ie]=G,K[ie+1]=G,K[ie+2]=G;return K}(se,ce);break;case Ln:ae=function(Ae,ve){const{width:Ie,height:ke}=Ae,K=new Uint8Array(Ie*ke*3),G=ve.length/3,ue=ve.length/3*2;for(let ie=0,oe=0;ie<Ae.length;++ie,oe+=3){const de=Ae[ie];K[oe]=ve[de]/65536*256,K[oe+1]=ve[de+G]/65536*256,K[oe+2]=ve[de+ue]/65536*256}return K}(se,N.ColorMap);break;case Zn:ae=function(Ae){const{width:ve,height:Ie}=Ae,ke=new Uint8Array(ve*Ie*3);for(let K=0,G=0;K<Ae.length;K+=4,G+=3){const ue=Ae[K],ie=Ae[K+1],oe=Ae[K+2],de=Ae[K+3];ke[G]=(255-ue)/256*255*((255-de)/256),ke[G+1]=(255-ie)/256*255*((255-de)/256),ke[G+2]=(255-oe)/256*255*((255-de)/256)}return ke}(se);break;case _n:ae=function(Ae){const{width:ve,height:Ie}=Ae,ke=new Uint8ClampedArray(ve*Ie*3);for(let K=0,G=0;K<Ae.length;K+=3,G+=3){const ue=Ae[K],ie=Ae[K+1],oe=Ae[K+2];ke[G]=ue+1.402*(oe-128),ke[G+1]=ue-.34414*(ie-128)-.71414*(oe-128),ke[G+2]=ue+1.772*(ie-128)}return ke}(se);break;case _e:ae=function(Ae){const{width:ve,height:Ie}=Ae,ke=new Uint8Array(ve*Ie*3);for(let K=0,G=0;K<Ae.length;K+=3,G+=3){let ue,ie,oe,de=(Ae[K+0]+16)/116,Se=(Ae[K+1]<<24>>24)/500+de,Be=de-(Ae[K+2]<<24>>24)/200;Se=.95047*(Se*Se*Se>.008856?Se*Se*Se:(Se-16/116)/7.787),de=1*(de*de*de>.008856?de*de*de:(de-16/116)/7.787),Be=1.08883*(Be*Be*Be>.008856?Be*Be*Be:(Be-16/116)/7.787),ue=3.2406*Se+-1.5372*de+-.4986*Be,ie=-.9689*Se+1.8758*de+.0415*Be,oe=.0557*Se+-.204*de+1.057*Be,ue=ue>.0031308?1.055*ue**(1/2.4)-.055:12.92*ue,ie=ie>.0031308?1.055*ie**(1/2.4)-.055:12.92*ie,oe=oe>.0031308?1.055*oe**(1/2.4)-.055:12.92*oe,ke[G]=255*Math.max(0,Math.min(1,ue)),ke[G+1]=255*Math.max(0,Math.min(1,ie)),ke[G+2]=255*Math.max(0,Math.min(1,oe))}return ke}(se);break;default:throw new Error("Unsupported photometric interpretation.")}if(!A){const Ae=new Uint8Array(ae.length/3),ve=new Uint8Array(ae.length/3),Ie=new Uint8Array(ae.length/3);for(let ke=0,K=0;ke<ae.length;ke+=3,++K)Ae[K]=ae[ke],ve[K]=ae[ke+1],Ie[K]=ae[ke+2];ae=[Ae,ve,Ie]}return ae.width=se.width,ae.height=se.height,ae}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const g=[];for(let A=0;A<this.fileDirectory.ModelTiepoint.length;A+=6)g.push({i:this.fileDirectory.ModelTiepoint[A],j:this.fileDirectory.ModelTiepoint[A+1],k:this.fileDirectory.ModelTiepoint[A+2],x:this.fileDirectory.ModelTiepoint[A+3],y:this.fileDirectory.ModelTiepoint[A+4],z:this.fileDirectory.ModelTiepoint[A+5]});return g}getGDALMetadata(g=null){const A={};if(!this.fileDirectory.GDAL_METADATA)return null;const v=this.fileDirectory.GDAL_METADATA;let x=Tn(v,"Item");x=g===null?x.filter(k=>Ii(k,"sample")===void 0):x.filter(k=>Number(Ii(k,"sample"))===g);for(let k=0;k<x.length;++k){const P=x[k];A[Ii(P,"name")]=P.inner}return A}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const g=this.fileDirectory.GDAL_NODATA;return Number(g.substring(0,g.length-1))}getOrigin(){const g=this.fileDirectory.ModelTiepoint,A=this.fileDirectory.ModelTransformation;if(g&&g.length===6)return[g[3],g[4],g[5]];if(A)return[A[3],A[7],A[11]];throw new Error("The image does not have an affine transformation.")}getResolution(g=null){const A=this.fileDirectory.ModelPixelScale,v=this.fileDirectory.ModelTransformation;if(A)return[A[0],-A[1],A[2]];if(v)return v[1]===0&&v[4]===0?[v[0],-v[5],v[10]]:[Math.sqrt(v[0]*v[0]+v[4]*v[4]),-Math.sqrt(v[1]*v[1]+v[5]*v[5]),v[10]];if(g){const[x,k,P]=g.getResolution();return[x*g.getWidth()/this.getWidth(),k*g.getHeight()/this.getHeight(),P*g.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(g=!1){const A=this.getHeight(),v=this.getWidth();if(this.fileDirectory.ModelTransformation&&!g){const[x,k,P,S,V,U,q,re]=this.fileDirectory.ModelTransformation,Z=[[0,0],[0,A],[v,0],[v,A]].map(([ce,ae])=>[S+x*ce+k*ae,re+V*ce+U*ae]),N=Z.map(ce=>ce[0]),se=Z.map(ce=>ce[1]);return[Math.min(...N),Math.min(...se),Math.max(...N),Math.max(...se)]}{const x=this.getOrigin(),k=this.getResolution(),P=x[0],S=x[1],V=P+k[0]*v,U=S+k[1]*A;return[Math.min(P,V),Math.min(S,U),Math.max(P,V),Math.max(S,U)]}}}class Ei{constructor(g){this._dataView=new DataView(g)}get buffer(){return this._dataView.buffer}getUint64(g,A){const v=this.getUint32(g,A),x=this.getUint32(g+4,A);let k;if(A){if(k=v+2**32*x,!Number.isSafeInteger(k))throw new Error(`${k} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return k}if(k=2**32*v+x,!Number.isSafeInteger(k))throw new Error(`${k} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return k}getInt64(g,A){let v=0;const x=(128&this._dataView.getUint8(g+(A?7:0)))>0;let k=!0;for(let P=0;P<8;P++){let S=this._dataView.getUint8(g+(A?P:7-P));x&&(k?S!==0&&(S=255&~(S-1),k=!1):S=255&~S),v+=S*256**P}return x&&(v=-v),v}getUint8(g,A){return this._dataView.getUint8(g,A)}getInt8(g,A){return this._dataView.getInt8(g,A)}getUint16(g,A){return this._dataView.getUint16(g,A)}getInt16(g,A){return this._dataView.getInt16(g,A)}getUint32(g,A){return this._dataView.getUint32(g,A)}getInt32(g,A){return this._dataView.getInt32(g,A)}getFloat16(g,A){return ki(this._dataView,g,A)}getFloat32(g,A){return this._dataView.getFloat32(g,A)}getFloat64(g,A){return this._dataView.getFloat64(g,A)}}class yi{constructor(g,A,v,x){this._dataView=new DataView(g),this._sliceOffset=A,this._littleEndian=v,this._bigTiff=x}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(g,A){return this.sliceOffset<=g&&this.sliceTop>=g+A}readUint8(g){return this._dataView.getUint8(g-this._sliceOffset,this._littleEndian)}readInt8(g){return this._dataView.getInt8(g-this._sliceOffset,this._littleEndian)}readUint16(g){return this._dataView.getUint16(g-this._sliceOffset,this._littleEndian)}readInt16(g){return this._dataView.getInt16(g-this._sliceOffset,this._littleEndian)}readUint32(g){return this._dataView.getUint32(g-this._sliceOffset,this._littleEndian)}readInt32(g){return this._dataView.getInt32(g-this._sliceOffset,this._littleEndian)}readFloat32(g){return this._dataView.getFloat32(g-this._sliceOffset,this._littleEndian)}readFloat64(g){return this._dataView.getFloat64(g-this._sliceOffset,this._littleEndian)}readUint64(g){const A=this.readUint32(g),v=this.readUint32(g+4);let x;if(this._littleEndian){if(x=A+2**32*v,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}if(x=2**32*A+v,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}readInt64(g){let A=0;const v=(128&this._dataView.getUint8(g+(this._littleEndian?7:0)))>0;let x=!0;for(let k=0;k<8;k++){let P=this._dataView.getUint8(g+(this._littleEndian?k:7-k));v&&(x?P!==0&&(P=255&~(P-1),x=!1):P=255&~P),A+=P*256**k}return v&&(A=-A),A}readOffset(g){return this._bigTiff?this.readUint64(g):this.readUint32(g)}}const nr=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Ki{constructor(g=nr,A){this.workers=null,this._awaitingDecoder=null,this.size=g,this.messageId=0,g&&(this._awaitingDecoder=A?Promise.resolve(A):new Promise(v=>{Promise.resolve().then(function(){return le}).then(x=>{v(x.create)})}),this._awaitingDecoder.then(v=>{this._awaitingDecoder=null,this.workers=[];for(let x=0;x<g;x++)this.workers.push({worker:v(),idle:!0})}))}async decode(g,A){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?qe(g).then(v=>v.decode(g,A)):new Promise(v=>{const x=this.workers.find(S=>S.idle)||this.workers[Math.floor(Math.random()*this.size)];x.idle=!1;const k=this.messageId++,P=S=>{S.data.id===k&&(x.idle=!0,v(S.data.decoded),x.worker.removeEventListener("message",P))};x.worker.addEventListener("message",P),x.worker.postMessage({fileDirectory:g,buffer:A,id:k},[A])})}destroy(){this.workers&&(this.workers.forEach(g=>{g.worker.terminate()}),this.workers=null)}}const gi=`\r
\r
`;function Pi(m){if(Object.fromEntries!==void 0)return Object.fromEntries(m);const g={};for(const[A,v]of m)g[A.toLowerCase()]=v;return g}function ji(m){return Pi(m.split(`\r
`).map(g=>{const A=g.split(":").map(v=>v.trim());return A[0]=A[0].toLowerCase(),A}))}function sr(m){let g,A,v;return m&&([,g,A,v]=m.match(/bytes (\d+)-(\d+)\/(\d+)/),g=parseInt(g,10),A=parseInt(A,10),v=parseInt(v,10)),{start:g,end:A,total:v}}class dr{async fetch(g,A=void 0){return Promise.all(g.map(v=>this.fetchSlice(v,A)))}async fetchSlice(g){throw new Error(`fetching of slice ${g} not possible, not implemented`)}get fileSize(){return null}async close(){}}class fr extends Map{constructor(g={}){if(super(),!(g.maxSize&&g.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof g.maxAge=="number"&&g.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=g.maxSize,this.maxAge=g.maxAge||Number.POSITIVE_INFINITY,this.onEviction=g.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(g){if(typeof this.onEviction=="function")for(const[A,v]of g)this.onEviction(A,v.value)}_deleteIfExpired(g,A){return typeof A.expiry=="number"&&A.expiry<=Date.now()&&(typeof this.onEviction=="function"&&this.onEviction(g,A.value),this.delete(g))}_getOrDeleteIfExpired(g,A){if(this._deleteIfExpired(g,A)===!1)return A.value}_getItemValue(g,A){return A.expiry?this._getOrDeleteIfExpired(g,A):A.value}_peek(g,A){const v=A.get(g);return this._getItemValue(g,v)}_set(g,A){this.cache.set(g,A),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(g,A){this.oldCache.delete(g),this._set(g,A)}*_entriesAscending(){for(const g of this.oldCache){const[A,v]=g;this.cache.has(A)||this._deleteIfExpired(A,v)===!1&&(yield g)}for(const g of this.cache){const[A,v]=g;this._deleteIfExpired(A,v)===!1&&(yield g)}}get(g){if(this.cache.has(g)){const A=this.cache.get(g);return this._getItemValue(g,A)}if(this.oldCache.has(g)){const A=this.oldCache.get(g);if(this._deleteIfExpired(g,A)===!1)return this._moveToRecent(g,A),A.value}}set(g,A,{maxAge:v=this.maxAge}={}){const x=typeof v=="number"&&v!==Number.POSITIVE_INFINITY?Date.now()+v:void 0;return this.cache.has(g)?this.cache.set(g,{value:A,expiry:x}):this._set(g,{value:A,expiry:x}),this}has(g){return this.cache.has(g)?!this._deleteIfExpired(g,this.cache.get(g)):!!this.oldCache.has(g)&&!this._deleteIfExpired(g,this.oldCache.get(g))}peek(g){return this.cache.has(g)?this._peek(g,this.cache):this.oldCache.has(g)?this._peek(g,this.oldCache):void 0}delete(g){const A=this.cache.delete(g);return A&&this._size--,this.oldCache.delete(g)||A}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(g){if(!(g&&g>0))throw new TypeError("`maxSize` must be a number greater than 0");const A=[...this._entriesAscending()],v=A.length-g;v<0?(this.cache=new Map(A),this.oldCache=new Map,this._size=A.length):(v>0&&this._emitEvictions(A.slice(0,v)),this.oldCache=new Map(A.slice(v)),this.cache=new Map,this._size=0),this.maxSize=g}*keys(){for(const[g]of this)yield g}*values(){for(const[,g]of this)yield g}*[Symbol.iterator](){for(const g of this.cache){const[A,v]=g;this._deleteIfExpired(A,v)===!1&&(yield[A,v.value])}for(const g of this.oldCache){const[A,v]=g;this.cache.has(A)||this._deleteIfExpired(A,v)===!1&&(yield[A,v.value])}}*entriesDescending(){let g=[...this.cache];for(let A=g.length-1;A>=0;--A){const v=g[A],[x,k]=v;this._deleteIfExpired(x,k)===!1&&(yield[x,k.value])}g=[...this.oldCache];for(let A=g.length-1;A>=0;--A){const v=g[A],[x,k]=v;this.cache.has(x)||this._deleteIfExpired(x,k)===!1&&(yield[x,k.value])}}*entriesAscending(){for(const[g,A]of this._entriesAscending())yield[g,A.value]}get size(){if(!this._size)return this.oldCache.size;let g=0;for(const A of this.oldCache.keys())this.cache.has(A)||g++;return Math.min(this._size+g,this.maxSize)}entries(){return this.entriesAscending()}forEach(g,A=this){for(const[v,x]of this.entriesAscending())g.call(A,x,v,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class In extends Error{constructor(g){super(g),Error.captureStackTrace&&Error.captureStackTrace(this,In),this.name="AbortError"}}class Ri extends Error{constructor(g,A){super(A),this.errors=g,this.message=A,this.name="AggregateError"}}const Xo=Ri;class el{constructor(g,A,v=null){this.offset=g,this.length=A,this.data=v}get top(){return this.offset+this.length}}class Tr{constructor(g,A,v){this.offset=g,this.length=A,this.blockIds=v}}class Yr extends dr{constructor(g,{blockSize:A=65536,cacheSize:v=100}={}){super(),this.source=g,this.blockSize=A,this.blockCache=new fr({maxSize:v,onEviction:(x,k)=>{this.evictedBlocks.set(x,k)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(g,A){const v=[],x=[],k=[];this.evictedBlocks.clear();for(const{offset:Z,length:N}of g){let se=Z+N;const{fileSize:ce}=this;ce!==null&&(se=Math.min(se,ce));for(let ae=Math.floor(Z/this.blockSize)*this.blockSize;ae<se;ae+=this.blockSize){const Ae=Math.floor(ae/this.blockSize);this.blockCache.has(Ae)||this.blockRequests.has(Ae)||(this.blockIdsToFetch.add(Ae),x.push(Ae)),this.blockRequests.has(Ae)&&v.push(this.blockRequests.get(Ae)),k.push(Ae)}}await async function(Z){return new Promise(N=>setTimeout(N,Z))}(),this.fetchBlocks(A);const P=[];for(const Z of x)this.blockRequests.has(Z)&&P.push(this.blockRequests.get(Z));await Promise.allSettled(v),await Promise.allSettled(P);const S=[],V=k.filter(Z=>this.abortedBlockIds.has(Z)||!this.blockCache.has(Z));if(V.forEach(Z=>this.blockIdsToFetch.add(Z)),V.length>0&&A&&!A.aborted){this.fetchBlocks(null);for(const Z of V){const N=this.blockRequests.get(Z);if(!N)throw new Error(`Block ${Z} is not in the block requests`);S.push(N)}await Promise.allSettled(S)}if(A&&A.aborted)throw new In("Request was aborted");const U=k.map(Z=>this.blockCache.get(Z)||this.evictedBlocks.get(Z)),q=U.filter(Z=>!Z);if(q.length)throw new Xo(q,"Request failed");const re=new Map(function(Z,N){const se=Array.isArray(Z)?Z:Array.from(Z),ce=Array.isArray(N)?N:Array.from(N);return se.map((ae,Ae)=>[ae,ce[Ae]])}(k,U));return this.readSliceData(g,re)}fetchBlocks(g){if(this.blockIdsToFetch.size>0){const A=this.groupBlocks(this.blockIdsToFetch),v=this.source.fetch(A,g);for(let x=0;x<A.length;++x){const k=A[x];for(const P of k.blockIds)this.blockRequests.set(P,(async()=>{try{const S=(await v)[x],V=P*this.blockSize,U=V-S.offset,q=Math.min(U+this.blockSize,S.data.byteLength),re=S.data.slice(U,q),Z=new el(V,re.byteLength,re,P);this.blockCache.set(P,Z),this.abortedBlockIds.delete(P)}catch(S){if(S.name!=="AbortError")throw S;S.signal=g,this.blockCache.delete(P),this.abortedBlockIds.add(P)}finally{this.blockRequests.delete(P)}})())}this.blockIdsToFetch.clear()}}groupBlocks(g){const A=Array.from(g).sort((P,S)=>P-S);if(A.length===0)return[];let v=[],x=null;const k=[];for(const P of A)x===null||x+1===P?(v.push(P),x=P):(k.push(new Tr(v[0]*this.blockSize,v.length*this.blockSize,v)),v=[P],x=P);return k.push(new Tr(v[0]*this.blockSize,v.length*this.blockSize,v)),k}readSliceData(g,A){return g.map(v=>{let x=v.offset+v.length;this.fileSize!==null&&(x=Math.min(this.fileSize,x));const k=Math.floor(v.offset/this.blockSize),P=Math.floor(x/this.blockSize),S=new ArrayBuffer(v.length),V=new Uint8Array(S);for(let U=k;U<=P;++U){const q=A.get(U),re=q.offset-v.offset;let Z,N=0,se=0;re<0?N=-re:re>0&&(se=re),Z=q.top-x<0?q.length-N:x-q.offset-N;const ce=new Uint8Array(q.data,N,Z);V.set(ce,se)}return S})}}class tl{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(g){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Pr{constructor(g){this.url=g}async request({headers:g,signal:A}={}){throw new Error("request is not implemented")}}class Kr extends tl{constructor(g){super(),this.response=g}get status(){return this.response.status}getHeader(g){return this.response.headers.get(g)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class ha extends Pr{constructor(g,A){super(g),this.credentials=A}async request({headers:g,signal:A}={}){const v=await fetch(this.url,{headers:g,credentials:this.credentials,signal:A});return new Kr(v)}}class Ps extends tl{constructor(g,A){super(),this.xhr=g,this.data=A}get status(){return this.xhr.status}getHeader(g){return this.xhr.getResponseHeader(g)}async getData(){return this.data}}class ar extends Pr{constructRequest(g,A){return new Promise((v,x)=>{const k=new XMLHttpRequest;k.open("GET",this.url),k.responseType="arraybuffer";for(const[P,S]of Object.entries(g))k.setRequestHeader(P,S);k.onload=()=>{const P=k.response;v(new Ps(k,P))},k.onerror=x,k.onabort=()=>x(new In("Request aborted")),k.send(),A&&(A.aborted&&k.abort(),A.addEventListener("abort",()=>k.abort()))})}async request({headers:g,signal:A}={}){return await this.constructRequest(g,A)}}var ua={};class bn extends tl{constructor(g,A){super(),this.response=g,this.dataPromise=A}get status(){return this.response.statusCode}getHeader(g){return this.response.headers[g]}async getData(){return await this.dataPromise}}class er extends Pr{constructor(g){super(g),this.parsedUrl=ua.parse(this.url),this.httpApi=(this.parsedUrl.protocol,ua)}constructRequest(g,A){return new Promise((v,x)=>{const k=this.httpApi.get({...this.parsedUrl,headers:g},P=>{const S=new Promise(V=>{const U=[];P.on("data",q=>{U.push(q)}),P.on("end",()=>{const q=Buffer.concat(U).buffer;V(q)}),P.on("error",x)});v(new bn(P,S))});k.on("error",x),A&&(A.aborted&&k.destroy(new In("Request aborted")),A.addEventListener("abort",()=>k.destroy(new In("Request aborted"))))})}async request({headers:g,signal:A}={}){return await this.constructRequest(g,A)}}class Aa extends dr{constructor(g,A,v,x){super(),this.client=g,this.headers=A,this.maxRanges=v,this.allowFullFile=x,this._fileSize=null}async fetch(g,A){return this.maxRanges>=g.length?this.fetchSlices(g,A):(this.maxRanges>0&&g.length,Promise.all(g.map(v=>this.fetchSlice(v,A))))}async fetchSlices(g,A){const v=await this.client.request({headers:{...this.headers,Range:`bytes=${g.map(({offset:x,length:k})=>`${x}-${x+k}`).join(",")}`},signal:A});if(v.ok){if(v.status===206){const{type:x,params:k}=function(re){const[Z,...N]=re.split(";").map(se=>se.trim());return{type:Z,params:Pi(N.map(se=>se.split("=")))}}(v.getHeader("content-type"));if(x==="multipart/byteranges"){const re=function(Z,N){let se=null;const ce=new TextDecoder("ascii"),ae=[],Ae=`--${N}`,ve=`${Ae}--`;for(let Ie=0;Ie<10;++Ie)ce.decode(new Uint8Array(Z,Ie,Ae.length))===Ae&&(se=Ie);if(se===null)throw new Error("Could not find initial boundary");for(;se<Z.byteLength;){const Ie=ce.decode(new Uint8Array(Z,se,Math.min(Ae.length+1024,Z.byteLength-se)));if(Ie.length===0||Ie.startsWith(ve))break;if(!Ie.startsWith(Ae))throw new Error("Part does not start with boundary");const ke=Ie.substr(Ae.length+2);if(ke.length===0)break;const K=ke.indexOf(gi),G=ji(ke.substr(0,K)),{start:ue,end:ie,total:oe}=sr(G["content-range"]),de=se+Ae.length+K+4,Se=parseInt(ie,10)+1-parseInt(ue,10);ae.push({headers:G,data:Z.slice(de,de+Se),offset:ue,length:Se,fileSize:oe}),se=de+Se+4}return ae}(await v.getData(),k.boundary);return this._fileSize=re[0].fileSize||null,re}const P=await v.getData(),{start:S,end:V,total:U}=sr(v.getHeader("content-range"));this._fileSize=U||null;const q=[{data:P,offset:S,length:V-S}];if(g.length>1){const re=await Promise.all(g.slice(1).map(Z=>this.fetchSlice(Z,A)));return q.concat(re)}return q}{if(!this.allowFullFile)throw new Error("Server responded with full file");const x=await v.getData();return this._fileSize=x.byteLength,[{data:x,offset:0,length:x.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(g,A){const{offset:v,length:x}=g,k=await this.client.request({headers:{...this.headers,Range:`bytes=${v}-${v+x}`},signal:A});if(k.ok){if(k.status===206){const P=await k.getData(),{total:S}=sr(k.getHeader("content-range"));return this._fileSize=S||null,{data:P,offset:v,length:x}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const P=await k.getData();return this._fileSize=P.byteLength,{data:P,offset:0,length:P.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Zr(m,{blockSize:g,cacheSize:A}){return g===null?m:new Yr(m,{blockSize:g,cacheSize:A})}function il(m,{forceXHR:g=!1,...A}={}){return typeof fetch!="function"||g?typeof XMLHttpRequest<"u"?function(v,{headers:x={},maxRanges:k=0,allowFullFile:P=!1,...S}={}){const V=new ar(v);return Zr(new Aa(V,x,k,P),S)}(m,A):function(v,{headers:x={},maxRanges:k=0,allowFullFile:P=!1,...S}={}){const V=new er(v);return Zr(new Aa(V,x,k,P),S)}(m,A):function(v,{headers:x={},credentials:k,maxRanges:P=0,allowFullFile:S=!1,...V}={}){const U=new ha(v,k);return Zr(new Aa(U,x,P,S),V)}(m,A)}function wn(m,g){let A=m.length-g,v=0;do{for(let x=g;x>0;x--)m[v+g]+=m[v],v++;A-=g}while(A>0)}function _c(m,g,A){let v=0,x=m.length;const k=x/A;for(;x>g;){for(let S=g;S>0;--S)m[v+g]+=m[v],++v;x-=g}const P=m.slice();for(let S=0;S<k;++S)for(let V=0;V<A;++V)m[A*S+V]=P[(A-V-1)*k+S]}class Rn{async decode(g,A){const v=await this.decodeBlock(A),x=g.Predictor||1;if(x!==1){const k=!g.StripOffsets;return function(P,S,V,U,q,re){if(S===1)return P;for(let se=0;se<q.length;++se){if(q[se]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(q[se]!==q[0])throw new Error("When decoding with predictor, all samples must have the same size.")}const Z=q[0]/8,N=re===2?1:q.length;for(let se=0;se<U&&!(se*N*V*Z>=P.byteLength);++se){let ce;if(S===2){switch(q[0]){case 8:ce=new Uint8Array(P,se*N*V*Z,N*V*Z);break;case 16:ce=new Uint16Array(P,se*N*V*Z,N*V*Z/2);break;case 32:ce=new Uint32Array(P,se*N*V*Z,N*V*Z/4);break;default:throw new Error(`Predictor 2 not allowed with ${q[0]} bits per sample.`)}wn(ce,N)}else S===3&&(ce=new Uint8Array(P,se*N*V*Z,N*V*Z),_c(ce,N,Z))}return P}(v,x,k?g.TileWidth:g.ImageWidth,k?g.TileLength:g.RowsPerStrip||g.ImageLength,g.BitsPerSample,g.PlanarConfiguration)}return v}}function $n(m){switch(m){case Xt.BYTE:case Xt.ASCII:case Xt.SBYTE:case Xt.UNDEFINED:return 1;case Xt.SHORT:case Xt.SSHORT:return 2;case Xt.LONG:case Xt.SLONG:case Xt.FLOAT:case Xt.IFD:return 4;case Xt.RATIONAL:case Xt.SRATIONAL:case Xt.DOUBLE:case Xt.LONG8:case Xt.SLONG8:case Xt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${m}`)}}function $r(m,g,A,v){let x=null,k=null;const P=$n(g);switch(g){case Xt.BYTE:case Xt.ASCII:case Xt.UNDEFINED:x=new Uint8Array(A),k=m.readUint8;break;case Xt.SBYTE:x=new Int8Array(A),k=m.readInt8;break;case Xt.SHORT:x=new Uint16Array(A),k=m.readUint16;break;case Xt.SSHORT:x=new Int16Array(A),k=m.readInt16;break;case Xt.LONG:case Xt.IFD:x=new Uint32Array(A),k=m.readUint32;break;case Xt.SLONG:x=new Int32Array(A),k=m.readInt32;break;case Xt.LONG8:case Xt.IFD8:x=new Array(A),k=m.readUint64;break;case Xt.SLONG8:x=new Array(A),k=m.readInt64;break;case Xt.RATIONAL:x=new Uint32Array(2*A),k=m.readUint32;break;case Xt.SRATIONAL:x=new Int32Array(2*A),k=m.readInt32;break;case Xt.FLOAT:x=new Float32Array(A),k=m.readFloat32;break;case Xt.DOUBLE:x=new Float64Array(A),k=m.readFloat64;break;default:throw new RangeError(`Invalid field type: ${g}`)}if(g!==Xt.RATIONAL&&g!==Xt.SRATIONAL)for(let S=0;S<A;++S)x[S]=k.call(m,v+S*P);else for(let S=0;S<A;S+=2)x[S]=k.call(m,v+S*P),x[S+1]=k.call(m,v+(S*P+4));return g===Xt.ASCII?new TextDecoder("utf-8").decode(x):x}class Si{constructor(g,A,v){this.fileDirectory=g,this.geoKeyDirectory=A,this.nextIFDByteOffset=v}}class da extends Error{constructor(g){super(`No image at index ${g}`),this.index=g}}class rl{async readRasters(g={}){const{window:A,width:v,height:x}=g;let{resX:k,resY:P,bbox:S}=g;const V=await this.getImage();let U=V;const q=await this.getImageCount(),re=V.getBoundingBox();if(A&&S)throw new Error('Both "bbox" and "window" passed.');if(v||x){if(A){const[se,ce]=V.getOrigin(),[ae,Ae]=V.getResolution();S=[se+A[0]*ae,ce+A[1]*Ae,se+A[2]*ae,ce+A[3]*Ae]}const N=S||re;if(v){if(k)throw new Error("Both width and resX passed");k=(N[2]-N[0])/v}if(x){if(P)throw new Error("Both width and resY passed");P=(N[3]-N[1])/x}}if(k||P){const N=[];for(let se=0;se<q;++se){const ce=await this.getImage(se),{SubfileType:ae,NewSubfileType:Ae}=ce.fileDirectory;(se===0||ae===2||1&Ae)&&N.push(ce)}N.sort((se,ce)=>se.getWidth()-ce.getWidth());for(let se=0;se<N.length;++se){const ce=N[se],ae=(re[2]-re[0])/ce.getWidth(),Ae=(re[3]-re[1])/ce.getHeight();if(U=ce,k&&k>ae||P&&P>Ae)break}}let Z=A;if(S){const[N,se]=V.getOrigin(),[ce,ae]=U.getResolution(V);Z=[Math.round((S[0]-N)/ce),Math.round((S[1]-se)/ae),Math.round((S[2]-N)/ce),Math.round((S[3]-se)/ae)],Z=[Math.min(Z[0],Z[2]),Math.min(Z[1],Z[3]),Math.max(Z[0],Z[2]),Math.max(Z[1],Z[3])]}return U.readRasters({...g,window:Z})}}class Is extends rl{constructor(g,A,v,x,k={}){super(),this.source=g,this.littleEndian=A,this.bigTiff=v,this.firstIFDOffset=x,this.cache=k.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(g,A){const v=this.bigTiff?4048:1024;return new yi((await this.source.fetch([{offset:g,length:A!==void 0?A:v}]))[0],g,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(g){const A=this.bigTiff?20:12,v=this.bigTiff?8:2;let x=await this.getSlice(g);const k=this.bigTiff?x.readUint64(g):x.readUint16(g),P=k*A+(this.bigTiff?16:6);x.covers(g,P)||(x=await this.getSlice(g,P));const S={};let V=g+(this.bigTiff?8:2);for(let re=0;re<k;V+=A,++re){const Z=x.readUint16(V),N=x.readUint16(V+2),se=this.bigTiff?x.readUint64(V+4):x.readUint32(V+4);let ce,ae;const Ae=$n(N),ve=V+(this.bigTiff?12:8);if(Ae*se<=(this.bigTiff?8:4))ce=$r(x,N,se,ve);else{const Ie=x.readOffset(ve),ke=$n(N)*se;x.covers(Ie,ke)?ce=$r(x,N,se,Ie):ce=$r(await this.getSlice(Ie,ke),N,se,Ie)}ae=se===1&&di.indexOf(Z)===-1&&N!==Xt.RATIONAL&&N!==Xt.SRATIONAL?ce[0]:ce,S[cn[Z]]=ae}const U=function(re){const Z=re.GeoKeyDirectory;if(!Z)return null;const N={};for(let se=4;se<=4*Z[3];se+=4){const ce=Me[Z[se]],ae=Z[se+1]?cn[Z[se+1]]:null,Ae=Z[se+2],ve=Z[se+3];let Ie=null;if(ae){if(Ie=re[ae],Ie==null)throw new Error(`Could not get value of geoKey '${ce}'.`);typeof Ie=="string"?Ie=Ie.substring(ve,ve+Ae-1):Ie.subarray&&(Ie=Ie.subarray(ve,ve+Ae),Ae===1&&(Ie=Ie[0]))}else Ie=ve;N[ce]=Ie}return N}(S),q=x.readOffset(g+v+A*k);return new Si(S,U,q)}async requestIFD(g){if(this.ifdRequests[g])return this.ifdRequests[g];if(g===0)return this.ifdRequests[g]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[g];if(!this.ifdRequests[g-1])try{this.ifdRequests[g-1]=this.requestIFD(g-1)}catch(A){throw A instanceof da?new da(g):A}return this.ifdRequests[g]=(async()=>{const A=await this.ifdRequests[g-1];if(A.nextIFDByteOffset===0)throw new da(g);return this.parseFileDirectoryAt(A.nextIFDByteOffset)})(),this.ifdRequests[g]}async getImage(g=0){const A=await this.requestIFD(g);return new hi(A.fileDirectory,A.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let g=0,A=!0;for(;A;)try{await this.requestIFD(g),++g}catch(v){if(!(v instanceof da))throw v;A=!1}return g}async getGhostValues(){const g=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const A="GDAL_STRUCTURAL_METADATA_SIZE=";let v=await this.getSlice(g,130);if(A===$r(v,Xt.ASCII,30,g)){const x=$r(v,Xt.ASCII,130,g).split(`
`)[0],k=Number(x.split("=")[1].split(" ")[0])+x.length;k>130&&(v=await this.getSlice(g,k));const P=$r(v,Xt.ASCII,k,g);this.ghostValues={},P.split(`
`).filter(S=>S.length>0).map(S=>S.split("=")).forEach(([S,V])=>{this.ghostValues[S]=V})}return this.ghostValues}static async fromSource(g,A,v){const x=(await g.fetch([{offset:0,length:1024}],v))[0],k=new Ei(x),P=k.getUint16(0,0);let S;if(P===18761)S=!0;else{if(P!==19789)throw new TypeError("Invalid byte order value.");S=!1}const V=k.getUint16(2,S);let U;if(V===42)U=!1;else{if(V!==43)throw new TypeError("Invalid magic number.");if(U=!0,k.getUint16(4,S)!==8)throw new Error("Unsupported offset byte-size.")}const q=U?k.getUint64(8,S):k.getUint32(4,S);return new Is(g,S,U,q,A)}close(){return typeof this.source.close=="function"&&this.source.close()}}var co={exports:{}};(function(m,g){var A=function(){var v={},x=Math.PI/180,k=180/Math.PI,P=6378137,S=20037508342789244e-9;function V(q){return Number(q)===q&&q%1!=0}function U(q){if(q=q||{},this.size=q.size||256,this.expansion=q.antimeridian===!0?2:1,!v[this.size]){var re=this.size,Z=v[this.size]={};Z.Bc=[],Z.Cc=[],Z.zc=[],Z.Ac=[];for(var N=0;N<30;N++)Z.Bc.push(re/360),Z.Cc.push(re/(2*Math.PI)),Z.zc.push(re/2),Z.Ac.push(re),re*=2}this.Bc=v[this.size].Bc,this.Cc=v[this.size].Cc,this.zc=v[this.size].zc,this.Ac=v[this.size].Ac}return U.prototype.px=function(q,re){if(V(re)){var Z=this.size*Math.pow(2,re),N=Z/2,se=Z/360,ce=Z/(2*Math.PI),ae=Z,Ae=Math.min(Math.max(Math.sin(x*q[1]),-.9999),.9999),ve=N+q[0]*se,Ie=N+.5*Math.log((1+Ae)/(1-Ae))*-ce;return ve>ae*this.expansion&&(ve=ae*this.expansion),Ie>ae&&(Ie=ae),[ve,Ie]}return N=this.zc[re],Ae=Math.min(Math.max(Math.sin(x*q[1]),-.9999),.9999),ve=Math.round(N+q[0]*this.Bc[re]),Ie=Math.round(N+.5*Math.log((1+Ae)/(1-Ae))*-this.Cc[re]),ve>this.Ac[re]*this.expansion&&(ve=this.Ac[re]*this.expansion),Ie>this.Ac[re]&&(Ie=this.Ac[re]),[ve,Ie]},U.prototype.ll=function(q,re){if(V(re)){var Z=this.size*Math.pow(2,re),N=Z/360,se=Z/(2*Math.PI),ce=Z/2,ae=(q[1]-ce)/-se;return[(q[0]-ce)/N,k*(2*Math.atan(Math.exp(ae))-.5*Math.PI)]}return ae=(q[1]-this.zc[re])/-this.Cc[re],[(q[0]-this.zc[re])/this.Bc[re],k*(2*Math.atan(Math.exp(ae))-.5*Math.PI)]},U.prototype.bbox=function(q,re,Z,N,se){N&&(re=Math.pow(2,Z)-1-re);var ce=[q*this.size,(+re+1)*this.size],ae=[(+q+1)*this.size,re*this.size],Ae=this.ll(ce,Z).concat(this.ll(ae,Z));return se==="900913"?this.convert(Ae,"900913"):Ae},U.prototype.xyz=function(q,re,Z,N){N==="900913"&&(q=this.convert(q,"WGS84"));var se=[q[0],q[1]],ce=[q[2],q[3]],ae=this.px(se,re),Ae=this.px(ce,re),ve=[Math.floor(ae[0]/this.size),Math.floor((Ae[0]-1)/this.size)],Ie=[Math.floor(Ae[1]/this.size),Math.floor((ae[1]-1)/this.size)],ke={minX:Math.min.apply(Math,ve)<0?0:Math.min.apply(Math,ve),minY:Math.min.apply(Math,Ie)<0?0:Math.min.apply(Math,Ie),maxX:Math.max.apply(Math,ve),maxY:Math.max.apply(Math,Ie)};if(Z){var K={minY:Math.pow(2,re)-1-ke.maxY,maxY:Math.pow(2,re)-1-ke.minY};ke.minY=K.minY,ke.maxY=K.maxY}return ke},U.prototype.convert=function(q,re){return re==="900913"?this.forward(q.slice(0,2)).concat(this.forward(q.slice(2,4))):this.inverse(q.slice(0,2)).concat(this.inverse(q.slice(2,4)))},U.prototype.forward=function(q){var re=[P*q[0]*x,P*Math.log(Math.tan(.25*Math.PI+.5*q[1]*x))];return re[0]>S&&(re[0]=S),re[0]<-S&&(re[0]=-S),re[1]>S&&(re[1]=S),re[1]<-S&&(re[1]=-S),re},U.prototype.inverse=function(q){return[q[0]*k/P,(.5*Math.PI-2*Math.atan(Math.exp(-q[1]/P)))*k]},U}();m.exports=A})(co);const vn=256,Wn=4007501668557849e-8,Ls=new(br(co.exports))({size:vn,antimeridian:!0}),fa=({x:m,y:g,z:A})=>Ls.bbox(m,g,A,!1,"900913"),ho=36e5;let nl;const sl=new fr({maxSize:16,maxAge:ho}),Ol=new fr({maxSize:16,maxAge:ho}),bs=new fr({maxSize:1024,maxAge:ho}),Rs=m=>{nl===void 0&&(nl=new Ki);const g=v=>{const x=sl.get(v);if(x)return x;{const k=async function(P,S={},V){return Is.fromSource(il(P,S),V)}(v);return sl.set(v,k),k}},A=async()=>{var k;const v=Ol.get(m);if(v)return v;{const P=await g(m),S=await P.getImage(),V=S.getGDALMetadata(0),U=S.fileDirectory,q=(k=S.fileDirectory)==null?void 0:k.Artist,re=(([ce,ae,Ae,ve])=>[...Ls.inverse([ce,ae]),...Ls.inverse([Ae,ve])])(S.getBoundingBox()),Z=[],N=await P.getImageCount();for(let ce=0;ce<N;ce++){const ae=await P.getImage(ce),Ae=(x=ae.getResolution(S)[0],Math.log2(Wn/(vn*x))),ve=!!(1&ae.fileDirectory.NewSubfileType),Ie=!!(4&ae.fileDirectory.NewSubfileType);Z.push({zoom:Ae,isOverview:ve,isMask:Ie})}const se={offset:(V==null?void 0:V.OFFSET)!==void 0?parseFloat(V.OFFSET):0,scale:(V==null?void 0:V.SCALE)!==void 0?parseFloat(V.SCALE):1,noData:S.getGDALNoData()??void 0,photometricInterpretation:U==null?void 0:U.PhotometricInterpretation,bitsPerSample:U==null?void 0:U.BitsPerSample,colorMap:U==null?void 0:U.ColorMap,artist:q,bbox:re,images:Z};return Ol.set(m,se),se}var x};return{getTilejson:async v=>{const{artist:x,images:k,bbox:P}=await A(),S=k.map(V=>V.zoom);return{tilejson:"2.2.0",tiles:[v+"/{z}/{x}/{y}"],attribution:x,minzoom:Math.round(Math.min(...S)),maxzoom:Math.round(Math.max(...S)),bounds:P}},getMetadata:A,getRawTile:async({z:v,x,y:k},P=256)=>{const S=`${m}/${P}/${v}/${x}/${k}`,V=bs.get(S);if(V)return V;{const U=await g(m),{noData:q}=await A(),re=q===void 0||isNaN(q)?1/0:q,Z=U.readRasters({bbox:fa({x,y:k,z:v}),width:P,height:P,interleave:!1,resampleMethod:"nearest",pool:nl,fillValue:re});return bs.set(S,Z),Z}}}};function yr(m,g){return m==null||g==null?NaN:m<g?-1:m>g?1:m>=g?0:NaN}function Lr(m,g){return m==null||g==null?NaN:g<m?-1:g>m?1:g>=m?0:NaN}function Ga(m){let g,A,v;function x(k,P,S=0,V=k.length){if(S<V){if(g(P,P)!==0)return V;do{const U=S+V>>>1;A(k[U],P)<0?S=U+1:V=U}while(S<V)}return S}return m.length!==2?(g=yr,A=(k,P)=>yr(m(k),P),v=(k,P)=>m(k)-P):(g=m===yr||m===Lr?m:uo,A=m,v=m),{left:x,center:function(k,P,S=0,V=k.length){const U=x(k,P,S,V-1);return U>S&&v(k[U-1],P)>-v(k[U],P)?U-1:U},right:function(k,P,S=0,V=k.length){if(S<V){if(g(P,P)!==0)return V;do{const U=S+V>>>1;A(k[U],P)<=0?S=U+1:V=U}while(S<V)}return S}}}function uo(){return 0}const Ua=Ga(yr).right;Ga(function(m){return m===null?NaN:+m}).center;const ql=Math.sqrt(50),ga=Math.sqrt(10),Ic=Math.sqrt(2);function Na(m,g,A){const v=(g-m)/Math.max(0,A),x=Math.floor(Math.log10(v)),k=v/Math.pow(10,x),P=k>=ql?10:k>=ga?5:k>=Ic?2:1;let S,V,U;return x<0?(U=Math.pow(10,-x)/P,S=Math.round(m*U),V=Math.round(g*U),S/U<m&&++S,V/U>g&&--V,U=-U):(U=Math.pow(10,x)*P,S=Math.round(m/U),V=Math.round(g/U),S*U<m&&++S,V*U>g&&--V),V<S&&.5<=A&&A<2?Na(m,g,2*A):[S,V,U]}function Ao(m,g,A){return Na(m=+m,g=+g,A=+A)[2]}function Vl(m,g){switch(arguments.length){case 0:break;case 1:this.range(m);break;default:this.range(g).domain(m)}return this}function al(m,g,A){m.prototype=g.prototype=A,A.constructor=m}function ol(m,g){var A=Object.create(m.prototype);for(var v in g)A[v]=g[v];return A}function Xn(){}var Fs=.7,zs=1/Fs,ws="\\s*([+-]?\\d+)\\s*",Gs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",hr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bc=/^#([0-9a-f]{3,8})$/,ll=new RegExp(`^rgb\\(${ws},${ws},${ws}\\)$`),Us=new RegExp(`^rgb\\(${hr},${hr},${hr}\\)$`),vs=new RegExp(`^rgba\\(${ws},${ws},${ws},${Gs}\\)$`),Di=new RegExp(`^rgba\\(${hr},${hr},${hr},${Gs}\\)$`),fo=new RegExp(`^hsl\\(${Gs},${hr},${hr}\\)$`),wc=new RegExp(`^hsla\\(${Gs},${hr},${hr},${Gs}\\)$`),Ns={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Hl(){return this.rgb().formatHex()}function cl(){return this.rgb().formatRgb()}function Oa(m){var g,A;return m=(m+"").trim().toLowerCase(),(g=bc.exec(m))?(A=g[1].length,g=parseInt(g[1],16),A===6?hl(g):A===3?new Qr(g>>8&15|g>>4&240,g>>4&15|240&g,(15&g)<<4|15&g,1):A===8?pa(g>>24&255,g>>16&255,g>>8&255,(255&g)/255):A===4?pa(g>>12&15|g>>8&240,g>>8&15|g>>4&240,g>>4&15|240&g,((15&g)<<4|15&g)/255):null):(g=ll.exec(m))?new Qr(g[1],g[2],g[3],1):(g=Us.exec(m))?new Qr(255*g[1]/100,255*g[2]/100,255*g[3]/100,1):(g=vs.exec(m))?pa(g[1],g[2],g[3],g[4]):(g=Di.exec(m))?pa(255*g[1]/100,255*g[2]/100,255*g[3]/100,g[4]):(g=fo.exec(m))?dl(g[1],g[2]/100,g[3]/100,1):(g=wc.exec(m))?dl(g[1],g[2]/100,g[3]/100,g[4]):Ns.hasOwnProperty(m)?hl(Ns[m]):m==="transparent"?new Qr(NaN,NaN,NaN,0):null}function hl(m){return new Qr(m>>16&255,m>>8&255,255&m,1)}function pa(m,g,A,v){return v<=0&&(m=g=A=NaN),new Qr(m,g,A,v)}function go(m,g,A,v){return arguments.length===1?((x=m)instanceof Xn||(x=Oa(x)),x?new Qr((x=x.rgb()).r,x.g,x.b,x.opacity):new Qr):new Qr(m,g,A,v??1);var x}function Qr(m,g,A,v){this.r=+m,this.g=+g,this.b=+A,this.opacity=+v}function ul(){return`#${Os(this.r)}${Os(this.g)}${Os(this.b)}`}function Al(){const m=Fn(this.opacity);return`${m===1?"rgb(":"rgba("}${xs(this.r)}, ${xs(this.g)}, ${xs(this.b)}${m===1?")":`, ${m})`}`}function Fn(m){return isNaN(m)?1:Math.max(0,Math.min(1,m))}function xs(m){return Math.max(0,Math.min(255,Math.round(m)||0))}function Os(m){return((m=xs(m))<16?"0":"")+m.toString(16)}function dl(m,g,A,v){return v<=0?m=g=A=NaN:A<=0||A>=1?m=g=NaN:g<=0&&(m=NaN),new xn(m,g,A,v)}function ma(m){if(m instanceof xn)return new xn(m.h,m.s,m.l,m.opacity);if(m instanceof Xn||(m=Oa(m)),!m)return new xn;if(m instanceof xn)return m;var g=(m=m.rgb()).r/255,A=m.g/255,v=m.b/255,x=Math.min(g,A,v),k=Math.max(g,A,v),P=NaN,S=k-x,V=(k+x)/2;return S?(P=g===k?(A-v)/S+6*(A<v):A===k?(v-g)/S+2:(g-A)/S+4,S/=V<.5?k+x:2-k-x,P*=60):S=V>0&&V<1?0:P,new xn(P,S,V,m.opacity)}function xn(m,g,A,v){this.h=+m,this.s=+g,this.l=+A,this.opacity=+v}function qa(m){return(m=(m||0)%360)<0?m+360:m}function po(m){return Math.max(0,Math.min(1,m||0))}function fl(m,g,A){return 255*(m<60?g+(A-g)*m/60:m<180?A:m<240?g+(A-g)*(240-m)/60:g)}al(Xn,Oa,{copy(m){return Object.assign(new this.constructor,this,m)},displayable(){return this.rgb().displayable()},hex:Hl,formatHex:Hl,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return ma(this).formatHsl()},formatRgb:cl,toString:cl}),al(Qr,go,ol(Xn,{brighter(m){return m=m==null?zs:Math.pow(zs,m),new Qr(this.r*m,this.g*m,this.b*m,this.opacity)},darker(m){return m=m==null?Fs:Math.pow(Fs,m),new Qr(this.r*m,this.g*m,this.b*m,this.opacity)},rgb(){return this},clamp(){return new Qr(xs(this.r),xs(this.g),xs(this.b),Fn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ul,formatHex:ul,formatHex8:function(){return`#${Os(this.r)}${Os(this.g)}${Os(this.b)}${Os(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Al,toString:Al})),al(xn,function(m,g,A,v){return arguments.length===1?ma(m):new xn(m,g,A,v??1)},ol(Xn,{brighter(m){return m=m==null?zs:Math.pow(zs,m),new xn(this.h,this.s,this.l*m,this.opacity)},darker(m){return m=m==null?Fs:Math.pow(Fs,m),new xn(this.h,this.s,this.l*m,this.opacity)},rgb(){var m=this.h%360+360*(this.h<0),g=isNaN(m)||isNaN(this.s)?0:this.s,A=this.l,v=A+(A<.5?A:1-A)*g,x=2*A-v;return new Qr(fl(m>=240?m-240:m+120,x,v),fl(m,x,v),fl(m<120?m+240:m-120,x,v),this.opacity)},clamp(){return new xn(qa(this.h),po(this.s),po(this.l),Fn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const m=Fn(this.opacity);return`${m===1?"hsl(":"hsla("}${qa(this.h)}, ${100*po(this.s)}%, ${100*po(this.l)}%${m===1?")":`, ${m})`}`}}));var mo=m=>()=>m;function jl(m){return(m=+m)==1?gl:function(g,A){return A-g?function(v,x,k){return v=Math.pow(v,k),x=Math.pow(x,k)-v,k=1/k,function(P){return Math.pow(v+P*x,k)}}(g,A,m):mo(isNaN(g)?A:g)}}function gl(m,g){var A=g-m;return A?function(v,x){return function(k){return v+k*x}}(m,A):mo(isNaN(m)?g:m)}var yo=function m(g){var A=jl(g);function v(x,k){var P=A((x=go(x)).r,(k=go(k)).r),S=A(x.g,k.g),V=A(x.b,k.b),U=gl(x.opacity,k.opacity);return function(q){return x.r=P(q),x.g=S(q),x.b=V(q),x.opacity=U(q),x+""}}return v.gamma=m,v}(1);function Jl(m,g){g||(g=[]);var A,v=m?Math.min(g.length,m.length):0,x=g.slice();return function(k){for(A=0;A<v;++A)x[A]=m[A]*(1-k)+g[A]*k;return x}}function _o(m,g){var A,v=g?g.length:0,x=m?Math.min(v,m.length):0,k=new Array(x),P=new Array(v);for(A=0;A<x;++A)k[A]=ts(m[A],g[A]);for(;A<v;++A)P[A]=g[A];return function(S){for(A=0;A<x;++A)P[A]=k[A](S);return P}}function es(m,g){var A=new Date;return m=+m,g=+g,function(v){return A.setTime(m*(1-v)+g*v),A}}function ya(m,g){return m=+m,g=+g,function(A){return m*(1-A)+g*A}}function pl(m,g){var A,v={},x={};for(A in m!==null&&typeof m=="object"||(m={}),g!==null&&typeof g=="object"||(g={}),g)A in m?v[A]=ts(m[A],g[A]):x[A]=g[A];return function(k){for(A in v)x[A]=v[A](k);return x}}var Va=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_a=new RegExp(Va.source,"g");function ml(m,g){var A,v,x,k=Va.lastIndex=_a.lastIndex=0,P=-1,S=[],V=[];for(m+="",g+="";(A=Va.exec(m))&&(v=_a.exec(g));)(x=v.index)>k&&(x=g.slice(k,x),S[P]?S[P]+=x:S[++P]=x),(A=A[0])===(v=v[0])?S[P]?S[P]+=v:S[++P]=v:(S[++P]=null,V.push({i:P,x:ya(A,v)})),k=_a.lastIndex;return k<g.length&&(x=g.slice(k),S[P]?S[P]+=x:S[++P]=x),S.length<2?V[0]?function(U){return function(q){return U(q)+""}}(V[0].x):function(U){return function(){return U}}(g):(g=V.length,function(U){for(var q,re=0;re<g;++re)S[(q=V[re]).i]=q.x(U);return S.join("")})}function ts(m,g){var A,v,x=typeof g;return g==null||x==="boolean"?mo(g):(x==="number"?ya:x==="string"?(A=Oa(g))?(g=A,yo):ml:g instanceof Oa?yo:g instanceof Date?es:(v=g,!ArrayBuffer.isView(v)||v instanceof DataView?Array.isArray(g)?_o:typeof g.valueOf!="function"&&typeof g.toString!="function"||isNaN(g)?pl:ya:Jl))(m,g)}function yl(m,g){return m=+m,g=+g,function(A){return Math.round(m*(1-A)+g*A)}}function vc(m){return+m}var Zi=[0,1];function Ia(m){return m}function fi(m,g){return(g-=m=+m)?function(v){return(v-m)/g}:(A=isNaN(g)?NaN:.5,function(){return A});var A}function Io(m,g,A){var v=m[0],x=m[1],k=g[0],P=g[1];return x<v?(v=fi(x,v),k=A(P,k)):(v=fi(v,x),k=A(k,P)),function(S){return k(v(S))}}function Ui(m,g,A){var v=Math.min(m.length,g.length)-1,x=new Array(v),k=new Array(v),P=-1;for(m[v]<m[0]&&(m=m.slice().reverse(),g=g.slice().reverse());++P<v;)x[P]=fi(m[P],m[P+1]),k[P]=A(g[P],g[P+1]);return function(S){var V=Ua(m,S,1,v)-1;return k[V](x[V](S))}}function Fi(){var m,g,A,v,x,k,P=Zi,S=Zi,V=ts,U=Ia;function q(){var Z,N,se,ce=Math.min(P.length,S.length);return U!==Ia&&(Z=P[0],N=P[ce-1],Z>N&&(se=Z,Z=N,N=se),U=function(ae){return Math.max(Z,Math.min(N,ae))}),v=ce>2?Ui:Io,x=k=null,re}function re(Z){return Z==null||isNaN(Z=+Z)?A:(x||(x=v(P.map(m),S,V)))(m(U(Z)))}return re.invert=function(Z){return U(g((k||(k=v(S,P.map(m),ya)))(Z)))},re.domain=function(Z){return arguments.length?(P=Array.from(Z,vc),q()):P.slice()},re.range=function(Z){return arguments.length?(S=Array.from(Z),q()):S.slice()},re.rangeRound=function(Z){return S=Array.from(Z),V=yl,q()},re.clamp=function(Z){return arguments.length?(U=!!Z||Ia,q()):U!==Ia},re.interpolate=function(Z){return arguments.length?(V=Z,q()):V},re.unknown=function(Z){return arguments.length?(A=Z,re):A},function(Z,N){return m=Z,g=N,q()}}function zn(m,g){if((A=(m=g?m.toExponential(g-1):m.toExponential()).indexOf("e"))<0)return null;var A,v=m.slice(0,A);return[v.length>1?v[0]+v.slice(2):v,+m.slice(A+1)]}function Gn(m){return(m=zn(Math.abs(m)))?m[1]:NaN}var ba,_l=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Un(m){if(!(g=_l.exec(m)))throw new Error("invalid format: "+m);var g;return new Bs({fill:g[1],align:g[2],sign:g[3],symbol:g[4],zero:g[5],width:g[6],comma:g[7],precision:g[8]&&g[8].slice(1),trim:g[9],type:g[10]})}function Bs(m){this.fill=m.fill===void 0?" ":m.fill+"",this.align=m.align===void 0?">":m.align+"",this.sign=m.sign===void 0?"-":m.sign+"",this.symbol=m.symbol===void 0?"":m.symbol+"",this.zero=!!m.zero,this.width=m.width===void 0?void 0:+m.width,this.comma=!!m.comma,this.precision=m.precision===void 0?void 0:+m.precision,this.trim=!!m.trim,this.type=m.type===void 0?"":m.type+""}function Wr(m,g){var A=zn(m,g);if(!A)return m+"";var v=A[0],x=A[1];return x<0?"0."+new Array(-x).join("0")+v:v.length>x+1?v.slice(0,x+1)+"."+v.slice(x+1):v+new Array(x-v.length+2).join("0")}Un.prototype=Bs.prototype,Bs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var bo={"%":(m,g)=>(100*m).toFixed(g),b:m=>Math.round(m).toString(2),c:m=>m+"",d:function(m){return Math.abs(m=Math.round(m))>=1e21?m.toLocaleString("en").replace(/,/g,""):m.toString(10)},e:(m,g)=>m.toExponential(g),f:(m,g)=>m.toFixed(g),g:(m,g)=>m.toPrecision(g),o:m=>Math.round(m).toString(8),p:(m,g)=>Wr(100*m,g),r:Wr,s:function(m,g){var A=zn(m,g);if(!A)return m+"";var v=A[0],x=A[1],k=x-(ba=3*Math.max(-8,Math.min(8,Math.floor(x/3))))+1,P=v.length;return k===P?v:k>P?v+new Array(k-P+1).join("0"):k>0?v.slice(0,k)+"."+v.slice(k):"0."+new Array(1-k).join("0")+zn(m,Math.max(0,g+k-1))[0]},X:m=>Math.round(m).toString(16).toUpperCase(),x:m=>Math.round(m).toString(16)};function wo(m){return m}var Ha,Cs,wa,va=Array.prototype.map,qs=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ja(m){var g,A,v=m.grouping===void 0||m.thousands===void 0?wo:(g=va.call(m.grouping,Number),A=m.thousands+"",function(Z,N){for(var se=Z.length,ce=[],ae=0,Ae=g[0],ve=0;se>0&&Ae>0&&(ve+Ae+1>N&&(Ae=Math.max(1,N-ve)),ce.push(Z.substring(se-=Ae,se+Ae)),!((ve+=Ae+1)>N));)Ae=g[ae=(ae+1)%g.length];return ce.reverse().join(A)}),x=m.currency===void 0?"":m.currency[0]+"",k=m.currency===void 0?"":m.currency[1]+"",P=m.decimal===void 0?".":m.decimal+"",S=m.numerals===void 0?wo:function(Z){return function(N){return N.replace(/[0-9]/g,function(se){return Z[+se]})}}(va.call(m.numerals,String)),V=m.percent===void 0?"%":m.percent+"",U=m.minus===void 0?"":m.minus+"",q=m.nan===void 0?"NaN":m.nan+"";function re(Z){var N=(Z=Un(Z)).fill,se=Z.align,ce=Z.sign,ae=Z.symbol,Ae=Z.zero,ve=Z.width,Ie=Z.comma,ke=Z.precision,K=Z.trim,G=Z.type;G==="n"?(Ie=!0,G="g"):bo[G]||(ke===void 0&&(ke=12),K=!0,G="g"),(Ae||N==="0"&&se==="=")&&(Ae=!0,N="0",se="=");var ue=ae==="$"?x:ae==="#"&&/[boxX]/.test(G)?"0"+G.toLowerCase():"",ie=ae==="$"?k:/[%p]/.test(G)?V:"",oe=bo[G],de=/[defgprs%]/.test(G);function Se(Be){var Qe,Ge,He,Ke=ue,tt=ie;if(G==="c")tt=oe(Be)+tt,Be="";else{var mt=(Be=+Be)<0||1/Be<0;if(Be=isNaN(Be)?q:oe(Math.abs(Be),ke),K&&(Be=function(et){e:for(var Dt,At=et.length,Lt=1,ht=-1;Lt<At;++Lt)switch(et[Lt]){case".":ht=Dt=Lt;break;case"0":ht===0&&(ht=Lt),Dt=Lt;break;default:if(!+et[Lt])break e;ht>0&&(ht=0)}return ht>0?et.slice(0,ht)+et.slice(Dt+1):et}(Be)),mt&&+Be==0&&ce!=="+"&&(mt=!1),Ke=(mt?ce==="("?ce:U:ce==="-"||ce==="("?"":ce)+Ke,tt=(G==="s"?qs[8+ba/3]:"")+tt+(mt&&ce==="("?")":""),de){for(Qe=-1,Ge=Be.length;++Qe<Ge;)if(48>(He=Be.charCodeAt(Qe))||He>57){tt=(He===46?P+Be.slice(Qe+1):Be.slice(Qe))+tt,Be=Be.slice(0,Qe);break}}}Ie&&!Ae&&(Be=v(Be,1/0));var Oe=Ke.length+Be.length+tt.length,Fe=Oe<ve?new Array(ve-Oe+1).join(N):"";switch(Ie&&Ae&&(Be=v(Fe+Be,Fe.length?ve-tt.length:1/0),Fe=""),se){case"<":Be=Ke+Be+tt+Fe;break;case"=":Be=Ke+Fe+Be+tt;break;case"^":Be=Fe.slice(0,Oe=Fe.length>>1)+Ke+Be+tt+Fe.slice(Oe);break;default:Be=Fe+Ke+Be+tt}return S(Be)}return ke=ke===void 0?6:/[gprs]/.test(G)?Math.max(1,Math.min(21,ke)):Math.max(0,Math.min(20,ke)),Se.toString=function(){return Z+""},Se}return{format:re,formatPrefix:function(Z,N){var se=re(((Z=Un(Z)).type="f",Z)),ce=3*Math.max(-8,Math.min(8,Math.floor(Gn(N)/3))),ae=Math.pow(10,-ce),Ae=qs[8+ce/3];return function(ve){return se(ae*ve)+Ae}}}}function vo(m,g,A,v){var x,k=function(S,V,U){U=+U;const q=(V=+V)<(S=+S),re=q?Ao(V,S,U):Ao(S,V,U);return(q?-1:1)*(re<0?1/-re:re)}(m,g,A);switch((v=Un(v??",f")).type){case"s":var P=Math.max(Math.abs(m),Math.abs(g));return v.precision!=null||isNaN(x=function(S,V){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Gn(V)/3)))-Gn(Math.abs(S)))}(k,P))||(v.precision=x),wa(v,P);case"":case"e":case"g":case"p":case"r":v.precision!=null||isNaN(x=function(S,V){return S=Math.abs(S),V=Math.abs(V)-S,Math.max(0,Gn(V)-Gn(S))+1}(k,Math.max(Math.abs(m),Math.abs(g))))||(v.precision=x-(v.type==="e"));break;case"f":case"%":v.precision!=null||isNaN(x=function(S){return Math.max(0,-Gn(Math.abs(S)))}(k))||(v.precision=x-2*(v.type==="%"))}return Cs(v)}function xa(m){var g=m.domain;return m.ticks=function(A){var v=g();return function(x,k,P){if(!((P=+P)>0))return[];if((x=+x)==(k=+k))return[x];const S=k<x,[V,U,q]=S?Na(k,x,P):Na(x,k,P);if(!(U>=V))return[];const re=U-V+1,Z=new Array(re);if(S)if(q<0)for(let N=0;N<re;++N)Z[N]=(U-N)/-q;else for(let N=0;N<re;++N)Z[N]=(U-N)*q;else if(q<0)for(let N=0;N<re;++N)Z[N]=(V+N)/-q;else for(let N=0;N<re;++N)Z[N]=(V+N)*q;return Z}(v[0],v[v.length-1],A??10)},m.tickFormat=function(A,v){var x=g();return vo(x[0],x[x.length-1],A??10,v)},m.nice=function(A){A==null&&(A=10);var v,x,k=g(),P=0,S=k.length-1,V=k[P],U=k[S],q=10;for(U<V&&(x=V,V=U,U=x,x=P,P=S,S=x);q-- >0;){if((x=Ao(V,U,A))===v)return k[P]=V,k[S]=U,g(k);if(x>0)V=Math.floor(V/x)*x,U=Math.ceil(U/x)*x;else{if(!(x<0))break;V=Math.ceil(V*x)/x,U=Math.floor(U*x)/x}v=x}return m},m}function Vs(){var m=Fi()(Ia,Ia);return m.copy=function(){return g=m,Vs().domain(g.domain()).range(g.range()).interpolate(g.interpolate()).clamp(g.clamp()).unknown(g.unknown());var g},Vl.apply(m,arguments),xa(m)}function Il(){var m,g=[.5],A=[0,1],v=1;function x(k){return k!=null&&k<=k?A[Ua(g,k,0,v)]:m}return x.domain=function(k){return arguments.length?(g=Array.from(k),v=Math.min(g.length,A.length-1),x):g.slice()},x.range=function(k){return arguments.length?(A=Array.from(k),v=Math.min(g.length,A.length-1),x):A.slice()},x.invertExtent=function(k){var P=A.indexOf(k);return[g[P-1],g[P]]},x.unknown=function(k){return arguments.length?(m=k,x):m},x.copy=function(){return Il().domain(g).range(A).unknown(m)},Vl.apply(x,arguments)}Ha=ja({thousands:",",grouping:[3],currency:["$",""]}),Cs=Ha.format,wa=Ha.formatPrefix;const xo={BrewerYlGn3:["#f7fcb9","#addd8e","#31a354"],BrewerYlGn4:["#ffffcc","#c2e699","#78c679","#238443"],BrewerYlGn5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],BrewerYlGn6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],BrewerYlGn7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],BrewerYlGn9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],BrewerYlGnBu3:["#edf8b1","#7fcdbb","#2c7fb8"],BrewerYlGnBu4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],BrewerYlGnBu5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],BrewerYlGnBu7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],BrewerYlGnBu9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],BrewerGnBu3:["#e0f3db","#a8ddb5","#43a2ca"],BrewerGnBu4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],BrewerGnBu5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],BrewerGnBu7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],BrewerGnBu9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],BrewerBuGn3:["#e5f5f9","#99d8c9","#2ca25f"],BrewerBuGn4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],BrewerBuGn5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],BrewerBuGn7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],BrewerBuGn9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],BrewerPuBuGn3:["#ece2f0","#a6bddb","#1c9099"],BrewerPuBuGn4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],BrewerPuBuGn5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],BrewerPuBuGn7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],BrewerPuBuGn9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],BrewerPuBu3:["#ece7f2","#a6bddb","#2b8cbe"],BrewerPuBu4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],BrewerPuBu5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],BrewerPuBu7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],BrewerPuBu9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BrewerBuPu3:["#e0ecf4","#9ebcda","#8856a7"],BrewerBuPu4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],BrewerBuPu5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],BrewerBuPu6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],BrewerBuPu7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],BrewerBuPu9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],BrewerRdPu3:["#fde0dd","#fa9fb5","#c51b8a"],BrewerRdPu4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],BrewerRdPu5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],BrewerRdPu6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],BrewerRdPu7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],BrewerRdPu9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],BrewerPuRd3:["#e7e1ef","#c994c7","#dd1c77"],BrewerPuRd4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],BrewerPuRd5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],BrewerPuRd6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],BrewerPuRd7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],BrewerPuRd9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],BrewerOrRd3:["#fee8c8","#fdbb84","#e34a33"],BrewerOrRd4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],BrewerOrRd5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],BrewerOrRd6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],BrewerOrRd7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],BrewerOrRd9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],BrewerYlOrRd3:["#ffeda0","#feb24c","#f03b20"],BrewerYlOrRd4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],BrewerYlOrRd5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],BrewerYlOrRd7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],BrewerYlOrRd9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],BrewerYlOrBr3:["#fff7bc","#fec44f","#d95f0e"],BrewerYlOrBr4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],BrewerYlOrBr5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],BrewerYlOrBr6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],BrewerYlOrBr7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],BrewerYlOrBr9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],BrewerPurples3:["#efedf5","#bcbddc","#756bb1"],BrewerPurples4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],BrewerPurples5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],BrewerPurples6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],BrewerPurples7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],BrewerPurples9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],BrewerBlues3:["#deebf7","#9ecae1","#3182bd"],BrewerBlues4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],BrewerBlues5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],BrewerBlues6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],BrewerBlues7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],BrewerBlues9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],BrewerGreens3:["#e5f5e0","#a1d99b","#31a354"],BrewerGreens4:["#edf8e9","#bae4b3","#74c476","#238b45"],BrewerGreens5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],BrewerGreens6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],BrewerGreens7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],BrewerGreens9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],BrewerOranges3:["#fee6ce","#fdae6b","#e6550d"],BrewerOranges4:["#feedde","#fdbe85","#fd8d3c","#d94701"],BrewerOranges5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],BrewerOranges6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],BrewerOranges7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],BrewerOranges9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BrewerReds3:["#fee0d2","#fc9272","#de2d26"],BrewerReds4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],BrewerReds5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],BrewerReds6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],BrewerReds7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],BrewerReds9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],BrewerGreys3:["#f0f0f0","#bdbdbd","#636363"],BrewerGreys4:["#f7f7f7","#cccccc","#969696","#525252"],BrewerGreys5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],BrewerGreys6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],BrewerGreys7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],BrewerGreys9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],BrewerPuOr3:["#f1a340","#f7f7f7","#998ec3"],BrewerPuOr4:["#e66101","#fdb863","#b2abd2","#5e3c99"],BrewerPuOr5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],BrewerPuOr6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],BrewerPuOr7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],BrewerPuOr8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],BrewerPuOr10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerPuOr11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrewerBrBG3:["#d8b365","#f5f5f5","#5ab4ac"],BrewerBrBG4:["#a6611a","#dfc27d","#80cdc1","#018571"],BrewerBrBG5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],BrewerBrBG6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],BrewerBrBG8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],BrewerBrBG10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerBrBG11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],BrewerPRGn3:["#af8dc3","#f7f7f7","#7fbf7b"],BrewerPRGn4:["#7b3294","#c2a5cf","#a6dba0","#008837"],BrewerPRGn5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],BrewerPRGn6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],BrewerPRGn8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],BrewerPRGn10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPRGn11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],BrewerPiYG3:["#e9a3c9","#f7f7f7","#a1d76a"],BrewerPiYG4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],BrewerPiYG5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],BrewerPiYG6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],BrewerPiYG8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],BrewerPiYG10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerPiYG11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],BrewerRdBu3:["#ef8a62","#f7f7f7","#67a9cf"],BrewerRdBu4:["#ca0020","#f4a582","#92c5de","#0571b0"],BrewerRdBu5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],BrewerRdBu6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],BrewerRdBu8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],BrewerRdBu10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdBu11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],BrewerRdGy3:["#ef8a62","#ffffff","#999999"],BrewerRdGy4:["#ca0020","#f4a582","#bababa","#404040"],BrewerRdGy5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],BrewerRdGy6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],BrewerRdGy8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],BrewerRdGy10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdGy11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],BrewerRdYlBu3:["#fc8d59","#ffffbf","#91bfdb"],BrewerRdYlBu4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],BrewerRdYlBu5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],BrewerRdYlBu6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],BrewerRdYlBu8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],BrewerRdYlBu10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerRdYlBu11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrewerSpectral3:["#fc8d59","#ffffbf","#99d594"],BrewerSpectral4:["#d7191c","#fdae61","#abdda4","#2b83ba"],BrewerSpectral5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],BrewerSpectral6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],BrewerSpectral7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],BrewerSpectral8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],BrewerSpectral10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerSpectral11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],BrewerRdYlGn3:["#fc8d59","#ffffbf","#91cf60"],BrewerRdYlGn4:["#d7191c","#fdae61","#a6d96a","#1a9641"],BrewerRdYlGn5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],BrewerRdYlGn6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],BrewerRdYlGn8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],BrewerRdYlGn10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerRdYlGn11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],BrewerAccent3:["#7fc97f","#beaed4","#fdc086"],BrewerAccent4:["#7fc97f","#beaed4","#fdc086","#ffff99"],BrewerAccent5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],BrewerAccent6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],BrewerAccent7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],BrewerAccent8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],BrewerDark23:["#1b9e77","#d95f02","#7570b3"],BrewerDark24:["#1b9e77","#d95f02","#7570b3","#e7298a"],BrewerDark25:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],BrewerDark26:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],BrewerDark27:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],BrewerDark28:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],BrewerPaired3:["#a6cee3","#1f78b4","#b2df8a"],BrewerPaired4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],BrewerPaired5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],BrewerPaired6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],BrewerPaired7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],BrewerPaired8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],BrewerPaired9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],BrewerPaired10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],BrewerPaired11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],BrewerPaired12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],BrewerPastel13:["#fbb4ae","#b3cde3","#ccebc5"],BrewerPastel14:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],BrewerPastel15:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],BrewerPastel16:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],BrewerPastel17:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],BrewerPastel18:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],BrewerPastel19:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],BrewerPastel23:["#b3e2cd","#fdcdac","#cbd5e8"],BrewerPastel24:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],BrewerPastel25:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],BrewerPastel26:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],BrewerPastel27:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],BrewerPastel28:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],BrewerSet13:["#e41a1c","#377eb8","#4daf4a"],BrewerSet14:["#e41a1c","#377eb8","#4daf4a","#984ea3"],BrewerSet15:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],BrewerSet16:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],BrewerSet17:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],BrewerSet18:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],BrewerSet19:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],BrewerSet23:["#66c2a5","#fc8d62","#8da0cb"],BrewerSet24:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],BrewerSet25:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],BrewerSet26:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],BrewerSet27:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],BrewerSet28:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],BrewerSet33:["#8dd3c7","#ffffb3","#bebada"],BrewerSet34:["#8dd3c7","#ffffb3","#bebada","#fb8072"],BrewerSet35:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],BrewerSet36:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],BrewerSet37:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],BrewerSet38:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],BrewerSet39:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],BrewerSet310:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],BrewerSet311:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],BrewerSet312:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],CartoBurg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],CartoBurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],CartoRedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],CartoOrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],CartoPeach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],CartoPinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],CartoMint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],CartoBluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],CartoDarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],CartoEmrld:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],CartoBluYl:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],CartoTeal:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],CartoTealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],CartoPurp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],CartoPurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],CartoSunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],CartoMagenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],CartoSunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],CartoBrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],CartoArmyRose:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],CartoFall:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoGeyser:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],CartoTemps:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],CartoTealRose:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],CartoTropic:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],CartoEarth:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"]},Qi=Object.keys(xo),Bo=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,xc=m=>{const g=Bo.exec(m);if(g!==null)return[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)];throw new Error(`Cannot parse hex color "${m}"`)},bl=({colorScheme:m,customColors:g,min:A,max:v,isReverse:x=!1,isContinuous:k=!1})=>{let P;if(m){if(S=m,!Qi.includes(S))throw new Error(`"${m}" is not a supported color scheme`);P=xo[m]}else{if(!(g.length>=2))throw new Error("You must provide at least 2 colors");P=g}var S;const V=P.map(xc),U=x?V.reverse():V;if(k){const q=((re,Z,N)=>Array.from({length:N},(se,ce)=>re+ce*(Z-re)/(N-1)))(A,v,U.length);return Vs(q,U).clamp(!0)}{const q=((re,Z,N)=>Array.from({length:N-1},(se,ce)=>re+(ce+1)*(Z-re)/N))(A,v,U.length);return Il(q,U)}};var Rr;(function(m){m[m.WhiteIsZero=0]="WhiteIsZero",m[m.BlackIsZero=1]="BlackIsZero",m[m.RGB=2]="RGB",m[m.Palette=3]="Palette",m[m.TransparencyMask=4]="TransparencyMask",m[m.CMYK=5]="CMYK",m[m.YCbCr=6]="YCbCr",m[m.CIELab=8]="CIELab",m[m.ICCLab=9]="ICCLab"})(Rr||(Rr={}));const Yl=(m,{noData:g,photometricInterpretation:A,bitsPerSample:v,colorMap:x})=>{const k=v&&v[0]?2**v[0]:NaN,P=g??0;let S;switch(A){case Rr.WhiteIsZero:S=function(V,U,q){const re=new Uint8ClampedArray(4*V[0].length);let Z;for(let N=0;N<V[0].length;N++)Z=255-V[0][N]/U*255,re[4*N]=Z,re[4*N+1]=Z,re[4*N+2]=Z,re[4*N+3]=V[0][N]===q?0:255;return re}(m,k,P);break;case Rr.BlackIsZero:S=function(V,U,q){const re=new Uint8ClampedArray(4*V[0].length);let Z;for(let N=0;N<V[0].length;N++)Z=V[0][N]/U*255,re[4*N]=Z,re[4*N+1]=Z,re[4*N+2]=Z,re[4*N+3]=V[0][N]===q?0:255;return re}(m,k,P);break;case Rr.RGB:S=function(V,U){const[q,re,Z]=V,N=new Uint8ClampedArray(4*V[0].length);for(let se=0;se<V[0].length;se++)N[4*se]=q[se],N[4*se+1]=re[se],N[4*se+2]=Z[se],N[4*se+3]=q[se]===U&&re[se]==U&&Z[se]==U?0:255;return N}(m,P);break;case Rr.Palette:if(!x)throw new Error("colorMap for paletted image not found.");S=function(V,U,q){const re=new Uint8ClampedArray(4*V[0].length),Z=U.length/3,N=U.length/3*2;for(let se=0;se<V[0].length;se++){const ce=V[0][se];re[4*se]=U[ce]/65536*256,re[4*se+1]=U[ce+Z]/65536*256,re[4*se+2]=U[ce+N]/65536*256,re[4*se+3]=V[0][se]===q?0:255}return re}(m,x,P);break;case Rr.CMYK:S=function(V,U){const q=new Uint8ClampedArray(4*V[0].length),[re,Z,N,se]=V;for(let ce=0;ce<V.length;ce++){const ae=re[ce],Ae=Z[ce],ve=N[ce],Ie=se[ce];q[4*ce]=(255-ae)/256*255*((255-Ie)/256),q[4*ce+1]=(255-Ae)/256*255*((255-Ie)/256),q[4*ce+2]=(255-ve)/256*255*((255-Ie)/256),q[4*ce+3]=ae===U&&Ae===U&&ve===U&&Ie===U?0:255}return q}(m,P);break;case Rr.YCbCr:S=function(V,U){const[q,re,Z]=V,N=new Uint8ClampedArray(4*V[0].length);for(let se=0;se<V[0].length;se++){const ce=q[se],ae=re[se],Ae=Z[se];N[4*se]=ce+1.402*(Ae-128),N[4*se+1]=ce-.34414*(ae-128)-.71414*(Ae-128),N[4*se+2]=ce+1.772*(ae-128),N[4*se+3]=ce===U&&ae==U&&Ae==U?0:255}return N}(m,P);break;case Rr.CIELab:S=function(V,U){const q=new Uint8ClampedArray(V[0].length);for(let re=0;re<V.length;re++){const Z=V[0][re],N=V[1][re]<<24>>24,se=V[2][re]<<24>>24;let ce,ae,Ae,ve=(Z+16)/116,Ie=N/500+ve,ke=ve-se/200;Ie=.95047*(Ie*Ie*Ie>.008856?Ie*Ie*Ie:(Ie-16/116)/7.787),ve=1*(ve*ve*ve>.008856?ve*ve*ve:(ve-16/116)/7.787),ke=1.08883*(ke*ke*ke>.008856?ke*ke*ke:(ke-16/116)/7.787),ce=3.2406*Ie+-1.5372*ve+-.4986*ke,ae=-.9689*Ie+1.8758*ve+.0415*ke,Ae=.0557*Ie+-.204*ve+1.057*ke,ce=ce>.0031308?1.055*ce**(1/2.4)-.055:12.92*ce,ae=ae>.0031308?1.055*ae**(1/2.4)-.055:12.92*ae,Ae=Ae>.0031308?1.055*Ae**(1/2.4)-.055:12.92*Ae,q[4*re]=255*Math.max(0,Math.min(1,ce)),q[4*re+1]=255*Math.max(0,Math.min(1,ae)),q[4*re+2]=255*Math.max(0,Math.min(1,Ae)),q[4*re+3]=Z===U&&N==U&&se==U?0:255}return q}(m,P);break;default:throw new Error("Unsupported photometric interpretation.")}return S},Co=async m=>{var N,se;const g=new RegExp(/cog:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),A=m.match(g);if(!A)throw new Error(`Invalid COG protocol URL '${m}'`);const v=A[1].split("#"),x=v[0];v.shift();const k=v.join("#")??"",P=parseInt(A[2]),S=parseInt(A[3]),V=parseInt(A[4]),U=Rs(x),q=await U.getRawTile({z:P,x:S,y:V}),re=await U.getMetadata();let Z;if(k.startsWith("dem"))Z=((ce,{offset:ae,scale:Ae,noData:ve})=>{const Ie=ce[0],ke=Ie.length,K=new Uint8ClampedArray(4*ke);for(let G=0;G<ke;G++){const ue=ae+Ie[G]*Ae,ie=((ue==ve?0:ue)- -1e4)/.1;K[4*G]=Math.floor(ie/256/256)%256,K[4*G+1]=Math.floor(ie/256)%256,K[4*G+2]=ie%256,K[4*G+3]=255}return K})(q,re);else if(k.startsWith("color")){const ce=(N=k.split("color").pop())==null?void 0:N.substring(1);if(!ce)throw new Error("Color params are not defined");{const ae=(se=ce.match(/\[("#([0-9a-fA-F]{3,6})"(,(\s)?)?)+\]/))==null?void 0:se[0];let Ae,ve,Ie,ke="",K=[];ae?(K=JSON.parse(ae),[Ae,ve,Ie]=ce.replace(`${ae},`,"").split(",")):[ke,Ae,ve,Ie]=ce.split(",");const G=parseFloat(Ae),ue=parseFloat(ve),ie=(Ie==null?void 0:Ie.includes("-"))||!1,oe=(Ie==null?void 0:Ie.includes("c"))||!1;Z=((de,{offset:Se,scale:Be,noData:Qe,colorScale:Ge})=>{const He=de[0],Ke=He.length,tt=new Uint8ClampedArray(4*Ke),mt=bl(Ge);for(let Oe=0;Oe<Ke;Oe++){const Fe=Se+He[Oe]*Be;if(Fe===Qe||isNaN(Fe)||Fe===1/0)tt[4*Oe]=0,tt[4*Oe+1]=0,tt[4*Oe+2]=0,tt[4*Oe+3]=0;else{const et=mt(Fe);tt[4*Oe]=et[0],tt[4*Oe+1]=et[1],tt[4*Oe+2]=et[2],tt[4*Oe+3]=255}}return tt})(q,{...re,colorScale:{colorScheme:ke,customColors:K,min:G,max:ue,isReverse:ie,isContinuous:oe}})}}else Z=Yl(q,re);return await createImageBitmap(new ImageData(Z,256,256))};var Kl=Object.freeze({__proto__:null,default:class extends Rn{decodeBlock(m){return m}}});const Eo=257;function Ba(m,g){for(let A=g.length-1;A>=0;A--)m.push(g[A]);return m}function Qo(m){const g=new Uint16Array(4093),A=new Uint8Array(4093);for(let se=0;se<=257;se++)g[se]=4096,A[se]=se;let v=258,x=9,k=0;function P(){v=258,x=9}function S(se){const ce=function(ae,Ae,ve){const Ie=Ae%8,ke=Math.floor(Ae/8),K=8-Ie,G=Ae+ve-8*(ke+1);let ue=8*(ke+2)-(Ae+ve);const ie=8*(ke+2)-Ae;if(ue=Math.max(0,ue),ke>=ae.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),Eo;let oe=ae[ke]&2**(8-Ie)-1;oe<<=ve-K;let de=oe;if(ke+1<ae.length){let Se=ae[ke+1]>>>ue;Se<<=Math.max(0,ve-ie),de+=Se}if(G>8&&ke+2<ae.length){const Se=8*(ke+3)-(Ae+ve);de+=ae[ke+2]>>>Se}return de}(se,k,x);return k+=x,ce}function V(se,ce){return A[v]=ce,g[v]=se,v++,v-1}function U(se){const ce=[];for(let ae=se;ae!==4096;ae=g[ae])ce.push(A[ae]);return ce}const q=[];P();const re=new Uint8Array(m);let Z,N=S(re);for(;N!==Eo;){if(N===256){for(P(),N=S(re);N===256;)N=S(re);if(N===Eo)break;if(N>256)throw new Error(`corrupted code at scanline ${N}`);Ba(q,U(N)),Z=N}else if(N<v){const se=U(N);Ba(q,se),V(Z,se[se.length-1]),Z=N}else{const se=U(Z);if(!se)throw new Error(`Bogus entry. Not in dictionary, ${Z} / ${v}, position: ${k}`);Ba(q,se),q.push(se[se.length-1]),V(Z,se[se.length-1]),Z=N}v+1>=2**x&&(x===12?Z=void 0:x++),N=S(re)}return new Uint8Array(q)}var Ca=Object.freeze({__proto__:null,default:class extends Rn{decodeBlock(m){return Qo(m).buffer}}});const Nn=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),is=4017,Ea=799,rs=3406,Es=2276,Hs=1567,js=3784,Qs=5793,ko=2896;function wl(m,g){let A=0;const v=[];let x=16;for(;x>0&&!m[x-1];)--x;v.push({children:[],index:0});let k,P=v[0];for(let S=0;S<x;S++){for(let V=0;V<m[S];V++){for(P=v.pop(),P.children[P.index]=g[A];P.index>0;)P=v.pop();for(P.index++,v.push(P);v.length<=S;)v.push(k={children:[],index:0}),P.children[P.index]=k.children,P=k;A++}S+1<x&&(v.push(k={children:[],index:0}),P.children[P.index]=k.children,P=k)}return v[0].children}function So(m,g,A,v,x,k,P,S,V){const{mcusPerLine:U,progressive:q}=A,re=g;let Z=g,N=0,se=0;function ce(){if(se>0)return se--,N>>se&1;if(N=m[Z++],N===255){const Oe=m[Z++];if(Oe)throw new Error(`unexpected marker: ${(N<<8|Oe).toString(16)}`)}return se=7,N>>>7}function ae(Oe){let Fe,et=Oe;for(;(Fe=ce())!==null;){if(et=et[Fe],typeof et=="number")return et;if(typeof et!="object")throw new Error("invalid huffman sequence")}return null}function Ae(Oe){let Fe=Oe,et=0;for(;Fe>0;){const Dt=ce();if(Dt===null)return;et=et<<1|Dt,--Fe}return et}function ve(Oe){const Fe=Ae(Oe);return Fe>=1<<Oe-1?Fe:Fe+(-1<<Oe)+1}let Ie=0,ke,K=0;function G(Oe,Fe,et,Dt,At){const Lt=et%U,ht=(et/U|0)*Oe.v+Dt,Ct=Lt*Oe.h+At;Fe(Oe,Oe.blocks[ht][Ct])}function ue(Oe,Fe,et){const Dt=et/Oe.blocksPerLine|0,At=et%Oe.blocksPerLine;Fe(Oe,Oe.blocks[Dt][At])}const ie=v.length;let oe,de,Se,Be,Qe,Ge;Ge=q?k===0?S===0?function(Oe,Fe){const et=ae(Oe.huffmanTableDC),Dt=et===0?0:ve(et)<<V;Oe.pred+=Dt,Fe[0]=Oe.pred}:function(Oe,Fe){Fe[0]|=ce()<<V}:S===0?function(Oe,Fe){if(Ie>0)return void Ie--;let et=k;const Dt=P;for(;et<=Dt;){const At=ae(Oe.huffmanTableAC),Lt=15&At,ht=At>>4;if(Lt===0){if(ht<15){Ie=Ae(ht)+(1<<ht)-1;break}et+=16}else et+=ht,Fe[Nn[et]]=ve(Lt)*(1<<V),et++}}:function(Oe,Fe){let et=k;const Dt=P;let At=0;for(;et<=Dt;){const Lt=Nn[et],ht=Fe[Lt]<0?-1:1;switch(K){case 0:{const Ct=ae(Oe.huffmanTableAC),It=15&Ct;if(At=Ct>>4,It===0)At<15?(Ie=Ae(At)+(1<<At),K=4):(At=16,K=1);else{if(It!==1)throw new Error("invalid ACn encoding");ke=ve(It),K=At?2:3}continue}case 1:case 2:Fe[Lt]?Fe[Lt]+=(ce()<<V)*ht:(At--,At===0&&(K=K===2?3:0));break;case 3:Fe[Lt]?Fe[Lt]+=(ce()<<V)*ht:(Fe[Lt]=ke<<V,K=0);break;case 4:Fe[Lt]&&(Fe[Lt]+=(ce()<<V)*ht)}et++}K===4&&(Ie--,Ie===0&&(K=0))}:function(Oe,Fe){const et=ae(Oe.huffmanTableDC),Dt=et===0?0:ve(et);Oe.pred+=Dt,Fe[0]=Oe.pred;let At=1;for(;At<64;){const Lt=ae(Oe.huffmanTableAC),ht=15&Lt,Ct=Lt>>4;if(ht===0){if(Ct<15)break;At+=16}else At+=Ct,Fe[Nn[At]]=ve(ht),At++}};let He,Ke,tt=0;Ke=ie===1?v[0].blocksPerLine*v[0].blocksPerColumn:U*A.mcusPerColumn;const mt=x||Ke;for(;tt<Ke;){for(de=0;de<ie;de++)v[de].pred=0;if(Ie=0,ie===1)for(oe=v[0],Qe=0;Qe<mt;Qe++)ue(oe,Ge,tt),tt++;else for(Qe=0;Qe<mt;Qe++){for(de=0;de<ie;de++){oe=v[de];const{h:Oe,v:Fe}=oe;for(Se=0;Se<Fe;Se++)for(Be=0;Be<Oe;Be++)G(oe,Ge,tt,Se,Be)}if(tt++,tt===Ke)break}if(se=0,He=m[Z]<<8|m[Z+1],He<65280)throw new Error("marker was not found");if(!(He>=65488&&He<=65495))break;Z+=2}return Z-re}function vl(m,g){const A=[],{blocksPerLine:v,blocksPerColumn:x}=g,k=v<<3,P=new Int32Array(64),S=new Uint8Array(64);function V(U,q,re){const Z=g.quantizationTable;let N,se,ce,ae,Ae,ve,Ie,ke,K;const G=re;let ue;for(ue=0;ue<64;ue++)G[ue]=U[ue]*Z[ue];for(ue=0;ue<8;++ue){const ie=8*ue;G[1+ie]!==0||G[2+ie]!==0||G[3+ie]!==0||G[4+ie]!==0||G[5+ie]!==0||G[6+ie]!==0||G[7+ie]!==0?(N=Qs*G[0+ie]+128>>8,se=Qs*G[4+ie]+128>>8,ce=G[2+ie],ae=G[6+ie],Ae=ko*(G[1+ie]-G[7+ie])+128>>8,ke=ko*(G[1+ie]+G[7+ie])+128>>8,ve=G[3+ie]<<4,Ie=G[5+ie]<<4,K=N-se+1>>1,N=N+se+1>>1,se=K,K=ce*js+ae*Hs+128>>8,ce=ce*Hs-ae*js+128>>8,ae=K,K=Ae-Ie+1>>1,Ae=Ae+Ie+1>>1,Ie=K,K=ke+ve+1>>1,ve=ke-ve+1>>1,ke=K,K=N-ae+1>>1,N=N+ae+1>>1,ae=K,K=se-ce+1>>1,se=se+ce+1>>1,ce=K,K=Ae*Es+ke*rs+2048>>12,Ae=Ae*rs-ke*Es+2048>>12,ke=K,K=ve*Ea+Ie*is+2048>>12,ve=ve*is-Ie*Ea+2048>>12,Ie=K,G[0+ie]=N+ke,G[7+ie]=N-ke,G[1+ie]=se+Ie,G[6+ie]=se-Ie,G[2+ie]=ce+ve,G[5+ie]=ce-ve,G[3+ie]=ae+Ae,G[4+ie]=ae-Ae):(K=Qs*G[0+ie]+512>>10,G[0+ie]=K,G[1+ie]=K,G[2+ie]=K,G[3+ie]=K,G[4+ie]=K,G[5+ie]=K,G[6+ie]=K,G[7+ie]=K)}for(ue=0;ue<8;++ue){const ie=ue;G[8+ie]!==0||G[16+ie]!==0||G[24+ie]!==0||G[32+ie]!==0||G[40+ie]!==0||G[48+ie]!==0||G[56+ie]!==0?(N=Qs*G[0+ie]+2048>>12,se=Qs*G[32+ie]+2048>>12,ce=G[16+ie],ae=G[48+ie],Ae=ko*(G[8+ie]-G[56+ie])+2048>>12,ke=ko*(G[8+ie]+G[56+ie])+2048>>12,ve=G[24+ie],Ie=G[40+ie],K=N-se+1>>1,N=N+se+1>>1,se=K,K=ce*js+ae*Hs+2048>>12,ce=ce*Hs-ae*js+2048>>12,ae=K,K=Ae-Ie+1>>1,Ae=Ae+Ie+1>>1,Ie=K,K=ke+ve+1>>1,ve=ke-ve+1>>1,ke=K,K=N-ae+1>>1,N=N+ae+1>>1,ae=K,K=se-ce+1>>1,se=se+ce+1>>1,ce=K,K=Ae*Es+ke*rs+2048>>12,Ae=Ae*rs-ke*Es+2048>>12,ke=K,K=ve*Ea+Ie*is+2048>>12,ve=ve*is-Ie*Ea+2048>>12,Ie=K,G[0+ie]=N+ke,G[56+ie]=N-ke,G[8+ie]=se+Ie,G[48+ie]=se-Ie,G[16+ie]=ce+ve,G[40+ie]=ce-ve,G[24+ie]=ae+Ae,G[32+ie]=ae-Ae):(K=Qs*re[ue+0]+8192>>14,G[0+ie]=K,G[8+ie]=K,G[16+ie]=K,G[24+ie]=K,G[32+ie]=K,G[40+ie]=K,G[48+ie]=K,G[56+ie]=K)}for(ue=0;ue<64;++ue){const ie=128+(G[ue]+8>>4);q[ue]=ie<0?0:ie>255?255:ie}}for(let U=0;U<x;U++){const q=U<<3;for(let re=0;re<8;re++)A.push(new Uint8Array(k));for(let re=0;re<v;re++){V(g.blocks[U][re],S,P);let Z=0;const N=re<<3;for(let se=0;se<8;se++){const ce=A[q+se];for(let ae=0;ae<8;ae++)ce[N+ae]=S[Z++]}}}return A}class Ja{constructor(){this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}resetFrames(){this.frames=[]}parse(g){let A=0;function v(){const S=g[A]<<8|g[A+1];return A+=2,S}function x(){const S=v(),V=g.subarray(A,A+S-2);return A+=V.length,V}function k(S){let V,U,q=0,re=0;for(U in S.components)S.components.hasOwnProperty(U)&&(V=S.components[U],q<V.h&&(q=V.h),re<V.v&&(re=V.v));const Z=Math.ceil(S.samplesPerLine/8/q),N=Math.ceil(S.scanLines/8/re);for(U in S.components)if(S.components.hasOwnProperty(U)){V=S.components[U];const se=Math.ceil(Math.ceil(S.samplesPerLine/8)*V.h/q),ce=Math.ceil(Math.ceil(S.scanLines/8)*V.v/re),ae=Z*V.h,Ae=N*V.v,ve=[];for(let Ie=0;Ie<Ae;Ie++){const ke=[];for(let K=0;K<ae;K++)ke.push(new Int32Array(64));ve.push(ke)}V.blocksPerLine=se,V.blocksPerColumn=ce,V.blocks=ve}S.maxH=q,S.maxV=re,S.mcusPerLine=Z,S.mcusPerColumn=N}let P=v();if(P!==65496)throw new Error("SOI not found");for(P=v();P!==65497;){switch(P){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:{const S=x();P===65504&&S[0]===74&&S[1]===70&&S[2]===73&&S[3]===70&&S[4]===0&&(this.jfif={version:{major:S[5],minor:S[6]},densityUnits:S[7],xDensity:S[8]<<8|S[9],yDensity:S[10]<<8|S[11],thumbWidth:S[12],thumbHeight:S[13],thumbData:S.subarray(14,14+3*S[12]*S[13])}),P===65518&&S[0]===65&&S[1]===100&&S[2]===111&&S[3]===98&&S[4]===101&&S[5]===0&&(this.adobe={version:S[6],flags0:S[7]<<8|S[8],flags1:S[9]<<8|S[10],transformCode:S[11]});break}case 65499:{const S=v()+A-2;for(;A<S;){const V=g[A++],U=new Int32Array(64);if(V>>4){if(V>>4!=1)throw new Error("DQT: invalid table spec");for(let q=0;q<64;q++)U[Nn[q]]=v()}else for(let q=0;q<64;q++)U[Nn[q]]=g[A++];this.quantizationTables[15&V]=U}break}case 65472:case 65473:case 65474:{v();const S={extended:P===65473,progressive:P===65474,precision:g[A++],scanLines:v(),samplesPerLine:v(),components:{},componentsOrder:[]},V=g[A++];let U;for(let q=0;q<V;q++){U=g[A];const re=g[A+1]>>4,Z=15&g[A+1],N=g[A+2];S.componentsOrder.push(U),S.components[U]={h:re,v:Z,quantizationIdx:N},A+=3}k(S),this.frames.push(S);break}case 65476:{const S=v();for(let V=2;V<S;){const U=g[A++],q=new Uint8Array(16);let re=0;for(let N=0;N<16;N++,A++)q[N]=g[A],re+=q[N];const Z=new Uint8Array(re);for(let N=0;N<re;N++,A++)Z[N]=g[A];V+=17+re,U>>4?this.huffmanTablesAC[15&U]=wl(q,Z):this.huffmanTablesDC[15&U]=wl(q,Z)}break}case 65501:v(),this.resetInterval=v();break;case 65498:{v();const S=g[A++],V=[],U=this.frames[0];for(let se=0;se<S;se++){const ce=U.components[g[A++]],ae=g[A++];ce.huffmanTableDC=this.huffmanTablesDC[ae>>4],ce.huffmanTableAC=this.huffmanTablesAC[15&ae],V.push(ce)}const q=g[A++],re=g[A++],Z=g[A++],N=So(g,A,U,V,this.resetInterval,q,re,Z>>4,15&Z);A+=N;break}case 65535:g[A]!==255&&A--;break;default:if(g[A-3]===255&&g[A-2]>=192&&g[A-2]<=254){A-=3;break}throw new Error(`unknown JPEG marker ${P.toString(16)}`)}P=v()}}getResult(){const{frames:g}=this;if(this.frames.length===0)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(let q=0;q<this.frames.length;q++){const re=this.frames[q].components;for(const Z of Object.keys(re))re[Z].quantizationTable=this.quantizationTables[re[Z].quantizationIdx],delete re[Z].quantizationIdx}const A=g[0],{components:v,componentsOrder:x}=A,k=[],P=A.samplesPerLine,S=A.scanLines;for(let q=0;q<x.length;q++){const re=v[x[q]];k.push({lines:vl(0,re),scaleX:re.h/A.maxH,scaleY:re.v/A.maxV})}const V=new Uint8Array(P*S*k.length);let U=0;for(let q=0;q<S;++q)for(let re=0;re<P;++re)for(let Z=0;Z<k.length;++Z){const N=k[Z];V[U]=N.lines[0|q*N.scaleY][0|re*N.scaleX],++U}return V}}var Ya=Object.freeze({__proto__:null,default:class extends Rn{constructor(m){super(),this.reader=new Ja,m.JPEGTables&&this.reader.parse(m.JPEGTables)}decodeBlock(m){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(m)),this.reader.getResult().buffer}}});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function tr(m){let g=m.length;for(;--g>=0;)m[g]=0}const Js=30,Zl=new Array(576);tr(Zl);const $l=new Array(60);tr($l);const Wi=new Array(512);tr(Wi);const Bn=new Array(256);tr(Bn);const Xr=new Array(29);tr(Xr);const Ka=new Array(Js);tr(Ka);var Za=(m,g,A,v)=>{let x=65535&m,k=m>>>16&65535,P=0;for(;A!==0;){P=A>2e3?2e3:A,A-=P;do x=x+g[v++]|0,k=k+x|0;while(--P);x%=65521,k%=65521}return x|k<<16};const Do=new Uint32Array((()=>{let m,g=[];for(var A=0;A<256;A++){m=A;for(var v=0;v<8;v++)m=1&m?3988292384^m>>>1:m>>>1;g[A]=m}return g})());var kr=(m,g,A,v)=>{const x=Do,k=v+A;m^=-1;for(let P=v;P<k;P++)m=m>>>8^x[255&(m^g[P])];return~m},Cn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Mo={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const To=(m,g)=>Object.prototype.hasOwnProperty.call(m,g);var Po={assign:function(m){const g=Array.prototype.slice.call(arguments,1);for(;g.length;){const A=g.shift();if(A){if(typeof A!="object")throw new TypeError(A+"must be non-object");for(const v in A)To(A,v)&&(m[v]=A[v])}}return m},flattenChunks:m=>{let g=0;for(let v=0,x=m.length;v<x;v++)g+=m[v].length;const A=new Uint8Array(g);for(let v=0,x=0,k=m.length;v<k;v++){let P=m[v];A.set(P,x),x+=P.length}return A}};let $a=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{$a=!1}const Ys=new Uint8Array(256);for(let m=0;m<256;m++)Ys[m]=m>=252?6:m>=248?5:m>=240?4:m>=224?3:m>=192?2:1;Ys[254]=Ys[254]=1;var Wa={string2buf:m=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(m);let g,A,v,x,k,P=m.length,S=0;for(x=0;x<P;x++)A=m.charCodeAt(x),(64512&A)==55296&&x+1<P&&(v=m.charCodeAt(x+1),(64512&v)==56320&&(A=65536+(A-55296<<10)+(v-56320),x++)),S+=A<128?1:A<2048?2:A<65536?3:4;for(g=new Uint8Array(S),k=0,x=0;k<S;x++)A=m.charCodeAt(x),(64512&A)==55296&&x+1<P&&(v=m.charCodeAt(x+1),(64512&v)==56320&&(A=65536+(A-55296<<10)+(v-56320),x++)),A<128?g[k++]=A:A<2048?(g[k++]=192|A>>>6,g[k++]=128|63&A):A<65536?(g[k++]=224|A>>>12,g[k++]=128|A>>>6&63,g[k++]=128|63&A):(g[k++]=240|A>>>18,g[k++]=128|A>>>12&63,g[k++]=128|A>>>6&63,g[k++]=128|63&A);return g},buf2string:(m,g)=>{const A=g||m.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(m.subarray(0,g));let v,x;const k=new Array(2*A);for(x=0,v=0;v<A;){let P=m[v++];if(P<128){k[x++]=P;continue}let S=Ys[P];if(S>4)k[x++]=65533,v+=S-1;else{for(P&=S===2?31:S===3?15:7;S>1&&v<A;)P=P<<6|63&m[v++],S--;S>1?k[x++]=65533:P<65536?k[x++]=P:(P-=65536,k[x++]=55296|P>>10&1023,k[x++]=56320|1023&P)}}return((P,S)=>{if(S<65534&&P.subarray&&$a)return String.fromCharCode.apply(null,P.length===S?P:P.subarray(0,S));let V="";for(let U=0;U<S;U++)V+=String.fromCharCode(P[U]);return V})(k,x)},utf8border:(m,g)=>{(g=g||m.length)>m.length&&(g=m.length);let A=g-1;for(;A>=0&&(192&m[A])==128;)A--;return A<0||A===0?g:A+Ys[m[A]]>g?A:g}},Ks=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Zs=16209;var Xa=function(m,g){let A,v,x,k,P,S,V,U,q,re,Z,N,se,ce,ae,Ae,ve,Ie,ke,K,G,ue,ie,oe;const de=m.state;A=m.next_in,ie=m.input,v=A+(m.avail_in-5),x=m.next_out,oe=m.output,k=x-(g-m.avail_out),P=x+(m.avail_out-257),S=de.dmax,V=de.wsize,U=de.whave,q=de.wnext,re=de.window,Z=de.hold,N=de.bits,se=de.lencode,ce=de.distcode,ae=(1<<de.lenbits)-1,Ae=(1<<de.distbits)-1;e:do{N<15&&(Z+=ie[A++]<<N,N+=8,Z+=ie[A++]<<N,N+=8),ve=se[Z&ae];t:for(;;){if(Ie=ve>>>24,Z>>>=Ie,N-=Ie,Ie=ve>>>16&255,Ie===0)oe[x++]=65535&ve;else{if(!(16&Ie)){if(64&Ie){if(32&Ie){de.mode=16191;break e}m.msg="invalid literal/length code",de.mode=Zs;break e}ve=se[(65535&ve)+(Z&(1<<Ie)-1)];continue t}for(ke=65535&ve,Ie&=15,Ie&&(N<Ie&&(Z+=ie[A++]<<N,N+=8),ke+=Z&(1<<Ie)-1,Z>>>=Ie,N-=Ie),N<15&&(Z+=ie[A++]<<N,N+=8,Z+=ie[A++]<<N,N+=8),ve=ce[Z&Ae];;){if(Ie=ve>>>24,Z>>>=Ie,N-=Ie,Ie=ve>>>16&255,16&Ie){if(K=65535&ve,Ie&=15,N<Ie&&(Z+=ie[A++]<<N,N+=8,N<Ie&&(Z+=ie[A++]<<N,N+=8)),K+=Z&(1<<Ie)-1,K>S){m.msg="invalid distance too far back",de.mode=Zs;break e}if(Z>>>=Ie,N-=Ie,Ie=x-k,K>Ie){if(Ie=K-Ie,Ie>U&&de.sane){m.msg="invalid distance too far back",de.mode=Zs;break e}if(G=0,ue=re,q===0){if(G+=V-Ie,Ie<ke){ke-=Ie;do oe[x++]=re[G++];while(--Ie);G=x-K,ue=oe}}else if(q<Ie){if(G+=V+q-Ie,Ie-=q,Ie<ke){ke-=Ie;do oe[x++]=re[G++];while(--Ie);if(G=0,q<ke){Ie=q,ke-=Ie;do oe[x++]=re[G++];while(--Ie);G=x-K,ue=oe}}}else if(G+=q-Ie,Ie<ke){ke-=Ie;do oe[x++]=re[G++];while(--Ie);G=x-K,ue=oe}for(;ke>2;)oe[x++]=ue[G++],oe[x++]=ue[G++],oe[x++]=ue[G++],ke-=3;ke&&(oe[x++]=ue[G++],ke>1&&(oe[x++]=ue[G++]))}else{G=x-K;do oe[x++]=oe[G++],oe[x++]=oe[G++],oe[x++]=oe[G++],ke-=3;while(ke>2);ke&&(oe[x++]=oe[G++],ke>1&&(oe[x++]=oe[G++]))}break}if(64&Ie){m.msg="invalid distance code",de.mode=Zs;break e}ve=ce[(65535&ve)+(Z&(1<<Ie)-1)]}}break}}while(A<v&&x<P);ke=N>>3,A-=ke,N-=ke<<3,Z&=(1<<N)-1,m.next_in=A,m.next_out=x,m.avail_in=A<v?v-A+5:5-(A-v),m.avail_out=x<P?P-x+257:257-(x-P),de.hold=Z,de.bits=N};const Qa=15,xl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Bl=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Cl=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Lo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ns=(m,g,A,v,x,k,P,S)=>{const V=S.bits;let U,q,re,Z,N,se,ce=0,ae=0,Ae=0,ve=0,Ie=0,ke=0,K=0,G=0,ue=0,ie=0,oe=null;const de=new Uint16Array(16),Se=new Uint16Array(16);let Be,Qe,Ge,He=null;for(ce=0;ce<=Qa;ce++)de[ce]=0;for(ae=0;ae<v;ae++)de[g[A+ae]]++;for(Ie=V,ve=Qa;ve>=1&&de[ve]===0;ve--);if(Ie>ve&&(Ie=ve),ve===0)return x[k++]=20971520,x[k++]=20971520,S.bits=1,0;for(Ae=1;Ae<ve&&de[Ae]===0;Ae++);for(Ie<Ae&&(Ie=Ae),G=1,ce=1;ce<=Qa;ce++)if(G<<=1,G-=de[ce],G<0)return-1;if(G>0&&(m===0||ve!==1))return-1;for(Se[1]=0,ce=1;ce<Qa;ce++)Se[ce+1]=Se[ce]+de[ce];for(ae=0;ae<v;ae++)g[A+ae]!==0&&(P[Se[g[A+ae]]++]=ae);if(m===0?(oe=He=P,se=20):m===1?(oe=xl,He=Bl,se=257):(oe=Cl,He=Lo,se=0),ie=0,ae=0,ce=Ae,N=k,ke=Ie,K=0,re=-1,ue=1<<Ie,Z=ue-1,m===1&&ue>852||m===2&&ue>592)return 1;for(;;){Be=ce-K,P[ae]+1<se?(Qe=0,Ge=P[ae]):P[ae]>=se?(Qe=He[P[ae]-se],Ge=oe[P[ae]-se]):(Qe=96,Ge=0),U=1<<ce-K,q=1<<ke,Ae=q;do q-=U,x[N+(ie>>K)+q]=Be<<24|Qe<<16|Ge;while(q!==0);for(U=1<<ce-1;ie&U;)U>>=1;if(U!==0?(ie&=U-1,ie+=U):ie=0,ae++,--de[ce]==0){if(ce===ve)break;ce=g[A+P[ae]]}if(ce>Ie&&(ie&Z)!==re){for(K===0&&(K=Ie),N+=Ae,ke=ce-K,G=1<<ke;ke+K<ve&&(G-=de[ke+K],!(G<=0));)ke++,G<<=1;if(ue+=1<<ke,m===1&&ue>852||m===2&&ue>592)return 1;re=ie&Z,x[re]=Ie<<24|ke<<16|N-k}}return ie!==0&&(x[N+ie]=ce-K<<24|64<<16),S.bits=Ie,0};const{Z_FINISH:El,Z_BLOCK:un,Z_TREES:en,Z_OK:ss,Z_STREAM_END:En,Z_NEED_DICT:$s,Z_STREAM_ERROR:An,Z_DATA_ERROR:Wl,Z_MEM_ERROR:Ql,Z_BUF_ERROR:Xl,Z_DEFLATED:Ro}=Mo,as=16180,Sr=16190,xt=16191,ka=16192,eo=16194,to=16199,os=16200,ks=16206,qi=16209,_i=m=>(m>>>24&255)+(m>>>8&65280)+((65280&m)<<8)+((255&m)<<24);function kl(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ws=m=>{if(!m)return 1;const g=m.state;return!g||g.strm!==m||g.mode<as||g.mode>16211?1:0},Fo=m=>{if(Ws(m))return An;const g=m.state;return m.total_in=m.total_out=g.total=0,m.msg="",g.wrap&&(m.adler=1&g.wrap),g.mode=as,g.last=0,g.havedict=0,g.flags=-1,g.dmax=32768,g.head=null,g.hold=0,g.bits=0,g.lencode=g.lendyn=new Int32Array(852),g.distcode=g.distdyn=new Int32Array(592),g.sane=1,g.back=-1,ss},ec=m=>{if(Ws(m))return An;const g=m.state;return g.wsize=0,g.whave=0,g.wnext=0,Fo(m)},Xs=(m,g)=>{let A;if(Ws(m))return An;const v=m.state;return g<0?(A=0,g=-g):(A=5+(g>>4),g<48&&(g&=15)),g&&(g<8||g>15)?An:(v.window!==null&&v.wbits!==g&&(v.window=null),v.wrap=A,v.wbits=g,ec(m))},Sl=(m,g)=>{if(!m)return An;const A=new kl;m.state=A,A.strm=m,A.window=null,A.mode=as;const v=Xs(m,g);return v!==ss&&(m.state=null),v};let io,zo,tc=!0;const Dl=m=>{if(tc){io=new Int32Array(512),zo=new Int32Array(32);let g=0;for(;g<144;)m.lens[g++]=8;for(;g<256;)m.lens[g++]=9;for(;g<280;)m.lens[g++]=7;for(;g<288;)m.lens[g++]=8;for(ns(1,m.lens,0,288,io,0,m.work,{bits:9}),g=0;g<32;)m.lens[g++]=5;ns(2,m.lens,0,32,zo,0,m.work,{bits:5}),tc=!1}m.lencode=io,m.lenbits=9,m.distcode=zo,m.distbits=5},ic=(m,g,A,v)=>{let x;const k=m.state;return k.window===null&&(k.wsize=1<<k.wbits,k.wnext=0,k.whave=0,k.window=new Uint8Array(k.wsize)),v>=k.wsize?(k.window.set(g.subarray(A-k.wsize,A),0),k.wnext=0,k.whave=k.wsize):(x=k.wsize-k.wnext,x>v&&(x=v),k.window.set(g.subarray(A-v,A-v+x),k.wnext),(v-=x)?(k.window.set(g.subarray(A-v,A),0),k.wnext=v,k.whave=k.wsize):(k.wnext+=x,k.wnext===k.wsize&&(k.wnext=0),k.whave<k.wsize&&(k.whave+=x))),0};var Bc=(m,g)=>{let A,v,x,k,P,S,V,U,q,re,Z,N,se,ce,ae,Ae,ve,Ie,ke,K,G,ue,ie=0;const oe=new Uint8Array(4);let de,Se;const Be=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ws(m)||!m.output||!m.input&&m.avail_in!==0)return An;A=m.state,A.mode===xt&&(A.mode=ka),P=m.next_out,x=m.output,V=m.avail_out,k=m.next_in,v=m.input,S=m.avail_in,U=A.hold,q=A.bits,re=S,Z=V,ue=ss;e:for(;;)switch(A.mode){case as:if(A.wrap===0){A.mode=ka;break}for(;q<16;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(2&A.wrap&&U===35615){A.wbits===0&&(A.wbits=15),A.check=0,oe[0]=255&U,oe[1]=U>>>8&255,A.check=kr(A.check,oe,2,0),U=0,q=0,A.mode=16181;break}if(A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&U)<<8)+(U>>8))%31){m.msg="incorrect header check",A.mode=qi;break}if((15&U)!==Ro){m.msg="unknown compression method",A.mode=qi;break}if(U>>>=4,q-=4,G=8+(15&U),A.wbits===0&&(A.wbits=G),G>15||G>A.wbits){m.msg="invalid window size",A.mode=qi;break}A.dmax=1<<A.wbits,A.flags=0,m.adler=A.check=1,A.mode=512&U?16189:xt,U=0,q=0;break;case 16181:for(;q<16;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(A.flags=U,(255&A.flags)!==Ro){m.msg="unknown compression method",A.mode=qi;break}if(57344&A.flags){m.msg="unknown header flags set",A.mode=qi;break}A.head&&(A.head.text=U>>8&1),512&A.flags&&4&A.wrap&&(oe[0]=255&U,oe[1]=U>>>8&255,A.check=kr(A.check,oe,2,0)),U=0,q=0,A.mode=16182;case 16182:for(;q<32;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}A.head&&(A.head.time=U),512&A.flags&&4&A.wrap&&(oe[0]=255&U,oe[1]=U>>>8&255,oe[2]=U>>>16&255,oe[3]=U>>>24&255,A.check=kr(A.check,oe,4,0)),U=0,q=0,A.mode=16183;case 16183:for(;q<16;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}A.head&&(A.head.xflags=255&U,A.head.os=U>>8),512&A.flags&&4&A.wrap&&(oe[0]=255&U,oe[1]=U>>>8&255,A.check=kr(A.check,oe,2,0)),U=0,q=0,A.mode=16184;case 16184:if(1024&A.flags){for(;q<16;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}A.length=U,A.head&&(A.head.extra_len=U),512&A.flags&&4&A.wrap&&(oe[0]=255&U,oe[1]=U>>>8&255,A.check=kr(A.check,oe,2,0)),U=0,q=0}else A.head&&(A.head.extra=null);A.mode=16185;case 16185:if(1024&A.flags&&(N=A.length,N>S&&(N=S),N&&(A.head&&(G=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(v.subarray(k,k+N),G)),512&A.flags&&4&A.wrap&&(A.check=kr(A.check,v,N,k)),S-=N,k+=N,A.length-=N),A.length))break e;A.length=0,A.mode=16186;case 16186:if(2048&A.flags){if(S===0)break e;N=0;do G=v[k+N++],A.head&&G&&A.length<65536&&(A.head.name+=String.fromCharCode(G));while(G&&N<S);if(512&A.flags&&4&A.wrap&&(A.check=kr(A.check,v,N,k)),S-=N,k+=N,G)break e}else A.head&&(A.head.name=null);A.length=0,A.mode=16187;case 16187:if(4096&A.flags){if(S===0)break e;N=0;do G=v[k+N++],A.head&&G&&A.length<65536&&(A.head.comment+=String.fromCharCode(G));while(G&&N<S);if(512&A.flags&&4&A.wrap&&(A.check=kr(A.check,v,N,k)),S-=N,k+=N,G)break e}else A.head&&(A.head.comment=null);A.mode=16188;case 16188:if(512&A.flags){for(;q<16;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(4&A.wrap&&U!==(65535&A.check)){m.msg="header crc mismatch",A.mode=qi;break}U=0,q=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),m.adler=A.check=0,A.mode=xt;break;case 16189:for(;q<32;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}m.adler=A.check=_i(U),U=0,q=0,A.mode=Sr;case Sr:if(A.havedict===0)return m.next_out=P,m.avail_out=V,m.next_in=k,m.avail_in=S,A.hold=U,A.bits=q,$s;m.adler=A.check=1,A.mode=xt;case xt:if(g===un||g===en)break e;case ka:if(A.last){U>>>=7&q,q-=7&q,A.mode=ks;break}for(;q<3;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}switch(A.last=1&U,U>>>=1,q-=1,3&U){case 0:A.mode=16193;break;case 1:if(Dl(A),A.mode=to,g===en){U>>>=2,q-=2;break e}break;case 2:A.mode=16196;break;case 3:m.msg="invalid block type",A.mode=qi}U>>>=2,q-=2;break;case 16193:for(U>>>=7&q,q-=7&q;q<32;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if((65535&U)!=(U>>>16^65535)){m.msg="invalid stored block lengths",A.mode=qi;break}if(A.length=65535&U,U=0,q=0,A.mode=eo,g===en)break e;case eo:A.mode=16195;case 16195:if(N=A.length,N){if(N>S&&(N=S),N>V&&(N=V),N===0)break e;x.set(v.subarray(k,k+N),P),S-=N,k+=N,V-=N,P+=N,A.length-=N;break}A.mode=xt;break;case 16196:for(;q<14;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(A.nlen=257+(31&U),U>>>=5,q-=5,A.ndist=1+(31&U),U>>>=5,q-=5,A.ncode=4+(15&U),U>>>=4,q-=4,A.nlen>286||A.ndist>30){m.msg="too many length or distance symbols",A.mode=qi;break}A.have=0,A.mode=16197;case 16197:for(;A.have<A.ncode;){for(;q<3;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}A.lens[Be[A.have++]]=7&U,U>>>=3,q-=3}for(;A.have<19;)A.lens[Be[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,de={bits:A.lenbits},ue=ns(0,A.lens,0,19,A.lencode,0,A.work,de),A.lenbits=de.bits,ue){m.msg="invalid code lengths set",A.mode=qi;break}A.have=0,A.mode=16198;case 16198:for(;A.have<A.nlen+A.ndist;){for(;ie=A.lencode[U&(1<<A.lenbits)-1],ae=ie>>>24,Ae=ie>>>16&255,ve=65535&ie,!(ae<=q);){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(ve<16)U>>>=ae,q-=ae,A.lens[A.have++]=ve;else{if(ve===16){for(Se=ae+2;q<Se;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(U>>>=ae,q-=ae,A.have===0){m.msg="invalid bit length repeat",A.mode=qi;break}G=A.lens[A.have-1],N=3+(3&U),U>>>=2,q-=2}else if(ve===17){for(Se=ae+3;q<Se;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}U>>>=ae,q-=ae,G=0,N=3+(7&U),U>>>=3,q-=3}else{for(Se=ae+7;q<Se;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}U>>>=ae,q-=ae,G=0,N=11+(127&U),U>>>=7,q-=7}if(A.have+N>A.nlen+A.ndist){m.msg="invalid bit length repeat",A.mode=qi;break}for(;N--;)A.lens[A.have++]=G}}if(A.mode===qi)break;if(A.lens[256]===0){m.msg="invalid code -- missing end-of-block",A.mode=qi;break}if(A.lenbits=9,de={bits:A.lenbits},ue=ns(1,A.lens,0,A.nlen,A.lencode,0,A.work,de),A.lenbits=de.bits,ue){m.msg="invalid literal/lengths set",A.mode=qi;break}if(A.distbits=6,A.distcode=A.distdyn,de={bits:A.distbits},ue=ns(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,de),A.distbits=de.bits,ue){m.msg="invalid distances set",A.mode=qi;break}if(A.mode=to,g===en)break e;case to:A.mode=os;case os:if(S>=6&&V>=258){m.next_out=P,m.avail_out=V,m.next_in=k,m.avail_in=S,A.hold=U,A.bits=q,Xa(m,Z),P=m.next_out,x=m.output,V=m.avail_out,k=m.next_in,v=m.input,S=m.avail_in,U=A.hold,q=A.bits,A.mode===xt&&(A.back=-1);break}for(A.back=0;ie=A.lencode[U&(1<<A.lenbits)-1],ae=ie>>>24,Ae=ie>>>16&255,ve=65535&ie,!(ae<=q);){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(Ae&&!(240&Ae)){for(Ie=ae,ke=Ae,K=ve;ie=A.lencode[K+((U&(1<<Ie+ke)-1)>>Ie)],ae=ie>>>24,Ae=ie>>>16&255,ve=65535&ie,!(Ie+ae<=q);){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}U>>>=Ie,q-=Ie,A.back+=Ie}if(U>>>=ae,q-=ae,A.back+=ae,A.length=ve,Ae===0){A.mode=16205;break}if(32&Ae){A.back=-1,A.mode=xt;break}if(64&Ae){m.msg="invalid literal/length code",A.mode=qi;break}A.extra=15&Ae,A.mode=16201;case 16201:if(A.extra){for(Se=A.extra;q<Se;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}A.length+=U&(1<<A.extra)-1,U>>>=A.extra,q-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=16202;case 16202:for(;ie=A.distcode[U&(1<<A.distbits)-1],ae=ie>>>24,Ae=ie>>>16&255,ve=65535&ie,!(ae<=q);){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(!(240&Ae)){for(Ie=ae,ke=Ae,K=ve;ie=A.distcode[K+((U&(1<<Ie+ke)-1)>>Ie)],ae=ie>>>24,Ae=ie>>>16&255,ve=65535&ie,!(Ie+ae<=q);){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}U>>>=Ie,q-=Ie,A.back+=Ie}if(U>>>=ae,q-=ae,A.back+=ae,64&Ae){m.msg="invalid distance code",A.mode=qi;break}A.offset=ve,A.extra=15&Ae,A.mode=16203;case 16203:if(A.extra){for(Se=A.extra;q<Se;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}A.offset+=U&(1<<A.extra)-1,U>>>=A.extra,q-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){m.msg="invalid distance too far back",A.mode=qi;break}A.mode=16204;case 16204:if(V===0)break e;if(N=Z-V,A.offset>N){if(N=A.offset-N,N>A.whave&&A.sane){m.msg="invalid distance too far back",A.mode=qi;break}N>A.wnext?(N-=A.wnext,se=A.wsize-N):se=A.wnext-N,N>A.length&&(N=A.length),ce=A.window}else ce=x,se=P-A.offset,N=A.length;N>V&&(N=V),V-=N,A.length-=N;do x[P++]=ce[se++];while(--N);A.length===0&&(A.mode=os);break;case 16205:if(V===0)break e;x[P++]=A.length,V--,A.mode=os;break;case ks:if(A.wrap){for(;q<32;){if(S===0)break e;S--,U|=v[k++]<<q,q+=8}if(Z-=V,m.total_out+=Z,A.total+=Z,4&A.wrap&&Z&&(m.adler=A.check=A.flags?kr(A.check,x,Z,P-Z):Za(A.check,x,Z,P-Z)),Z=V,4&A.wrap&&(A.flags?U:_i(U))!==A.check){m.msg="incorrect data check",A.mode=qi;break}U=0,q=0}A.mode=16207;case 16207:if(A.wrap&&A.flags){for(;q<32;){if(S===0)break e;S--,U+=v[k++]<<q,q+=8}if(4&A.wrap&&U!==(4294967295&A.total)){m.msg="incorrect length check",A.mode=qi;break}U=0,q=0}A.mode=16208;case 16208:ue=En;break e;case qi:ue=Wl;break e;case 16210:return Ql;default:return An}return m.next_out=P,m.avail_out=V,m.next_in=k,m.avail_in=S,A.hold=U,A.bits=q,(A.wsize||Z!==m.avail_out&&A.mode<qi&&(A.mode<ks||g!==El))&&ic(m,m.output,m.next_out,Z-m.avail_out),re-=m.avail_in,Z-=m.avail_out,m.total_in+=re,m.total_out+=Z,A.total+=Z,4&A.wrap&&Z&&(m.adler=A.check=A.flags?kr(A.check,x,Z,m.next_out-Z):Za(A.check,x,Z,m.next_out-Z)),m.data_type=A.bits+(A.last?64:0)+(A.mode===xt?128:0)+(A.mode===to||A.mode===eo?256:0),(re===0&&Z===0||g===El)&&ue===ss&&(ue=Xl),ue},ir={inflateReset:ec,inflateReset2:Xs,inflateResetKeep:Fo,inflateInit:m=>Sl(m,15),inflateInit2:Sl,inflate:Bc,inflateEnd:m=>{if(Ws(m))return An;let g=m.state;return g.window&&(g.window=null),m.state=null,ss},inflateGetHeader:(m,g)=>{if(Ws(m))return An;const A=m.state;return 2&A.wrap?(A.head=g,g.done=!1,ss):An},inflateSetDictionary:(m,g)=>{const A=g.length;let v,x,k;return Ws(m)?An:(v=m.state,v.wrap!==0&&v.mode!==Sr?An:v.mode===Sr&&(x=1,x=Za(x,g,A,0),x!==v.check)?Wl:(k=ic(m,g,A,A),k?(v.mode=16210,Ql):(v.havedict=1,ss)))},inflateInfo:"pako inflate (from Nodeca project)"},Vi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ea=Object.prototype.toString,{Z_NO_FLUSH:Go,Z_FINISH:Uo,Z_OK:Sa,Z_STREAM_END:ta,Z_NEED_DICT:ia,Z_STREAM_ERROR:On,Z_DATA_ERROR:Da,Z_MEM_ERROR:zt}=Mo;function jt(m){this.options=Po.assign({chunkSize:65536,windowBits:15,to:""},m||{});const g=this.options;g.raw&&g.windowBits>=0&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(g.windowBits>=0&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),g.windowBits>15&&g.windowBits<48&&(15&g.windowBits||(g.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ks,this.strm.avail_out=0;let A=ir.inflateInit2(this.strm,g.windowBits);if(A!==Sa)throw new Error(Cn[A]);if(this.header=new Vi,ir.inflateGetHeader(this.strm,this.header),g.dictionary&&(typeof g.dictionary=="string"?g.dictionary=Wa.string2buf(g.dictionary):ea.call(g.dictionary)==="[object ArrayBuffer]"&&(g.dictionary=new Uint8Array(g.dictionary)),g.raw&&(A=ir.inflateSetDictionary(this.strm,g.dictionary),A!==Sa)))throw new Error(Cn[A])}function No(m,g){const A=new jt(g);if(A.push(m),A.err)throw A.msg||Cn[A.err];return A.result}jt.prototype.push=function(m,g){const A=this.strm,v=this.options.chunkSize,x=this.options.dictionary;let k,P,S;if(this.ended)return!1;for(P=g===~~g?g:g===!0?Uo:Go,ea.call(m)==="[object ArrayBuffer]"?A.input=new Uint8Array(m):A.input=m,A.next_in=0,A.avail_in=A.input.length;;){for(A.avail_out===0&&(A.output=new Uint8Array(v),A.next_out=0,A.avail_out=v),k=ir.inflate(A,P),k===ia&&x&&(k=ir.inflateSetDictionary(A,x),k===Sa?k=ir.inflate(A,P):k===Da&&(k=ia));A.avail_in>0&&k===ta&&A.state.wrap>0&&m[A.next_in]!==0;)ir.inflateReset(A),k=ir.inflate(A,P);switch(k){case On:case Da:case ia:case zt:return this.onEnd(k),this.ended=!0,!1}if(S=A.avail_out,A.next_out&&(A.avail_out===0||k===ta))if(this.options.to==="string"){let V=Wa.utf8border(A.output,A.next_out),U=A.next_out-V,q=Wa.buf2string(A.output,V);A.next_out=U,A.avail_out=v-U,U&&A.output.set(A.output.subarray(V,V+U),0),this.onData(q)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(k!==Sa||S!==0){if(k===ta)return k=ir.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,!0;if(A.avail_in===0)break}}return!0},jt.prototype.onData=function(m){this.chunks.push(m)},jt.prototype.onEnd=function(m){m===Sa&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Po.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg};var Oo={inflate:No};const{inflate:Ml}=Oo;var u=Ml,e=Object.freeze({__proto__:null,default:class extends Rn{decodeBlock(m){return u(new Uint8Array(m)).buffer}}}),n=Object.freeze({__proto__:null,default:class extends Rn{decodeBlock(m){const g=new DataView(m),A=[];for(let v=0;v<m.byteLength;++v){let x=g.getInt8(v);if(x<0){const k=g.getUint8(v+1);x=-x;for(let P=0;P<=x;++P)A.push(k);v+=1}else{for(let k=0;k<=x;++k)A.push(g.getUint8(v+k+1));v+=x+1}}return new Uint8Array(A).buffer}}}),a={exports:{}};(function(m){/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var g,A,v,x,k,P,S,V,U,q,re,Z,N,se,ce,ae,Ae=(g={defaultNoDataValue:-34027999387901484e22,decode:function(K,G){var ue=(G=G||{}).encodedMaskData||G.encodedMaskData===null,ie=k(K,G.inputOffset||0,ue),oe=G.noDataValue!==null?G.noDataValue:g.defaultNoDataValue,de=A(ie,G.pixelType||Float32Array,G.encodedMaskData,oe,G.returnMask),Se={width:ie.width,height:ie.height,pixelData:de.resultPixels,minValue:de.minValue,maxValue:ie.pixels.maxValue,noDataValue:oe};return de.resultMask&&(Se.maskData=de.resultMask),G.returnEncodedMask&&ie.mask&&(Se.encodedMaskData=ie.mask.bitset?ie.mask.bitset:null),G.returnFileInfo&&(Se.fileInfo=v(ie),G.computeUsedBitDepths&&(Se.fileInfo.bitDepths=x(ie))),Se}},A=function(K,G,ue,ie,oe){var de,Se,Be,Qe=0,Ge=K.pixels.numBlocksX,He=K.pixels.numBlocksY,Ke=Math.floor(K.width/Ge),tt=Math.floor(K.height/He),mt=2*K.maxZError,Oe=Number.MAX_VALUE;ue=ue||(K.mask?K.mask.bitset:null),Se=new G(K.width*K.height),oe&&ue&&(Be=new Uint8Array(K.width*K.height));for(var Fe,et,Dt=new Float32Array(Ke*tt),At=0;At<=He;At++){var Lt=At!==He?tt:K.height%He;if(Lt!==0)for(var ht=0;ht<=Ge;ht++){var Ct=ht!==Ge?Ke:K.width%Ge;if(Ct!==0){var It,ct,Et,bi,ui=At*K.width*tt+ht*Ke,vi=K.width-Ct,xi=K.pixels.blocks[Qe];if(xi.encoding<2?(xi.encoding===0?It=xi.rawData:(P(xi.stuffedData,xi.bitsPerPixel,xi.numValidPixels,xi.offset,mt,Dt,K.pixels.maxValue),It=Dt),ct=0):Et=xi.encoding===2?0:xi.offset,ue)for(et=0;et<Lt;et++){for(7&ui&&(bi=ue[ui>>3],bi<<=7&ui),Fe=0;Fe<Ct;Fe++)7&ui||(bi=ue[ui>>3]),128&bi?(Be&&(Be[ui]=1),Oe=Oe>(de=xi.encoding<2?It[ct++]:Et)?de:Oe,Se[ui++]=de):(Be&&(Be[ui]=0),Se[ui++]=ie),bi<<=1;ui+=vi}else if(xi.encoding<2)for(et=0;et<Lt;et++){for(Fe=0;Fe<Ct;Fe++)Oe=Oe>(de=It[ct++])?de:Oe,Se[ui++]=de;ui+=vi}else for(Oe=Oe>Et?Et:Oe,et=0;et<Lt;et++){for(Fe=0;Fe<Ct;Fe++)Se[ui++]=Et;ui+=vi}if(xi.encoding===1&&ct!==xi.numValidPixels)throw"Block and Mask do not match";Qe++}}}return{resultPixels:Se,resultMask:Be,minValue:Oe}},v=function(K){return{fileIdentifierString:K.fileIdentifierString,fileVersion:K.fileVersion,imageType:K.imageType,height:K.height,width:K.width,maxZError:K.maxZError,eofOffset:K.eofOffset,mask:K.mask?{numBlocksX:K.mask.numBlocksX,numBlocksY:K.mask.numBlocksY,numBytes:K.mask.numBytes,maxValue:K.mask.maxValue}:null,pixels:{numBlocksX:K.pixels.numBlocksX,numBlocksY:K.pixels.numBlocksY,numBytes:K.pixels.numBytes,maxValue:K.pixels.maxValue,noDataValue:K.noDataValue}}},x=function(K){for(var G=K.pixels.numBlocksX*K.pixels.numBlocksY,ue={},ie=0;ie<G;ie++){var oe=K.pixels.blocks[ie];oe.encoding===0?ue.float32=!0:oe.encoding===1?ue[oe.bitsPerPixel]=!0:ue[0]=!0}return Object.keys(ue)},k=function(K,G,ue){var ie={},oe=new Uint8Array(K,G,10);if(ie.fileIdentifierString=String.fromCharCode.apply(null,oe),ie.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+ie.fileIdentifierString;G+=10;var de=new DataView(K,G,24);if(ie.fileVersion=de.getInt32(0,!0),ie.imageType=de.getInt32(4,!0),ie.height=de.getUint32(8,!0),ie.width=de.getUint32(12,!0),ie.maxZError=de.getFloat64(16,!0),G+=24,!ue)if(de=new DataView(K,G,16),ie.mask={},ie.mask.numBlocksY=de.getUint32(0,!0),ie.mask.numBlocksX=de.getUint32(4,!0),ie.mask.numBytes=de.getUint32(8,!0),ie.mask.maxValue=de.getFloat32(12,!0),G+=16,ie.mask.numBytes>0){var Se=new Uint8Array(Math.ceil(ie.width*ie.height/8)),Be=(de=new DataView(K,G,ie.mask.numBytes)).getInt16(0,!0),Qe=2,Ge=0;do{if(Be>0)for(;Be--;)Se[Ge++]=de.getUint8(Qe++);else{var He=de.getUint8(Qe++);for(Be=-Be;Be--;)Se[Ge++]=He}Be=de.getInt16(Qe,!0),Qe+=2}while(Qe<ie.mask.numBytes);if(Be!==-32768||Ge<Se.length)throw"Unexpected end of mask RLE encoding";ie.mask.bitset=Se,G+=ie.mask.numBytes}else ie.mask.numBytes|ie.mask.numBlocksY|ie.mask.maxValue||(ie.mask.bitset=new Uint8Array(Math.ceil(ie.width*ie.height/8)));de=new DataView(K,G,16),ie.pixels={},ie.pixels.numBlocksY=de.getUint32(0,!0),ie.pixels.numBlocksX=de.getUint32(4,!0),ie.pixels.numBytes=de.getUint32(8,!0),ie.pixels.maxValue=de.getFloat32(12,!0),G+=16;var Ke=ie.pixels.numBlocksX,tt=ie.pixels.numBlocksY,mt=Ke+(ie.width%Ke>0?1:0),Oe=tt+(ie.height%tt>0?1:0);ie.pixels.blocks=new Array(mt*Oe);for(var Fe=0,et=0;et<Oe;et++)for(var Dt=0;Dt<mt;Dt++){var At=0,Lt=K.byteLength-G;de=new DataView(K,G,Math.min(10,Lt));var ht={};ie.pixels.blocks[Fe++]=ht;var Ct=de.getUint8(0);if(At++,ht.encoding=63&Ct,ht.encoding>3)throw"Invalid block encoding ("+ht.encoding+")";if(ht.encoding!==2){if(Ct!==0&&Ct!==2){if(Ct>>=6,ht.offsetType=Ct,Ct===2)ht.offset=de.getInt8(1),At++;else if(Ct===1)ht.offset=de.getInt16(1,!0),At+=2;else{if(Ct!==0)throw"Invalid block offset type";ht.offset=de.getFloat32(1,!0),At+=4}if(ht.encoding===1)if(Ct=de.getUint8(At),At++,ht.bitsPerPixel=63&Ct,Ct>>=6,ht.numValidPixelsType=Ct,Ct===2)ht.numValidPixels=de.getUint8(At),At++;else if(Ct===1)ht.numValidPixels=de.getUint16(At,!0),At+=2;else{if(Ct!==0)throw"Invalid valid pixel count type";ht.numValidPixels=de.getUint32(At,!0),At+=4}}var It;if(G+=At,ht.encoding!==3){if(ht.encoding===0){var ct=(ie.pixels.numBytes-1)/4;if(ct!==Math.floor(ct))throw"uncompressed block has invalid length";It=new ArrayBuffer(4*ct),new Uint8Array(It).set(new Uint8Array(K,G,4*ct));var Et=new Float32Array(It);ht.rawData=Et,G+=4*ct}else if(ht.encoding===1){var bi=Math.ceil(ht.numValidPixels*ht.bitsPerPixel/8),ui=Math.ceil(bi/4);It=new ArrayBuffer(4*ui),new Uint8Array(It).set(new Uint8Array(K,G,bi)),ht.stuffedData=new Uint32Array(It),G+=bi}}}else G++}return ie.eofOffset=G,ie},P=function(K,G,ue,ie,oe,de,Se){var Be,Qe,Ge,He=(1<<G)-1,Ke=0,tt=0,mt=Math.ceil((Se-ie)/oe),Oe=4*K.length-Math.ceil(G*ue/8);for(K[K.length-1]<<=8*Oe,Be=0;Be<ue;Be++){if(tt===0&&(Ge=K[Ke++],tt=32),tt>=G)Qe=Ge>>>tt-G&He,tt-=G;else{var Fe=G-tt;Qe=(Ge&He)<<Fe&He,Qe+=(Ge=K[Ke++])>>>(tt=32-Fe)}de[Be]=Qe<mt?ie+Qe*oe:Se}return de},g),ve=(S=function(K,G,ue,ie,oe,de,Se,Be){var Qe,Ge,He,Ke,tt,mt=(1<<ue)-1,Oe=0,Fe=0,et=4*K.length-Math.ceil(ue*ie/8);if(K[K.length-1]<<=8*et,oe)for(Qe=0;Qe<ie;Qe++)Fe===0&&(He=K[Oe++],Fe=32),Fe>=ue?(Ge=He>>>Fe-ue&mt,Fe-=ue):(Ge=(He&mt)<<(Ke=ue-Fe)&mt,Ge+=(He=K[Oe++])>>>(Fe=32-Ke)),G[Qe]=oe[Ge];else for(tt=Math.ceil((Be-de)/Se),Qe=0;Qe<ie;Qe++)Fe===0&&(He=K[Oe++],Fe=32),Fe>=ue?(Ge=He>>>Fe-ue&mt,Fe-=ue):(Ge=(He&mt)<<(Ke=ue-Fe)&mt,Ge+=(He=K[Oe++])>>>(Fe=32-Ke)),G[Qe]=Ge<tt?de+Ge*Se:Be},V=function(K,G,ue,ie,oe,de){var Se,Be=(1<<G)-1,Qe=0,Ge=0,He=0,Ke=0,tt=0,mt=[],Oe=4*K.length-Math.ceil(G*ue/8);K[K.length-1]<<=8*Oe;var Fe=Math.ceil((de-ie)/oe);for(Ge=0;Ge<ue;Ge++)Ke===0&&(Se=K[Qe++],Ke=32),Ke>=G?(tt=Se>>>Ke-G&Be,Ke-=G):(tt=(Se&Be)<<(He=G-Ke)&Be,tt+=(Se=K[Qe++])>>>(Ke=32-He)),mt[Ge]=tt<Fe?ie+tt*oe:de;return mt.unshift(ie),mt},U=function(K,G,ue,ie,oe,de,Se,Be){var Qe,Ge,He,Ke,tt=(1<<ue)-1,mt=0,Oe=0,Fe=0;if(oe)for(Qe=0;Qe<ie;Qe++)Oe===0&&(He=K[mt++],Oe=32,Fe=0),Oe>=ue?(Ge=He>>>Fe&tt,Oe-=ue,Fe+=ue):(Ge=He>>>Fe&tt,Oe=32-(Ke=ue-Oe),Ge|=((He=K[mt++])&(1<<Ke)-1)<<ue-Ke,Fe=Ke),G[Qe]=oe[Ge];else{var et=Math.ceil((Be-de)/Se);for(Qe=0;Qe<ie;Qe++)Oe===0&&(He=K[mt++],Oe=32,Fe=0),Oe>=ue?(Ge=He>>>Fe&tt,Oe-=ue,Fe+=ue):(Ge=He>>>Fe&tt,Oe=32-(Ke=ue-Oe),Ge|=((He=K[mt++])&(1<<Ke)-1)<<ue-Ke,Fe=Ke),G[Qe]=Ge<et?de+Ge*Se:Be}return G},q=function(K,G,ue,ie,oe,de){var Se,Be=(1<<G)-1,Qe=0,Ge=0,He=0,Ke=0,tt=0,mt=0,Oe=[],Fe=Math.ceil((de-ie)/oe);for(Ge=0;Ge<ue;Ge++)Ke===0&&(Se=K[Qe++],Ke=32,mt=0),Ke>=G?(tt=Se>>>mt&Be,Ke-=G,mt+=G):(tt=Se>>>mt&Be,Ke=32-(He=G-Ke),tt|=((Se=K[Qe++])&(1<<He)-1)<<G-He,mt=He),Oe[Ge]=tt<Fe?ie+tt*oe:de;return Oe.unshift(ie),Oe},re=function(K,G,ue,ie){var oe,de,Se,Be,Qe=(1<<ue)-1,Ge=0,He=0,Ke=4*K.length-Math.ceil(ue*ie/8);for(K[K.length-1]<<=8*Ke,oe=0;oe<ie;oe++)He===0&&(Se=K[Ge++],He=32),He>=ue?(de=Se>>>He-ue&Qe,He-=ue):(de=(Se&Qe)<<(Be=ue-He)&Qe,de+=(Se=K[Ge++])>>>(He=32-Be)),G[oe]=de;return G},Z=function(K,G,ue,ie){var oe,de,Se,Be,Qe=(1<<ue)-1,Ge=0,He=0,Ke=0;for(oe=0;oe<ie;oe++)He===0&&(Se=K[Ge++],He=32,Ke=0),He>=ue?(de=Se>>>Ke&Qe,He-=ue,Ke+=ue):(de=Se>>>Ke&Qe,He=32-(Be=ue-He),de|=((Se=K[Ge++])&(1<<Be)-1)<<ue-Be,Ke=Be),G[oe]=de;return G},N={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(K){for(var G=65535,ue=65535,ie=K.length,oe=Math.floor(ie/2),de=0;oe;){var Se=oe>=359?359:oe;oe-=Se;do G+=K[de++]<<8,ue+=G+=K[de++];while(--Se);G=(65535&G)+(G>>>16),ue=(65535&ue)+(ue>>>16)}return 1&ie&&(ue+=G+=K[de]<<8),((ue=(65535&ue)+(ue>>>16))<<16|(G=(65535&G)+(G>>>16)))>>>0},readHeaderInfo:function(K,G){var ue=G.ptr,ie=new Uint8Array(K,ue,6),oe={};if(oe.fileIdentifierString=String.fromCharCode.apply(null,ie),oe.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+oe.fileIdentifierString;ue+=6;var de,Se=new DataView(K,ue,8),Be=Se.getInt32(0,!0);if(oe.fileVersion=Be,ue+=4,Be>=3&&(oe.checksum=Se.getUint32(4,!0),ue+=4),Se=new DataView(K,ue,12),oe.height=Se.getUint32(0,!0),oe.width=Se.getUint32(4,!0),ue+=8,Be>=4?(oe.numDims=Se.getUint32(8,!0),ue+=4):oe.numDims=1,Se=new DataView(K,ue,40),oe.numValidPixel=Se.getUint32(0,!0),oe.microBlockSize=Se.getInt32(4,!0),oe.blobSize=Se.getInt32(8,!0),oe.imageType=Se.getInt32(12,!0),oe.maxZError=Se.getFloat64(16,!0),oe.zMin=Se.getFloat64(24,!0),oe.zMax=Se.getFloat64(32,!0),ue+=40,G.headerInfo=oe,G.ptr=ue,Be>=3&&(de=Be>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(K,ue-de,oe.blobSize-14))!==oe.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(K,G){var ue=G.headerInfo,ie=this.getDataTypeArray(ue.imageType),oe=ue.numDims*this.getDataTypeSize(ue.imageType),de=this.readSubArray(K,G.ptr,ie,oe),Se=this.readSubArray(K,G.ptr+oe,ie,oe);G.ptr+=2*oe;var Be,Qe=!0;for(Be=0;Be<ue.numDims;Be++)if(de[Be]!==Se[Be]){Qe=!1;break}return ue.minValues=de,ue.maxValues=Se,Qe},readSubArray:function(K,G,ue,ie){var oe;if(ue===Uint8Array)oe=new Uint8Array(K,G,ie);else{var de=new ArrayBuffer(ie);new Uint8Array(de).set(new Uint8Array(K,G,ie)),oe=new ue(de)}return oe},readMask:function(K,G){var ue,ie,oe=G.ptr,de=G.headerInfo,Se=de.width*de.height,Be=de.numValidPixel,Qe=new DataView(K,oe,4),Ge={};if(Ge.numBytes=Qe.getUint32(0,!0),oe+=4,(Be===0||Se===Be)&&Ge.numBytes!==0)throw"invalid mask";if(Be===0)ue=new Uint8Array(Math.ceil(Se/8)),Ge.bitset=ue,ie=new Uint8Array(Se),G.pixels.resultMask=ie,oe+=Ge.numBytes;else if(Ge.numBytes>0){ue=new Uint8Array(Math.ceil(Se/8));var He=(Qe=new DataView(K,oe,Ge.numBytes)).getInt16(0,!0),Ke=2,tt=0,mt=0;do{if(He>0)for(;He--;)ue[tt++]=Qe.getUint8(Ke++);else for(mt=Qe.getUint8(Ke++),He=-He;He--;)ue[tt++]=mt;He=Qe.getInt16(Ke,!0),Ke+=2}while(Ke<Ge.numBytes);if(He!==-32768||tt<ue.length)throw"Unexpected end of mask RLE encoding";ie=new Uint8Array(Se);var Oe=0,Fe=0;for(Fe=0;Fe<Se;Fe++)7&Fe?(Oe=ue[Fe>>3],Oe<<=7&Fe):Oe=ue[Fe>>3],128&Oe&&(ie[Fe]=1);G.pixels.resultMask=ie,Ge.bitset=ue,oe+=Ge.numBytes}return G.ptr=oe,G.mask=Ge,!0},readDataOneSweep:function(K,G,ue,ie){var oe,de=G.ptr,Se=G.headerInfo,Be=Se.numDims,Qe=Se.width*Se.height,Ge=Se.imageType,He=Se.numValidPixel*N.getDataTypeSize(Ge)*Be,Ke=G.pixels.resultMask;if(ue===Uint8Array)oe=new Uint8Array(K,de,He);else{var tt=new ArrayBuffer(He);new Uint8Array(tt).set(new Uint8Array(K,de,He)),oe=new ue(tt)}if(oe.length===Qe*Be)G.pixels.resultPixels=ie?N.swapDimensionOrder(oe,Qe,Be,ue,!0):oe;else{G.pixels.resultPixels=new ue(Qe*Be);var mt=0,Oe=0,Fe=0,et=0;if(Be>1){if(ie){for(Oe=0;Oe<Qe;Oe++)if(Ke[Oe])for(et=Oe,Fe=0;Fe<Be;Fe++,et+=Qe)G.pixels.resultPixels[et]=oe[mt++]}else for(Oe=0;Oe<Qe;Oe++)if(Ke[Oe])for(et=Oe*Be,Fe=0;Fe<Be;Fe++)G.pixels.resultPixels[et+Fe]=oe[mt++]}else for(Oe=0;Oe<Qe;Oe++)Ke[Oe]&&(G.pixels.resultPixels[Oe]=oe[mt++])}return de+=He,G.ptr=de,!0},readHuffmanTree:function(K,G){var ue=this.HUFFMAN_LUT_BITS_MAX,ie=new DataView(K,G.ptr,16);if(G.ptr+=16,ie.getInt32(0,!0)<2)throw"unsupported Huffman version";var oe=ie.getInt32(4,!0),de=ie.getInt32(8,!0),Se=ie.getInt32(12,!0);if(de>=Se)return!1;var Be=new Uint32Array(Se-de);N.decodeBits(K,G,Be);var Qe,Ge,He,Ke,tt=[];for(Qe=de;Qe<Se;Qe++)tt[Ge=Qe-(Qe<oe?0:oe)]={first:Be[Qe-de],second:null};var mt=K.byteLength-G.ptr,Oe=Math.ceil(mt/4),Fe=new ArrayBuffer(4*Oe);new Uint8Array(Fe).set(new Uint8Array(K,G.ptr,mt));var et,Dt=new Uint32Array(Fe),At=0,Lt=0;for(et=Dt[0],Qe=de;Qe<Se;Qe++)(Ke=tt[Ge=Qe-(Qe<oe?0:oe)].first)>0&&(tt[Ge].second=et<<At>>>32-Ke,32-At>=Ke?(At+=Ke)===32&&(At=0,et=Dt[++Lt]):(At+=Ke-32,et=Dt[++Lt],tt[Ge].second|=et>>>32-At));var ht=0,Ct=0,It=new se;for(Qe=0;Qe<tt.length;Qe++)tt[Qe]!==void 0&&(ht=Math.max(ht,tt[Qe].first));Ct=ht>=ue?ue:ht;var ct,Et,bi,ui,vi,xi=[];for(Qe=de;Qe<Se;Qe++)if((Ke=tt[Ge=Qe-(Qe<oe?0:oe)].first)>0)if(ct=[Ke,Ge],Ke<=Ct)for(Et=tt[Ge].second<<Ct-Ke,bi=1<<Ct-Ke,He=0;He<bi;He++)xi[Et|He]=ct;else for(Et=tt[Ge].second,vi=It,ui=Ke-1;ui>=0;ui--)Et>>>ui&1?(vi.right||(vi.right=new se),vi=vi.right):(vi.left||(vi.left=new se),vi=vi.left),ui!==0||vi.val||(vi.val=ct[1]);return{decodeLut:xi,numBitsLUTQick:Ct,numBitsLUT:ht,tree:It,stuffedData:Dt,srcPtr:Lt,bitPos:At}},readHuffman:function(K,G,ue,ie){var oe,de,Se,Be,Qe,Ge,He,Ke,tt,mt=G.headerInfo.numDims,Oe=G.headerInfo.height,Fe=G.headerInfo.width,et=Fe*Oe,Dt=this.readHuffmanTree(K,G),At=Dt.decodeLut,Lt=Dt.tree,ht=Dt.stuffedData,Ct=Dt.srcPtr,It=Dt.bitPos,ct=Dt.numBitsLUTQick,Et=Dt.numBitsLUT,bi=G.headerInfo.imageType===0?128:0,ui=G.pixels.resultMask,vi=0;It>0&&(Ct++,It=0);var xi,tn=ht[Ct],xr=G.encodeMode===1,Ss=new ue(et*mt),ii=Ss;if(mt<2||xr){for(xi=0;xi<mt;xi++)if(mt>1&&(ii=new ue(Ss.buffer,et*xi,et),vi=0),G.headerInfo.numValidPixel===Fe*Oe)for(Ke=0,Ge=0;Ge<Oe;Ge++)for(He=0;He<Fe;He++,Ke++){if(de=0,Qe=Be=tn<<It>>>32-ct,32-It<ct&&(Qe=Be|=ht[Ct+1]>>>64-It-ct),At[Qe])de=At[Qe][1],It+=At[Qe][0];else for(Qe=Be=tn<<It>>>32-Et,32-It<Et&&(Qe=Be|=ht[Ct+1]>>>64-It-Et),oe=Lt,tt=0;tt<Et;tt++)if(!(oe=Be>>>Et-tt-1&1?oe.right:oe.left).left&&!oe.right){de=oe.val,It=It+tt+1;break}It>=32&&(It-=32,tn=ht[++Ct]),Se=de-bi,xr?(Se+=He>0?vi:Ge>0?ii[Ke-Fe]:vi,Se&=255,ii[Ke]=Se,vi=Se):ii[Ke]=Se}else for(Ke=0,Ge=0;Ge<Oe;Ge++)for(He=0;He<Fe;He++,Ke++)if(ui[Ke]){if(de=0,Qe=Be=tn<<It>>>32-ct,32-It<ct&&(Qe=Be|=ht[Ct+1]>>>64-It-ct),At[Qe])de=At[Qe][1],It+=At[Qe][0];else for(Qe=Be=tn<<It>>>32-Et,32-It<Et&&(Qe=Be|=ht[Ct+1]>>>64-It-Et),oe=Lt,tt=0;tt<Et;tt++)if(!(oe=Be>>>Et-tt-1&1?oe.right:oe.left).left&&!oe.right){de=oe.val,It=It+tt+1;break}It>=32&&(It-=32,tn=ht[++Ct]),Se=de-bi,xr?(He>0&&ui[Ke-1]?Se+=vi:Ge>0&&ui[Ke-Fe]?Se+=ii[Ke-Fe]:Se+=vi,Se&=255,ii[Ke]=Se,vi=Se):ii[Ke]=Se}}else for(Ke=0,Ge=0;Ge<Oe;Ge++)for(He=0;He<Fe;He++)if(Ke=Ge*Fe+He,!ui||ui[Ke])for(xi=0;xi<mt;xi++,Ke+=et){if(de=0,Qe=Be=tn<<It>>>32-ct,32-It<ct&&(Qe=Be|=ht[Ct+1]>>>64-It-ct),At[Qe])de=At[Qe][1],It+=At[Qe][0];else for(Qe=Be=tn<<It>>>32-Et,32-It<Et&&(Qe=Be|=ht[Ct+1]>>>64-It-Et),oe=Lt,tt=0;tt<Et;tt++)if(!(oe=Be>>>Et-tt-1&1?oe.right:oe.left).left&&!oe.right){de=oe.val,It=It+tt+1;break}It>=32&&(It-=32,tn=ht[++Ct]),Se=de-bi,ii[Ke]=Se}G.ptr=G.ptr+4*(Ct+1)+(It>0?4:0),G.pixels.resultPixels=Ss,mt>1&&!ie&&(G.pixels.resultPixels=N.swapDimensionOrder(Ss,et,mt,ue))},decodeBits:function(K,G,ue,ie,oe){var de=G.headerInfo,Se=de.fileVersion,Be=0,Qe=K.byteLength-G.ptr>=5?5:K.byteLength-G.ptr,Ge=new DataView(K,G.ptr,Qe),He=Ge.getUint8(0);Be++;var Ke=He>>6,tt=Ke===0?4:3-Ke,mt=(32&He)>0,Oe=31&He,Fe=0;if(tt===1)Fe=Ge.getUint8(Be),Be++;else if(tt===2)Fe=Ge.getUint16(Be,!0),Be+=2;else{if(tt!==4)throw"Invalid valid pixel count type";Fe=Ge.getUint32(Be,!0),Be+=4}var et,Dt,At,Lt,ht,Ct,It,ct,Et,bi=2*de.maxZError,ui=de.numDims>1?de.maxValues[oe]:de.zMax;if(mt){for(G.counter.lut++,ct=Ge.getUint8(Be),Be++,Lt=Math.ceil((ct-1)*Oe/8),ht=Math.ceil(Lt/4),Dt=new ArrayBuffer(4*ht),At=new Uint8Array(Dt),G.ptr+=Be,At.set(new Uint8Array(K,G.ptr,Lt)),It=new Uint32Array(Dt),G.ptr+=Lt,Et=0;ct-1>>>Et;)Et++;Lt=Math.ceil(Fe*Et/8),ht=Math.ceil(Lt/4),Dt=new ArrayBuffer(4*ht),(At=new Uint8Array(Dt)).set(new Uint8Array(K,G.ptr,Lt)),et=new Uint32Array(Dt),G.ptr+=Lt,Ct=Se>=3?q(It,Oe,ct-1,ie,bi,ui):V(It,Oe,ct-1,ie,bi,ui),Se>=3?U(et,ue,Et,Fe,Ct):S(et,ue,Et,Fe,Ct)}else G.counter.bitstuffer++,Et=Oe,G.ptr+=Be,Et>0&&(Lt=Math.ceil(Fe*Et/8),ht=Math.ceil(Lt/4),Dt=new ArrayBuffer(4*ht),(At=new Uint8Array(Dt)).set(new Uint8Array(K,G.ptr,Lt)),et=new Uint32Array(Dt),G.ptr+=Lt,Se>=3?ie==null?Z(et,ue,Et,Fe):U(et,ue,Et,Fe,!1,ie,bi,ui):ie==null?re(et,ue,Et,Fe):S(et,ue,Et,Fe,!1,ie,bi,ui))},readTiles:function(K,G,ue,ie){var oe=G.headerInfo,de=oe.width,Se=oe.height,Be=de*Se,Qe=oe.microBlockSize,Ge=oe.imageType,He=N.getDataTypeSize(Ge),Ke=Math.ceil(de/Qe),tt=Math.ceil(Se/Qe);G.pixels.numBlocksY=tt,G.pixels.numBlocksX=Ke,G.pixels.ptr=0;var mt,Oe,Fe,et,Dt,At,Lt,ht,Ct,It,ct=0,Et=0,bi=0,ui=0,vi=0,xi=0,tn=0,xr=0,Ss=0,ii=0,rn=0,Qn=0,ro=0,ls=0,gr=0,Ma=new ue(Qe*Qe),jc=Se%Qe||Qe,Jc=de%Qe||Qe,rc=oe.numDims,qn=G.pixels.resultMask,Fr=G.pixels.resultPixels,no=oe.fileVersion>=5?14:15,cs=oe.zMax;for(bi=0;bi<tt;bi++)for(vi=bi!==tt-1?Qe:jc,ui=0;ui<Ke;ui++)for(ii=bi*de*Qe+ui*Qe,rn=de-(xi=ui!==Ke-1?Qe:Jc),ht=0;ht<rc;ht++){if(rc>1?(It=Fr,ii=bi*de*Qe+ui*Qe,Fr=new ue(G.pixels.resultPixels.buffer,Be*ht*He,Be),cs=oe.maxValues[ht]):It=null,tn=K.byteLength-G.ptr,Oe={},gr=0,xr=(mt=new DataView(K,G.ptr,Math.min(10,tn))).getUint8(0),gr++,Ct=oe.fileVersion>=5?4&xr:0,Ss=xr>>6&255,(xr>>2&no)!=(ui*Qe>>3&no)||Ct&&ht===0)throw"integrity issue";if((Dt=3&xr)>3)throw G.ptr+=gr,"Invalid block encoding ("+Dt+")";if(Dt!==2)if(Dt===0){if(Ct)throw"integrity issue";if(G.counter.uncompressed++,G.ptr+=gr,Qn=(Qn=vi*xi*He)<(ro=K.byteLength-G.ptr)?Qn:ro,Fe=new ArrayBuffer(Qn%He==0?Qn:Qn+He-Qn%He),new Uint8Array(Fe).set(new Uint8Array(K,G.ptr,Qn)),et=new ue(Fe),ls=0,qn)for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)qn[ii]&&(Fr[ii]=et[ls++]),ii++;ii+=rn}else for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)Fr[ii++]=et[ls++];ii+=rn}G.ptr+=ls*He}else if(At=N.getDataTypeUsed(Ct&&Ge<6?4:Ge,Ss),Lt=N.getOnePixel(Oe,gr,At,mt),gr+=N.getDataTypeSize(At),Dt===3)if(G.ptr+=gr,G.counter.constantoffset++,qn)for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)qn[ii]&&(Fr[ii]=Ct?Math.min(cs,It[ii]+Lt):Lt),ii++;ii+=rn}else for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)Fr[ii]=Ct?Math.min(cs,It[ii]+Lt):Lt,ii++;ii+=rn}else if(G.ptr+=gr,N.decodeBits(K,G,Ma,Lt,ht),gr=0,Ct)if(qn)for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)qn[ii]&&(Fr[ii]=Ma[gr++]+It[ii]),ii++;ii+=rn}else for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)Fr[ii]=Ma[gr++]+It[ii],ii++;ii+=rn}else if(qn)for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)qn[ii]&&(Fr[ii]=Ma[gr++]),ii++;ii+=rn}else for(ct=0;ct<vi;ct++){for(Et=0;Et<xi;Et++)Fr[ii++]=Ma[gr++];ii+=rn}else{if(Ct)if(qn)for(ct=0;ct<vi;ct++)for(Et=0;Et<xi;Et++)qn[ii]&&(Fr[ii]=It[ii]),ii++;else for(ct=0;ct<vi;ct++)for(Et=0;Et<xi;Et++)Fr[ii]=It[ii],ii++;G.counter.constant++,G.ptr+=gr}}rc>1&&!ie&&(G.pixels.resultPixels=N.swapDimensionOrder(G.pixels.resultPixels,Be,rc,ue))},formatFileInfo:function(K){return{fileIdentifierString:K.headerInfo.fileIdentifierString,fileVersion:K.headerInfo.fileVersion,imageType:K.headerInfo.imageType,height:K.headerInfo.height,width:K.headerInfo.width,numValidPixel:K.headerInfo.numValidPixel,microBlockSize:K.headerInfo.microBlockSize,blobSize:K.headerInfo.blobSize,maxZError:K.headerInfo.maxZError,pixelType:N.getPixelType(K.headerInfo.imageType),eofOffset:K.eofOffset,mask:K.mask?{numBytes:K.mask.numBytes}:null,pixels:{numBlocksX:K.pixels.numBlocksX,numBlocksY:K.pixels.numBlocksY,maxValue:K.headerInfo.zMax,minValue:K.headerInfo.zMin,noDataValue:K.noDataValue}}},constructConstantSurface:function(K,G){var ue=K.headerInfo.zMax,ie=K.headerInfo.zMin,oe=K.headerInfo.maxValues,de=K.headerInfo.numDims,Se=K.headerInfo.height*K.headerInfo.width,Be=0,Qe=0,Ge=0,He=K.pixels.resultMask,Ke=K.pixels.resultPixels;if(He)if(de>1){if(G)for(Be=0;Be<de;Be++)for(Ge=Be*Se,ue=oe[Be],Qe=0;Qe<Se;Qe++)He[Qe]&&(Ke[Ge+Qe]=ue);else for(Qe=0;Qe<Se;Qe++)if(He[Qe])for(Ge=Qe*de,Be=0;Be<de;Be++)Ke[Ge+de]=oe[Be]}else for(Qe=0;Qe<Se;Qe++)He[Qe]&&(Ke[Qe]=ue);else if(de>1&&ie!==ue)if(G)for(Be=0;Be<de;Be++)for(Ge=Be*Se,ue=oe[Be],Qe=0;Qe<Se;Qe++)Ke[Ge+Qe]=ue;else for(Qe=0;Qe<Se;Qe++)for(Ge=Qe*de,Be=0;Be<de;Be++)Ke[Ge+Be]=oe[Be];else for(Qe=0;Qe<Se*de;Qe++)Ke[Qe]=ue},getDataTypeArray:function(K){var G;switch(K){case 0:G=Int8Array;break;case 1:G=Uint8Array;break;case 2:G=Int16Array;break;case 3:G=Uint16Array;break;case 4:G=Int32Array;break;case 5:G=Uint32Array;break;case 6:default:G=Float32Array;break;case 7:G=Float64Array}return G},getPixelType:function(K){var G;switch(K){case 0:G="S8";break;case 1:G="U8";break;case 2:G="S16";break;case 3:G="U16";break;case 4:G="S32";break;case 5:G="U32";break;case 6:default:G="F32";break;case 7:G="F64"}return G},isValidPixelValue:function(K,G){if(G==null)return!1;var ue;switch(K){case 0:ue=G>=-128&&G<=127;break;case 1:ue=G>=0&&G<=255;break;case 2:ue=G>=-32768&&G<=32767;break;case 3:ue=G>=0&&G<=65536;break;case 4:ue=G>=-2147483648&&G<=2147483647;break;case 5:ue=G>=0&&G<=4294967296;break;case 6:ue=G>=-34027999387901484e22&&G<=34027999387901484e22;break;case 7:ue=G>=-17976931348623157e292&&G<=17976931348623157e292;break;default:ue=!1}return ue},getDataTypeSize:function(K){var G=0;switch(K){case 0:case 1:G=1;break;case 2:case 3:G=2;break;case 4:case 5:case 6:G=4;break;case 7:G=8;break;default:G=K}return G},getDataTypeUsed:function(K,G){var ue=K;switch(K){case 2:case 4:ue=K-G;break;case 3:case 5:ue=K-2*G;break;case 6:ue=G===0?K:G===1?2:1;break;case 7:ue=G===0?K:K-2*G+1;break;default:ue=K}return ue},getOnePixel:function(K,G,ue,ie){var oe=0;switch(ue){case 0:oe=ie.getInt8(G);break;case 1:oe=ie.getUint8(G);break;case 2:oe=ie.getInt16(G,!0);break;case 3:oe=ie.getUint16(G,!0);break;case 4:oe=ie.getInt32(G,!0);break;case 5:oe=ie.getUInt32(G,!0);break;case 6:oe=ie.getFloat32(G,!0);break;case 7:oe=ie.getFloat64(G,!0);break;default:throw"the decoder does not understand this pixel type"}return oe},swapDimensionOrder:function(K,G,ue,ie,oe){var de=0,Se=0,Be=0,Qe=0,Ge=K;if(ue>1)if(Ge=new ie(G*ue),oe)for(de=0;de<G;de++)for(Qe=de,Be=0;Be<ue;Be++,Qe+=G)Ge[Qe]=K[Se++];else for(de=0;de<G;de++)for(Qe=de,Be=0;Be<ue;Be++,Qe+=G)Ge[Se++]=K[Qe];return Ge}},se=function(K,G,ue){this.val=K,this.left=G,this.right=ue},{decode:function(K,G){var ue=(G=G||{}).noDataValue,ie=0,oe={};if(oe.ptr=G.inputOffset||0,oe.pixels={},N.readHeaderInfo(K,oe)){var de=oe.headerInfo,Se=de.fileVersion,Be=N.getDataTypeArray(de.imageType);if(Se>5)throw"unsupported lerc version 2."+Se;N.readMask(K,oe),de.numValidPixel===de.width*de.height||oe.pixels.resultMask||(oe.pixels.resultMask=G.maskData);var Qe=de.width*de.height;oe.pixels.resultPixels=new Be(Qe*de.numDims),oe.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var Ge,He=!G.returnPixelInterleavedDims;if(de.numValidPixel!==0)if(de.zMax===de.zMin)N.constructConstantSurface(oe,He);else if(Se>=4&&N.checkMinMaxRanges(K,oe))N.constructConstantSurface(oe,He);else{var Ke=new DataView(K,oe.ptr,2),tt=Ke.getUint8(0);if(oe.ptr++,tt)N.readDataOneSweep(K,oe,Be,He);else if(Se>1&&de.imageType<=1&&Math.abs(de.maxZError-.5)<1e-5){var mt=Ke.getUint8(1);if(oe.ptr++,oe.encodeMode=mt,mt>2||Se<4&&mt>1)throw"Invalid Huffman flag "+mt;mt?N.readHuffman(K,oe,Be,He):N.readTiles(K,oe,Be,He)}else N.readTiles(K,oe,Be,He)}oe.eofOffset=oe.ptr,G.inputOffset?(Ge=oe.headerInfo.blobSize+G.inputOffset-oe.ptr,Math.abs(Ge)>=1&&(oe.eofOffset=G.inputOffset+oe.headerInfo.blobSize)):(Ge=oe.headerInfo.blobSize-oe.ptr,Math.abs(Ge)>=1&&(oe.eofOffset=oe.headerInfo.blobSize));var Oe={width:de.width,height:de.height,pixelData:oe.pixels.resultPixels,minValue:de.zMin,maxValue:de.zMax,validPixelCount:de.numValidPixel,dimCount:de.numDims,dimStats:{minValues:de.minValues,maxValues:de.maxValues},maskData:oe.pixels.resultMask};if(oe.pixels.resultMask&&N.isValidPixelValue(de.imageType,ue)){var Fe=oe.pixels.resultMask;for(ie=0;ie<Qe;ie++)Fe[ie]||(Oe.pixelData[ie]=ue);Oe.noDataValue=ue}return oe.noDataValue=ue,G.returnFileInfo&&(Oe.fileInfo=N.formatFileInfo(oe)),Oe}},getBandCount:function(K){for(var G=0,ue=0,ie={ptr:0,pixels:{}};ue<K.byteLength-58;)N.readHeaderInfo(K,ie),ue+=ie.headerInfo.blobSize,G++,ie.ptr=ue;return G}}),Ie=(ce=new ArrayBuffer(4),ae=new Uint8Array(ce),new Uint32Array(ce)[0]=1,ae[0]===1),ke={decode:function(K,G){if(!Ie)throw"Big endian system is not supported.";var ue,ie,oe=(G=G||{}).inputOffset||0,de=new Uint8Array(K,oe,10),Se=String.fromCharCode.apply(null,de);if(Se.trim()==="CntZImage")ue=Ae,ie=1;else{if(Se.substring(0,5)!=="Lerc2")throw"Unexpected file identifier string: "+Se;ue=ve,ie=2}for(var Be,Qe,Ge,He,Ke,tt,mt=0,Oe=K.byteLength-10,Fe=[],et={width:0,height:0,pixels:[],pixelType:G.pixelType,mask:null,statistics:[]},Dt=0;oe<Oe;){var At=ue.decode(K,{inputOffset:oe,encodedMaskData:Be,maskData:Ge,returnMask:mt===0,returnEncodedMask:mt===0,returnFileInfo:!0,returnPixelInterleavedDims:G.returnPixelInterleavedDims,pixelType:G.pixelType||null,noDataValue:G.noDataValue||null});oe=At.fileInfo.eofOffset,Ge=At.maskData,mt===0&&(Be=At.encodedMaskData,et.width=At.width,et.height=At.height,et.dimCount=At.dimCount||1,et.pixelType=At.pixelType||At.fileInfo.pixelType,et.mask=Ge),ie>1&&(Ge&&Fe.push(Ge),At.fileInfo.mask&&At.fileInfo.mask.numBytes>0&&Dt++),mt++,et.pixels.push(At.pixelData),et.statistics.push({minValue:At.minValue,maxValue:At.maxValue,noDataValue:At.noDataValue,dimStats:At.dimStats})}if(ie>1&&Dt>1){for(tt=et.width*et.height,et.bandMasks=Fe,(Ge=new Uint8Array(tt)).set(Fe[0]),He=1;He<Fe.length;He++)for(Qe=Fe[He],Ke=0;Ke<tt;Ke++)Ge[Ke]=Ge[Ke]&Qe[Ke];et.maskData=Ge}return et}};m.exports?m.exports=ke:this.Lerc=ke})()})(a);var o=br(a.exports);let h,I,w;const C={env:{emscripten_notify_memory_growth:function(m){w=new Uint8Array(I.exports.memory.buffer)}}},M="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",F=new class{init(){return h||(h=typeof fetch<"u"?fetch("data:application/wasm;base64,"+M).then(m=>m.arrayBuffer()).then(m=>WebAssembly.instantiate(m,C)).then(this._init):WebAssembly.instantiate(Buffer.from(M,"base64"),C).then(this._init),h)}_init(m){I=m.instance,C.env.emscripten_notify_memory_growth(0)}decode(m,g=0){if(!I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const A=m.byteLength,v=I.exports.malloc(A);w.set(m,v),g=g||Number(I.exports.ZSTD_findDecompressedSize(v,A));const x=I.exports.malloc(g),k=I.exports.ZSTD_decompress(x,g,v,A),P=w.slice(x,x+k);return I.exports.free(v),I.exports.free(x),P}};var z=Object.freeze({__proto__:null,default:class extends Rn{constructor(m){super(),this.planarConfiguration=m.PlanarConfiguration!==void 0?m.PlanarConfiguration:1,this.samplesPerPixel=m.SamplesPerPixel!==void 0?m.SamplesPerPixel:1,this.addCompression=m.LercParameters[H]}decodeBlock(m){switch(this.addCompression){case ee:break;case ge:m=u(new Uint8Array(m)).buffer;break;case Ce:m=F.decode(new Uint8Array(m)).buffer;break;default:throw new Error(`Unsupported LERC additional compression method identifier: ${this.addCompression}`)}return o.decode(m,{returnPixelInterleavedDims:this.planarConfiguration===1}).pixels[0].buffer}},zstd:F}),$=Object.freeze({__proto__:null,default:class extends Rn{constructor(){if(super(),typeof createImageBitmap>"u")throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if(typeof document>"u"&&typeof OffscreenCanvas>"u")throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available")}async decode(m,g){const A=new Blob([g]),v=await createImageBitmap(A);let x;typeof document<"u"?(x=document.createElement("canvas"),x.width=v.width,x.height=v.height):x=new OffscreenCanvas(v.width,v.height);const k=x.getContext("2d");return k.drawImage(v,0,0),k.getImageData(0,0,v.width,v.height).data.buffer}}}),te=Worker,le=Object.freeze({__proto__:null,create:function(){const m='function A(A,e,t,i,r,I,g){try{var n=A[I](g),a=n.value}catch(A){return void t(A)}n.done?e(a):Promise.resolve(a).then(i,r)}function e(e){return function(){var t=this,i=arguments;return new Promise((function(r,I){var g=e.apply(t,i);function n(e){A(g,r,I,n,a,"next",e)}function a(e){A(g,r,I,n,a,"throw",e)}n(void 0)}))}}function t(A){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"==typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},t(A)}var i={exports:{}};!function(A){var e=function(A){var e,i=Object.prototype,r=i.hasOwnProperty,I="function"==typeof Symbol?Symbol:{},g=I.iterator||"@@iterator",n=I.asyncIterator||"@@asyncIterator",a=I.toStringTag||"@@toStringTag";function o(A,e,t){return Object.defineProperty(A,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),A[e]}try{o({},"")}catch(A){o=function(A,e,t){return A[e]=t}}function B(A,e,t,i){var r=e&&e.prototype instanceof h?e:h,I=Object.create(r.prototype),g=new S(i||[]);return I._invoke=function(A,e,t){var i=Q;return function(r,I){if(i===s)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw I;return R()}for(t.method=r,t.arg=I;;){var g=t.delegate;if(g){var n=m(g,t);if(n){if(n===c)continue;return n}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if(i===Q)throw i=f,t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);i=s;var a=C(A,e,t);if("normal"===a.type){if(i=t.done?f:E,a.arg===c)continue;return{value:a.arg,done:t.done}}"throw"===a.type&&(i=f,t.method="throw",t.arg=a.arg)}}}(A,t,g),I}function C(A,e,t){try{return{type:"normal",arg:A.call(e,t)}}catch(A){return{type:"throw",arg:A}}}A.wrap=B;var Q="suspendedStart",E="suspendedYield",s="executing",f="completed",c={};function h(){}function l(){}function u(){}var w={};o(w,g,(function(){return this}));var d=Object.getPrototypeOf,D=d&&d(d(v([])));D&&D!==i&&r.call(D,g)&&(w=D);var y=u.prototype=h.prototype=Object.create(w);function k(A){["next","throw","return"].forEach((function(e){o(A,e,(function(A){return this._invoke(e,A)}))}))}function p(A,e){function i(I,g,n,a){var o=C(A[I],A,g);if("throw"!==o.type){var B=o.arg,Q=B.value;return Q&&"object"===t(Q)&&r.call(Q,"__await")?e.resolve(Q.__await).then((function(A){i("next",A,n,a)}),(function(A){i("throw",A,n,a)})):e.resolve(Q).then((function(A){B.value=A,n(B)}),(function(A){return i("throw",A,n,a)}))}a(o.arg)}var I;this._invoke=function(A,t){function r(){return new e((function(e,r){i(A,t,e,r)}))}return I=I?I.then(r,r):r()}}function m(A,t){var i=A.iterator[t.method];if(i===e){if(t.delegate=null,"throw"===t.method){if(A.iterator.return&&(t.method="return",t.arg=e,m(A,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a \'throw\' method")}return c}var r=C(i,A.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var I=r.arg;return I?I.done?(t[A.resultName]=I.value,t.next=A.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,c):I:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function G(A){var e={tryLoc:A[0]};1 in A&&(e.catchLoc=A[1]),2 in A&&(e.finallyLoc=A[2],e.afterLoc=A[3]),this.tryEntries.push(e)}function F(A){var e=A.completion||{};e.type="normal",delete e.arg,A.completion=e}function S(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(G,this),this.reset(!0)}function v(A){if(A){var t=A[g];if(t)return t.call(A);if("function"==typeof A.next)return A;if(!isNaN(A.length)){var i=-1,I=function t(){for(;++i<A.length;)if(r.call(A,i))return t.value=A[i],t.done=!1,t;return t.value=e,t.done=!0,t};return I.next=I}}return{next:R}}function R(){return{value:e,done:!0}}return l.prototype=u,o(y,"constructor",u),o(u,"constructor",l),l.displayName=o(u,a,"GeneratorFunction"),A.isGeneratorFunction=function(A){var e="function"==typeof A&&A.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},A.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,u):(A.__proto__=u,o(A,a,"GeneratorFunction")),A.prototype=Object.create(y),A},A.awrap=function(A){return{__await:A}},k(p.prototype),o(p.prototype,n,(function(){return this})),A.AsyncIterator=p,A.async=function(e,t,i,r,I){void 0===I&&(I=Promise);var g=new p(B(e,t,i,r),I);return A.isGeneratorFunction(t)?g:g.next().then((function(A){return A.done?A.value:g.next()}))},k(y),o(y,a,"Generator"),o(y,g,(function(){return this})),o(y,"toString",(function(){return"[object Generator]"})),A.keys=function(A){var e=[];for(var t in A)e.push(t);return e.reverse(),function t(){for(;e.length;){var i=e.pop();if(i in A)return t.value=i,t.done=!1,t}return t.done=!0,t}},A.values=v,S.prototype={constructor:S,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(F),!A)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if("throw"===A.type)throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var t=this;function i(i,r){return n.type="throw",n.arg=A,t.next=i,r&&(t.method="next",t.arg=e),!!r}for(var I=this.tryEntries.length-1;I>=0;--I){var g=this.tryEntries[I],n=g.completion;if("root"===g.tryLoc)return i("end");if(g.tryLoc<=this.prev){var a=r.call(g,"catchLoc"),o=r.call(g,"finallyLoc");if(a&&o){if(this.prev<g.catchLoc)return i(g.catchLoc,!0);if(this.prev<g.finallyLoc)return i(g.finallyLoc)}else if(a){if(this.prev<g.catchLoc)return i(g.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return i(g.finallyLoc)}}}},abrupt:function(A,e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var I=i;break}}I&&("break"===A||"continue"===A)&&I.tryLoc<=e&&e<=I.finallyLoc&&(I=null);var g=I?I.completion:{};return g.type=A,g.arg=e,I?(this.method="next",this.next=I.finallyLoc,c):this.complete(g)},complete:function(A,e){if("throw"===A.type)throw A.arg;return"break"===A.type||"continue"===A.type?this.next=A.arg:"return"===A.type?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):"normal"===A.type&&e&&(this.next=e),c},finish:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===A)return this.complete(t.completion,t.afterLoc),F(t),c}},catch:function(A){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===A){var i=t.completion;if("throw"===i.type){var r=i.arg;F(t)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(A,t,i){return this.delegate={iterator:v(A),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=e),c}},A}(A.exports);try{regeneratorRuntime=e}catch(A){"object"===("undefined"==typeof globalThis?"undefined":t(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(i);var r=i.exports,I=new Map;function g(A,e){Array.isArray(A)||(A=[A]),A.forEach((function(A){return I.set(A,e)}))}function n(A){return a.apply(this,arguments)}function a(){return(a=e(r.mark((function A(e){var t,i;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:if(t=I.get(e.Compression)){A.next=3;break}throw new Error("Unknown compression method identifier: ".concat(e.Compression));case 3:return A.next=5,t();case 5:return i=A.sent,A.abrupt("return",new i(e));case 7:case"end":return A.stop()}}),A)})))).apply(this,arguments)}g([void 0,1],(function(){return Promise.resolve().then((function(){return y})).then((function(A){return A.default}))})),g(5,(function(){return Promise.resolve().then((function(){return F})).then((function(A){return A.default}))})),g(6,(function(){throw new Error("old style JPEG compression is not supported.")})),g(7,(function(){return Promise.resolve().then((function(){return N})).then((function(A){return A.default}))})),g([8,32946],(function(){return Promise.resolve().then((function(){return OA})).then((function(A){return A.default}))})),g(32773,(function(){return Promise.resolve().then((function(){return _A})).then((function(A){return A.default}))})),g(34887,(function(){return Promise.resolve().then((function(){return le})).then(function(){var A=e(r.mark((function A(e){return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,e.zstd.init();case 2:return A.abrupt("return",e);case 3:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}()).then((function(A){return A.default}))})),g(50001,(function(){return Promise.resolve().then((function(){return de})).then((function(A){return A.default}))}));var o=globalThis;function B(A,e){if(!(A instanceof e))throw new TypeError("Cannot call a class as a function")}function C(A,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(A,i.key,i)}}function Q(A,e,t){return e&&C(A.prototype,e),t&&C(A,t),A}function E(A,e){return E=Object.setPrototypeOf||function(A,e){return A.__proto__=e,A},E(A,e)}function s(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(e&&e.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),e&&E(A,e)}function f(A,e){if(e&&("object"===t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(A){if(void 0===A)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return A}(A)}function c(A){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},c(A)}function h(A,e){var t=A.length-e,i=0;do{for(var r=e;r>0;r--)A[i+e]+=A[i],i++;t-=e}while(t>0)}function l(A,e,t){for(var i=0,r=A.length,I=r/t;r>e;){for(var g=e;g>0;--g)A[i+e]+=A[i],++i;r-=e}for(var n=A.slice(),a=0;a<I;++a)for(var o=0;o<t;++o)A[t*a+o]=n[(t-o-1)*I+a]}function u(A,e,t,i,r,I){if(!e||1===e)return A;for(var g=0;g<r.length;++g){if(r[g]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(r[g]!==r[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var n=r[0]/8,a=2===I?1:r.length,o=0;o<i&&!(o*a*t*n>=A.byteLength);++o){var B=void 0;if(2===e){switch(r[0]){case 8:B=new Uint8Array(A,o*a*t*n,a*t*n);break;case 16:B=new Uint16Array(A,o*a*t*n,a*t*n/2);break;case 32:B=new Uint32Array(A,o*a*t*n,a*t*n/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(r[0]," bits per sample."))}h(B,a)}else 3===e&&l(B=new Uint8Array(A,o*a*t*n,a*t*n),a,n)}return A}o.addEventListener("message",function(){var A=e(r.mark((function A(e){var t,i,I,g,a,B;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return t=e.data,i=t.id,I=t.fileDirectory,g=t.buffer,A.next=3,n(I);case 3:return a=A.sent,A.next=6,a.decode(I,g);case 6:B=A.sent,o.postMessage({decoded:B,id:i},[B]);case 8:case"end":return A.stop()}}),A)})));return function(e){return A.apply(this,arguments)}}());var w=function(){function A(){B(this,A)}var t;return Q(A,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n,a;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,this.decodeBlock(t);case 2:if(i=A.sent,1===(I=e.Predictor||1)){A.next=9;break}return g=!e.StripOffsets,n=g?e.TileWidth:e.ImageWidth,a=g?e.TileLength:e.RowsPerStrip||e.ImageLength,A.abrupt("return",u(i,I,n,a,e.BitsPerSample,e.PlanarConfiguration));case 9:return A.abrupt("return",i);case 10:case"end":return A.stop()}}),A,this)}))),function(A,e){return t.apply(this,arguments)})}]),A}();function d(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var D=function(A){s(t,w);var e=d(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return A}}]),t}(),y=Object.freeze({__proto__:null,default:D});function k(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}function p(A,e){for(var t=e.length-1;t>=0;t--)A.push(e[t]);return A}function m(A){for(var e=new Uint16Array(4093),t=new Uint8Array(4093),i=0;i<=257;i++)e[i]=4096,t[i]=i;var r=258,I=9,g=0;function n(){r=258,I=9}function a(A){var e=function(A,e,t){var i=e%8,r=Math.floor(e/8),I=8-i,g=e+t-8*(r+1),n=8*(r+2)-(e+t),a=8*(r+2)-e;if(n=Math.max(0,n),r>=A.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var o=A[r]&Math.pow(2,8-i)-1,B=o<<=t-I;if(r+1<A.length){var C=A[r+1]>>>n;B+=C<<=Math.max(0,t-a)}if(g>8&&r+2<A.length){var Q=8*(r+3)-(e+t);B+=A[r+2]>>>Q}return B}(A,g,I);return g+=I,e}function o(A,i){return t[r]=i,e[r]=A,++r-1}function B(A){for(var i=[],r=A;4096!==r;r=e[r])i.push(t[r]);return i}var C=[];n();for(var Q,E=new Uint8Array(A),s=a(E);257!==s;){if(256===s){for(n(),s=a(E);256===s;)s=a(E);if(257===s)break;if(s>256)throw new Error("corrupted code at scanline ".concat(s));p(C,B(s)),Q=s}else if(s<r){var f=B(s);p(C,f),o(Q,f[f.length-1]),Q=s}else{var c=B(Q);if(!c)throw new Error("Bogus entry. Not in dictionary, ".concat(Q," / ").concat(r,", position: ").concat(g));p(C,c),C.push(c[c.length-1]),o(Q,c[c.length-1]),Q=s}r+1>=Math.pow(2,I)&&(12===I?Q=void 0:I++),s=a(E)}return new Uint8Array(C)}var G=function(A){s(t,w);var e=k(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return m(A).buffer}}]),t}(),F=Object.freeze({__proto__:null,default:G});function S(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var v=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function R(A,e){for(var t=0,i=[],r=16;r>0&&!A[r-1];)--r;i.push({children:[],index:0});for(var I,g=i[0],n=0;n<r;n++){for(var a=0;a<A[n];a++){for((g=i.pop()).children[g.index]=e[t];g.index>0;)g=i.pop();for(g.index++,i.push(g);i.length<=n;)i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I;t++}n+1<r&&(i.push(I={children:[],index:0}),g.children[g.index]=I.children,g=I)}return i[0].children}function U(A,e,i,r,I,g,n,a,o){var B=i.mcusPerLine,C=i.progressive,Q=e,E=e,s=0,f=0;function c(){if(f>0)return f--,s>>f&1;if(255===(s=A[E++])){var e=A[E++];if(e)throw new Error("unexpected marker: ".concat((s<<8|e).toString(16)))}return f=7,s>>>7}function h(A){for(var e,i=A;null!==(e=c());){if("number"==typeof(i=i[e]))return i;if("object"!==t(i))throw new Error("invalid huffman sequence")}return null}function l(A){for(var e=A,t=0;e>0;){var i=c();if(null===i)return;t=t<<1|i,--e}return t}function u(A){var e=l(A);return e>=1<<A-1?e:e+(-1<<A)+1}var w=0;var d,D=0;function y(A,e,t,i,r){var I=t%B,g=(t/B|0)*A.v+i,n=I*A.h+r;e(A,A.blocks[g][n])}function k(A,e,t){var i=t/A.blocksPerLine|0,r=t%A.blocksPerLine;e(A,A.blocks[i][r])}var p,m,G,F,S,R,U=r.length;R=C?0===g?0===a?function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t)<<o;A.pred+=i,e[0]=A.pred}:function(A,e){e[0]|=c()<<o}:0===a?function(A,e){if(w>0)w--;else for(var t=g,i=n;t<=i;){var r=h(A.huffmanTableAC),I=15&r,a=r>>4;if(0===I){if(a<15){w=l(a)+(1<<a)-1;break}t+=16}else e[v[t+=a]]=u(I)*(1<<o),t++}}:function(A,e){for(var t=g,i=n,r=0;t<=i;){var I=v[t],a=e[I]<0?-1:1;switch(D){case 0:var B=h(A.huffmanTableAC),C=15&B;if(r=B>>4,0===C)r<15?(w=l(r)+(1<<r),D=4):(r=16,D=1);else{if(1!==C)throw new Error("invalid ACn encoding");d=u(C),D=r?2:3}continue;case 1:case 2:e[I]?e[I]+=(c()<<o)*a:0==--r&&(D=2===D?3:0);break;case 3:e[I]?e[I]+=(c()<<o)*a:(e[I]=d<<o,D=0);break;case 4:e[I]&&(e[I]+=(c()<<o)*a)}t++}4===D&&0==--w&&(D=0)}:function(A,e){var t=h(A.huffmanTableDC),i=0===t?0:u(t);A.pred+=i,e[0]=A.pred;for(var r=1;r<64;){var I=h(A.huffmanTableAC),g=15&I,n=I>>4;if(0===g){if(n<15)break;r+=16}else e[v[r+=n]]=u(g),r++}};var L,b,M=0;b=1===U?r[0].blocksPerLine*r[0].blocksPerColumn:B*i.mcusPerColumn;for(var N=I||b;M<b;){for(m=0;m<U;m++)r[m].pred=0;if(w=0,1===U)for(p=r[0],S=0;S<N;S++)k(p,R,M),M++;else for(S=0;S<N;S++){for(m=0;m<U;m++){var x=p=r[m],J=x.h,q=x.v;for(G=0;G<q;G++)for(F=0;F<J;F++)y(p,R,M,G,F)}if(++M===b)break}if(f=0,(L=A[E]<<8|A[E+1])<65280)throw new Error("marker was not found");if(!(L>=65488&&L<=65495))break;E+=2}return E-Q}function L(A,e){var t=[],i=e.blocksPerLine,r=e.blocksPerColumn,I=i<<3,g=new Int32Array(64),n=new Uint8Array(64);function a(A,t,i){var r,I,g,n,a,o,B,C,Q,E,s=e.quantizationTable,f=i;for(E=0;E<64;E++)f[E]=A[E]*s[E];for(E=0;E<8;++E){var c=8*E;0!==f[1+c]||0!==f[2+c]||0!==f[3+c]||0!==f[4+c]||0!==f[5+c]||0!==f[6+c]||0!==f[7+c]?(r=5793*f[0+c]+128>>8,I=5793*f[4+c]+128>>8,g=f[2+c],n=f[6+c],a=2896*(f[1+c]-f[7+c])+128>>8,C=2896*(f[1+c]+f[7+c])+128>>8,o=f[3+c]<<4,Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+128>>8,g=1567*g-3784*n+128>>8,n=Q,Q=a-(B=f[5+c]<<4)+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+c]=r+C,f[7+c]=r-C,f[1+c]=I+B,f[6+c]=I-B,f[2+c]=g+o,f[5+c]=g-o,f[3+c]=n+a,f[4+c]=n-a):(Q=5793*f[0+c]+512>>10,f[0+c]=Q,f[1+c]=Q,f[2+c]=Q,f[3+c]=Q,f[4+c]=Q,f[5+c]=Q,f[6+c]=Q,f[7+c]=Q)}for(E=0;E<8;++E){var h=E;0!==f[8+h]||0!==f[16+h]||0!==f[24+h]||0!==f[32+h]||0!==f[40+h]||0!==f[48+h]||0!==f[56+h]?(r=5793*f[0+h]+2048>>12,I=5793*f[32+h]+2048>>12,g=f[16+h],n=f[48+h],a=2896*(f[8+h]-f[56+h])+2048>>12,C=2896*(f[8+h]+f[56+h])+2048>>12,o=f[24+h],Q=r-I+1>>1,r=r+I+1>>1,I=Q,Q=3784*g+1567*n+2048>>12,g=1567*g-3784*n+2048>>12,n=Q,Q=a-(B=f[40+h])+1>>1,a=a+B+1>>1,B=Q,Q=C+o+1>>1,o=C-o+1>>1,C=Q,Q=r-n+1>>1,r=r+n+1>>1,n=Q,Q=I-g+1>>1,I=I+g+1>>1,g=Q,Q=2276*a+3406*C+2048>>12,a=3406*a-2276*C+2048>>12,C=Q,Q=799*o+4017*B+2048>>12,o=4017*o-799*B+2048>>12,B=Q,f[0+h]=r+C,f[56+h]=r-C,f[8+h]=I+B,f[48+h]=I-B,f[16+h]=g+o,f[40+h]=g-o,f[24+h]=n+a,f[32+h]=n-a):(Q=5793*i[E+0]+8192>>14,f[0+h]=Q,f[8+h]=Q,f[16+h]=Q,f[24+h]=Q,f[32+h]=Q,f[40+h]=Q,f[48+h]=Q,f[56+h]=Q)}for(E=0;E<64;++E){var l=128+(f[E]+8>>4);t[E]=l<0?0:l>255?255:l}}for(var o=0;o<r;o++){for(var B=o<<3,C=0;C<8;C++)t.push(new Uint8Array(I));for(var Q=0;Q<i;Q++){a(e.blocks[o][Q],n,g);for(var E=0,s=Q<<3,f=0;f<8;f++)for(var c=t[B+f],h=0;h<8;h++)c[s+h]=n[E++]}}return t}var b=function(){function A(){B(this,A),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return Q(A,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(A){var e=0;function t(){var t=A[e]<<8|A[e+1];return e+=2,t}function i(A){var e,t,i=0,r=0;for(t in A.components)A.components.hasOwnProperty(t)&&(i<(e=A.components[t]).h&&(i=e.h),r<e.v&&(r=e.v));var I=Math.ceil(A.samplesPerLine/8/i),g=Math.ceil(A.scanLines/8/r);for(t in A.components)if(A.components.hasOwnProperty(t)){e=A.components[t];for(var n=Math.ceil(Math.ceil(A.samplesPerLine/8)*e.h/i),a=Math.ceil(Math.ceil(A.scanLines/8)*e.v/r),o=I*e.h,B=g*e.v,C=[],Q=0;Q<B;Q++){for(var E=[],s=0;s<o;s++)E.push(new Int32Array(64));C.push(E)}e.blocksPerLine=n,e.blocksPerColumn=a,e.blocks=C}A.maxH=i,A.maxV=r,A.mcusPerLine=I,A.mcusPerColumn=g}var r,I,g=t();if(65496!==g)throw new Error("SOI not found");for(g=t();65497!==g;){switch(g){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var n=(r=void 0,I=void 0,r=t(),I=A.subarray(e,e+r-2),e+=I.length,I);65504===g&&74===n[0]&&70===n[1]&&73===n[2]&&70===n[3]&&0===n[4]&&(this.jfif={version:{major:n[5],minor:n[6]},densityUnits:n[7],xDensity:n[8]<<8|n[9],yDensity:n[10]<<8|n[11],thumbWidth:n[12],thumbHeight:n[13],thumbData:n.subarray(14,14+3*n[12]*n[13])}),65518===g&&65===n[0]&&100===n[1]&&111===n[2]&&98===n[3]&&101===n[4]&&0===n[5]&&(this.adobe={version:n[6],flags0:n[7]<<8|n[8],flags1:n[9]<<8|n[10],transformCode:n[11]});break;case 65499:for(var a=t()+e-2;e<a;){var o=A[e++],B=new Int32Array(64);if(o>>4==0)for(var C=0;C<64;C++){B[v[C]]=A[e++]}else{if(o>>4!=1)throw new Error("DQT: invalid table spec");for(var Q=0;Q<64;Q++){B[v[Q]]=t()}}this.quantizationTables[15&o]=B}break;case 65472:case 65473:case 65474:t();for(var E={extended:65473===g,progressive:65474===g,precision:A[e++],scanLines:t(),samplesPerLine:t(),components:{},componentsOrder:[]},s=A[e++],f=void 0,c=0;c<s;c++){f=A[e];var h=A[e+1]>>4,l=15&A[e+1],u=A[e+2];E.componentsOrder.push(f),E.components[f]={h:h,v:l,quantizationIdx:u},e+=3}i(E),this.frames.push(E);break;case 65476:for(var w=t(),d=2;d<w;){for(var D=A[e++],y=new Uint8Array(16),k=0,p=0;p<16;p++,e++)y[p]=A[e],k+=y[p];for(var m=new Uint8Array(k),G=0;G<k;G++,e++)m[G]=A[e];d+=17+k,D>>4==0?this.huffmanTablesDC[15&D]=R(y,m):this.huffmanTablesAC[15&D]=R(y,m)}break;case 65501:t(),this.resetInterval=t();break;case 65498:t();for(var F=A[e++],S=[],L=this.frames[0],b=0;b<F;b++){var M=L.components[A[e++]],N=A[e++];M.huffmanTableDC=this.huffmanTablesDC[N>>4],M.huffmanTableAC=this.huffmanTablesAC[15&N],S.push(M)}var x=A[e++],J=A[e++],q=A[e++],Y=U(A,e,L,S,this.resetInterval,x,J,q>>4,15&q);e+=Y;break;case 65535:255!==A[e]&&e--;break;default:if(255===A[e-3]&&A[e-2]>=192&&A[e-2]<=254){e-=3;break}throw new Error("unknown JPEG marker ".concat(g.toString(16)))}g=t()}}},{key:"getResult",value:function(){var A=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var e=0;e<this.frames.length;e++)for(var t=this.frames[e].components,i=0,r=Object.keys(t);i<r.length;i++){var I=r[i];t[I].quantizationTable=this.quantizationTables[t[I].quantizationIdx],delete t[I].quantizationIdx}for(var g=A[0],n=g.components,a=g.componentsOrder,o=[],B=g.samplesPerLine,C=g.scanLines,Q=0;Q<a.length;Q++){var E=n[a[Q]];o.push({lines:L(0,E),scaleX:E.h/g.maxH,scaleY:E.v/g.maxV})}for(var s=new Uint8Array(B*C*o.length),f=0,c=0;c<C;++c)for(var h=0;h<B;++h)for(var l=0;l<o.length;++l){var u=o[l];s[f]=u.lines[0|c*u.scaleY][0|h*u.scaleX],++f}return s}}]),A}(),M=function(A){s(t,w);var e=S(t);function t(A){var i;return B(this,t),(i=e.call(this)).reader=new b,A.JPEGTables&&i.reader.parse(A.JPEGTables),i}return Q(t,[{key:"decodeBlock",value:function(A){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(A)),this.reader.getResult().buffer}}]),t}(),N=Object.freeze({__proto__:null,default:M});function x(A){for(var e=A.length;--e>=0;)A[e]=0}x(new Array(576)),x(new Array(60)),x(new Array(512)),x(new Array(256)),x(new Array(29)),x(new Array(30));var J=function(A,e,t,i){for(var r=65535&A|0,I=A>>>16&65535|0,g=0;0!==t;){t-=g=t>2e3?2e3:t;do{I=I+(r=r+e[i++]|0)|0}while(--g);r%=65521,I%=65521}return r|I<<16|0},q=new Uint32Array(function(){for(var A,e=[],t=0;t<256;t++){A=t;for(var i=0;i<8;i++)A=1&A?3988292384^A>>>1:A>>>1;e[t]=A}return e}()),Y=function(A,e,t,i){var r=q,I=i+t;A^=-1;for(var g=i;g<I;g++)A=A>>>8^r[255&(A^e[g])];return-1^A},K={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},O=function(A,e){return Object.prototype.hasOwnProperty.call(A,e)},P=function(A){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!==t(i))throw new TypeError(i+"must be non-object");for(var r in i)O(i,r)&&(A[r]=i[r])}}return A},T=function(A){for(var e=0,t=0,i=A.length;t<i;t++)e+=A[t].length;for(var r=new Uint8Array(e),I=0,g=0,n=A.length;I<n;I++){var a=A[I];r.set(a,g),g+=a.length}return r},V=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){V=!1}for(var _=new Uint8Array(256),X=0;X<256;X++)_[X]=X>=252?6:X>=248?5:X>=240?4:X>=224?3:X>=192?2:1;_[254]=_[254]=1;var Z=function(A){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(A);var e,t,i,r,I,g=A.length,n=0;for(r=0;r<g;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),n+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(n),I=0,r=0;I<n;r++)55296==(64512&(t=A.charCodeAt(r)))&&r+1<g&&56320==(64512&(i=A.charCodeAt(r+1)))&&(t=65536+(t-55296<<10)+(i-56320),r++),t<128?e[I++]=t:t<2048?(e[I++]=192|t>>>6,e[I++]=128|63&t):t<65536?(e[I++]=224|t>>>12,e[I++]=128|t>>>6&63,e[I++]=128|63&t):(e[I++]=240|t>>>18,e[I++]=128|t>>>12&63,e[I++]=128|t>>>6&63,e[I++]=128|63&t);return e},j=function(A,e){var t,i,r=e||A.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(A.subarray(0,e));var I=new Array(2*r);for(i=0,t=0;t<r;){var g=A[t++];if(g<128)I[i++]=g;else{var n=_[g];if(n>4)I[i++]=65533,t+=n-1;else{for(g&=2===n?31:3===n?15:7;n>1&&t<r;)g=g<<6|63&A[t++],n--;n>1?I[i++]=65533:g<65536?I[i++]=g:(g-=65536,I[i++]=55296|g>>10&1023,I[i++]=56320|1023&g)}}}return function(A,e){if(e<65534&&A.subarray&&V)return String.fromCharCode.apply(null,A.length===e?A:A.subarray(0,e));for(var t="",i=0;i<e;i++)t+=String.fromCharCode(A[i]);return t}(I,i)},W=function(A,e){(e=e||A.length)>A.length&&(e=A.length);for(var t=e-1;t>=0&&128==(192&A[t]);)t--;return t<0||0===t?e:t+_[A[t]]>e?t:e};var z=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},$=function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=A.state;t=A.next_in,k=A.input,i=t+(A.avail_in-5),r=A.next_out,p=A.output,I=r-(e-A.avail_out),g=r+(A.avail_out-257),n=m.dmax,a=m.wsize,o=m.whave,B=m.wnext,C=m.window,Q=m.hold,E=m.bits,s=m.lencode,f=m.distcode,c=(1<<m.lenbits)-1,h=(1<<m.distbits)-1;A:do{E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=s[Q&c];e:for(;;){if(Q>>>=u=l>>>24,E-=u,0===(u=l>>>16&255))p[r++]=65535&l;else{if(!(16&u)){if(0==(64&u)){l=s[(65535&l)+(Q&(1<<u)-1)];continue e}if(32&u){m.mode=12;break A}A.msg="invalid literal/length code",m.mode=30;break A}w=65535&l,(u&=15)&&(E<u&&(Q+=k[t++]<<E,E+=8),w+=Q&(1<<u)-1,Q>>>=u,E-=u),E<15&&(Q+=k[t++]<<E,E+=8,Q+=k[t++]<<E,E+=8),l=f[Q&h];t:for(;;){if(Q>>>=u=l>>>24,E-=u,!(16&(u=l>>>16&255))){if(0==(64&u)){l=f[(65535&l)+(Q&(1<<u)-1)];continue t}A.msg="invalid distance code",m.mode=30;break A}if(d=65535&l,E<(u&=15)&&(Q+=k[t++]<<E,(E+=8)<u&&(Q+=k[t++]<<E,E+=8)),(d+=Q&(1<<u)-1)>n){A.msg="invalid distance too far back",m.mode=30;break A}if(Q>>>=u,E-=u,d>(u=r-I)){if((u=d-u)>o&&m.sane){A.msg="invalid distance too far back",m.mode=30;break A}if(D=0,y=C,0===B){if(D+=a-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}else if(B<u){if(D+=a+B-u,(u-=B)<w){w-=u;do{p[r++]=C[D++]}while(--u);if(D=0,B<w){w-=u=B;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}}}else if(D+=B-u,u<w){w-=u;do{p[r++]=C[D++]}while(--u);D=r-d,y=p}for(;w>2;)p[r++]=y[D++],p[r++]=y[D++],p[r++]=y[D++],w-=3;w&&(p[r++]=y[D++],w>1&&(p[r++]=y[D++]))}else{D=r-d;do{p[r++]=p[D++],p[r++]=p[D++],p[r++]=p[D++],w-=3}while(w>2);w&&(p[r++]=p[D++],w>1&&(p[r++]=p[D++]))}break}}break}}while(t<i&&r<g);t-=w=E>>3,Q&=(1<<(E-=w<<3))-1,A.next_in=t,A.next_out=r,A.avail_in=t<i?i-t+5:5-(t-i),A.avail_out=r<g?g-r+257:257-(r-g),m.hold=Q,m.bits=E},AA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),eA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),tA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),iA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),rA=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E,s,f,c,h=n.bits,l=0,u=0,w=0,d=0,D=0,y=0,k=0,p=0,m=0,G=0,F=null,S=0,v=new Uint16Array(16),R=new Uint16Array(16),U=null,L=0;for(l=0;l<=15;l++)v[l]=0;for(u=0;u<i;u++)v[e[t+u]]++;for(D=h,d=15;d>=1&&0===v[d];d--);if(D>d&&(D=d),0===d)return r[I++]=20971520,r[I++]=20971520,n.bits=1,0;for(w=1;w<d&&0===v[w];w++);for(D<w&&(D=w),p=1,l=1;l<=15;l++)if(p<<=1,(p-=v[l])<0)return-1;if(p>0&&(0===A||1!==d))return-1;for(R[1]=0,l=1;l<15;l++)R[l+1]=R[l]+v[l];for(u=0;u<i;u++)0!==e[t+u]&&(g[R[e[t+u]]++]=u);if(0===A?(F=U=g,E=19):1===A?(F=AA,S-=257,U=eA,L-=257,E=256):(F=tA,U=iA,E=-1),G=0,u=0,l=w,Q=I,y=D,k=0,B=-1,C=(m=1<<D)-1,1===A&&m>852||2===A&&m>592)return 1;for(;;){s=l-k,g[u]<E?(f=0,c=g[u]):g[u]>E?(f=U[L+g[u]],c=F[S+g[u]]):(f=96,c=0),a=1<<l-k,w=o=1<<y;do{r[Q+(G>>k)+(o-=a)]=s<<24|f<<16|c|0}while(0!==o);for(a=1<<l-1;G&a;)a>>=1;if(0!==a?(G&=a-1,G+=a):G=0,u++,0==--v[l]){if(l===d)break;l=e[t+g[u]]}if(l>D&&(G&C)!==B){for(0===k&&(k=D),Q+=w,p=1<<(y=l-k);y+k<d&&!((p-=v[y+k])<=0);)y++,p<<=1;if(m+=1<<y,1===A&&m>852||2===A&&m>592)return 1;r[B=G&C]=D<<24|y<<16|Q-I|0}}return 0!==G&&(r[Q+G]=l-k<<24|64<<16|0),n.bits=D,0},IA=H.Z_FINISH,gA=H.Z_BLOCK,nA=H.Z_TREES,aA=H.Z_OK,oA=H.Z_STREAM_END,BA=H.Z_NEED_DICT,CA=H.Z_STREAM_ERROR,QA=H.Z_DATA_ERROR,EA=H.Z_MEM_ERROR,sA=H.Z_BUF_ERROR,fA=H.Z_DEFLATED,cA=function(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)};function hA(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var lA,uA,wA=function(A){if(!A||!A.state)return CA;var e=A.state;return A.total_in=A.total_out=e.total=0,A.msg="",e.wrap&&(A.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,aA},dA=function(A){if(!A||!A.state)return CA;var e=A.state;return e.wsize=0,e.whave=0,e.wnext=0,wA(A)},DA=function(A,e){var t;if(!A||!A.state)return CA;var i=A.state;return e<0?(t=0,e=-e):(t=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?CA:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=t,i.wbits=e,dA(A))},yA=function(A,e){if(!A)return CA;var t=new hA;A.state=t,t.window=null;var i=DA(A,e);return i!==aA&&(A.state=null),i},kA=!0,pA=function(A){if(kA){lA=new Int32Array(512),uA=new Int32Array(32);for(var e=0;e<144;)A.lens[e++]=8;for(;e<256;)A.lens[e++]=9;for(;e<280;)A.lens[e++]=7;for(;e<288;)A.lens[e++]=8;for(rA(1,A.lens,0,288,lA,0,A.work,{bits:9}),e=0;e<32;)A.lens[e++]=5;rA(2,A.lens,0,32,uA,0,A.work,{bits:5}),kA=!1}A.lencode=lA,A.lenbits=9,A.distcode=uA,A.distbits=5},mA=function(A,e,t,i){var r,I=A.state;return null===I.window&&(I.wsize=1<<I.wbits,I.wnext=0,I.whave=0,I.window=new Uint8Array(I.wsize)),i>=I.wsize?(I.window.set(e.subarray(t-I.wsize,t),0),I.wnext=0,I.whave=I.wsize):((r=I.wsize-I.wnext)>i&&(r=i),I.window.set(e.subarray(t-i,t-i+r),I.wnext),(i-=r)?(I.window.set(e.subarray(t-i,t),0),I.wnext=i,I.whave=I.wsize):(I.wnext+=r,I.wnext===I.wsize&&(I.wnext=0),I.whave<I.wsize&&(I.whave+=r))),0},GA={inflateReset:dA,inflateReset2:DA,inflateResetKeep:wA,inflateInit:function(A){return yA(A,15)},inflateInit2:yA,inflate:function(A,e){var t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c,h,l,u,w,d,D,y,k,p,m=0,G=new Uint8Array(4),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!A||!A.state||!A.output||!A.input&&0!==A.avail_in)return CA;12===(t=A.state).mode&&(t.mode=13),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,C=n,Q=a,y=aA;A:for(;;)switch(t.mode){case 1:if(0===t.wrap){t.mode=13;break}for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(2&t.wrap&&35615===o){t.check=0,G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0),o=0,B=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&o)<<8)+(o>>8))%31){A.msg="incorrect header check",t.mode=30;break}if((15&o)!==fA){A.msg="unknown compression method",t.mode=30;break}if(B-=4,D=8+(15&(o>>>=4)),0===t.wbits)t.wbits=D;else if(D>t.wbits){A.msg="invalid window size",t.mode=30;break}t.dmax=1<<t.wbits,A.adler=t.check=1,t.mode=512&o?10:12,o=0,B=0;break;case 2:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.flags=o,(255&t.flags)!==fA){A.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){A.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=o>>8&1),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=3;case 3:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.time=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,G[2]=o>>>16&255,G[3]=o>>>24&255,t.check=Y(t.check,G,4,0)),o=0,B=0,t.mode=4;case 4:for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.head&&(t.head.xflags=255&o,t.head.os=o>>8),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0,t.mode=5;case 5:if(1024&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length=o,t.head&&(t.head.extra_len=o),512&t.flags&&(G[0]=255&o,G[1]=o>>>8&255,t.check=Y(t.check,G,2,0)),o=0,B=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((E=t.length)>n&&(E=n),E&&(t.head&&(D=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(I,I+E),D)),512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,t.length-=E),t.length))break A;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.name+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(0===n)break A;E=0;do{D=i[I+E++],t.head&&D&&t.length<65536&&(t.head.comment+=String.fromCharCode(D))}while(D&&E<n);if(512&t.flags&&(t.check=Y(t.check,i,E,I)),n-=E,I+=E,D)break A}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;B<16;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(65535&t.check)){A.msg="header crc mismatch",t.mode=30;break}o=0,B=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),A.adler=t.check=0,t.mode=12;break;case 10:for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}A.adler=t.check=cA(o),o=0,B=0,t.mode=11;case 11:if(0===t.havedict)return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,BA;A.adler=t.check=1,t.mode=12;case 12:if(e===gA||e===nA)break A;case 13:if(t.last){o>>>=7&B,B-=7&B,t.mode=27;break}for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}switch(t.last=1&o,B-=1,3&(o>>>=1)){case 0:t.mode=14;break;case 1:if(pA(t),t.mode=20,e===nA){o>>>=2,B-=2;break A}break;case 2:t.mode=17;break;case 3:A.msg="invalid block type",t.mode=30}o>>>=2,B-=2;break;case 14:for(o>>>=7&B,B-=7&B;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if((65535&o)!=(o>>>16^65535)){A.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&o,o=0,B=0,t.mode=15,e===nA)break A;case 15:t.mode=16;case 16:if(E=t.length){if(E>n&&(E=n),E>a&&(E=a),0===E)break A;r.set(i.subarray(I,I+E),g),n-=E,I+=E,a-=E,g+=E,t.length-=E;break}t.mode=12;break;case 17:for(;B<14;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(t.nlen=257+(31&o),o>>>=5,B-=5,t.ndist=1+(31&o),o>>>=5,B-=5,t.ncode=4+(15&o),o>>>=4,B-=4,t.nlen>286||t.ndist>30){A.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;B<3;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.lens[F[t.have++]]=7&o,o>>>=3,B-=3}for(;t.have<19;)t.lens[F[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,k={bits:t.lenbits},y=rA(0,t.lens,0,19,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(l<16)o>>>=c,B-=c,t.lens[t.have++]=l;else{if(16===l){for(p=c+2;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o>>>=c,B-=c,0===t.have){A.msg="invalid bit length repeat",t.mode=30;break}D=t.lens[t.have-1],E=3+(3&o),o>>>=2,B-=2}else if(17===l){for(p=c+3;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=3+(7&(o>>>=c)),o>>>=3,B-=3}else{for(p=c+7;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}B-=c,D=0,E=11+(127&(o>>>=c)),o>>>=7,B-=7}if(t.have+E>t.nlen+t.ndist){A.msg="invalid bit length repeat",t.mode=30;break}for(;E--;)t.lens[t.have++]=D}}if(30===t.mode)break;if(0===t.lens[256]){A.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,k={bits:t.lenbits},y=rA(1,t.lens,0,t.nlen,t.lencode,0,t.work,k),t.lenbits=k.bits,y){A.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,k={bits:t.distbits},y=rA(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,k),t.distbits=k.bits,y){A.msg="invalid distances set",t.mode=30;break}if(t.mode=20,e===nA)break A;case 20:t.mode=21;case 21:if(n>=6&&a>=258){A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,$(A,Q),g=A.next_out,r=A.output,a=A.avail_out,I=A.next_in,i=A.input,n=A.avail_in,o=t.hold,B=t.bits,12===t.mode&&(t.back=-1);break}for(t.back=0;h=(m=t.lencode[o&(1<<t.lenbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(h&&0==(240&h)){for(u=c,w=h,d=l;h=(m=t.lencode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,t.length=l,0===h){t.mode=26;break}if(32&h){t.back=-1,t.mode=12;break}if(64&h){A.msg="invalid literal/length code",t.mode=30;break}t.extra=15&h,t.mode=22;case 22:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.length+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;h=(m=t.distcode[o&(1<<t.distbits)-1])>>>16&255,l=65535&m,!((c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(0==(240&h)){for(u=c,w=h,d=l;h=(m=t.distcode[d+((o&(1<<u+w)-1)>>u)])>>>16&255,l=65535&m,!(u+(c=m>>>24)<=B);){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}o>>>=u,B-=u,t.back+=u}if(o>>>=c,B-=c,t.back+=c,64&h){A.msg="invalid distance code",t.mode=30;break}t.offset=l,t.extra=15&h,t.mode=24;case 24:if(t.extra){for(p=t.extra;B<p;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}t.offset+=o&(1<<t.extra)-1,o>>>=t.extra,B-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){A.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(0===a)break A;if(E=Q-a,t.offset>E){if((E=t.offset-E)>t.whave&&t.sane){A.msg="invalid distance too far back",t.mode=30;break}E>t.wnext?(E-=t.wnext,s=t.wsize-E):s=t.wnext-E,E>t.length&&(E=t.length),f=t.window}else f=r,s=g-t.offset,E=t.length;E>a&&(E=a),a-=E,t.length-=E;do{r[g++]=f[s++]}while(--E);0===t.length&&(t.mode=21);break;case 26:if(0===a)break A;r[g++]=t.length,a--,t.mode=21;break;case 27:if(t.wrap){for(;B<32;){if(0===n)break A;n--,o|=i[I++]<<B,B+=8}if(Q-=a,A.total_out+=Q,t.total+=Q,Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,g-Q):J(t.check,r,Q,g-Q)),Q=a,(t.flags?o:cA(o))!==t.check){A.msg="incorrect data check",t.mode=30;break}o=0,B=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;B<32;){if(0===n)break A;n--,o+=i[I++]<<B,B+=8}if(o!==(4294967295&t.total)){A.msg="incorrect length check",t.mode=30;break}o=0,B=0}t.mode=29;case 29:y=oA;break A;case 30:y=QA;break A;case 31:return EA;default:return CA}return A.next_out=g,A.avail_out=a,A.next_in=I,A.avail_in=n,t.hold=o,t.bits=B,(t.wsize||Q!==A.avail_out&&t.mode<30&&(t.mode<27||e!==IA))&&mA(A,A.output,A.next_out,Q-A.avail_out),C-=A.avail_in,Q-=A.avail_out,A.total_in+=C,A.total_out+=Q,t.total+=Q,t.wrap&&Q&&(A.adler=t.check=t.flags?Y(t.check,r,Q,A.next_out-Q):J(t.check,r,Q,A.next_out-Q)),A.data_type=t.bits+(t.last?64:0)+(12===t.mode?128:0)+(20===t.mode||15===t.mode?256:0),(0===C&&0===Q||e===IA)&&y===aA&&(y=sA),y},inflateEnd:function(A){if(!A||!A.state)return CA;var e=A.state;return e.window&&(e.window=null),A.state=null,aA},inflateGetHeader:function(A,e){if(!A||!A.state)return CA;var t=A.state;return 0==(2&t.wrap)?CA:(t.head=e,e.done=!1,aA)},inflateSetDictionary:function(A,e){var t,i=e.length;return A&&A.state?0!==(t=A.state).wrap&&11!==t.mode?CA:11===t.mode&&J(1,e,i,0)!==t.check?QA:mA(A,e,i,i)?(t.mode=31,EA):(t.havedict=1,aA):CA},inflateInfo:"pako inflate (from Nodeca project)"};var FA=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},SA=Object.prototype.toString,vA=H.Z_NO_FLUSH,RA=H.Z_FINISH,UA=H.Z_OK,LA=H.Z_STREAM_END,bA=H.Z_NEED_DICT,MA=H.Z_STREAM_ERROR,NA=H.Z_DATA_ERROR,xA=H.Z_MEM_ERROR;function JA(A){this.options=P({chunkSize:65536,windowBits:15,to:""},A||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||A&&A.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;var t=GA.inflateInit2(this.strm,e.windowBits);if(t!==UA)throw new Error(K[t]);if(this.header=new FA,GA.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=Z(e.dictionary):"[object ArrayBuffer]"===SA.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=GA.inflateSetDictionary(this.strm,e.dictionary))!==UA))throw new Error(K[t])}function qA(A,e){var t=new JA(e);if(t.push(A),t.err)throw t.msg||K[t.err];return t.result}JA.prototype.push=function(A,e){var t,i,r,I=this.strm,g=this.options.chunkSize,n=this.options.dictionary;if(this.ended)return!1;for(i=e===~~e?e:!0===e?RA:vA,"[object ArrayBuffer]"===SA.call(A)?I.input=new Uint8Array(A):I.input=A,I.next_in=0,I.avail_in=I.input.length;;){for(0===I.avail_out&&(I.output=new Uint8Array(g),I.next_out=0,I.avail_out=g),(t=GA.inflate(I,i))===bA&&n&&((t=GA.inflateSetDictionary(I,n))===UA?t=GA.inflate(I,i):t===NA&&(t=bA));I.avail_in>0&&t===LA&&I.state.wrap>0&&0!==A[I.next_in];)GA.inflateReset(I),t=GA.inflate(I,i);switch(t){case MA:case NA:case bA:case xA:return this.onEnd(t),this.ended=!0,!1}if(r=I.avail_out,I.next_out&&(0===I.avail_out||t===LA))if("string"===this.options.to){var a=W(I.output,I.next_out),o=I.next_out-a,B=j(I.output,a);I.next_out=o,I.avail_out=g-o,o&&I.output.set(I.output.subarray(a,a+o),0),this.onData(B)}else this.onData(I.output.length===I.next_out?I.output:I.output.subarray(0,I.next_out));if(t!==UA||0!==r){if(t===LA)return t=GA.inflateEnd(this.strm),this.onEnd(t),this.ended=!0,!0;if(0===I.avail_in)break}}return!0},JA.prototype.onData=function(A){this.chunks.push(A)},JA.prototype.onEnd=function(A){A===UA&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=T(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg};var YA={Inflate:JA,inflate:qA,inflateRaw:function(A,e){return(e=e||{}).raw=!0,qA(A,e)},ungzip:qA,constants:H}.inflate;function KA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var HA=function(A){s(t,w);var e=KA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){return YA(new Uint8Array(A)).buffer}}]),t}(),OA=Object.freeze({__proto__:null,default:HA});function PA(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var TA,VA=function(A){s(t,w);var e=PA(t);function t(){return B(this,t),e.apply(this,arguments)}return Q(t,[{key:"decodeBlock",value:function(A){for(var e=new DataView(A),t=[],i=0;i<A.byteLength;++i){var r=e.getInt8(i);if(r<0){var I=e.getUint8(i+1);r=-r;for(var g=0;g<=r;++g)t.push(I);i+=1}else{for(var n=0;n<=r;++n)t.push(e.getUint8(i+n+1));i+=r+1}}return new Uint8Array(t).buffer}}]),t}(),_A=Object.freeze({__proto__:null,default:VA}),XA={exports:{}};TA=XA,\n/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */\nfunction(){var A,e,t,i,r,I,g,n,a,o,B,C,Q,E,s,f,c=(A={defaultNoDataValue:-34027999387901484e22,decode:function(I,g){var n=(g=g||{}).encodedMaskData||null===g.encodedMaskData,a=r(I,g.inputOffset||0,n),o=null!==g.noDataValue?g.noDataValue:A.defaultNoDataValue,B=e(a,g.pixelType||Float32Array,g.encodedMaskData,o,g.returnMask),C={width:a.width,height:a.height,pixelData:B.resultPixels,minValue:B.minValue,maxValue:a.pixels.maxValue,noDataValue:o};return B.resultMask&&(C.maskData=B.resultMask),g.returnEncodedMask&&a.mask&&(C.encodedMaskData=a.mask.bitset?a.mask.bitset:null),g.returnFileInfo&&(C.fileInfo=t(a),g.computeUsedBitDepths&&(C.fileInfo.bitDepths=i(a))),C}},e=function(A,e,t,i,r){var g,n,a,o=0,B=A.pixels.numBlocksX,C=A.pixels.numBlocksY,Q=Math.floor(A.width/B),E=Math.floor(A.height/C),s=2*A.maxZError,f=Number.MAX_VALUE;t=t||(A.mask?A.mask.bitset:null),n=new e(A.width*A.height),r&&t&&(a=new Uint8Array(A.width*A.height));for(var c,h,l=new Float32Array(Q*E),u=0;u<=C;u++){var w=u!==C?E:A.height%C;if(0!==w)for(var d=0;d<=B;d++){var D=d!==B?Q:A.width%B;if(0!==D){var y,k,p,m,G=u*A.width*E+d*Q,F=A.width-D,S=A.pixels.blocks[o];if(S.encoding<2?(0===S.encoding?y=S.rawData:(I(S.stuffedData,S.bitsPerPixel,S.numValidPixels,S.offset,s,l,A.pixels.maxValue),y=l),k=0):p=2===S.encoding?0:S.offset,t)for(h=0;h<w;h++){for(7&G&&(m=t[G>>3],m<<=7&G),c=0;c<D;c++)7&G||(m=t[G>>3]),128&m?(a&&(a[G]=1),f=f>(g=S.encoding<2?y[k++]:p)?g:f,n[G++]=g):(a&&(a[G]=0),n[G++]=i),m<<=1;G+=F}else if(S.encoding<2)for(h=0;h<w;h++){for(c=0;c<D;c++)f=f>(g=y[k++])?g:f,n[G++]=g;G+=F}else for(f=f>p?p:f,h=0;h<w;h++){for(c=0;c<D;c++)n[G++]=p;G+=F}if(1===S.encoding&&k!==S.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:n,resultMask:a,minValue:f}},t=function(A){return{fileIdentifierString:A.fileIdentifierString,fileVersion:A.fileVersion,imageType:A.imageType,height:A.height,width:A.width,maxZError:A.maxZError,eofOffset:A.eofOffset,mask:A.mask?{numBlocksX:A.mask.numBlocksX,numBlocksY:A.mask.numBlocksY,numBytes:A.mask.numBytes,maxValue:A.mask.maxValue}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,numBytes:A.pixels.numBytes,maxValue:A.pixels.maxValue,noDataValue:A.noDataValue}}},i=function(A){for(var e=A.pixels.numBlocksX*A.pixels.numBlocksY,t={},i=0;i<e;i++){var r=A.pixels.blocks[i];0===r.encoding?t.float32=!0:1===r.encoding?t[r.bitsPerPixel]=!0:t[0]=!0}return Object.keys(t)},r=function(A,e,t){var i={},r=new Uint8Array(A,e,10);if(i.fileIdentifierString=String.fromCharCode.apply(null,r),"CntZImage"!==i.fileIdentifierString.trim())throw"Unexpected file identifier string: "+i.fileIdentifierString;e+=10;var I=new DataView(A,e,24);if(i.fileVersion=I.getInt32(0,!0),i.imageType=I.getInt32(4,!0),i.height=I.getUint32(8,!0),i.width=I.getUint32(12,!0),i.maxZError=I.getFloat64(16,!0),e+=24,!t)if(I=new DataView(A,e,16),i.mask={},i.mask.numBlocksY=I.getUint32(0,!0),i.mask.numBlocksX=I.getUint32(4,!0),i.mask.numBytes=I.getUint32(8,!0),i.mask.maxValue=I.getFloat32(12,!0),e+=16,i.mask.numBytes>0){var g=new Uint8Array(Math.ceil(i.width*i.height/8)),n=(I=new DataView(A,e,i.mask.numBytes)).getInt16(0,!0),a=2,o=0;do{if(n>0)for(;n--;)g[o++]=I.getUint8(a++);else{var B=I.getUint8(a++);for(n=-n;n--;)g[o++]=B}n=I.getInt16(a,!0),a+=2}while(a<i.mask.numBytes);if(-32768!==n||o<g.length)throw"Unexpected end of mask RLE encoding";i.mask.bitset=g,e+=i.mask.numBytes}else 0==(i.mask.numBytes|i.mask.numBlocksY|i.mask.maxValue)&&(i.mask.bitset=new Uint8Array(Math.ceil(i.width*i.height/8)));I=new DataView(A,e,16),i.pixels={},i.pixels.numBlocksY=I.getUint32(0,!0),i.pixels.numBlocksX=I.getUint32(4,!0),i.pixels.numBytes=I.getUint32(8,!0),i.pixels.maxValue=I.getFloat32(12,!0),e+=16;var C=i.pixels.numBlocksX,Q=i.pixels.numBlocksY,E=C+(i.width%C>0?1:0),s=Q+(i.height%Q>0?1:0);i.pixels.blocks=new Array(E*s);for(var f=0,c=0;c<s;c++)for(var h=0;h<E;h++){var l=0,u=A.byteLength-e;I=new DataView(A,e,Math.min(10,u));var w={};i.pixels.blocks[f++]=w;var d=I.getUint8(0);if(l++,w.encoding=63&d,w.encoding>3)throw"Invalid block encoding ("+w.encoding+")";if(2!==w.encoding){if(0!==d&&2!==d){if(d>>=6,w.offsetType=d,2===d)w.offset=I.getInt8(1),l++;else if(1===d)w.offset=I.getInt16(1,!0),l+=2;else{if(0!==d)throw"Invalid block offset type";w.offset=I.getFloat32(1,!0),l+=4}if(1===w.encoding)if(d=I.getUint8(l),l++,w.bitsPerPixel=63&d,d>>=6,w.numValidPixelsType=d,2===d)w.numValidPixels=I.getUint8(l),l++;else if(1===d)w.numValidPixels=I.getUint16(l,!0),l+=2;else{if(0!==d)throw"Invalid valid pixel count type";w.numValidPixels=I.getUint32(l,!0),l+=4}}var D;if(e+=l,3!==w.encoding)if(0===w.encoding){var y=(i.pixels.numBytes-1)/4;if(y!==Math.floor(y))throw"uncompressed block has invalid length";D=new ArrayBuffer(4*y),new Uint8Array(D).set(new Uint8Array(A,e,4*y));var k=new Float32Array(D);w.rawData=k,e+=4*y}else if(1===w.encoding){var p=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),m=Math.ceil(p/4);D=new ArrayBuffer(4*m),new Uint8Array(D).set(new Uint8Array(A,e,p)),w.stuffedData=new Uint32Array(D),e+=p}}else e++}return i.eofOffset=e,i},I=function(A,e,t,i,r,I,g){var n,a,o,B=(1<<e)-1,C=0,Q=0,E=Math.ceil((g-i)/r),s=4*A.length-Math.ceil(e*t/8);for(A[A.length-1]<<=8*s,n=0;n<t;n++){if(0===Q&&(o=A[C++],Q=32),Q>=e)a=o>>>Q-e&B,Q-=e;else{var f=e-Q;a=(o&B)<<f&B,a+=(o=A[C++])>>>(Q=32-f)}I[n]=a<E?i+a*r:g}return I},A),h=(g=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q,E=(1<<t)-1,s=0,f=0,c=4*A.length-Math.ceil(t*i/8);if(A[A.length-1]<<=8*c,r)for(a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=r[o];else for(Q=Math.ceil((n-I)/g),a=0;a<i;a++)0===f&&(B=A[s++],f=32),f>=t?(o=B>>>f-t&E,f-=t):(o=(B&E)<<(C=t-f)&E,o+=(B=A[s++])>>>(f=32-C)),e[a]=o<Q?I+o*g:n},n=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=[],s=4*A.length-Math.ceil(e*t/8);A[A.length-1]<<=8*s;var f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32),C>=e?(Q=g>>>C-e&n,C-=e):(Q=(g&n)<<(B=e-C)&n,Q+=(g=A[a++])>>>(C=32-B)),E[o]=Q<f?i+Q*r:I;return E.unshift(i),E},a=function(A,e,t,i,r,I,g,n){var a,o,B,C,Q=(1<<t)-1,E=0,s=0,f=0;if(r)for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=r[o];else{var c=Math.ceil((n-I)/g);for(a=0;a<i;a++)0===s&&(B=A[E++],s=32,f=0),s>=t?(o=B>>>f&Q,s-=t,f+=t):(o=B>>>f&Q,s=32-(C=t-s),o|=((B=A[E++])&(1<<C)-1)<<t-C,f=C),e[a]=o<c?I+o*g:n}return e},o=function(A,e,t,i,r,I){var g,n=(1<<e)-1,a=0,o=0,B=0,C=0,Q=0,E=0,s=[],f=Math.ceil((I-i)/r);for(o=0;o<t;o++)0===C&&(g=A[a++],C=32,E=0),C>=e?(Q=g>>>E&n,C-=e,E+=e):(Q=g>>>E&n,C=32-(B=e-C),Q|=((g=A[a++])&(1<<B)-1)<<e-B,E=B),s[o]=Q<f?i+Q*r:I;return s.unshift(i),s},B=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=4*A.length-Math.ceil(t*i/8);for(A[A.length-1]<<=8*C,r=0;r<i;r++)0===B&&(g=A[o++],B=32),B>=t?(I=g>>>B-t&a,B-=t):(I=(g&a)<<(n=t-B)&a,I+=(g=A[o++])>>>(B=32-n)),e[r]=I;return e},C=function(A,e,t,i){var r,I,g,n,a=(1<<t)-1,o=0,B=0,C=0;for(r=0;r<i;r++)0===B&&(g=A[o++],B=32,C=0),B>=t?(I=g>>>C&a,B-=t,C+=t):(I=g>>>C&a,B=32-(n=t-B),I|=((g=A[o++])&(1<<n)-1)<<t-n,C=n),e[r]=I;return e},Q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(A){for(var e=65535,t=65535,i=A.length,r=Math.floor(i/2),I=0;r;){var g=r>=359?359:r;r-=g;do{e+=A[I++]<<8,t+=e+=A[I++]}while(--g);e=(65535&e)+(e>>>16),t=(65535&t)+(t>>>16)}return 1&i&&(t+=e+=A[I]<<8),((t=(65535&t)+(t>>>16))<<16|(e=(65535&e)+(e>>>16)))>>>0},readHeaderInfo:function(A,e){var t=e.ptr,i=new Uint8Array(A,t,6),r={};if(r.fileIdentifierString=String.fromCharCode.apply(null,i),0!==r.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+r.fileIdentifierString;t+=6;var I,g=new DataView(A,t,8),n=g.getInt32(0,!0);if(r.fileVersion=n,t+=4,n>=3&&(r.checksum=g.getUint32(4,!0),t+=4),g=new DataView(A,t,12),r.height=g.getUint32(0,!0),r.width=g.getUint32(4,!0),t+=8,n>=4?(r.numDims=g.getUint32(8,!0),t+=4):r.numDims=1,g=new DataView(A,t,40),r.numValidPixel=g.getUint32(0,!0),r.microBlockSize=g.getInt32(4,!0),r.blobSize=g.getInt32(8,!0),r.imageType=g.getInt32(12,!0),r.maxZError=g.getFloat64(16,!0),r.zMin=g.getFloat64(24,!0),r.zMax=g.getFloat64(32,!0),t+=40,e.headerInfo=r,e.ptr=t,n>=3&&(I=n>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(A,t-I,r.blobSize-14))!==r.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(A,e){var t=e.headerInfo,i=this.getDataTypeArray(t.imageType),r=t.numDims*this.getDataTypeSize(t.imageType),I=this.readSubArray(A,e.ptr,i,r),g=this.readSubArray(A,e.ptr+r,i,r);e.ptr+=2*r;var n,a=!0;for(n=0;n<t.numDims;n++)if(I[n]!==g[n]){a=!1;break}return t.minValues=I,t.maxValues=g,a},readSubArray:function(A,e,t,i){var r;if(t===Uint8Array)r=new Uint8Array(A,e,i);else{var I=new ArrayBuffer(i);new Uint8Array(I).set(new Uint8Array(A,e,i)),r=new t(I)}return r},readMask:function(A,e){var t,i,r=e.ptr,I=e.headerInfo,g=I.width*I.height,n=I.numValidPixel,a=new DataView(A,r,4),o={};if(o.numBytes=a.getUint32(0,!0),r+=4,(0===n||g===n)&&0!==o.numBytes)throw"invalid mask";if(0===n)t=new Uint8Array(Math.ceil(g/8)),o.bitset=t,i=new Uint8Array(g),e.pixels.resultMask=i,r+=o.numBytes;else if(o.numBytes>0){t=new Uint8Array(Math.ceil(g/8));var B=(a=new DataView(A,r,o.numBytes)).getInt16(0,!0),C=2,Q=0,E=0;do{if(B>0)for(;B--;)t[Q++]=a.getUint8(C++);else for(E=a.getUint8(C++),B=-B;B--;)t[Q++]=E;B=a.getInt16(C,!0),C+=2}while(C<o.numBytes);if(-32768!==B||Q<t.length)throw"Unexpected end of mask RLE encoding";i=new Uint8Array(g);var s=0,f=0;for(f=0;f<g;f++)7&f?(s=t[f>>3],s<<=7&f):s=t[f>>3],128&s&&(i[f]=1);e.pixels.resultMask=i,o.bitset=t,r+=o.numBytes}return e.ptr=r,e.mask=o,!0},readDataOneSweep:function(A,e,t,i){var r,I=e.ptr,g=e.headerInfo,n=g.numDims,a=g.width*g.height,o=g.imageType,B=g.numValidPixel*Q.getDataTypeSize(o)*n,C=e.pixels.resultMask;if(t===Uint8Array)r=new Uint8Array(A,I,B);else{var E=new ArrayBuffer(B);new Uint8Array(E).set(new Uint8Array(A,I,B)),r=new t(E)}if(r.length===a*n)e.pixels.resultPixels=i?Q.swapDimensionOrder(r,a,n,t,!0):r;else{e.pixels.resultPixels=new t(a*n);var s=0,f=0,c=0,h=0;if(n>1){if(i){for(f=0;f<a;f++)if(C[f])for(h=f,c=0;c<n;c++,h+=a)e.pixels.resultPixels[h]=r[s++]}else for(f=0;f<a;f++)if(C[f])for(h=f*n,c=0;c<n;c++)e.pixels.resultPixels[h+c]=r[s++]}else for(f=0;f<a;f++)C[f]&&(e.pixels.resultPixels[f]=r[s++])}return I+=B,e.ptr=I,!0},readHuffmanTree:function(A,e){var t=this.HUFFMAN_LUT_BITS_MAX,i=new DataView(A,e.ptr,16);if(e.ptr+=16,i.getInt32(0,!0)<2)throw"unsupported Huffman version";var r=i.getInt32(4,!0),I=i.getInt32(8,!0),g=i.getInt32(12,!0);if(I>=g)return!1;var n=new Uint32Array(g-I);Q.decodeBits(A,e,n);var a,o,B,C,s=[];for(a=I;a<g;a++)s[o=a-(a<r?0:r)]={first:n[a-I],second:null};var f=A.byteLength-e.ptr,c=Math.ceil(f/4),h=new ArrayBuffer(4*c);new Uint8Array(h).set(new Uint8Array(A,e.ptr,f));var l,u=new Uint32Array(h),w=0,d=0;for(l=u[0],a=I;a<g;a++)(C=s[o=a-(a<r?0:r)].first)>0&&(s[o].second=l<<w>>>32-C,32-w>=C?32===(w+=C)&&(w=0,l=u[++d]):(w+=C-32,l=u[++d],s[o].second|=l>>>32-w));var D=0,y=0,k=new E;for(a=0;a<s.length;a++)void 0!==s[a]&&(D=Math.max(D,s[a].first));y=D>=t?t:D;var p,m,G,F,S,v=[];for(a=I;a<g;a++)if((C=s[o=a-(a<r?0:r)].first)>0)if(p=[C,o],C<=y)for(m=s[o].second<<y-C,G=1<<y-C,B=0;B<G;B++)v[m|B]=p;else for(m=s[o].second,S=k,F=C-1;F>=0;F--)m>>>F&1?(S.right||(S.right=new E),S=S.right):(S.left||(S.left=new E),S=S.left),0!==F||S.val||(S.val=p[1]);return{decodeLut:v,numBitsLUTQick:y,numBitsLUT:D,tree:k,stuffedData:u,srcPtr:d,bitPos:w}},readHuffman:function(A,e,t,i){var r,I,g,n,a,o,B,C,E,s=e.headerInfo.numDims,f=e.headerInfo.height,c=e.headerInfo.width,h=c*f,l=this.readHuffmanTree(A,e),u=l.decodeLut,w=l.tree,d=l.stuffedData,D=l.srcPtr,y=l.bitPos,k=l.numBitsLUTQick,p=l.numBitsLUT,m=0===e.headerInfo.imageType?128:0,G=e.pixels.resultMask,F=0;y>0&&(D++,y=0);var S,v=d[D],R=1===e.encodeMode,U=new t(h*s),L=U;if(s<2||R){for(S=0;S<s;S++)if(s>1&&(L=new t(U.buffer,h*S,h),F=0),e.headerInfo.numValidPixel===c*f)for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(g+=B>0?F:o>0?L[C-c]:F,g&=255,L[C]=g,F=g):L[C]=g}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++,C++)if(G[C]){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,R?(B>0&&G[C-1]?g+=F:o>0&&G[C-c]?g+=L[C-c]:g+=F,g&=255,L[C]=g,F=g):L[C]=g}}else for(C=0,o=0;o<f;o++)for(B=0;B<c;B++)if(C=o*c+B,!G||G[C])for(S=0;S<s;S++,C+=h){if(I=0,a=n=v<<y>>>32-k,32-y<k&&(a=n|=d[D+1]>>>64-y-k),u[a])I=u[a][1],y+=u[a][0];else for(a=n=v<<y>>>32-p,32-y<p&&(a=n|=d[D+1]>>>64-y-p),r=w,E=0;E<p;E++)if(!(r=n>>>p-E-1&1?r.right:r.left).left&&!r.right){I=r.val,y=y+E+1;break}y>=32&&(y-=32,v=d[++D]),g=I-m,L[C]=g}e.ptr=e.ptr+4*(D+1)+(y>0?4:0),e.pixels.resultPixels=U,s>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(U,h,s,t))},decodeBits:function(A,e,t,i,r){var I=e.headerInfo,Q=I.fileVersion,E=0,s=A.byteLength-e.ptr>=5?5:A.byteLength-e.ptr,f=new DataView(A,e.ptr,s),c=f.getUint8(0);E++;var h=c>>6,l=0===h?4:3-h,u=(32&c)>0,w=31&c,d=0;if(1===l)d=f.getUint8(E),E++;else if(2===l)d=f.getUint16(E,!0),E+=2;else{if(4!==l)throw"Invalid valid pixel count type";d=f.getUint32(E,!0),E+=4}var D,y,k,p,m,G,F,S,v,R=2*I.maxZError,U=I.numDims>1?I.maxValues[r]:I.zMax;if(u){for(e.counter.lut++,S=f.getUint8(E),E++,p=Math.ceil((S-1)*w/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),k=new Uint8Array(y),e.ptr+=E,k.set(new Uint8Array(A,e.ptr,p)),F=new Uint32Array(y),e.ptr+=p,v=0;S-1>>>v;)v++;p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,G=Q>=3?o(F,w,S-1,i,R,U):n(F,w,S-1,i,R,U),Q>=3?a(D,t,v,d,G):g(D,t,v,d,G)}else e.counter.bitstuffer++,v=w,e.ptr+=E,v>0&&(p=Math.ceil(d*v/8),m=Math.ceil(p/4),y=new ArrayBuffer(4*m),(k=new Uint8Array(y)).set(new Uint8Array(A,e.ptr,p)),D=new Uint32Array(y),e.ptr+=p,Q>=3?null==i?C(D,t,v,d):a(D,t,v,d,!1,i,R,U):null==i?B(D,t,v,d):g(D,t,v,d,!1,i,R,U))},readTiles:function(A,e,t,i){var r=e.headerInfo,I=r.width,g=r.height,n=I*g,a=r.microBlockSize,o=r.imageType,B=Q.getDataTypeSize(o),C=Math.ceil(I/a),E=Math.ceil(g/a);e.pixels.numBlocksY=E,e.pixels.numBlocksX=C,e.pixels.ptr=0;var s,f,c,h,l,u,w,d,D,y,k=0,p=0,m=0,G=0,F=0,S=0,v=0,R=0,U=0,L=0,b=0,M=0,N=0,x=0,J=0,q=new t(a*a),Y=g%a||a,K=I%a||a,H=r.numDims,O=e.pixels.resultMask,P=e.pixels.resultPixels,T=r.fileVersion>=5?14:15,V=r.zMax;for(m=0;m<E;m++)for(F=m!==E-1?a:Y,G=0;G<C;G++)for(L=m*I*a+G*a,b=I-(S=G!==C-1?a:K),d=0;d<H;d++){if(H>1?(y=P,L=m*I*a+G*a,P=new t(e.pixels.resultPixels.buffer,n*d*B,n),V=r.maxValues[d]):y=null,v=A.byteLength-e.ptr,f={},J=0,R=(s=new DataView(A,e.ptr,Math.min(10,v))).getUint8(0),J++,D=r.fileVersion>=5?4&R:0,U=R>>6&255,(R>>2&T)!=(G*a>>3&T))throw"integrity issue";if(D&&0===d)throw"integrity issue";if((l=3&R)>3)throw e.ptr+=J,"Invalid block encoding ("+l+")";if(2!==l)if(0===l){if(D)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=J,M=(M=F*S*B)<(N=A.byteLength-e.ptr)?M:N,c=new ArrayBuffer(M%B==0?M:M+B-M%B),new Uint8Array(c).set(new Uint8Array(A,e.ptr,M)),h=new t(c),x=0,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=h[x++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=h[x++];L+=b}e.ptr+=x*B}else if(u=Q.getDataTypeUsed(D&&o<6?4:o,U),w=Q.getOnePixel(f,J,u,s),J+=Q.getDataTypeSize(u),3===l)if(e.ptr+=J,e.counter.constantoffset++,O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=D?Math.min(V,y[L]+w):w),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=D?Math.min(V,y[L]+w):w,L++;L+=b}else if(e.ptr+=J,Q.decodeBits(A,e,q,w,d),J=0,D)if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]+y[L]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L]=q[J++]+y[L],L++;L+=b}else if(O)for(k=0;k<F;k++){for(p=0;p<S;p++)O[L]&&(P[L]=q[J++]),L++;L+=b}else for(k=0;k<F;k++){for(p=0;p<S;p++)P[L++]=q[J++];L+=b}else{if(D)if(O)for(k=0;k<F;k++)for(p=0;p<S;p++)O[L]&&(P[L]=y[L]),L++;else for(k=0;k<F;k++)for(p=0;p<S;p++)P[L]=y[L],L++;e.counter.constant++,e.ptr+=J}}H>1&&!i&&(e.pixels.resultPixels=Q.swapDimensionOrder(e.pixels.resultPixels,n,H,t))},formatFileInfo:function(A){return{fileIdentifierString:A.headerInfo.fileIdentifierString,fileVersion:A.headerInfo.fileVersion,imageType:A.headerInfo.imageType,height:A.headerInfo.height,width:A.headerInfo.width,numValidPixel:A.headerInfo.numValidPixel,microBlockSize:A.headerInfo.microBlockSize,blobSize:A.headerInfo.blobSize,maxZError:A.headerInfo.maxZError,pixelType:Q.getPixelType(A.headerInfo.imageType),eofOffset:A.eofOffset,mask:A.mask?{numBytes:A.mask.numBytes}:null,pixels:{numBlocksX:A.pixels.numBlocksX,numBlocksY:A.pixels.numBlocksY,maxValue:A.headerInfo.zMax,minValue:A.headerInfo.zMin,noDataValue:A.noDataValue}}},constructConstantSurface:function(A,e){var t=A.headerInfo.zMax,i=A.headerInfo.zMin,r=A.headerInfo.maxValues,I=A.headerInfo.numDims,g=A.headerInfo.height*A.headerInfo.width,n=0,a=0,o=0,B=A.pixels.resultMask,C=A.pixels.resultPixels;if(B)if(I>1){if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)B[a]&&(C[o+a]=t);else for(a=0;a<g;a++)if(B[a])for(o=a*I,n=0;n<I;n++)C[o+I]=r[n]}else for(a=0;a<g;a++)B[a]&&(C[a]=t);else if(I>1&&i!==t)if(e)for(n=0;n<I;n++)for(o=n*g,t=r[n],a=0;a<g;a++)C[o+a]=t;else for(a=0;a<g;a++)for(o=a*I,n=0;n<I;n++)C[o+n]=r[n];else for(a=0;a<g*I;a++)C[a]=t},getDataTypeArray:function(A){var e;switch(A){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:default:e=Float32Array;break;case 7:e=Float64Array}return e},getPixelType:function(A){var e;switch(A){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:default:e="F32";break;case 7:e="F64"}return e},isValidPixelValue:function(A,e){if(null==e)return!1;var t;switch(A){case 0:t=e>=-128&&e<=127;break;case 1:t=e>=0&&e<=255;break;case 2:t=e>=-32768&&e<=32767;break;case 3:t=e>=0&&e<=65536;break;case 4:t=e>=-2147483648&&e<=2147483647;break;case 5:t=e>=0&&e<=4294967296;break;case 6:t=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:t=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:t=!1}return t},getDataTypeSize:function(A){var e=0;switch(A){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=A}return e},getDataTypeUsed:function(A,e){var t=A;switch(A){case 2:case 4:t=A-e;break;case 3:case 5:t=A-2*e;break;case 6:t=0===e?A:1===e?2:1;break;case 7:t=0===e?A:A-2*e+1;break;default:t=A}return t},getOnePixel:function(A,e,t,i){var r=0;switch(t){case 0:r=i.getInt8(e);break;case 1:r=i.getUint8(e);break;case 2:r=i.getInt16(e,!0);break;case 3:r=i.getUint16(e,!0);break;case 4:r=i.getInt32(e,!0);break;case 5:r=i.getUInt32(e,!0);break;case 6:r=i.getFloat32(e,!0);break;case 7:r=i.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return r},swapDimensionOrder:function(A,e,t,i,r){var I=0,g=0,n=0,a=0,o=A;if(t>1)if(o=new i(e*t),r)for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[a]=A[g++];else for(I=0;I<e;I++)for(a=I,n=0;n<t;n++,a+=e)o[g++]=A[a];return o}},E=function(A,e,t){this.val=A,this.left=e,this.right=t},{decode:function(A,e){var t=(e=e||{}).noDataValue,i=0,r={};r.ptr=e.inputOffset||0,r.pixels={},Q.readHeaderInfo(A,r);var I=r.headerInfo,g=I.fileVersion,n=Q.getDataTypeArray(I.imageType);if(g>5)throw"unsupported lerc version 2."+g;Q.readMask(A,r),I.numValidPixel===I.width*I.height||r.pixels.resultMask||(r.pixels.resultMask=e.maskData);var a=I.width*I.height;r.pixels.resultPixels=new n(a*I.numDims),r.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var o,B=!e.returnPixelInterleavedDims;if(0!==I.numValidPixel)if(I.zMax===I.zMin)Q.constructConstantSurface(r,B);else if(g>=4&&Q.checkMinMaxRanges(A,r))Q.constructConstantSurface(r,B);else{var C=new DataView(A,r.ptr,2),E=C.getUint8(0);if(r.ptr++,E)Q.readDataOneSweep(A,r,n,B);else if(g>1&&I.imageType<=1&&Math.abs(I.maxZError-.5)<1e-5){var s=C.getUint8(1);if(r.ptr++,r.encodeMode=s,s>2||g<4&&s>1)throw"Invalid Huffman flag "+s;s?Q.readHuffman(A,r,n,B):Q.readTiles(A,r,n,B)}else Q.readTiles(A,r,n,B)}r.eofOffset=r.ptr,e.inputOffset?(o=r.headerInfo.blobSize+e.inputOffset-r.ptr,Math.abs(o)>=1&&(r.eofOffset=e.inputOffset+r.headerInfo.blobSize)):(o=r.headerInfo.blobSize-r.ptr,Math.abs(o)>=1&&(r.eofOffset=r.headerInfo.blobSize));var f={width:I.width,height:I.height,pixelData:r.pixels.resultPixels,minValue:I.zMin,maxValue:I.zMax,validPixelCount:I.numValidPixel,dimCount:I.numDims,dimStats:{minValues:I.minValues,maxValues:I.maxValues},maskData:r.pixels.resultMask};if(r.pixels.resultMask&&Q.isValidPixelValue(I.imageType,t)){var c=r.pixels.resultMask;for(i=0;i<a;i++)c[i]||(f.pixelData[i]=t);f.noDataValue=t}return r.noDataValue=t,e.returnFileInfo&&(f.fileInfo=Q.formatFileInfo(r)),f},getBandCount:function(A){for(var e=0,t=0,i={ptr:0,pixels:{}};t<A.byteLength-58;)Q.readHeaderInfo(A,i),t+=i.headerInfo.blobSize,e++,i.ptr=t;return e}}),l=(s=new ArrayBuffer(4),f=new Uint8Array(s),new Uint32Array(s)[0]=1,1===f[0]),u={decode:function(A,e){if(!l)throw"Big endian system is not supported.";var t,i,r=(e=e||{}).inputOffset||0,I=new Uint8Array(A,r,10),g=String.fromCharCode.apply(null,I);if("CntZImage"===g.trim())t=c,i=1;else{if("Lerc2"!==g.substring(0,5))throw"Unexpected file identifier string: "+g;t=h,i=2}for(var n,a,o,B,C,Q,E=0,s=A.byteLength-10,f=[],u={width:0,height:0,pixels:[],pixelType:e.pixelType,mask:null,statistics:[]},w=0;r<s;){var d=t.decode(A,{inputOffset:r,encodedMaskData:n,maskData:o,returnMask:0===E,returnEncodedMask:0===E,returnFileInfo:!0,returnPixelInterleavedDims:e.returnPixelInterleavedDims,pixelType:e.pixelType||null,noDataValue:e.noDataValue||null});r=d.fileInfo.eofOffset,o=d.maskData,0===E&&(n=d.encodedMaskData,u.width=d.width,u.height=d.height,u.dimCount=d.dimCount||1,u.pixelType=d.pixelType||d.fileInfo.pixelType,u.mask=o),i>1&&(o&&f.push(o),d.fileInfo.mask&&d.fileInfo.mask.numBytes>0&&w++),E++,u.pixels.push(d.pixelData),u.statistics.push({minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue,dimStats:d.dimStats})}if(i>1&&w>1){for(Q=u.width*u.height,u.bandMasks=f,(o=new Uint8Array(Q)).set(f[0]),B=1;B<f.length;B++)for(a=f[B],C=0;C<Q;C++)o[C]=o[C]&a[C];u.maskData=o}return u}};TA.exports?TA.exports=u:this.Lerc=u}();var ZA,jA,WA,zA=XA.exports,$A={env:{emscripten_notify_memory_growth:function(A){WA=new Uint8Array(jA.exports.memory.buffer)}}},Ae=function(){function A(){B(this,A)}return Q(A,[{key:"init",value:function(){return ZA||(ZA="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+ee).then((function(A){return A.arrayBuffer()})).then((function(A){return WebAssembly.instantiate(A,$A)})).then(this._init):WebAssembly.instantiate(Buffer.from(ee,"base64"),$A).then(this._init))}},{key:"_init",value:function(A){jA=A.instance,$A.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(A){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!jA)throw new Error("ZSTDDecoder: Await .init() before decoding.");var t=A.byteLength,i=jA.exports.malloc(t);WA.set(A,i),e=e||Number(jA.exports.ZSTD_findDecompressedSize(i,t));var r=jA.exports.malloc(e),I=jA.exports.ZSTD_decompress(r,e,i,t),g=WA.slice(r,r+I);return jA.exports.free(i),jA.exports.free(r),g}}]),A}(),ee="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",te={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},ie={};for(var re in te)te.hasOwnProperty(re)&&(ie[te[re]]=parseInt(re,10));ie.BitsPerSample,ie.ExtraSamples,ie.SampleFormat,ie.StripByteCounts,ie.StripOffsets,ie.StripRowCounts,ie.TileByteCounts,ie.TileOffsets,ie.SubIFDs;var Ie={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ge={};for(var ne in Ie)Ie.hasOwnProperty(ne)&&(ge[Ie[ne]]=parseInt(ne,10));var ae=1,oe=0,Be=1,Ce=2,Qe={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},Ee={};for(var se in Qe)Qe.hasOwnProperty(se)&&(Ee[Qe[se]]=parseInt(se,10));function fe(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var ce=new Ae,he=function(A){s(t,w);var e=fe(t);function t(A){var i;return B(this,t),(i=e.call(this)).planarConfiguration=void 0!==A.PlanarConfiguration?A.PlanarConfiguration:1,i.samplesPerPixel=void 0!==A.SamplesPerPixel?A.SamplesPerPixel:1,i.addCompression=A.LercParameters[ae],i}return Q(t,[{key:"decodeBlock",value:function(A){switch(this.addCompression){case oe:break;case Be:A=YA(new Uint8Array(A)).buffer;break;case Ce:A=ce.decode(new Uint8Array(A)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return zA.decode(A,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),t}(),le=Object.freeze({__proto__:null,zstd:ce,default:he});function ue(A){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(A){return!1}}();return function(){var t,i=c(A);if(e){var r=c(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return f(this,t)}}var we=function(A){s(I,w);var t,i=ue(I);function I(){var A;if(B(this,I),A=i.call(this),"undefined"==typeof createImageBitmap)throw new Error("Cannot decode WebImage as `createImageBitmap` is not available");if("undefined"==typeof document&&"undefined"==typeof OffscreenCanvas)throw new Error("Cannot decode WebImage as neither `document` nor `OffscreenCanvas` is not available");return A}return Q(I,[{key:"decode",value:(t=e(r.mark((function A(e,t){var i,I,g,n;return r.wrap((function(A){for(;;)switch(A.prev=A.next){case 0:return i=new Blob([t]),A.next=3,createImageBitmap(i);case 3:return I=A.sent,"undefined"!=typeof document?((g=document.createElement("canvas")).width=I.width,g.height=I.height):g=new OffscreenCanvas(I.width,I.height),(n=g.getContext("2d")).drawImage(I,0,0),A.abrupt("return",n.getImageData(0,0,I.width,I.height).data.buffer);case 8:case"end":return A.stop()}}),A)}))),function(A,e){return t.apply(this,arguments)})}]),I}(),de=Object.freeze({__proto__:null,default:we});';return new te(typeof Buffer<"u"?"data:application/javascript;base64,"+Buffer.from(m,"binary").toString("base64"):URL.createObjectURL(new Blob([m],{type:"application/javascript"})))}});y.cogProtocol=async m=>{if(m.type=="json"){const g=m.url.replace("cog://","").split("#")[0];return{data:await Rs(g).getTilejson(m.url)}}if(m.type=="image")return{data:await Co(m.url)};throw new Error(`Unsupported request type '${m.type}'`)},y.colorScale=bl,y.colorSchemeNames=Qi,y.locationValues=async(m,{latitude:g,longitude:A},v)=>{const x=Rs(m),{minzoom:k,maxzoom:P}=await x.getTilejson(m),{noData:S,scale:V,offset:U}=await x.getMetadata(),q=v===void 0?P:Math.max(k,Math.min(P,Math.round(v))),{tileIndex:re,column:Z,row:N}=(({latitude:se,longitude:ce,zoom:ae})=>{const[Ae,ve]=Ls.forward([ce,se]),Ie=(Ae+Wn/2)/Wn*vn*2**ae,ke=-(ve-Wn/2)/Wn*vn*2**ae;return{tileIndex:{z:ae,x:Math.floor(Ie/vn),y:Math.floor(ke/vn)},row:Math.floor(ke%vn),column:Math.floor(Ie%vn)}})({latitude:g,longitude:A,zoom:q});return(await x.getRawTile(re)).map(se=>{const ce=U+se[256*N+Z]*V;return ce===S||isNaN(ce)||ce===1/0?NaN:ce})}})})(du,du.exports);var yu=du.exports;const Wo=za(0),dp=Hd(Wo,L=>L>0),fp={overlayOpacity:.4,activeLayer:"exposure",lightningPeriod:"year",windPeriod:"year",windMetric:"moderate"},on=za(fp);function gp(L){on.update(p=>({...p,overlayOpacity:L}))}function pp(L){on.update(p=>({...p,activeLayer:L}))}function mp(L){on.update(p=>({...p,lightningPeriod:L}))}function yp(L){on.update(p=>({...p,windPeriod:L}))}function sd(L){on.update(p=>({...p,windMetric:L}))}const _p=cp,Ip=7,bp=[{color:[255,0,0]},{color:[255,80,0]},{color:[255,140,0]},{color:[255,140,0]},{color:[255,140,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,180,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,220,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[255,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[200,255,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[160,250,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[120,235,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[80,210,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[50,185,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]},{color:[30,160,0]}];function wp(L,p){const y=L>=0?"N":"S",B=p>=0?"E":"W",T=Math.floor(Math.abs(L)/10)*10,J=Math.floor(Math.abs(p)/10)*10;return`${y}${T.toString().padStart(2,"0")}_${B}${J.toString().padStart(3,"0")}`}function vp(L,p){const y=L>=0?"N":"S",B=p>=0?"E":"W";return`${y}${Math.abs(L).toString().padStart(2,"0")}_${B}${Math.abs(p).toString().padStart(3,"0")}`}function xp(L){const p=[],y=Math.floor(L.south),B=Math.floor(L.north),T=Math.floor(L.west),J=Math.floor(L.east);for(let Q=y;Q<=B;Q++)for(let c=T;c<=J;c++){const ne=wp(Q,c),fe=vp(Q,c);p.push({region:ne,tile:fe,key:`${ne}/${fe}`})}return p}function Bp(){return`[${bp.map(p=>{const y=p.color[0].toString(16).padStart(2,"0"),B=p.color[1].toString(16).padStart(2,"0"),T=p.color[2].toString(16).padStart(2,"0");return`"#${y}${B}${T}"`}).join(",")}]`}function Cp(L){const p=Bp();return`cog://${L}#color:${p},1,255`}class Ep{constructor(p){yn(this,"map");yn(this,"loadedTiles",new Set);yn(this,"loadingTiles",new Set);yn(this,"protocolRegistered",!1);this.map=p}async init(){if(!this.protocolRegistered)try{mc.addProtocol("cog",yu.cogProtocol),this.protocolRegistered=!0,console.log("COG protocol registered")}catch(p){console.log("COG protocol already registered or failed:",p)}return!0}boundsToMapBounds(p){return{west:p.getWest(),south:p.getSouth(),east:p.getEast(),north:p.getNorth()}}async loadTile(p){if(this.loadedTiles.has(p.key)||this.loadingTiles.has(p.key))return;this.loadingTiles.add(p.key),Wo.update(J=>J+1);const y=`${_p}/${p.region}/${p.tile}.cog.tif`,B=`cog-${p.key.replace("/","-")}`,T=`cog-layer-${p.key.replace("/","-")}`;try{const J=await fetch(y,{method:"HEAD"});if(J.status===404){this.loadedTiles.add(p.key);return}if(!J.ok)throw new Error(`HTTP ${J.status}`);if(!this.map.getSource(B)){const Q=Cp(y);this.map.addSource(B,{type:"raster",url:Q,tileSize:256});const c=Hn(on);this.map.addLayer({id:T,type:"raster",source:B,paint:{"raster-opacity":c.overlayOpacity,"raster-resampling":"nearest"}}),console.log(`Loaded COG: ${p.key}`)}this.loadedTiles.add(p.key)}catch(J){console.error(`Failed to load COG ${p.key}:`,J)}finally{this.loadingTiles.delete(p.key),Wo.update(J=>Math.max(0,J-1))}}loadVisibleRegions(){if(this.map.getZoom()<Ip){this.hideAllLayers();return}this.showAllLayers();const y=this.boundsToMapBounds(this.map.getBounds()),B=xp(y);for(const T of B)this.loadTile(T)}hideAllLayers(){for(const p of this.loadedTiles){const y=`cog-layer-${p.replace("/","-")}`;this.map.getLayer(y)&&this.map.setLayoutProperty(y,"visibility","none")}}showAllLayers(){for(const p of this.loadedTiles){const y=`cog-layer-${p.replace("/","-")}`;this.map.getLayer(y)&&this.map.setLayoutProperty(y,"visibility","visible")}}onViewportChange(){this.loadVisibleRegions()}updateOpacity(p){for(const y of this.loadedTiles){const B=`cog-layer-${y.replace("/","-")}`;this.map.getLayer(B)&&this.map.setPaintProperty(B,"raster-opacity",p)}}isEnabled(){return!0}destroy(){for(const p of this.loadedTiles){const y=`cog-layer-${p.replace("/","-")}`,B=`cog-${p.replace("/","-")}`;this.map.getLayer(y)&&this.map.removeLayer(y),this.map.getSource(B)&&this.map.removeSource(B)}this.loadedTiles.clear(),this.loadingTiles.clear()}}const Qp=[{id:1,min:0,max:0,level:"Exposed",color:"#FF0000"},{id:2,min:0,max:25,level:"Very Low",color:"#FF7800"},{id:3,min:25,max:50,level:"Low",color:"#FFA000"},{id:4,min:50,max:100,level:"Moderate",color:"#FFD200"},{id:5,min:100,max:150,level:"Good",color:"#FFFF00"},{id:6,min:150,max:200,level:"Very Good",color:"#C8FF00"},{id:7,min:200,max:1/0,level:"Protected",color:"#64DC00"}],Kd=["#004000","#005300","#006600","#007700","#008800","#009900","#00AA00","#00BB00","#00CC00","#00DD00","#00EE00","#22F600","#44FF00","#66FF00","#88FF00","#AAFF00","#CCFF00","#E5FF00","#FFFF00","#FFF000","#FFE000","#FFD000","#FFC000","#FFB000","#FFA000","#FF9000","#FF8000","#FF7000","#FF6000","#FF5000","#FF4000","#FF2000","#FF0000","#EE002A","#DD0055","#CC0080","#BB00AA","#A200D5","#8800FF","#7700FF"],kp={light:"Light",moderate:"Moderate",strong:"Strong",storm:"Storm",storm_detail:"Storm (Detail)",dir_n:"From N",dir_ne:"From NE",dir_e:"From E",dir_se:"From SE",dir_s:"From S",dir_sw:"From SW",dir_w:"From W",dir_nw:"From NW"},Sp={storm:10,storm_detail:2,strong:30,moderate:60,light:60,dir_n:60,dir_ne:60,dir_e:60,dir_se:60,dir_s:60,dir_sw:60,dir_w:60,dir_nw:60},Dp={1:"jan",2:"feb",3:"mar",4:"apr",5:"may",6:"jun",7:"jul",8:"aug",9:"sep",10:"oct",11:"nov",12:"dec",year:"year"},Zd=["#ffffcc","#fff9b0","#fff394","#ffed78","#ffe55c","#ffdd40","#ffd024","#ffc208","#ffb400","#ffa600","#ff9800","#ff8a00","#ff7b00","#ff6c00","#ff5d00","#ff4e00","#ff3a00","#ff2200","#f00000","#e00000","#cc0000","#b80000","#a00010","#8c0028","#780048","#660070","#550090","#4400a8","#3300c0"],fu={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec",year:"Year"},Mp={1:"jan.cog.tif",2:"feb.cog.tif",3:"mar.cog.tif",4:"apr.cog.tif",5:"may.cog.tif",6:"jun.cog.tif",7:"jul.cog.tif",8:"aug.cog.tif",9:"sep.cog.tif",10:"oct.cog.tif",11:"nov.cog.tif",12:"dec.cog.tif",year:"year.cog.tif"},Tp=hp,Gl="lightning-source",aa="lightning-layer";function Pp(){return`[${Kd.map(p=>`"${p}"`).join(",")}]`}function Lp(L){const p=Pp();return`cog://${L}#color:${p},1,200`}class Rp{constructor(p){yn(this,"map");yn(this,"loaded",!1);yn(this,"visible",!1);yn(this,"protocolRegistered",!1);yn(this,"currentPeriod","year");this.map=p}async init(){if(!this.protocolRegistered)try{mc.addProtocol("cog",yu.cogProtocol),this.protocolRegistered=!0}catch{}return!0}async show(){const p=Hn(on);if(this.loaded&&this.currentPeriod!==p.lightningPeriod){await this.setPeriod(p.lightningPeriod);return}if(!this.loaded){await this.loadLayer(p.lightningPeriod);return}this.visible||this.map.getLayer(aa)&&(this.map.setLayoutProperty(aa,"visibility","visible"),this.visible=!0)}hide(){this.visible&&(this.map.getLayer(aa)&&this.map.setLayoutProperty(aa,"visibility","none"),this.visible=!1)}async setPeriod(p){p===this.currentPeriod&&this.loaded||(this.removeLayer(),await this.loadLayer(p))}removeLayer(){this.map.getLayer(aa)&&this.map.removeLayer(aa),this.map.getSource(Gl)&&this.map.removeSource(Gl),this.loaded=!1,this.visible=!1}async loadLayer(p){if(this.loaded)return;Wo.update(T=>T+1);const y=Mp[p],B=`${Tp}/${y}`;try{if(!(await fetch(B,{method:"HEAD"})).ok){console.warn(`Lightning COG not found: ${y}`);return}if(!this.map.getSource(Gl)){const J=Lp(B);this.map.addSource(Gl,{type:"raster",url:J,tileSize:256});const Q=Hn(on);this.map.addLayer({id:aa,type:"raster",source:Gl,paint:{"raster-opacity":Q.overlayOpacity,"raster-resampling":"linear"}}),this.loaded=!0,this.visible=!0,this.currentPeriod=p;const c=()=>{this.map.setLayoutProperty(aa,"visibility","none"),requestAnimationFrame(()=>{this.map.setLayoutProperty(aa,"visibility","visible")})};if(this.map.isSourceLoaded(Gl))c();else{const ne=fe=>{fe.sourceId===Gl&&fe.isSourceLoaded&&(this.map.off("sourcedata",ne),c())};this.map.on("sourcedata",ne)}}}catch(T){console.error("Failed to load lightning COG:",T)}finally{Wo.update(T=>Math.max(0,T-1))}}updateOpacity(p){this.map.getLayer(aa)&&this.map.setPaintProperty(aa,"raster-opacity",p)}isEnabled(){return!0}isVisible(){return this.visible}getCurrentPeriod(){return this.currentPeriod}destroy(){this.removeLayer()}}const Fp=up,Ul="wind-source",oa="wind-layer";function zp(){return`[${Zd.map(p=>`"${p}"`).join(",")}]`}function Gp(L){const p=zp();return`cog://${L}#color:${p},1,255`}function Up(L){switch(L){case"light":return"light_wind";case"moderate":return"moderate_wind";case"strong":return"strong_wind";case"storm":return"storm";case"storm_detail":return"storm_detail";default:return L}}function Np(L,p){const y=Dp[p];return`${Up(L)}_${y}.cog.tif`}class Op{constructor(p){yn(this,"map");yn(this,"loaded",!1);yn(this,"visible",!1);yn(this,"protocolRegistered",!1);yn(this,"currentPeriod","year");yn(this,"currentMetric","storm");this.map=p}async init(){if(!this.protocolRegistered)try{mc.addProtocol("cog",yu.cogProtocol),this.protocolRegistered=!0}catch{}return!0}async show(){const p=Hn(on);if(this.loaded&&(this.currentPeriod!==p.windPeriod||this.currentMetric!==p.windMetric)){await this.setMetricAndPeriod(p.windMetric,p.windPeriod);return}if(!this.loaded){await this.loadLayer(p.windMetric,p.windPeriod);return}this.visible||this.map.getLayer(oa)&&(this.map.setLayoutProperty(oa,"visibility","visible"),this.visible=!0)}hide(){this.visible&&(this.map.getLayer(oa)&&this.map.setLayoutProperty(oa,"visibility","none"),this.visible=!1)}async setPeriod(p){await this.setMetricAndPeriod(this.currentMetric,p)}async setMetric(p){await this.setMetricAndPeriod(p,this.currentPeriod)}async setMetricAndPeriod(p,y){p===this.currentMetric&&y===this.currentPeriod&&this.loaded||(this.removeLayer(),await this.loadLayer(p,y))}removeLayer(){this.map.getLayer(oa)&&this.map.removeLayer(oa),this.map.getSource(Ul)&&this.map.removeSource(Ul),this.loaded=!1,this.visible=!1}async loadLayer(p,y){if(this.loaded)return;Wo.update(J=>J+1);const B=Np(p,y),T=`${Fp}/${B}`;try{if(!(await fetch(T,{method:"HEAD"})).ok){console.warn(`Wind COG not found: ${B}`);return}if(!this.map.getSource(Ul)){const Q=Gp(T);this.map.addSource(Ul,{type:"raster",url:Q,tileSize:256});const c=Hn(on);this.map.addLayer({id:oa,type:"raster",source:Ul,paint:{"raster-opacity":c.overlayOpacity,"raster-resampling":"linear"}}),this.loaded=!0,this.visible=!0,this.currentMetric=p,this.currentPeriod=y;const ne=()=>{this.map.setLayoutProperty(oa,"visibility","none"),requestAnimationFrame(()=>{this.map.setLayoutProperty(oa,"visibility","visible")})};if(this.map.isSourceLoaded(Ul))ne();else{const fe=xe=>{xe.sourceId===Ul&&xe.isSourceLoaded&&(this.map.off("sourcedata",fe),ne())};this.map.on("sourcedata",fe)}}}catch(J){console.error("Failed to load wind COG:",J)}finally{Wo.update(J=>Math.max(0,J-1))}}updateOpacity(p){this.map.getLayer(oa)&&this.map.setPaintProperty(oa,"raster-opacity",p)}isVisible(){return this.visible}getCurrentPeriod(){return this.currentPeriod}getCurrentMetric(){return this.currentMetric}destroy(){this.removeLayer()}}class _s extends Error{constructor(p){var y,B,T,J;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,_s.prototype),p!==null&&typeof p=="object"&&(this.url=typeof p.url=="string"?p.url:"",this.status=typeof p.status=="number"?p.status:0,this.isAbort=!!p.isAbort,this.originalError=p.originalError,p.response!==null&&typeof p.response=="object"?this.response=p.response:p.data!==null&&typeof p.data=="object"?this.response=p.data:this.response={}),this.originalError||p instanceof _s||(this.originalError=p),typeof DOMException<"u"&&p instanceof DOMException&&(p.name=="AbortError"||p.code==20)&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(y=this.response)==null?void 0:y.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(J=(T=(B=this.originalError)==null?void 0:B.cause)==null?void 0:T.message)!=null&&J.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}const dh=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function qp(L,p){const y={};if(typeof L!="string")return y;const B=Object.assign({},{}).decode||Vp;let T=0;for(;T<L.length;){const J=L.indexOf("=",T);if(J===-1)break;let Q=L.indexOf(";",T);if(Q===-1)Q=L.length;else if(Q<J){T=L.lastIndexOf(";",J-1)+1;continue}const c=L.slice(T,J).trim();if(y[c]===void 0){let ne=L.slice(J+1,Q).trim();ne.charCodeAt(0)===34&&(ne=ne.slice(1,-1));try{y[c]=B(ne)}catch{y[c]=ne}}T=Q+1}return y}function ad(L,p,y){const B=Object.assign({},y||{}),T=B.encode||Hp;if(!dh.test(L))throw new TypeError("argument name is invalid");const J=T(p);if(J&&!dh.test(J))throw new TypeError("argument val is invalid");let Q=L+"="+J;if(B.maxAge!=null){const c=B.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");Q+="; Max-Age="+Math.floor(c)}if(B.domain){if(!dh.test(B.domain))throw new TypeError("option domain is invalid");Q+="; Domain="+B.domain}if(B.path){if(!dh.test(B.path))throw new TypeError("option path is invalid");Q+="; Path="+B.path}if(B.expires){if(!function(ne){return Object.prototype.toString.call(ne)==="[object Date]"||ne instanceof Date}(B.expires)||isNaN(B.expires.valueOf()))throw new TypeError("option expires is invalid");Q+="; Expires="+B.expires.toUTCString()}if(B.httpOnly&&(Q+="; HttpOnly"),B.secure&&(Q+="; Secure"),B.priority)switch(typeof B.priority=="string"?B.priority.toLowerCase():B.priority){case"low":Q+="; Priority=Low";break;case"medium":Q+="; Priority=Medium";break;case"high":Q+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(B.sameSite)switch(typeof B.sameSite=="string"?B.sameSite.toLowerCase():B.sameSite){case!0:Q+="; SameSite=Strict";break;case"lax":Q+="; SameSite=Lax";break;case"strict":Q+="; SameSite=Strict";break;case"none":Q+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return Q}function Vp(L){return L.indexOf("%")!==-1?decodeURIComponent(L):L}function Hp(L){return encodeURIComponent(L)}const jp=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let $d;function yc(L){if(L)try{const p=decodeURIComponent($d(L.split(".")[1]).split("").map(function(y){return"%"+("00"+y.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(p)||{}}catch{}return{}}function Wd(L,p=0){let y=yc(L);return!(Object.keys(y).length>0&&(!y.exp||y.exp-p>Date.now()/1e3))}$d=typeof atob!="function"||jp?L=>{let p=String(L).replace(/=+$/,"");if(p.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var y,B,T=0,J=0,Q="";B=p.charAt(J++);~B&&(y=T%4?64*y+B:B,T++%4)?Q+=String.fromCharCode(255&y>>(-2*T&6)):0)B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(B);return Q}:atob;const od="pb_auth";class _u{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!Wd(this.token)}get isSuperuser(){var y,B;let p=yc(this.token);return p.type=="auth"&&(((y=this.record)==null?void 0:y.collectionName)=="_superusers"||!((B=this.record)!=null&&B.collectionName)&&p.collectionId=="pbc_3142635823")}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),yc(this.token).type=="auth"&&!this.isSuperuser}save(p,y){this.baseToken=p||"",this.baseModel=y||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(p,y=od){const B=qp(p||"")[y]||"";let T={};try{T=JSON.parse(B),(typeof T===null||typeof T!="object"||Array.isArray(T))&&(T={})}catch{}this.save(T.token||"",T.record||T.model||null)}exportToCookie(p,y=od){var ne,fe;const B={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},T=yc(this.token);B.expires=T!=null&&T.exp?new Date(1e3*T.exp):new Date("1970-01-01"),p=Object.assign({},B,p);const J={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null};let Q=ad(y,JSON.stringify(J),p);const c=typeof Blob<"u"?new Blob([Q]).size:Q.length;if(J.record&&c>4096){J.record={id:(ne=J.record)==null?void 0:ne.id,email:(fe=J.record)==null?void 0:fe.email};const xe=["collectionId","collectionName","verified"];for(const me in this.record)xe.includes(me)&&(J.record[me]=this.record[me]);Q=ad(y,JSON.stringify(J),p)}return Q}onChange(p,y=!1){return this._onChangeCallbacks.push(p),y&&p(this.token,this.record),()=>{for(let B=this._onChangeCallbacks.length-1;B>=0;B--)if(this._onChangeCallbacks[B]==p)return delete this._onChangeCallbacks[B],void this._onChangeCallbacks.splice(B,1)}}triggerChange(){for(const p of this._onChangeCallbacks)p&&p(this.token,this.record)}}class Jp extends _u{constructor(p="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=p,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){const p=this._storageGet(this.storageKey)||{};return p.record||p.model||null}get model(){return this.record}save(p,y){this._storageSet(this.storageKey,{token:p,record:y}),super.save(p,y)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(p){if(typeof window<"u"&&(window!=null&&window.localStorage)){const y=window.localStorage.getItem(p)||"";try{return JSON.parse(y)}catch{return y}}return this.storageFallback[p]}_storageSet(p,y){if(typeof window<"u"&&(window!=null&&window.localStorage)){let B=y;typeof y!="string"&&(B=JSON.stringify(y)),window.localStorage.setItem(p,B)}else this.storageFallback[p]=y}_storageRemove(p){var y;typeof window<"u"&&(window!=null&&window.localStorage)&&((y=window.localStorage)==null||y.removeItem(p)),delete this.storageFallback[p]}_bindStorageEvent(){typeof window<"u"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",p=>{if(p.key!=this.storageKey)return;const y=this._storageGet(this.storageKey)||{};super.save(y.token||"",y.record||y.model||null)})}}class lo{constructor(p){this.client=p}}class Yp extends lo{async getAll(p){return p=Object.assign({method:"GET"},p),this.client.send("/api/settings",p)}async update(p,y){return y=Object.assign({method:"PATCH",body:p},y),this.client.send("/api/settings",y)}async testS3(p="storage",y){return y=Object.assign({method:"POST",body:{filesystem:p}},y),this.client.send("/api/settings/test/s3",y).then(()=>!0)}async testEmail(p,y,B,T){return T=Object.assign({method:"POST",body:{email:y,template:B,collection:p}},T),this.client.send("/api/settings/test/email",T).then(()=>!0)}async generateAppleClientSecret(p,y,B,T,J,Q){return Q=Object.assign({method:"POST",body:{clientId:p,teamId:y,keyId:B,privateKey:T,duration:J}},Q),this.client.send("/api/settings/apple/generate-client-secret",Q)}}const Kp=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function Iu(L){if(L){L.query=L.query||{};for(let p in L)Kp.includes(p)||(L.query[p]=L[p],delete L[p])}}function Xd(L){const p=[];for(const y in L){const B=encodeURIComponent(y),T=Array.isArray(L[y])?L[y]:[L[y]];for(let J of T)J=Zp(J),J!==null&&p.push(B+"="+J)}return p.join("&")}function Zp(L){return L==null?null:L instanceof Date?encodeURIComponent(L.toISOString().replace("T"," ")):encodeURIComponent(typeof L=="object"?JSON.stringify(L):L)}class ef extends lo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(p,y,B){var Q;if(!p)throw new Error("topic must be set.");let T=p;if(B){Iu(B=Object.assign({},B));const c="options="+encodeURIComponent(JSON.stringify({query:B.query,headers:B.headers}));T+=(T.includes("?")?"&":"?")+c}const J=function(c){const ne=c;let fe;try{fe=JSON.parse(ne==null?void 0:ne.data)}catch{}y(fe||{})};return this.subscriptions[T]||(this.subscriptions[T]=[]),this.subscriptions[T].push(J),this.isConnected?this.subscriptions[T].length===1?await this.submitSubscriptions():(Q=this.eventSource)==null||Q.addEventListener(T,J):await this.connect(),async()=>this.unsubscribeByTopicAndListener(p,J)}async unsubscribe(p){var B;let y=!1;if(p){const T=this.getSubscriptionsByTopic(p);for(let J in T)if(this.hasSubscriptionListeners(J)){for(let Q of this.subscriptions[J])(B=this.eventSource)==null||B.removeEventListener(J,Q);delete this.subscriptions[J],y||(y=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?y&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(p){var B;let y=!1;for(let T in this.subscriptions)if((T+"?").startsWith(p)){y=!0;for(let J of this.subscriptions[T])(B=this.eventSource)==null||B.removeEventListener(T,J);delete this.subscriptions[T]}y&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(p,y){var J;let B=!1;const T=this.getSubscriptionsByTopic(p);for(let Q in T){if(!Array.isArray(this.subscriptions[Q])||!this.subscriptions[Q].length)continue;let c=!1;for(let ne=this.subscriptions[Q].length-1;ne>=0;ne--)this.subscriptions[Q][ne]===y&&(c=!0,delete this.subscriptions[Q][ne],this.subscriptions[Q].splice(ne,1),(J=this.eventSource)==null||J.removeEventListener(Q,y));c&&(this.subscriptions[Q].length||delete this.subscriptions[Q],B||this.hasSubscriptionListeners(Q)||(B=!0))}this.hasSubscriptionListeners()?B&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(p){var y,B;if(this.subscriptions=this.subscriptions||{},p)return!!((y=this.subscriptions[p])!=null&&y.length);for(let T in this.subscriptions)if((B=this.subscriptions[T])!=null&&B.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(p=>{if(!(p!=null&&p.isAbort))throw p})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(p){const y={};p=p.includes("?")?p:p+"?";for(let B in this.subscriptions)(B+"?").startsWith(p)&&(y[B]=this.subscriptions[B]);return y}getNonEmptySubscriptionKeys(){const p=[];for(let y in this.subscriptions)this.subscriptions[y].length&&p.push(y);return p}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let p in this.subscriptions)for(let y of this.subscriptions[p])this.eventSource.addEventListener(p,y)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let p in this.subscriptions)for(let y of this.subscriptions[p])this.eventSource.removeEventListener(p,y)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((p,y)=>{this.pendingConnects.push({resolve:p,reject:y}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=p=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",p=>{const y=p;this.clientId=y==null?void 0:y.lastEventId,this.submitSubscriptions().then(async()=>{let B=3;for(;this.hasUnsentSubscriptions()&&B>0;)B--,await this.submitSubscriptions()}).then(()=>{for(let T of this.pendingConnects)T.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const B=this.getSubscriptionsByTopic("PB_CONNECT");for(let T in B)for(let J of B[T])J(p)}).catch(B=>{this.clientId="",this.connectErrorHandler(B)})})}hasUnsentSubscriptions(){const p=this.getNonEmptySubscriptionKeys();if(p.length!=this.lastSentSubscriptions.length)return!0;for(const y of p)if(!this.lastSentSubscriptions.includes(y))return!0;return!1}connectErrorHandler(p){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let B of this.pendingConnects)B.reject(new _s(p));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const y=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},y)}disconnect(p=!1){var y;if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(y=this.eventSource)==null||y.close(),this.eventSource=null,this.clientId="",!p){this.reconnectAttempts=0;for(let B of this.pendingConnects)B.resolve();this.pendingConnects=[]}}}class tf extends lo{decode(p){return p}async getFullList(p,y){if(typeof p=="number")return this._getFullList(p,y);let B=500;return(y=Object.assign({},p,y)).batch&&(B=y.batch,delete y.batch),this._getFullList(B,y)}async getList(p=1,y=30,B){return(B=Object.assign({method:"GET"},B)).query=Object.assign({page:p,perPage:y},B.query),this.client.send(this.baseCrudPath,B).then(T=>{var J;return T.items=((J=T.items)==null?void 0:J.map(Q=>this.decode(Q)))||[],T})}async getFirstListItem(p,y){return(y=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+p},y)).query=Object.assign({filter:p,skipTotal:1},y.query),this.getList(1,1,y).then(B=>{var T;if(!((T=B==null?void 0:B.items)!=null&&T.length))throw new _s({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return B.items[0]})}async getOne(p,y){if(!p)throw new _s({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return y=Object.assign({method:"GET"},y),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(p),y).then(B=>this.decode(B))}async create(p,y){return y=Object.assign({method:"POST",body:p},y),this.client.send(this.baseCrudPath,y).then(B=>this.decode(B))}async update(p,y,B){return B=Object.assign({method:"PATCH",body:y},B),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(p),B).then(T=>this.decode(T))}async delete(p,y){return y=Object.assign({method:"DELETE"},y),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(p),y).then(()=>!0)}_getFullList(p=500,y){(y=y||{}).query=Object.assign({skipTotal:1},y.query);let B=[],T=async J=>this.getList(J,p||500,y).then(Q=>{const c=Q.items;return B=B.concat(c),c.length==Q.perPage?T(J+1):B});return T(1)}}function Zo(L,p,y,B){const T=B!==void 0;return T||y!==void 0?T?(console.warn(L),p.body=Object.assign({},p.body,y),p.query=Object.assign({},p.query,B),p):Object.assign(p,y):p}function au(L){var p;(p=L._resetAutoRefresh)==null||p.call(L)}class $p extends tf{constructor(p,y){super(p),this.collectionIdOrName=y}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName=="_superusers"||this.collectionIdOrName=="_pbc_2773867675"}async subscribe(p,y,B){if(!p)throw new Error("Missing topic.");if(!y)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+p,y,B)}async unsubscribe(p){return p?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+p):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(p,y){if(typeof p=="number")return super.getFullList(p,y);const B=Object.assign({},p,y);return super.getFullList(B)}async getList(p=1,y=30,B){return super.getList(p,y,B)}async getFirstListItem(p,y){return super.getFirstListItem(p,y)}async getOne(p,y){return super.getOne(p,y)}async create(p,y){return super.create(p,y)}async update(p,y,B){return super.update(p,y,B).then(T=>{var J,Q,c;if(((J=this.client.authStore.record)==null?void 0:J.id)===(T==null?void 0:T.id)&&(((Q=this.client.authStore.record)==null?void 0:Q.collectionId)===this.collectionIdOrName||((c=this.client.authStore.record)==null?void 0:c.collectionName)===this.collectionIdOrName)){let ne=Object.assign({},this.client.authStore.record.expand),fe=Object.assign({},this.client.authStore.record,T);ne&&(fe.expand=Object.assign(ne,T.expand)),this.client.authStore.save(this.client.authStore.token,fe)}return T})}async delete(p,y){return super.delete(p,y).then(B=>{var T,J,Q;return!B||((T=this.client.authStore.record)==null?void 0:T.id)!==p||((J=this.client.authStore.record)==null?void 0:J.collectionId)!==this.collectionIdOrName&&((Q=this.client.authStore.record)==null?void 0:Q.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),B})}authResponse(p){const y=this.decode((p==null?void 0:p.record)||{});return this.client.authStore.save(p==null?void 0:p.token,y),Object.assign({},p,{token:(p==null?void 0:p.token)||"",record:y})}async listAuthMethods(p){return p=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},p),this.client.send(this.baseCollectionPath+"/auth-methods",p)}async authWithPassword(p,y,B){let T;B=Object.assign({method:"POST",body:{identity:p,password:y}},B),this.isSuperusers&&(T=B.autoRefreshThreshold,delete B.autoRefreshThreshold,B.autoRefresh||au(this.client));let J=await this.client.send(this.baseCollectionPath+"/auth-with-password",B);return J=this.authResponse(J),T&&this.isSuperusers&&function(c,ne,fe,xe){au(c);const me=c.beforeSend,he=c.authStore.record,Ue=c.authStore.onChange((Ze,nt)=>{(!Ze||(nt==null?void 0:nt.id)!=(he==null?void 0:he.id)||(nt!=null&&nt.collectionId||he!=null&&he.collectionId)&&(nt==null?void 0:nt.collectionId)!=(he==null?void 0:he.collectionId))&&au(c)});c._resetAutoRefresh=function(){Ue(),c.beforeSend=me,delete c._resetAutoRefresh},c.beforeSend=async(Ze,nt)=>{var $e;const it=c.authStore.token;if(($e=nt.query)!=null&&$e.autoRefresh)return me?me(Ze,nt):{url:Ze,sendOptions:nt};let at=c.authStore.isValid;if(at&&Wd(c.authStore.token,ne))try{await fe()}catch{at=!1}at||await xe();const Ye=nt.headers||{};for(let Xe in Ye)if(Xe.toLowerCase()=="authorization"&&it==Ye[Xe]&&c.authStore.token){Ye[Xe]=c.authStore.token;break}return nt.headers=Ye,me?me(Ze,nt):{url:Ze,sendOptions:nt}}}(this.client,T,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(p,y,Object.assign({autoRefresh:!0},B))),J}async authWithOAuth2Code(p,y,B,T,J,Q,c){let ne={method:"POST",body:{provider:p,code:y,codeVerifier:B,redirectURL:T,createData:J}};return ne=Zo("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",ne,Q,c),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",ne).then(fe=>this.authResponse(fe))}authWithOAuth2(...p){if(p.length>1||typeof(p==null?void 0:p[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((p==null?void 0:p[0])||"",(p==null?void 0:p[1])||"",(p==null?void 0:p[2])||"",(p==null?void 0:p[3])||"",(p==null?void 0:p[4])||{},(p==null?void 0:p[5])||{},(p==null?void 0:p[6])||{});const y=(p==null?void 0:p[0])||{};let B=null;y.urlCallback||(B=ld(void 0));const T=new ef(this.client);function J(){B==null||B.close(),T.unsubscribe()}const Q={},c=y.requestKey;return c&&(Q.requestKey=c),this.listAuthMethods(Q).then(ne=>{var he;const fe=ne.oauth2.providers.find(Ue=>Ue.name===y.provider);if(!fe)throw new _s(new Error(`Missing or invalid provider "${y.provider}".`));const xe=this.client.buildURL("/api/oauth2-redirect"),me=c?(he=this.client.cancelControllers)==null?void 0:he[c]:void 0;return me&&(me.signal.onabort=()=>{J()}),new Promise(async(Ue,Ze)=>{var nt;try{await T.subscribe("@oauth2",async $e=>{var lt;const Xe=T.clientId;try{if(!$e.state||Xe!==$e.state)throw new Error("State parameters don't match.");if($e.error||!$e.code)throw new Error("OAuth2 redirect error or missing code: "+$e.error);const Bt=Object.assign({},y);delete Bt.provider,delete Bt.scopes,delete Bt.createData,delete Bt.urlCallback,(lt=me==null?void 0:me.signal)!=null&&lt.onabort&&(me.signal.onabort=null);const yt=await this.authWithOAuth2Code(fe.name,$e.code,fe.codeVerifier,xe,y.createData,Bt);Ue(yt)}catch(Bt){Ze(new _s(Bt))}J()});const it={state:T.clientId};(nt=y.scopes)!=null&&nt.length&&(it.scope=y.scopes.join(" "));const at=this._replaceQueryParams(fe.authURL+xe,it);await(y.urlCallback||function($e){B?B.location.href=$e:B=ld($e)})(at)}catch(it){J(),Ze(new _s(it))}})}).catch(ne=>{throw J(),ne})}async authRefresh(p,y){let B={method:"POST"};return B=Zo("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",B,p,y),this.client.send(this.baseCollectionPath+"/auth-refresh",B).then(T=>this.authResponse(T))}async requestPasswordReset(p,y,B){let T={method:"POST",body:{email:p}};return T=Zo("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",T,y,B),this.client.send(this.baseCollectionPath+"/request-password-reset",T).then(()=>!0)}async confirmPasswordReset(p,y,B,T,J){let Q={method:"POST",body:{token:p,password:y,passwordConfirm:B}};return Q=Zo("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",Q,T,J),this.client.send(this.baseCollectionPath+"/confirm-password-reset",Q).then(()=>!0)}async requestVerification(p,y,B){let T={method:"POST",body:{email:p}};return T=Zo("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",T,y,B),this.client.send(this.baseCollectionPath+"/request-verification",T).then(()=>!0)}async confirmVerification(p,y,B){let T={method:"POST",body:{token:p}};return T=Zo("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",T,y,B),this.client.send(this.baseCollectionPath+"/confirm-verification",T).then(()=>{const J=yc(p),Q=this.client.authStore.record;return Q&&!Q.verified&&Q.id===J.id&&Q.collectionId===J.collectionId&&(Q.verified=!0,this.client.authStore.save(this.client.authStore.token,Q)),!0})}async requestEmailChange(p,y,B){let T={method:"POST",body:{newEmail:p}};return T=Zo("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",T,y,B),this.client.send(this.baseCollectionPath+"/request-email-change",T).then(()=>!0)}async confirmEmailChange(p,y,B,T){let J={method:"POST",body:{token:p,password:y}};return J=Zo("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",J,B,T),this.client.send(this.baseCollectionPath+"/confirm-email-change",J).then(()=>{const Q=yc(p),c=this.client.authStore.record;return c&&c.id===Q.id&&c.collectionId===Q.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(p,y){return this.client.collection("_externalAuths").getFullList(Object.assign({},y,{filter:this.client.filter("recordRef = {:id}",{id:p})}))}async unlinkExternalAuth(p,y,B){const T=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:p,provider:y}));return this.client.collection("_externalAuths").delete(T.id,B).then(()=>!0)}async requestOTP(p,y){return y=Object.assign({method:"POST",body:{email:p}},y),this.client.send(this.baseCollectionPath+"/request-otp",y)}async authWithOTP(p,y,B){return B=Object.assign({method:"POST",body:{otpId:p,password:y}},B),this.client.send(this.baseCollectionPath+"/auth-with-otp",B).then(T=>this.authResponse(T))}async impersonate(p,y,B){(B=Object.assign({method:"POST",body:{duration:y}},B)).headers=B.headers||{},B.headers.Authorization||(B.headers.Authorization=this.client.authStore.token);const T=new rf(this.client.baseURL,new _u,this.client.lang),J=await T.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(p),B);return T.authStore.save(J==null?void 0:J.token,this.decode((J==null?void 0:J.record)||{})),T}_replaceQueryParams(p,y={}){let B=p,T="";p.indexOf("?")>=0&&(B=p.substring(0,p.indexOf("?")),T=p.substring(p.indexOf("?")+1));const J={},Q=T.split("&");for(const c of Q){if(c=="")continue;const ne=c.split("=");J[decodeURIComponent(ne[0].replace(/\+/g," "))]=decodeURIComponent((ne[1]||"").replace(/\+/g," "))}for(let c in y)y.hasOwnProperty(c)&&(y[c]==null?delete J[c]:J[c]=y[c]);T="";for(let c in J)J.hasOwnProperty(c)&&(T!=""&&(T+="&"),T+=encodeURIComponent(c.replace(/%20/g,"+"))+"="+encodeURIComponent(J[c].replace(/%20/g,"+")));return T!=""?B+"?"+T:B}}function ld(L){if(typeof window>"u"||!(window!=null&&window.open))throw new _s(new Error("Not in a browser context - please pass a custom urlCallback function."));let p=1024,y=768,B=window.innerWidth,T=window.innerHeight;p=p>B?B:p,y=y>T?T:y;let J=B/2-p/2,Q=T/2-y/2;return window.open(L,"popup_window","width="+p+",height="+y+",top="+Q+",left="+J+",resizable,menubar=no")}class Wp extends tf{get baseCrudPath(){return"/api/collections"}async import(p,y=!1,B){return B=Object.assign({method:"PUT",body:{collections:p,deleteMissing:y}},B),this.client.send(this.baseCrudPath+"/import",B).then(()=>!0)}async getScaffolds(p){return p=Object.assign({method:"GET"},p),this.client.send(this.baseCrudPath+"/meta/scaffolds",p)}async truncate(p,y){return y=Object.assign({method:"DELETE"},y),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(p)+"/truncate",y).then(()=>!0)}}class Xp extends lo{async getList(p=1,y=30,B){return(B=Object.assign({method:"GET"},B)).query=Object.assign({page:p,perPage:y},B.query),this.client.send("/api/logs",B)}async getOne(p,y){if(!p)throw new _s({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return y=Object.assign({method:"GET"},y),this.client.send("/api/logs/"+encodeURIComponent(p),y)}async getStats(p){return p=Object.assign({method:"GET"},p),this.client.send("/api/logs/stats",p)}}class em extends lo{async check(p){return p=Object.assign({method:"GET"},p),this.client.send("/api/health",p)}}class tm extends lo{getUrl(p,y,B={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(p,y,B)}getURL(p,y,B={}){if(!y||!(p!=null&&p.id)||!(p!=null&&p.collectionId)&&!(p!=null&&p.collectionName))return"";const T=[];T.push("api"),T.push("files"),T.push(encodeURIComponent(p.collectionId||p.collectionName)),T.push(encodeURIComponent(p.id)),T.push(encodeURIComponent(y));let J=this.client.buildURL(T.join("/"));if(Object.keys(B).length){B.download===!1&&delete B.download;const Q=new URLSearchParams(B);J+=(J.includes("?")?"&":"?")+Q}return J}async getToken(p){return p=Object.assign({method:"POST"},p),this.client.send("/api/files/token",p).then(y=>(y==null?void 0:y.token)||"")}}class im extends lo{async getFullList(p){return p=Object.assign({method:"GET"},p),this.client.send("/api/backups",p)}async create(p,y){return y=Object.assign({method:"POST",body:{name:p}},y),this.client.send("/api/backups",y).then(()=>!0)}async upload(p,y){return y=Object.assign({method:"POST",body:p},y),this.client.send("/api/backups/upload",y).then(()=>!0)}async delete(p,y){return y=Object.assign({method:"DELETE"},y),this.client.send(`/api/backups/${encodeURIComponent(p)}`,y).then(()=>!0)}async restore(p,y){return y=Object.assign({method:"POST"},y),this.client.send(`/api/backups/${encodeURIComponent(p)}/restore`,y).then(()=>!0)}getDownloadUrl(p,y){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(p,y)}getDownloadURL(p,y){return this.client.buildURL(`/api/backups/${encodeURIComponent(y)}?token=${encodeURIComponent(p)}`)}}class rm extends lo{async getFullList(p){return p=Object.assign({method:"GET"},p),this.client.send("/api/crons",p)}async run(p,y){return y=Object.assign({method:"POST"},y),this.client.send(`/api/crons/${encodeURIComponent(p)}`,y).then(()=>!0)}}function gu(L){return typeof Blob<"u"&&L instanceof Blob||typeof File<"u"&&L instanceof File||L!==null&&typeof L=="object"&&L.uri&&(typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal)}function pu(L){var p;return L&&(((p=L.constructor)==null?void 0:p.name)==="FormData"||typeof FormData<"u"&&L instanceof FormData)}function cd(L){for(const p in L){const y=Array.isArray(L[p])?L[p]:[L[p]];for(const B of y)if(gu(B))return!0}return!1}const nm=/^[\-\.\d]+$/;function hd(L){if(typeof L!="string")return L;if(L=="true")return!0;if(L=="false")return!1;if((L[0]==="-"||L[0]>="0"&&L[0]<="9")&&nm.test(L)){let p=+L;if(""+p===L)return p}return L}class sm extends lo{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(p){return this.subs[p]||(this.subs[p]=new am(this.requests,p)),this.subs[p]}async send(p){const y=new FormData,B=[];for(let T=0;T<this.requests.length;T++){const J=this.requests[T];if(B.push({method:J.method,url:J.url,headers:J.headers,body:J.json}),J.files)for(let Q in J.files){const c=J.files[Q]||[];for(let ne of c)y.append("requests."+T+"."+Q,ne)}}return y.append("@jsonPayload",JSON.stringify({requests:B})),p=Object.assign({method:"POST",body:y},p),this.client.send("/api/batch",p)}}class am{constructor(p,y){this.requests=[],this.requests=p,this.collectionIdOrName=y}upsert(p,y){y=Object.assign({body:p||{}},y);const B={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(B,y),this.requests.push(B)}create(p,y){y=Object.assign({body:p||{}},y);const B={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(B,y),this.requests.push(B)}update(p,y,B){B=Object.assign({body:y||{}},B);const T={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(p)};this.prepareRequest(T,B),this.requests.push(T)}delete(p,y){y=Object.assign({},y);const B={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(p)};this.prepareRequest(B,y),this.requests.push(B)}prepareRequest(p,y){if(Iu(y),p.headers=y.headers,p.json={},p.files={},y.query!==void 0){const T=Xd(y.query);T&&(p.url+=(p.url.includes("?")?"&":"?")+T)}let B=y.body;pu(B)&&(B=function(J){let Q={};return J.forEach((c,ne)=>{if(ne==="@jsonPayload"&&typeof c=="string")try{let fe=JSON.parse(c);Object.assign(Q,fe)}catch(fe){console.warn("@jsonPayload error:",fe)}else Q[ne]!==void 0?(Array.isArray(Q[ne])||(Q[ne]=[Q[ne]]),Q[ne].push(hd(c))):Q[ne]=hd(c)}),Q}(B));for(const T in B){const J=B[T];if(gu(J))p.files[T]=p.files[T]||[],p.files[T].push(J);else if(Array.isArray(J)){const Q=[],c=[];for(const ne of J)gu(ne)?Q.push(ne):c.push(ne);if(Q.length>0&&Q.length==J.length){p.files[T]=p.files[T]||[];for(let ne of Q)p.files[T].push(ne)}else if(p.json[T]=c,Q.length>0){let ne=T;T.startsWith("+")||T.endsWith("+")||(ne+="+"),p.files[ne]=p.files[ne]||[];for(let fe of Q)p.files[ne].push(fe)}}else p.json[T]=J}}}class rf{get baseUrl(){return this.baseURL}set baseUrl(p){this.baseURL=p}constructor(p="/",y,B="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=p,this.lang=B,y?this.authStore=y:typeof window<"u"&&window.Deno?this.authStore=new _u:this.authStore=new Jp,this.collections=new Wp(this),this.files=new tm(this),this.logs=new Xp(this),this.settings=new Yp(this),this.realtime=new ef(this),this.health=new em(this),this.backups=new im(this),this.crons=new rm(this)}get admins(){return this.collection("_superusers")}createBatch(){return new sm(this)}collection(p){return this.recordServices[p]||(this.recordServices[p]=new $p(this,p)),this.recordServices[p]}autoCancellation(p){return this.enableAutoCancellation=!!p,this}cancelRequest(p){return this.cancelControllers[p]&&(this.cancelControllers[p].abort(),delete this.cancelControllers[p]),this}cancelAllRequests(){for(let p in this.cancelControllers)this.cancelControllers[p].abort();return this.cancelControllers={},this}filter(p,y){if(!y)return p;for(let B in y){let T=y[B];switch(typeof T){case"boolean":case"number":T=""+T;break;case"string":T="'"+T.replace(/'/g,"\\'")+"'";break;default:T=T===null?"null":T instanceof Date?"'"+T.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(T).replace(/'/g,"\\'")+"'"}p=p.replaceAll("{:"+B+"}",T)}return p}getFileUrl(p,y,B={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(p,y,B)}buildUrl(p){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(p)}buildURL(p){var B;let y=this.baseURL;return typeof window>"u"||!window.location||y.startsWith("https://")||y.startsWith("http://")||(y=(B=window.location.origin)!=null&&B.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseURL.startsWith("/")||(y+=window.location.pathname||"/",y+=y.endsWith("/")?"":"/"),y+=this.baseURL),p&&(y+=y.endsWith("/")?"":"/",y+=p.startsWith("/")?p.substring(1):p),y}async send(p,y){y=this.initSendOptions(p,y);let B=this.buildURL(p);if(this.beforeSend){const T=Object.assign({},await this.beforeSend(B,y));T.url!==void 0||T.options!==void 0?(B=T.url||B,y=T.options||y):Object.keys(T).length&&(y=T,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(y.query!==void 0){const T=Xd(y.query);T&&(B+=(B.includes("?")?"&":"?")+T),delete y.query}return this.getHeader(y.headers,"Content-Type")=="application/json"&&y.body&&typeof y.body!="string"&&(y.body=JSON.stringify(y.body)),(y.fetch||fetch)(B,y).then(async T=>{var Q;let J={};try{J=await T.json()}catch(c){if((Q=y.signal)!=null&&Q.aborted||typeof DOMException<"u"&&c instanceof DOMException&&(c.name=="AbortError"||c.code==20))throw c}if(this.afterSend&&(J=await this.afterSend(T,J,y)),T.status>=400)throw new _s({url:T.url,status:T.status,data:J});return J}).catch(T=>{throw new _s(T)})}initSendOptions(p,y){if((y=Object.assign({method:"GET"},y)).body=function(T){if(typeof FormData>"u"||T===void 0||typeof T!="object"||T===null||pu(T)||!cd(T))return T;const J=new FormData;for(const Q in T){const c=T[Q];if(c!==void 0)if(typeof c!="object"||cd({data:c})){const ne=Array.isArray(c)?c:[c];for(let fe of ne)J.append(Q,fe)}else{let ne={};ne[Q]=c,J.append("@jsonPayload",JSON.stringify(ne))}}return J}(y.body),Iu(y),y.query=Object.assign({},y.params,y.query),y.requestKey===void 0&&(y.$autoCancel===!1||y.query.$autoCancel===!1?y.requestKey=null:(y.$cancelKey||y.query.$cancelKey)&&(y.requestKey=y.$cancelKey||y.query.$cancelKey)),delete y.$autoCancel,delete y.query.$autoCancel,delete y.$cancelKey,delete y.query.$cancelKey,this.getHeader(y.headers,"Content-Type")!==null||pu(y.body)||(y.headers=Object.assign({},y.headers,{"Content-Type":"application/json"})),this.getHeader(y.headers,"Accept-Language")===null&&(y.headers=Object.assign({},y.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(y.headers,"Authorization")===null&&(y.headers=Object.assign({},y.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&y.requestKey!==null){const B=y.requestKey||(y.method||"GET")+p;delete y.requestKey,this.cancelRequest(B);const T=new AbortController;this.cancelControllers[B]=T,y.signal=T.signal}return y}getHeader(p,y){p=p||{},y=y.toLowerCase();for(let B in p)if(B.toLowerCase()==y)return p[B];return null}}const Vr=new rf(Ap),Nl=za(Vr.authStore.record),om=za(!0);async function lm(){if(Vr.authStore.onChange((L,p)=>{Nl.set(p)}),Vr.authStore.token)if(!Vr.authStore.isValid)Vr.authStore.clear();else try{await Vr.collection("users").authRefresh()}catch{Vr.authStore.clear()}Nl.set(Vr.authStore.record),om.set(!1)}async function nf(L,p){return(await Vr.collection("users").authWithPassword(L,p)).record}async function cm(L,p,y){const B=await Vr.collection("users").create({email:L,password:p,passwordConfirm:y});return await nf(L,p),B}function hm(){Vr.authStore.clear()}async function um(L){return(await Vr.collection("users").authWithOAuth2({provider:L})).record}const fh=[{id:"corfu",name:"Corfu, Greece",center:{lng:19.92,lat:39.62},radiusKm:100},{id:"tortola",name:"Tortola, BVI",center:{lng:-64.62,lat:18.43},radiusKm:100},{id:"whitsundays",name:"Whitsunday Islands, Australia",center:{lng:148.95,lat:-20.08},radiusKm:100}],ud={Europe:"corfu",Africa:"corfu",America:"tortola",Australia:"whitsundays",Pacific:"whitsundays"},Ad={"Asia/Auckland":"whitsundays"},Am="corfu",qc=7,dm=6e4;function fm(){try{const L=Intl.DateTimeFormat().resolvedOptions().timeZone||"";if(Ad[L]){const y=fh.find(B=>B.id===Ad[L]);if(y)return y}const p=L.split("/")[0];if(p&&ud[p]){const y=fh.find(B=>B.id===ud[p]);if(y)return y}}catch{}return fh.find(L=>L.id===Am)||fh[0]}function sf(L,p,y,B){const J=(B-p)*Math.PI/180,Q=(y-L)*Math.PI/180,c=Math.sin(J/2)*Math.sin(J/2)+Math.cos(p*Math.PI/180)*Math.cos(B*Math.PI/180)*Math.sin(Q/2)*Math.sin(Q/2);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}const Hc=za(fm()),Vc=za(!1),ph=za(10),dd=za(0),gc=za(!1),mu=za(!1);Hd([ph,Vc],([L,p])=>L>=qc&&!p);function ou(L,p){const y=Hn(Hc);return sf(y.center.lng,y.center.lat,L,p)<=y.radiusKm}function gm(L,p){const y=Hn(Hc),B=sf(y.center.lng,y.center.lat,L,p);if(B===0)return{lng:y.center.lng,lat:y.center.lat};const T=y.radiusKm/B,J=y.center.lng+(L-y.center.lng)*T,Q=y.center.lat+(p-y.center.lat)*T;return{lng:J,lat:Q}}function lu(){const L=Date.now(),p=Hn(dd);L-p>=dm?(gc.set(!0),dd.set(L)):(mu.set(!0),setTimeout(()=>{mu.set(!1)},3e3))}function gh(L){const p=L==="active"||L==="lifetime";Vc.set(p)}function pm(L){let p;return{c(){p=Je("div"),this.h()},l(y){p=je(y,"DIV",{class:!0}),dt(p).forEach(De),this.h()},h(){ye(p,"class","map-container svelte-17bvpkx")},m(y,B){ot(y,p,B),L[7](p)},p:Li,i:Li,o:Li,d(y){y&&De(p),L[7](null)}}}function mm(L,p,y){let B,T;Hr(L,on,it=>y(5,B=it)),Hr(L,Nl,it=>y(6,T=it));let{mapTilerKey:J}=p,Q,c=null,ne=null,fe=null,xe=null,me=!1;async function he(){if(!T){gh(null);return}try{const it=await Vr.collection("users").getOne(T.id);gh(it.plan_status)}catch{gh(null)}}function Ue(){if(!c||me||Hn(Vc))return;const it=c.getZoom();if(ph.set(it),it<qc)return;const at=c.getCenter();if(!ou(at.lng,at.lat)){me=!0;const Ye=gm(at.lng,at.lat);c.setCenter([Ye.lng,Ye.lat]),lu(),setTimeout(()=>{me=!1},100)}}function Ze(){if(!c||me||Hn(Vc))return;const it=c.getZoom(),at=Hn(ph);if(ph.set(it),at<qc&&it>=qc){const Ye=c.getCenter();if(!ou(Ye.lng,Ye.lat)){me=!0;const $e=Hn(Hc);c.flyTo({center:[$e.center.lng,$e.center.lat],zoom:it}),lu(),setTimeout(()=>{me=!1},500)}}}mh(async()=>{const it=Hn(Hc);c=new mc.Map({container:Q,style:`https://api.maptiler.com/maps/outdoor-v2/style.json?key=${J}`,center:[it.center.lng,it.center.lat],zoom:10}),c.addControl(new mc.NavigationControl,"top-right"),c.addControl(new mc.ScaleControl,"bottom-left"),c.on("move",Ue),c.on("zoom",Ze),c.on("click",at=>{if(Hn(Vc))return;((c==null?void 0:c.getZoom())??0)>=qc&&!ou(at.lngLat.lng,at.lngLat.lat)&&lu()}),c.on("load",async()=>{if(!c)return;y(2,ne=new Ep(c));const at=await ne.init();y(3,fe=new Rp(c)),await fe.init(),y(4,xe=new Op(c)),await xe.init(),at?(console.log("COG overlay enabled"),B.activeLayer==="exposure"&&ne.loadVisibleRegions(),c.on("moveend",()=>{B.activeLayer==="exposure"&&(ne==null||ne.onViewportChange())})):console.log("Shielding overlay disabled (PUBLIC_SHIELDING_COG_BASE_URL not set)")})}),qd(()=>{ne==null||ne.destroy(),fe==null||fe.destroy(),xe==null||xe.destroy(),c==null||c.remove()});function nt(it){cu[it?"unshift":"push"](()=>{Q=it,y(0,Q)})}return L.$$set=it=>{"mapTilerKey"in it&&y(1,J=it.mapTilerKey)},L.$$.update=()=>{L.$$.dirty&60&&B.overlayOpacity!==void 0&&(ne==null||ne.updateOpacity(B.overlayOpacity),fe==null||fe.updateOpacity(B.overlayOpacity),xe==null||xe.updateOpacity(B.overlayOpacity)),L.$$.dirty&60&&ne&&fe&&xe&&(B.activeLayer==="exposure"?(fe.hide(),xe.hide(),ne.loadVisibleRegions()):B.activeLayer==="activity"?(ne.hideAllLayers(),xe.hide(),fe.show()):B.activeLayer==="wind"&&(ne.hideAllLayers(),fe.hide(),xe.show())),L.$$.dirty&40&&fe&&B.activeLayer==="activity"&&fe.setPeriod(B.lightningPeriod),L.$$.dirty&48&&xe&&B.activeLayer==="wind"&&xe.setMetricAndPeriod(B.windMetric,B.windPeriod),L.$$.dirty&64&&(T?he():gh(null))},[Q,J,ne,fe,xe,B,T,nt]}let ym=class extends Jn{constructor(p){super(),Yn(this,p,mm,pm,jn,{mapTilerKey:1})}};function _m(L){let p;return{c(){p=Ci("Exposure")},l(y){p=Bi(y,"Exposure")},m(y,B){ot(y,p,B)},p:Li,d(y){y&&De(p)}}}function Im(L){let p;return{c(){p=Ci(L[2])},l(y){p=Bi(y,L[2])},m(y,B){ot(y,p,B)},p(y,B){B&4&&Ir(p,y[2])},d(y){y&&De(p)}}}function bm(L){let p;return{c(){p=Ci(L[3])},l(y){p=Bi(y,L[3])},m(y,B){ot(y,p,B)},p(y,B){B&8&&Ir(p,y[3])},d(y){y&&De(p)}}}function wm(L){let p,y,B,T="<span>Protected</span> <span>Exposed</span>";return{c(){p=Je("div"),y=wt(),B=Je("div"),B.innerHTML=T,this.h()},l(J){p=je(J,"DIV",{class:!0,style:!0}),dt(p).forEach(De),y=bt(J),B=je(J,"DIV",{class:!0,"data-svelte-h":!0}),ti(B)!=="svelte-1x1do4p"&&(B.innerHTML=T),this.h()},h(){ye(p,"class","gradient-bar svelte-1imlov9"),yh(p,"background",L[5]),ye(B,"class","gradient-labels svelte-1imlov9")},m(J,Q){ot(J,p,Q),ot(J,y,Q),ot(J,B,Q)},p:Li,d(J){J&&(De(p),De(y),De(B))}}}function vm(L){let p,y,B,T,J="0%",Q,c,ne,fe;return{c(){p=Je("div"),y=wt(),B=Je("div"),T=Je("span"),T.textContent=J,Q=wt(),c=Je("span"),ne=Ci(L[1]),fe=Ci("%"),this.h()},l(xe){p=je(xe,"DIV",{class:!0,style:!0}),dt(p).forEach(De),y=bt(xe),B=je(xe,"DIV",{class:!0});var me=dt(B);T=je(me,"SPAN",{"data-svelte-h":!0}),ti(T)!=="svelte-zm8889"&&(T.textContent=J),Q=bt(me),c=je(me,"SPAN",{});var he=dt(c);ne=Bi(he,L[1]),fe=Bi(he,"%"),he.forEach(De),me.forEach(De),this.h()},h(){ye(p,"class","gradient-bar svelte-1imlov9"),yh(p,"background",L[6]),ye(B,"class","gradient-labels svelte-1imlov9")},m(xe,me){ot(xe,p,me),ot(xe,y,me),ot(xe,B,me),Te(B,T),Te(B,Q),Te(B,c),Te(c,ne),Te(c,fe)},p(xe,me){me&2&&Ir(ne,xe[1])},d(xe){xe&&(De(p),De(y),De(B))}}}function xm(L){let p,y,B,T="<span>Low</span> <span>High</span>";return{c(){p=Je("div"),y=wt(),B=Je("div"),B.innerHTML=T,this.h()},l(J){p=je(J,"DIV",{class:!0,style:!0}),dt(p).forEach(De),y=bt(J),B=je(J,"DIV",{class:!0,"data-svelte-h":!0}),ti(B)!=="svelte-3tvt5t"&&(B.innerHTML=T),this.h()},h(){ye(p,"class","gradient-bar svelte-1imlov9"),yh(p,"background",L[4]),ye(B,"class","gradient-labels svelte-1imlov9")},m(J,Q){ot(J,p,Q),ot(J,y,Q),ot(J,B,Q)},p:Li,d(J){J&&(De(p),De(y),De(B))}}}function Bm(L){let p,y,B,T;function J(me,he){return me[0].activeLayer==="activity"?bm:me[0].activeLayer==="wind"?Im:_m}let Q=J(L),c=Q(L);function ne(me,he){return me[0].activeLayer==="activity"?xm:me[0].activeLayer==="wind"?vm:wm}let fe=ne(L),xe=fe(L);return{c(){p=Je("div"),y=Je("h3"),c.c(),B=wt(),T=Je("div"),xe.c(),this.h()},l(me){p=je(me,"DIV",{class:!0});var he=dt(p);y=je(he,"H3",{class:!0});var Ue=dt(y);c.l(Ue),Ue.forEach(De),B=bt(he),T=je(he,"DIV",{class:!0});var Ze=dt(T);xe.l(Ze),Ze.forEach(De),he.forEach(De),this.h()},h(){ye(y,"class","svelte-1imlov9"),ye(T,"class","legend-items svelte-1imlov9"),ye(p,"class","legend svelte-1imlov9")},m(me,he){ot(me,p,he),Te(p,y),c.m(y,null),Te(p,B),Te(p,T),xe.m(T,null)},p(me,[he]){Q===(Q=J(me))&&c?c.p(me,he):(c.d(1),c=Q(me),c&&(c.c(),c.m(y,null))),fe===(fe=ne(me))&&xe?xe.p(me,he):(xe.d(1),xe=fe(me),xe&&(xe.c(),xe.m(T,null)))},i:Li,o:Li,d(me){me&&De(p),c.d(),xe.d()}}}function Cm(L,p,y){let B,T,J,Q;Hr(L,on,me=>y(0,Q=me));const c=`linear-gradient(90deg, ${Kd.join(", ")})`,fe=`linear-gradient(90deg, ${[...Qp.map(me=>me.color)].reverse().join(", ")})`,xe=`linear-gradient(90deg, ${Zd.join(", ")})`;return L.$$.update=()=>{L.$$.dirty&1&&y(3,B=Q.lightningPeriod==="year"?"Activity (Annual)":`Activity (${fu[Q.lightningPeriod]})`),L.$$.dirty&1&&y(2,T=`Wind: ${kp[Q.windMetric]}`),L.$$.dirty&1&&y(1,J=Sp[Q.windMetric])},[Q,J,T,B,c,fe,xe]}class Em extends Jn{constructor(p){super(),Yn(this,p,Cm,Bm,jn,{})}}function fd(L){let p,y,B,T,J,Q,c;return{c(){p=Je("div"),y=Je("div"),B=wt(),T=Je("span"),J=Ci("Loading... ("),Q=Ci(L[1]),c=Ci(" pending)"),this.h()},l(ne){p=je(ne,"DIV",{class:!0});var fe=dt(p);y=je(fe,"DIV",{class:!0}),dt(y).forEach(De),B=bt(fe),T=je(fe,"SPAN",{});var xe=dt(T);J=Bi(xe,"Loading... ("),Q=Bi(xe,L[1]),c=Bi(xe," pending)"),xe.forEach(De),fe.forEach(De),this.h()},h(){ye(y,"class","spinner svelte-hal6h8"),ye(p,"class","loading-indicator svelte-hal6h8")},m(ne,fe){ot(ne,p,fe),Te(p,y),Te(p,B),Te(p,T),Te(T,J),Te(T,Q),Te(T,c)},p(ne,fe){fe&2&&Ir(Q,ne[1])},d(ne){ne&&De(p)}}}function Qm(L){let p,y=L[0]&&fd(L);return{c(){y&&y.c(),p=jr()},l(B){y&&y.l(B),p=jr()},m(B,T){y&&y.m(B,T),ot(B,p,T)},p(B,[T]){B[0]?y?y.p(B,T):(y=fd(B),y.c(),y.m(p.parentNode,p)):y&&(y.d(1),y=null)},i:Li,o:Li,d(B){B&&De(p),y&&y.d(B)}}}function km(L,p,y){let B,T;return Hr(L,dp,J=>y(0,B=J)),Hr(L,Wo,J=>y(1,T=J)),[B,T]}class Sm extends Jn{constructor(p){super(),Yn(this,p,km,Qm,jn,{})}}function gd(L){let p,y='<p class="svelte-1k0q185">Adjusts the transparency of the overlay layer, making it easier to see the underlying map details.</p>';return{c(){p=Je("div"),p.innerHTML=y,this.h()},l(B){p=je(B,"DIV",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-kvhtey"&&(p.innerHTML=y),this.h()},h(){ye(p,"class","help-popover svelte-1k0q185")},m(B,T){ot(B,p,T)},d(B){B&&De(p)}}}function Dm(L){let p,y,B="Overlay Opacity",T,J,Q,c,ne,fe=Math.round(L[1].overlayOpacity*100)+"",xe,me,he,Ue,Ze="?",nt,it,at,Ye=L[0]&&gd();return{c(){p=Je("div"),y=Je("label"),y.textContent=B,T=wt(),J=Je("input"),c=wt(),ne=Je("span"),xe=Ci(fe),me=Ci("%"),he=wt(),Ue=Je("button"),Ue.textContent=Ze,nt=wt(),Ye&&Ye.c(),this.h()},l($e){p=je($e,"DIV",{class:!0});var Xe=dt(p);y=je(Xe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ti(y)!=="svelte-2ehpdk"&&(y.textContent=B),T=bt(Xe),J=je(Xe,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),c=bt(Xe),ne=je(Xe,"SPAN",{class:!0});var lt=dt(ne);xe=Bi(lt,fe),me=Bi(lt,"%"),lt.forEach(De),he=bt(Xe),Ue=je(Xe,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),ti(Ue)!=="svelte-1lgoic7"&&(Ue.textContent=Ze),nt=bt(Xe),Ye&&Ye.l(Xe),Xe.forEach(De),this.h()},h(){ye(y,"for","opacity-slider"),ye(y,"class","svelte-1k0q185"),ye(J,"id","opacity-slider"),ye(J,"type","range"),ye(J,"min","0"),ye(J,"max","1"),ye(J,"step","0.1"),J.value=Q=L[1].overlayOpacity,ye(J,"class","svelte-1k0q185"),ye(ne,"class","opacity-value svelte-1k0q185"),ye(Ue,"class","help-btn svelte-1k0q185"),ye(Ue,"title","What is this?"),ye(Ue,"aria-label","Help"),ye(p,"class","opacity-control svelte-1k0q185")},m($e,Xe){ot($e,p,Xe),Te(p,y),Te(p,T),Te(p,J),Te(p,c),Te(p,ne),Te(ne,xe),Te(ne,me),Te(p,he),Te(p,Ue),Te(p,nt),Ye&&Ye.m(p,null),it||(at=[Ti(window,"click",L[4]),Ti(J,"input",L[2]),Ti(Ue,"click",Vd(L[3]))],it=!0)},p($e,[Xe]){Xe&2&&Q!==(Q=$e[1].overlayOpacity)&&(J.value=Q),Xe&2&&fe!==(fe=Math.round($e[1].overlayOpacity*100)+"")&&Ir(xe,fe),$e[0]?Ye||(Ye=gd(),Ye.c(),Ye.m(p,null)):Ye&&(Ye.d(1),Ye=null)},i:Li,o:Li,d($e){$e&&De(p),Ye&&Ye.d(),it=!1,Fa(at)}}}function Mm(L,p,y){let B;Hr(L,on,ne=>y(1,B=ne));let T=!1;function J(ne){const fe=ne.target;gp(parseFloat(fe.value))}function Q(){y(0,T=!T)}function c(ne){ne.target.closest(".opacity-control")||y(0,T=!1)}return[T,B,J,Q,c]}class Tm extends Jn{constructor(p){super(),Yn(this,p,Mm,Dm,jn,{})}}function pd(L){let p,y,B,T="",J,Q,c=L[1]==="login"?"Login":"Create Account",ne,fe,xe,me,he,Ue="Email",Ze,nt,it,at,Ye,$e="Password",Xe,lt,Bt,yt,Pt,Ft,gt,Qt=L[6]?"Please wait...":L[1]==="login"?"Login":"Create Account",Tt,Ot,Yt,Kt='<span class="svelte-16siter">or</span>',li,pt,Vt,si,ci,ai,Ai,lr,Ht,ei,Zt,ri,mi=L[1]==="register"&&md(L),ki=L[5]&&yd(L);function br(Ii,zi){return Ii[1]==="login"?Lm:Pm}let mr=br(L),$i=mr(L);return{c(){p=Je("div"),y=Je("div"),B=Je("button"),B.textContent=T,J=wt(),Q=Je("h2"),ne=Ci(c),fe=wt(),xe=Je("form"),me=Je("div"),he=Je("label"),he.textContent=Ue,Ze=wt(),nt=Je("input"),it=wt(),at=Je("div"),Ye=Je("label"),Ye.textContent=$e,Xe=wt(),lt=Je("input"),yt=wt(),mi&&mi.c(),Pt=wt(),ki&&ki.c(),Ft=wt(),gt=Je("button"),Tt=Ci(Qt),Ot=wt(),Yt=Je("div"),Yt.innerHTML=Kt,li=wt(),pt=Je("button"),Vt=qr("svg"),si=qr("path"),ci=qr("path"),ai=qr("path"),Ai=qr("path"),lr=Ci(`
        Continue with Google`),Ht=wt(),ei=Je("div"),$i.c(),this.h()},l(Ii){p=je(Ii,"DIV",{class:!0,role:!0,"aria-modal":!0});var zi=dt(p);y=je(zi,"DIV",{class:!0});var Xi=dt(y);B=je(Xi,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(B)!=="svelte-1ngpojv"&&(B.textContent=T),J=bt(Xi),Q=je(Xi,"H2",{class:!0});var Ne=dt(Q);ne=Bi(Ne,c),Ne.forEach(De),fe=bt(Xi),xe=je(Xi,"FORM",{});var cr=dt(xe);me=je(cr,"DIV",{class:!0});var Dn=dt(me);he=je(Dn,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ti(he)!=="svelte-1p9d3fm"&&(he.textContent=Ue),Ze=bt(Dn),nt=je(Dn,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),Dn.forEach(De),it=bt(cr),at=je(cr,"DIV",{class:!0});var pi=dt(at);Ye=je(pi,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ti(Ye)!=="svelte-pepa0a"&&(Ye.textContent=$e),Xe=bt(pi),lt=je(pi,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),pi.forEach(De),yt=bt(cr),mi&&mi.l(cr),Pt=bt(cr),ki&&ki.l(cr),Ft=bt(cr),gt=je(cr,"BUTTON",{type:!0,class:!0});var Gi=dt(gt);Tt=Bi(Gi,Qt),Gi.forEach(De),cr.forEach(De),Ot=bt(Xi),Yt=je(Xi,"DIV",{class:!0,"data-svelte-h":!0}),ti(Yt)!=="svelte-aitez0"&&(Yt.innerHTML=Kt),li=bt(Xi),pt=je(Xi,"BUTTON",{class:!0});var Kn=dt(pt);Vt=Or(Kn,"svg",{viewBox:!0,width:!0,height:!0});var wr=dt(Vt);si=Or(wr,"path",{fill:!0,d:!0}),dt(si).forEach(De),ci=Or(wr,"path",{fill:!0,d:!0}),dt(ci).forEach(De),ai=Or(wr,"path",{fill:!0,d:!0}),dt(ai).forEach(De),Ai=Or(wr,"path",{fill:!0,d:!0}),dt(Ai).forEach(De),wr.forEach(De),lr=Bi(Kn,`
        Continue with Google`),Kn.forEach(De),Ht=bt(Xi),ei=je(Xi,"DIV",{class:!0});var Jr=dt(ei);$i.l(Jr),Jr.forEach(De),Xi.forEach(De),zi.forEach(De),this.h()},h(){ye(B,"class","close-btn svelte-16siter"),ye(Q,"class","svelte-16siter"),ye(he,"for","email"),ye(he,"class","svelte-16siter"),ye(nt,"id","email"),ye(nt,"type","email"),nt.required=!0,ye(nt,"autocomplete","email"),ye(nt,"class","svelte-16siter"),ye(me,"class","field svelte-16siter"),ye(Ye,"for","password"),ye(Ye,"class","svelte-16siter"),ye(lt,"id","password"),ye(lt,"type","password"),lt.required=!0,ye(lt,"autocomplete",Bt=L[1]==="login"?"current-password":"new-password"),ye(lt,"class","svelte-16siter"),ye(at,"class","field svelte-16siter"),ye(gt,"type","submit"),ye(gt,"class","submit-btn svelte-16siter"),gt.disabled=L[6],ye(Yt,"class","divider svelte-16siter"),ye(si,"fill","#4285F4"),ye(si,"d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"),ye(ci,"fill","#34A853"),ye(ci,"d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"),ye(ai,"fill","#FBBC05"),ye(ai,"d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"),ye(Ai,"fill","#EA4335"),ye(Ai,"d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"),ye(Vt,"viewBox","0 0 24 24"),ye(Vt,"width","18"),ye(Vt,"height","18"),ye(pt,"class","google-btn svelte-16siter"),pt.disabled=L[6],ye(ei,"class","toggle svelte-16siter"),ye(y,"class","modal svelte-16siter"),ye(p,"class","backdrop svelte-16siter"),ye(p,"role","dialog"),ye(p,"aria-modal","true")},m(Ii,zi){ot(Ii,p,zi),Te(p,y),Te(y,B),Te(y,J),Te(y,Q),Te(Q,ne),Te(y,fe),Te(y,xe),Te(xe,me),Te(me,he),Te(me,Ze),Te(me,nt),pc(nt,L[2]),Te(xe,it),Te(xe,at),Te(at,Ye),Te(at,Xe),Te(at,lt),pc(lt,L[3]),Te(xe,yt),mi&&mi.m(xe,null),Te(xe,Pt),ki&&ki.m(xe,null),Te(xe,Ft),Te(xe,gt),Te(gt,Tt),Te(y,Ot),Te(y,Yt),Te(y,li),Te(y,pt),Te(pt,Vt),Te(Vt,si),Te(Vt,ci),Te(Vt,ai),Te(Vt,Ai),Te(pt,lr),Te(y,Ht),Te(y,ei),$i.m(ei,null),Zt||(ri=[Ti(B,"click",L[11]),Ti(nt,"input",L[12]),Ti(lt,"input",L[13]),Ti(xe,"submit",tp(L[7])),Ti(pt,"click",L[8]),Ti(p,"click",L[10])],Zt=!0)},p(Ii,zi){zi&2&&c!==(c=Ii[1]==="login"?"Login":"Create Account")&&Ir(ne,c),zi&4&&nt.value!==Ii[2]&&pc(nt,Ii[2]),zi&2&&Bt!==(Bt=Ii[1]==="login"?"current-password":"new-password")&&ye(lt,"autocomplete",Bt),zi&8&&lt.value!==Ii[3]&&pc(lt,Ii[3]),Ii[1]==="register"?mi?mi.p(Ii,zi):(mi=md(Ii),mi.c(),mi.m(xe,Pt)):mi&&(mi.d(1),mi=null),Ii[5]?ki?ki.p(Ii,zi):(ki=yd(Ii),ki.c(),ki.m(xe,Ft)):ki&&(ki.d(1),ki=null),zi&66&&Qt!==(Qt=Ii[6]?"Please wait...":Ii[1]==="login"?"Login":"Create Account")&&Ir(Tt,Qt),zi&64&&(gt.disabled=Ii[6]),zi&64&&(pt.disabled=Ii[6]),mr===(mr=br(Ii))&&$i?$i.p(Ii,zi):($i.d(1),$i=mr(Ii),$i&&($i.c(),$i.m(ei,null)))},d(Ii){Ii&&De(p),mi&&mi.d(),ki&&ki.d(),$i.d(),Zt=!1,Fa(ri)}}}function md(L){let p,y,B="Confirm Password",T,J,Q,c;return{c(){p=Je("div"),y=Je("label"),y.textContent=B,T=wt(),J=Je("input"),this.h()},l(ne){p=je(ne,"DIV",{class:!0});var fe=dt(p);y=je(fe,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),ti(y)!=="svelte-1o1itl8"&&(y.textContent=B),T=bt(fe),J=je(fe,"INPUT",{id:!0,type:!0,autocomplete:!0,class:!0}),fe.forEach(De),this.h()},h(){ye(y,"for","passwordConfirm"),ye(y,"class","svelte-16siter"),ye(J,"id","passwordConfirm"),ye(J,"type","password"),J.required=!0,ye(J,"autocomplete","new-password"),ye(J,"class","svelte-16siter"),ye(p,"class","field svelte-16siter")},m(ne,fe){ot(ne,p,fe),Te(p,y),Te(p,T),Te(p,J),pc(J,L[4]),Q||(c=Ti(J,"input",L[14]),Q=!0)},p(ne,fe){fe&16&&J.value!==ne[4]&&pc(J,ne[4])},d(ne){ne&&De(p),Q=!1,c()}}}function yd(L){let p,y;return{c(){p=Je("div"),y=Ci(L[5]),this.h()},l(B){p=je(B,"DIV",{class:!0});var T=dt(p);y=Bi(T,L[5]),T.forEach(De),this.h()},h(){ye(p,"class","error svelte-16siter")},m(B,T){ot(B,p,T),Te(p,y)},p(B,T){T&32&&Ir(y,B[5])},d(B){B&&De(p)}}}function Pm(L){let p,y,B="Login",T,J;return{c(){p=Ci("Already have an account? "),y=Je("button"),y.textContent=B,this.h()},l(Q){p=Bi(Q,"Already have an account? "),y=je(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(y)!=="svelte-1qozt9s"&&(y.textContent=B),this.h()},h(){ye(y,"class","svelte-16siter")},m(Q,c){ot(Q,p,c),ot(Q,y,c),T||(J=Ti(y,"click",L[9]),T=!0)},p:Li,d(Q){Q&&(De(p),De(y)),T=!1,J()}}}function Lm(L){let p,y,B="Sign up",T,J;return{c(){p=Ci("Don't have an account? "),y=Je("button"),y.textContent=B,this.h()},l(Q){p=Bi(Q,"Don't have an account? "),y=je(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(y)!=="svelte-1uqo441"&&(y.textContent=B),this.h()},h(){ye(y,"class","svelte-16siter")},m(Q,c){ot(Q,p,c),ot(Q,y,c),T||(J=Ti(y,"click",L[9]),T=!0)},p:Li,d(Q){Q&&(De(p),De(y)),T=!1,J()}}}function Rm(L){let p,y=L[0]&&pd(L);return{c(){y&&y.c(),p=jr()},l(B){y&&y.l(B),p=jr()},m(B,T){y&&y.m(B,T),ot(B,p,T)},p(B,[T]){B[0]?y?y.p(B,T):(y=pd(B),y.c(),y.m(p.parentNode,p)):y&&(y.d(1),y=null)},i:Li,o:Li,d(B){B&&De(p),y&&y.d(B)}}}function Fm(L,p,y){let{show:B=!1}=p,T="login",J="",Q="",c="",ne="",fe=!1;async function xe(){y(5,ne=""),y(6,fe=!0);try{T==="login"?await nf(J,Q):await cm(J,Q,c),y(0,B=!1),he()}catch($e){y(5,ne=$e.message||"Authentication failed")}finally{y(6,fe=!1)}}async function me(){y(5,ne=""),y(6,fe=!0);try{await um("google"),y(0,B=!1),he()}catch($e){y(5,ne=$e.message||"Google login failed")}finally{y(6,fe=!1)}}function he(){y(2,J=""),y(3,Q=""),y(4,c=""),y(5,ne="")}function Ue(){y(1,T=T==="login"?"register":"login"),y(5,ne="")}function Ze($e){$e.target===$e.currentTarget&&y(0,B=!1)}const nt=()=>y(0,B=!1);function it(){J=this.value,y(2,J)}function at(){Q=this.value,y(3,Q)}function Ye(){c=this.value,y(4,c)}return L.$$set=$e=>{"show"in $e&&y(0,B=$e.show)},[B,T,J,Q,c,ne,fe,xe,me,Ue,Ze,nt,it,at,Ye]}class zm extends Jn{constructor(p){super(),Yn(this,p,Fm,Rm,jn,{show:0})}}function _d(L,p,y){var Q;const B=L.slice();B[15]=p[y];const T=((Q=B[1].currentPlan)==null?void 0:Q.id)===B[15].id;B[16]=T;const J=!B[16]||B[1].cancelAtPeriodEnd;return B[17]=J,B}function Id(L){let p,y,B,T,J,Q="",c,ne,fe="Billing",xe,me,he,Ue,Ze="Current plan",nt,it,at,Ye,$e,Xe,lt,Bt=!L[3]&&L[5].some(kd),yt,Pt;function Ft(Vt,si){return Vt[1].currentPlan?Um:Gm}let gt=Ft(L),Qt=gt(L),Tt=L[1].currentPlan&&L[1].planStatus!=="lifetime"&&!L[1].cancelAtPeriodEnd&&vd(L),Ot=L[4]&&xd(L);function Yt(Vt,si){return Vt[3]?qm:Vt[5].length===0?Om:Nm}let Kt=Yt(L),li=Kt(L),pt=Bt&&Cd();return{c(){p=Je("div"),y=Je("button"),B=wt(),T=Je("div"),J=Je("button"),J.textContent=Q,c=wt(),ne=Je("h2"),ne.textContent=fe,xe=wt(),me=Je("div"),he=Je("div"),Ue=Je("div"),Ue.textContent=Ze,nt=wt(),it=Je("div"),Qt.c(),at=wt(),Tt&&Tt.c(),Ye=wt(),Ot&&Ot.c(),$e=wt(),Xe=Je("div"),li.c(),lt=wt(),pt&&pt.c(),this.h()},l(Vt){p=je(Vt,"DIV",{class:!0,role:!0,"aria-modal":!0});var si=dt(p);y=je(si,"BUTTON",{class:!0,type:!0,"aria-label":!0}),dt(y).forEach(De),B=bt(si),T=je(si,"DIV",{class:!0});var ci=dt(T);J=je(ci,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(J)!=="svelte-1ngpojv"&&(J.textContent=Q),c=bt(ci),ne=je(ci,"H2",{class:!0,"data-svelte-h":!0}),ti(ne)!=="svelte-5a0ibn"&&(ne.textContent=fe),xe=bt(ci),me=je(ci,"DIV",{class:!0});var ai=dt(me);he=je(ai,"DIV",{class:!0});var Ai=dt(he);Ue=je(Ai,"DIV",{class:!0,"data-svelte-h":!0}),ti(Ue)!=="svelte-ehgmhv"&&(Ue.textContent=Ze),nt=bt(Ai),it=je(Ai,"DIV",{class:!0});var lr=dt(it);Qt.l(lr),lr.forEach(De),Ai.forEach(De),at=bt(ai),Tt&&Tt.l(ai),ai.forEach(De),Ye=bt(ci),Ot&&Ot.l(ci),$e=bt(ci),Xe=je(ci,"DIV",{class:!0});var Ht=dt(Xe);li.l(Ht),Ht.forEach(De),lt=bt(ci),pt&&pt.l(ci),ci.forEach(De),si.forEach(De),this.h()},h(){ye(y,"class","backdrop-dismiss svelte-2oois9"),ye(y,"type","button"),ye(y,"aria-label","Close billing"),ye(J,"class","close-btn svelte-2oois9"),ye(ne,"class","svelte-2oois9"),ye(Ue,"class","label svelte-2oois9"),ye(it,"class","value svelte-2oois9"),ye(he,"class","current-info svelte-2oois9"),ye(me,"class","current svelte-2oois9"),ye(Xe,"class","plans svelte-2oois9"),ye(T,"class","modal svelte-2oois9"),ye(p,"class","backdrop svelte-2oois9"),ye(p,"role","dialog"),ye(p,"aria-modal","true")},m(Vt,si){ot(Vt,p,si),Te(p,y),Te(p,B),Te(p,T),Te(T,J),Te(T,c),Te(T,ne),Te(T,xe),Te(T,me),Te(me,he),Te(he,Ue),Te(he,nt),Te(he,it),Qt.m(it,null),Te(me,at),Tt&&Tt.m(me,null),Te(T,Ye),Ot&&Ot.m(T,null),Te(T,$e),Te(T,Xe),li.m(Xe,null),Te(T,lt),pt&&pt.m(T,null),yt||(Pt=[Ti(y,"click",L[8]),Ti(J,"click",L[10])],yt=!0)},p(Vt,si){gt===(gt=Ft(Vt))&&Qt?Qt.p(Vt,si):(Qt.d(1),Qt=gt(Vt),Qt&&(Qt.c(),Qt.m(it,null))),Vt[1].currentPlan&&Vt[1].planStatus!=="lifetime"&&!Vt[1].cancelAtPeriodEnd?Tt?Tt.p(Vt,si):(Tt=vd(Vt),Tt.c(),Tt.m(me,null)):Tt&&(Tt.d(1),Tt=null),Vt[4]?Ot?Ot.p(Vt,si):(Ot=xd(Vt),Ot.c(),Ot.m(T,$e)):Ot&&(Ot.d(1),Ot=null),Kt===(Kt=Yt(Vt))&&li?li.p(Vt,si):(li.d(1),li=Kt(Vt),li&&(li.c(),li.m(Xe,null))),si&40&&(Bt=!Vt[3]&&Vt[5].some(kd)),Bt?pt||(pt=Cd(),pt.c(),pt.m(T,null)):pt&&(pt.d(1),pt=null)},d(Vt){Vt&&De(p),Qt.d(),Tt&&Tt.d(),Ot&&Ot.d(),li.d(),pt&&pt.d(),yt=!1,Fa(Pt)}}}function Gm(L){let p,y="None";return{c(){p=Je("span"),p.textContent=y,this.h()},l(B){p=je(B,"SPAN",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-1l9bfjs"&&(p.textContent=y),this.h()},h(){ye(p,"class","muted svelte-2oois9")},m(B,T){ot(B,p,T)},p:Li,d(B){B&&De(p)}}}function Um(L){let p,y=L[1].currentPlan.name+"",B,T,J,Q,c=L[1].planStatus&&bd(L),ne=L[1].cancelAtPeriodEnd&&wd();return{c(){p=Je("span"),B=Ci(y),T=wt(),c&&c.c(),J=wt(),ne&&ne.c(),Q=jr(),this.h()},l(fe){p=je(fe,"SPAN",{class:!0});var xe=dt(p);B=Bi(xe,y),xe.forEach(De),T=bt(fe),c&&c.l(fe),J=bt(fe),ne&&ne.l(fe),Q=jr(),this.h()},h(){ye(p,"class","plan-name svelte-2oois9")},m(fe,xe){ot(fe,p,xe),Te(p,B),ot(fe,T,xe),c&&c.m(fe,xe),ot(fe,J,xe),ne&&ne.m(fe,xe),ot(fe,Q,xe)},p(fe,xe){xe&2&&y!==(y=fe[1].currentPlan.name+"")&&Ir(B,y),fe[1].planStatus?c?c.p(fe,xe):(c=bd(fe),c.c(),c.m(J.parentNode,J)):c&&(c.d(1),c=null),fe[1].cancelAtPeriodEnd?ne||(ne=wd(),ne.c(),ne.m(Q.parentNode,Q)):ne&&(ne.d(1),ne=null)},d(fe){fe&&(De(p),De(T),De(J),De(Q)),c&&c.d(fe),ne&&ne.d(fe)}}}function bd(L){let p,y=L[1].planStatus+"",B;return{c(){p=Je("span"),B=Ci(y),this.h()},l(T){p=je(T,"SPAN",{class:!0});var J=dt(p);B=Bi(J,y),J.forEach(De),this.h()},h(){ye(p,"class","status svelte-2oois9")},m(T,J){ot(T,p,J),Te(p,B)},p(T,J){J&2&&y!==(y=T[1].planStatus+"")&&Ir(B,y)},d(T){T&&De(p)}}}function wd(L){let p,y="Cancels at period end";return{c(){p=Je("span"),p.textContent=y,this.h()},l(B){p=je(B,"SPAN",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-10njltp"&&(p.textContent=y),this.h()},h(){ye(p,"class","status canceling svelte-2oois9")},m(B,T){ot(B,p,T)},d(B){B&&De(p)}}}function vd(L){let p,y=L[2]?"Canceling...":"Cancel",B,T,J,Q;return{c(){p=Je("button"),B=Ci(y),this.h()},l(c){p=je(c,"BUTTON",{class:!0});var ne=dt(p);B=Bi(ne,y),ne.forEach(De),this.h()},h(){ye(p,"class","cancel-btn svelte-2oois9"),p.disabled=T=L[2]||L[3]},m(c,ne){ot(c,p,ne),Te(p,B),J||(Q=Ti(p,"click",L[6]),J=!0)},p(c,ne){ne&4&&y!==(y=c[2]?"Canceling...":"Cancel")&&Ir(B,y),ne&12&&T!==(T=c[2]||c[3])&&(p.disabled=T)},d(c){c&&De(p),J=!1,Q()}}}function xd(L){let p,y;return{c(){p=Je("div"),y=Ci(L[4]),this.h()},l(B){p=je(B,"DIV",{class:!0});var T=dt(p);y=Bi(T,L[4]),T.forEach(De),this.h()},h(){ye(p,"class","error svelte-2oois9")},m(B,T){ot(B,p,T),Te(p,y)},p(B,T){T&16&&Ir(y,B[4])},d(B){B&&De(p)}}}function Nm(L){let p=[],y=new Map,B,T=$o(L[5]);const J=Q=>Q[15].id;for(let Q=0;Q<T.length;Q+=1){let c=_d(L,T,Q),ne=J(c);y.set(ne,p[Q]=Bd(ne,c))}return{c(){for(let Q=0;Q<p.length;Q+=1)p[Q].c();B=jr()},l(Q){for(let c=0;c<p.length;c+=1)p[c].l(Q);B=jr()},m(Q,c){for(let ne=0;ne<p.length;ne+=1)p[ne]&&p[ne].m(Q,c);ot(Q,B,c)},p(Q,c){c&170&&(T=$o(Q[5]),p=sp(p,c,J,1,Q,T,y,B.parentNode,np,Bd,B,_d))},d(Q){Q&&De(B);for(let c=0;c<p.length;c+=1)p[c].d(Q)}}}function Om(L){let p,y="No active plans";return{c(){p=Je("div"),p.textContent=y,this.h()},l(B){p=je(B,"DIV",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-1i9sp8t"&&(p.textContent=y),this.h()},h(){ye(p,"class","muted svelte-2oois9")},m(B,T){ot(B,p,T)},p:Li,d(B){B&&De(p)}}}function qm(L){let p,y="Loading...";return{c(){p=Je("div"),p.textContent=y,this.h()},l(B){p=je(B,"DIV",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-mlj0q2"&&(p.textContent=y),this.h()},h(){ye(p,"class","muted svelte-2oois9")},m(B,T){ot(B,p,T)},p:Li,d(B){B&&De(p)}}}function Vm(L){let p,y=L[16]&&L[1].cancelAtPeriodEnd?"Resubscribe":L[15].interval==="lifetime"?"Buy":"Subscribe",B,T,J;function Q(){return L[11](L[15])}return{c(){p=Je("button"),B=Ci(y),this.h()},l(c){p=je(c,"BUTTON",{class:!0});var ne=dt(p);B=Bi(ne,y),ne.forEach(De),this.h()},h(){ye(p,"class","checkout-btn svelte-2oois9"),p.disabled=L[3]},m(c,ne){ot(c,p,ne),Te(p,B),T||(J=Ti(p,"click",Q),T=!0)},p(c,ne){L=c,ne&34&&y!==(y=L[16]&&L[1].cancelAtPeriodEnd?"Resubscribe":L[15].interval==="lifetime"?"Buy":"Subscribe")&&Ir(B,y),ne&8&&(p.disabled=L[3])},d(c){c&&De(p),T=!1,J()}}}function Hm(L){let p,y="Current";return{c(){p=Je("span"),p.textContent=y,this.h()},l(B){p=je(B,"SPAN",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-1h9p5id"&&(p.textContent=y),this.h()},h(){ye(p,"class","current-badge svelte-2oois9")},m(B,T){ot(B,p,T)},p:Li,d(B){B&&De(p)}}}function Bd(L,p){let y,B,T,J=p[15].name+"",Q,c,ne,fe,xe=Qd(p[15].price,p[15].currency)+"",me,he,Ue,Ze,nt=(p[15].interval==="lifetime"?"once":p[15].interval)+"",it,at,Ye;function $e(Bt,yt){return Bt[16]&&!Bt[1].cancelAtPeriodEnd?Hm:Vm}let Xe=$e(p),lt=Xe(p);return{key:L,first:null,c(){y=Je("div"),B=Je("div"),T=Je("div"),Q=Ci(J),c=wt(),ne=Je("div"),fe=Je("span"),me=Ci(xe),he=wt(),Ue=Je("span"),Ze=Ci("/ "),it=Ci(nt),at=wt(),lt.c(),Ye=wt(),this.h()},l(Bt){y=je(Bt,"DIV",{class:!0});var yt=dt(y);B=je(yt,"DIV",{class:!0});var Pt=dt(B);T=je(Pt,"DIV",{class:!0});var Ft=dt(T);Q=Bi(Ft,J),Ft.forEach(De),c=bt(Pt),ne=je(Pt,"DIV",{class:!0});var gt=dt(ne);fe=je(gt,"SPAN",{class:!0});var Qt=dt(fe);me=Bi(Qt,xe),Qt.forEach(De),he=bt(gt),Ue=je(gt,"SPAN",{class:!0});var Tt=dt(Ue);Ze=Bi(Tt,"/ "),it=Bi(Tt,nt),Tt.forEach(De),gt.forEach(De),Pt.forEach(De),at=bt(yt),lt.l(yt),Ye=bt(yt),yt.forEach(De),this.h()},h(){ye(T,"class","plan-title svelte-2oois9"),ye(fe,"class","plan-price svelte-2oois9"),ye(Ue,"class","plan-interval svelte-2oois9"),ye(ne,"class","plan-subtitle svelte-2oois9"),ye(B,"class","plan-meta"),ye(y,"class","plan svelte-2oois9"),an(y,"current-plan",p[16]&&!p[1].cancelAtPeriodEnd),this.first=y},m(Bt,yt){ot(Bt,y,yt),Te(y,B),Te(B,T),Te(T,Q),Te(B,c),Te(B,ne),Te(ne,fe),Te(fe,me),Te(ne,he),Te(ne,Ue),Te(Ue,Ze),Te(Ue,it),Te(y,at),lt.m(y,null),Te(y,Ye)},p(Bt,yt){p=Bt,yt&32&&J!==(J=p[15].name+"")&&Ir(Q,J),yt&32&&xe!==(xe=Qd(p[15].price,p[15].currency)+"")&&Ir(me,xe),yt&32&&nt!==(nt=(p[15].interval==="lifetime"?"once":p[15].interval)+"")&&Ir(it,nt),Xe===(Xe=$e(p))&&lt?lt.p(p,yt):(lt.d(1),lt=Xe(p),lt&&(lt.c(),lt.m(y,Ye))),yt&34&&an(y,"current-plan",p[16]&&!p[1].cancelAtPeriodEnd)},d(Bt){Bt&&De(y),lt.d()}}}function Cd(L){let p,y="Cancel anytime with one click. No questions asked.";return{c(){p=Je("p"),p.textContent=y,this.h()},l(B){p=je(B,"P",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-kb8sv6"&&(p.textContent=y),this.h()},h(){ye(p,"class","reassurance svelte-2oois9")},m(B,T){ot(B,p,T)},d(B){B&&De(p)}}}function jm(L){let p,y=L[0]&&Id(L);return{c(){y&&y.c(),p=jr()},l(B){y&&y.l(B),p=jr()},m(B,T){y&&y.m(B,T),ot(B,p,T)},p(B,[T]){B[0]?y?y.p(B,T):(y=Id(B),y.c(),y.m(p.parentNode,p)):y&&(y.d(1),y=null)},i:Li,o:Li,d(B){B&&De(p),y&&y.d(B)}}}function Ed(L,p){typeof window<"u"&&window.gtag&&window.gtag("event",L,p)}function Qd(L,p){return new Intl.NumberFormat("de-DE",{style:"currency",currency:p}).format(L)}function Jm(){try{const L=Intl.DateTimeFormat().resolvedOptions().timeZone||"";if(L.startsWith("Europe/")||L==="Atlantic/Canary"||L==="Atlantic/Madeira"||L==="Atlantic/Azores")return"EUR"}catch{}return"USD"}const kd=L=>L.interval!=="lifetime";function Ym(L,p,y){let B,T;Hr(L,Nl,Ye=>y(12,T=Ye));let{show:J=!1}=p,Q=Jm(),c=[],ne={currentPlan:null,planStatus:"",cancelAtPeriodEnd:!1},fe=!1,xe=!1,me="";async function he(){var Ye;if(T){y(3,xe=!0),y(4,me="");try{const $e=await Vr.collection("users").getOne(T.id,{expand:"current_plan"}),Xe=(Ye=$e==null?void 0:$e.expand)==null?void 0:Ye.current_plan;let lt=!1;try{const yt=await Vr.collection("subscriptions").getList(1,1,{filter:`user = '${T.id}'`});yt.items.length>0&&(lt=yt.items[0].cancel_at_period_end===!0)}catch{}y(1,ne={currentPlan:Xe??null,planStatus:$e.plan_status??"",cancelAtPeriodEnd:lt});const Bt={lifetime:0,yearly:1,monthly:2};y(9,c=(await Vr.collection("plans").getFullList({filter:`active = true && currency = '${Q}'`})).sort((yt,Pt)=>(Bt[yt.interval]??99)-(Bt[Pt.interval]??99)))}catch($e){y(4,me=($e==null?void 0:$e.message)||"Failed to load billing info")}finally{y(3,xe=!1)}}}async function Ue(){y(2,fe=!0),y(4,me="");try{await Vr.send("/api/stripe-cancel",{method:"POST"}),await he()}catch(Ye){y(4,me=(Ye==null?void 0:Ye.message)||"Failed to cancel subscription")}finally{y(2,fe=!1)}}async function Ze(Ye){Ed("billing_checkout_click",{plan_id:Ye.id,plan_name:Ye.name,plan_interval:Ye.interval,plan_price:Ye.price,plan_currency:Ye.currency}),y(3,xe=!0),y(4,me="");try{const $e=await Vr.send("/api/stripe-checkout",{method:"POST",body:{planId:Ye.id}});if(!($e!=null&&$e.url))throw new Error("Checkout did not return a redirect URL");window.location.href=$e.url}catch($e){y(4,me=($e==null?void 0:$e.message)||"Checkout failed"),y(3,xe=!1)}}function nt(Ye){y(0,J=!1)}const it=()=>y(0,J=!1),at=Ye=>Ze(Ye);return L.$$set=Ye=>{"show"in Ye&&y(0,J=Ye.show)},L.$$.update=()=>{L.$$.dirty&1&&J&&(Ed("billing_modal_open"),he()),L.$$.dirty&514&&y(5,B=ne.planStatus==="lifetime"?c.filter(Ye=>Ye.interval==="lifetime"):c)},[J,ne,fe,xe,me,B,Ue,Ze,nt,c,it,at]}class Km extends Jn{constructor(p){super(),Yn(this,p,Ym,jm,jn,{show:0})}}function Zm(L){let p,y="Login",B,T;return{c(){p=Je("button"),p.textContent=y,this.h()},l(J){p=je(J,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-5a9e8v"&&(p.textContent=y),this.h()},h(){ye(p,"class","login-btn svelte-t6wi3p")},m(J,Q){ot(J,p,Q),B||(T=Ti(p,"click",L[4]),B=!0)},p:Li,d(J){J&&De(p),B=!1,T()}}}function $m(L){let p,y=L[2].email+"",B,T,J,Q="Billing",c,ne,fe="Logout",xe,me;return{c(){p=Je("span"),B=Ci(y),T=wt(),J=Je("button"),J.textContent=Q,c=wt(),ne=Je("button"),ne.textContent=fe,this.h()},l(he){p=je(he,"SPAN",{class:!0});var Ue=dt(p);B=Bi(Ue,y),Ue.forEach(De),T=bt(he),J=je(he,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(J)!=="svelte-sy610t"&&(J.textContent=Q),c=bt(he),ne=je(he,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(ne)!=="svelte-nurb2"&&(ne.textContent=fe),this.h()},h(){ye(p,"class","user-email svelte-t6wi3p"),ye(J,"class","billing-btn svelte-t6wi3p"),ye(ne,"class","logout-btn svelte-t6wi3p")},m(he,Ue){ot(he,p,Ue),Te(p,B),ot(he,T,Ue),ot(he,J,Ue),ot(he,c,Ue),ot(he,ne,Ue),xe||(me=[Ti(J,"click",L[3]),Ti(ne,"click",hm)],xe=!0)},p(he,Ue){Ue&4&&y!==(y=he[2].email+"")&&Ir(B,y)},d(he){he&&(De(p),De(T),De(J),De(c),De(ne)),xe=!1,Fa(me)}}}function Wm(L){let p,y,B='<img src="/logo/incusgrid_logo_transparent.svg" alt="IncusGrid" class="logo svelte-t6wi3p"/> <span class="brand-name svelte-t6wi3p">IncusGrid</span>',T,J,Q,c,ne,fe,xe,me,he;function Ue(Xe,lt){return Xe[2]?$m:Zm}let Ze=Ue(L),nt=Ze(L);function it(Xe){L[5](Xe)}let at={};L[0]!==void 0&&(at.show=L[0]),c=new zm({props:at}),cu.push(()=>rd(c,"show",it));function Ye(Xe){L[6](Xe)}let $e={};return L[1]!==void 0&&($e.show=L[1]),xe=new Km({props:$e}),cu.push(()=>rd(xe,"show",Ye)),{c(){p=Je("header"),y=Je("div"),y.innerHTML=B,T=wt(),J=Je("div"),nt.c(),Q=wt(),ys(c.$$.fragment),fe=wt(),ys(xe.$$.fragment),this.h()},l(Xe){p=je(Xe,"HEADER",{class:!0});var lt=dt(p);y=je(lt,"DIV",{class:!0,"data-svelte-h":!0}),ti(y)!=="svelte-1c2sdme"&&(y.innerHTML=B),T=bt(lt),J=je(lt,"DIV",{class:!0});var Bt=dt(J);nt.l(Bt),Bt.forEach(De),lt.forEach(De),Q=bt(Xe),ms(c.$$.fragment,Xe),fe=bt(Xe),ms(xe.$$.fragment,Xe),this.h()},h(){ye(y,"class","brand svelte-t6wi3p"),ye(J,"class","auth svelte-t6wi3p"),ye(p,"class","svelte-t6wi3p")},m(Xe,lt){ot(Xe,p,lt),Te(p,y),Te(p,T),Te(p,J),nt.m(J,null),ot(Xe,Q,lt),ps(c,Xe,lt),ot(Xe,fe,lt),ps(xe,Xe,lt),he=!0},p(Xe,[lt]){Ze===(Ze=Ue(Xe))&&nt?nt.p(Xe,lt):(nt.d(1),nt=Ze(Xe),nt&&(nt.c(),nt.m(J,null)));const Bt={};!ne&&lt&1&&(ne=!0,Bt.show=Xe[0],id(()=>ne=!1)),c.$set(Bt);const yt={};!me&&lt&2&&(me=!0,yt.show=Xe[1],id(()=>me=!1)),xe.$set(yt)},i(Xe){he||(Ar(c.$$.fragment,Xe),Ar(xe.$$.fragment,Xe),he=!0)},o(Xe){Mr(c.$$.fragment,Xe),Mr(xe.$$.fragment,Xe),he=!1},d(Xe){Xe&&(De(p),De(Q),De(fe)),nt.d(),gs(c,Xe),gs(xe,Xe)}}}function Xm(L,p,y){let B;Hr(L,Nl,he=>y(2,B=he));let T=!1,J=!1;function Q(){y(1,J=!0)}function c(){y(0,T=!0)}mh(()=>{window.addEventListener("open-billing-modal",Q),window.addEventListener("open-auth-modal",c)}),qd(()=>{window.removeEventListener("open-billing-modal",Q),window.removeEventListener("open-auth-modal",c)});const ne=()=>y(1,J=!0),fe=()=>y(0,T=!0);function xe(he){T=he,y(0,T)}function me(he){J=he,y(1,J)}return[T,J,B,ne,fe,xe,me]}class ey extends Jn{constructor(p){super(),Yn(this,p,Xm,Wm,jn,{})}}function Sd(L){let p,y='<div class="help-item svelte-52kvpw"><div class="help-icon exposure svelte-52kvpw"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"></path></svg></div> <div class="help-text svelte-52kvpw"><strong class="svelte-52kvpw">Exposure</strong> <p class="svelte-52kvpw">Shows how well terrain shields each location from lightning. Green areas have nearby hills or high buildings that act as natural lightning rods. Red areas are statistically more exposed to lightning strikes than green areas.</p></div></div> <div class="help-item svelte-52kvpw"><div class="help-icon activity svelte-52kvpw"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M7 2v11h3v9l7-12h-4l4-8z"></path></svg></div> <div class="help-text svelte-52kvpw"><strong class="svelte-52kvpw">Activity</strong> <p class="svelte-52kvpw">Shows the average lightning strikes per square kilometer for any given month or over the entire year. Red areas have significantly more lightning strikes than green areas.</p></div></div> <div class="help-item svelte-52kvpw"><div class="help-icon wind svelte-52kvpw"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12.5 2C9.64 2 8 3.57 8 5.5c0 2 1.5 3.5 3.5 3.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h9.5c1.38 0 2.5-1.12 2.5-2.5S13.88 7 12.5 7h-1C10.67 7 10 6.33 10 5.5S10.67 4 11.5 4h1c1.93 0 3.5 1.57 3.5 3.5h2c0-3.04-2.46-5.5-5.5-5.5zM19 12v2h-1.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h16.5c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5H21v-2h-2z"></path></svg></div> <div class="help-text svelte-52kvpw"><strong class="svelte-52kvpw">Wind</strong> <p class="svelte-52kvpw">Shows what percentage of time a location experiences a given wind condition. Choose between speed categories (Light, Moderate, Strong, Storm) or wind directions (N, NE, etc.). The color scale ranges from 0% to a category-specific maximum. Storm* is a detail view of the Storm layer with a finer 02% scale to reveal differences in regions with rare but noteworthy storm activity.</p></div></div>';return{c(){p=Je("div"),p.innerHTML=y,this.h()},l(B){p=je(B,"DIV",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-1o79pgl"&&(p.innerHTML=y),this.h()},h(){ye(p,"class","help-popover svelte-52kvpw")},m(B,T){ot(B,p,T)},d(B){B&&De(p)}}}function ty(L){let p,y,B=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-52kvpw"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"></path></svg>
    Exposure`,T,J,Q=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-52kvpw"><path d="M7 2v11h3v9l7-12h-4l4-8z"></path></svg>
    Activity`,c,ne,fe=`<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="svelte-52kvpw"><path d="M12.5 2C9.64 2 8 3.57 8 5.5c0 2 1.5 3.5 3.5 3.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h9.5c1.38 0 2.5-1.12 2.5-2.5S13.88 7 12.5 7h-1C10.67 7 10 6.33 10 5.5S10.67 4 11.5 4h1c1.93 0 3.5 1.57 3.5 3.5h2c0-3.04-2.46-5.5-5.5-5.5zM19 12v2h-1.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5h1c.28 0 .5.22.5.5s-.22.5-.5.5H3v2h16.5c1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5H21v-2h-2z"></path></svg>
    Wind`,xe,me,he="?",Ue,Ze,nt,it=L[0]&&Sd();return{c(){p=Je("div"),y=Je("button"),y.innerHTML=B,T=wt(),J=Je("button"),J.innerHTML=Q,c=wt(),ne=Je("button"),ne.innerHTML=fe,xe=wt(),me=Je("button"),me.textContent=he,Ue=wt(),it&&it.c(),this.h()},l(at){p=je(at,"DIV",{class:!0});var Ye=dt(p);y=je(Ye,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ti(y)!=="svelte-1h76bnd"&&(y.innerHTML=B),T=bt(Ye),J=je(Ye,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ti(J)!=="svelte-hl1je4"&&(J.innerHTML=Q),c=bt(Ye),ne=je(Ye,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ti(ne)!=="svelte-108i5nd"&&(ne.innerHTML=fe),xe=bt(Ye),me=je(Ye,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),ti(me)!=="svelte-s18xjb"&&(me.textContent=he),Ue=bt(Ye),it&&it.l(Ye),Ye.forEach(De),this.h()},h(){ye(y,"class","layer-btn svelte-52kvpw"),ye(y,"title","Show exposure level based on nearby protection"),an(y,"active",L[1].activeLayer==="exposure"),ye(J,"class","layer-btn svelte-52kvpw"),ye(J,"title","Show historical lightning activity"),an(J,"active",L[1].activeLayer==="activity"),ye(ne,"class","layer-btn svelte-52kvpw"),ye(ne,"title","Show wind data"),an(ne,"active",L[1].activeLayer==="wind"),ye(me,"class","help-btn svelte-52kvpw"),ye(me,"title","Learn about layers"),ye(me,"aria-label","Help"),ye(p,"class","layer-toggle svelte-52kvpw")},m(at,Ye){ot(at,p,Ye),Te(p,y),Te(p,T),Te(p,J),Te(p,c),Te(p,ne),Te(p,xe),Te(p,me),Te(p,Ue),it&&it.m(p,null),Ze||(nt=[Ti(window,"click",L[4]),Ti(y,"click",L[5]),Ti(J,"click",L[6]),Ti(ne,"click",L[7]),Ti(me,"click",Vd(L[3]))],Ze=!0)},p(at,[Ye]){Ye&2&&an(y,"active",at[1].activeLayer==="exposure"),Ye&2&&an(J,"active",at[1].activeLayer==="activity"),Ye&2&&an(ne,"active",at[1].activeLayer==="wind"),at[0]?it||(it=Sd(),it.c(),it.m(p,null)):it&&(it.d(1),it=null)},i:Li,o:Li,d(at){at&&De(p),it&&it.d(),Ze=!1,Fa(nt)}}}function iy(L,p,y){let B;Hr(L,on,me=>y(1,B=me));let T=!1;function J(me){pp(me)}function Q(){y(0,T=!T)}function c(me){me.target.closest(".layer-toggle")||y(0,T=!1)}return[T,B,J,Q,c,()=>J("exposure"),()=>J("activity"),()=>J("wind")]}class ry extends Jn{constructor(p){super(),Yn(this,p,iy,ty,jn,{})}}function Dd(L,p,y){const B=L.slice();return B[6]=p[y],B[8]=y,B}function ny(L){let p;return{c(){p=Je("div"),this.h()},l(y){p=je(y,"DIV",{class:!0}),dt(p).forEach(De),this.h()},h(){ye(p,"class","timeline-line svelte-ude4px"),an(p,"before-year",L[1][L[8]+1]==="year")},m(y,B){ot(y,p,B)},p:Li,d(y){y&&De(p)}}}function Md(L){let p,y,B,T,J=fu[L[6]]+"",Q,c,ne,fe,xe;function me(){return L[5](L[6])}let he=L[8]<L[1].length-1&&ny(L);return{c(){p=Je("button"),y=Je("span"),B=wt(),T=Je("span"),Q=Ci(J),c=wt(),he&&he.c(),ne=jr(),this.h()},l(Ue){p=je(Ue,"BUTTON",{class:!0,"aria-label":!0});var Ze=dt(p);y=je(Ze,"SPAN",{class:!0}),dt(y).forEach(De),B=bt(Ze),T=je(Ze,"SPAN",{class:!0});var nt=dt(T);Q=Bi(nt,J),nt.forEach(De),Ze.forEach(De),c=bt(Ue),he&&he.l(Ue),ne=jr(),this.h()},h(){ye(y,"class","point-dot svelte-ude4px"),ye(T,"class","point-label svelte-ude4px"),ye(p,"class","timeline-point svelte-ude4px"),ye(p,"aria-label",fu[L[6]]),an(p,"active",L[0]===L[6]),an(p,"is-year",L[6]==="year")},m(Ue,Ze){ot(Ue,p,Ze),Te(p,y),Te(p,B),Te(p,T),Te(T,Q),ot(Ue,c,Ze),he&&he.m(Ue,Ze),ot(Ue,ne,Ze),fe||(xe=Ti(p,"click",me),fe=!0)},p(Ue,Ze){L=Ue,Ze&3&&an(p,"active",L[0]===L[6]),L[8]<L[1].length-1&&he.p(L,Ze)},d(Ue){Ue&&(De(p),De(c),De(ne)),he&&he.d(Ue),fe=!1,xe()}}}function sy(L){let p,y,B,T,J=$o(L[1]),Q=[];for(let c=0;c<J.length;c+=1)Q[c]=Md(Dd(L,J,c));return{c(){p=Je("div"),y=Je("div");for(let c=0;c<Q.length;c+=1)Q[c].c();this.h()},l(c){p=je(c,"DIV",{class:!0,role:!0,"aria-label":!0,tabindex:!0});var ne=dt(p);y=je(ne,"DIV",{class:!0});var fe=dt(y);for(let xe=0;xe<Q.length;xe+=1)Q[xe].l(fe);fe.forEach(De),ne.forEach(De),this.h()},h(){ye(y,"class","timeline-track svelte-ude4px"),ye(p,"class","timeline-container svelte-ude4px"),ye(p,"role","group"),ye(p,"aria-label","Period selector"),ye(p,"tabindex","0")},m(c,ne){ot(c,p,ne),Te(p,y);for(let fe=0;fe<Q.length;fe+=1)Q[fe]&&Q[fe].m(y,null);B||(T=Ti(p,"keydown",L[3]),B=!0)},p(c,[ne]){if(ne&7){J=$o(c[1]);let fe;for(fe=0;fe<J.length;fe+=1){const xe=Dd(c,J,fe);Q[fe]?Q[fe].p(xe,ne):(Q[fe]=Md(xe),Q[fe].c(),Q[fe].m(y,null))}for(;fe<Q.length;fe+=1)Q[fe].d(1);Q.length=J.length}},i:Li,o:Li,d(c){c&&De(p),hu(Q,c),B=!1,T()}}}function ay(L,p,y){let B,T;Hr(L,on,fe=>y(4,T=fe));const J=[1,2,3,4,5,6,7,8,9,10,11,12,"year"];function Q(fe){T.activeLayer==="wind"?yp(fe):mp(fe)}function c(fe){const xe=J.indexOf(B);fe.key==="ArrowLeft"&&xe>0?Q(J[xe-1]):fe.key==="ArrowRight"&&xe<J.length-1&&Q(J[xe+1])}const ne=fe=>Q(fe);return L.$$.update=()=>{L.$$.dirty&16&&y(0,B=T.activeLayer==="wind"?T.windPeriod:T.lightningPeriod)},[B,J,Q,c,T,ne]}class oy extends Jn{constructor(p){super(),Yn(this,p,ay,sy,jn,{})}}function Td(L,p,y){const B=L.slice();B[8]=p[y];const T=cy(B[8].angle,52);return B[9]=T,B}function Pd(L,p,y){const B=L.slice();return B[12]=p[y],B}function Ld(L){let p,y=L[12].label+"",B,T,J,Q;function c(){return L[6](L[12])}return{c(){p=Je("button"),B=Ci(y),T=wt(),this.h()},l(ne){p=je(ne,"BUTTON",{class:!0});var fe=dt(p);B=Bi(fe,y),T=bt(fe),fe.forEach(De),this.h()},h(){ye(p,"class","speed-btn svelte-da5d9s"),an(p,"active",L[0]===L[12].id)},m(ne,fe){ot(ne,p,fe),Te(p,B),Te(p,T),J||(Q=Ti(p,"click",c),J=!0)},p(ne,fe){L=ne,fe&3&&an(p,"active",L[0]===L[12].id)},d(ne){ne&&De(p),J=!1,Q()}}}function Rd(L){let p,y=L[8].label+"",B,T,J,Q;function c(){return L[7](L[8])}return{c(){p=Je("button"),B=Ci(y),T=wt(),this.h()},l(ne){p=je(ne,"BUTTON",{class:!0,style:!0});var fe=dt(p);B=Bi(fe,y),T=bt(fe),fe.forEach(De),this.h()},h(){ye(p,"class","dir-btn svelte-da5d9s"),yh(p,"transform","translate("+L[9].x+"px, "+L[9].y+"px)"),an(p,"active",L[0]===`dir_${L[8].id}`),an(p,"cardinal",L[8].id==="n"||L[8].id==="e"||L[8].id==="s"||L[8].id==="w")},m(ne,fe){ot(ne,p,fe),Te(p,B),Te(p,T),J||(Q=Ti(p,"click",c),J=!0)},p(ne,fe){L=ne,fe&5&&an(p,"active",L[0]===`dir_${L[8].id}`)},d(ne){ne&&De(p),J=!1,Q()}}}function ly(L){let p,y,B,T="Speed",J,Q,c,ne,fe,xe="Direction",me,he,Ue,Ze,nt,it,at,Ye,$e,Xe,lt,Bt,yt,Pt,Ft,gt,Qt=$o(L[1]),Tt=[];for(let Kt=0;Kt<Qt.length;Kt+=1)Tt[Kt]=Ld(Pd(L,Qt,Kt));let Ot=$o(L[2]),Yt=[];for(let Kt=0;Kt<Ot.length;Kt+=1)Yt[Kt]=Rd(Td(L,Ot,Kt));return{c(){p=Je("div"),y=Je("div"),B=Je("span"),B.textContent=T,J=wt(),Q=Je("div");for(let Kt=0;Kt<Tt.length;Kt+=1)Tt[Kt].c();c=wt(),ne=Je("div"),fe=Je("span"),fe.textContent=xe,me=wt(),he=Je("div"),Ue=qr("svg"),Ze=qr("circle"),nt=qr("circle"),it=qr("line"),at=qr("line"),Ye=qr("line"),$e=qr("line"),Xe=qr("line"),lt=qr("line"),Bt=qr("line"),yt=qr("line"),Pt=qr("polygon"),Ft=qr("polygon"),gt=wt();for(let Kt=0;Kt<Yt.length;Kt+=1)Yt[Kt].c();this.h()},l(Kt){p=je(Kt,"DIV",{class:!0});var li=dt(p);y=je(li,"DIV",{class:!0});var pt=dt(y);B=je(pt,"SPAN",{class:!0,"data-svelte-h":!0}),ti(B)!=="svelte-pyx88c"&&(B.textContent=T),J=bt(pt),Q=je(pt,"DIV",{class:!0});var Vt=dt(Q);for(let Ai=0;Ai<Tt.length;Ai+=1)Tt[Ai].l(Vt);Vt.forEach(De),pt.forEach(De),c=bt(li),ne=je(li,"DIV",{class:!0});var si=dt(ne);fe=je(si,"SPAN",{class:!0,"data-svelte-h":!0}),ti(fe)!=="svelte-xaf52q"&&(fe.textContent=xe),me=bt(si),he=je(si,"DIV",{class:!0});var ci=dt(he);Ue=Or(ci,"svg",{class:!0,viewBox:!0});var ai=dt(Ue);Ze=Or(ai,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0}),dt(Ze).forEach(De),nt=Or(ai,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0}),dt(nt).forEach(De),it=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(it).forEach(De),at=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(at).forEach(De),Ye=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(Ye).forEach(De),$e=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt($e).forEach(De),Xe=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(Xe).forEach(De),lt=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(lt).forEach(De),Bt=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(Bt).forEach(De),yt=Or(ai,"line",{x1:!0,y1:!0,x2:!0,y2:!0,stroke:!0,"stroke-width":!0}),dt(yt).forEach(De),Pt=Or(ai,"polygon",{points:!0,fill:!0,opacity:!0}),dt(Pt).forEach(De),Ft=Or(ai,"polygon",{points:!0,fill:!0,opacity:!0}),dt(Ft).forEach(De),ai.forEach(De),gt=bt(ci);for(let Ai=0;Ai<Yt.length;Ai+=1)Yt[Ai].l(ci);ci.forEach(De),si.forEach(De),li.forEach(De),this.h()},h(){ye(B,"class","section-label svelte-da5d9s"),ye(Q,"class","speed-buttons svelte-da5d9s"),ye(y,"class","speed-section svelte-da5d9s"),ye(fe,"class","section-label svelte-da5d9s"),ye(Ze,"cx","50"),ye(Ze,"cy","50"),ye(Ze,"r","48"),ye(Ze,"fill","none"),ye(Ze,"stroke","#e5e7eb"),ye(Ze,"stroke-width","1"),ye(nt,"cx","50"),ye(nt,"cy","50"),ye(nt,"r","20"),ye(nt,"fill","none"),ye(nt,"stroke","#e5e7eb"),ye(nt,"stroke-width","1"),ye(it,"x1","50"),ye(it,"y1","8"),ye(it,"x2","50"),ye(it,"y2","30"),ye(it,"stroke","#d1d5db"),ye(it,"stroke-width","1.5"),ye(at,"x1","50"),ye(at,"y1","70"),ye(at,"x2","50"),ye(at,"y2","92"),ye(at,"stroke","#d1d5db"),ye(at,"stroke-width","1.5"),ye(Ye,"x1","8"),ye(Ye,"y1","50"),ye(Ye,"x2","30"),ye(Ye,"y2","50"),ye(Ye,"stroke","#d1d5db"),ye(Ye,"stroke-width","1.5"),ye($e,"x1","70"),ye($e,"y1","50"),ye($e,"x2","92"),ye($e,"y2","50"),ye($e,"stroke","#d1d5db"),ye($e,"stroke-width","1.5"),ye(Xe,"x1","20"),ye(Xe,"y1","20"),ye(Xe,"x2","32"),ye(Xe,"y2","32"),ye(Xe,"stroke","#e5e7eb"),ye(Xe,"stroke-width","1"),ye(lt,"x1","80"),ye(lt,"y1","20"),ye(lt,"x2","68"),ye(lt,"y2","32"),ye(lt,"stroke","#e5e7eb"),ye(lt,"stroke-width","1"),ye(Bt,"x1","20"),ye(Bt,"y1","80"),ye(Bt,"x2","32"),ye(Bt,"y2","68"),ye(Bt,"stroke","#e5e7eb"),ye(Bt,"stroke-width","1"),ye(yt,"x1","80"),ye(yt,"y1","80"),ye(yt,"x2","68"),ye(yt,"y2","68"),ye(yt,"stroke","#e5e7eb"),ye(yt,"stroke-width","1"),ye(Pt,"points","50,22 46,38 50,34 54,38"),ye(Pt,"fill","#2563eb"),ye(Pt,"opacity","0.6"),ye(Ft,"points","50,78 46,62 50,66 54,62"),ye(Ft,"fill","#94a3b8"),ye(Ft,"opacity","0.4"),ye(Ue,"class","compass-rose svelte-da5d9s"),ye(Ue,"viewBox","0 0 100 100"),ye(he,"class","compass-container svelte-da5d9s"),ye(ne,"class","direction-section svelte-da5d9s"),ye(p,"class","wind-controls svelte-da5d9s")},m(Kt,li){ot(Kt,p,li),Te(p,y),Te(y,B),Te(y,J),Te(y,Q);for(let pt=0;pt<Tt.length;pt+=1)Tt[pt]&&Tt[pt].m(Q,null);Te(p,c),Te(p,ne),Te(ne,fe),Te(ne,me),Te(ne,he),Te(he,Ue),Te(Ue,Ze),Te(Ue,nt),Te(Ue,it),Te(Ue,at),Te(Ue,Ye),Te(Ue,$e),Te(Ue,Xe),Te(Ue,lt),Te(Ue,Bt),Te(Ue,yt),Te(Ue,Pt),Te(Ue,Ft),Te(he,gt);for(let pt=0;pt<Yt.length;pt+=1)Yt[pt]&&Yt[pt].m(he,null)},p(Kt,[li]){if(li&11){Qt=$o(Kt[1]);let pt;for(pt=0;pt<Qt.length;pt+=1){const Vt=Pd(Kt,Qt,pt);Tt[pt]?Tt[pt].p(Vt,li):(Tt[pt]=Ld(Vt),Tt[pt].c(),Tt[pt].m(Q,null))}for(;pt<Tt.length;pt+=1)Tt[pt].d(1);Tt.length=Qt.length}if(li&21){Ot=$o(Kt[2]);let pt;for(pt=0;pt<Ot.length;pt+=1){const Vt=Td(Kt,Ot,pt);Yt[pt]?Yt[pt].p(Vt,li):(Yt[pt]=Rd(Vt),Yt[pt].c(),Yt[pt].m(he,null))}for(;pt<Yt.length;pt+=1)Yt[pt].d(1);Yt.length=Ot.length}},i:Li,o:Li,d(Kt){Kt&&De(p),hu(Tt,Kt),hu(Yt,Kt)}}}function cy(L,p){const y=(L-90)*(Math.PI/180),B=Math.cos(y)*p,T=Math.sin(y)*p;return{x:B,y:T}}function hy(L,p,y){let B,T;Hr(L,on,me=>y(5,T=me));const J=[{id:"light",label:"Light"},{id:"moderate",label:"Moderate"},{id:"strong",label:"Strong"},{id:"storm",label:"Storm"},{id:"storm_detail",label:"Storm*"}],Q=[{id:"n",label:"N",angle:0},{id:"ne",label:"NE",angle:45},{id:"e",label:"E",angle:90},{id:"se",label:"SE",angle:135},{id:"s",label:"S",angle:180},{id:"sw",label:"SW",angle:225},{id:"w",label:"W",angle:270},{id:"nw",label:"NW",angle:315}];function c(me){sd(me)}function ne(me){sd(`dir_${me}`)}const fe=me=>c(me.id),xe=me=>ne(me.id);return L.$$.update=()=>{L.$$.dirty&32&&y(0,B=T.windMetric)},[B,J,Q,c,ne,T,fe,xe]}class uy extends Jn{constructor(p){super(),Yn(this,p,hy,ly,jn,{})}}function Fd(L){let p,y,B,T,J,Q="",c,ne,fe="Payment Successful!",xe,me,he="Thank you for your purchase. Your plan is now active.",Ue,Ze,nt="Continue",it,at;return{c(){p=Je("div"),y=Je("button"),B=wt(),T=Je("div"),J=Je("div"),J.textContent=Q,c=wt(),ne=Je("h2"),ne.textContent=fe,xe=wt(),me=Je("p"),me.textContent=he,Ue=wt(),Ze=Je("button"),Ze.textContent=nt,this.h()},l(Ye){p=je(Ye,"DIV",{class:!0,role:!0,"aria-modal":!0});var $e=dt(p);y=je($e,"BUTTON",{class:!0,type:!0,"aria-label":!0}),dt(y).forEach(De),B=bt($e),T=je($e,"DIV",{class:!0});var Xe=dt(T);J=je(Xe,"DIV",{class:!0,"data-svelte-h":!0}),ti(J)!=="svelte-ngli57"&&(J.textContent=Q),c=bt(Xe),ne=je(Xe,"H2",{class:!0,"data-svelte-h":!0}),ti(ne)!=="svelte-15d9u2n"&&(ne.textContent=fe),xe=bt(Xe),me=je(Xe,"P",{class:!0,"data-svelte-h":!0}),ti(me)!=="svelte-10hsw22"&&(me.textContent=he),Ue=bt(Xe),Ze=je(Xe,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(Ze)!=="svelte-ac5k3r"&&(Ze.textContent=nt),Xe.forEach(De),$e.forEach(De),this.h()},h(){ye(y,"class","backdrop-dismiss svelte-177sfa8"),ye(y,"type","button"),ye(y,"aria-label","Close"),ye(J,"class","icon svelte-177sfa8"),ye(ne,"class","svelte-177sfa8"),ye(me,"class","svelte-177sfa8"),ye(Ze,"class","close-btn svelte-177sfa8"),ye(T,"class","modal svelte-177sfa8"),ye(p,"class","backdrop svelte-177sfa8"),ye(p,"role","dialog"),ye(p,"aria-modal","true")},m(Ye,$e){ot(Ye,p,$e),Te(p,y),Te(p,B),Te(p,T),Te(T,J),Te(T,c),Te(T,ne),Te(T,xe),Te(T,me),Te(T,Ue),Te(T,Ze),it||(at=[Ti(y,"click",L[1]),Ti(Ze,"click",L[1])],it=!0)},p:Li,d(Ye){Ye&&De(p),it=!1,Fa(at)}}}function Ay(L){let p,y=L[0]&&Fd(L);return{c(){y&&y.c(),p=jr()},l(B){y&&y.l(B),p=jr()},m(B,T){y&&y.m(B,T),ot(B,p,T)},p(B,[T]){B[0]?y?y.p(B,T):(y=Fd(B),y.c(),y.m(p.parentNode,p)):y&&(y.d(1),y=null)},i:Li,o:Li,d(B){B&&De(p),y&&y.d(B)}}}function dy(L,p,y){let B;Hr(L,rp,Q=>y(3,B=Q));let T=!1;mh(()=>{const Q=B.url.searchParams.get("billing");if(B.url.searchParams.get("session_id"),Q==="success"){y(0,T=!0);const c=new URL(window.location.href);c.searchParams.delete("billing"),c.searchParams.delete("session_id"),window.history.replaceState({},"",c.pathname)}});function J(){y(0,T=!1)}return[T,J]}class fy extends Jn{constructor(p){super(),Yn(this,p,dy,Ay,jn,{})}}function zd(L){let p,y,B,T,J,Q="",c,ne,fe;function xe(Ue,Ze){return Ue[1]?gy:py}let me=xe(L),he=me(L);return{c(){p=Je("div"),y=Je("button"),B=wt(),T=Je("div"),J=Je("button"),J.textContent=Q,c=wt(),he.c(),this.h()},l(Ue){p=je(Ue,"DIV",{class:!0,role:!0,"aria-modal":!0});var Ze=dt(p);y=je(Ze,"BUTTON",{class:!0,type:!0,"aria-label":!0}),dt(y).forEach(De),B=bt(Ze),T=je(Ze,"DIV",{class:!0});var nt=dt(T);J=je(nt,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(J)!=="svelte-moq3tb"&&(J.textContent=Q),c=bt(nt),he.l(nt),nt.forEach(De),Ze.forEach(De),this.h()},h(){ye(y,"class","backdrop-dismiss svelte-1snuf20"),ye(y,"type","button"),ye(y,"aria-label","Close"),ye(J,"class","close-btn svelte-1snuf20"),ye(T,"class","modal svelte-1snuf20"),ye(p,"class","backdrop svelte-1snuf20"),ye(p,"role","dialog"),ye(p,"aria-modal","true")},m(Ue,Ze){ot(Ue,p,Ze),Te(p,y),Te(p,B),Te(p,T),Te(T,J),Te(T,c),he.m(T,null),ne||(fe=[Ti(y,"click",L[6]),Ti(J,"click",L[5])],ne=!0)},p(Ue,Ze){me===(me=xe(Ue))&&he?he.p(Ue,Ze):(he.d(1),he=me(Ue),he&&(he.c(),he.m(T,null)))},d(Ue){Ue&&De(p),he.d(),ne=!1,Fa(fe)}}}function gy(L){let p,y="",B,T,J="You've left your free zone",Q,c,ne,fe,xe,me="Your current access:",he,Ue,Ze,nt,it,at=L[2].name+"",Ye,$e,Xe,lt,Bt=L[2].radiusKm+"",yt,Pt,Ft,gt,Qt="Worldwide overview map",Tt,Ot,Yt='<div class="section-title svelte-1snuf20">With a subscription you get:</div> <ul class="svelte-1snuf20"><li class="svelte-1snuf20">Worldwide access without restrictions</li> <li class="svelte-1snuf20">Exposure layer (topographic shielding)</li> <li class="svelte-1snuf20">Activity layer (lightning frequency)</li></ul>',Kt,li,pt="Find sheltered anchorages, campsites & more.",Vt,si,ci="View Plans",ai,Ai,lr="Maybe later",Ht,ei;return{c(){p=Je("div"),p.textContent=y,B=wt(),T=Je("h2"),T.textContent=J,Q=wt(),c=Je("div"),ne=wt(),fe=Je("div"),xe=Je("div"),xe.textContent=me,he=wt(),Ue=Je("ul"),Ze=Je("li"),nt=Ci("Detail view around "),it=Je("strong"),Ye=Ci(at),$e=wt(),Xe=Je("li"),lt=Ci("~"),yt=Ci(Bt),Pt=Ci(" km radius at full resolution"),Ft=wt(),gt=Je("li"),gt.textContent=Qt,Tt=wt(),Ot=Je("div"),Ot.innerHTML=Yt,Kt=wt(),li=Je("div"),li.textContent=pt,Vt=wt(),si=Je("button"),si.textContent=ci,ai=wt(),Ai=Je("button"),Ai.textContent=lr,this.h()},l(Zt){p=je(Zt,"DIV",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-a17grk"&&(p.textContent=y),B=bt(Zt),T=je(Zt,"H2",{class:!0,"data-svelte-h":!0}),ti(T)!=="svelte-9m3c6v"&&(T.textContent=J),Q=bt(Zt),c=je(Zt,"DIV",{class:!0}),dt(c).forEach(De),ne=bt(Zt),fe=je(Zt,"DIV",{class:!0});var ri=dt(fe);xe=je(ri,"DIV",{class:!0,"data-svelte-h":!0}),ti(xe)!=="svelte-1nxo6uz"&&(xe.textContent=me),he=bt(ri),Ue=je(ri,"UL",{class:!0});var mi=dt(Ue);Ze=je(mi,"LI",{class:!0});var ki=dt(Ze);nt=Bi(ki,"Detail view around "),it=je(ki,"STRONG",{class:!0});var br=dt(it);Ye=Bi(br,at),br.forEach(De),ki.forEach(De),$e=bt(mi),Xe=je(mi,"LI",{class:!0});var mr=dt(Xe);lt=Bi(mr,"~"),yt=Bi(mr,Bt),Pt=Bi(mr," km radius at full resolution"),mr.forEach(De),Ft=bt(mi),gt=je(mi,"LI",{class:!0,"data-svelte-h":!0}),ti(gt)!=="svelte-1cyig4w"&&(gt.textContent=Qt),mi.forEach(De),ri.forEach(De),Tt=bt(Zt),Ot=je(Zt,"DIV",{class:!0,"data-svelte-h":!0}),ti(Ot)!=="svelte-pkukma"&&(Ot.innerHTML=Yt),Kt=bt(Zt),li=je(Zt,"DIV",{class:!0,"data-svelte-h":!0}),ti(li)!=="svelte-18m8cjy"&&(li.textContent=pt),Vt=bt(Zt),si=je(Zt,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(si)!=="svelte-845pxc"&&(si.textContent=ci),ai=bt(Zt),Ai=je(Zt,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(Ai)!=="svelte-km0892"&&(Ai.textContent=lr),this.h()},h(){ye(p,"class","icon svelte-1snuf20"),ye(T,"class","svelte-1snuf20"),ye(c,"class","divider svelte-1snuf20"),ye(xe,"class","section-title svelte-1snuf20"),ye(it,"class","svelte-1snuf20"),ye(Ze,"class","svelte-1snuf20"),ye(Xe,"class","svelte-1snuf20"),ye(gt,"class","svelte-1snuf20"),ye(Ue,"class","svelte-1snuf20"),ye(fe,"class","section svelte-1snuf20"),ye(Ot,"class","section svelte-1snuf20"),ye(li,"class","hint svelte-1snuf20"),ye(si,"class","primary-btn svelte-1snuf20"),ye(Ai,"class","secondary-btn svelte-1snuf20")},m(Zt,ri){ot(Zt,p,ri),ot(Zt,B,ri),ot(Zt,T,ri),ot(Zt,Q,ri),ot(Zt,c,ri),ot(Zt,ne,ri),ot(Zt,fe,ri),Te(fe,xe),Te(fe,he),Te(fe,Ue),Te(Ue,Ze),Te(Ze,nt),Te(Ze,it),Te(it,Ye),Te(Ue,$e),Te(Ue,Xe),Te(Xe,lt),Te(Xe,yt),Te(Xe,Pt),Te(Ue,Ft),Te(Ue,gt),ot(Zt,Tt,ri),ot(Zt,Ot,ri),ot(Zt,Kt,ri),ot(Zt,li,ri),ot(Zt,Vt,ri),ot(Zt,si,ri),ot(Zt,ai,ri),ot(Zt,Ai,ri),Ht||(ei=[Ti(si,"click",L[4]),Ti(Ai,"click",L[5])],Ht=!0)},p(Zt,ri){ri&4&&at!==(at=Zt[2].name+"")&&Ir(Ye,at),ri&4&&Bt!==(Bt=Zt[2].radiusKm+"")&&Ir(yt,Bt)},d(Zt){Zt&&(De(p),De(B),De(T),De(Q),De(c),De(ne),De(fe),De(Tt),De(Ot),De(Kt),De(li),De(Vt),De(si),De(ai),De(Ai)),Ht=!1,Fa(ei)}}}function py(L){let p,y="",B,T,J="Login to continue exploring",Q,c,ne,fe,xe,me="Create a free account to:",he,Ue,Ze,nt,it,at=L[2].name+"",Ye,$e,Xe,lt,Bt,yt=L[2].radiusKm+"",Pt,Ft,gt,Qt,Tt="Browse the worldwide overview map",Ot,Yt,Kt="Sign up in seconds - no credit card required.",li,pt,Vt="Login / Sign Up",si,ci,ai="View Premium Plans",Ai,lr;return{c(){p=Je("div"),p.textContent=y,B=wt(),T=Je("h2"),T.textContent=J,Q=wt(),c=Je("div"),ne=wt(),fe=Je("div"),xe=Je("div"),xe.textContent=me,he=wt(),Ue=Je("ul"),Ze=Je("li"),nt=Ci("Explore the "),it=Je("strong"),Ye=Ci(at),$e=Ci(" area in detail"),Xe=wt(),lt=Je("li"),Bt=Ci("Access ~"),Pt=Ci(yt),Ft=Ci(" km radius at full resolution"),gt=wt(),Qt=Je("li"),Qt.textContent=Tt,Ot=wt(),Yt=Je("div"),Yt.textContent=Kt,li=wt(),pt=Je("button"),pt.textContent=Vt,si=wt(),ci=Je("button"),ci.textContent=ai,this.h()},l(Ht){p=je(Ht,"DIV",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-cpufnf"&&(p.textContent=y),B=bt(Ht),T=je(Ht,"H2",{class:!0,"data-svelte-h":!0}),ti(T)!=="svelte-wdu9uv"&&(T.textContent=J),Q=bt(Ht),c=je(Ht,"DIV",{class:!0}),dt(c).forEach(De),ne=bt(Ht),fe=je(Ht,"DIV",{class:!0});var ei=dt(fe);xe=je(ei,"DIV",{class:!0,"data-svelte-h":!0}),ti(xe)!=="svelte-s61fmm"&&(xe.textContent=me),he=bt(ei),Ue=je(ei,"UL",{class:!0});var Zt=dt(Ue);Ze=je(Zt,"LI",{class:!0});var ri=dt(Ze);nt=Bi(ri,"Explore the "),it=je(ri,"STRONG",{class:!0});var mi=dt(it);Ye=Bi(mi,at),mi.forEach(De),$e=Bi(ri," area in detail"),ri.forEach(De),Xe=bt(Zt),lt=je(Zt,"LI",{class:!0});var ki=dt(lt);Bt=Bi(ki,"Access ~"),Pt=Bi(ki,yt),Ft=Bi(ki," km radius at full resolution"),ki.forEach(De),gt=bt(Zt),Qt=je(Zt,"LI",{class:!0,"data-svelte-h":!0}),ti(Qt)!=="svelte-95uw7v"&&(Qt.textContent=Tt),Zt.forEach(De),ei.forEach(De),Ot=bt(Ht),Yt=je(Ht,"DIV",{class:!0,"data-svelte-h":!0}),ti(Yt)!=="svelte-kcsnju"&&(Yt.textContent=Kt),li=bt(Ht),pt=je(Ht,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(pt)!=="svelte-ymaevt"&&(pt.textContent=Vt),si=bt(Ht),ci=je(Ht,"BUTTON",{class:!0,"data-svelte-h":!0}),ti(ci)!=="svelte-11d8v2t"&&(ci.textContent=ai),this.h()},h(){ye(p,"class","icon svelte-1snuf20"),ye(T,"class","svelte-1snuf20"),ye(c,"class","divider svelte-1snuf20"),ye(xe,"class","section-title svelte-1snuf20"),ye(it,"class","svelte-1snuf20"),ye(Ze,"class","svelte-1snuf20"),ye(lt,"class","svelte-1snuf20"),ye(Qt,"class","svelte-1snuf20"),ye(Ue,"class","svelte-1snuf20"),ye(fe,"class","section svelte-1snuf20"),ye(Yt,"class","hint svelte-1snuf20"),ye(pt,"class","primary-btn svelte-1snuf20"),ye(ci,"class","secondary-btn svelte-1snuf20")},m(Ht,ei){ot(Ht,p,ei),ot(Ht,B,ei),ot(Ht,T,ei),ot(Ht,Q,ei),ot(Ht,c,ei),ot(Ht,ne,ei),ot(Ht,fe,ei),Te(fe,xe),Te(fe,he),Te(fe,Ue),Te(Ue,Ze),Te(Ze,nt),Te(Ze,it),Te(it,Ye),Te(Ze,$e),Te(Ue,Xe),Te(Ue,lt),Te(lt,Bt),Te(lt,Pt),Te(lt,Ft),Te(Ue,gt),Te(Ue,Qt),ot(Ht,Ot,ei),ot(Ht,Yt,ei),ot(Ht,li,ei),ot(Ht,pt,ei),ot(Ht,si,ei),ot(Ht,ci,ei),Ai||(lr=[Ti(pt,"click",L[3]),Ti(ci,"click",L[4])],Ai=!0)},p(Ht,ei){ei&4&&at!==(at=Ht[2].name+"")&&Ir(Ye,at),ei&4&&yt!==(yt=Ht[2].radiusKm+"")&&Ir(Pt,yt)},d(Ht){Ht&&(De(p),De(B),De(T),De(Q),De(c),De(ne),De(fe),De(Ot),De(Yt),De(li),De(pt),De(si),De(ci)),Ai=!1,Fa(lr)}}}function my(L){let p,y=L[0]&&zd(L);return{c(){y&&y.c(),p=jr()},l(B){y&&y.l(B),p=jr()},m(B,T){y&&y.m(B,T),ot(B,p,T)},p(B,[T]){B[0]?y?y.p(B,T):(y=zd(B),y.c(),y.m(p.parentNode,p)):y&&(y.d(1),y=null)},i:Li,o:Li,d(B){B&&De(p),y&&y.d(B)}}}function yy(L,p,y){let B,T,J;Hr(L,gc,xe=>y(0,B=xe)),Hr(L,Nl,xe=>y(1,T=xe)),Hr(L,Hc,xe=>y(2,J=xe));function Q(){gc.set(!1),window.dispatchEvent(new CustomEvent("open-auth-modal"))}function c(){gc.set(!1),window.dispatchEvent(new CustomEvent("open-billing-modal"))}function ne(){gc.set(!1)}function fe(){gc.set(!1)}return[B,T,J,Q,c,ne,fe]}class _y extends Jn{constructor(p){super(),Yn(this,p,yy,my,jn,{})}}function Gd(L,{delay:p=0,duration:y=400,easing:B=Xg}={}){const T=+getComputedStyle(L).opacity;return{delay:p,duration:y,easing:B,css:J=>`opacity: ${J*T}`}}function Ud(L){let p,y,B="",T,J,Q;function c(xe,me){return xe[1]?Iy:by}let ne=c(L),fe=ne(L);return{c(){p=Je("div"),y=Je("span"),y.textContent=B,T=wt(),fe.c(),this.h()},l(xe){p=je(xe,"DIV",{class:!0});var me=dt(p);y=je(me,"SPAN",{class:!0,"data-svelte-h":!0}),ti(y)!=="svelte-1xc37j3"&&(y.textContent=B),T=bt(me),fe.l(me),me.forEach(De),this.h()},h(){ye(y,"class","icon svelte-d8da0u"),ye(p,"class","toast svelte-d8da0u")},m(xe,me){ot(xe,p,me),Te(p,y),Te(p,T),fe.m(p,null),Q=!0},p(xe,me){ne!==(ne=c(xe))&&(fe.d(1),fe=ne(xe),fe&&(fe.c(),fe.m(p,null)))},i(xe){Q||(xe&&ep(()=>{Q&&(J||(J=nd(p,Gd,{duration:200},!0)),J.run(1))}),Q=!0)},o(xe){xe&&(J||(J=nd(p,Gd,{duration:200},!1)),J.run(0)),Q=!1},d(xe){xe&&De(p),fe.d(),xe&&J&&J.end()}}}function Iy(L){let p,y="This area requires a subscription";return{c(){p=Je("span"),p.textContent=y,this.h()},l(B){p=je(B,"SPAN",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-1eg0wtp"&&(p.textContent=y),this.h()},h(){ye(p,"class","message svelte-d8da0u")},m(B,T){ot(B,p,T)},d(B){B&&De(p)}}}function by(L){let p,y="Login to explore beyond the free zone";return{c(){p=Je("span"),p.textContent=y,this.h()},l(B){p=je(B,"SPAN",{class:!0,"data-svelte-h":!0}),ti(p)!=="svelte-141ga3v"&&(p.textContent=y),this.h()},h(){ye(p,"class","message svelte-d8da0u")},m(B,T){ot(B,p,T)},d(B){B&&De(p)}}}function wy(L){let p,y=L[0]&&Ud(L);return{c(){y&&y.c(),p=jr()},l(B){y&&y.l(B),p=jr()},m(B,T){y&&y.m(B,T),ot(B,p,T)},p(B,[T]){B[0]?y?(y.p(B,T),T&1&&Ar(y,1)):(y=Ud(B),y.c(),Ar(y,1),y.m(p.parentNode,p)):y&&(uu(),Mr(y,1,1,()=>{y=null}),Au())},i(B){Ar(y)},o(B){Mr(y)},d(B){B&&De(p),y&&y.d(B)}}}function vy(L,p,y){let B,T;return Hr(L,mu,J=>y(0,B=J)),Hr(L,Nl,J=>y(1,T=J)),[B,T]}class xy extends Jn{constructor(p){super(),Yn(this,p,vy,wy,jn,{})}}function Nd(L){let p,y;return p=new oy({}),{c(){ys(p.$$.fragment)},l(B){ms(p.$$.fragment,B)},m(B,T){ps(p,B,T),y=!0},i(B){y||(Ar(p.$$.fragment,B),y=!0)},o(B){Mr(p.$$.fragment,B),y=!1},d(B){gs(p,B)}}}function Od(L){let p,y,B;return y=new uy({}),{c(){p=Je("div"),ys(y.$$.fragment),this.h()},l(T){p=je(T,"DIV",{class:!0});var J=dt(p);ms(y.$$.fragment,J),J.forEach(De),this.h()},h(){ye(p,"class","wind-controls-wrapper svelte-18qnxxm")},m(T,J){ot(T,p,J),ps(y,p,null),B=!0},i(T){B||(Ar(y.$$.fragment,T),B=!0)},o(T){Mr(y.$$.fragment,T),B=!1},d(T){T&&De(p),gs(y)}}}function By(L){let p,y,B,T,J,Q,c,ne,fe,xe,me,he,Ue,Ze,nt,it,at,Ye,$e,Xe,lt,Bt,yt;B=new ey({}),J=new ym({props:{mapTilerKey:lp}}),c=new Sm({}),xe=new ry({}),he=new Tm({}),Ze=new Em({});let Pt=(L[0].activeLayer==="activity"||L[0].activeLayer==="wind")&&Nd(),Ft=L[0].activeLayer==="wind"&&Od();return Ye=new fy({}),Xe=new _y({}),Bt=new xy({}),{c(){p=wt(),y=Je("div"),ys(B.$$.fragment),T=wt(),ys(J.$$.fragment),Q=wt(),ys(c.$$.fragment),ne=wt(),fe=Je("div"),ys(xe.$$.fragment),me=wt(),ys(he.$$.fragment),Ue=wt(),ys(Ze.$$.fragment),nt=wt(),Pt&&Pt.c(),it=wt(),Ft&&Ft.c(),at=wt(),ys(Ye.$$.fragment),$e=wt(),ys(Xe.$$.fragment),lt=wt(),ys(Bt.$$.fragment),this.h()},l(gt){ip("svelte-1wptagv",document.head).forEach(De),p=bt(gt),y=je(gt,"DIV",{class:!0});var Tt=dt(y);ms(B.$$.fragment,Tt),T=bt(Tt),ms(J.$$.fragment,Tt),Q=bt(Tt),ms(c.$$.fragment,Tt),ne=bt(Tt),fe=je(Tt,"DIV",{class:!0});var Ot=dt(fe);ms(xe.$$.fragment,Ot),Ot.forEach(De),me=bt(Tt),ms(he.$$.fragment,Tt),Ue=bt(Tt),ms(Ze.$$.fragment,Tt),nt=bt(Tt),Pt&&Pt.l(Tt),it=bt(Tt),Ft&&Ft.l(Tt),Tt.forEach(De),at=bt(gt),ms(Ye.$$.fragment,gt),$e=bt(gt),ms(Xe.$$.fragment,gt),lt=bt(gt),ms(Bt.$$.fragment,gt),this.h()},h(){document.title="IncusGrid - Lightning Risk Map",ye(fe,"class","controls-left svelte-18qnxxm"),ye(y,"class","app svelte-18qnxxm")},m(gt,Qt){ot(gt,p,Qt),ot(gt,y,Qt),ps(B,y,null),Te(y,T),ps(J,y,null),Te(y,Q),ps(c,y,null),Te(y,ne),Te(y,fe),ps(xe,fe,null),Te(y,me),ps(he,y,null),Te(y,Ue),ps(Ze,y,null),Te(y,nt),Pt&&Pt.m(y,null),Te(y,it),Ft&&Ft.m(y,null),ot(gt,at,Qt),ps(Ye,gt,Qt),ot(gt,$e,Qt),ps(Xe,gt,Qt),ot(gt,lt,Qt),ps(Bt,gt,Qt),yt=!0},p(gt,[Qt]){gt[0].activeLayer==="activity"||gt[0].activeLayer==="wind"?Pt?Qt&1&&Ar(Pt,1):(Pt=Nd(),Pt.c(),Ar(Pt,1),Pt.m(y,it)):Pt&&(uu(),Mr(Pt,1,1,()=>{Pt=null}),Au()),gt[0].activeLayer==="wind"?Ft?Qt&1&&Ar(Ft,1):(Ft=Od(),Ft.c(),Ar(Ft,1),Ft.m(y,null)):Ft&&(uu(),Mr(Ft,1,1,()=>{Ft=null}),Au())},i(gt){yt||(Ar(B.$$.fragment,gt),Ar(J.$$.fragment,gt),Ar(c.$$.fragment,gt),Ar(xe.$$.fragment,gt),Ar(he.$$.fragment,gt),Ar(Ze.$$.fragment,gt),Ar(Pt),Ar(Ft),Ar(Ye.$$.fragment,gt),Ar(Xe.$$.fragment,gt),Ar(Bt.$$.fragment,gt),yt=!0)},o(gt){Mr(B.$$.fragment,gt),Mr(J.$$.fragment,gt),Mr(c.$$.fragment,gt),Mr(xe.$$.fragment,gt),Mr(he.$$.fragment,gt),Mr(Ze.$$.fragment,gt),Mr(Pt),Mr(Ft),Mr(Ye.$$.fragment,gt),Mr(Xe.$$.fragment,gt),Mr(Bt.$$.fragment,gt),yt=!1},d(gt){gt&&(De(p),De(y),De(at),De($e),De(lt)),gs(B),gs(J),gs(c),gs(xe),gs(he),gs(Ze),Pt&&Pt.d(),Ft&&Ft.d(),gs(Ye,gt),gs(Xe,gt),gs(Bt,gt)}}}function Cy(L,p,y){let B;return Hr(L,on,T=>y(0,B=T)),mh(async()=>{await lm()}),[B]}class Ty extends Jn{constructor(p){super(),Yn(this,p,Cy,By,jn,{})}}export{Ty as component};
